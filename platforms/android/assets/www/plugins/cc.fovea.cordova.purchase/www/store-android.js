cordova.define("cc.fovea.cordova.purchase.InAppBillingPlugin",function(t,e,r){var i={};i.verbosity=0,function(){"use strict";i.FREE_SUBSCRIPTION="free subscription",i.PAID_SUBSCRIPTION="paid subscription",i.CONSUMABLE="consumable",i.NON_CONSUMABLE="non consumable";var t=6777e3;i.ERR_SETUP=t+1,i.ERR_LOAD=t+2,i.ERR_PURCHASE=t+3,i.ERR_LOAD_RECEIPTS=t+4,i.ERR_CLIENT_INVALID=t+5,i.ERR_PAYMENT_CANCELLED=t+6,i.ERR_PAYMENT_INVALID=t+7,i.ERR_PAYMENT_NOT_ALLOWED=t+8,i.ERR_UNKNOWN=t+10,i.ERR_REFRESH_RECEIPTS=t+11,i.ERR_INVALID_PRODUCT_ID=t+12,i.ERR_FINISH=t+13,i.ERR_COMMUNICATION=t+14,i.ERR_SUBSCRIPTIONS_NOT_AVAILABLE=t+15,i.ERR_MISSING_TOKEN=t+16,i.ERR_VERIFICATION_FAILED=t+17,i.ERR_BAD_RESPONSE=t+18,i.ERR_REFRESH=t+19,i.ERR_PAYMENT_EXPIRED=t+20,i.ERR_DOWNLOAD=t+21,i.REGISTERED="registered",i.INVALID="invalid",i.VALID="valid",i.REQUESTED="requested",i.INITIATED="initiated",i.APPROVED="approved",i.FINISHED="finished",i.OWNED="owned",i.DOWNLOADING="downloading",i.DOWNLOADED="downloaded",i.QUIET=0,i.ERROR=1,i.WARNING=2,i.INFO=3,i.DEBUG=4,i.INVALID_PAYLOAD=6778001,i.CONNECTION_FAILED=6778002,i.PURCHASE_EXPIRED=6778003}(),function(){"use strict";function t(t,e,r){setTimeout(function(){e.call(t)},r||1)}var e=t;i.Product=function(t){t||(t={}),this.id=t.id||null,this.alias=t.alias||t.id||null;var e=this.type=t.type||null;if(e!==i.CONSUMABLE&&e!==i.NON_CONSUMABLE&&e!==i.PAID_SUBSCRIPTION&&e!==i.FREE_SUBSCRIPTION)throw new TypeError("Invalid product type");this.state=t.state||"",this.title=t.title||t.localizedTitle||null,this.description=t.description||t.localizedDescription||null,this.price=t.price||null,this.currency=t.currency||null,this.loaded=t.loaded,this.valid=t.valid,this.canPurchase=t.canPurchase,this.owned=t.owned,this.downloading=t.downloading,this.downloaded=t.downloaded,this.transaction=null,this.stateChanged()},i.Product.prototype.finish=function(){i.log.debug("product -> defer finishing "+this.id),t(this,function(){i.log.debug("product -> finishing "+this.id),this.state!==i.FINISHED&&this.set("state",i.FINISHED)})},i.Product.prototype.verify=function(){var r=this,n=0,o=function(){},s=o,a=o,u=o,c=o,l=function(){r.state===i.APPROVED&&i._validator(r,function(t,o){if(i.log.debug("verify -> "+JSON.stringify(t)),t)i.log.debug("verify -> success: "+JSON.stringify(o)),i.utils.callExternal("verify.success",a,r,o),i.utils.callExternal("verify.done",s,r),r.trigger("verified");else{i.log.debug("verify -> error: "+JSON.stringify(o));var d=o&&o.error&&o.error.message?o.error.message:"",f=new i.Error({code:i.ERR_VERIFICATION_FAILED,message:"Transaction verification failed: "+d});o.code===i.PURCHASE_EXPIRED&&(f=new i.Error({code:i.ERR_PAYMENT_EXPIRED,message:"Transaction expired: "+d})),o.code===i.PURCHASE_EXPIRED?2>n&&i._refreshForValidation?(n+=1,i._refreshForValidation(function(){e(r,l,300)})):(i.error(f),i.utils.callExternal("verify.error",c,f),i.utils.callExternal("verify.done",s,r),r.trigger("expired"),r.set("state",i.VALID),i.utils.callExternal("verify.expired",u,r)):4>n?(n+=1,e(this,l,1e3*n*n)):(i.log.debug("validation failed 5 times, stop retrying, trigger an error"),i.error(f),i.utils.callExternal("verify.error",c,f),i.utils.callExternal("verify.done",s,r),r.trigger("unverified"))}})};t(this,function(){if(r.state!==i.APPROVED){var t=new i.Error({code:i.ERR_VERIFICATION_FAILED,message:"Product isn't in the APPROVED state"});return i.error(t),i.utils.callExternal("verify.error",c,t),void i.utils.callExternal("verify.done",s,r)}}),e(this,l,1e3);var d={done:function(t){return s=t,this},expired:function(t){return u=t,this},success:function(t){return a=t,this},error:function(t){return c=t,this}};return d}}(),function(){"use strict";i.Error=function(t){t||(t={}),this.code=t.code||i.ERR_UNKNOWN,this.message=t.message||"unknown error"},i.error=function(t,e){var r=t;return t instanceof i.Error?i.error.callbacks.trigger(t):t.code&&t.message?i.error.callbacks.trigger(new i.Error(t)):"function"==typeof t?i.error.callbacks.push(t):"function"==typeof e&&(r=function(r){r.code===t&&e()},i.error(r)),r},i.error.unregister=function(t){i.error.callbacks.unregister(t)}}(),function(){"use strict";function t(t){for(var r=0;r<t.length;++r){t[r].state=i.REGISTERED;var n=new i.Product(t[r]);n.alias||(n.alias=n.id),n.id===i._queries.uniqueQuery(n.id)&&n.alias===i._queries.uniqueQuery(n.alias)&&(e(n.id)||e(n.alias)||i.products.push(n))}}function e(t){if(!t)return!1;for(var e=t.split(" "),i=0;i<e.length;++i)for(var n=e[i],o=0;o<r.length;++o)if(n===r[o])return!0;return!1}i.register=function(e){e&&(e.length?t(e):i.register([e]))};var r=["product","order",i.REGISTERED,i.VALID,i.INVALID,i.REQUESTED,i.INITIATED,i.APPROVED,i.OWNED,i.FINISHED,i.DOWNLOADING,i.DOWNLOADED,"refreshed"]}(),function(){"use strict";i.get=function(t){var e=i.products.byId[t]||i.products.byAlias[t];return e}}(),function(){"use strict";i.when=function(t,e,r){if("undefined"==typeof t&&(t=""),"object"==typeof t&&t instanceof i.Product&&(t=t.id),"function"==typeof e)return i.when("",t,e);if("string"!=typeof e){var n={},o=function(r){n[r]=function(n){return i._queries.callbacks.add(t,r,n,e),this}};return o("loaded"),o("updated"),o("error"),o("approved"),o("owned"),o("cancelled"),o("refunded"),o("registered"),o("valid"),o("invalid"),o("requested"),o("initiated"),o("finished"),o("verified"),o("unverified"),o("expired"),o("downloading"),o("downloaded"),n}var s=e;i._queries.callbacks.add(t,s,r)},i.when.unregister=function(t){i._queries.callbacks.unregister(t)}}(),function(){"use strict";i.once=function(t,e,r){return"function"==typeof e?i.when(t,e,!0):"undefined"==typeof e?i.when(t,!0):void i._queries.callbacks.add(t,e,r,!0)},i.once.unregister=i.when.unregister}(),function(){"use strict";var t={},e=0;i.order=function(r){function n(){delete a.then,delete a.error,delete t[s]}var o=r;"string"==typeof r&&(o=i.products.byId[r]||i.products.byAlias[r],o||(o=new i.Product({id:r,loaded:!0,valid:!1})));var s=e++,a=t[s]={};return i.ready(function(){o.set("state",i.REQUESTED)}),{then:function(t){return a.then=t,i.once(o.id,"initiated",function(){a.then&&(n(),t(o))}),this},error:function(t){return a.error=t,i.once(o.id,"error",function(e){a.error&&(n(),t(e))}),this}}},i.order.unregister=function(e){for(var r in t)t[r].then===e&&delete t[r].then,t[r].error===e&&delete t[r].error}}(),function(){"use strict";var t=!1,e=[];i.ready=function(r){if(r===!0){if(t)return this;t=!0;for(var n=0;n<e.length;++n)i.utils.callExternal("ready.callback",e[n]);e=[]}else{if(!r)return t;if(t)return setTimeout(function(){i.utils.callExternal("ready.callback",r)},1),this;e.push(r)}return this},i.ready.unregister=function(t){e=e.filter(function(e){return e!==t})},i.ready.reset=function(){t=!1,e=[]}}(),function(){"use strict";i.off=function(t){i.ready.unregister(t),i.when.unregister(t),i.order.unregister(t),i.error.unregister(t)}}(),function(){"use strict";i.validator=null,i._validator=function(t,e,r){return i.validator||e(!0,t),i._prepareForValidation&&r!==!0?void i._prepareForValidation(t,function(){i._validator(t,e,!0)}):void("string"==typeof i.validator?i.utils.ajax({url:i.validator,method:"POST",data:t,success:function(t){e(t&&t.ok,t.data)},error:function(t,r){e(!1,"Error "+t+": "+r)}}):i.validator(t,e))}}(),function(){"use strict";var t=!0;i.refresh=function(){if(i.trigger("refreshed"),t)return void(t=!1);i.log.debug("refresh -> checking products state ("+i.products.length+" products)");for(var e=0;e<i.products.length;++e){var r=i.products[e];i.log.debug("refresh -> product id "+r.id+" ("+r.alias+")"),i.log.debug("           in state '"+r.state+"'"),r.state===i.APPROVED?r.trigger(i.APPROVED):r.state!==i.OWNED||r.type!==i.FREE_SUBSCRIPTION&&r.type!==i.PAID_SUBSCRIPTION||r.set("state",i.APPROVED)}i.trigger("re-refreshed")}}(),function(){"use strict";function t(t,r){var n=i.verbosity===!0?1:i.verbosity;t>n||("string"!=typeof r&&(r=JSON.stringify(r)),e[t])}var e={};e[i.ERROR]="ERROR",e[i.WARNING]="WARNING",e[i.INFO]="INFO",e[i.DEBUG]="DEBUG",i.log={error:function(e){t(i.ERROR,e)},warn:function(e){t(i.WARNING,e)},info:function(e){t(i.INFO,e)},debug:function(e){t(i.DEBUG,e)}}}(),function(){"use strict";i.products=[],i.products.push=function(t){Array.prototype.push.call(this,t),this.byId[t.id]=t,this.byAlias[t.alias]=t},i.products.byId={},i.products.byAlias={},i.products.reset=function(){for(;this.length>0;)this.shift();this.byAlias={},this.byId={}}}(),function(){"use strict";i.Product.prototype.set=function(t,e){if("string"==typeof t)this[t]=e,"state"===t&&this.stateChanged();else{var r=t;for(t in r)e=r[t],this.set(t,e)}},i.Product.prototype.stateChanged=function(){this.canPurchase=this.state===i.VALID,this.loaded=this.state&&this.state!==i.REGISTERED,this.owned=this.owned||this.state===i.OWNED,this.downloading=this.downloading||this.state===i.DOWNLOADING,this.downloaded=this.downloaded||this.state===i.DOWNLOADED,this.valid=this.state!==i.INVALID,this.state&&this.state!==i.REGISTERED||delete this.valid,this.state&&this.trigger(this.state)},i.Product.prototype.on=function(t,e){i.when(this.id,t,e)},i.Product.prototype.once=function(t,e){i.once(this.id,t,e)},i.Product.prototype.off=function(t){i.when.unregister(t)},i.Product.prototype.trigger=function(t,e){i.trigger(this,t,e)}}(),function(){"use strict";function t(t){return!t.once}function e(t){setTimeout(function(){throw t},1)}i._queries={uniqueQuery:function(t){if(!t)return"";for(var e="",r=t.split(" "),i=0;i<r.length;++i){var n=r[i];"order"!==n&&"product"!==n&&(""!==e&&(e+=" "),e+=n)}return e},callbacks:{byQuery:{},add:function(t,e,r,n){var o=i._queries.uniqueQuery(t?t+" "+e:e);this.byQuery[o]?this.byQuery[o].push({cb:r,once:n}):this.byQuery[o]=[{cb:r,once:n}],i.log.debug("queries ++ '"+o+"'")},unregister:function(t){var e=function(e){return e.cb!==t};for(var r in this.byQuery)this.byQuery[r]=this.byQuery[r].filter(e)}},triggerAction:function(e,r){var n=i._queries.callbacks.byQuery[e];if(i.log.debug("queries !! '"+e+"'"),n){for(var o=0;o<n.length;++o)try{n[o].cb.apply(i,r)}catch(s){i.utils.logError(e,s)}i._queries.callbacks.byQuery[e]=n.filter(t)}},triggerWhenProduct:function(r,n,o){var s=[];r&&r.id&&s.push(r.id+" "+n),r&&r.alias&&r.alias!==r.id&&s.push(r.alias+" "+n),r&&r.type&&s.push(r.type+" "+n),r&&r.type&&(r.type===i.FREE_SUBSCRIPTION||r.type===i.PAID_SUBSCRIPTION)&&s.push("subscription "+n),r&&r.valid===!0&&s.push("valid "+n),r&&r.valid===!1&&s.push("invalid "+n),s.push(n);var a;for(a=0;a<s.length;++a){var u=s[a];i.log.debug("store.queries !! '"+u+"'");var c=i._queries.callbacks.byQuery[u];if(c){for(var l=0;l<c.length;++l)try{c[l].cb.apply(i,o)}catch(d){i.utils.logError(u,d),e(d)}i._queries.callbacks.byQuery[u]=c.filter(t)}}"updated"!==n&&"error"!==n&&this.triggerWhenProduct(r,"updated",[r])}}}(),function(){"use strict";i.trigger=function(t,e,r){return e||r||"string"!=typeof t?void(("string"!=typeof t||(t=i.get(t)))&&("undefined"==typeof r||"object"==typeof r&&"number"==typeof r.length||(r=[r]),"undefined"==typeof r&&(r=[t]),i._queries.triggerWhenProduct(t,e,r))):(i.log.debug("store.trigger -> triggering action "+t),void i._queries.triggerAction(t))}}(),function(){"use strict";function t(t){setTimeout(function(){throw t},1)}i.error.callbacks=[],i.error.callbacks.trigger=function(e){for(var r=0;r<this.length;++r)try{this[r].call(i,e)}catch(n){i.utils.logError("error",n),t(n)}},i.error.callbacks.reset=function(){for(;this.length>0;)this.shift()},i.error.callbacks.unregister=function(t){var e=this.filter(function(e){return e!==t});if(e.length<this.length){this.reset();for(var r=0;r<e.length;++r)this.push(e[r])}}}(),function(){"use strict";i.utils={logError:function(t,e){i.log.warn("A callback in '"+t+"' failed with an exception."),"string"==typeof e?i.log.warn("           "+e):e&&(e.fileName&&i.log.warn("           "+e.fileName+":"+e.lineNumber),e.message&&i.log.warn("           "+e.message),e.stack&&i.log.warn("           "+e.stack))},callExternal:function(t,e){try{var r=Array.prototype.slice.call(arguments,2);e&&e.apply(this,r)}catch(n){i.utils.logError(t,n)}},ajax:function(t){var e=function(){},r=new XMLHttpRequest;return r.open(t.method||"POST",t.url,!0),r.onreadystatechange=function(){try{4===r.readyState&&(200===r.status?i.utils.callExternal("ajax.success",t.success,JSON.parse(r.responseText)):(i.log.warn("ajax -> request to "+t.url+" failed with status "+r.status+" ("+r.statusText+")"),i.utils.callExternal("ajax.error",t.error,r.status,r.statusText)))}catch(n){i.log.warn("ajax -> request to "+t.url+" failed with an exception: "+n.message),t.error&&t.error(417,n.message)}4===r.readyState&&i.utils.callExternal("ajax.done",e)},i.log.debug("ajax -> send request to "+t.url),t.data?(r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(t.data))):r.send(),{done:function(t){return e=t,this}}}}}(),function(){"use strict";function t(t){return function(e){if(t){var r="string"==typeof e?e.split("|"):[e];if(r.length>1&&/^[-+]?(\d+)$/.test(r[0])){var i=r[0],n=r[1];t(n,+i)}else t(e)}}}var e=function(t){},r=function(){this.options={}};r.prototype.init=function(r,n,o,s){o||(o={}),this.options={showLog:o.showLog!==!1},this.options.showLog&&e("setup ok");var a=!1;if("undefined"!=typeof s&&("string"==typeof s&&(s=[s]),s.length>0)){if("string"!=typeof s[0]){var u="invalid productIds: "+JSON.stringify(s);return this.options.showLog&&e(u),void n(u,i.ERR_INVALID_PRODUCT_ID)}this.options.showLog&&e("load "+JSON.stringify(s)),a=!0}a?cordova.exec(r,t(n),"InAppBillingPlugin","init",[s]):cordova.exec(r,t(n),"InAppBillingPlugin","init",[])},r.prototype.getPurchases=function(r,i){return this.options.showLog&&e("getPurchases called!"),cordova.exec(r,t(i),"InAppBillingPlugin","getPurchases",["null"])},r.prototype.buy=function(r,i,n){return this.options.showLog&&e("buy called!"),cordova.exec(r,t(i),"InAppBillingPlugin","buy",[n])},r.prototype.subscribe=function(r,i,n){return this.options.showLog&&e("subscribe called!"),cordova.exec(r,t(i),"InAppBillingPlugin","subscribe",[n])},r.prototype.consumePurchase=function(r,i,n){return this.options.showLog&&e("consumePurchase called!"),cordova.exec(r,t(i),"InAppBillingPlugin","consumePurchase",[n])},r.prototype.getAvailableProducts=function(r,i){return this.options.showLog&&e("getAvailableProducts called!"),cordova.exec(r,t(i),"InAppBillingPlugin","getAvailableProducts",["null"])},r.prototype.getProductDetails=function(r,n,o){if(this.options.showLog&&e("getProductDetails called!"),"string"==typeof o&&(o=[o]),o.length){if("string"!=typeof o[0]){var s="invalid productIds: "+JSON.stringify(o);return e(s),void n(s,i.ERR_INVALID_PRODUCT_ID)}this.options.showLog&&e("load "+JSON.stringify(o)),cordova.exec(r,t(n),"InAppBillingPlugin","getProductDetails",[o])}},r.prototype.setTestMode=function(r,i){return this.options.showLog&&e("setTestMode called!"),cordova.exec(r,t(i),"InAppBillingPlugin","setTestMode",[""])},window.inappbilling=new r;try{i.inappbilling=window.inappbilling}catch(n){}}(),function(){"use strict";function t(){if(!o){o=!0;for(var t=0;t<i.products.length;++t)s.push(i.products[t].id);i.inappbilling.init(e,function(t){o=!1,i.error({code:i.ERR_SETUP,message:"Init failed - "+t})},{showLog:i.verbosity>=i.DEBUG?!0:!1},s)}}function e(){i.log.debug("plugin -> ready"),i.inappbilling.getAvailableProducts(r,function(t){i.error({code:i.ERR_LOAD,message:"Loading product info failed - "+t})})}function r(t){i.log.debug("plugin -> loaded - "+JSON.stringify(t));var e,r;for(r=0;r<t.length;++r)e=t[r].productId?i.products.byId[t[r].productId]:null,e&&(e.set({title:t[r].title||t[r].name,price:t[r].price||t[r].formattedPrice,description:t[r].description,currency:t[r].price_currency_code?t[r].price_currency_code:"",state:i.VALID}),e.trigger("loaded"));for(r=0;r<s.length;++r)e=i.products.byId[s[r]],e&&!e.valid&&(e.set("state",i.INVALID),e.trigger("loaded"));n()}function n(){i.inappbilling.getPurchases(function(t){if(t&&t.length)for(var e=0;e<t.length;++e){var r=t[e],n=i.get(r.productId);n?i.setProductData(n,r):i.log.warn("plugin -> user owns a non-registered product")}i.ready(!0)},function(){})}var o=!1,s=[];i.when("refreshed",function(){o||t()}),i.when("re-refreshed",function(){n()});var a={OK:0,USER_CANCELED:1,SERVICE_UNAVAILABLE:2,BILLING_UNAVAILABLE:3,ITEM_UNAVAILABLE:4,DEVELOPER_ERROR:5,ERROR:6,ITEM_ALREADY_OWNED:7,ITEM_NOT_OWNED:8};i.when("requested",function(t){i.ready(function(){if(!t)return void i.error({code:i.ERR_INVALID_PRODUCT_ID,message:"Trying to order an unknown product"});if(!t.valid)return void t.trigger("error",[new i.Error({code:i.ERR_PURCHASE,message:"`purchase()` called with an invalid product"}),t]);t.set("state",i.INITIATED);var e="buy";t.type!==i.NON_CONSUMABLE&&t.type!==i.CONSUMABLE&&(e="subscribe"),i.inappbilling[e](function(e){i.setProductData(t,e)},function(r,n){i.log.info("plugin -> "+e+" error "+n),n===i.ERR_PAYMENT_CANCELLED?(t.transaction=null,t.trigger("cancelled")):i.error({code:n||i.ERR_PURCHASE,message:"Purchase failed: "+r}),n===a.ITEM_ALREADY_OWNED?t.set("state",i.APPROVED):t.set("state",i.VALID)},t.id)})}),i.when("product","finished",function(t){i.log.debug("plugin -> consumable finished"),t.type===i.CONSUMABLE?(t.transaction=null,i.inappbilling.consumePurchase(function(){i.log.debug("plugin -> consumable consumed"),t.set("state",i.VALID)},function(t,e){i.error({code:e||i.ERR_UNKNOWN,message:t})},t.id)):t.set("state",i.OWNED)})}(),function(){"use strict";i.setProductData=function(t,e){i.log.debug("android -> product data for "+t.id),i.log.debug(e),t.transaction={type:"android-playstore",id:e.orderId,purchaseToken:e.purchaseToken,developerPayload:e.developerPayload,receipt:e.receipt,signature:e.signature},t.state!==i.OWNED&&t.state!==i.FINISHED&&t.state!==i.APPROVED&&0===e.purchaseState&&t.set("state",i.APPROVED),(t.state===i.OWNED||t.state===i.FINISHED||t.state===i.APPROVED)&&(1===e.purchaseState?(t.trigger("cancelled"),t.set("state",i.VALID)):2===e.purchaseState&&(t.trigger("refunded"),t.set("state",i.VALID)))}}(),window&&(window.store=i,i.android=i.inappbilling),r.exports=i});