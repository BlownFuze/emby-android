define(["events"],function(e){function a(e){if(!e.NowPlayingItem)return void r();y=e;var a=e.PlayState||{},t=MediaController.getNowPlayingNameHtml(e.NowPlayingItem)||"",n=t.split("<br/>"),i=1==n.length?"":n[0],o=n[n.length-1],c=e.NowPlayingItem.Album||"",m=e.NowPlayingItem.RunTimeTicks?e.NowPlayingItem.RunTimeTicks/1e7:0,p=a.PositionTicks?a.PositionTicks/1e7:0,s="",d=600,u=e.NowPlayingItem;u.PrimaryImageTag?s=ApiClient.getScaledImageUrl(u.PrimaryImageItemId,{type:"Primary",height:d,tag:u.PrimaryImageTag}):u.BackdropImageTag?s=ApiClient.getScaledImageUrl(u.BackdropItemId,{type:"Backdrop",height:d,tag:u.BackdropImageTag,index:0}):u.ThumbImageTag&&(s=ApiClient.getScaledImageUrl(u.ThumbImageItemId,{type:"Thumb",height:d,tag:u.ThumbImageTag}));var f=[i,o,c,s,m,p];try{window.remoteControls.updateMetas(l,g,f)}catch(I){g(I)}}function t(e,t){if("positionchange"==e.type){var n=(new Date).getTime();if(700>n-p)return;p=n}a(t)}function n(e,a){var n=this;n.beginPlayerUpdates(),t.call(n,e,a)}function i(e){var a=this;a.endPlayerUpdates(),r()}function o(){m&&($(m).off("playbackstart",n).off("playbackstop",i).off("playstatechange",t).off("positionchange",t),m.endPlayerUpdates(),m=null,r())}function r(){var e="",a="",t="",n="",i=0,o=0,r=[e,a,t,n,i,o];try{window.remoteControls.updateMetas(l,g,r)}catch(c){g(c)}}function l(){}function g(e){}function c(e){o(),m=e,e.isLocalPlayer&&(e.getPlayerState().then(function(a){a.NowPlayingItem&&e.beginPlayerUpdates(),t.call(e,{type:"init"},a)}),$(e).on("playbackstart",n).on("playbackstop",i).on("playstatechange",t).on("positionchange",t))}var m,y,p=0;e.on(MediaController,"playerchange",function(){c(MediaController.getCurrentPlayer())}),c(MediaController.getCurrentPlayer())});