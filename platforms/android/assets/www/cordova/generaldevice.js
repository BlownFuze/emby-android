!function(){function e(){function e(e){return e.ErrorCode?(MediaController.showPlaybackInfoErrorMessage(e.ErrorCode),!1):!0}function t(e,t){var n=t.filter(function(e){return e.enableDirectPlay=MediaController.supportsDirectPlay(e),e.enableDirectPlay})[0];return n||(n=t.filter(function(e){return e.SupportsDirectStream})[0]),n||t.filter(function(e){return e.SupportsTranscoding})[0]}function n(n,i){if(null==n)throw new Error("item cannot be null");if("Audio"!==n.MediaType&&"Video"!==n.MediaType)throw new Error("Unrecognized media type");if(n.IsPlaceHolder)return void MediaController.showPlaybackInfoErrorMessage("PlaceHolder");var r=y.getDeviceProfile();"Video"===n.MediaType&&Dashboard.showModalLoadingMsg(),MediaController.getPlaybackInfo(n.Id,r,i).then(function(a){if(e(a)){var l=t(n.MediaType,a.MediaSources);l?l.RequiresOpening?getLiveStream(n.Id,a.PlaySessionId,r,i,l,null,null).then(function(e){e.MediaSource.enableDirectPlay=supportsDirectPlay(e.MediaSource),o(n,e.MediaSource,i,callback)}):o(n,l,i,callback):(Dashboard.hideModalLoadingMsg(),MediaController.showPlaybackInfoErrorMessage("NoCompatibleStream"))}})}function o(e,t,n,o){Dashboard.hideModalLoadingMsg();var i=MediaPlayer.createStreamInfo("Video",e,t,n);g.getMediaPlayer().playMedia(i.url,i.MimeType,{title:e.Name,description:e.Overview||"",shouldLoop:!1}).success(function(e,t){Logger.log("Video launch successful"),f=t&&t.acquire()}).error(function(e){Logger.log("error: "+e.message)}),o.resolveWith(null,[i])}function i(){var e={};return e.playableMediaTypes=["Audio","Video"],e.isLocalPlayer=!1,e.supportedCommands=["VolumeUp","VolumeDown","Mute","Unmute","ToggleMute","SetVolume"],e}function r(e){var t=i();return t.appName=t.name=t.deviceName=e.getFriendlyName(),t.playerName=m,t.id=e.getId(),t}function a(e){var t=["AirPlay","Airplay","airplay"];return t.filter(function(t){return e.hasService(t)}).length>0}function l(){var e=y.lastPlayerData||{};return e=e.PlayState||{},null==e.VolumeLevel?100:e.VolumeLevel}function u(){}function s(e){g&&u(),Logger.log("session.connect succeeded"),MediaController.setActivePlayer(m,r(e)),g=e,p=e.getId()}function c(e){e.off("ready"),Logger.log("creating webAppSession"),s(e)}function d(){var e=p;e&&y.tryPair({id:e})}var g,p,f,y=this,m="ConnectSDK";y.name=m,y.getItemsForPlayback=function(e){var t=Dashboard.getCurrentUserId();return e.Limit=e.Limit||100,e.ExcludeLocationTypes="Virtual",ApiClient.getItems(t,e)};var P={};Events.on(P,"playbackstart",function(e,t){Logger.log("cc: playbackstart");var n=y.getPlayerStateInternal(t);Events.trigger(y,"playbackstart",[n])}),Events.on(P,"playbackstop",function(e,t){Logger.log("cc: playbackstop");var n=y.getPlayerStateInternal(t);Events.trigger(y,"playbackstop",[n]),y.lastPlayerData={}}),Events.on(P,"playbackprogress",function(e,t){Logger.log("cc: positionchange");var n=y.getPlayerStateInternal(t);Events.trigger(y,"positionchange",[n])}),y.play=function(e){Dashboard.getCurrentUser().then(function(){e.items?y.playWithCommand(e,"PlayNow"):y.getItemsForPlayback({Ids:e.ids.join(",")}).then(function(t){e.items=t.Items,y.playWithCommand(e,"PlayNow")})})},y.playWithCommand=function(e,t){return e.items?void n(items[0],null,serverAddress):void ApiClient.getItem(Dashboard.getCurrentUserId(),e.ids[0]).then(function(n){e.items=[n],y.playWithCommand(e,t)})},y.unpause=function(){f&&f.pause()},y.pause=function(){f&&f.pause()},y.shuffle=function(e){var t=Dashboard.getCurrentUserId();ApiClient.getItem(t,e).then(function(e){y.playWithCommand({items:[e]},"Shuffle")})},y.instantMix=function(e){var t=Dashboard.getCurrentUserId();ApiClient.getItem(t,e).then(function(e){y.playWithCommand({items:[e]},"InstantMix")})},y.canQueueMediaType=function(e){return"Audio"==e},y.queue=function(e){y.playWithCommnd(e,"PlayLast")},y.queueNext=function(e){y.playWithCommand(e,"PlayNext")},y.stop=function(){f&&f.stop()},y.displayContent=function(){},y.mute=function(){g&&g.getVolumeControl().setMute(!0)},y.unMute=function(){y.setVolume(l()+2)},y.toggleMute=function(){var e=y.lastPlayerData||{};e=e.PlayState||{},e.IsMuted?y.unMute():y.mute()},y.getDeviceProfile=function(){var e=y.getVideoQualityOptions().filter(function(e){return e.selected})[0],t=AppSettings.maxStreamingBitrate(),n={};return n.MaxStreamingBitrate=t,n.MaxStaticBitrate=4e7,n.MusicStreamingTranscodingBitrate=Math.min(t,192e3),n.DirectPlayProfiles=[],n.DirectPlayProfiles.push({Container:"mp4,m4v",Type:"Video",VideoCodec:"h264",AudioCodec:"aac,mp3,ac3"}),n.DirectPlayProfiles.push({Container:"mov",Type:"Video"}),n.DirectPlayProfiles.push({Container:"mp3",Type:"Audio"}),n.DirectPlayProfiles.push({Container:"aac",Type:"Audio"}),n.TranscodingProfiles=[],n.TranscodingProfiles.push({Container:"mp3",Type:"Audio",AudioCodec:"mp3",Context:"Streaming",Protocol:"http"}),y.canPlayHls()&&n.TranscodingProfiles.push({Container:"ts",Type:"Video",AudioCodec:"aac",VideoCodec:"h264",Context:"Streaming",Protocol:"hls"}),n.TranscodingProfiles.push({Container:"mp4",Type:"Video",AudioCodec:"aac",VideoCodec:"h264",Context:"Streaming",Protocol:"http"}),n.ContainerProfiles=[],n.CodecProfiles=[],n.CodecProfiles.push({Type:"Audio",Conditions:[{Condition:"LessThanEqual",Property:"AudioChannels",Value:"2"}]}),n.CodecProfiles.push({Type:"VideoAudio",Codec:"aac,mp3",Conditions:[{Condition:"LessThanEqual",Property:"AudioChannels",Value:"6"}]}),n.CodecProfiles.push({Type:"Video",Codec:"h264",Conditions:[{Condition:"NotEquals",Property:"IsAnamorphic",Value:"true",IsRequired:!1},{Condition:"EqualsAny",Property:"VideoProfile",Value:"high|main|baseline|constrained baseline"},{Condition:"LessThanEqual",Property:"VideoLevel",Value:"41"},{Condition:"LessThanEqual",Property:"Width",Value:e.maxWidth}]}),n.SubtitleProfiles=[],n.ResponseProfiles=[],n.ResponseProfiles.push({Type:"Video",Container:"m4v",MimeType:"video/mp4"}),n},y.getTargets=function(){return ConnectSDKHelper.getDeviceList().filter(function(e){return a(e)}).map(r)},y.seek=function(e){e=parseInt(e),e/=1e7},y.setAudioStreamIndex=function(){},y.setSubtitleStreamIndex=function(){},y.nextTrack=function(){},y.previousTrack=function(){},y.beginPlayerUpdates=function(){},y.endPlayerUpdates=function(){},y.volumeDown=function(){g&&g.getVolumeControl().volumeDown()},y.volumeUp=function(){g&&g.getVolumeControl().volumeUp()},y.setVolume=function(e){e=Math.min(e,100),e=Math.max(e,0),g&&g.getVolumeControl().setVolume(e/100)},y.getPlayerState=function(){var e=$.Deferred(),t=y.getPlayerStateInternal();return e.resolveWith(null,[t]),e.promise()},y.lastPlayerData={},y.getPlayerStateInternal=function(e){return e=e||y.lastPlayerData,y.lastPlayerData=e,Logger.log(JSON.stringify(e)),e},y.tryPair=function(e){var t=$.Deferred(),n=ConnectSDKHelper.getDeviceList().filter(function(t){return t.getId()==e.id})[0];return n?y.tryPairWithDevice(n,t):t.reject(),t.promise()},y.tryPairWithDevice=function(e){Logger.log("Will attempt to connect to Connect Device"),e.on("disconnect",function(){e.off("ready"),e.off("disconnect")}),e.isReady()?(Logger.log("Device is already ready, calling onDeviceReady"),c(e)):(Logger.log("Binding device ready handler"),e.on("ready",function(){Logger.log("device.ready fired"),c(e)}),Logger.log("Calling device.connect"),e.connect())},Events.on(MediaController,"playerchange",function(e,t,n){g&&n.id!=p&&g&&(Logger.log("Disconnecting from connect device"),u(),g=null,p=null,f=null)}),document.addEventListener("resume",d,!1)}MediaController.registerPlayer(new e)}();