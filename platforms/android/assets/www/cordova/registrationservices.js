define(["jQuery"],function(e){function a(e){return ConnectionManager.getRegistrationInfo(e,ApiClient)}function n(e){var n=IapManager.getProductInfo(e),r=n?{enableAppUnlock:!0,id:n.id,price:n.price,feature:e}:null;if(n&&n.owned)return Promise.resolve();var t=browserInfo.android?"android":"ios";return IapManager.isUnlockedOverride(e).then(function(n){return n?Promise.resolve():IapManager.getSubscriptionOptions().then(function(n){return n.filter(function(e){return e.owned}).length>0?Promise.resolve():a(t+"appunlock").catch(function(){var a={title:Globalize.translate("HeaderUnlockApp"),enablePlayMinute:"playback"==e,feature:e};return c(n,r,a)})})})}function r(){var e=document.querySelector(".inAppPurchaseOverlay");e&&require(["paperdialoghelper"],function(a){a.close(e)})}function t(){m=[],g=null,v=null}function i(a,n,t,i,c,u){r(),m=n.slice(0),t&&m.push(t);var p=a.createDialog({size:"fullscreen-border"});p.classList.add("ui-body-b"),p.classList.add("background-theme-b");var d="";d+='<h2 class="dialogHeader">',d+='<paper-fab icon="arrow-back" mini class="btnCloseDialog" tabindex=-1""></paper-fab>',d+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+i.title+"</div>",d+="</h2>",d+='<div class="editorContent">',d+='<form style="max-width: 800px;margin:auto;">',d+='<p style="margin:2em 0;">',d+=Globalize.translate(t?"MessageUnlockAppWithPurchaseOrSupporter":"MessageUnlockAppWithSupporter"),d+="</p>",d+='<p style="margin:2em 0;">',d+=Globalize.translate("MessageToValidateSupporter"),d+="</p>";for(var b=!1,f=0,h=n.length;h>f;f++)b=!0,d+="<p>",d+='<paper-button raised class="submit block btnPurchase" data-email="true" data-feature="'+n[f].feature+'"><iron-icon icon="check"></iron-icon><span>',d+=n[f].buttonText,d+="</span></paper-button>",d+="</p>";if(t){b=!0;var g=Globalize.translate("ButtonUnlockWithPurchase");t.price&&(g=Globalize.translate("ButtonUnlockPrice",t.price)),d+="<p>",d+='<paper-button raised class="secondary block btnPurchase" data-feature="'+t.feature+'"><iron-icon icon="check"></iron-icon><span>'+g+"</span></paper-button>",d+="</p>"}b&&IapManager.enableRestore(i.feature,n,t)&&(d+="<p>",d+=browserInfo.safari?'<paper-button raised class="secondary block btnRestorePurchase subdued"><iron-icon icon="check"></iron-icon><span>'+Globalize.translate("ButtonRestorePreviousPurchase")+"</span></paper-button>":'<paper-button raised class="secondary block btnRestorePurchase subdued"><span>'+Globalize.translate("AlreadyPaid")+"</span></paper-button>",d+="</p>"),n.length&&(d+="<br/>",d+="<h1>"+Globalize.translate("HeaderBenefitsEmbyPremiere")+"</h1>",d+='<div class="paperList" style="margin-bottom:1em;">',d+=o().map(l).join(""),d+="</div>"),i.enablePlayMinute&&(d+="<p>",d+='<paper-button raised class="secondary block btnCloseDialog subdued"><iron-icon icon="play-arrow"></iron-icon><span>'+Globalize.translate("ButtonPlayOneMinute")+"</span></paper-button>",d+="</p>"),d+="</form>",d+="</div>",p.innerHTML=d,document.body.appendChild(p),s(p,i.feature,c,u),a.open(p),e(".btnCloseDialog",p).on("click",function(){a.close(p)}),e(p).on("iron-overlay-closed",function(){window.TabBar&&TabBar.show()}),p.classList.add("inAppPurchaseOverlay")}function o(){var e=[];return e.push({name:Globalize.translate("CoverArt"),icon:"photo",text:Globalize.translate("CoverArtFeatureDescription")}),e.push({name:Globalize.translate("HeaderFreeApps"),icon:"check",text:Globalize.translate("FreeAppsFeatureDescription")}),e.push(Dashboard.capabilities().SupportsSync?{name:Globalize.translate("HeaderMobileSync"),icon:"sync",text:Globalize.translate("MobileSyncFeatureDescription")}:AppInfo.isNativeApp?{name:Globalize.translate("HeaderCloudSync"),icon:"sync",text:Globalize.translate("CloudSyncFeatureDescription")}:{name:Globalize.translate("HeaderCinemaMode"),icon:"movie",text:Globalize.translate("CinemaModeFeatureDescription")}),e}function l(e){var a=!browserInfo.safari,n="";return n+="<paper-icon-item>",n+='<paper-fab mini style="background-color:#52B54B;" icon="'+e.icon+'" item-icon></paper-fab>',n+="<paper-item-body three-line>",a&&(n+='<a class="clearLink" href="https://emby.media/premiere" target="_blank">'),n+="<div>",n+=e.name,n+="</div>",n+='<div secondary style="white-space:normal;">',n+=e.text,n+="</div>",a&&(n+="</a>"),n+="</paper-item-body>",n+="</paper-icon-item>"}function s(a,n,r,i){h=!0,e(".btnPurchase",a).on("click",function(){h=!1,"true"==this.getAttribute("data-email")?u(this.getAttribute("data-feature")):IapManager.beginPurchase(this.getAttribute("data-feature"))}),e(".btnRestorePurchase",a).on("click",function(){h=!1,IapManager.restorePurchase()}),e(a).on("iron-overlay-closed",function(){t();var a=this;h?"playback"==n?Dashboard.alert({message:Globalize.translate("ThankYouForTryingEnjoyOneMinute"),title:Globalize.translate("HeaderTryPlayback"),callback:function(){i(),e(a).remove()}}):(i(),e(a).remove()):e(this).remove()})}function c(e,a,n){return new Promise(function(r,t){require(["paperdialoghelper","paper-fab","paper-icon-item","paper-item-body"],function(o){window.TabBar&&TabBar.hide(),i(o,e,a,n,r,t),g=r,v=t})})}function u(e){if(ConnectionManager.isLoggedIntoConnect()){var a=ConnectionManager.connectUser();if(a&&a.Email)return void IapManager.beginPurchase(e,a.Email)}p(e)}function p(e){require(["prompt"],function(a){a({label:Globalize.translate("TextPleaseEnterYourEmailAddressForSubscription")}).then(function(a){a&&IapManager.beginPurchase(e,a)})})}function d(e,a){if(a.owned){var n=g;n&&m.filter(function(e){return a.id==e.id}).length&&(h=!1,r(),n.resolve())}}function b(){return a("Sync").catch(function(){return IapManager.getSubscriptionOptions().then(function(e){var a={title:Globalize.translate("HeaderUnlockSync"),feature:"sync"};return c(e,null,a)})})}function f(){Events.on(IapManager,"productupdated",d)}var h=!0,m=[],g=null,v=null;window.RegistrationServices={renderPluginInfo:function(){},validateFeature:function(e){return"playback"==e?n(e):"livetv"==e?n(e):"sync"==e?b():Promise.resolve()}},browserInfo.android?requirejs(["cordova/android/iap"],f):requirejs(["cordova/iap"],f)});