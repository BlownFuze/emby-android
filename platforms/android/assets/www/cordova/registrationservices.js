!function(){function e(e){return ConnectionManager.getRegistrationInfo(e,ApiClient)}function n(n,t,r){if(a())return void t();var i=IapManager.getProductInfo(n),o=i?{enableAppUnlock:!0,id:i.id,price:i.price,feature:n}:null;if(i&&i.owned)return void t();var l=browserInfo.android?"android":"ios";IapManager.isUnlockedOverride(n).then(function(a){function i(e){return e.IsRegistered?void t():void IapManager.getSubscriptionOptions().then(function(e){if(e.filter(function(e){return e.owned}).length>0)return void t();var a={title:Globalize.translate("HeaderUnlockApp"),enablePlayMinute:"playback"==n,feature:n};s(e,o,a,t,r)})}return a?void t():void e(l+"appunlock").then(i,function(){i({})})})}function a(){if(ConnectionManager.isLoggedIntoConnect()){var e=ConnectionManager.connectUser();if(e&&e.IsSupporter)return!0}return!1}function t(){var e=document.querySelector(".inAppPurchaseOverlay");e&&require(["paperdialoghelper"],function(n){n.close(e)})}function r(){g=[],v=null,m=null}function i(e,n,a,r,i,s){t(),g=n.slice(0),a&&g.push(a);var u=e.createDialog({size:"fullscreen-border"});u.classList.add("ui-body-b"),u.classList.add("background-theme-b");var p="";p+='<h2 class="dialogHeader">',p+='<paper-fab icon="arrow-back" mini class="btnCloseDialog" tabindex=-1""></paper-fab>',p+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+r.title+"</div>",p+="</h2>",p+='<div class="editorContent">',p+='<form style="max-width: 800px;margin:auto;">',p+='<p style="margin:2em 0;">',p+=Globalize.translate(a?"MessageUnlockAppWithPurchaseOrSupporter":"MessageUnlockAppWithSupporter"),p+="</p>",p+='<p style="margin:2em 0;">',p+=Globalize.translate("MessageToValidateSupporter"),p+="</p>";for(var d=!1,b=0,f=n.length;f>b;b++)d=!0,p+="<p>",p+='<paper-button raised class="submit block btnPurchase" data-email="true" data-feature="'+n[b].feature+'"><iron-icon icon="check"></iron-icon><span>',p+=n[b].buttonText,p+="</span></paper-button>",p+="</p>";if(a){d=!0;var h=Globalize.translate("ButtonUnlockWithPurchase");a.price&&(h=Globalize.translate("ButtonUnlockPrice",a.price)),p+="<p>",p+='<paper-button raised class="secondary block btnPurchase" data-feature="'+a.feature+'"><iron-icon icon="check"></iron-icon><span>'+h+"</span></paper-button>",p+="</p>"}d&&IapManager.enableRestore(r.feature,n,a)&&(p+="<p>",p+=browserInfo.safari?'<paper-button raised class="secondary block btnRestorePurchase subdued"><iron-icon icon="check"></iron-icon><span>'+Globalize.translate("ButtonRestorePreviousPurchase")+"</span></paper-button>":'<paper-button raised class="secondary block btnRestorePurchase subdued"><span>'+Globalize.translate("AlreadyPaid")+"</span></paper-button>",p+="</p>"),n.length&&(p+="<br/>",p+="<h1>"+Globalize.translate("HeaderBenefitsEmbyPremiere")+"</h1>",p+='<div class="paperList" style="margin-bottom:1em;">',p+=o().map(l).join(""),p+="</div>"),r.enablePlayMinute&&(p+="<p>",p+='<paper-button raised class="secondary block btnCloseDialog subdued"><iron-icon icon="play-arrow"></iron-icon><span>'+Globalize.translate("ButtonPlayOneMinute")+"</span></paper-button>",p+="</p>"),p+="</form>",p+="</div>",u.innerHTML=p,document.body.appendChild(u),c(u,r.feature,i,s),e.open(u),$(".btnCloseDialog",u).on("click",function(){e.close(u)}),$(u).on("iron-overlay-closed",function(){window.TabBar&&TabBar.show()}),u.classList.add("inAppPurchaseOverlay")}function o(){var e=[];return e.push({name:Globalize.translate("CoverArt"),icon:"photo",text:Globalize.translate("CoverArtFeatureDescription")}),e.push({name:Globalize.translate("HeaderFreeApps"),icon:"check",text:Globalize.translate("FreeAppsFeatureDescription")}),e.push(Dashboard.capabilities().SupportsSync?{name:Globalize.translate("HeaderMobileSync"),icon:"sync",text:Globalize.translate("MobileSyncFeatureDescription")}:AppInfo.isNativeApp?{name:Globalize.translate("HeaderCloudSync"),icon:"sync",text:Globalize.translate("CloudSyncFeatureDescription")}:{name:Globalize.translate("HeaderCinemaMode"),icon:"movie",text:Globalize.translate("CinemaModeFeatureDescription")}),e}function l(e){var n=!browserInfo.safari,a="";return a+="<paper-icon-item>",a+='<paper-fab mini style="background-color:#52B54B;" icon="'+e.icon+'" item-icon></paper-fab>',a+="<paper-item-body three-line>",n&&(a+='<a class="clearLink" href="https://emby.media/premiere" target="_blank">'),a+="<div>",a+=e.name,a+="</div>",a+='<div secondary style="white-space:normal;">',a+=e.text,a+="</div>",n&&(a+="</a>"),a+="</paper-item-body>",a+="</paper-icon-item>"}function c(e,n,a,t){h=!0,$(".btnPurchase",e).on("click",function(){h=!1,"true"==this.getAttribute("data-email")?u(this.getAttribute("data-feature")):IapManager.beginPurchase(this.getAttribute("data-feature"))}),$(".btnRestorePurchase",e).on("click",function(){h=!1,IapManager.restorePurchase()}),$(e).on("iron-overlay-closed",function(){r();var e=this;h?"playback"==n?Dashboard.alert({message:Globalize.translate("ThankYouForTryingEnjoyOneMinute"),title:Globalize.translate("HeaderTryPlayback"),callback:function(){t(),$(e).remove()}}):(t(),$(e).remove()):$(this).remove()})}function s(e,n,a,t,r){require(["paperdialoghelper","paper-fab","paper-icon-item","paper-item-body"],function(o){window.TabBar&&TabBar.hide(),i(o,e,n,a,t,r),v=t,m=r})}function u(e){if(ConnectionManager.isLoggedIntoConnect()){var n=ConnectionManager.connectUser();if(n&&n.Email)return void IapManager.beginPurchase(e,n.Email)}p(e)}function p(e){require(["prompt"],function(n){n({label:Globalize.translate("TextPleaseEnterYourEmailAddressForSubscription")}).then(function(n){n&&IapManager.beginPurchase(e,n)})})}function d(e,n){if(n.owned){var a=v;a&&g.filter(function(e){return n.id==e.id}).length&&(h=!1,t(),a.resolve())}}function b(n,a){Dashboard.getPluginSecurityInfo().then(function(t){function r(e){return e.IsRegistered?void n():void IapManager.getSubscriptionOptions().then(function(e){var t={title:Globalize.translate("HeaderUnlockSync"),feature:"sync"};s(e,null,t,n,a)})}return t.IsMBSupporter?void n():void e("Sync").then(r,function(){r({})})})}function f(){Events.on(IapManager,"productupdated",d)}var h=!0,g=[],v=null,m=null;window.RegistrationServices={renderPluginInfo:function(){},validateFeature:function(e){return new Promise(function(a,t){"playback"==e?n(e,a,t):"livetv"==e?n(e,a,t):"sync"==e?b(a,t):a()})}},browserInfo.android?requirejs(["cordova/android/iap"],f):requirejs(["cordova/iap"],f)}();