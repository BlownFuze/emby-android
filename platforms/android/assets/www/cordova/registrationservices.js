define(["jQuery"],function(e){function n(e){return ConnectionManager.getRegistrationInfo(e,ApiClient)}function a(e,a,r){if(t())return void a();var i=IapManager.getProductInfo(e),o=i?{enableAppUnlock:!0,id:i.id,price:i.price,feature:e}:null;if(i&&i.owned)return void a();var l=browserInfo.android?"android":"ios";IapManager.isUnlockedOverride(e).then(function(t){function i(n){return n.IsRegistered?void a():void IapManager.getSubscriptionOptions().then(function(n){if(n.filter(function(e){return e.owned}).length>0)return void a();var t={title:Globalize.translate("HeaderUnlockApp"),enablePlayMinute:"playback"==e,feature:e};u(n,o,t,a,r)})}return t?void a():void n(l+"appunlock").then(i,function(){i({})})})}function t(){if(ConnectionManager.isLoggedIntoConnect()){var e=ConnectionManager.connectUser();if(e&&e.IsSupporter)return!0}return!1}function r(){var e=document.querySelector(".inAppPurchaseOverlay");e&&require(["paperdialoghelper"],function(n){n.close(e)})}function i(){v=[],m=null,y=null}function o(n,a,t,i,o,u){r(),v=a.slice(0),t&&v.push(t);var p=n.createDialog({size:"fullscreen-border"});p.classList.add("ui-body-b"),p.classList.add("background-theme-b");var d="";d+='<h2 class="dialogHeader">',d+='<paper-fab icon="arrow-back" mini class="btnCloseDialog" tabindex=-1""></paper-fab>',d+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+i.title+"</div>",d+="</h2>",d+='<div class="editorContent">',d+='<form style="max-width: 800px;margin:auto;">',d+='<p style="margin:2em 0;">',d+=Globalize.translate(t?"MessageUnlockAppWithPurchaseOrSupporter":"MessageUnlockAppWithSupporter"),d+="</p>",d+='<p style="margin:2em 0;">',d+=Globalize.translate("MessageToValidateSupporter"),d+="</p>";for(var b=!1,f=0,h=a.length;h>f;f++)b=!0,d+="<p>",d+='<paper-button raised class="submit block btnPurchase" data-email="true" data-feature="'+a[f].feature+'"><iron-icon icon="check"></iron-icon><span>',d+=a[f].buttonText,d+="</span></paper-button>",d+="</p>";if(t){b=!0;var g=Globalize.translate("ButtonUnlockWithPurchase");t.price&&(g=Globalize.translate("ButtonUnlockPrice",t.price)),d+="<p>",d+='<paper-button raised class="secondary block btnPurchase" data-feature="'+t.feature+'"><iron-icon icon="check"></iron-icon><span>'+g+"</span></paper-button>",d+="</p>"}b&&IapManager.enableRestore(i.feature,a,t)&&(d+="<p>",d+=browserInfo.safari?'<paper-button raised class="secondary block btnRestorePurchase subdued"><iron-icon icon="check"></iron-icon><span>'+Globalize.translate("ButtonRestorePreviousPurchase")+"</span></paper-button>":'<paper-button raised class="secondary block btnRestorePurchase subdued"><span>'+Globalize.translate("AlreadyPaid")+"</span></paper-button>",d+="</p>"),a.length&&(d+="<br/>",d+="<h1>"+Globalize.translate("HeaderBenefitsEmbyPremiere")+"</h1>",d+='<div class="paperList" style="margin-bottom:1em;">',d+=l().map(c).join(""),d+="</div>"),i.enablePlayMinute&&(d+="<p>",d+='<paper-button raised class="secondary block btnCloseDialog subdued"><iron-icon icon="play-arrow"></iron-icon><span>'+Globalize.translate("ButtonPlayOneMinute")+"</span></paper-button>",d+="</p>"),d+="</form>",d+="</div>",p.innerHTML=d,document.body.appendChild(p),s(p,i.feature,o,u),n.open(p),e(".btnCloseDialog",p).on("click",function(){n.close(p)}),e(p).on("iron-overlay-closed",function(){window.TabBar&&TabBar.show()}),p.classList.add("inAppPurchaseOverlay")}function l(){var e=[];return e.push({name:Globalize.translate("CoverArt"),icon:"photo",text:Globalize.translate("CoverArtFeatureDescription")}),e.push({name:Globalize.translate("HeaderFreeApps"),icon:"check",text:Globalize.translate("FreeAppsFeatureDescription")}),e.push(Dashboard.capabilities().SupportsSync?{name:Globalize.translate("HeaderMobileSync"),icon:"sync",text:Globalize.translate("MobileSyncFeatureDescription")}:AppInfo.isNativeApp?{name:Globalize.translate("HeaderCloudSync"),icon:"sync",text:Globalize.translate("CloudSyncFeatureDescription")}:{name:Globalize.translate("HeaderCinemaMode"),icon:"movie",text:Globalize.translate("CinemaModeFeatureDescription")}),e}function c(e){var n=!browserInfo.safari,a="";return a+="<paper-icon-item>",a+='<paper-fab mini style="background-color:#52B54B;" icon="'+e.icon+'" item-icon></paper-fab>',a+="<paper-item-body three-line>",n&&(a+='<a class="clearLink" href="https://emby.media/premiere" target="_blank">'),a+="<div>",a+=e.name,a+="</div>",a+='<div secondary style="white-space:normal;">',a+=e.text,a+="</div>",n&&(a+="</a>"),a+="</paper-item-body>",a+="</paper-icon-item>"}function s(n,a,t,r){g=!0,e(".btnPurchase",n).on("click",function(){g=!1,"true"==this.getAttribute("data-email")?p(this.getAttribute("data-feature")):IapManager.beginPurchase(this.getAttribute("data-feature"))}),e(".btnRestorePurchase",n).on("click",function(){g=!1,IapManager.restorePurchase()}),e(n).on("iron-overlay-closed",function(){i();var n=this;g?"playback"==a?Dashboard.alert({message:Globalize.translate("ThankYouForTryingEnjoyOneMinute"),title:Globalize.translate("HeaderTryPlayback"),callback:function(){r(),e(n).remove()}}):(r(),e(n).remove()):e(this).remove()})}function u(e,n,a,t,r){require(["paperdialoghelper","paper-fab","paper-icon-item","paper-item-body"],function(i){window.TabBar&&TabBar.hide(),o(i,e,n,a,t,r),m=t,y=r})}function p(e){if(ConnectionManager.isLoggedIntoConnect()){var n=ConnectionManager.connectUser();if(n&&n.Email)return void IapManager.beginPurchase(e,n.Email)}d(e)}function d(e){require(["prompt"],function(n){n({label:Globalize.translate("TextPleaseEnterYourEmailAddressForSubscription")}).then(function(n){n&&IapManager.beginPurchase(e,n)})})}function b(e,n){if(n.owned){var a=m;a&&v.filter(function(e){return n.id==e.id}).length&&(g=!1,r(),a.resolve())}}function f(e,a){Dashboard.getPluginSecurityInfo().then(function(t){function r(n){return n.IsRegistered?void e():void IapManager.getSubscriptionOptions().then(function(n){var t={title:Globalize.translate("HeaderUnlockSync"),feature:"sync"};u(n,null,t,e,a)})}return t.IsMBSupporter?void e():void n("Sync").then(r,function(){r({})})})}function h(){Events.on(IapManager,"productupdated",b)}var g=!0,v=[],m=null,y=null;window.RegistrationServices={renderPluginInfo:function(){},validateFeature:function(e){return new Promise(function(n,t){"playback"==e?a(e,n,t):"livetv"==e?a(e,n,t):"sync"==e?f(n,t):n()})}},browserInfo.android?requirejs(["cordova/android/iap"],h):requirejs(["cordova/iap"],h)});