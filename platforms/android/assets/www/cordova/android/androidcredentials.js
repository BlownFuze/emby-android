!function(){function e(){Logger.log("sending updated credentials to ApiClientBridge");for(var e=JSON.stringify(ConnectionManager.credentialProvider().credentials()),n=JSON.parse(e),o=0,i=n.Servers.length;i>o;o++){var t=n.Servers[o];null!=t.DateLastAccessed&&(t.DateLastAccessed=new Date(t.DateLastAccessed).toISOString()),null!=t.DateLastLocalConnection&&(t.DateLastLocalConnection=new Date(t.DateLastLocalConnection).toISOString())}e=JSON.stringify(n),ApiClientBridge.updateCredentials(e)}function n(){Logger.log("initNativeConnectionManager");var e=ConnectionManager.capabilities();ApiClientBridge.init(AppInfo.appName,AppInfo.appVersion,AppInfo.deviceId,AppInfo.deviceName,JSON.stringify(e))}function o(e,n){return new Promise(function(o,i){ApiClientBridge.getDownloadSpeed(e,n),Events.on(AndroidAjax,"downloadspeedresponse",function(e,n){Events.off(AndroidAjax,"downloadspeedresponse"),n?o(n):i()})})}function i(e){e.getDownloadSpeed=function(n){return o(n,e.getUrl("Playback/BitrateTest",{api_key:e.accessToken(),Size:n}))}}Events.on(ConnectionManager,"apiclientcreated",function(e,n){i(n)}),Events.on(ConnectionManager.credentialProvider(),"credentialsupdated",e),e(),n(),window.ApiClient&&i(window.ApiClient),window.AndroidAjax={onResponse:function(e,n){Events.trigger(AndroidAjax,"response"+e,[!0,n])},onError:function(e,n){Events.trigger(AndroidAjax,"response"+e,[!1,n])},onDownloadSpeedResponse:function(e){Events.trigger(AndroidAjax,"downloadspeedresponse",[e])}}}();