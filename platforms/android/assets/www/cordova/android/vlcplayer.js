define(["appSettings"],function(e){function n(n){function i(){Events.trigger(d,"ended")}function r(){Events.trigger(d,"timeupdate")}function t(){Events.trigger(d,"volumechange")}function o(){Events.trigger(d,"playing")}function u(){Events.trigger(d,"pause")}function a(e,n,i){var r={QueueableMediaTypes:i.MediaType,ItemId:i.Id,NowPlayingItem:{},MediaSourceId:n.Id};n.RunTimeTicks&&(r.NowPlayingItem.RunTimeTicks=n.RunTimeTicks);var t=e.url,o=getParameterByName("AudioStreamIndex",t);return o&&(r.AudioStreamIndex=parseInt(o)),null!=MediaPlayer.currentSubtitleStreamIndex&&(r.SubtitleStreamIndex=MediaPlayer.currentSubtitleStreamIndex),r.PlayMethod=e.playMethod,r.LiveStreamId=n.LiveStreamId,r.PlaySessionId=getParameterByName("PlaySessionId",t),n.RunTimeTicks&&n.RunTimeTicks>0&&(r.CanSeek=!0),r}var d=this;d.enableProgressReporting="audio"==n.type;var l={};d.currentTime=function(e){return null!=e?void AndroidVlcPlayer.sendVlcCommand("setposition",e.toString()):l.currentTime},d.duration=function(){return l?l.duration:null},d.stop=function(){AndroidVlcPlayer.sendVlcCommand("stop",null)},d.pause=function(){AndroidVlcPlayer.sendVlcCommand("pause",null)},d.unpause=function(){AndroidVlcPlayer.sendVlcCommand("unpause",null)},d.volume=function(e){return l?null!=e?void AndroidVlcPlayer.sendVlcCommand("setvolume",(100*e).toString()):l.volume:void 0},d.setCurrentSrc=function(i,r,t){if(!i)return void d.destroy();var o=i.url,u=o.indexOf("#t="),c=0;if(-1!=u&&(c=o.substring(u+3),c=1e3*parseFloat(c),o=o.split("#")[0]),"audio"==n.type)AndroidVlcPlayer.playAudioVlc(o,JSON.stringify(r),JSON.stringify(t),n.poster);else{{var s=a(i,t,r),p=ApiClient.serverAddress(),m=t.MediaStreams.filter(function(e){return"Video"==e.Type})[0],y=m?m.Width:null;m?m.Height:null}require(["qualityoptions"],function(n){var i=e.maxStreamingBitrate(),u=n.getVideoQualityOptions(i,y).map(function(e){return{Name:e.name,Value:e.bitrate+"-"+e.maxHeight}});MediaPlayer.getDeviceProfile().then(function(e){var n=MediaController.playbackTimeLimitMs||0;AndroidVlcPlayer.playVideoVlc(o,c,r.Name,JSON.stringify(r),JSON.stringify(t),JSON.stringify(s),ApiClient.serverInfo().Id,p,ApiClient.appName(),ApiClient.appVersion(),ApiClient.deviceId(),ApiClient.deviceName(),ApiClient.getCurrentUserId(),ApiClient.accessToken(),JSON.stringify(e),JSON.stringify(u),n),l.currentSrc=o,d.report("playing",null,c,!1,100)})})}},d.currentSrc=function(){return l?l.currentSrc:void 0},d.paused=function(){return l?l.paused:!1},d.cleanup=function(e){e!==!1&&AndroidVlcPlayer.destroyVlc(),l={}},d.enableCustomVideoControls=function(){return!1},d.report=function(e,n,a,d,c){var s=l;s.duration=n,s.currentTime=a,s.paused=d,s.volume=(c||0)/100,"playbackstop"==e?i():"volumechange"==e?t():"positionchange"==e?r():"paused"==e?u():"unpaused"==e?o():"playing"==e&&o()},d.init=function(){return Promise.resolve()},d.onActivityClosed=function(e,n,i){l.currentTime=i,e&&MediaPlayer.stop(!1),d.report("playbackstop",l.duration,i,!1,100)},window.VlcAudio&&(window.AudioRenderer.Current=d),window.VideoRenderer.Current=d}window.VlcAudio&&(window.AudioRenderer=function(e){return e=e||{},e.type="audio",new n(e)}),window.VideoRenderer=function(e){return e=e||{},e.type="video",new n(e)}});