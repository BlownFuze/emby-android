!function(){function e(){return!1}function t(t,a){if(!t.NowPlayingItem)return void l();var n=MediaController.getPlayerInfo().isLocalPlayer||!1;if(!n||e()){"init"==a&&(a="positionchange");var i=t.PlayState||{},o=MediaController.getNowPlayingNameHtml(t.NowPlayingItem)||"",g=o.split("<br/>"),r=1==g.length?"":g[0],y=g[g.length-1];if("Video"==t.NowPlayingItem.MediaType&&g.length>1){var c=r;r=y,y=c}var m=t.NowPlayingItem.Album||"",p=t.NowPlayingItem.Id,d=t.NowPlayingItem.RunTimeTicks?t.NowPlayingItem.RunTimeTicks/1e4:0,I=i.PositionTicks?i.PositionTicks/1e4:0,P=i.IsPaused||!1,u=i.CanSeek||!1,h="",f=400,v=t.NowPlayingItem;v.PrimaryImageTag?h=ApiClient.getScaledImageUrl(v.PrimaryImageItemId,{type:"Primary",height:f,tag:v.PrimaryImageTag}):v.ThumbImageTag?h=ApiClient.getScaledImageUrl(v.ThumbImageItemId,{type:"Thumb",height:f,tag:v.ThumbImageTag}):v.BackdropImageTag&&(h=ApiClient.getScaledImageUrl(v.BackdropItemId,{type:"Backdrop",height:f,tag:v.BackdropImageTag,index:0})),"positionchange"==a&&s||(MainActivity.updateMediaSession(a,n,p,y,r,m,parseInt(d),parseInt(I),h,u,P),s=(new Date).getTime())}}function a(e,a){t(a,e.type)}function n(e,t){Logger.log("nowplaying event: "+e.type);var n=this;n.beginPlayerUpdates(),a.call(n,e,t)}function i(e){Logger.log("nowplaying event: "+e.type);var t=this;t.endPlayerUpdates(),l()}function o(){r&&(Events.off(r,"playbackstart",n),Events.off(r,"playbackstop",i),Events.off(r,"playstatechange",a),Events.off(r,"positionchange",a),r.endPlayerUpdates(),r=null,l())}function l(){MainActivity.hideMediaSession(),s=0}function g(t){o(),(!t.isLocalPlayer||e())&&(r=t,Logger.log("binding remotecontrols to "+t.name),t.getPlayerState().then(function(e){e.NowPlayingItem&&t.beginPlayerUpdates(),a.call(t,{type:"init"},e)}),Events.on(r,"playbackstart",n),Events.on(r,"playbackstop",i),Events.on(r,"playstatechange",a),Events.on(r,"positionchange",a))}var r,s=0;Logger.log("binding remotecontrols to MediaController"),Events.on(MediaController,"playerchange",function(){g(MediaController.getCurrentPlayer())}),g(MediaController.getCurrentPlayer())}();