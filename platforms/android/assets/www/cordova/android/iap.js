!function(){function e(e,n,t){f=f.filter(function(n){return n.id!=e});var r={id:e,owned:n,price:t};f.push(r),Events.trigger(IapManager,"productupdated",[r])}function n(e){var n;n="embypremieremonthly"==e?NativeIapManager.getPremiereMonthlySku():NativeIapManager.getUnlockProductSku();var t=f.filter(function(e){return e.id==n});return t.length?t[0]:null}function t(){a()}function r(e,n){return"embypremieremonthly"==e?MainActivity.purchasePremiereMonthly(n):MainActivity.purchaseUnlock()}function i(e){e===!0?a():e&&ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Appstore/Register"),data:{Parameters:JSON.stringify(e)}}).then(function(){a()},function(){a()})}function a(){NativeIapManager.getPurchaseInfos("window.IapManager.updateProduct")}function o(){return new Promise(function(e){var t=[];t.push({feature:"embypremieremonthly",buttonText:"EmbyPremiereMonthly"}),t=t.filter(function(e){return null!=n(e.feature)}).map(function(e){var t=n(e.feature);return e.buttonText=Globalize.translate(e.buttonText,t.price),e.owned=t.owned,e}),e(t)})}function u(e){return"playback"==e||"livetv"==e?c():new Promise(function(e){e(!1)})}function c(){return d(ConnectionManager.deviceId()).then(function(e){return e?!0:d(device.uuid).then(function(e){return e?!0:d(MainActivity.getAndroidDeviceId()).then(function(e){if(e)return!0;var n=MainActivity.getLegacyDeviceId();return n?d(n):!1})})})}function d(e){var n="oldapp3-"+e,t=appStorage.getItem(n);return t?new Promise(function(e){e("true"==t)}):fetch("http://mb3admin.com/admin/service/statistics/appAccess?application=AndroidV1&deviceId="+e,{method:"GET"}).then(function(e){return e.status<400?(appStorage.setItem(n,"true"),!0):!1},function(){return!1})}function p(e){return"playback"==e||"livetv"==e}function l(){var e=Globalize.translate("AlreadyPaidHelp1","apps@emby.media");e+="<br/><br/>"+Globalize.translate("AlreadyPaidHelp2"),Dashboard.confirm(e,Globalize.translate("AlreadyPaid"),function(e){e&&s()})}function s(){var e=ApiClient.serverInfo()||{},n=e.Id||"Unknown",t="Please assist in restoring my previous purchase. "+n+"|"+ConnectionManager.deviceId();MainActivity.sendEmail("apps@emby.media","Android Activation",t)}var f=[];window.IapManager={getProductInfo:n,updateProduct:e,beginPurchase:r,onPurchaseComplete:i,getSubscriptionOptions:o,onStoreReady:t,isUnlockedOverride:u,restorePurchase:l,enableRestore:p},NativeIapManager.initStore()}();