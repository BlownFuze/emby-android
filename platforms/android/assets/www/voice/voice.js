define(["paperdialoghelper"],function(e){function n(e){for(var n,o,a=e.length;0!==a;)o=Math.floor(Math.random()*a),a-=1,n=e[a],e[a]=e[o],e[o]=n;return e}function o(){return new Promise(function(e){var o=[];o.push("play my latest episodes"),o.push("play next up"),o.push("shuffle my favorite songs"),o.push("show my tv guide"),o.push("pull up my recordings"),o.push("control chromecast"),o.push("control [device name]"),o.push("turn on display mirroring"),o.push("turn off display mirroring"),o.push("toggle display mirroring"),e(n(o))})}function a(n){return new Promise(function(o,a){require(["voice/textprocessor-en-us.js"],function(d){var u=d(n);switch(u.action){case"show":t(u);break;case"play":c(u);break;case"shuffle":c(u,!0);break;case"search":c(u);break;case"control":l(u);break;case"enable":i(u);break;case"disable":r(u);break;case"toggle":s(u);break;default:return void a()}var p=g;p&&e.close(p),o()})})}function t(e){return"tvguide"==e.category?void Dashboard.navigate("livetv.html?tab=1"):"recordings"==e.category?void Dashboard.navigate("livetv.html?tab=3"):void 0}function i(e){var n=e.what.toLowerCase();-1!=n.indexOf("mirror")&&MediaController.enableDisplayMirroring(!0)}function r(e){var n=e.what.toLowerCase();-1!=n.indexOf("mirror")&&MediaController.enableDisplayMirroring(!1)}function s(e){var n=e.what.toLowerCase();-1!=n.indexOf("mirror")&&MediaController.toggleDisplayMirroring()}function l(e){MediaController.trySetActiveDeviceName(e.what)}function c(e,n){var o={Limit:e.limit||100,UserId:e.userId,ExcludeLocationTypes:"Virtual"};return"nextup"==e.category?void ApiClient.getNextUpEpisodes(o).then(function(e){d(e.Items,n)}):(n&&(e.sortby=e.sortby?"Random,"+e.sortby:"Random"),o.SortBy=e.sortby,o.SortOrder=e.sortorder,o.Recursive=!0,-1!=e.filters.indexOf("unplayed")&&(o.IsPlayed=!1),-1!=e.filters.indexOf("played")&&(o.IsPlayed=!0),-1!=e.filters.indexOf("favorite")&&(o.Filters="IsFavorite"),e.itemType&&(o.IncludeItemTypes=e.itemType),void ApiClient.getItems(Dashboard.getCurrentUserId(),o).then(function(e){d(e.Items,n)}))}function d(e,o){o&&(e=n(e)),e=e.map(function(e){return e.Id}),e.length?MediaController.play({ids:e}):Dashboard.alert({message:Globalize.translate("MessageNoItemsFound")})}function u(e,n){n.length=Math.min(n.length,4),n=n.map(function(e){return'<div class="exampleCommand"><span class="exampleCommandText">"'+e+'"</span></div>'}).join(""),$(".exampleCommands",e).html(n)}function p(){var n=e.createDialog({size:"medium",removeOnClose:!0});n.classList.add("ui-body-b"),n.classList.add("background-theme-b");var a="";a+='<h2 class="dialogHeader">',a+='<paper-fab icon="arrow-back" mini class="btnCancelVoiceInput" tabindex="-1"></paper-fab>',a+="</h2>",a+="<div>";var t=o();a+='<div class="voiceHelpContent">',a+='<div class="defaultVoiceHelp">',a+="<h1>"+Globalize.translate("HeaderSaySomethingLike")+"</h1>",a+='<div class="exampleCommands">',a+="</div>",a+="</div>",a+='<div class="unrecognizedCommand" style="display:none;">',a+="<h1>"+Globalize.translate("HeaderYouSaid")+"</h1>",a+='<p class="exampleCommand voiceInputContainer"><i class="fa fa-quote-left"></i><span class="voiceInputText exampleCommandText"></span><i class="fa fa-quote-right"></i></p>',a+="<p>"+Globalize.translate("MessageWeDidntRecognizeCommand")+"</p>",a+="<br/>",a+='<paper-button raised class="submit block btnRetry"><iron-icon icon="mic"></iron-icon><span>'+Globalize.translate("ButtonTryAgain")+"</span></paper-button>",a+='<p class="blockedMessage" style="display:none;">'+Globalize.translate("MessageIfYouBlockedVoice")+"<br/><br/></p>",a+="</div>",a+='<paper-button raised class="block btnCancelVoiceInput" style="background-color:#444;"><iron-icon icon="close"></iron-icon><span>'+Globalize.translate("ButtonCancel")+"</span></paper-button>",a+="</div>",a+="</div>",n.innerHTML=a,document.body.appendChild(n),e.open(n),g=n,n.addEventListener("iron-overlay-closed",function(){g=null}),$(".btnCancelVoiceInput",n).on("click",function(){f(),e.close(n)}),$(".btnRetry",n).on("click",function(){$(".unrecognizedCommand").hide(),$(".defaultVoiceHelp").show(),b(!1)}),t.then(function(e){u(n.querySelector(".voiceHelpContent"),e)})}function m(){$(".unrecognizedCommand").show(),$(".defaultVoiceHelp").hide()}function f(){var e=v;e&&(e.cancelled=!0,e.abort(),v=null)}function h(e,n){$(".voiceInputText").html(e),e||AppInfo.isNativeApp?$(".blockedMessage").hide():$(".blockedMessage").show(),e?a(e).catch(m):n||m()}function b(e){f();var n=new(window.SpeechRecognition||window.webkitSpeechRecognition);n.onresult=function(e){e.results.length>0&&h(e.results[0][0].transcript||"")},n.onerror=function(){h("",n.cancelled)},n.onnomatch=function(){h("",n.cancelled)},n.start(),v=n,e!==!1&&require(["paper-fab","css!voice/voice.css"],p)}var v,g;window.VoiceInputManager={isSupported:function(){return AppInfo.isNativeApp?!1:window.SpeechRecognition||window.webkitSpeechRecognition},startListening:b}});