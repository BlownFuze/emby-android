!function(){function e(e){for(var n,o,t=e.length;0!==t;)o=Math.floor(Math.random()*t),t-=1,n=e[t],e[t]=e[o],e[o]=n;return e}function n(){var n=DeferredBuilder.Deferred(),o=[];return o.push("play my latest episodes"),o.push("play next up"),o.push("shuffle my favorite songs"),o.push("show my tv guide"),o.push("pull up my recordings"),o.push("control chromecast"),o.push("control [device name]"),o.push("turn on display mirroring"),o.push("turn off display mirroring"),o.push("toggle display mirroring"),n.resolveWith(null,[e(o)]),n.promise()}function o(e){var n=DeferredBuilder.Deferred();return require(["voice/textprocessor-en-us.js"],function(o){var c=o(e);switch(c.action){case"show":t(c);break;case"play":l(c);break;case"shuffle":l(c,!0);break;case"search":l(c);break;case"control":s(c);break;case"enable":i(c);break;case"disable":a(c);break;case"toggle":r(c);break;default:return void n.reject()}n.resolve()}),n.promise()}function t(e){return"tvguide"==e.category?void Dashboard.navigate("livetv.html?tab=1"):"recordings"==e.category?void Dashboard.navigate("livetv.html?tab=3"):void 0}function i(e){var n=e.what.toLowerCase();-1!=n.indexOf("mirror")&&MediaController.enableDisplayMirroring(!0)}function a(e){var n=e.what.toLowerCase();-1!=n.indexOf("mirror")&&MediaController.enableDisplayMirroring(!1)}function r(e){var n=e.what.toLowerCase();-1!=n.indexOf("mirror")&&MediaController.toggleDisplayMirroring()}function s(e){MediaController.trySetActiveDeviceName(e.what)}function l(e,n){var o={Limit:e.limit||100,UserId:e.userId,ExcludeLocationTypes:"Virtual"};return"nextup"==e.category?void ApiClient.getNextUpEpisodes(o).then(function(e){c(e.Items,n)}):(n&&(e.sortby=e.sortby?"Random,"+e.sortby:"Random"),o.SortBy=e.sortby,o.SortOrder=e.sortorder,o.Recursive=!0,-1!=e.filters.indexOf("unplayed")&&(o.IsPlayed=!1),-1!=e.filters.indexOf("played")&&(o.IsPlayed=!0),-1!=e.filters.indexOf("favorite")&&(o.Filters="IsFavorite"),e.itemType&&(o.IncludeItemTypes=e.itemType),void ApiClient.getItems(Dashboard.getCurrentUserId(),o).then(function(e){c(e.Items,n)}))}function c(n,o){o&&(n=e(n)),n=n.map(function(e){return e.Id}),n.length?MediaController.play({ids:n}):Dashboard.alert({message:Globalize.translate("MessageNoItemsFound")})}function d(e,n){n.length=Math.min(n.length,4),n=n.map(function(e){return'<div class="exampleCommand"><span class="exampleCommandText">"'+e+'"</span></div>'}).join(""),$(".exampleCommands",e).html(n)}function u(){var e=$(".voiceInputHelp");if(e.length)return $(".unrecognizedCommand").hide(),void $(".defaultVoiceHelp").show();var o="",t=n();o+='<div class="voiceInputHelp">',o+='<div class="voiceInputHelpInner">',o+='<div class="voiceHelpContent">',o+='<div class="defaultVoiceHelp">',o+="<h1>"+Globalize.translate("HeaderSaySomethingLike")+"</h1>",o+='<div class="exampleCommands">',o+="</div>",o+="</div>",o+='<div class="unrecognizedCommand" style="display:none;">',o+="<h1>"+Globalize.translate("HeaderYouSaid")+"</h1>",o+='<p class="exampleCommand voiceInputContainer"><i class="fa fa-quote-left"></i><span class="voiceInputText exampleCommandText"></span><i class="fa fa-quote-right"></i></p>',o+="<p>"+Globalize.translate("MessageWeDidntRecognizeCommand")+"</p>",o+="<br/>",o+='<paper-button raised class="submit block btnRetry"><iron-icon icon="mic"></iron-icon><span>'+Globalize.translate("ButtonTryAgain")+"</span></paper-button>",o+='<p class="blockedMessage" style="display:none;">'+Globalize.translate("MessageIfYouBlockedVoice")+"<br/><br/></p>",o+="</div>",o+='<paper-button raised class="block btnCancel" style="background-color:#444;"><iron-icon icon="close"></iron-icon><span>'+Globalize.translate("ButtonCancel")+"</span></paper-button>",o+="</div>",o+="</div>",o+="</div>",$(document.body).append(o),e=$(".voiceInputHelp"),t.then(function(n){d(e,n)}),$(".btnCancel",e).on("click",f),$(".btnRetry",e).on("click",g)}function p(){$(".unrecognizedCommand").show(),$(".defaultVoiceHelp").hide()}function m(){$(".voiceInputHelp").remove()}function f(){v(),m()}function v(){var e=y;e&&(e.abort(),y=null)}function h(e){$(".voiceInputText").html(e),e||AppInfo.isNativeApp?$(".blockedMessage").hide():$(".blockedMessage").show(),o(e).then(m,p)}function g(){v(),require(["css!voice/voice.css"]),b()}function b(){var e=new(window.SpeechRecognition||window.webkitSpeechRecognition);e.onresult=function(e){e.results.length>0&&h(e.results[0][0].transcript||"")},e.onerror=function(){h("")},e.onnomatch=function(){h("")},e.start(),y=e,u()}var y;window.VoiceInputManager={isSupported:function(){return AppInfo.isNativeApp&&window.device&&-1!=(device.platform||"").toLowerCase().indexOf("amazon")?!1:window.SpeechRecognition||window.webkitSpeechRecognition},startListening:g}}();