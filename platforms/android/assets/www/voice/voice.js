!function(){function e(e){for(var n,o,t=e.length;0!==t;)o=Math.floor(Math.random()*t),t-=1,n=e[t],e[t]=e[o],e[o]=n;return e}function n(){return new Promise(function(n){var o=[];o.push("play my latest episodes"),o.push("play next up"),o.push("shuffle my favorite songs"),o.push("show my tv guide"),o.push("pull up my recordings"),o.push("control chromecast"),o.push("control [device name]"),o.push("turn on display mirroring"),o.push("turn off display mirroring"),o.push("toggle display mirroring"),n(e(o))})}function o(e){return new Promise(function(n,o){require(["voice/textprocessor-en-us.js"],function(c){var d=c(e);switch(d.action){case"show":t(d);break;case"play":l(d);break;case"shuffle":l(d,!0);break;case"search":l(d);break;case"control":s(d);break;case"enable":a(d);break;case"disable":i(d);break;case"toggle":r(d);break;default:return void o()}var p=b;p&&PaperDialogHelper.close(p),n()})})}function t(e){return"tvguide"==e.category?void Dashboard.navigate("livetv.html?tab=1"):"recordings"==e.category?void Dashboard.navigate("livetv.html?tab=3"):void 0}function a(e){var n=e.what.toLowerCase();-1!=n.indexOf("mirror")&&MediaController.enableDisplayMirroring(!0)}function i(e){var n=e.what.toLowerCase();-1!=n.indexOf("mirror")&&MediaController.enableDisplayMirroring(!1)}function r(e){var n=e.what.toLowerCase();-1!=n.indexOf("mirror")&&MediaController.toggleDisplayMirroring()}function s(e){MediaController.trySetActiveDeviceName(e.what)}function l(e,n){var o={Limit:e.limit||100,UserId:e.userId,ExcludeLocationTypes:"Virtual"};return"nextup"==e.category?void ApiClient.getNextUpEpisodes(o).then(function(e){c(e.Items,n)}):(n&&(e.sortby=e.sortby?"Random,"+e.sortby:"Random"),o.SortBy=e.sortby,o.SortOrder=e.sortorder,o.Recursive=!0,-1!=e.filters.indexOf("unplayed")&&(o.IsPlayed=!1),-1!=e.filters.indexOf("played")&&(o.IsPlayed=!0),-1!=e.filters.indexOf("favorite")&&(o.Filters="IsFavorite"),e.itemType&&(o.IncludeItemTypes=e.itemType),void ApiClient.getItems(Dashboard.getCurrentUserId(),o).then(function(e){c(e.Items,n)}))}function c(n,o){o&&(n=e(n)),n=n.map(function(e){return e.Id}),n.length?MediaController.play({ids:n}):Dashboard.alert({message:Globalize.translate("MessageNoItemsFound")})}function d(e,n){n.length=Math.min(n.length,4),n=n.map(function(e){return'<div class="exampleCommand"><span class="exampleCommandText">"'+e+'"</span></div>'}).join(""),$(".exampleCommands",e).html(n)}function p(e){var o=e.createDialog({size:"medium",removeOnClose:!0}),t="";t+='<h2 class="dialogHeader">',t+='<paper-fab icon="arrow-back" mini class="btnCancelVoiceInput"></paper-fab>',t+="</h2>",t+="<div>";var a=n();t+='<div class="voiceHelpContent">',t+='<div class="defaultVoiceHelp">',t+="<h1>"+Globalize.translate("HeaderSaySomethingLike")+"</h1>",t+='<div class="exampleCommands">',t+="</div>",t+="</div>",t+='<div class="unrecognizedCommand" style="display:none;">',t+="<h1>"+Globalize.translate("HeaderYouSaid")+"</h1>",t+='<p class="exampleCommand voiceInputContainer"><i class="fa fa-quote-left"></i><span class="voiceInputText exampleCommandText"></span><i class="fa fa-quote-right"></i></p>',t+="<p>"+Globalize.translate("MessageWeDidntRecognizeCommand")+"</p>",t+="<br/>",t+='<paper-button raised class="submit block btnRetry"><iron-icon icon="mic"></iron-icon><span>'+Globalize.translate("ButtonTryAgain")+"</span></paper-button>",t+='<p class="blockedMessage" style="display:none;">'+Globalize.translate("MessageIfYouBlockedVoice")+"<br/><br/></p>",t+="</div>",t+='<paper-button raised class="block btnCancelVoiceInput" style="background-color:#444;"><iron-icon icon="close"></iron-icon><span>'+Globalize.translate("ButtonCancel")+"</span></paper-button>",t+="</div>",t+="</div>",o.innerHTML=t,document.body.appendChild(o),e.open(o),b=o,o.addEventListener("iron-overlay-closed",function(){b=null}),$(".btnCancelVoiceInput",o).on("click",function(){m(),e.close(o)}),$(".btnRetry",o).on("click",function(){$(".unrecognizedCommand").hide(),$(".defaultVoiceHelp").show(),h(!1)}),a.then(function(e){d(o.querySelector(".voiceHelpContent"),e)})}function u(){$(".unrecognizedCommand").show(),$(".defaultVoiceHelp").hide()}function m(){var e=v;e&&(e.cancelled=!0,e.abort(),v=null)}function f(e,n){$(".voiceInputText").html(e),e||AppInfo.isNativeApp?$(".blockedMessage").hide():$(".blockedMessage").show(),e?o(e).catch(u):n||u()}function h(e){m();var n=new(window.SpeechRecognition||window.webkitSpeechRecognition);n.onresult=function(e){e.results.length>0&&f(e.results[0][0].transcript||"")},n.onerror=function(){f("",n.cancelled)},n.onnomatch=function(){f("",n.cancelled)},n.start(),v=n,e!==!1&&require(["components/paperdialoghelper","paper-fab","css!voice/voice.css"],p)}var v,b;window.VoiceInputManager={isSupported:function(){return AppInfo.isNativeApp?!1:window.SpeechRecognition||window.webkitSpeechRecognition},startListening:h}}();