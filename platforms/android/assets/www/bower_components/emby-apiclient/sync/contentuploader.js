define(["localassetmanager"],function(){return function(e){function n(e,n){return e.filter(function(e){return e?0==n.FilesUploaded.filter(function(n){return t(e)==n.Id}).length:!1})}function t(e){return CryptoJS.SHA1(e+"1").toString()}function r(e,n,t,i,u,a){var c=e.length;return n>=c?void u():void o(e[n],i).then(function(){r(e,n+1,t,i,u,a)},function(){r(e,n+1,t,i,u,a)})}function o(e,n){return new Promise(function(r,o){require(["fileupload","cryptojs-sha1"],function(i){var u="camera image "+(new Date).getTime(),a=n.getUrl("Devices/CameraUploads",{DeviceId:n.deviceId(),Name:u,Album:"Camera Roll",Id:t(e),api_key:n.accessToken()});(new i).upload(e,u,a).then(r,o)})})}var i=this;i.uploadImages=function(t){return LocalAssetManager.getCameraPhotos().then(function(o){if(!o.length)return Promise.resolve();var i=e.getApiClient(t.Id);return i.getContentUploadHistory().then(function(e){return o=n(o,e),new Promise(function(e,n){r(o,0,t,i,e,n)})},function(){return Promise.resolve()})})}}});