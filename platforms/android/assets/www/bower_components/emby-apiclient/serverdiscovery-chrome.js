define([],function(){function e(e){for(var n=new ArrayBuffer(2*e.length),t=new Uint16Array(n),r=0,o=e.length;o>r;r++)t[r]=e.charCodeAt(r);return n}function n(e){return String.fromCharCode.apply(null,new Uint16Array(e))}function t(e){return null!=e&&null!=e.resultCode?e.resultCode:e}function r(e){try{chrome.sockets.udp.close(e)}catch(n){}}function o(o){return new Promise(function(c){function u(){c(d),l&&(f.sockets.udp.onReceive.removeListener(i),r(l))}function s(){a=setTimeout(u,o)}function i(e){try{if(null!=e&&e.socketId==l){var t=n(e.data),r=JSON.parse(t);r.RemoteAddress=e.remoteAddress,e.remotePort&&(r.RemoteAddress+=":"+e.remotePort),d.push(r)}}catch(o){}}var d=[],f=window.chrome;if(!f)return void c(d);if(!f.sockets)return void c(d);var a,l,m=7359;s(),f.sockets.udp.create(function(n){n&&n.socketId&&(l=n.socketId,f.sockets.udp.bind(n.socketId,"0.0.0.0",0,function(r){if(0==t(r)){var o=e("who is EmbyServer?");f.sockets.udp.send(n.socketId,o,"255.255.255.255",m,function(e){0!=t(e)||f.sockets.udp.onReceive.addListener(i)})}}))})})}return{findServers:function(e){return new Promise(function(n){try{o(e).then(n,function(){n([])})}catch(t){n([])}})}}});