define(["shell","dialogHelper","loading","layoutManager","connectionManager","embyRouter","globalize","emby-checkbox","emby-input","paper-icon-button-light","emby-select","material-icons","css!./../formdialog","emby-button"],function(e,t,n,o,l,i,a){function r(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function s(e){n.show();var t=r(this,"dialog"),o=t.querySelector("#selectCollectionToAddTo").value,i=l.getApiClient(y);return o?u(i,t,o):c(i,t),e.preventDefault(),!1}function c(e,o){var l=e.getUrl("Collections",{Name:o.querySelector("#txtNewCollectionName").value,IsLocked:!o.querySelector("#chkEnableInternetMetadata").checked,Ids:o.querySelector(".fldSelectedItemIds").value||""});e.ajax({type:"POST",url:l,dataType:"json"}).then(function(l){n.hide();var i=l.Id;t.close(o),d(e,i)})}function d(e,t){e.getItem(e.getCurrentUserId(),t).then(function(e){i.showItem(e)})}function u(e,o,l){var i=e.getUrl("Collections/"+l+"/Items",{Ids:o.querySelector(".fldSelectedItemIds").value||""});e.ajax({type:"POST",url:i}).then(function(){n.hide(),t.close(o),require(["toast"],function(e){e(a.translate("sharedcomponents#MessageItemsAdded"))})})}function m(e){e.dispatchEvent(new CustomEvent("change",{}))}function p(e){n.show();var t=e.querySelector("#selectCollectionToAddTo");e.querySelector(".newCollectionInfo").classList.add("hide");var o={Recursive:!0,IncludeItemTypes:"BoxSet",SortBy:"SortName"},i=l.getApiClient(y);i.getItems(i.getCurrentUserId(),o).then(function(e){var o="";o+='<option value="">'+a.translate("sharedcomponents#OptionNew")+"</option>",o+=e.Items.map(function(e){return'<option value="'+e.Id+'">'+e.Name+"</option>"}),t.innerHTML=o,t.value="",m(t),n.hide()})}function v(){var e="";return e+='<div class="dialogContent smoothScrollY" style="padding-top:2em;">',e+='<div class="dialogContentInner centeredContent">',e+='<form class="newCollectionForm" style="margin:auto;">',e+="<div>",e+=a.translate("sharedcomponents#NewCollectionHelp"),e+="</div>",e+='<div class="fldSelectCollection">',e+="<br/>",e+="<br/>",e+='<select is="emby-select" label="'+a.translate("sharedcomponents#LabelCollection")+'" id="selectCollectionToAddTo" autofocus></select>',e+="</div>",e+='<div class="newCollectionInfo">',e+='<div class="inputContainer">',e+='<input is="emby-input" type="text" id="txtNewCollectionName" required="required" label="'+a.translate("sharedcomponents#LabelName")+'" />',e+='<div class="fieldDescription">'+a.translate("sharedcomponents#NewCollectionNameExample")+"</div>",e+="</div>",e+='<label class="checkboxContainer">',e+='<input is="emby-checkbox" type="checkbox" id="chkEnableInternetMetadata" />',e+="<span>"+a.translate("sharedcomponents#SearchForCollectionInternetMetadata")+"</span>",e+="</label>",e+="</div>",e+="<div>",e+='<button is="emby-button" type="submit" class="raised btnSubmit block">'+a.translate("sharedcomponents#ButtonOk")+"</button>",e+="</div>",e+='<input type="hidden" class="fldSelectedItemIds" />',e+="</form>",e+="</div>",e+="</div>"}function f(e,t){if(e.querySelector("#selectCollectionToAddTo").addEventListener("change",function(){this.value?(e.querySelector(".newCollectionInfo").classList.add("hide"),e.querySelector("#txtNewCollectionName").removeAttribute("required")):(e.querySelector(".newCollectionInfo").classList.remove("hide"),e.querySelector("#txtNewCollectionName").setAttribute("required","required"))}),e.querySelector("form").addEventListener("submit",s),e.querySelector(".fldSelectedItemIds",e).value=t.join(","),t.length)e.querySelector(".fldSelectCollection").classList.remove("hide"),p(e);else{e.querySelector(".fldSelectCollection").classList.add("hide");var n=e.querySelector("#selectCollectionToAddTo");n.innerHTML="",n.value="",m(n)}}function h(e,t,n){require(["scrollHelper"],function(o){var l=n?"on":"off";o.centerFocus[l](e,t)})}function b(){var e=this;e.show=function(e){var n=e.items||{};y=e.serverId;var l={removeOnClose:!0,scrollY:!1};l.size=o.tv?"fullscreen":"small";var i=t.createDialog(l);i.classList.add("formDialog");var r="",s=a.translate(n.length?"sharedcomponents#HeaderAddToCollection":"sharedcomponents#NewCollection");return r+='<div class="dialogHeader">',r+='<button is="paper-icon-button-light" class="btnCancel autoSize" tabindex="-1"><i class="md-icon">&#xE5C4;</i></button>',r+='<div class="dialogHeaderTitle">',r+=s,r+="</div>",r+='<a class="btnHelp" href="https://github.com/MediaBrowser/Wiki/wiki/Collections" target="_blank" style="margin-left:auto;margin-right:.5em;display:inline-block;padding:.25em;display:flex;align-items:center;" title="'+a.translate("sharedcomponents#Help")+'"><i class="md-icon">info</i><span style="margin-left:.25em;">'+a.translate("sharedcomponents#Help")+"</span></a>",r+="</div>",r+=v(),i.innerHTML=r,document.body.appendChild(i),f(i,n),i.querySelector(".btnCancel").addEventListener("click",function(){t.close(i)}),o.tv&&h(i.querySelector(".dialogContent"),!1,!0),new Promise(function(e){o.tv&&h(i.querySelector(".dialogContent"),!1,!1),i.addEventListener("close",e),t.open(i)})}}var y;return b});