define(["apphost","globalize","connectionManager"],function(e,n,r){function t(t){var o=t.item,i=o.ServerId,a=r.getApiClient(i);return a.getCurrentUser().then(function(r){var t=[];return o.CanDownload&&r.Policy.EnableContentDownloading&&e.supports("filedownload")&&t.push({name:n.translate("sharedcomponents#Download"),id:"download"}),"Timer"!=o.Type&&r.Policy.EnablePublicSharing&&e.supports("sharing")&&t.push({name:n.translate("Share"),id:"share"}),t})}function o(e,n){var t=e.Id,o=e.ServerId,i=r.getApiClient(o);return new Promise(function(e,r){switch(n){case"download":require(["fileDownloader"],function(e){var n=i.getUrl("Items/"+t+"/Download",{api_key:i.accessToken()});e.download([{url:n,itemId:t,serverId:o}]),r()});break;case"share":require(["sharingmanager"],function(e){e.showMenu({serverId:o,itemId:t}).then(r)})}})}function i(e){return t(e).then(function(n){return new Promise(function(r,t){require(["actionsheet"],function(i){i.show({items:n}).then(function(n){o(e.item,n).then(r)},t)})})})}return{getCommands:t,show:i}});