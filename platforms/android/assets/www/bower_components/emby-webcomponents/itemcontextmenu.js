define(["apphost","globalize","connectionManager"],function(e,n,r){function t(t){var a=t.item,o=a.ServerId,i=r.getApiClient(o);return i.getCurrentUser().then(function(r){var t=[];return a.CanDownload&&r.Policy.EnableContentDownloading&&e.supports("filedownload")&&t.push({name:n.translate("sharedcomponents#Download"),id:"download"}),r.Policy.IsAdministrator&&t.push({name:n.translate("Refresh"),id:"refresh"}),"Timer"!=a.Type&&r.Policy.EnablePublicSharing&&e.supports("sharing")&&t.push({name:n.translate("Share"),id:"share"}),t})}function a(e,n){var t=e.Id,a=e.ServerId,i=r.getApiClient(a);return new Promise(function(e,r){switch(n){case"download":require(["fileDownloader"],function(e){var n=i.getUrl("Items/"+t+"/Download",{api_key:i.accessToken()});e.download([{url:n,itemId:t,serverId:a}]),r()});break;case"refresh":o(i,t);break;case"share":require(["sharingmanager"],function(e){e.showMenu({serverId:a,itemId:t}).then(r)})}})}function o(e,r){e.refreshItem(r,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!0}),require(["toast"],function(e){e(n.translate("sharedcomponents#RefreshQueued"))})}function i(e){return t(e).then(function(n){return new Promise(function(r,t){require(["actionsheet"],function(o){o.show({items:n}).then(function(n){a(e.item,n).then(r)},t)})})})}return{getCommands:t,show:i}});