define(["apphost","globalize","connectionManager"],function(e,n,t){function r(r){var a=r.item,o=a.ServerId,s=t.getApiClient(o);return s.getCurrentUser().then(function(t){var r=[];return a.CanDelete&&r.push({name:n.translate("sharedcomponents#Delete"),id:"delete"}),a.CanDownload&&e.supports("filedownload")&&r.push({name:n.translate("sharedcomponents#Download"),id:"download"}),t.Policy.IsAdministrator&&r.push({name:n.translate("Refresh"),id:"refresh"}),"Timer"!=a.Type&&t.Policy.EnablePublicSharing&&e.supports("sharing")&&r.push({name:n.translate("Share"),id:"share"}),r})}function a(e,n){var r=e.Id,a=e.ServerId,i=t.getApiClient(a);return new Promise(function(e,t){switch(n){case"download":require(["fileDownloader"],function(e){var n=i.getUrl("Items/"+r+"/Download",{api_key:i.accessToken()});e.download([{url:n,itemId:r,serverId:a}]),t()});break;case"refresh":s(i,r),t();break;case"delete":o(i,r).then(function(){e(!0)});break;case"share":require(["sharingmanager"],function(e){e.showMenu({serverId:a,itemId:r}).then(t)});break;default:t()}})}function o(e,t){return new Promise(function(r,a){var o=n.translate("sharedcomponents#ConfirmDeleteItem"),s=n.translate("sharedcomponents#HeaderDeleteItem");require(["confirm"],function(n){n(o,s).then(function(){e.deleteItem(t).then(function(){r(!0)})},a)})})}function s(e,t){e.refreshItem(t,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!0}),require(["toast"],function(e){e(n.translate("sharedcomponents#RefreshQueued"))})}function i(e){return r(e).then(function(n){return new Promise(function(t,r){require(["actionsheet"],function(o){o.show({items:n}).then(function(n){a(e.item,n).then(t)},r)})})})}return{getCommands:r,show:i}});