define(["dialogHelper","layoutManager","globalize","browser","emby-button","css!./actionsheet","material-icons","scrollStyles"],function(t,e,n,i){function o(t,e){for(;!t.classList||!t.classList.contains(e);)if(t=t.parentNode,!t)return null;return t}function l(t){var e=document,n=[];if(!e)return n;for(var i,o,l=0,a=t.length;a>l;l++)o=t[l],i=o.getBoundingClientRect?o.getBoundingClientRect():{top:0,left:0},n[l]={top:i.top,left:i.left};return n}function a(t,e){var n=window.innerHeight,i=window.innerWidth;if(540>n)return null;var o=l([t.positionTo])[0];o.top+=t.positionTo.offsetHeight/2,o.left+=t.positionTo.offsetWidth/2;var a=e.offsetHeight||300,s=e.offsetWidth||160;o.top-=a/2,o.left-=s/2;var c=o.left+s-i,r=o.top+a-n;return c>0&&(o.left-=c+20),r>0&&(o.top-=r+20),o.top=Math.max(o.top,10),o.left=Math.max(o.left,10),o}function s(t){require(["scrollHelper"],function(e){e.centerFocus.on(t.querySelector(".actionSheetScroller"),!1)})}function c(l){var c={removeOnClose:!0,enableHistory:l.enableHistory,scrollY:!1},r=!1;e.tv?(c.size="fullscreen",r=!0,c.autoFocus=!0):(c.modal=!1,c.entryAnimationDuration=160,c.exitAnimationDuration=200,c.autoFocus=!1);var u=t.createDialog(c);e.tv||u.classList.add("extraSpacing"),u.classList.add("actionSheet");var d="";d+='<div class="actionSheetContent">',l.title&&(e.tv?(d+='<h1 class="actionSheetTitle">',d+=l.title,d+="</h1>"):(d+='<h2 class="actionSheetTitle">',d+=l.title,d+="</h2>"));var f=e.desktop?"smoothScrollY":"hiddenScrollY",h=i.noFlex||i.firefox?"max-height:400px;":"";if(l.items.length>20){var v=window.innerWidth>=300?240:200;h+="min-width:"+v+"px;"}d+='<div class="actionSheetScroller '+f+'" style="'+h+'">';var m,p,b,g=!1;for(m=0,p=l.items.length;p>m;m++)b=l.items[m],b.icon=b.selected?"check":null,b.icon&&(g=!0);var y=l.title&&!g;y&&u.classList.add("centered");var S="button";for(m=0,p=l.items.length;p>m;m++){b=l.items[m];var x=b.selected?" autoFocus":"";d+="<"+S+x+' is="emby-button" type="button" class="actionSheetMenuItem" data-id="'+(b.id||b.value)+'">',b.icon?d+='<i class="actionSheetItemIcon md-icon">'+b.icon+"</i>":g&&!y&&(d+='<i class="actionSheetItemIcon md-icon" style="visibility:hidden;">check</i>'),d+='<div class="actionSheetItemText">'+(b.name||b.textContent||b.innerText)+"</div>",d+="</"+S+">"}l.showCancel&&(d+='<div class="buttons">',d+='<button is="emby-button" type="button" class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</button>",d+="</div>"),d+="</div>",u.innerHTML=d,e.tv&&s(u),l.showCancel&&u.querySelector(".btnCancel").addEventListener("click",function(){t.close(u)}),document.body.appendChild(u);var w;return u.addEventListener("click",function(e){var n=o(e.target,"actionSheetMenuItem");n&&(w=n.getAttribute("data-id"),t.close(u))}),new Promise(function(e){u.addEventListener("close",function(){null!=w&&(l.callback&&l.callback(w),e(w))}),t.open(u);var n=l.positionTo?a(l,u):null;n&&(u.style.position="fixed",u.style.margin=0,u.style.left=n.left+"px",u.style.top=n.top+"px")})}return{show:c}});