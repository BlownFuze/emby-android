define(["dialogHelper","layoutManager","globalize","paper-button","css!./actionsheet","html!./../icons/nav.html"],function(t,e,n){function o(t,e){for(;!t.classList||!t.classList.contains(e);)if(t=t.parentNode,!t)return null;return t}function i(t){var e=document,n=[];if(!e)return n;for(var o,i,a=0,c=t.length;c>a;a++)i=t[a],o=i.getBoundingClientRect?i.getBoundingClientRect():{top:0,left:0},n[a]={top:o.top,left:o.left};return n}function a(t,e){var n=window.innerHeight;if(540>n)return null;var o=i([t.positionTo])[0];return o.top+=t.positionTo.offsetHeight/2,o.left+=t.positionTo.offsetWidth/2,o.top-=(e.offsetHeight||300)/2,o.left-=(e.offsetWidth||160)/2,o.top=Math.min(o.top,n-300),o.left=Math.min(o.left,window.innerWidth-300),o.top=Math.max(o.top,10),o.left=Math.max(o.left,10),o}function c(t){require(["scrollHelper"],function(e){e.centerFocus.on(t.querySelector(".actionSheetScroller"),!1)})}function l(i){var l={removeOnClose:!0,enableHistory:i.enableHistory,scrollY:!1},r=!1;e.tv?(l.size="fullscreen",r=!0,l.autoFocus=!0):(l.modal=!1,l.entryAnimationDuration=160,l.exitAnimationDuration=200,l.autoFocus=!1);var s=t.createDialog(l);e.tv||s.classList.add("extraSpacing"),s.classList.add("actionSheet");var u="";u+='<div class="actionSheetContent">',i.title&&(e.tv?(u+='<h1 class="actionSheetTitle">',u+=i.title,u+="</h1>"):(u+='<h2 class="actionSheetTitle">',u+=i.title,u+="</h2>")),u+='<div class="actionSheetScroller">',i.items.forEach(function(t){t.ironIcon=t.selected?"nav:check":null});var f=i.items.filter(function(t){return t.ironIcon}),d=f.length,p=i.title&&!f.length;p&&s.classList.add("centered");var h=!e.tv;h=!1;var v="paper-button";h&&(u+="<paper-menu>",v="paper-menu-item");for(var m=0,g=i.items.length;g>m;m++){var S=i.items[m],b=S.selected?" autoFocus":"";u+="<"+v+b+' class="actionSheetMenuItem" data-id="'+S.id+'">',S.ironIcon?u+='<iron-icon class="actionSheetItemIcon" icon="'+S.ironIcon+'"></iron-icon>':d&&!p&&(u+='<iron-icon class="actionSheetItemIcon"></iron-icon>'),u+='<div class="actionSheetItemText">'+S.name+"</div>",u+="</"+v+">"}h&&(u+="</paper-menu>"),i.showCancel&&(u+='<div class="buttons">',u+='<paper-button class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</paper-button>",u+="</div>"),u+="</div>",s.innerHTML=u,e.tv&&c(s),i.showCancel&&s.querySelector(".btnCancel").addEventListener("click",function(){t.close(s)}),document.body.appendChild(s);var y="click";return new Promise(function(e){s.addEventListener(y,function(n){var a=o(n.target,"actionSheetMenuItem");if(a){var c=a.getAttribute("data-id");t.close(s),setTimeout(function(){i.callback&&i.callback(c),e(c)},100)}}),t.open(s);var n=i.positionTo?a(i,s):null;n&&(s.style.position="fixed",s.style.margin=0,s.style.left=n.left+"px",s.style.top=n.top+"px")})}return{show:l}});