define(["dialogHelper","layoutManager","globalize","paper-button","css!./actionsheet","html!./../icons/nav.html","scrollStyles"],function(t,e,n){function o(t,e){for(;!t.classList||!t.classList.contains(e);)if(t=t.parentNode,!t)return null;return t}function i(t){var e=document,n=[];if(!e)return n;for(var o,i,a=0,l=t.length;l>a;a++)i=t[a],o=i.getBoundingClientRect?i.getBoundingClientRect():{top:0,left:0},n[a]={top:o.top,left:o.left};return n}function a(t,e){var n=window.innerHeight;if(540>n)return null;var o=i([t.positionTo])[0];return o.top+=t.positionTo.offsetHeight/2,o.left+=t.positionTo.offsetWidth/2,o.top-=(e.offsetHeight||300)/2,o.left-=(e.offsetWidth||160)/2,o.top=Math.min(o.top,n-300),o.left=Math.min(o.left,window.innerWidth-300),o.top=Math.max(o.top,10),o.left=Math.max(o.left,10),o}function l(t){require(["scrollHelper"],function(e){e.centerFocus.on(t.querySelector(".actionSheetScroller"),!1)})}function c(i){var c={removeOnClose:!0,enableHistory:i.enableHistory,scrollY:!1},r=!1;e.tv?(c.size="fullscreen",r=!0,c.autoFocus=!0):(c.modal=!1,c.entryAnimationDuration=160,c.exitAnimationDuration=200,c.autoFocus=!1);var s=t.createDialog(c);e.tv||s.classList.add("extraSpacing"),s.classList.add("actionSheet");var u="";u+='<div class="actionSheetContent">',i.title&&(e.tv?(u+='<h1 class="actionSheetTitle">',u+=i.title,u+="</h1>"):(u+='<h2 class="actionSheetTitle">',u+=i.title,u+="</h2>")),u+='<div class="actionSheetScroller hiddenScrollY">';var d,f,h,p=!1;for(d=0,f=i.items.length;f>d;d++)h=i.items[d],h.ironIcon=h.selected?"nav:check":null,h.ironIcon&&(p=!0);var v=i.title&&!p;v&&s.classList.add("centered");var m="paper-button";for(d=0,f=i.items.length;f>d;d++){h=i.items[d];var g=h.selected?" autoFocus":"";u+="<"+m+g+' class="actionSheetMenuItem" data-id="'+(h.id||h.value)+'">',h.ironIcon?u+='<iron-icon class="actionSheetItemIcon" icon="'+h.ironIcon+'"></iron-icon>':p&&!v&&(u+='<iron-icon class="actionSheetItemIcon"></iron-icon>'),u+='<div class="actionSheetItemText">'+(h.name||h.textContent||h.innerText)+"</div>",u+="</"+m+">"}i.showCancel&&(u+='<div class="buttons">',u+='<paper-button class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</paper-button>",u+="</div>"),u+="</div>",s.innerHTML=u,e.tv&&l(s),i.showCancel&&s.querySelector(".btnCancel").addEventListener("click",function(){t.close(s)}),document.body.appendChild(s);var S;return s.addEventListener("click",function(e){var n=o(e.target,"actionSheetMenuItem");n&&(S=n.getAttribute("data-id"),t.close(s))}),new Promise(function(e){s.addEventListener("close",function(){null!=S&&(i.callback&&i.callback(S),e(S))}),t.open(s);var n=i.positionTo?a(i,s):null;n&&(s.style.position="fixed",s.style.margin=0,s.style.left=n.left+"px",s.style.top=n.top+"px")})}return{show:c}});