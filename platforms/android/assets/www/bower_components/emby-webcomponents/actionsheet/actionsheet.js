define(["dialogHelper","layoutManager","globalize","browser","dom","emby-button","css!./actionsheet","material-icons","scrollStyles"],function(t,e,n,o,i){function l(t){var e=document,n=[];if(!e)return n;for(var o,i,l=0,a=t.length;a>l;l++)i=t[l],o=i.getBoundingClientRect?i.getBoundingClientRect():{top:0,left:0},n[l]={top:o.top,left:o.left};return n}function a(t,e){var n=window.innerHeight,o=window.innerWidth;if(540>n)return null;var i=l([t.positionTo])[0];i.top+=t.positionTo.offsetHeight/2,i.left+=t.positionTo.offsetWidth/2;var a=e.offsetHeight||300,c=e.offsetWidth||160;i.top-=a/2,i.left-=c/2;var s=i.left+c-o,r=i.top+a-n;return s>0&&(i.left-=s+20),r>0&&(i.top-=r+20),i.top=Math.max(i.top,10),i.left=Math.max(i.left,10),i}function c(t,e,n){require(["scrollHelper"],function(o){var i=n?"on":"off";o.centerFocus[i](t,e)})}function s(l){var s,r={removeOnClose:!0,enableHistory:l.enableHistory,scrollY:!1},u=!1;e.tv?(r.size="fullscreen",s=!0,u=!0,r.autoFocus=!0):(r.modal=!1,r.entryAnimationDuration=140,r.exitAnimationDuration=180,r.autoFocus=!1);var d=t.createDialog(r);s&&d.classList.add("actionsheet-fullscreen"),e.tv||d.classList.add("actionsheet-extraSpacing"),d.classList.add("actionSheet");var h="",f=e.desktop?"smoothScrollY":"hiddenScrollY",v=o.noFlex||o.firefox?"max-height:400px;":"";if(l.items.length>20){var m=window.innerWidth>=300?240:200;v+="min-width:"+m+"px;"}var p,S,b,y=!1;for(p=0,S=l.items.length;S>p;p++)b=l.items[p],b.icon=b.selected?"check":null,b.icon&&(y=!0);var g=l.title&&!y;h+=g?'<div class="actionSheetContent actionSheetContent-centered">':'<div class="actionSheetContent">',l.title&&(e.tv?(h+='<h1 class="actionSheetTitle">',h+=l.title,h+="</h1>"):(h+='<h2 class="actionSheetTitle">',h+=l.title,h+="</h2>")),l.text&&(h+='<p class="actionSheetText">',h+=l.text,h+="</p>"),h+='<div class="actionSheetScroller '+f+'" style="'+v+'">';var x="button";for(p=0,S=l.items.length;S>p;p++){b=l.items[p];var C=b.selected?" autoFocus":"";h+="<"+x+C+' is="emby-button" type="button" class="actionSheetMenuItem" data-id="'+(b.id||b.value)+'">',b.icon?h+='<i class="actionSheetItemIcon md-icon">'+b.icon+"</i>":y&&!g&&(h+='<i class="actionSheetItemIcon md-icon" style="visibility:hidden;">check</i>'),h+='<div class="actionSheetItemText">'+(b.name||b.textContent||b.innerText)+"</div>",h+="</"+x+">"}l.showCancel&&(h+='<div class="buttons">',h+='<button is="emby-button" type="button" class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</button>",h+="</div>"),h+="</div>",d.innerHTML=h,e.tv&&c(d.querySelector(".actionSheetScroller"),!1,!0),l.showCancel&&d.querySelector(".btnCancel").addEventListener("click",function(){t.close(d)}),document.body.appendChild(d);var w;d.addEventListener("click",function(e){var n=i.parentWithClass(e.target,"actionSheetMenuItem");n&&(w=n.getAttribute("data-id"),t.close(d))});var T;return l.timeout&&(T=setTimeout(function(){t.close(d)},l.timeout)),new Promise(function(n,o){d.addEventListener("close",function(){e.tv&&c(d.querySelector(".actionSheetScroller"),!1,!1),T&&(clearTimeout(T),T=null),null!=w?(l.callback&&l.callback(w),n(w)):o()}),t.open(d);var i=l.positionTo?a(l,d):null;i&&(d.style.position="fixed",d.style.margin=0,d.style.left=i.left+"px",d.style.top=i.top+"px")})}return{show:s}});