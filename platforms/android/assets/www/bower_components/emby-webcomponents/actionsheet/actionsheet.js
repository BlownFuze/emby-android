define(["dialogHelper","layoutManager","globalize","emby-button","css!./actionsheet","html!./../icons/nav.html","scrollStyles"],function(t,e,n){function o(t,e){for(;!t.classList||!t.classList.contains(e);)if(t=t.parentNode,!t)return null;return t}function i(t){var e=document,n=[];if(!e)return n;for(var o,i,l=0,a=t.length;a>l;l++)i=t[l],o=i.getBoundingClientRect?i.getBoundingClientRect():{top:0,left:0},n[l]={top:o.top,left:o.left};return n}function l(t,e){var n=window.innerHeight;if(540>n)return null;var o=i([t.positionTo])[0];return o.top+=t.positionTo.offsetHeight/2,o.left+=t.positionTo.offsetWidth/2,o.top-=(e.offsetHeight||300)/2,o.left-=(e.offsetWidth||160)/2,o.top=Math.min(o.top,n-300),o.left=Math.min(o.left,window.innerWidth-300),o.top=Math.max(o.top,10),o.left=Math.max(o.left,10),o}function a(t){require(["scrollHelper"],function(e){e.centerFocus.on(t.querySelector(".actionSheetScroller"),!1)})}function c(i){var c={removeOnClose:!0,enableHistory:i.enableHistory,scrollY:!1},s=!1;e.tv?(c.size="fullscreen",s=!0,c.autoFocus=!0):(c.modal=!1,c.entryAnimationDuration=160,c.exitAnimationDuration=200,c.autoFocus=!1);var r=t.createDialog(c);e.tv||r.classList.add("extraSpacing"),r.classList.add("actionSheet");var u="";u+='<div class="actionSheetContent">',i.title&&(e.tv?(u+='<h1 class="actionSheetTitle">',u+=i.title,u+="</h1>"):(u+='<h2 class="actionSheetTitle">',u+=i.title,u+="</h2>")),u+='<div class="actionSheetScroller hiddenScrollY">';var d,f,h,v=!1;for(d=0,f=i.items.length;f>d;d++)h=i.items[d],h.ironIcon=h.selected?"nav:check":null,h.ironIcon&&(v=!0);var m=i.title&&!v;m&&r.classList.add("centered");var p="button";for(d=0,f=i.items.length;f>d;d++){h=i.items[d];var b=h.selected?" autoFocus":"";u+="<"+p+b+' is="emby-button" type="button" class="actionSheetMenuItem" data-id="'+(h.id||h.value)+'">',h.ironIcon?u+='<iron-icon class="actionSheetItemIcon" icon="'+h.ironIcon+'"></iron-icon>':v&&!m&&(u+='<iron-icon class="actionSheetItemIcon"></iron-icon>'),u+='<div class="actionSheetItemText">'+(h.name||h.textContent||h.innerText)+"</div>",u+="</"+p+">"}i.showCancel&&(u+='<div class="buttons">',u+='<button is="emby-button" type="button" class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</button>",u+="</div>"),u+="</div>",r.innerHTML=u,e.tv&&a(r),i.showCancel&&r.querySelector(".btnCancel").addEventListener("click",function(){t.close(r)}),document.body.appendChild(r);var g;return r.addEventListener("click",function(e){var n=o(e.target,"actionSheetMenuItem");n&&(g=n.getAttribute("data-id"),t.close(r))}),new Promise(function(e){r.addEventListener("close",function(){null!=g&&(i.callback&&i.callback(g),e(g))}),t.open(r);var n=i.positionTo?l(i,r):null;n&&(r.style.position="fixed",r.style.margin=0,r.style.left=n.left+"px",r.style.top=n.top+"px")})}return{show:c}});