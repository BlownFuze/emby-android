define(["paperdialoghelper","layoutManager","paper-button","css!./actionsheet"],function(t,e){function n(t,e){for(;!t.classList||!t.classList.contains(e);)if(t=t.parentNode,!t)return null;return t}function o(t){var e=$(window).height();if(540>e)return null;var n=$(t.positionTo).offset();return n.top+=$(t.positionTo).innerHeight()/2,n.left+=$(t.positionTo).innerWidth()/2,n.top-=24,n.left-=24,n.top-=55*t.items.length/2,n.left-=80,n.top-=$(window).scrollTop(),n.left-=$(window).scrollLeft(),n.top=Math.min(n.top,e-300),n.left=Math.min(n.left,$(window).width()-300),n.top=Math.max(n.top,0),n.left=Math.max(n.left,0),n}function i(i){var a={removeOnClose:!0,enableHistory:i.enableHistory},l=!1;e.tv?(a.size="fullscreen",l=!0,a.autoFocus=!0):(a.modal=!1,a.entryAnimationDuration=160,a.exitAnimationDuration=200,a.autoFocus=!1);var s=t.createDialog(a),r=i.positionTo?o(i):null;s.classList.add("actionSheet");var c="";c+='<div class="actionSheetContent">',i.title&&(e.tv?(c+='<h1 class="actionSheetTitle">',c+=i.title,c+="</h1>"):(c+='<h2 class="actionSheetTitle">',c+=i.title,c+="</h2>")),c+='<div class="actionSheetScroller">';var p=i.items.filter(function(t){return t.ironIcon}),u=p.length,d=i.title&&!p.length;d&&s.classList.add("centered");var h=!e.tv;h=!1;var f="paper-button";h&&(c+="<paper-menu>",f="paper-menu-item");for(var m=0,v=i.items.length;v>m;m++){var b=i.items[m],g=b.selected?" autoFocus":"";c+="<"+f+g+' noink class="actionSheetMenuItem" data-id="'+b.id+'" style="display:block;">',b.ironIcon?c+='<iron-icon class="actionSheetItemIcon" icon="'+b.ironIcon+'"></iron-icon>':u&&!d&&(c+='<iron-icon class="actionSheetItemIcon"></iron-icon>'),c+="<span>"+b.name+"</span>",c+="</"+f+">"}h&&(c+="</paper-menu>"),i.showCancel&&(c+='<div class="buttons">',c+="<paper-button dialog-dismiss>"+Globalize.translate("core#ButtonCancel")+"</paper-button>",c+="</div>"),c+="</div>",s.innerHTML=c,r&&(s.style.position="fixed",s.style.left=r.left+"px",s.style.top=r.top+"px"),document.body.appendChild(s);var w="click";return new Promise(function(e){s.addEventListener(w,function(o){var a=n(o.target,"actionSheetMenuItem");if(a){var l=a.getAttribute("data-id");t.close(s),setTimeout(function(){i.callback&&i.callback(l),e(l)},100)}}),t.open(s)})}return{show:i}});