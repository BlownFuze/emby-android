define(["dialogHelper","layoutManager","globalize","browser","dom","emby-button","css!./actionsheet","material-icons","scrollStyles"],function(t,e,n,o,i){function l(t){var e=document,n=[];if(!e)return n;for(var o,i,l=0,a=t.length;a>l;l++)i=t[l],o=i.getBoundingClientRect?i.getBoundingClientRect():{top:0,left:0},n[l]={top:o.top,left:o.left};return n}function a(t,e){var n=i.getWindowSize(),o=n.innerHeight,a=n.innerWidth;if(540>o)return null;var c=l([t.positionTo])[0];c.top+=t.positionTo.offsetHeight/2,c.left+=t.positionTo.offsetWidth/2;var s=e.offsetHeight||300,r=e.offsetWidth||160;c.top-=s/2,c.left-=r/2;var u=c.left+r-a,d=c.top+s-o;return u>0&&(c.left-=u+20),d>0&&(c.top-=d+20),c.top=Math.max(c.top,10),c.left=Math.max(c.left,10),c}function c(t,e,n){require(["scrollHelper"],function(o){var i=n?"on":"off";o.centerFocus[i](t,e)})}function s(l){var s,r={removeOnClose:!0,enableHistory:l.enableHistory,scrollY:!1},u=!1;e.tv?(r.size="fullscreen",s=!0,u=!0,r.autoFocus=!0):(r.modal=!1,r.entryAnimationDuration=140,r.exitAnimationDuration=180,r.autoFocus=!1);var d=t.createDialog(r);s&&d.classList.add("actionsheet-fullscreen"),e.tv||d.classList.add("actionsheet-extraSpacing"),d.classList.add("actionSheet");var h="",f=e.desktop?"smoothScrollY":"hiddenScrollY",m=o.noFlex||o.firefox?"max-height:400px;":"";if(l.items.length>20){var v=i.getWindowSize().innerWidth>=300?240:200;m+="min-width:"+v+"px;"}var p,S,b,g=!1;for(p=0,S=l.items.length;S>p;p++)b=l.items[p],b.icon=b.selected?"check":null,b.icon&&(g=!0);var x=l.title&&!g;h+=x?'<div class="actionSheetContent actionSheetContent-centered">':'<div class="actionSheetContent">',l.title&&(e.tv?(h+='<h1 class="actionSheetTitle">',h+=l.title,h+="</h1>"):(h+='<h2 class="actionSheetTitle">',h+=l.title,h+="</h2>")),l.text&&(h+='<p class="actionSheetText">',h+=l.text,h+="</p>"),h+='<div class="actionSheetScroller '+f+'" style="'+m+'">';var y=o.noFlex||o.firefox?"actionSheetMenuItem actionSheetMenuItem-noflex":"actionSheetMenuItem";for(p=0,S=l.items.length;S>p;p++){b=l.items[p];var C=b.selected?" autoFocus":"";h+="<button"+C+' is="emby-button" type="button" class="'+y+'" data-id="'+(b.id||b.value)+'">',b.icon?h+='<i class="actionSheetItemIcon md-icon">'+b.icon+"</i>":g&&!x&&(h+='<i class="actionSheetItemIcon md-icon" style="visibility:hidden;">check</i>'),h+='<div class="actionSheetItemText">'+(b.name||b.textContent||b.innerText)+"</div>",h+="</button>"}l.showCancel&&(h+='<div class="buttons">',h+='<button is="emby-button" type="button" class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</button>",h+="</div>"),h+="</div>",d.innerHTML=h,e.tv&&c(d.querySelector(".actionSheetScroller"),!1,!0),l.showCancel&&d.querySelector(".btnCancel").addEventListener("click",function(){t.close(d)}),document.body.appendChild(d);var T;d.addEventListener("click",function(e){var n=i.parentWithClass(e.target,"actionSheetMenuItem");n&&(T=n.getAttribute("data-id"),t.close(d))});var I;return l.timeout&&(I=setTimeout(function(){t.close(d)},l.timeout)),new Promise(function(n,o){d.addEventListener("close",function(){e.tv&&c(d.querySelector(".actionSheetScroller"),!1,!1),I&&(clearTimeout(I),I=null),null!=T?(l.callback&&l.callback(T),n(T)):o()}),t.open(d);var i=l.positionTo?a(l,d):null;i&&(d.style.position="fixed",d.style.margin=0,d.style.left=i.left+"px",d.style.top=i.top+"px")})}return{show:s}});