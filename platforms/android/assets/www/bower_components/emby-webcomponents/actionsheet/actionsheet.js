define(["dialogHelper","layoutManager","globalize","browser","dom","emby-button","css!./actionsheet","material-icons","scrollStyles"],function(t,e,n,o,i){function l(t){var e=document,n=[];if(!e)return n;for(var o,i,l=0,a=t.length;a>l;l++)i=t[l],o=i.getBoundingClientRect?i.getBoundingClientRect():{top:0,left:0},n[l]={top:o.top,left:o.left};return n}function a(t,e){var n=window.innerHeight,o=window.innerWidth;if(540>n)return null;var i=l([t.positionTo])[0];i.top+=t.positionTo.offsetHeight/2,i.left+=t.positionTo.offsetWidth/2;var a=e.offsetHeight||300,c=e.offsetWidth||160;i.top-=a/2,i.left-=c/2;var s=i.left+c-o,r=i.top+a-n;return s>0&&(i.left-=s+20),r>0&&(i.top-=r+20),i.top=Math.max(i.top,10),i.left=Math.max(i.left,10),i}function c(t){require(["scrollHelper"],function(e){e.centerFocus.on(t.querySelector(".actionSheetScroller"),!1)})}function s(l){var s={removeOnClose:!0,enableHistory:l.enableHistory,scrollY:!1},r=!1;e.tv?(s.size="fullscreen",r=!0,s.autoFocus=!0):(s.modal=!1,s.entryAnimationDuration=140,s.exitAnimationDuration=180,s.autoFocus=!1);var d=t.createDialog(s);e.tv||d.classList.add("extraSpacing"),d.classList.add("actionSheet");var u="";u+='<div class="actionSheetContent">',l.title&&(e.tv?(u+='<h1 class="actionSheetTitle">',u+=l.title,u+="</h1>"):(u+='<h2 class="actionSheetTitle">',u+=l.title,u+="</h2>")),l.text&&(u+='<p class="actionSheetText">',u+=l.text,u+="</p>");var h=e.desktop?"smoothScrollY":"hiddenScrollY",f=o.noFlex||o.firefox?"max-height:400px;":"";if(l.items.length>20){var v=window.innerWidth>=300?240:200;f+="min-width:"+v+"px;"}u+='<div class="actionSheetScroller '+h+'" style="'+f+'">';var p,m,b,g=!1;for(p=0,m=l.items.length;m>p;p++)b=l.items[p],b.icon=b.selected?"check":null,b.icon&&(g=!0);var y=l.title&&!g;y&&d.classList.add("centered");var S="button";for(p=0,m=l.items.length;m>p;p++){b=l.items[p];var x=b.selected?" autoFocus":"";u+="<"+S+x+' is="emby-button" type="button" class="actionSheetMenuItem" data-id="'+(b.id||b.value)+'">',b.icon?u+='<i class="actionSheetItemIcon md-icon">'+b.icon+"</i>":g&&!y&&(u+='<i class="actionSheetItemIcon md-icon" style="visibility:hidden;">check</i>'),u+='<div class="actionSheetItemText">'+(b.name||b.textContent||b.innerText)+"</div>",u+="</"+S+">"}l.showCancel&&(u+='<div class="buttons">',u+='<button is="emby-button" type="button" class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</button>",u+="</div>"),u+="</div>",d.innerHTML=u,e.tv&&c(d),l.showCancel&&d.querySelector(".btnCancel").addEventListener("click",function(){t.close(d)}),document.body.appendChild(d);var w;return d.addEventListener("click",function(e){var n=i.parentWithClass(e.target,"actionSheetMenuItem");n&&(w=n.getAttribute("data-id"),t.close(d))}),new Promise(function(e){d.addEventListener("close",function(){null!=w&&(l.callback&&l.callback(w),e(w))}),t.open(d);var n=l.positionTo?a(l,d):null;n&&(d.style.position="fixed",d.style.margin=0,d.style.left=n.left+"px",d.style.top=n.top+"px")})}return{show:s}});