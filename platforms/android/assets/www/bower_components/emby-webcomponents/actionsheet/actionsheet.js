define(["paperdialoghelper","layoutManager","dialogText","paper-button","css!./actionsheet"],function(t,e,n){function i(t,e){for(;!t.classList||!t.classList.contains(e);)if(t=t.parentNode,!t)return null;return t}function o(t){var e=document,n=[];if(!e)return n;for(var i,o,a=e.documentElement,l=({clientTop:a.clientTop,clientLeft:a.clientLeft},e.defaultView),r=({pageXOffset:l.pageXOffset,pageYOffset:l.pageYOffset},0),c=t.length;c>r;r++)o=t[r],i=o.getBoundingClientRect?o.getBoundingClientRect():{top:0,left:0},n[r]={top:i.top,left:i.left};return n}function a(t){var e=window.innerHeight;if(540>e)return null;var n=o([t.positionTo])[0];return n.top+=t.positionTo.offsetHeight/2,n.left+=t.positionTo.offsetWidth/2,n.top-=55*t.items.length/2,n.left-=80,n.top=Math.min(n.top,e-300),n.left=Math.min(n.left,window.innerWidth-300),n.top=Math.max(n.top,10),n.left=Math.max(n.left,10),n}function l(t){require(["scrollHelper"],function(e){e.centerFocus.on(t.querySelector(".actionSheetScroller"),!1)})}function r(o){var r=o.positionTo?a(o):null,c={removeOnClose:!0,enableHistory:o.enableHistory,refit:null==r},s=!1;e.tv?(c.size="fullscreen",s=!0,c.autoFocus=!0):(c.modal=!1,c.entryAnimationDuration=160,c.exitAnimationDuration=200,c.autoFocus=!1);var u=t.createDialog(c);u.classList.add("actionSheet");var f="";f+='<div class="actionSheetContent">',o.title&&(e.tv?(f+='<h1 class="actionSheetTitle">',f+=o.title,f+="</h1>"):(f+='<h2 class="actionSheetTitle">',f+=o.title,f+="</h2>")),f+='<div class="actionSheetScroller">';var p=o.items.filter(function(t){return t.ironIcon}),d=p.length,h=o.title&&!p.length;h&&u.classList.add("centered");var m=!e.tv;m=!1;var v="paper-button";m&&(f+="<paper-menu>",v="paper-menu-item");for(var g=0,S=o.items.length;S>g;g++){var b=o.items[g],y=b.selected?" autoFocus":"";f+="<"+v+y+' noink class="actionSheetMenuItem" data-id="'+b.id+'" style="display:block;">',b.ironIcon?f+='<iron-icon class="actionSheetItemIcon" icon="'+b.ironIcon+'"></iron-icon>':d&&!h&&(f+='<iron-icon class="actionSheetItemIcon"></iron-icon>'),f+="<span>"+b.name+"</span>",f+="</"+v+">"}m&&(f+="</paper-menu>"),o.showCancel&&(f+='<div class="buttons">',f+="<paper-button dialog-dismiss>"+n.get("Cancel")+"</paper-button>",f+="</div>"),f+="</div>",u.innerHTML=f,e.tv&&l(u),document.body.appendChild(u);var T="click";return new Promise(function(e){u.addEventListener(T,function(n){var a=i(n.target,"actionSheetMenuItem");if(a){var l=a.getAttribute("data-id");t.close(u),setTimeout(function(){o.callback&&o.callback(l),e(l)},100)}}),t.open(u),r&&(u.style.position="fixed",u.style.left=r.left+"px",u.style.top=r.top+"px")})}return{show:r}});