define(["historyManager","focusManager","browser","layoutManager","inputManager","dom","css!./dialoghelper.css","scrollStyles"],function(t,n,e,o,i,a){function s(){return e.animate?!0:e.edge?!0:!1}function r(t){o.tv&&(t.classList.contains("smoothScrollX")?x(t,!0,!1):t.classList.contains("smoothScrollY")&&x(t,!1,!1))}function c(n,e,o){function a(){var t=d.originalUrl==window.location.href;(t||!v(n))&&window.removeEventListener("popstate",a),t&&(d.closedByBack=!0,k(n))}function s(t){"back"==t.detail.command&&(d.closedByBack=!0,k(n),t.preventDefault())}function c(){if(m(n)||i.off(n,s),window.removeEventListener("popstate",a),B(n),n.classList.remove("opened"),p&&document.body.classList.remove("noScroll"),!d.closedByBack&&m(n)){var t=history.state||{};t.dialogId==e&&history.back()}g.focus(),"true"==n.getAttribute("data-removeonclose")&&(r(n),n.parentNode.removeChild(n)),setTimeout(function(){o({element:n,closedByBack:d.closedByBack})},1)}var d=this;d.originalUrl=window.location.href;var g=document.activeElement,p=!1;n.addEventListener("close",c);var y=!n.classList.contains("fixedSize");y&&n.classList.add("centeredDialog"),n.classList.remove("hide"),n.showModal?(n.getAttribute("modal")?n.showModal():(l(n),n.showModal()),f(document.activeElement)):u(n),n.classList.add("opened"),y&&S(n),"true"!=n.getAttribute("data-lockscroll")||document.body.classList.contains("noScroll")||(document.body.classList.add("noScroll"),p=!0),E(n),m(n)?(t.pushState({dialogId:e},"Dialog",e),window.addEventListener("popstate",a)):i.on(n,s)}function l(t){t.addEventListener("click",function(n){var e=t.getBoundingClientRect(),o=e.top<=n.clientY&&n.clientY<=e.top+e.height&&e.left<=n.clientX&&n.clientX<=e.left+e.width;o||a.parentWithTag(n.target,"SELECT")&&(o=!0),o||p(t)})}function d(t){n.autoFocus(t)}function f(t){t&&t.blur&&t!=document.body&&t.blur()}function u(t){var n=document.createElement("div");n.classList.add("dialogBackdrop"),t.parentNode.insertBefore(n,t),t.backdrop=n,setTimeout(function(){n.classList.add("opened")},0),n.addEventListener("click",function(){p(t)})}function m(t){return"true"==t.getAttribute("data-history")}function g(t){return z&&z(t),new Promise(function(n){new c(t,"dlg"+(new Date).getTime(),n)})}function v(t){return!t.classList.contains("hide")}function p(t){v(t)&&(m(t)?history.back():k(t))}function y(t,n){var e=[{transform:"scale(0)",offset:0},{transform:"none",offset:1}],o=t.animationConfig.entry.timing;return t.animate(e,o).onfinish=n}function h(t,n){var e=[{transform:"translate3d(0,30%,0)",opacity:0,offset:0},{transform:"none",opacity:1,offset:1}],o=t.animationConfig.entry.timing;return t.animate(e,o).onfinish=n}function b(t,n){var e=[{opacity:"0",offset:0},{opacity:"1",offset:1}],o=t.animationConfig.entry.timing;return t.animate(e,o).onfinish=n}function L(t){var n=[{transform:"none",opacity:1,offset:0},{transform:"scale(0)",opacity:0,offset:1}],e=t.animationConfig.exit.timing;return t.animate(n,e)}function w(t){var n=[{opacity:"1",offset:0},{opacity:"0",offset:1}],e=t.animationConfig.exit.timing;return t.animate(n,e)}function C(t){var n=[{transform:"none",opacity:1,offset:0},{transform:"translate3d(0,30%,0)",opacity:0,offset:1}],e=t.animationConfig.entry.timing;return t.animate(n,e)}function k(t){if(!t.classList.contains("hide")){var n=function(){t.classList.add("hide"),t.close?t.close():t.dispatchEvent(new CustomEvent("close",{bubbles:!1,cancelable:!1}))};if(!t.animationConfig||!t.animate)return void n();var e;if("fadeout"==t.animationConfig.exit.name)e=w(t);else if("scaledown"==t.animationConfig.exit.name)e=L(t);else{if("slidedown"!=t.animationConfig.exit.name)return void n();e=C(t)}e.onfinish=n}}function E(t){var n=function(){"true"==t.getAttribute("data-autofocus")&&d(t)};return t.animationConfig&&t.animate?void("fadein"==t.animationConfig.entry.name?b(t,n):"scaleup"==t.animationConfig.entry.name?y(t,n):"slideup"==t.animationConfig.entry.name&&h(t,n)):void n()}function A(t){return null!=t.lockScroll?t.lockScroll:"fullscreen"==t.size?!0:e.mobile}function S(t){t.style.marginLeft=-(t.offsetWidth/2)+"px",t.style.marginTop=-(t.offsetHeight/2)+"px"}function B(t){var n=t.backdrop;n&&(t.backdrop=null,n.classList.remove("opened"),setTimeout(function(){n.parentNode.removeChild(n)},300))}function x(t,n,e){require(["scrollHelper"],function(o){var i=e?"on":"off";o.centerFocus[i](t,n)})}function M(n){n=n||{};var i=document.createElement("dialog");i=document.createElement(!i.showModal||e.tv?"div":"div"),i.classList.add("focuscontainer"),i.classList.add("hide"),A(n)&&i.setAttribute("data-lockscroll","true"),n.enableHistory!==!1&&t.enableNativeHistory()&&i.setAttribute("data-history","true"),n.modal!==!1&&i.setAttribute("modal","modal"),n.autoFocus!==!1&&i.setAttribute("data-autofocus","true");var a="scaleup",r=n.entryAnimation||a,c="scaledown",l=n.exitAnimation||c,d=n.entryAnimationDuration||(n.size?200:300),f=n.exitAnimationDuration||(n.size?200:300);return i.animationConfig={entry:{name:r,node:i,timing:{duration:d,easing:"ease-out"}},exit:{name:l,node:i,timing:{duration:f,easing:"ease-out",fill:"both"}}},s()||(i.animationConfig=null),i.classList.add("dialog"),n.scrollX?(i.classList.add("smoothScrollX"),o.tv&&x(i,!0,!0)):n.scrollY!==!1&&(i.classList.add("smoothScrollY"),o.tv&&x(i,!1,!0)),n.removeOnClose&&i.setAttribute("data-removeonclose","true"),n.size&&(i.classList.add("fixedSize"),i.classList.add(n.size)),i}var z;return{open:g,close:p,createDialog:M,setOnOpen:function(t){z=t}}});