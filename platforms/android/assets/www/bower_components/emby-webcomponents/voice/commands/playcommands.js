define(["connectionManager","playbackManager","globalize"],function(e,t,i){function n(e,n){n&&(e=r(e)),e=e.map(function(e){return e.Id}),e.length?t.play({ids:e}):require(["toast"],function(e){e(i.translate("sharedcomponents#NoItemsFound"))})}function r(e){for(var t,i,n=e.length;0!==n;)i=Math.floor(Math.random()*n),n-=1,t=e[n],e[n]=e[i],e[i]=t;return e}return function(t){return function(){var i={Limit:t.item.limit||100,UserId:t.userId,ExcludeLocationTypes:"Virtual"};t.item.itemType&&(i.IncludeItemTypes=t.item.itemType);var r=e.currentApiClient();"nextup"===t.item.sourceid&&r.getNextUpEpisodes(i).then(function(e){n(e.Items,t.item.shuffle)}),t.item.shuffle&&(t.item.sortBy=t.sortBy?"Random,"+t.item.sortBy:"Random"),i.SortBy=t.item.sortBy,i.SortOrder=t.item.sortOrder,i.Recursive=!0,-1!==t.item.filters.indexOf("unplayed")&&(i.IsPlayed=!1),-1!==t.item.filters.indexOf("played")&&(i.IsPlayed=!0),-1!==t.item.filters.indexOf("favorite")&&(i.Filters="IsFavorite"),r.getItems(r.getCurrentUserId(),i).then(function(e){n(e.Items,t.item.shuffle)})}}});