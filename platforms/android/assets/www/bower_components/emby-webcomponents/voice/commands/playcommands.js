define(["connectionManager","playbackManager","globalize"],function(e,t,r){function i(e,i){if(i&&(e=n(e)),e.length){var o=e[0].ServerId;e=e.map(function(e){return e.Id}),t.play({ids:e,serverId:o})}else require(["toast"],function(e){e(r.translate("sharedcomponents#NoItemsFound"))})}function n(e){for(var t,r,i=e.length;0!==i;)r=Math.floor(Math.random()*i),i-=1,t=e[i],e[i]=e[r],e[r]=t;return e}return function(t){return function(){var r={Limit:t.item.limit||100,UserId:t.userId,ExcludeLocationTypes:"Virtual"};t.item.itemType&&(r.IncludeItemTypes=t.item.itemType);var n=e.currentApiClient();"nextup"===t.item.sourceid&&n.getNextUpEpisodes(r).then(function(e){i(e.Items,t.item.shuffle)}),t.item.shuffle&&(t.item.sortBy=t.sortBy?"Random,"+t.item.sortBy:"Random"),r.SortBy=t.item.sortBy,r.SortOrder=t.item.sortOrder,r.Recursive=!0,-1!==t.item.filters.indexOf("unplayed")&&(r.IsPlayed=!1),-1!==t.item.filters.indexOf("played")&&(r.IsPlayed=!0),-1!==t.item.filters.indexOf("favorite")&&(r.Filters="IsFavorite"),n.getItems(n.getCurrentUserId(),r).then(function(e){i(e.Items,t.item.shuffle)})}}});