define([],function(){function e(e,u){var l={groupid:"",name:"",item:{actionid:"",groupid:"",sourceid:"",menuid:"",deviceid:"",itemName:"",itemType:"",shuffle:!1,filters:[],sortBy:"",sortOrder:"",item:100,category:"",usedefaultvalues:!0},defaultValues:{sourceid:"",deviceid:"",itemName:"",itemType:"",shuffle:!1,filters:[],sortBy:"",sortOrder:"",limit:100,category:""},properties:{movieName:null,devicename:null,songName:null,artistName:null,albumName:null,serieName:null,seasonName:null,pictureName:null,authorname:null},command:null,text:e,userId:Dashboard.getCurrentUserId(),success:!1},i=!1;return u.map(function(u){i||(u.defaultValues&&u.defaultValues.length>0&&u.defaultValues.map(function(){}),u.items&&u.items.length>0&&u.items.map(function(s){var r=t(s.command,e);if(!r&&s.altcommand&&(r=t(s.altcommand,e)),r&&r.length>0){u.groupid&&(l.groupid=u.groupid),u.name&&(l.name=u.name),u.defaultValues&&(l.defaultValues.sourceid=u.defaultValues.sourceid||l.defaultValues.sourceid,l.defaultValues.deviceid=u.defaultValues.deviceid||l.defaultValues.deviceid,l.defaultValues.itemName=u.defaultValues.itemName||l.defaultValues.itemName,l.defaultValues.itemType=u.defaultValues.itemType||l.defaultValues.itemType,l.defaultValues.shuffle=u.defaultValues.shuffle||l.defaultValues.shuffle,l.defaultValues.filters=u.defaultValues.filters||l.defaultValues.filters,l.defaultValues.sortBy=u.defaultValues.sortBy||l.defaultValues.sortBy,l.defaultValues.sortOrder=u.defaultValues.sortOrder||l.defaultValues.sortOrder,l.defaultValues.limit=u.defaultValues.limit||l.defaultValues.limit,l.defaultValues.category=u.defaultValues.category||l.defaultValues.category),u.name&&(l.name=u.name);var m=a(s.usedefaultvalues,l.item.usedefaultvalues);l.item.usedefaultvalues=m,l.item.actionid=a(s.actionid,l.item.actionid),l.item.groupid=a(s.groupid,l.item.groupid),l.item.menuid=a(s.menuid,l.item.menuid),l.item.sourceid=a(s.sourceid,l.item.sourceid,m,l.defaultValues.sourceid),l.item.deviceid=a(s.deviceid,l.item.deviceid,m,l.defaultValues.deviceid),l.item.itemName=a(s.itemName,l.item.itemName,m,l.defaultValues.itemName),l.item.itemType=a(s.itemType,l.item.itemType,m,l.defaultValues.itemType),l.item.shuffle=a(s.shuffle,l.item.shuffle,m,l.defaultValues.shuffle),l.item.filters=a(s.filters,l.item.filters,m,l.defaultValues.filters),l.item.sortBy=a(s.sortBy,l.item.sortBy,m,l.defaultValues.sortBy),l.item.sortOrder=a(s.sortOrder,l.item.sortOrder,m,l.defaultValues.sortOrder),l.item.limit=a(s.limit,l.item.limit,m,l.defaultValues.limit),l.command=s,r.map(function(e){switch(e.name){case"moviename":l.properties.movieName=e.value;break;case"devicename":l.properties.devicename=e.value;break;case"songname":l.properties.songName=e.value;break;case"artistname":l.properties.artistName=e.value;break;case"albumname":l.properties.albumName=e.value;break;case"seriename":l.properties.serieName=e.value;break;case"seasonname":l.properties.seasonName=e.value;break;case"picturename":l.properties.pictureName=e.value;break;case"authorname":l.properties.authorname=e.value}l.text&&(l.text=l.text.replace(e.value,"").trim())}),i=!0}}))}),l}function a(e,a,t,u){return e?e:t&&u?u:a}var t=function(e,a){e=e.toString();for(var t=[],u=/\(\?\<(.*?)\>\s?(.*?)\)/i;u.test(e);){var l=u.exec(e);t.push({name:l[1].trim().toLowerCase(),pattern:l[2].trim().toLowerCase(),value:null,title:""}),e=e.replace(u,"("+l[2].trim()+")")}var i=new RegExp(e,"i").exec(a);if(i){for(var s=0,r=t.length;r>s;s++)if(i[s+1]!==!1){var m=i[s+1];m&&(m=m.trim().toLowerCase()),t[s].value=m}}else t=null;return t};return function(a,t){if(a)var u=e(t,a);return u}});