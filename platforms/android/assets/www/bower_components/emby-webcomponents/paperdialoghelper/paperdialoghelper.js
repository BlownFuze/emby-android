define(["historyManager","focusManager","browser","layoutManager","inputManager","css!./paperdialoghelper.css"],function(t,e,n,i,o){function a(n,i,a){function l(){var t=f.originalUrl==window.location.href;(t||!d(n))&&window.removeEventListener("popstate",l),t&&(f.closedByBack=!0,v(n))}function u(t){"back"==t.detail.command&&(o.off(n,u),f.closedByBack=!0,v(n),t.preventDefault())}function m(){if(h(n),n.classList.remove("opened"),y&&document.body.classList.remove("noScroll"),window.removeEventListener("popstate",l),o.off(n,u),!f.closedByBack&&c(n)){var t=history.state||{};t.dialogId==i&&history.back()}g.focus(),"true"==n.getAttribute("data-removeonclose")&&n.parentNode.removeChild(n),setTimeout(function(){a({element:n,closedByBack:f.closedByBack})},1)}var f=this;f.originalUrl=window.location.href;var g=document.activeElement,y=!1;n.addEventListener("close",m);var L=!n.classList.contains("fixedSize");L&&(n.style.left="50%",n.style.top="50%"),n.classList.remove("hide"),n.showModal?(n.getAttribute("modal")?n.showModal():(r(n),n.show()),s(document.activeElement)):r(n),n.classList.add("opened"),L&&b(n),p(n),"true"==n.getAttribute("data-autofocus")&&e.autoFocus(n),"true"!=n.getAttribute("data-lockscroll")||document.body.classList.contains("noScroll")||(document.body.classList.add("noScroll"),y=!0),c(n)?(t.pushState({dialogId:i},"Dialog",i),window.addEventListener("popstate",l)):o.on(n,u)}function s(t){t&&t.blur&&t!=document.body&&t.blur()}function r(t){var e=document.createElement("div");e.classList.add("dialogBackdrop"),t.parentNode.insertBefore(e,t.nextSibling),t.backdrop=e,setTimeout(function(){e.classList.add("opened")},0),e.addEventListener("click",function(){u(t)})}function c(t){return"true"==t.getAttribute("data-history")}function l(t){return new Promise(function(e){new a(t,"dlg"+(new Date).getTime(),e)})}function d(t){return!t.classList.contains("hide")}function u(t){d(t)&&(c(t)?history.back():v(t))}function m(t){var e=[{transform:"scale(0)",offset:0},{transform:"scale(1,1)",offset:1}],n=t.animationConfig.entry.timing;return t.animate(e,n)}function f(t){var e=[{opacity:"0",offset:0},{opacity:"1",offset:1}],n=t.animationConfig.entry.timing;return t.animate(e,n)}function g(t){var e=[{opacity:"1",offset:0},{opacity:"0",offset:1}],n=t.animationConfig.exit.timing;return t.animate(e,n)}function v(t){if(!t.classList.contains("hide")){var e=function(){t.classList.add("hide"),t.close?t.close():t.dispatchEvent(new CustomEvent("close",{bubbles:!1,cancelable:!1}))};if(!t.animationConfig||!t.animate)return void e();g(t).onfinish=e}}function p(t){t.animationConfig&&t.animate&&("fade-in-animation"==t.animationConfig.entry.name?f(t):"scale-up-animation"==t.animationConfig.entry.name&&m(t))}function y(t){return null!=t.lockScroll?t.lockScroll:"fullscreen"==t.size?!0:n.mobile}function b(t){t.style.marginLeft=-(t.offsetWidth/2)+"px",t.style.marginTop=-(t.offsetHeight/2)+"px"}function h(t){var e=t.backdrop;e&&(t.backdrop=null,e.classList.remove("opened"),setTimeout(function(){e.parentNode.removeChild(e)},300))}function L(e){e=e||{};var o=document.createElement("dialog");o.classList.add("hide"),y(e)&&o.setAttribute("data-lockscroll","true"),e.enableHistory!==!1&&t.enableNativeHistory()&&o.setAttribute("data-history","true"),e.modal!==!1&&o.setAttribute("modal","modal"),e.autoFocus!==!1&&o.setAttribute("data-autofocus","true");var a=n.animate&&!n.mobile?"scale-up-animation":"fade-in-animation";o.entryAnimation=e.entryAnimation||a,o.exitAnimation="fade-out-animation";var s=e.entryAnimationDuration||(e.size?240:300);return o.animationConfig={entry:{name:o.entryAnimation,node:o,timing:{duration:s,easing:"ease-out"}},exit:{name:o.exitAnimation,node:o,timing:{duration:e.exitAnimationDuration||300,easing:"ease-in"}}},n.animate||(o.animationConfig=null,o.entryAnimation=null,o.exitAnimation=null),o.classList.add("paperDialog"),o.classList.add("scrollY"),(i.tv||i.mobile)&&o.classList.add("hiddenScroll"),e.removeOnClose&&o.setAttribute("data-removeonclose","true"),e.size&&(o.classList.add("fixedSize"),o.classList.add(e.size)),o}return{open:l,close:u,createDialog:L}});