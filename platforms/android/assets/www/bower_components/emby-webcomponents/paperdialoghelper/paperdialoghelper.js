define(["historyManager","focusManager","performanceManager","browser","paper-dialog","scale-up-animation","fade-out-animation","fade-in-animation","css!./paperdialoghelper.css"],function(t,e,o,i){function n(e,o,i,n){function a(){var t=s.originalUrl==window.location.href;(t||!e.opened)&&window.removeEventListener("popstate",a),t&&(s.closedByBack=!0,e.close())}function r(){if(l&&document.body.classList.remove("noScroll"),window.removeEventListener("popstate",a),!s.closedByBack){var t=history.state||{};t.dialogId==o&&history.back()}d.focus(),"true"==e.getAttribute("data-removeonclose")&&e.parentNode.removeChild(e),setTimeout(function(){i({element:e,closedByBack:s.closedByBack})},1)}var s=this;s.originalUrl=window.location.href;var d=document.activeElement,l=!1;e.addEventListener("iron-overlay-closed",r),e.open(),n===!1||document.body.classList.contains("noScroll")||(document.body.classList.add("noScroll"),l=!0),t.pushState({dialogId:o},"Dialog",o),window.addEventListener("popstate",a)}function a(t){return new Promise(function(e){new n(t,"dlg"+(new Date).getTime(),e)})}function r(t){t.opened&&history.back()}function s(t){e.autoFocus(t.target)}function d(t){t=t||{};var e=document.createElement("paper-dialog");e.setAttribute("with-backdrop","with-backdrop"),e.setAttribute("role","alertdialog"),i.msie||i.firefox||t.modal===!1||e.setAttribute("modal","modal"),e.setAttribute("noAutoFocus","noAutoFocus");var n=o.getAnimationPerformance()<=1?"fade-in-animation":"scale-up-animation";e.entryAnimation=t.entryAnimation||n,e.exitAnimation="fade-out-animation";var a=t.entryAnimationDuration||(t.size?240:300);return e.animationConfig={entry:{name:e.entryAnimation,node:e,timing:{duration:a,easing:"ease-out"}},exit:{name:e.exitAnimation,node:e,timing:{duration:t.exitAnimationDuration||400,easing:"ease-in"}}},e.classList.add("paperDialog"),e.classList.add("scrollY"),e.classList.add("hiddenScroll"),t.removeOnClose&&e.setAttribute("data-removeonclose","true"),t.size&&(e.classList.add("fixedSize"),e.classList.add(t.size)),t.autoFocus!==!1&&e.addEventListener("iron-overlay-opened",s),e}function l(t,e){var o=$(window).height();if(o>=540){var i=$(e).offset();i.top+=e.offsetHeight/2,i.left+=e.offsetWidth/2,i.top-=24,i.left-=24,i.top-=$(t).height()/2,i.left-=$(t).width()/2,i.top-=$(window).scrollTop(),i.left-=$(window).scrollLeft(),i.top=Math.min(i.top,o-300),i.left=Math.min(i.left,$(window).width()-300),i.top=Math.max(i.top,0),i.left=Math.max(i.left,0),t.style.position="fixed",t.style.left=i.left+"px",t.style.top=i.top+"px"}}return{open:a,close:r,createDialog:d,positionTo:l}});