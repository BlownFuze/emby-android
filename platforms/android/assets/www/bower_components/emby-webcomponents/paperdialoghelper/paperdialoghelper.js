define(["historyManager","focusManager","performanceManager","browser","layoutManager","paper-dialog","scale-up-animation","fade-out-animation","fade-in-animation","css!./paperdialoghelper.css"],function(t,e,o,i,n){function a(e,o,n){function a(){var t=l.originalUrl==window.location.href;(t||!e.opened)&&window.removeEventListener("popstate",a),t&&(l.closedByBack=!0,e.close())}function s(){if(d&&document.body.classList.remove("noScroll"),window.removeEventListener("popstate",a),!l.closedByBack&&r(e)){var t=history.state||{};t.dialogId==o&&history.back()}c.focus(),"true"==e.getAttribute("data-removeonclose")&&e.parentNode.removeChild(e),setTimeout(function(){n({element:e,closedByBack:l.closedByBack})},1)}var l=this;l.originalUrl=window.location.href;var c=document.activeElement,d=!1;e.addEventListener("iron-overlay-closed",s),e.open(),i.chrome||e.classList.contains("fixedSize")||setTimeout(function(){e.refit()},100),"true"!=e.getAttribute("data-lockscroll")||document.body.classList.contains("noScroll")||(document.body.classList.add("noScroll"),d=!0),r(e)&&(t.pushState({dialogId:o},"Dialog",o),window.addEventListener("popstate",a))}function r(t){return"true"==t.getAttribute("data-history")}function s(t){return new Promise(function(e){new a(t,"dlg"+(new Date).getTime(),e)})}function l(t){t.opened&&(r(t)?history.back():t.close())}function c(t){e.autoFocus(t.target)}function d(t){return null!=t.lockScroll?t.lockScroll:"fullscreen"==t.size?!0:i.mobile}function u(t){t=t||{};var e=document.createElement("paper-dialog");e.setAttribute("with-backdrop","with-backdrop"),e.setAttribute("role","alertdialog"),d(t)&&e.setAttribute("data-lockscroll","true"),t.enableHistory!==!1&&e.setAttribute("data-history","true"),i.msie||i.firefox||t.modal===!1||e.setAttribute("modal","modal"),e.setAttribute("noAutoFocus","noAutoFocus");var a=o.getAnimationPerformance()<=1?"fade-in-animation":"scale-up-animation";e.entryAnimation=t.entryAnimation||a,e.exitAnimation="fade-out-animation";var r=t.entryAnimationDuration||(t.size?240:300);return e.animationConfig={entry:{name:e.entryAnimation,node:e,timing:{duration:r,easing:"ease-out"}},exit:{name:e.exitAnimation,node:e,timing:{duration:t.exitAnimationDuration||400,easing:"ease-in"}}},i.msie&&(e.animationConfig=null,e.entryAnimation=null,e.exitAnimation=null),e.classList.add("paperDialog"),e.classList.add("scrollY"),(n.tv||n.mobile)&&e.classList.add("hiddenScroll"),t.removeOnClose&&e.setAttribute("data-removeonclose","true"),t.size&&(e.classList.add("fixedSize"),e.classList.add(t.size)),t.autoFocus!==!1&&e.addEventListener("iron-overlay-opened",c),e}function m(t,e){var o=$(window).height();if(o>=540){var i=$(e).offset();i.top+=e.offsetHeight/2,i.left+=e.offsetWidth/2,i.top-=24,i.left-=24,i.top-=$(t).height()/2,i.left-=$(t).width()/2,i.top-=$(window).scrollTop(),i.left-=$(window).scrollLeft(),i.top=Math.min(i.top,o-300),i.left=Math.min(i.left,$(window).width()-300),i.top=Math.max(i.top,0),i.left=Math.max(i.left,0),t.style.position="fixed",t.style.left=i.left+"px",t.style.top=i.top+"px"}}return{open:s,close:l,createDialog:u,positionTo:m}});