define(["historyManager","focusManager","browser","layoutManager","paper-dialog","scale-up-animation","fade-out-animation","fade-in-animation","css!./paperdialoghelper.css"],function(t,e,o,i){function n(e,i,n){function r(){var t=s.originalUrl==window.location.href;(t||!e.opened)&&window.removeEventListener("popstate",r),t&&(s.closedByBack=!0,e.close())}function l(){if(c&&document.body.classList.remove("noScroll"),window.removeEventListener("popstate",r),!s.closedByBack&&a(e)){var t=history.state||{};t.dialogId==i&&history.back()}d.focus(),"true"==e.getAttribute("data-removeonclose")&&e.parentNode.removeChild(e),setTimeout(function(){n({element:e,closedByBack:s.closedByBack})},1)}var s=this;s.originalUrl=window.location.href;var d=document.activeElement,c=!1;e.addEventListener("iron-overlay-closed",l),e.open(),o.chrome||e.classList.contains("fixedSize")||setTimeout(function(){e.refit()},100),"true"!=e.getAttribute("data-lockscroll")||document.body.classList.contains("noScroll")||(document.body.classList.add("noScroll"),c=!0),a(e)&&(t.pushState({dialogId:i},"Dialog",i),window.addEventListener("popstate",r))}function a(t){return"true"==t.getAttribute("data-history")}function r(t){return new Promise(function(e){new n(t,"dlg"+(new Date).getTime(),e)})}function l(t){t.opened&&(a(t)?history.back():t.close())}function s(t){e.autoFocus(t.target)}function d(t){return null!=t.lockScroll?t.lockScroll:"fullscreen"==t.size?!0:o.mobile}function c(e){e=e||{};var n=document.createElement("paper-dialog");n.setAttribute("with-backdrop","with-backdrop"),n.setAttribute("role","alertdialog"),d(e)&&n.setAttribute("data-lockscroll","true"),e.enableHistory!==!1&&t.enableNativeHistory()&&n.setAttribute("data-history","true"),e.modal!==!1&&n.setAttribute("modal","modal"),n.setAttribute("noAutoFocus","noAutoFocus");var a=o.animate?"scale-up-animation":"fade-in-animation";n.entryAnimation=e.entryAnimation||a,n.exitAnimation="fade-out-animation";var r=e.entryAnimationDuration||(e.size?240:300);return n.animationConfig={entry:{name:n.entryAnimation,node:n,timing:{duration:r,easing:"ease-out"}},exit:{name:n.exitAnimation,node:n,timing:{duration:e.exitAnimationDuration||400,easing:"ease-in"}}},o.animate||(n.animationConfig=null,n.entryAnimation=null,n.exitAnimation=null),n.classList.add("paperDialog"),n.classList.add("scrollY"),(i.tv||i.mobile)&&n.classList.add("hiddenScroll"),e.removeOnClose&&n.setAttribute("data-removeonclose","true"),e.size&&(n.classList.add("fixedSize"),n.classList.add(e.size)),e.autoFocus!==!1&&n.addEventListener("iron-overlay-opened",s),n}function u(t,e){var o=$(window).height();if(o>=540){var i=$(e).offset();i.top+=e.offsetHeight/2,i.left+=e.offsetWidth/2,i.top-=24,i.left-=24,i.top-=$(t).height()/2,i.left-=$(t).width()/2,i.top-=$(window).scrollTop(),i.left-=$(window).scrollLeft(),i.top=Math.min(i.top,o-300),i.left=Math.min(i.left,$(window).width()-300),i.top=Math.max(i.top,0),i.left=Math.max(i.left,0),t.style.position="fixed",t.style.left=i.left+"px",t.style.top=i.top+"px"}}return{open:r,close:l,createDialog:c,positionTo:u}});