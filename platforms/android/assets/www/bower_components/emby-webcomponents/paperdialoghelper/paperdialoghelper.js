define(["historyManager","focusManager","performanceManager","browser","paper-dialog","scale-up-animation","fade-out-animation","fade-in-animation","css!./paperdialoghelper.css"],function(t,e,o,i){function n(e,o,i){function n(){var t=s.originalUrl==window.location.href;(t||!e.opened)&&window.removeEventListener("popstate",n),t&&(s.closedByBack=!0,e.close())}function r(){if(d&&document.body.classList.remove("noScroll"),window.removeEventListener("popstate",n),!s.closedByBack&&a(e)){var t=history.state||{};t.dialogId==o&&history.back()}l.focus(),"true"==e.getAttribute("data-removeonclose")&&e.parentNode.removeChild(e),setTimeout(function(){i({element:e,closedByBack:s.closedByBack})},1)}var s=this;s.originalUrl=window.location.href;var l=document.activeElement,d=!1;e.addEventListener("iron-overlay-closed",r),e.open(),"true"!=e.getAttribute("data-lockscroll")||document.body.classList.contains("noScroll")||(document.body.classList.add("noScroll"),d=!0),a(e)&&(t.pushState({dialogId:o},"Dialog",o),window.addEventListener("popstate",n))}function a(t){return"true"==t.getAttribute("data-history")}function r(t){return new Promise(function(e){new n(t,"dlg"+(new Date).getTime(),e)})}function s(t){t.opened&&(a(t)?history.back():t.close())}function l(t){e.autoFocus(t.target)}function d(t){return null!=t.lockScroll?t.lockScroll:"fullscreen"==t.size?!0:i.mobile}function c(t){t=t||{};var e=document.createElement("paper-dialog");e.setAttribute("with-backdrop","with-backdrop"),e.setAttribute("role","alertdialog"),d(t)&&e.setAttribute("data-lockscroll","true"),t.enableHistory!==!1&&e.setAttribute("data-history","true"),i.msie||i.firefox||t.modal===!1||e.setAttribute("modal","modal"),e.setAttribute("noAutoFocus","noAutoFocus");var n=o.getAnimationPerformance()<=1?"fade-in-animation":"scale-up-animation";e.entryAnimation=t.entryAnimation||n,e.exitAnimation="fade-out-animation";var a=t.entryAnimationDuration||(t.size?240:300);return e.animationConfig={entry:{name:e.entryAnimation,node:e,timing:{duration:a,easing:"ease-out"}},exit:{name:e.exitAnimation,node:e,timing:{duration:t.exitAnimationDuration||400,easing:"ease-in"}}},e.classList.add("paperDialog"),e.classList.add("scrollY"),e.classList.add("hiddenScroll"),t.removeOnClose&&e.setAttribute("data-removeonclose","true"),t.size&&(e.classList.add("fixedSize"),e.classList.add(t.size)),t.autoFocus!==!1&&e.addEventListener("iron-overlay-opened",l),e}function u(t,e){var o=$(window).height();if(o>=540){var i=$(e).offset();i.top+=e.offsetHeight/2,i.left+=e.offsetWidth/2,i.top-=24,i.left-=24,i.top-=$(t).height()/2,i.left-=$(t).width()/2,i.top-=$(window).scrollTop(),i.left-=$(window).scrollLeft(),i.top=Math.min(i.top,o-300),i.left=Math.min(i.left,$(window).width()-300),i.top=Math.max(i.top,0),i.left=Math.max(i.left,0),t.style.position="fixed",t.style.left=i.left+"px",t.style.top=i.top+"px"}}return{open:r,close:s,createDialog:c,positionTo:u}});