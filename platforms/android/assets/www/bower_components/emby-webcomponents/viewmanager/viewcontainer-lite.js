define(["browser"],function(e){function n(){return L?e.tv?!1:!0:!1}function t(e){if(!e.cancel){u();var n=d(g),t=-1==n?null:g[n],o=n+1;o>=w&&(o=0);var s=document.createElement("div");s.classList.add("page-view"),e.type&&s.setAttribute("data-type",e.type),s.innerHTML=e.view;var f=g[o],c=f.querySelector(".page-view");return c?(v(c),f.replaceChild(s,c)):f.appendChild(s),p&&p(s,!1,e),r(g,o,n),a(f,t,e.transition,e.isBack).then(function(){return P=o,y[o]=e.url,!e.cancel&&t&&i(g,o),s})}}function r(e,n,t){for(var r=0,i=e.length;i>r;r++)n==r||t==r||e[r].classList.add("hide")}function i(e,n){for(var t=0,r=e.length;r>t;t++)n==t||e[t].classList.add("hide")}function a(e,t,r,i){if(n()&&t&&e.animate){if("slide"==r)return s(e,t,r,i);if("fade"==r)return f(e,t,r,i)}return o(e,t,r,i)}function o(e){return e.classList.remove("hide"),Promise.resolve()}function s(e,n,t,r){return new Promise(function(t){var i={duration:450,iterations:1,easing:"ease-out"},a=[];if(n){var o=r?"100%":"-100%";a.push(n.animate([{transform:"none",offset:0},{transform:"translate3d("+o+", 0, 0)",offset:1}],i))}e.classList.remove("hide");var s=r?"-100%":"100%";a.push(e.animate([{transform:"translate3d("+s+", 0, 0)",offset:0},{transform:"none",offset:1}],i)),q=a,a[a.length-1].onfinish=t})}function f(e,n){return new Promise(function(t){var r={duration:200,iterations:1,easing:"ease-out"},i=[];n&&i.push(n.animate([{opacity:1,offset:0},{opacity:0,offset:1}],r)),e.classList.remove("hide"),i.push(e.animate([{opacity:0,offset:0},{opacity:1,offset:1}],r)),q=i,i[i.length-1].onfinish=t})}function u(){for(var e=q,n=0,t=e.length;t>n;n++)c(e[n])}function c(e){try{e.cancel()}catch(n){}}function l(e){p=e}function d(){return P}function m(e){var n=e.url,t=y.indexOf(n);if(-1!=t){var o=g[t],s=o.querySelector(".page-view");if(s){if(e.cancel)return;u();var f=g[t],c=d(g),l=-1==c?null:g[c];return p&&p(s,!0,e),r(g,t,c),a(f,l,e.transition,e.isBack).then(function(){return P=t,!e.cancel&&l&&i(g,t),s})}}return Promise.reject()}function v(e){e.dispatchEvent(new CustomEvent("viewdestroy",{}))}function h(){y=[]}var p,g=document.querySelectorAll(".mainAnimatedPage"),y=[],w=g.length,L=!0,P=-1,q=[];return n()&&!document.documentElement.animate&&require(["webAnimations"]),{loadView:t,tryRestoreView:m,reset:h,setOnBeforeChange:l}});