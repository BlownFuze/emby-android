define(["itemHelper","mediaInfo","indicators","connectionManager","layoutManager","globalize","userdataButtons","css!./listview"],function(e,a,t,i,r,n,s){function l(e,a){if("disc"==a.index)return null==e.ParentIndexNumber?"":n.translate("sharedcomponents#ValueDiscNumber",e.ParentIndexNumber);var t,i,r=(a.sortBy||"").toLowerCase();return 0==r.indexOf("sortname")?"Episode"==e.Type?"":(i=(e.SortName||e.Name||"?")[0].toUpperCase(),t=i.charCodeAt(0),65>t||t>90?"#":i.toUpperCase()):0==r.indexOf("officialrating")?e.OfficialRating||n.translate("sharedcomponents#Unrated"):0==r.indexOf("communityrating")?null==e.CommunityRating?n.translate("sharedcomponents#Unrated"):Math.floor(e.CommunityRating):0==r.indexOf("criticrating")?null==e.CriticRating?n.translate("sharedcomponents#Unrated"):Math.floor(e.CriticRating):0==r.indexOf("metascore")?null==e.Metascore?n.translate("sharedcomponents#Unrated"):Math.floor(e.Metascore):0==r.indexOf("albumartist")&&e.AlbumArtist?(i=e.AlbumArtist[0].toUpperCase(),t=i.charCodeAt(0),65>t||t>90?"#":i.toUpperCase()):""}function d(e,a){var t=i.getApiClient(e.ServerId),r={width:a,type:"Primary"};return e.ImageTags&&e.ImageTags.Primary?(r.tag=e.ImageTags.Primary,t.getScaledImageUrl(e.Id,r)):e.AlbumId&&e.AlbumPrimaryImageTag?(r.tag=e.AlbumPrimaryImageTag,t.getScaledImageUrl(e.AlbumId,r)):e.SeriesId&&e.SeriesPrimaryImageTag?(r.tag=e.SeriesPrimaryImageTag,t.getScaledImageUrl(e.SeriesId,r)):e.ParentPrimaryImageTag?(r.tag=e.ParentPrimaryImageTag,t.getScaledImageUrl(e.ParentPrimaryImageItemId,r)):null}function o(i,n){1==arguments.length&&(n=i,i=n.items);var o=0,m="",c=n.action||"link",u="large"==n.imageSize,g=n.enableOverview,I=r.tv?!0:!1,p=I?"button":"div",v=null!=n.enableSideMediaInfo?n.enableSideMediaInfo:I,y="";return y+=i.map(function(i){var r="";if(n.showIndex){var y=l(i,n);y!=m&&(r&&(r+="</div>"),r+=0==o?'<h1 class="listGroupHeader first">':'<h1 class="listGroupHeader">',r+=y,r+="</h1>",r+="<div>",m=y)}var b="listItem";I&&(b+=" itemAction");var f=80;u&&(b+=" largeImage",f=500);var h=i.PlaylistItemId?' data-playlistitemid="'+i.PlaylistItemId+'"':"",P=i.UserData&&i.UserData.PlaybackPositionTicks?' data-positionticks="'+i.UserData.PlaybackPositionTicks+'"':"";r+="<"+p+' class="'+b+'" data-index="'+o+'"'+h+' data-action="'+c+'" data-isfolder="'+i.IsFolder+'" data-id="'+i.Id+'" data-serverid="'+i.ServerId+'" data-mediatype="'+i.MediaType+'" data-type="'+i.Type+'"'+P+">",!I&&n.dragHandle&&(r+='<button is="paper-icon-button-light" class="listViewDragHandle autoSize"><i class="md-icon">&#xE25D;</i></button>');var A=d(i,f);r+=A?'<div class="listItemImage lazy" data-src="'+A+'" item-icon>':'<div class="listItemImage">';var T="";T+=t.getPlayedIndicatorHtml(i),T&&(r+='<div class="indicators">'+T+"</div>");var S=t.getProgressBarHtml(i);S&&(r+=S),r+="</div>";var x=[];n.showParentTitle&&"Episode"==i.Type&&x.push(i.SeriesName||"&nbsp;");var M=e.getDisplayName(i);n.showIndexNumber&&null!=i.IndexNumber&&(M=i.IndexNumber+". "+M),x.push(M),i.ArtistItems&&"MusicAlbum"!=i.Type&&x.push(i.ArtistItems.map(function(e){return e.Name}).join(", ")||"&nbsp;"),i.AlbumArtist&&"MusicAlbum"==i.Type&&x.push(i.AlbumArtist||"&nbsp;"),"Game"==i.Type&&x.push(i.GameSystem||"&nbsp;"),"TvChannel"==i.Type&&i.CurrentProgram&&x.push(e.getDisplayName(i.CurrentProgram));var U=x.length;v||U++,g&&i.Overview&&U++,b="listItemBody",I||(b+=" itemAction"),r+='<div class="'+b+'">';for(var C=0,w=x.length;w>C;C++)r+=0==C&&u?"<h2>":0==C?"<div>":'<div class="secondary">',r+=x[C]||"&nbsp;",r+=0==C&&u?"</h2>":0==C?"</div>":"</div>";return v||(r+='<div class="secondary listItemMediaInfo">'+a.getPrimaryMediaInfoHtml(i)+"</div>"),g&&i.Overview&&(r+='<div class="secondary overview">',r+=i.Overview,r+="</div>"),r+="</div>",v&&(r+='<div class="secondary listItemMediaInfo">'+a.getPrimaryMediaInfoHtml(i,{year:!1,container:!1})+"</div>"),I||(r+='<button is="paper-icon-button-light" class="itemAction autoSize" data-action="menu"><i class="md-icon">&#xE5D4;</i></button>',r+='<span class="listViewUserDataButtons">',r+=s.getIconsHtml({item:i,includePlayed:!1}),r+="</span>"),r+="</"+p+">",o++,r}).join("")}return{getListViewHtml:o}});