define(["itemHelper","mediaInfo","indicators","connectionManager","layoutManager","globalize","userdataButtons","apphost","css!./listview"],function(e,a,t,i,r,n,s,l){function d(e,a){if("disc"==a.index)return null==e.ParentIndexNumber?"":n.translate("sharedcomponents#ValueDiscNumber",e.ParentIndexNumber);var t,i,r=(a.sortBy||"").toLowerCase();return 0==r.indexOf("sortname")?"Episode"==e.Type?"":(i=(e.SortName||e.Name||"?")[0].toUpperCase(),t=i.charCodeAt(0),65>t||t>90?"#":i.toUpperCase()):0==r.indexOf("officialrating")?e.OfficialRating||n.translate("sharedcomponents#Unrated"):0==r.indexOf("communityrating")?null==e.CommunityRating?n.translate("sharedcomponents#Unrated"):Math.floor(e.CommunityRating):0==r.indexOf("criticrating")?null==e.CriticRating?n.translate("sharedcomponents#Unrated"):Math.floor(e.CriticRating):0==r.indexOf("metascore")?null==e.Metascore?n.translate("sharedcomponents#Unrated"):Math.floor(e.Metascore):0==r.indexOf("albumartist")&&e.AlbumArtist?(i=e.AlbumArtist[0].toUpperCase(),t=i.charCodeAt(0),65>t||t>90?"#":i.toUpperCase()):""}function o(e,a){var t=i.getApiClient(e.ServerId),r={width:a,type:"Primary"};return e.ImageTags&&e.ImageTags.Primary?(r.tag=e.ImageTags.Primary,t.getScaledImageUrl(e.Id,r)):e.AlbumId&&e.AlbumPrimaryImageTag?(r.tag=e.AlbumPrimaryImageTag,t.getScaledImageUrl(e.AlbumId,r)):e.SeriesId&&e.SeriesPrimaryImageTag?(r.tag=e.SeriesPrimaryImageTag,t.getScaledImageUrl(e.SeriesId,r)):e.ParentPrimaryImageTag?(r.tag=e.ParentPrimaryImageTag,t.getScaledImageUrl(e.ParentPrimaryImageItemId,r)):null}function m(e,a){for(var t="",i=0,r=e.length;r>i;i++)t+=0===i?a?"<h2>":"<div>":'<div class="secondary">',t+=e[i]||"&nbsp;",t+=0===i&&a?"</h2>":"</div>";return t}function c(i){for(var n=i.items,c="",u=i.action||"link",g="large"==i.imageSize,I=i.enableOverview,p=r.tv?!0:!1,y=p?"button":"div",v=null!=i.enableSideMediaInfo?i.enableSideMediaInfo:p,b="",h=0,f=n.length;f>h;h++){var P=n[h],T="";if(i.showIndex){var A=d(P,i);A!=c&&(T&&(T+="</div>"),T+=0==h?'<h1 class="listGroupHeader first">':'<h1 class="listGroupHeader">',T+=A,T+="</h1>",T+="<div>",c=A)}var C="listItem";p&&(C+=" itemAction");var S=80;g&&(C+=" largeImage",S=500);var x=P.PlaylistItemId?' data-playlistitemid="'+P.PlaylistItemId+'"':"",M=P.UserData&&P.UserData.PlaybackPositionTicks?' data-positionticks="'+P.UserData.PlaybackPositionTicks+'"':"",U=i.collectionId?' data-collectionid="'+i.collectionId+'"':"",w=i.playlistId?' data-playlistid="'+i.playlistId+'"':"",N=P.MediaType?' data-mediatype="'+P.MediaType+'"':"",D=P.CollectionType?' data-collectiontype="'+P.CollectionType+'"':"",H=P.ChannelId?' data-channelid="'+P.ChannelId+'"':"";T+="<"+y+' class="'+C+'" data-index="'+h+'"'+x+' data-action="'+u+'" data-isfolder="'+P.IsFolder+'" data-id="'+P.Id+'" data-serverid="'+P.ServerId+'" data-type="'+P.Type+'"'+N+D+H+M+U+w+">",!p&&i.dragHandle&&(T+='<button is="paper-icon-button-light" class="listViewDragHandle autoSize"><i class="md-icon">&#xE25D;</i></button>');var O=o(P,S);T+=O?'<div class="listItemImage lazy" data-src="'+O+'" item-icon>':'<div class="listItemImage">';var k="";k+=t.getPlayedIndicatorHtml(P),k&&(T+='<div class="indicators">'+k+"</div>");var z=t.getProgressBarHtml(P);z&&(T+=z),T+="</div>";var B=[];i.showParentTitle&&"Episode"==P.Type&&B.push(P.SeriesName||"&nbsp;");var E=e.getDisplayName(P);i.showIndexNumber&&null!=P.IndexNumber&&(E=P.IndexNumber+". "+E),B.push(E),P.ArtistItems&&"MusicAlbum"!=P.Type&&B.push(P.ArtistItems.map(function(e){return e.Name}).join(", ")||"&nbsp;"),P.AlbumArtist&&"MusicAlbum"==P.Type&&B.push(P.AlbumArtist||"&nbsp;"),"Game"==P.Type&&B.push(P.GameSystem||"&nbsp;"),"TvChannel"==P.Type&&P.CurrentProgram&&B.push(e.getDisplayName(P.CurrentProgram)),C="listItemBody",p||(C+=" itemAction"),T+='<div class="'+C+'">';var R="dots-horiz"==l.moreIcon?"&#xE5D3;":"&#xE5D4;";T+=m(B,g),v||(T+='<div class="secondary listItemMediaInfo">'+a.getPrimaryMediaInfoHtml(P)+"</div>"),I&&P.Overview&&(T+='<div class="secondary overview">',T+=P.Overview,T+="</div>"),T+="</div>",v&&(T+='<div class="secondary listItemMediaInfo">'+a.getPrimaryMediaInfoHtml(P,{year:!1,container:!1})+"</div>"),p||(T+='<button is="paper-icon-button-light" class="itemAction autoSize" data-action="menu"><i class="md-icon">'+R+"</i></button>",T+='<span class="listViewUserDataButtons">',T+=s.getIconsHtml({item:P,includePlayed:!1}),T+="</span>"),T+="</"+y+">",b+=T}return b}return{getListViewHtml:c}});