define(["connectionManager","playbackManager","events","inputManager","focusManager","embyRouter"],function(e,t,n){function i(){document.removeEventListener("click",i),document.removeEventListener("keydown",i),window.Notification&&Notification.requestPermission()}function o(e,n){var i=e.ItemsAdded;i.length&&window.Notification&&"granted"===Notification.permission&&(t.isPlayingVideo()||n.getItems(n.getCurrentUserId(),{Recursive:!0,Limit:3,IsFolder:!1,SortBy:"DateCreated",SortOrder:"Descending",ImageTypes:"Primary",Ids:i.join(",")}).then(function(e){for(var t=e.Items,i=0,o=t.length;o>i;i++){var a=t[i],r={title:"New "+a.Type,body:a.Name,timeout:15e3,vibrate:!0,data:{}},c=a.ImageTags||{};c.Primary&&(r.icon=n.getScaledImageUrl(a.Id,{width:80,tag:c.Primary,type:"Primary"}));var s=new Notification(r.title,r);s.show&&s.show(),r.timeout&&setTimeout(function(){s.close?s.close():s.cancel&&s.cancel()},r.timeout)}}))}function a(e,t){var n=this;if("LibraryChanged"===t.MessageType){var i=t.Data;o(i,n)}}function r(e){e&&(n.off(e,"websocketmessage",a),n.on(e,"websocketmessage",a))}document.addEventListener("click",i),document.addEventListener("keydown",i),r(e.currentApiClient()),n.on(e,"apiclientcreated",function(e,t){r(t)})});