define(["browser","css!./style"],function(e){function t(){return e.mobile?!1:!0}function r(){function e(e,t){var r=[{opacity:"0",offset:0},{opacity:"1",offset:1}],a={duration:800,iterations:t,easing:"ease-in"};return e.animate(r,a)}function r(){var e=o;e&&(e.cancel(),o=null)}var a,n=this;n.load=function(r,n,d){var c=new Image;c.onload=function(){if(!a){var c=document.createElement("div");if(c.classList.add("backdropImage"),c.classList.add("displayingBackdropImage"),c.style.backgroundImage="url('"+r+"')",c.setAttribute("data-url",r),n.appendChild(c),!t())return d&&d.parentNode&&d.parentNode.removeChild(d),void i(!0);var u=e(c,1);o=u,u.onfinish=function(){u==o&&(o=null),d&&d.parentNode&&d.parentNode.removeChild(d)},i(!0)}},c.src=r};var o;n.destroy=function(){a=!0,r()}}function a(){return g||(g=document.querySelector(".backdropContainer")),g||(g=document.createElement("div"),g.classList.add("backdropContainer"),document.body.insertBefore(g,document.body.firstChild)),g}function n(e){v&&(v.destroy(),v=null);var t=a();t.innerHTML="",e&&(m=!1),i(!1)}function o(){f||(f=document.querySelector(".skinContainer")),p||m?f.classList.add("withBackdrop"):f.classList.remove("withBackdrop")}function i(e){p=e,o()}function d(e){m=e,o()}function c(e,t){return Math.floor(Math.random()*(t-e)+e)}function u(e){v&&(v.destroy(),v=null);var t=a(),n=t.querySelector(".displayingBackdropImage");if(n&&n.getAttribute("data-url")==e){if(n.getAttribute("data-url")==e)return;n.classList.remove("displayingBackdropImage")}var o=new r;o.load(e,t,n),v=o}function l(e){var t=e.map(function(e){return e.BackdropImageTags&&e.BackdropImageTags.length>0?{id:e.Id,tag:e.BackdropImageTags[0],serverId:e.ServerId}:e.ParentBackdropItemId&&e.ParentBackdropImageTags&&e.ParentBackdropImageTags.length?{id:e.ParentBackdropItemId,tag:e.ParentBackdropImageTags[0],serverId:e.ServerId}:null}).filter(function(e){return null!=e});if(t.length){var r=c(0,t.length-1),a=t[r];require(["connectionManager"],function(e){var t=e.getApiClient(a.serverId),r=t.getScaledImageUrl(a.id,{type:"Backdrop",tag:a.tag,quality:100});s(r)})}else n()}function s(e){e?u(e):n()}var g,f,p,m,v;return{setBackdrops:l,setBackdrop:s,clear:n,externalBackdrop:d}});