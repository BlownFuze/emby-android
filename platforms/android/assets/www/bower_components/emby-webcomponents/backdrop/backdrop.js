define(["browser","css!./style"],function(e){function t(t){return e.mobile?!1:t.animate}function a(){function e(e,t){var a=[{opacity:"0",offset:0},{opacity:"1",offset:1}],r={duration:800,iterations:t,easing:"ease-in"};return e.animate(a,r)}function a(){var e=o;e&&(e.cancel(),o=null)}var r,n=this;n.load=function(a,n,i){var c=new Image;c.onload=function(){if(!r){var c=document.createElement("div");if(c.classList.add("backdropImage"),c.classList.add("displayingBackdropImage"),c.style.backgroundImage="url('"+a+"')",c.setAttribute("data-url",a),n.appendChild(c),!t(c))return i&&i.parentNode&&i.parentNode.removeChild(i),void d(!0);var u=e(c,1);o=u,u.onfinish=function(){u==o&&(o=null),i&&i.parentNode&&i.parentNode.removeChild(i)},d(!0)}},c.src=a};var o;n.destroy=function(){r=!0,a()}}function r(){return f||(f=document.querySelector(".backdropContainer")),f||(f=document.createElement("div"),f.classList.add("backdropContainer"),document.body.insertBefore(f,document.body.firstChild)),f}function n(e){k&&(k.destroy(),k=null);var t=r();t.innerHTML="",o().removeAttribute("data-backdroptype"),e&&(v=!1),d(!1)}function o(){return g||(g=document.querySelector(".skinContainer")),g}function i(){m||v?o().classList.add("withBackdrop"):o().classList.remove("withBackdrop")}function d(e){m=e,i()}function c(e){v=e,i()}function u(e,t){return Math.floor(Math.random()*(t-e)+e)}function s(e){k&&(k.destroy(),k=null);var t=r(),n=t.querySelector(".displayingBackdropImage");if(n&&n.getAttribute("data-url")==e){if(n.getAttribute("data-url")==e)return;n.classList.remove("displayingBackdropImage")}var o=new a;o.load(e,t,n),k=o}function l(e,t){var a=e.map(function(e){return e.BackdropImageTags&&e.BackdropImageTags.length>0?{id:e.Id,tag:e.BackdropImageTags[0],serverId:e.ServerId}:e.ParentBackdropItemId&&e.ParentBackdropImageTags&&e.ParentBackdropImageTags.length?{id:e.ParentBackdropItemId,tag:e.ParentBackdropImageTags[0],serverId:e.ServerId}:null}).filter(function(e){return null!=e});if(a.length){var r=u(0,a.length-1),o=a[r];require(["connectionManager"],function(e){var a=e.getApiClient(o.serverId),r=a.getScaledImageUrl(o.id,{type:"Backdrop",tag:o.tag,quality:100});p(r,t)})}else n()}function p(e,t){e?(s(e),t?o().setAttribute("data-backdroptype",t):o().removeAttribute("data-backdroptype")):n()}var f,g,m,v,k;return{setBackdrops:l,setBackdrop:p,clear:n,externalBackdrop:c}});