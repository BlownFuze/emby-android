define([],function(){function t(e,n){if("function"==typeof e)return t("*",e);if("function"==typeof n)for(var i=new r(e),a=1;a<arguments.length;++a)t.callbacks.push(i.middleware(arguments[a]));else"string"==typeof e?t["string"==typeof n?"redirect":"show"](e,n):t.start(e)}function e(e){if(!e.handled){var n;n=A?P+k.hash.replace("#!",""):k.pathname+k.search,n!==e.canonicalPath&&(t.stop(),e.handled=!1,k.href=e.canonicalPath)}}function n(t){return"string"!=typeof t?t:E?decodeURIComponent(t.replace(/\+/g," ")):t}function i(t,e){"/"===t[0]&&0!==t.indexOf(P)&&(t=P+(A?"#!":"")+t);var i=t.indexOf("?");if(this.canonicalPath=t,this.path=t.replace(P,"")||"/",A&&(this.path=this.path.replace("#!","")||"/"),this.title=document.title,this.state=e||{},this.state.path=t,this.querystring=~i?n(t.slice(i+1)):"",this.pathname=n(~i?t.slice(0,i):t),this.params={},this.hash="",!A){if(!~this.path.indexOf("#"))return;var r=this.path.split("#");this.path=r[0],this.hash=n(r[1])||"",this.querystring=this.querystring.split("#")[0]}}function r(t,e){e=e||{},this.path="*"===t?"(.*)":t,this.method="GET",this.regexp=y(this.path,this.keys=[],e.sensitive,e.strict)}function a(t){var e=t.state||{};return $.navigate===!1?($=e,!0):($=e,!1)}function s(e){if(1===o(e)&&!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){for(var n=e.target;n&&"A"!==n.nodeName;)n=n.parentNode;if(n&&"A"===n.nodeName&&!n.hasAttribute("download")&&"external"!==n.getAttribute("rel")){var i=n.getAttribute("href");if("#"==i)return void e.preventDefault();if((A||n.pathname!==k.pathname||!n.hash&&"#"!==i)&&!(i&&i.indexOf("mailto:")>-1)&&!n.target&&h(n.href)){var r=n.pathname+n.search+(n.hash||""),a=r;0===r.indexOf(P)&&(r=r.substr(P.length)),A&&(r=r.replace("#!","")),P&&a===r||(e.preventDefault(),t.show(a))}}}}function o(t){return t=t||window.event,null===t.which?t.button:t.which}function h(t){var e=k.protocol+"//"+k.hostname;return k.port&&(e+=":"+k.port),t&&0===t.indexOf(e)}function u(t){for(var e,n=[],i=0,r=0,a="";null!=(e=T.exec(t));){var s=e[0],o=e[1],h=e.index;if(a+=t.slice(r,h),r=h+s.length,o)a+=o[1];else{a&&(n.push(a),a="");var u=e[2],c=e[3],l=e[4],f=e[5],d=e[6],v=e[7],g="+"===d||"*"===d,m="?"===d||"*"===d,y=u||"/",w=l||f||(v?".*":"[^"+y+"]+?");n.push({name:c||i++,prefix:u||"",delimiter:y,optional:m,repeat:g,pattern:p(w)})}}return r<t.length&&(a+=t.substr(r)),a&&n.push(a),n}function c(t){return t.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function p(t){return t.replace(/([=!:$\/()])/g,"\\$1")}function l(t,e){return t.keys=e,t}function f(t){return t.sensitive?"":"i"}function d(t,e){var n=t.source.match(/\((?!\?)/g);if(n)for(var i=0;i<n.length;i++)e.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return l(t,e)}function v(t,e,n){for(var i=[],r=0;r<t.length;r++)i.push(y(t[r],e,n).source);var a=new RegExp("(?:"+i.join("|")+")",f(n));return l(a,e)}function g(t,e,n){for(var i=u(t),r=m(i,n),a=0;a<i.length;a++)"string"!=typeof i[a]&&e.push(i[a]);return l(r,e)}function m(t,e){e=e||{};for(var n=e.strict,i=e.end!==!1,r="",a=t[t.length-1],s="string"==typeof a&&/\/$/.test(a),o=0;o<t.length;o++){var h=t[o];if("string"==typeof h)r+=c(h);else{var u=c(h.prefix),p=h.pattern;h.repeat&&(p+="(?:"+u+p+")*"),p=h.optional?u?"(?:"+u+"("+p+"))?":"("+p+")?":u+"("+p+")",r+=p}}return n||(r=(s?r.slice(0,-2):r)+"(?:\\/(?=$))?"),r+=i?"$":n&&s?"":"(?=\\/|$)",new RegExp("^"+r,f(e))}function y(t,e,n){return e=e||[],j(e)?n||(n={}):(n=e,e=[]),t instanceof RegExp?d(t,e,n):j(t)?v(t,e,n):g(t,e,n)}var w,x,b="undefined"!=typeof document&&document.ontouchstart?"touchstart":"click",k="undefined"!=typeof window&&(window.history.location||window.location),O=!0,E=!0,P="",A=!1,R=!1;t.callbacks=[],t.exits=[],t.current="",t.len=0,t.base=function(t){return 0===arguments.length?P:void(P=t)},t.start=function(e){if(e=e||{},!w&&(w=!0,!1===e.dispatch&&(O=!1),!1===e.decodeURLComponents&&(E=!1),!1!==e.popstate&&window.addEventListener("popstate",L,!1),!1!==e.click&&document.addEventListener(b,s,!1),null!=e.enableHistory&&(R=e.enableHistory),!0===e.hashbang&&(A=!0),O)){var n=A&&~k.hash.indexOf("#!")?k.hash.substr(2)+k.search:k.pathname+k.search+k.hash;t.replace(n,null,!0,O)}},t.stop=function(){w&&(t.current="",t.len=0,w=!1,document.removeEventListener(b,s,!1),window.removeEventListener("popstate",L,!1))},t.show=function(e,n,r,a,s){var o=new i(e,n);return o.isBack=s,t.current=o.path,!1!==r&&t.dispatch(o),!1!==o.handled&&!1!==a&&o.pushState(),o},t.back=function(e,n){if(R)return void history.back();if(t.len>0){if(R)history.back();else if(S.length>2){S.length--;var i=S[S.length-1];t.show(i.path,i.state,!0,!1,!0)}t.len--}else setTimeout(e?function(){t.show(e,n)}:function(){t.show(P,n)})},t.enableNativeHistory=function(){return R},t.canGoBack=function(){return R?history.length>1:(t.len||0)>0},t.redirect=function(e,n){"string"==typeof e&&"string"==typeof n&&t(e,function(){setTimeout(function(){t.replace(n)},0)}),"string"==typeof e&&"undefined"==typeof n&&setTimeout(function(){t.replace(e)},0)},t.replace=function(e,n,r,a,s){var o=new i(e,n);return o.isBack=s,t.current=o.path,o.init=r,o.save(),!1!==a&&t.dispatch(o),o},t.dispatch=function(n){function i(){var e=t.exits[o++];return e?void e(a,i):r()}function r(){var i=t.callbacks[s++];return n.path!==t.current?void(n.handled=!1):i?void i(n,r):e(n)}var a=x,s=0,o=0;x=n,a?i():r()},t.exit=function(e){if("function"==typeof e)return t.exit("*",e);for(var n=new r(e),i=1;i<arguments.length;++i)t.exits.push(n.middleware(arguments[i]))},t.Context=i;var S=[];i.prototype.pushState=function(){t.len++,R?history.pushState(this.state,this.title,A&&"/"!==this.path?"#!"+this.path:this.canonicalPath):S.push({state:this.state,title:this.title,url:A&&"/"!==this.path?"#!"+this.path:this.canonicalPath,path:this.path})},i.prototype.save=function(){R?history.replaceState(this.state,this.title,A&&"/"!==this.path?"#!"+this.path:this.canonicalPath):S[t.len||0]={state:this.state,title:this.title,url:A&&"/"!==this.path?"#!"+this.path:this.canonicalPath,path:this.path}},t.Route=r,r.prototype.middleware=function(t){var e=this;return function(n,i){return e.match(n.path,n.params)?t(n,i):void i()}},r.prototype.match=function(t,e){var i=this.keys,r=t.indexOf("?"),a=~r?t.slice(0,r):t,s=this.regexp.exec(decodeURIComponent(a));if(!s)return!1;for(var o=1,h=s.length;h>o;++o){var u=i[o-1],c=n(s[o]);void 0===c&&hasOwnProperty.call(e,u.name)||(e[u.name]=c)}return!0};var $={};t.pushState=function(t,e,n){history.pushState(t,e,n),$=t};var L=function(){var e=!1;if("undefined"!=typeof window)return"complete"===document.readyState?e=!0:window.addEventListener("load",function(){setTimeout(function(){e=!0},0)}),function(n){if(e&&!a(n))if(n.state){var i=n.state.path;t.replace(i,n.state,null,null,!0)}else t.show(k.pathname+k.hash,void 0,void 0,!1,!0)}}();t.sameOrigin=h;var T=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g"),j=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)};return t});