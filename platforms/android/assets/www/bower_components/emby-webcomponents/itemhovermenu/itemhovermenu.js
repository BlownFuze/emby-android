define(["connectionManager","itemHelper","mediaInfo","userdataButtons","playbackManager","globalize","dom","apphost","css!./itemhovermenu","emby-button"],function(e,t,a,i,r,n,o,s){function d(e){var t=e.target;y&&(clearTimeout(y),y=null),t=t.classList.contains("cardOverlayTarget")?t:t.querySelector(".cardOverlayTarget"),t&&c(t)}function c(e){return e.classList.contains("hide")?void 0:e.animate?void requestAnimationFrame(function(){var t=[{transform:"none",offset:0},{transform:"translateY(100%)",offset:1}],a={duration:140,iterations:1,fill:"forwards",easing:"ease-out"};e.animate(t,a).onfinish=function(){e.classList.add("hide")}}):void e.classList.add("hide")}function l(e){e.classList.contains("hide")&&(e.classList.remove("hide"),e.animate&&requestAnimationFrame(function(){var t=[{transform:"translateY(100%)",offset:0},{transform:"none",offset:1}],a={duration:180,iterations:1,fill:"forwards",easing:"ease-out"};e.animate(t,a)}))}function m(e,o,d,c){var l="";l+='<div class="cardOverlayInner">';var m=c.className.toLowerCase(),u=-1!=m.indexOf("mini"),v=u||-1!=m.indexOf("small"),f=-1!=m.indexOf("portrait"),g=v||u||f?null:o.SeriesName,y=t.getDisplayName(o);l+="<div>";var b,h=26;g&&o.ParentLogoItemId?(b=e.getScaledImageUrl(o.ParentLogoItemId,{maxHeight:h,type:"logo",tag:o.ParentLogoImageTag}),l+='<img src="'+b+'" style="max-height:'+h+'px;max-width:100%;" />'):o.ImageTags.Logo?(b=e.getScaledImageUrl(o.Id,{maxHeight:h,type:"logo",tag:o.ImageTags.Logo}),l+='<img src="'+b+'" style="max-height:'+h+'px;max-width:100%;" />'):l+=g||y,l+="</div>",g?(l+="<p>",l+=y,l+="</p>"):v||u||(l+='<div class="cardOverlayMediaInfo">',l+=a.getPrimaryMediaInfoHtml(o,{endsAt:!1}),l+="</div>"),l+='<div class="cardOverlayButtons">';var p=0;r.canPlay(o)&&(l+='<button is="emby-button" class="itemAction autoSize fab cardOverlayFab mini" data-action="playmenu"><i class="md-icon cardOverlayFab-md-icon">&#xE037;</i></button>',p++),o.LocalTrailerCount&&(l+='<button title="'+n.translate("sharedcomponents#Trailer")+'" is="emby-button" class="itemAction autoSize fab cardOverlayFab mini" data-action="playtrailer"><i class="md-icon cardOverlayFab-md-icon">&#xE04B;</i></button>',p++);var L="dots-horiz"==s.moreIcon?"&#xE5D3;":"&#xE5D4;";return l+='<button is="emby-button" class="itemAction autoSize fab cardOverlayFab mini" data-action="menu" data-playoptions="false"><i class="md-icon cardOverlayFab-md-icon">'+L+"</i></button>",p++,l+=i.getIconsHtml({item:o,style:"fab-mini",cssClass:"cardOverlayFab",iconCssClass:"cardOverlayFab-md-icon"}),l+="</div>",l+="</div>"}function u(t){var a=t.querySelector(".cardOverlayTarget");if(!a){a=document.createElement("div"),a.classList.add("hide"),a.classList.add("cardOverlayTarget");var i=t.querySelector("div.cardContent")||t.querySelector(".cardScalable")||t.querySelector(".cardBox");i||(i=t),i.classList.add("withHoverMenu"),i.appendChild(a)}var r=o.parentWithAttribute(t,"data-id");if(r){var n=r.getAttribute("data-id"),s=r.getAttribute("data-type");if("Timer"!=s){var d=r.getAttribute("data-serverid"),c=e.getApiClient(d),u=c.getItem(c.getCurrentUserId(),n),v=c.getCurrentUser();Promise.all([u,v]).then(function(e){var t=e[0],i=e[1];a.innerHTML=m(c,t,i,r)}),l(a)}}}function v(e){var t=e.target,a=o.parentWithClass(t,"cardBox");if(a){if(b===!0)return void(b=!1);y&&(clearTimeout(y),y=null),y=setTimeout(function(){u(a)},1e3)}}function f(){b=!0}function g(e){this.parent=e,this.parent.addEventListener("mouseenter",v,!0),this.parent.addEventListener("mouseleave",d,!0),this.parent.addEventListener("touchstart",f)}var y,b=!1;return g.prototype={constructor:g,destroy:function(){this.parent.removeEventListener("mouseenter",v,!0),this.parent.removeEventListener("mouseleave",d,!0),this.parent.removeEventListener("touchstart",f)}},g});