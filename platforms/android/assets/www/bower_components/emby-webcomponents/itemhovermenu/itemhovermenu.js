define(["connectionManager","itemHelper","mediaInfo","userdataButtons","playbackManager","globalize","dom","apphost","css!./itemhovermenu","emby-button"],function(t,e,a,i,n,r,s,o){function d(t){var e=t.target;p&&(clearTimeout(p),p=null),e=e.classList.contains("cardOverlayTarget")?e:e.querySelector(".cardOverlayTarget"),e&&l(e)}function l(t){return t.classList.contains("hide")?void 0:t.animate?void requestAnimationFrame(function(){var e=[{transform:"translateY(0)",offset:0},{transform:"translateY(100%)",offset:1}],a={duration:180,iterations:1,fill:"forwards",easing:"ease-out"};t.animate(e,a).onfinish=function(){t.classList.add("hide")}}):void t.classList.add("hide")}function c(t){t.classList.contains("hide")&&(t.classList.remove("hide"),t.animate&&requestAnimationFrame(function(){var e=[{transform:"translateY(100%)",offset:0},{transform:"translateY(0)",offset:1}],a={duration:200,iterations:1,fill:"forwards",easing:"ease-out"};t.animate(e,a)}))}function m(t,s,d,l){var c="";c+='<div class="cardOverlayInner">';var m=l.className.toLowerCase(),u=-1!=m.indexOf("mini"),v=u||-1!=m.indexOf("small"),f=-1!=m.indexOf("portrait"),g=v||u||f?null:s.SeriesName,p=e.getDisplayName(s);c+="<div>";var h,y=26;g&&s.ParentLogoItemId?(h=t.getScaledImageUrl(s.ParentLogoItemId,{maxHeight:y,type:"logo",tag:s.ParentLogoImageTag}),c+='<img src="'+h+'" style="max-height:'+y+'px;max-width:100%;" />'):s.ImageTags.Logo?(h=t.getScaledImageUrl(s.Id,{maxHeight:y,type:"logo",tag:s.ImageTags.Logo}),c+='<img src="'+h+'" style="max-height:'+y+'px;max-width:100%;" />'):c+=g||p,c+="</div>",g?(c+="<p>",c+=p,c+="</p>"):v||u||(c+='<div class="cardOverlayMediaInfo">',c+=a.getPrimaryMediaInfoHtml(s,{endsAt:!1}),c+="</div>"),c+='<div class="cardOverlayButtons">';var b=0;n.canPlay(s)&&(c+='<button is="emby-button" class="itemAction autoSize fab mini" data-action="playmenu"><i class="md-icon">&#xE037;</i></button>',b++),s.LocalTrailerCount&&(c+='<button title="'+r.translate("sharedcomponents#Trailer")+'" is="emby-button" class="itemAction autoSize fab mini" data-action="playtrailer"><i class="md-icon">&#xE04B;</i></button>',b++);var L="dots-horiz"==o.moreIcon?"&#xE5D3;":"&#xE5D4;";return c+='<button is="emby-button" class="itemAction autoSize fab mini" data-action="menu" data-playoptions="false"><i class="md-icon">'+L+"</i></button>",b++,c+=i.getIconsHtml({item:s,style:"fab-mini"}),c+="</div>",c+="</div>"}function u(e){var a=e.querySelector(".cardOverlayTarget");if(!a){a=document.createElement("div"),a.classList.add("hide"),a.classList.add("cardOverlayTarget");var i;i=e.classList.contains("cardImageContainer")?s.parentWithClass(e,"cardBox"):e.parentNode,i.appendChild(a)}var n=s.parentWithAttribute(e,"data-id");if(n){var r=n.getAttribute("data-id"),o=n.getAttribute("data-type");if("Timer"!=o){var d=n.getAttribute("data-serverid"),l=t.getApiClient(d),u=l.getItem(l.getCurrentUserId(),r),v=l.getCurrentUser();Promise.all([u,v]).then(function(t){var e=t[0],i=t[1];a.innerHTML=m(l,e,i,n)}),c(a)}}}function v(t){var e=t.target,a=s.parentWithClass(e,"cardImageContainer")||s.parentWithClass(e,"cardImage");if(a){if(h===!0)return void(h=!1);p&&(clearTimeout(p),p=null),p=setTimeout(function(){u(a)},1e3)}}function f(){h=!0}function g(t){this.parent=t,this.parent.addEventListener("mouseenter",v,!0),this.parent.addEventListener("mouseleave",d,!0),this.parent.addEventListener("touchstart",f)}var p,h=!1;return g.prototype={constructor:g,destroy:function(){this.parent.removeEventListener("mouseenter",v,!0),this.parent.removeEventListener("mouseleave",d,!0),this.parent.removeEventListener("touchstart",f)}},g});