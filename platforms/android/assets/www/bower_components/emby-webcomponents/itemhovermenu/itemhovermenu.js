define(["connectionManager","itemHelper","mediaInfo","userdataButtons","playbackManager","globalize","dom","css!./itemhovermenu","emby-button"],function(t,e,a,i,n,r,s){function o(t){var e=t.target;v&&(clearTimeout(v),v=null),e=e.classList.contains("cardOverlayTarget")?e:e.querySelector(".cardOverlayTarget"),e&&d(e)}function d(t){return t.classList.contains("hide")?void 0:t.animate?void requestAnimationFrame(function(){var e=[{transform:"translateY(0)",offset:0},{transform:"translateY(100%)",offset:1}],a={duration:180,iterations:1,fill:"forwards",easing:"ease-out"};t.animate(e,a).onfinish=function(){t.classList.add("hide")}}):void t.classList.add("hide")}function l(t){t.classList.contains("hide")&&(t.classList.remove("hide"),t.animate&&requestAnimationFrame(function(){var e=[{transform:"translateY(100%)",offset:0},{transform:"translateY(0)",offset:1}],a={duration:200,iterations:1,fill:"forwards",easing:"ease-out"};t.animate(e,a)}))}function c(t,s,o,d){var l="";l+='<div class="cardOverlayInner">';var c=d.className.toLowerCase(),m=-1!=c.indexOf("mini"),u=m||-1!=c.indexOf("small"),g=-1!=c.indexOf("portrait"),f=u||m||g?null:s.SeriesName,v=e.getDisplayName(s);l+="<div>";var p,h=26;f&&s.ParentLogoItemId?(p=t.getScaledImageUrl(s.ParentLogoItemId,{maxHeight:h,type:"logo",tag:s.ParentLogoImageTag}),l+='<img src="'+p+'" style="max-height:'+h+'px;max-width:100%;" />'):s.ImageTags.Logo?(p=t.getScaledImageUrl(s.Id,{maxHeight:h,type:"logo",tag:s.ImageTags.Logo}),l+='<img src="'+p+'" style="max-height:'+h+'px;max-width:100%;" />'):l+=f||v,l+="</div>",f?(l+="<p>",l+=v,l+="</p>"):u||m||(l+='<div class="cardOverlayMediaInfo">',l+=a.getPrimaryMediaInfoHtml(s,{endsAt:!1}),l+="</div>"),l+='<div class="cardOverlayButtons">';var y=0;return n.canPlay(s)&&(l+='<button is="emby-button" class="itemAction autoSize fab mini" data-action="playmenu"><i class="md-icon">&#xE037;</i></button>',y++),s.LocalTrailerCount&&(l+='<button title="'+r.translate("sharedcomponents#Trailer")+'" is="emby-button" class="itemAction autoSize fab mini" data-action="playtrailer"><i class="md-icon">&#xE04B;</i></button>',y++),l+='<button is="emby-button" class="itemAction autoSize fab mini" data-action="menu" data-playoptions="false"><i class="md-icon">&#xE5D4;</i></button>',y++,l+=i.getIconsHtml({item:s,style:"fab-mini"}),l+="</div>",l+="</div>"}function m(e){var a=e.querySelector(".cardOverlayTarget");if(!a){a=document.createElement("div"),a.classList.add("hide"),a.classList.add("cardOverlayTarget");var i;i=e.classList.contains("cardImageContainer")?s.parentWithClass(e,"cardBox"):e.parentNode,i.appendChild(a)}var n=s.parentWithAttribute(e,"data-id"),r=n.getAttribute("data-id"),o=n.getAttribute("data-type");if("Timer"!=o){var d=n.getAttribute("data-serverid"),m=t.getApiClient(d),u=m.getItem(m.getCurrentUserId(),r),g=m.getCurrentUser();Promise.all([u,g]).then(function(t){var e=t[0],i=t[1];a.innerHTML=c(m,e,i,n)}),l(a)}}function u(t){var e=t.target,a=s.parentWithClass(e,"cardImageContainer")||s.parentWithClass(e,"cardImage");if(a){if(p===!0)return void(p=!1);v&&(clearTimeout(v),v=null),v=setTimeout(function(){m(a)},1e3)}}function g(){p=!0}function f(t){this.parent=t,this.parent.addEventListener("mouseenter",u,!0),this.parent.addEventListener("mouseleave",o,!0),this.parent.addEventListener("touchstart",g)}var v,p=!1;return f.prototype={constructor:f,destroy:function(){this.parent.removeEventListener("mouseenter",u,!0),this.parent.removeEventListener("mouseleave",o,!0),this.parent.removeEventListener("touchstart",g)}},f});