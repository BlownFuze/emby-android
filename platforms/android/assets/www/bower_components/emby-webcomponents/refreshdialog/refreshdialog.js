define(["shell","dialogHelper","loading","layoutManager","connectionManager","embyRouter","globalize","emby-input","emby-checkbox","paper-icon-button-light","emby-select","material-icons","css!./../formdialog","emby-button"],function(e,t,a,n,o,s,l){function r(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function i(){var e="";return e+='<div class="formDialogContent smoothScrollY" style="padding-top:2em;">',e+='<div class="dialogContentInner dialog-content-centered">',e+='<form style="margin:auto;">',e+='<div class="fldSelectPlaylist selectContainer">',e+='<select is="emby-select" id="selectMetadataRefreshMode" label="'+l.translate("sharedcomponents#LabelRefreshMode")+'">',e+='<option value="missing">'+l.translate("sharedcomponents#SearchForMissingMetadata")+"</option>",e+='<option value="all" selected>'+l.translate("sharedcomponents#ReplaceAllMetadata")+"</option>",e+="</select>",e+="</div>",e+='<label class="checkboxContainer">',e+='<input type="checkbox" is="emby-checkbox" class="chkReplaceImages" />',e+="<span>"+l.translate("sharedcomponents#ReplaceExistingImages")+"</span>",e+="</label>",e+='<div class="fieldDescription">',e+=l.translate("sharedcomponents#RefreshDialogHelp"),e+="</div>",e+="<br />",e+="<div>",e+='<button is="emby-button" type="submit" class="raised btnSubmit block" autofocus>'+l.translate("sharedcomponents#ButtonOk")+"</button>",e+="</div>",e+='<input type="hidden" class="fldSelectedItemIds" />',e+="</form>",e+="</div>",e+="</div>"}function c(e,t,a){require(["scrollHelper"],function(n){var o=a?"on":"off";n.centerFocus[o](e,t)})}return function(e){function s(n){a.show();var s=r(this,"dialog"),i=o.getApiClient(e.serverId),c=s.querySelector(".chkReplaceImages").checked,d="all"==s.querySelector("#selectMetadataRefreshMode").value;return e.itemIds.forEach(function(e){i.refreshItem(e,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:c,ReplaceAllMetadata:d})}),t.close(s),require(["toast"],function(e){e(l.translate("sharedcomponents#RefreshQueued"))}),a.hide(),n.preventDefault(),!1}function d(e){e.querySelector("form").addEventListener("submit",s)}var u=this;u.show=function(){var e={removeOnClose:!0,scrollY:!1};e.size=n.tv?"fullscreen":"small";var a=t.createDialog(e);a.classList.add("formDialog");var o="",s=l.translate("sharedcomponents#RefreshMetadata");return o+='<div class="formDialogHeader">',o+='<button is="paper-icon-button-light" class="btnCancel autoSize" tabindex="-1"><i class="md-icon">&#xE5C4;</i></button>',o+='<div class="formDialogHeaderTitle">',o+=s,o+="</div>",o+="</div>",o+=i(),a.innerHTML=o,document.body.appendChild(a),d(a),a.querySelector(".btnCancel").addEventListener("click",function(){t.close(a)}),n.tv&&c(a.querySelector(".formDialogContent"),!1,!0),new Promise(function(e){n.tv&&c(a.querySelector(".formDialogContent"),!1,!1),a.addEventListener("close",e),t.open(a)})}}});