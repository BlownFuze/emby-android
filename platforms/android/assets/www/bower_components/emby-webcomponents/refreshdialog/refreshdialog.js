define(["shell","dialogHelper","loading","layoutManager","connectionManager","scrollHelper","embyRouter","globalize","emby-input","emby-checkbox","paper-icon-button-light","emby-select","material-icons","css!./../formdialog","emby-button"],function(e,t,a,n,s,l,o,i){function r(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function c(){var e="";return e+='<div class="dialogContent smoothScrollY">',e+='<div class="dialogContentInner centeredContent">',e+='<form style="margin:auto;">',e+='<div class="fldSelectPlaylist selectContainer">',e+='<select is="emby-select" id="selectMetadataRefreshMode" label="'+i.translate("sharedcomponents#LabelRefreshMode")+'">',e+='<option value="missing">'+i.translate("sharedcomponents#SearchForMissingMetadata")+"</option>",e+='<option value="all" selected>'+i.translate("sharedcomponents#ReplaceAllMetadata")+"</option>",e+="</select>",e+="</div>",e+='<label class="checkboxContainer">',e+='<input type="checkbox" is="emby-checkbox" class="chkReplaceImages" />',e+="<span>"+i.translate("sharedcomponents#ReplaceExistingImages")+"</span>",e+="</label>",e+='<div class="fieldDescription">',e+=i.translate("sharedcomponents#RefreshDialogHelp"),e+="</div>",e+="<br />",e+="<div>",e+='<button is="emby-button" type="submit" class="raised btnSubmit block" autofocus>'+i.translate("sharedcomponents#ButtonOk")+"</button>",e+="</div>",e+='<input type="hidden" class="fldSelectedItemIds" />',e+="</form>",e+="</div>",e+="</div>"}return function(e){function o(n){a.show();var l=r(this,"dialog"),o=s.getApiClient(e.serverId),c=l.querySelector(".chkReplaceImages").checked,d="all"==l.querySelector("#selectMetadataRefreshMode").value;return e.itemIds.forEach(function(e){o.refreshItem(e,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:c,ReplaceAllMetadata:d})}),t.close(l),require(["toast"],function(e){e(i.translate("sharedcomponents#RefreshQueued"))}),a.hide(),n.preventDefault(),!1}function d(e){e.querySelector("form").addEventListener("submit",o)}var u=this;u.show=function(){var e={removeOnClose:!0,scrollY:!1};e.size=n.tv?"fullscreen":"small";var a=t.createDialog(e);a.classList.add("formDialog");var s="",o=i.translate("sharedcomponents#RefreshMetadata");return s+='<div class="dialogHeader" style="margin:0 0 2em;">',s+='<button is="paper-icon-button-light" class="btnCancel autoSize" tabindex="-1"><i class="md-icon">&#xE5C4;</i></button>',s+='<div class="dialogHeaderTitle">',s+=o,s+="</div>",s+="</div>",s+=c(),a.innerHTML=s,document.body.appendChild(a),d(a),a.querySelector(".btnCancel").addEventListener("click",function(){t.close(a)}),n.tv&&l.centerFocus.on(a.querySelector(".dialogContent"),!1),new Promise(function(e){a.addEventListener("close",e),t.open(a)})}}});