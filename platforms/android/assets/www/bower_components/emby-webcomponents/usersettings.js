define(["appSettings","apiClientResolver","events"],function(n,e,t){function r(){var n=e();return n?n.getCurrentUserId():null}var u=function(){var u=this;u.set=function(e,i){var a=r();if(!a)throw new Error("userId cannot be null");var o=u.get(e);n.set(e,i,a),o!=i&&t.trigger(u,"change",[e])},u.get=function(e){var t=r();if(!t)throw new Error("userId cannot be null");return n.get(e,t)},u.enableCinemaMode=function(n){return null!=n&&u.set("enableCinemaMode",n.toString()),n=u.get("enableCinemaMode"),n?"false"!=n:!0},u.language=function(n){return null!=n&&u.set("language",n.toString()),u.get("language")},u.skipLength=function(n){return null!=n&&u.set("skipLength",n.toString()),parseInt(u.get("skipLength")||"15000")},u.serverConfig=function(n){return n?e().updateUserConfiguration(r(),n):e().getUser(r()).then(function(n){return n.Configuration})}};return new u});