define(["playbackManager","inputManager","connectionManager","embyRouter","globalize","loading"],function(t,e,i,n,r,a){function o(e,i){for(var n=e.parentNode.querySelectorAll(".itemAction[data-id]"),r=[],a=!1,o=0,d=n.length;d>o;o++)n[o]==e&&(a=!0),a&&r.push(n[o].getAttribute("data-id"));t.play({ids:r,serverId:i})}function d(t,e){var n=i.getApiClient(e),r=n.getCurrentUserId();return n.getItem(r,t).then(function(e){return n.getItems(r,{MediaTypes:"Photo",Filters:"IsNotFolder",ParentId:e.ParentId}).then(function(e){var i=e.Items,n=i.map(function(t){return t.Id}).indexOf(t);-1==n&&(n=0),require(["slideshow"],function(t){var e=new t({showTitle:!1,cover:!1,items:i,startIndex:n,interval:8e3,interactive:!0});e.show()})})})}function s(t){return"Photo"==t.Type?void d(t.Id,t.ServerId):void n.showItem(t)}function u(e,i){var n=e.getAttribute("data-id"),r=e.getAttribute("data-serverid"),a=e.getAttribute("data-type"),d="true"==e.getAttribute("data-isfolder");if("link"==i)s({Id:n,Type:a,IsFolder:d,ServerId:r});else if("instantmix"==i)t.instantMix(n,r);else if("play"==i){var u=parseInt(e.getAttribute("data-startpositionticks")||"0");t.play({ids:[n],startPositionTicks:u,serverId:r})}else"playallfromhere"==i?o(e,r):"setplaylistindex"==i||"record"==i&&c(r,n,a,e.getAttribute("data-timerid"),e.getAttribute("data-seriestimerid"))}function c(t,e,n,r,a){var o=i.getApiClient(t);a||r||"Program"==n&&l(o,e)}function l(t,e){a.show(),t.getNewLiveTvTimerDefaults({programId:e}).then(function(e){t.createLiveTvTimer(e).then(function(){a.hide(),f(r.translate("sharedcomponents#RecordingScheduled"))})})}function f(t){require(["toast"],function(e){e(t)})}function v(t){var e=g(t.target,"itemAction");if(e){var i=e.getAttribute("data-action");i&&u(e,i)}}function g(t,e){for(;!t.classList||!t.classList.contains(e);)if(t=t.parentNode,!t)return null;return t}function m(t){var e=t.detail.command;if("play"==e||"record"==e){var i=g(t.target,"itemAction");i&&u(i,e)}}function p(t){t.addEventListener("click",v),e.on(t,m)}function I(t){t.removeEventListener("click",v),e.off(t,m)}return{on:p,off:I}});