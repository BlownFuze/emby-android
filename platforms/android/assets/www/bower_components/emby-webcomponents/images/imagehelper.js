define(["visibleinviewport","imageFetcher","layoutManager","events","browser","dom"],function(e,t,n,r,i,a){function o(){b={innerHeight:window.innerHeight,innerWidth:window.innerWidth}}function s(){var e=screen.availWidth,t=screen.availHeight;n.mobile&&(e*=2,t*=2),p=e,w=t,o()}function v(t){return e(t,!0,p,w,b)}function u(e,r,i){r||(r=e.getAttribute("data-src")),r&&(I&&!n.tv&&i!==!1?t.loadImage(e,r).then(c):t.loadImage(e,r),e.removeAttribute("data-src"))}function c(e){var t=n.tv?160:300,r=[{opacity:"0",offset:0},{opacity:"1",offset:1}],i={duration:t,iterations:1};e.animate(r,i)}function f(e){for(var t=0,n=e.length;n>t;t++)e[t]=!0}function l(e){for(var t=0,n={},r=new IntersectionObserver(function(e){for(var n=0,i=e.length;i>n;n++){var a=e[n],o=a.target;r.unobserve(o),u(o),t++}},n),i=0,a=e.length;a>i;i++)r.observe(e[i])}function d(e,t){function n(t){for(var n=!1,s=!1,c=0,f=e.length;f>c;c++){if(o[t])return;if(!i[c]){var l=e[c];!s&&v(l)?(n=!0,i[c]=!0,u(l)):n&&(s=!0)}}e.length||(a.removeEventListener(document,"focus",r,{capture:!0,passive:!0}),a.removeEventListener(document,"scroll",r,{capture:!0,passive:!0}),a.removeEventListener(document,L,r,{capture:!0,passive:!0}),a.removeEventListener(window,"resize",r,{capture:!0,passive:!0}))}function r(){f(o);var e=o.length;o.length++,setTimeout(function(){n(e)},1)}if(e.length){if(E)return void l(e,t);var i=[],o=[];a.addEventListener(document,"focus",r,{capture:!0,passive:!0}),a.addEventListener(document,"scroll",r,{capture:!0,passive:!0}),a.addEventListener(document,L,r,{capture:!0,passive:!0}),a.addEventListener(window,"resize",r,{capture:!0,passive:!0}),r()}}function h(e){d(e.getElementsByClassName("lazy"),e)}function m(e){for(var t=[],n=0,r=e.length;r>n;n++){var i=e[n].PrimaryImageAspectRatio||0;i&&(t[t.length]=i)}if(!t.length)return null;t.sort(function(e,t){return e-t});var a,o=Math.floor(t.length/2);a=t.length%2?t[o]:(t[o-1]+t[o])/2;var s=2/3;if(Math.abs(s-a)<=.15)return s;var v=16/9;if(Math.abs(v-a)<=.2)return v;if(Math.abs(1-a)<=.15)return 1;var u=4/3;return Math.abs(u-a)<=.15?u:a}function g(e){for(var t=0,n=e.length;n>t;t++){var r=e[0];u(r)}}var p,w,b,E=function(){if(window.IntersectionObserver){if(i.chrome){var e=parseInt(i.version.split(".")[0]);return e>=51}return!0}return!1}();E||(window.addEventListener("orientationchange",s),window.addEventListener("resize",s),r.on(n,"modechange",s),s());var L=document.implementation.hasFeature("Event.wheel","3.0")?"wheel":"mousewheel",y={},I=i.animate&&!i.slow;return y.fillImages=g,y.lazyImage=u,y.lazyChildren=h,y.getPrimaryImageAspectRatio=m,y});