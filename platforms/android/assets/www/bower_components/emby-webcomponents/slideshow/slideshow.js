define(["dialogHelper","inputManager","connectionManager","layoutManager","focusManager","apphost","css!./style","html!./icons","iron-icon-set","paper-icon-button","paper-spinner"],function(e,t,i,a,n,o){function s(e,t,i){return t=t||{},t.type=t.type||"Primary","string"==typeof e?i.getScaledImageUrl(e,t):e.ImageTags&&e.ImageTags[t.type]?(t.tag=e.ImageTags[t.type],i.getScaledImageUrl(e.Id,t)):"Primary"==t.type&&e.AlbumId&&e.AlbumPrimaryImageTag?(t.tag=e.AlbumPrimaryImageTag,i.getScaledImageUrl(e.AlbumId,t)):null}function r(e,t,i){return t=t||{},t.type=t.type||"Backdrop",t.width=null,delete t.width,t.maxWidth=null,delete t.maxWidth,t.maxHeight=null,delete t.maxHeight,t.height=null,delete t.height,t.maxWidth||t.width||t.maxHeight||t.height||(t.quality=100),e.BackdropImageTags&&e.BackdropImageTags.length?(t.tag=e.BackdropImageTags[0],i.getScaledImageUrl(e.Id,t)):null}function l(e,t){var a=i.getApiClient(e.ServerId),n={};return t||(n.maxWidth=screen.availWidth),e.BackdropImageTags&&e.BackdropImageTags.length?r(e,n,a):"Photo"==e.MediaType&&t?a.getUrl("Items/"+e.Id+"/Download",{api_key:a.accessToken()}):(n.type="Primary",s(e,n,a))}return function(i){function s(i){C=e.createDialog({exitAnimationDuration:i.interactive?400:800,size:"fullscreen",autoFocus:!1}),C.classList.add("slideshowDialog");var a="";if(i.interactive?(a+="<div>",a+='<div class="slideshowSwiperContainer"><div class="swiper-wrapper"></div></div>',a+='<paper-icon-button icon="slideshow:keyboard-arrow-left" class="btnSlideshowPrevious slideshowButton" tabindex="-1"></paper-icon-button>',a+='<paper-icon-button icon="slideshow:keyboard-arrow-right" class="btnSlideshowNext slideshowButton" tabindex="-1"></paper-icon-button>',a+='<paper-icon-button icon="slideshow:close" class="btnSlideshowExit" tabindex="-1"></paper-icon-button>',a+='<div class="slideshowBottomBar hide">',a+='<paper-icon-button icon="slideshow:pause" class="btnSlideshowPause slideshowButton" autoFocus></paper-icon-button>',o.supports("filedownload")&&(a+='<paper-icon-button icon="slideshow:file-download" class="btnDownload slideshowButton"></paper-icon-button>'),a+="</div>",a+="</div>"):a+='<div class="slideshowImage"></div><h1 class="slideshowImageText"></h1>',C.innerHTML=a,i.interactive){C.querySelector(".btnSlideshowExit").addEventListener("click",function(){e.close(C)}),C.querySelector(".btnSlideshowNext").addEventListener("click",f),C.querySelector(".btnSlideshowPrevious").addEventListener("click",m);var n=C.querySelector(".btnSlideshowPause");n&&n.addEventListener("click",I);var s=C.querySelector(".btnDownload");s&&s.addEventListener("click",g);var l=C.querySelector(".btnShare");l&&l.addEventListener("click",w)}document.body.appendChild(C),e.open(C).then(function(){H(),C.parentNode.removeChild(C)}),t.on(window,D),document.addEventListener("mousemove",M),C.addEventListener("close",S),i.interactive&&r(C)}function r(e){e.querySelector(".swiper-wrapper").innerHTML=F.slides?F.slides.map(p).join(""):F.items.map(c).join(""),require(["swiper"],function(){z=new Swiper(e.querySelector(".slideshowSwiperContainer"),{direction:"horizontal",loop:i.loop!==!1,autoplay:i.interval||8e3,preloadImages:!1,lazyLoading:!0,autoplayDisableOnInteraction:!1,initialSlide:i.startIndex||0}),z.on("onLazyImageLoad",d),z.on("onLazyImageReady",u),a.mobile?b():y()})}function c(e){return p({imageUrl:l(e),originalImage:l(e,!0),Id:e.Id})}function d(e,t){var i=t.querySelector("paper-spinner");i&&(i.active=!0)}function u(e,t){var i=t.querySelector("paper-spinner");i&&(i.active=!1,i.parentNode.removeChild(i))}function p(e){var t="";return t+='<div class="swiper-slide" data-original="'+e.originalImage+'" data-itemid="'+e.Id+'">',t+='<img data-src="'+e.imageUrl+'" class="swiper-lazy">',t+="<paper-spinner></paper-spinner>",(e.title||e.subtitle)&&(t+='<div class="slideText">',t+='<div class="slideTextInner">',e.title&&(t+='<div class="slideTitle">',t+=e.title,t+="</div>"),e.description&&(t+='<div class="slideSubtitle">',t+=e.description,t+="</div>"),t+="</div>",t+="</div>"),t+="</div>"}function m(){z?z.slidePrev():(H(),N(j-1))}function f(){if(z){if(i.loop===!1&&z.activeIndex>=z.slides.length-1)return void e.close(C);z.slideNext()}else H(),N(j+1)}function h(){return z?document.querySelector(".swiper-slide-active").getAttribute("data-itemid"):null}function v(){return z?document.querySelector(".swiper-slide-active").getAttribute("data-original"):null}function g(){var e=v(),t=h();alert(t),require(["fileDownloader"],function(i){i.download([{url:e,itemId:t}])})}function w(){}function y(){C.querySelector(".btnSlideshowPause").icon="slideshow:pause",z.startAutoplay()}function b(){C.querySelector(".btnSlideshowPause").icon="slideshow:play-arrow",z.stopAutoplay()}function I(){var e="slideshow:pause"!=C.querySelector(".btnSlideshowPause").icon;e?y():b()}function S(){var e=z;e&&(e.off("onLazyImageLoad"),e.off("onLazyImageReady"),e.destroy(!0,!0),z=null),t.off(window,D),document.removeEventListener("mousemove",M)}function x(e){F=e,H(),s(e),e.interactive||(W=e.interval||8e3,N(e.startIndex||0,!0))}function L(){return Y}function T(){return C.querySelector(".slideshowBottomBar")}function q(){A(T()),P()}function k(){E(T())}function P(){B(),R=setTimeout(k,4e3)}function B(){R&&(clearTimeout(R),R=null)}function A(e){e.classList.contains("hide")&&(Y=!0,e.classList.remove("hide"),requestAnimationFrame(function(){var t=[{transform:"translate3d(0,"+e.offsetHeight+"px,0)",opacity:".3",offset:0},{transform:"translate3d(0,0,0)",opacity:"1",offset:1}],i={duration:300,iterations:1,easing:"ease-out"};e.animate(t,i).onfinish=function(){n.focus(e.querySelector(".btnSlideshowPause"))}}))}function E(e){e.classList.contains("hide")||requestAnimationFrame(function(){var t=[{transform:"translate3d(0,0,0)",opacity:"1",offset:0},{transform:"translate3d(0,"+e.offsetHeight+"px,0)",opacity:".3",offset:1}],i={duration:300,iterations:1,easing:"ease-out"};e.animate(t,i).onfinish=function(){e.classList.add("hide"),Y=!1}})}function M(e){var t=e.screenX||0,i=e.screenY||0,a=O;return a?void(Math.abs(t-a.x)<10&&Math.abs(i-a.y)<10||(a.x=t,a.y=i,q())):void(O={x:t,y:i})}function D(e){switch(e.detail.command){case"left":L()||(e.preventDefault(),m());break;case"right":L()||(e.preventDefault(),f());break;case"up":case"down":case"select":case"menu":case"info":case"play":case"playpause":case"pause":case"fastforward":case"rewind":case"next":case"previous":q()}}function N(e,t){e=Math.max(0,e),e>=F.items.length&&(e=0),j=e;var i=F,a=i.items,n=a[e],o=l(n),s=function(){var t=C.querySelector(".slideshowImage"),a=document.createElement("div");a.className=t.className,i.cover&&a.classList.add("cover"),a.style.backgroundImage="url('"+o+"')",a.classList.add("hide"),t.parentNode.appendChild(a),C.querySelector(".slideshowImageText").innerHTML=i.showTitle?n.Name:"",a.classList.remove("hide");var s=function(){var e=t.parentNode;e&&e.removeChild(t)};if(a.animate){var r=[{opacity:"0",offset:0},{opacity:"1",offset:1}],l={duration:1200,iterations:1};a.animate(r,l).onfinish=s}else s();H(),U=setTimeout(function(){N(e+1,!0)},W)};if(t)s();else{var r=new Image;r.onload=s,r.src=o}}function H(){U&&(clearTimeout(U),U=null)}var z,C,U,W,F,j,R,O,X=this,Y=!1;X.show=function(){x(i)},X.hide=function(){var t=C;t&&e.close(t)}}});