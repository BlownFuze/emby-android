define(["browser","layoutManager","dom","scrollStyles"],function(e,t,n){function o(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?Object.prototype.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof e}function r(e,t){e.preventDefault(),t&&e.stopPropagation()}function i(e){r(e,1),this.removeEventListener(e.type,i)}function a(e,t,n){return t>e?t:e>n?n:e}var s="sly",l=s,d=["mousemove","mouseup"],c=["touchmove","touchend"],u=document.implementation.hasFeature("Event.wheel","3.0")?"wheel":"mousewheel",f=["INPUT","SELECT","TEXTAREA"],h=Math.abs,p=Math.sqrt,v=Math.pow,g=Math.round,m=Math.max,y=(Math.min,function(s,y){function w(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}function E(e){F=L(V,j.horizontal?"width":"height");var t=j.scrollWidth||Math.max(q[j.horizontal?"offsetWidth":"offsetHeight"],q[j.horizontal?"scrollWidth":"scrollHeight"]);U.start=0,U.end=m(t-F,0),e||T(a(U.dest,U.start,U.end))}function L(e,t,n){var o=!0,r="width"===t?e.offsetWidth:e.offsetHeight,i=getComputedStyle(e,null),a="border-box"===i.getPropertyValue("box-sizing");if(0>=r||null==r){if((0>r||null==r)&&(r=e.style[t]),nt.test(r))return r;o=a&&(support.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+S(e,t,n||(a?"border":"content"),o,i)}function S(e,t,n,o){for(var r=n===(o?"border":"content")?4:"width"===t?1:0,i=0;4>r;r+=2);return i}function z(e,t,n){!n&&e.scrollTo?j.horizontal?e.scrollTo(t,0):e.scrollTo(0,t):j.horizontal?e.scrollLeft=Math.round(t):e.scrollTop=Math.round(t)}function T(e,t){return Z.init&&Z.slidee&&j.elasticBounds?e>U.end?e=U.end+(e-U.end)/6:e<U.start&&(e=U.start+(e-U.start)/6):e=a(e,U.start,U.end),$?(Q.from=U.cur,Q.to=e,Q.tweesing=Z.tweese||Z.init&&!Z.slidee,Q.immediate=!Q.tweesing&&(t||Z.init&&Z.slidee||!j.speed),Z.tweese=0,void(e!==U.dest&&(U.dest=e,b(Q)))):void z(q,e,t)}function b(){if($){var t=getComputedStyle(q,null).getPropertyValue("transform").match(/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/);t&&(U.cur=-1*parseInt(j.horizontal?t[1]:t[2]));var n;Q.to=g(Q.to),n=j.horizontal?[{transform:"translate3d("+-g(U.cur||Q.from)+"px, 0, 0)",offset:0},{transform:"translate3d("+-g(Q.to)+"px, 0, 0)",offset:1}]:[{transform:"translate3d(0, "+-g(U.cur||Q.from)+"px, 0)",offset:0},{transform:"translate3d(0, "+-g(Q.to)+"px, 0)",offset:1}];var o=j.speed;Q.immediate&&(o=j.immediateSpeed||50,e.animate||(j.immediateSpeed=0));var r={duration:o,iterations:1,fill:"both"};(!Q.immediate||e.animate)&&(r.easing="ease-out");var i=q.animate(n,r);i.onfinish=function(){U.cur=Q.to,document.dispatchEvent(ot)}}}function X(e){var t=document,n=[];if(!t)return n;for(var o,r,i=t.documentElement,a={clientTop:i.clientTop,clientLeft:i.clientLeft},s=t.defaultView,l={pageXOffset:s.pageXOffset,pageYOffset:s.pageYOffset},d=0,c=e.length;c>d;d++)r=e[d],o=r.getBoundingClientRect?r.getBoundingClientRect():{top:0,left:0},n[d]={top:o.top+l.pageYOffset-a.clientTop,left:o.left+l.pageXOffset-a.clientLeft};return n}function Y(e,t,n){if("boolean"===o(t)&&(n=t,t=void 0),void 0===t)T(U[e],n);else{var r=A.getPos(t);r&&T(r[e],n,!0)}}function x(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}function C(){Z.history[0]=Z.history[1],Z.history[1]=Z.history[2],Z.history[2]=Z.history[3],Z.history[3]=Z.delta}function D(e){Z.released=0,Z.source=e,Z.slidee="slidee"===e}function k(e){M(e,"slidee")}function M(e,t){var n="touchstart"===e.type,o="slidee"===t;Z.init||!n&&O(e.target)||(!o||(n?j.touchDragging:j.mouseDragging&&e.which<2))&&(n||r(e),D(t),Z.init=0,Z.source=e.target,Z.touch=n,Z.pointer=n?e.touches[0]:e,Z.initX=Z.pointer.pageX,Z.initY=Z.pointer.pageY,Z.initPos=o?U.cur:G.cur,Z.start=+new Date,Z.time=0,Z.path=0,Z.delta=0,Z.locked=0,Z.history=[0,0,0,0],Z.pathToLock=o?n?30:10:0,n?c.forEach(function(e){document.addEventListener(e,P)}):d.forEach(function(e){document.addEventListener(e,P)}),o&&q.classList.add(j.draggedClass),o&&(et=setInterval(C,10)))}function P(e){if(Z.released="mouseup"===e.type||"touchend"===e.type,Z.pointer=Z.touch?e[Z.released?"changedTouches":"touches"][0]:e,Z.pathX=Z.pointer.pageX-Z.initX,Z.pathY=Z.pointer.pageY-Z.initY,Z.path=p(v(Z.pathX,2)+v(Z.pathY,2)),Z.delta=j.horizontal?Z.pathX:Z.pathY,Z.released||!(Z.path<1)){if(!Z.init){if(Z.path<j.dragThreshold)return Z.released?B():void 0;if(!(j.horizontal?h(Z.pathX)>h(Z.pathY):h(Z.pathX)<h(Z.pathY)))return B();Z.init=1}r(e),!Z.locked&&Z.path>Z.pathToLock&&Z.slidee&&(Z.locked=1,Z.source.addEventListener("click",i)),Z.released&&(B(),j.releaseSwing&&Z.slidee&&(Z.swing=(Z.delta-Z.history[0])/40*300,Z.delta+=Z.swing,Z.tweese=h(Z.swing)>10)),T(Z.slidee?g(Z.initPos-Z.delta):handleToSlidee(Z.initPos+Z.delta))}}function B(){clearInterval(et),Z.released=!0,Z.touch?c.forEach(function(e){document.removeEventListener(e,P)}):d.forEach(function(e){document.removeEventListener(e,P)}),Z.slidee&&q.classList.remove(j.draggedClass),setTimeout(function(){Z.source.removeEventListener("click",i)}),Z.init=0}function O(e){for(;e;){if(-1!=f.indexOf(e.tagName))return!0;e=e.parentNode}return!1}function N(e){return _.curDelta=(j.horizontal?e.deltaY||e.deltaX:e.deltaY)||-e.wheelDelta,$&&(_.curDelta/=1===e.deltaMode?3:100),_.curDelta}function W(e){if(e[l]=A,j.scrollBy&&U.start!==U.end){var t=N(e);$?(t>0&&U.dest<U.end||0>t&&U.dest>U.start,A.slideBy(j.scrollBy*t)):(I&&(t*=12),j.horizontal?q.scrollLeft+=t:q.scrollTop+=t)}}function H(){E(!1)}function R(){j.horizontal?this.scrollLeft=0:this.scrollTop=0}var j=x({},{slidee:null,horizontal:!1,scrollSource:null,scrollBy:0,scrollHijack:300,dragSource:null,mouseDragging:1,touchDragging:1,releaseSwing:!1,swingSpeed:.2,elasticBounds:!1,dragThreshold:3,intervactive:null,speed:0,draggedClass:"dragged",activeClass:"active",disabledClass:"disabled"},y),I="scrollBehavior"in document.documentElement.style;e.operaTv?y.enableNativeScroll=!1:I&&e.firefox?y.enableNativeScroll=!0:y.requireAnimation?y.enableNativeScroll=!1:(t.desktop||!e.animate)&&(y.enableNativeScroll=!0);var A=this;A.options=j;var V=s,q=j.slidee?j.slidee:w(V.firstChild)[0],F=0,U={start:0,center:0,end:0,cur:0,dest:0},$=!y.enableNativeScroll,G={start:0,end:0,cur:0},J=j.scrollSource?j.scrollSource:V,K=j.dragSource?j.dragSource:V,Q={},Z={released:1},_={last:0,delta:0,resetTime:200},et=0;s=V,A.initialized=0,A.frame=s,A.slidee=q,A.options=j,A.dragging=Z;var tt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,nt=new RegExp("^("+tt+")(?!px)[a-z%]+$","i");A.reload=function(){E()};var ot=new CustomEvent("scroll");A.getPos=function(e){var t=X([q,e]),n=t[0],o=t[1],r=j.horizontal?o.left-n.left:o.top-n.top,i=e[j.horizontal?"offsetWidth":"offsetHeight"],a=j.centerOffset||0;return $||(a=0,r+=j.horizontal?q.scrollLeft:q.scrollTop),{start:r,center:r+a-F/2+i/2,end:r-F+i,size:i}},A.slideBy=function(e,t){e&&T(U.dest+e,t)},A.slideTo=function(e,t){T(e,t)},A.toStart=function(e,t){Y("start",e,t)},A.toEnd=function(e,t){Y("end",e,t)},A.toCenter=function(e,t){Y("center",e,t)},A.destroy=function(){return window.removeEventListener("resize",H,!0),n.removeEventListener(V,"scroll",R,{passive:!0}),n.removeEventListener(J,u,W,{passive:!0}),n.removeEventListener(K,"touchstart",k,{passive:!0}),K.removeEventListener("mousedown",k),A.initialized=0,A},A.init=function(){if(!A.initialized){if(s.sly)throw new Error("There is already a Sly instance on this element");s.sly=!0;var e=[];return q&&e.push(q),$?q.style["will-change"]="transform":q.classList.add(j.horizontal?t.desktop?"smoothScrollX":"hiddenScrollX":t.desktop?"smoothScrollY":"hiddenScrollY"),$?(n.addEventListener(K,"touchstart",k,{passive:!0}),K.addEventListener("mousedown",k),j.scrollWidth||window.addEventListener("resize",H,!0),j.horizontal||n.addEventListener(V,"scroll",R,{passive:!0}),n.addEventListener(J,u,W,{passive:!0})):j.horizontal&&n.addEventListener(J,u,W,{passive:!0}),A.initialized=1,E(!0),A}}});return y.create=function(e,t){var n=new y(e,t);return Promise.resolve(n)},y});