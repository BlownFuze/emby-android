define(["browser","layoutManager","dom","scrollStyles"],function(e,t,n){function o(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?Object.prototype.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof e}function r(e,t){e.preventDefault(),t&&e.stopPropagation()}function i(e){r(e,1),this.removeEventListener(e.type,i)}function a(e,t,n){return t>e?t:e>n?n:e}var s="sly",l=s,d=["mousemove","mouseup"],c=["touchmove","touchend"],u=document.implementation.hasFeature("Event.wheel","3.0")?"wheel":"mousewheel",h=["INPUT","SELECT","TEXTAREA"],f=Math.abs,p=Math.sqrt,v=Math.pow,g=Math.round,m=Math.max,y=(Math.min,function(s,y){function w(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}function E(e){V=z(q,I.horizontal?"width":"height");var t=I.scrollWidth||Math.max(F[I.horizontal?"offsetWidth":"offsetHeight"],F[I.horizontal?"scrollWidth":"scrollHeight"]);U.start=0,U.end=m(t-V,0),e||T(a(U.dest,U.start,U.end))}function z(e,t,n){var o=!0,r="width"===t?e.offsetWidth:e.offsetHeight,i=getComputedStyle(e,null),a="border-box"===i.getPropertyValue("box-sizing");if(0>=r||null==r){if((0>r||null==r)&&(r=e.style[t]),nt.test(r))return r;o=a&&(support.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+S(e,t,n||(a?"border":"content"),o,i)}function S(e,t,n,o){for(var r=n===(o?"border":"content")?4:"width"===t?1:0,i=0;4>r;r+=2);return i}function L(e,t,n){!n&&e.scrollTo?I.horizontal?e.scrollTo(t,0):e.scrollTo(0,t):I.horizontal?e.scrollLeft=Math.round(t):e.scrollTop=Math.round(t)}function T(e,t){return e=a(e,U.start,U.end),$?(Q.from=U.cur,Q.to=e,Q.tweesing=Z.tweese||Z.init&&!Z.slidee,Q.immediate=!Q.tweesing&&(t||Z.init&&Z.slidee||!I.speed),Z.tweese=0,void(e!==U.dest&&(U.dest=e,b(Q)))):void L(F,e,t)}function b(){var t=getComputedStyle(F,null).getPropertyValue("transform").match(/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/);t&&(U.cur=-1*parseInt(I.horizontal?t[1]:t[2]));var n;Q.to=g(Q.to),n=I.horizontal?[{transform:"translate3d("+-g(U.cur||Q.from)+"px, 0, 0)",offset:0},{transform:"translate3d("+-g(Q.to)+"px, 0, 0)",offset:1}]:[{transform:"translate3d(0, "+-g(U.cur||Q.from)+"px, 0)",offset:0},{transform:"translate3d(0, "+-g(Q.to)+"px, 0)",offset:1}];var o=I.speed;Q.immediate&&(o=I.immediateSpeed||50,e.animate||(I.immediateSpeed=0));var r={duration:o,iterations:1,fill:"both"};(!Q.immediate||e.animate)&&(r.easing="ease-out");var i=F.animate(n,r);i.onfinish=function(){U.cur=Q.to,document.dispatchEvent(ot)}}function C(e){return e.getBoundingClientRect?e.getBoundingClientRect():{top:0,left:0}}function x(e,t,n){if("boolean"===o(t)&&(n=t,t=void 0),void 0===t)T(U[e],n);else{var r=A.getPos(t);r&&T(r[e],n,!0)}}function P(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}function X(){Z.history[0]=Z.history[1],Z.history[1]=Z.history[2],Z.history[2]=Z.history[3],Z.history[3]=Z.delta}function Y(e){Z.released=0,Z.source=e,Z.slidee="slidee"===e}function D(e){k(e,"slidee")}function k(e,t){var n="touchstart"===e.type,o="slidee"===t;Z.init||!n&&N(e.target)||(!o||(n?I.touchDragging:I.mouseDragging&&e.which<2))&&(n||r(e),Y(t),Z.init=0,Z.source=e.target,Z.touch=n,Z.pointer=n?e.touches[0]:e,Z.initX=Z.pointer.pageX,Z.initY=Z.pointer.pageY,Z.initPos=o?U.cur:G.cur,Z.start=+new Date,Z.time=0,Z.path=0,Z.delta=0,Z.locked=0,Z.history=[0,0,0,0],Z.pathToLock=o?n?30:10:0,n?c.forEach(function(e){document.addEventListener(e,M)}):d.forEach(function(e){document.addEventListener(e,M)}),o&&F.classList.add(I.draggedClass),o&&(et=setInterval(X,10)))}function M(e){if(Z.released="mouseup"===e.type||"touchend"===e.type,Z.pointer=Z.touch?e[Z.released?"changedTouches":"touches"][0]:e,Z.pathX=Z.pointer.pageX-Z.initX,Z.pathY=Z.pointer.pageY-Z.initY,Z.path=p(v(Z.pathX,2)+v(Z.pathY,2)),Z.delta=I.horizontal?Z.pathX:Z.pathY,Z.released||!(Z.path<1)){if(!Z.init){if(Z.path<I.dragThreshold)return Z.released?B():void 0;if(!(I.horizontal?f(Z.pathX)>f(Z.pathY):f(Z.pathX)<f(Z.pathY)))return B();Z.init=1}r(e),!Z.locked&&Z.path>Z.pathToLock&&Z.slidee&&(Z.locked=1,Z.source.addEventListener("click",i)),Z.released&&(B(),I.releaseSwing&&Z.slidee&&(Z.swing=(Z.delta-Z.history[0])/40*300,Z.delta+=Z.swing,Z.tweese=f(Z.swing)>10)),T(Z.slidee?g(Z.initPos-Z.delta):handleToSlidee(Z.initPos+Z.delta))}}function B(){clearInterval(et),Z.released=!0,Z.touch?c.forEach(function(e){document.removeEventListener(e,M)}):d.forEach(function(e){document.removeEventListener(e,M)}),Z.slidee&&F.classList.remove(I.draggedClass),setTimeout(function(){Z.source.removeEventListener("click",i)}),Z.init=0}function N(e){for(;e;){if(-1!=h.indexOf(e.tagName))return!0;e=e.parentNode}return!1}function W(e){return _.curDelta=(I.horizontal?e.deltaY||e.deltaX:e.deltaY)||-e.wheelDelta,$&&(_.curDelta/=1===e.deltaMode?3:100),_.curDelta}function H(e){if(e[l]=A,I.scrollBy&&U.start!==U.end){var t=W(e);$?(t>0&&U.dest<U.end||0>t&&U.dest>U.start,A.slideBy(I.scrollBy*t)):(O&&(t*=12),I.horizontal?F.scrollLeft+=t:F.scrollTop+=t)}}function R(){E(!1)}function j(){I.horizontal?this.scrollLeft=0:this.scrollTop=0}var I=P({},{slidee:null,horizontal:!1,scrollSource:null,scrollBy:0,scrollHijack:300,dragSource:null,mouseDragging:1,touchDragging:1,releaseSwing:!1,swingSpeed:.2,dragThreshold:3,intervactive:null,speed:0,draggedClass:"dragged",activeClass:"active",disabledClass:"disabled"},y),O="scrollBehavior"in document.documentElement.style;e.operaTv?y.enableNativeScroll=!1:O&&e.firefox?y.enableNativeScroll=!0:y.requireAnimation?y.enableNativeScroll=!1:(t.desktop||!e.animate)&&(y.enableNativeScroll=!0);var A=this;A.options=I;var q=s,F=I.slidee?I.slidee:w(q.firstChild)[0],V=0,U={start:0,center:0,end:0,cur:0,dest:0},$=!y.enableNativeScroll,G={start:0,end:0,cur:0},J=I.scrollSource?I.scrollSource:q,K=I.dragSource?I.dragSource:q,Q={},Z={released:1},_={last:0,delta:0,resetTime:200},et=0;s=q,A.initialized=0,A.frame=s,A.slidee=F,A.options=I,A.dragging=Z;var tt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,nt=new RegExp("^("+tt+")(?!px)[a-z%]+$","i");A.reload=function(){E()};var ot=new CustomEvent("scroll");A.getPos=function(e){var t=C(F),n=C(e),o=I.horizontal?n.left-t.left:n.top-t.top,r=I.horizontal?n.width:n.height;r||(r=e[I.horizontal?"offsetWidth":"offsetHeight"]);var i=I.centerOffset||0;return $||(i=0,o+=I.horizontal?F.scrollLeft:F.scrollTop),{start:o,center:o+i-V/2+r/2,end:o-V+r,size:r}},A.getCenterPosition=function(e){var t=A.getPos(e);return a(t.center,t.start,t.end)},A.slideBy=function(e,t){e&&T(U.dest+e,t)},A.slideTo=function(e,t){T(e,t)},A.toStart=function(e,t){x("start",e,t)},A.toEnd=function(e,t){x("end",e,t)},A.toCenter=function(e,t){x("center",e,t)},A.destroy=function(){return window.removeEventListener("resize",R,!0),n.removeEventListener(q,"scroll",j,{passive:!0}),n.removeEventListener(J,u,H,{passive:!0}),n.removeEventListener(K,"touchstart",D,{passive:!0}),K.removeEventListener("mousedown",D),A.initialized=0,A},A.init=function(){if(!A.initialized){if(s.sly)throw new Error("There is already a Sly instance on this element");s.sly=!0;var e=[];return F&&e.push(F),$?F.style["will-change"]="transform":F.classList.add(I.horizontal?t.desktop?"smoothScrollX":"hiddenScrollX":t.desktop?"smoothScrollY":"hiddenScrollY"),$?(n.addEventListener(K,"touchstart",D,{passive:!0}),K.addEventListener("mousedown",D),I.scrollWidth||window.addEventListener("resize",R,!0),I.horizontal||n.addEventListener(q,"scroll",j,{passive:!0}),n.addEventListener(J,u,H,{passive:!0})):I.horizontal&&n.addEventListener(J,u,H,{passive:!0}),A.initialized=1,E(!0),A}}});return y.create=function(e,t){var n=new y(e,t);return Promise.resolve(n)},y});