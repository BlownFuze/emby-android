define(["dom"],function(t){function e(t,e,i){var o;return i!==!1&&(o=t.querySelector("*[autofocus]"))?(n(o),o):e!==!1&&(o=r(t)[0])?(n(o),o):null}function n(t){try{t.focus()}catch(e){}}function i(t){return-1!=v.indexOf(t.tagName)?!0:t.classList&&t.classList.contains("focusable")?!0:!1}function o(t){for(;!i(t);)if(t=t.parentNode,!t)return null;return t}function a(t){if(t.disabled)return!1;if("-1"==t.getAttribute("tabindex"))return!1;if(null===t.offsetParent)return!1;if("INPUT"==t.tagName){var e=t.type;if("range"==e)return!1}return!0}function r(t){for(var e=(t||document.body).querySelectorAll(T),n=[],i=0,o=e.length;o>i;i++){var r=e[i];a(r)&&n.push(r)}return n}function f(t,e){if(-1!=M.indexOf(t.tagName))return!0;if(t.classList.contains("focuscontainer"))return!0;if(2>e){if(t.classList.contains("focuscontainer-x"))return!0}else if(3==e&&t.classList.contains("focuscontainer-down"))return!0;return!1}function u(t,e){for(;!f(t,e);)if(t=t.parentNode,!t)return document.body;return t}function c(t,e){return{pageYOffset:t.pageYOffset,pageXOffset:t.pageXOffset,clientTop:e.clientTop,clientLeft:e.clientLeft}}function s(t,e){var n={top:0,left:0};return t.getBoundingClientRect&&(n=t.getBoundingClientRect()),{top:n.top+e.pageYOffset-e.clientTop,left:n.left+e.pageXOffset-e.clientLeft}}function l(t,e){var n=s(t,e),i=n.top-e.pageYOffset,o=n.left-e.pageXOffset,a=t.offsetWidth,r=t.offsetHeight;return{left:o,top:i,width:a,height:r,right:o+a,bottom:i+r}}function h(i,r){i=i||document.activeElement,i&&(i=o(i));var f=i?u(i,r):document.body;if(!i)return void e(f,!0,!1);for(var s=t.parentWithClass(i,"focusable"),h=i.ownerDocument,d=c(h.defaultView,h.documentElement),p=l(i,d),b=[],m=f.querySelectorAll(T),v=0,M=m.length;M>v;v++){var O=m[v];if(O!=i&&O!=s&&a(O)){var w=l(O,d);switch(r){case 0:if(w.left>=p.left)continue;if(w.right==p.right)continue;break;case 1:if(w.right<=p.right)continue;if(w.left==p.left)continue;break;case 2:if(w.top>=p.top)continue;if(w.bottom>=p.bottom)continue;break;case 3:if(w.bottom<=p.bottom)continue;if(w.top<=p.top)continue}b.push({element:O,clientRect:w})}}var x=g(b,p,r);if(x.length){var L=x[0].node,y=t.parentWithClass(L,"focusable");y&&y!=L&&i&&t.parentWithClass(i,"focusable")!=y&&(L=y),n(L)}}function d(t,e,n,i){return n>=t&&e>=n||i>=t&&e>=i}function p(t,e,n,i){return d(t,e,n,i)||d(n,i,t,e)}function g(t,e,n){for(var i=[],o=parseFloat(e.left)||0,a=parseFloat(e.top)||0,r=parseFloat(o+e.width-1)||o,f=parseFloat(a+e.height-1)||a,u=(Math.min,Math.max,e.left+e.width/2),c=e.top+e.height/2,s=0,l=t.length;l>s;s++){var h,d,g=t[s],m=g.element,v=g.clientRect,M=v.left,T=v.top,O=M+v.width-1,w=T+v.height-1,x=p(o,r,M,O),L=p(a,f,T,w),y=v.left+v.width/2,E=v.top+v.height/2;switch(n){case 0:h=Math.abs(o-Math.min(o,O)),d=L?0:Math.abs(c-E);break;case 1:h=Math.abs(r-Math.max(r,M)),d=L?0:Math.abs(c-E);break;case 2:d=Math.abs(a-Math.min(a,w)),h=x?0:Math.abs(u-y);break;case 3:d=Math.abs(f-Math.max(f,T)),h=x?0:Math.abs(u-y)}var N=Math.sqrt(h*h+d*d);i.push({node:m,distX:h,distY:d,distT:N,index:s})}return i.sort(b),i}function b(t,e){var n=t.distT-e.distT;return 0!=n?n:(n=t.index-e.index,0!=n?n:0)}function m(t){var e=document.activeElement;e.value=t}var v=["INPUT","TEXTAREA","SELECT","BUTTON","A"],M=["BODY","DIALOG"],T=v.join(",")+",.focusable";return{autoFocus:e,focus:n,focusableParent:o,getFocusableElements:r,moveLeft:function(t){h(t,0)},moveRight:function(t){h(t,1)},moveUp:function(t){h(t,2)},moveDown:function(t){h(t,3)},sendText:m,isCurrentlyFocusable:a}});