!function(e,t){var r=this;"function"==typeof define&&define.amd?define([],function(){return t(r)}):"object"==typeof exports&&"object"==typeof module?module.exports=t(r):"object"==typeof exports?exports.libjass=t(r):e.libjass=t(r)}(this,function(e){"use strict";return function(e){function t(n){if(r[n])return r[n];var i=r[n]=Object.create(null);return e[n](i,t),i}var r=Object.create(null);return t(0)}([function(e,t){var r=t(23),n=t(23);e.debugMode=n.debugMode,e.verboseMode=n.verboseMode;var i=t(33),o=t(33);e.Set=o.Set;var a=t(30),l=t(30);e.Map=l.Map;var s=t(32),u=t(32);e.Promise=u.Promise,e.DeferredPromise=u.DeferredPromise;var p=t(37);e.webworker=p;var c=t(8);e.parts=c;var f=t(1);e.parser=f;var h=t(14);e.renderers=h;var d=t(24);e.ASS=d.ASS;var _=t(25);e.Attachment=_.Attachment,e.AttachmentType=_.AttachmentType;var g=t(26);e.Dialogue=g.Dialogue;var v=t(28);e.ScriptProperties=v.ScriptProperties;var y=t(29);e.Style=y.Style;var m=t(27);e.BorderStyle=m.BorderStyle,e.Format=m.Format,e.WrappingStyle=m.WrappingStyle,Object.defineProperties(e,{debugMode:{get:function(){return r.debugMode},set:r.setDebugMode},verboseMode:{get:function(){return r.verboseMode},set:r.setVerboseMode},Set:{get:function(){return i.Set},set:i.setImplementation},Map:{get:function(){return a.Map},set:a.setImplementation},Promise:{get:function(){return s.Promise},set:s.setImplementation}})},function(e,t){var r=t(3);e.parse=r.parse;var n=t(5);e.BrowserReadableStream=n.BrowserReadableStream,e.StringStream=n.StringStream,e.XhrStream=n.XhrStream;var i=t(4);e.StreamParser=i.StreamParser,e.SrtStreamParser=i.SrtStreamParser},function(e,t){function r(e){var t=e.indexOf(":");if(-1===t)return null;var r=e.substr(0,t),n=e.substr(t+1).replace(/^\s+/,"");return{name:r,value:n}}function n(e,t){var n=r(e);if(null===n)return null;var o=n.value.split(",");o.length>t.length&&(o[t.length-1]=o.slice(t.length-1).join(","));var a=new i.Map;return t.forEach(function(e,t){a.set(e,o[t])}),{type:n.name,template:a}}var i=t(30);e.parseLineIntoProperty=r,e.parseLineIntoTypedTemplate=n},function(e,t){function r(e,t){var r=new s(e,t);if(null===r.result||r.result.end!==e.length)throw o.debugMode,new Error("Parse failed.");return r.result.value}function n(e,t,r,n){s.prototype["parse_tag_"+e]=function(i){var o=this,a=new f(i);if(null===o.read(a,e))return i.pop(),null;var l=r.call(o,a);if(null!==l)a.value=new t(l.value);else{if(n)return i.pop(),null;a.value=new t(null)}return a}}var i=t(8),o=t(23),a=t(30),l=new a.Map;e.parse=r;var s=function(){function e(e,t){this._input=e,this._parseTree=new f(null),this._result=l.get(t).call(this,this._parseTree)}return Object.defineProperty(e.prototype,"result",{get:function(){return this._result},enumerable:!0,configurable:!0}),e.prototype.parse_dialogueParts=function(e){var t,n=new f(e);for(n.value=[];this._haveMore();){var o=this.parse_enclosedTags(n);if(null!==o)(t=n.value).push.apply(t,o.value);else{var a=this.parse_newline(n)||this.parse_hardspace(n)||this.parse_text(n);if(null===a)return e.pop(),null;if(a.value instanceof i.Text&&n.value[n.value.length-1]instanceof i.Text){var l=n.value[n.value.length-1];n.value[n.value.length-1]=new i.Text(l.value+a.value.value)}else n.value.push(a.value)}}var s=!1;return n.value.forEach(function(e,t){e instanceof i.DrawingMode?s=0!==e.scale:e instanceof i.Text&&s&&(n.value[t]=new i.DrawingInstructions(r(e.value,"drawingInstructions")))}),n},e.prototype.parse_enclosedTags=function(e){var t=new f(e);if(t.value=[],null===this.read(t,"{"))return e.pop(),null;for(var r=this._peek();this._haveMore()&&"}"!==r;r=this._peek()){var n=null;if(null!==this.read(t,"\\")&&(n=this.parse_tag_alpha(t)||this.parse_tag_iclip(t)||this.parse_tag_xbord(t)||this.parse_tag_ybord(t)||this.parse_tag_xshad(t)||this.parse_tag_yshad(t)||this.parse_tag_blur(t)||this.parse_tag_bord(t)||this.parse_tag_clip(t)||this.parse_tag_fade(t)||this.parse_tag_fscx(t)||this.parse_tag_fscy(t)||this.parse_tag_move(t)||this.parse_tag_shad(t)||this.parse_tag_fad(t)||this.parse_tag_fax(t)||this.parse_tag_fay(t)||this.parse_tag_frx(t)||this.parse_tag_fry(t)||this.parse_tag_frz(t)||this.parse_tag_fsp(t)||this.parse_tag_fsplus(t)||this.parse_tag_fsminus(t)||this.parse_tag_org(t)||this.parse_tag_pbo(t)||this.parse_tag_pos(t)||this.parse_tag_an(t)||this.parse_tag_be(t)||this.parse_tag_fn(t)||this.parse_tag_fr(t)||this.parse_tag_fs(t)||this.parse_tag_kf(t)||this.parse_tag_ko(t)||this.parse_tag_1a(t)||this.parse_tag_1c(t)||this.parse_tag_2a(t)||this.parse_tag_2c(t)||this.parse_tag_3a(t)||this.parse_tag_3c(t)||this.parse_tag_4a(t)||this.parse_tag_4c(t)||this.parse_tag_a(t)||this.parse_tag_b(t)||this.parse_tag_c(t)||this.parse_tag_i(t)||this.parse_tag_k(t)||this.parse_tag_K(t)||this.parse_tag_p(t)||this.parse_tag_q(t)||this.parse_tag_r(t)||this.parse_tag_s(t)||this.parse_tag_t(t)||this.parse_tag_u(t),null===n&&t.pop()),null===n&&(n=this.parse_comment(t)),null===n)return e.pop(),null;n.value instanceof i.Comment&&t.value[t.value.length-1]instanceof i.Comment?t.value[t.value.length-1]=new i.Comment(t.value[t.value.length-1].value+n.value.value):t.value.push(n.value)}return null===this.read(t,"}")?(e.pop(),null):t},e.prototype.parse_newline=function(e){var t=new f(e);return null===this.read(t,"\\N")?(e.pop(),null):(t.value=new i.NewLine,t)},e.prototype.parse_hardspace=function(e){var t=new f(e);return null===this.read(t,"\\h")?(e.pop(),null):(t.value=new i.Text("Â "),t)},e.prototype.parse_text=function(e){var t=this._peek(),r=new f(e),n=new f(r,t);return r.value=new i.Text(n.value),r},e.prototype.parse_comment=function(e){var t=this._peek(),r=new f(e),n=new f(r,t);return r.value=new i.Comment(n.value),r},e.prototype.parse_tag_a=function(e){var t=new f(e);if(null===this.read(t,"a"))return e.pop(),null;var r=this._peek();switch(r){case"1":var n=this._peek(2);switch(n){case"10":case"11":r=n}break;case"2":case"3":case"5":case"6":case"7":case"9":break;default:return e.pop(),null}var o=new f(t,r),a=null;switch(o.value){case"1":a=1;break;case"2":a=2;break;case"3":a=3;break;case"5":a=7;break;case"6":a=8;break;case"7":a=9;break;case"9":a=4;break;case"10":a=5;break;case"11":a=6}return t.value=new i.Alignment(a),t},e.prototype.parse_tag_alpha=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_an=function(e){var t=new f(e);if(null===this.read(t,"an"))return e.pop(),null;var r=this._peek();if("1">r||r>"9")return e.pop(),null;var n=new f(t,r);return t.value=new i.Alignment(parseInt(n.value)),t},e.prototype.parse_tag_b=function(e){var t=new f(e);if(null===this.read(t,"b"))return e.pop(),null;var r=null,n=this._peek();return n>="1"&&"9">=n&&(n=this._peek(3),"00"===n.substr(1)&&(r=new f(t,n),r.value=parseInt(r.value))),null===r&&(r=this.parse_enableDisable(t)),t.value=new i.Bold(null!==r?r.value:null),t},e.prototype.parse_tag_be=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_blur=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_bord=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_c=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_clip=function(e){return this._parse_tag_clip_or_iclip("clip",e)},e.prototype.parse_tag_fad=function(e){var t=new f(e);if(null===this.read(t,"fad"))return e.pop(),null;if(null===this.read(t,"("))return e.pop(),null;var r=this.parse_decimal(t);if(null===r)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var n=this.parse_decimal(t);return null===n?(e.pop(),null):null===this.read(t,")")?(e.pop(),null):(t.value=new i.Fade(r.value/1e3,n.value/1e3),t)},e.prototype.parse_tag_fade=function(e){var t=new f(e);if(null===this.read(t,"fade"))return e.pop(),null;if(null===this.read(t,"("))return e.pop(),null;var r=this.parse_decimal(t);if(null===r)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var n=this.parse_decimal(t);if(null===n)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var o=this.parse_decimal(t);if(null===o)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var a=this.parse_decimal(t);if(null===a)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var l=this.parse_decimal(t);if(null===l)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var s=this.parse_decimal(t);if(null===s)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var u=this.parse_decimal(t);return null===u?(e.pop(),null):null===this.read(t,")")?(e.pop(),null):(t.value=new i.ComplexFade(1-r.value/255,1-n.value/255,1-o.value/255,a.value/1e3,l.value/1e3,s.value/1e3,u.value/1e3),t)},e.prototype.parse_tag_fax=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_fay=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_fn=function(e){var t=new f(e);if(null===this.read(t,"fn"))return e.pop(),null;for(var r=new f(t,""),n=this._peek();this._haveMore()&&"\\"!==n&&"}"!==n;n=this._peek())r.value+=n;return t.value=new i.FontName(r.value.length>0?r.value:null),t},e.prototype.parse_tag_fr=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_frx=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_fry=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_frz=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_fs=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_fsplus=function(e){var t=new f(e);if(null===this.read(t,"fs+"))return e.pop(),null;var r=this.parse_decimal(t);return null===r?(e.pop(),null):(t.value=new i.FontSizePlus(r.value),t)},e.prototype.parse_tag_fsminus=function(e){var t=new f(e);if(null===this.read(t,"fs-"))return e.pop(),null;var r=this.parse_decimal(t);return null===r?(e.pop(),null):(t.value=new i.FontSizeMinus(r.value),t)},e.prototype.parse_tag_fscx=function(e){var t=new f(e);if(null===this.read(t,"fscx"))return e.pop(),null;var r=this.parse_decimal(t);return t.value=new i.FontScaleX(null!==r?r.value/100:null),t},e.prototype.parse_tag_fscy=function(e){var t=new f(e);if(null===this.read(t,"fscy"))return e.pop(),null;var r=this.parse_decimal(t);return t.value=new i.FontScaleY(null!==r?r.value/100:null),t},e.prototype.parse_tag_fsp=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_i=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_iclip=function(e){return this._parse_tag_clip_or_iclip("iclip",e)},e.prototype.parse_tag_k=function(e){var t=new f(e);if(null===this.read(t,"k"))return e.pop(),null;var r=this.parse_decimal(t);return null===r?(e.pop(),null):(t.value=new i.ColorKaraoke(r.value/100),t)},e.prototype.parse_tag_K=function(e){var t=new f(e);if(null===this.read(t,"K"))return e.pop(),null;var r=this.parse_decimal(t);return null===r?(e.pop(),null):(t.value=new i.SweepingColorKaraoke(r.value/100),t)},e.prototype.parse_tag_kf=function(e){var t=new f(e);if(null===this.read(t,"kf"))return e.pop(),null;var r=this.parse_decimal(t);return null===r?(e.pop(),null):(t.value=new i.SweepingColorKaraoke(r.value/100),t)},e.prototype.parse_tag_ko=function(e){var t=new f(e);if(null===this.read(t,"ko"))return e.pop(),null;var r=this.parse_decimal(t);return null===r?(e.pop(),null):(t.value=new i.OutlineKaraoke(r.value/100),t)},e.prototype.parse_tag_move=function(e){var t=new f(e);if(null===this.read(t,"move"))return e.pop(),null;if(null===this.read(t,"("))return e.pop(),null;var r=this.parse_decimal(t);if(null===r)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var n=this.parse_decimal(t);if(null===n)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var o=this.parse_decimal(t);if(null===o)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var a=this.parse_decimal(t);if(null===a)return e.pop(),null;var l=null,s=null;if(null!==this.read(t,",")){if(l=this.parse_decimal(t),null===l)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;if(s=this.parse_decimal(t),null===s)return e.pop(),null}return null===this.read(t,")")?(e.pop(),null):(t.value=new i.Move(r.value,n.value,o.value,a.value,null!==l?l.value/1e3:null,null!==s?s.value/1e3:null),t)},e.prototype.parse_tag_org=function(e){var t=new f(e);if(null===this.read(t,"org"))return e.pop(),null;if(null===this.read(t,"("))return e.pop(),null;var r=this.parse_decimal(t);if(null===r)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var n=this.parse_decimal(t);return null===n?(e.pop(),null):null===this.read(t,")")?(e.pop(),null):(t.value=new i.RotationOrigin(r.value,n.value),t)},e.prototype.parse_tag_p=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_pbo=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_pos=function(e){var t=new f(e);if(null===this.read(t,"pos"))return e.pop(),null;if(null===this.read(t,"("))return e.pop(),null;var r=this.parse_decimal(t);if(null===r)return e.pop(),null;if(null===this.read(t,","))return e.pop(),null;var n=this.parse_decimal(t);return null===n?(e.pop(),null):null===this.read(t,")")?(e.pop(),null):(t.value=new i.Position(r.value,n.value),t)},e.prototype.parse_tag_q=function(e){var t=new f(e);if(null===this.read(t,"q"))return e.pop(),null;var r=this._peek();if("0">r||r>"3")return e.pop(),null;var n=new f(t,r);return t.value=new i.WrappingStyle(parseInt(n.value)),t},e.prototype.parse_tag_r=function(e){var t=new f(e);if(null===this.read(t,"r"))return e.pop(),null;for(var r=new f(t,""),n=this._peek();this._haveMore()&&"\\"!==n&&"}"!==n;n=this._peek())r.value+=n;return t.value=new i.Reset(r.value.length>0?r.value:null),t},e.prototype.parse_tag_s=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_shad=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_t=function(e){var t=new f(e);if(null===this.read(t,"t"))return e.pop(),null;if(null===this.read(t,"("))return e.pop(),null;var r=null,n=null,o=null,a=this.parse_decimal(t);if(null!==a){if(null===this.read(t,","))return e.pop(),null;var l=this.parse_decimal(t);if(null!==l){if(r=a,n=l,null===this.read(t,","))return e.pop(),null;var s=this.parse_decimal(t);if(null!==s&&(o=s,null===this.read(t,",")))return e.pop(),null}else if(o=a,null===this.read(t,","))return e.pop(),null}for(var u=[],p=this._peek();this._haveMore()&&")"!==p&&"}"!==p;p=this._peek()){var c=null;if(null!==this.read(t,"\\")&&(c=this.parse_tag_alpha(t)||this.parse_tag_iclip(t)||this.parse_tag_xbord(t)||this.parse_tag_ybord(t)||this.parse_tag_xshad(t)||this.parse_tag_yshad(t)||this.parse_tag_blur(t)||this.parse_tag_bord(t)||this.parse_tag_clip(t)||this.parse_tag_fscx(t)||this.parse_tag_fscy(t)||this.parse_tag_shad(t)||this.parse_tag_fax(t)||this.parse_tag_fay(t)||this.parse_tag_frx(t)||this.parse_tag_fry(t)||this.parse_tag_frz(t)||this.parse_tag_fsp(t)||this.parse_tag_fsplus(t)||this.parse_tag_fsminus(t)||this.parse_tag_be(t)||this.parse_tag_fr(t)||this.parse_tag_fs(t)||this.parse_tag_1a(t)||this.parse_tag_1c(t)||this.parse_tag_2a(t)||this.parse_tag_2c(t)||this.parse_tag_3a(t)||this.parse_tag_3c(t)||this.parse_tag_4a(t)||this.parse_tag_4c(t)||this.parse_tag_c(t),null===c&&t.pop()),null===c&&(c=this.parse_comment(t)),null===c)return e.pop(),null;c.value instanceof i.Comment&&u[u.length-1]instanceof i.Comment?u[u.length-1]=new i.Comment(u[u.length-1].value+c.value.value):u.push(c.value)}return this.read(t,")"),t.value=new i.Transform(null!==r?r.value/1e3:null,null!==n?n.value/1e3:null,null!==o?o.value/1e3:null,u),t},e.prototype.parse_tag_u=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_xbord=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_xshad=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_ybord=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_yshad=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_1a=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_1c=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_2a=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_2c=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_3a=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_3c=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_4a=function(){throw new Error("Method not implemented.")},e.prototype.parse_tag_4c=function(){throw new Error("Method not implemented.")},e.prototype.parse_drawingInstructions=function(e){var t=new f(e),r=null,n=[];for(t.value=[];this._haveMore();){for(;null!==this.read(t," "););if(!this._haveMore())break;if(null!==r){var o=this.parse_decimal(t);if(null!==o){n.push(o),"m"===r&&2===n.length?(t.value.push(new i.drawing.MoveInstruction(n[0].value,n[1].value)),n.splice(0,n.length)):"l"===r&&2===n.length?(t.value.push(new i.drawing.LineInstruction(n[0].value,n[1].value)),n.splice(0,n.length)):"b"===r&&6===n.length&&(t.value.push(new i.drawing.CubicBezierCurveInstruction(n[0].value,n[1].value,n[2].value,n[3].value,n[4].value,n[5].value)),n.splice(0,n.length));continue}}var a=this.parse_text(t);if(null===a)break;var l=a.value.value;switch(l){case"m":case"l":case"b":r=l,n.splice(0,n.length)}}for(;null!==this.read(t," "););return t},e.prototype.parse_decimalInt32=function(e){for(var t=new f(e),r=null!==this.read(t,"-"),n=new f(t,""),i=this._peek();this._haveMore()&&i>="0"&&"9">=i;i=this._peek())n.value+=i;if(0===n.value.length)return e.pop(),null;var o=parseInt(n.value);return o>=4294967295?o=4294967295:r&&(o=-o),t.value=o,t},e.prototype.parse_hexInt32=function(e){for(var t=new f(e),r=null!==this.read(t,"-"),n=new f(t,""),i=this._peek();this._haveMore()&&(i>="0"&&"9">=i||i>="a"&&"f">=i||i>="A"&&"F">=i);i=this._peek())n.value+=i;if(0===n.value.length)return e.pop(),null;var o=parseInt(n.value,16);return o>=4294967295?o=4294967295:r&&(o=-o),t.value=o,t},e.prototype.parse_decimalOrHexInt32=function(e){var t=new f(e),r=null!==this.read(t,"&H")||null!==this.read(t,"&h")?this.parse_hexInt32(t):this.parse_decimalInt32(t);return null===r?(e.pop(),null):(t.value=r.value,t)},e.prototype.parse_decimal=function(e){var t=new f(e),r=null!==this.read(t,"-"),n=this.parse_unsignedDecimal(t);return null===n?(e.pop(),null):(t.value=n.value,r&&(t.value=-t.value),t)},e.prototype.parse_unsignedDecimal=function(e){for(var t=new f(e),r=new f(t,""),n=null,i=this._peek();this._haveMore()&&i>="0"&&"9">=i;i=this._peek())r.value+=i;if(0===r.value.length)return e.pop(),null;if(null!==this.read(t,".")){n=new f(t,"");for(var i=this._peek();this._haveMore()&&i>="0"&&"9">=i;i=this._peek())n.value+=i;if(0===n.value.length)return e.pop(),null}return t.value=parseFloat(r.value+(null!==n?"."+n.value:"")),t},e.prototype.parse_enableDisable=function(e){var t=this._peek();if("0"===t||"1"===t){var r=new f(e,t);return r.value="1"===r.value,r}return null},e.prototype.parse_color=function(e){for(var t=new f(e);null!==this.read(t,"&")||null!==this.read(t,"H"););var r=this.parse_hexInt32(t);if(null===r)return e.pop(),null;var n=r.value;for(t.value=new i.Color(255&n,n>>8&255,n>>16&255);null!==this.read(t,"&")||null!==this.read(t,"H"););return t},e.prototype.parse_alpha=function(e){for(var t=new f(e);null!==this.read(t,"&")||null!==this.read(t,"H"););var r=this.parse_hexInt32(t);if(null===r)return e.pop(),null;var n=r.value;for(t.value=1-(255&n)/255;null!==this.read(t,"&")||null!==this.read(t,"H"););return t},e.prototype.parse_colorWithAlpha=function(e){var t=new f(e),r=this.parse_decimalOrHexInt32(t);if(null===r)return e.pop(),null;var n=r.value;return t.value=new i.Color(255&n,n>>8&255,n>>16&255,1-(n>>24&255)/255),t},e.prototype.read=function(e,t){return this._peek(t.length)!==t?null:new f(e,t)},e.prototype._peek=function(e){return void 0===e&&(e=1),1===e?this._input[this._parseTree.end]:this._input.substr(this._parseTree.end,e)},e.prototype._haveMore=function(){return this._parseTree.end<this._input.length},e.prototype._parse_tag_clip_or_iclip=function(e,t){var n=new f(t);if(null===this.read(n,e))return t.pop(),null;if(null===this.read(n,"("))return t.pop(),null;var o=null,a=null,l=null,s=null,u=null,p=null,c=this.parse_decimal(n);if(null!==c){if(null===this.read(n,","))return t.pop(),null;var h=this.parse_decimal(n);null!==h?(o=c,l=h):u=c}if(null!==o&&null!==l){if(null===this.read(n,","))return t.pop(),null;if(a=this.parse_decimal(n),null===this.read(n,","))return t.pop(),null;s=this.parse_decimal(n),n.value=new i.RectangularClip(o.value,l.value,a.value,s.value,"clip"===e)}else{p=new f(n,"");for(var d=this._peek();this._haveMore()&&")"!==d&&"}"!==d;d=this._peek())p.value+=d;n.value=new i.VectorClip(null!==u?u.value:1,r(p.value,"drawingInstructions"),"clip"===e)}return null===this.read(n,")")?(t.pop(),null):n},e}();n("alpha",i.Alpha,s.prototype.parse_alpha,!1),n("be",i.Blur,s.prototype.parse_decimal,!1),n("blur",i.GaussianBlur,s.prototype.parse_decimal,!1),n("bord",i.Border,s.prototype.parse_decimal,!1),n("c",i.PrimaryColor,s.prototype.parse_color,!1),n("fax",i.SkewX,s.prototype.parse_decimal,!1),n("fay",i.SkewY,s.prototype.parse_decimal,!1),n("fr",i.RotateZ,s.prototype.parse_decimal,!1),n("frx",i.RotateX,s.prototype.parse_decimal,!1),n("fry",i.RotateY,s.prototype.parse_decimal,!1),n("frz",i.RotateZ,s.prototype.parse_decimal,!1),n("fs",i.FontSize,s.prototype.parse_decimal,!1),n("fsp",i.LetterSpacing,s.prototype.parse_decimal,!1),n("i",i.Italic,s.prototype.parse_enableDisable,!1),n("p",i.DrawingMode,s.prototype.parse_decimal,!0),n("pbo",i.DrawingBaselineOffset,s.prototype.parse_decimal,!0),n("s",i.StrikeThrough,s.prototype.parse_enableDisable,!1),n("shad",i.Shadow,s.prototype.parse_decimal,!1),n("u",i.Underline,s.prototype.parse_enableDisable,!1),n("xbord",i.BorderX,s.prototype.parse_decimal,!1),n("xshad",i.ShadowX,s.prototype.parse_decimal,!1),n("ybord",i.BorderY,s.prototype.parse_decimal,!1),n("yshad",i.ShadowY,s.prototype.parse_decimal,!1),n("1a",i.PrimaryAlpha,s.prototype.parse_alpha,!1),n("1c",i.PrimaryColor,s.prototype.parse_color,!1),n("2a",i.SecondaryAlpha,s.prototype.parse_alpha,!1),n("2c",i.SecondaryColor,s.prototype.parse_color,!1),n("3a",i.OutlineAlpha,s.prototype.parse_alpha,!1),n("3c",i.OutlineColor,s.prototype.parse_color,!1),n("4a",i.ShadowAlpha,s.prototype.parse_alpha,!1),n("4c",i.ShadowColor,s.prototype.parse_color,!1);for(var u=0,p=Object.keys(s.prototype);u<p.length;u++){var c=p[u];0===c.indexOf("parse_")&&"function"==typeof s.prototype[c]&&l.set(c.substr("parse_".length),s.prototype[c])}var f=function(){function e(e,t){void 0===t&&(t=null),this._parent=e,this._children=[],null!==e&&e.children.push(this),this._start=null!==e?e.end:0,this._end=this._start,this.value=t}return Object.defineProperty(e.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e,null!==this._value&&this._value.constructor===String&&0===this._children.length&&this._setEnd(this._start+this._value.length)},enumerable:!0,configurable:!0}),e.prototype.pop=function(){this._children.splice(this._children.length-1,1),this._setEnd(this._children.length>0?this._children[this._children.length-1].end:this.start)},e.prototype._setEnd=function(e){this._end=e,null!==this._parent&&this._parent.end!==this._end&&this._parent._setEnd(this._end)},e}(),h=t(32),d=t(36),_=t(38);_.registerWorkerCommand(d.WorkerCommands.Parse,function(e){return new h.Promise(function(t){t(r(e.input,e.rule))})})},function(e,t){function r(e){for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r)-33;if(0>n||n>63)throw new Error("Out-of-range character code "+n+" at index "+r+" in string "+e);t+=26>n?String.fromCharCode("A".charCodeAt(0)+n):52>n?String.fromCharCode("a".charCodeAt(0)+n-26):62>n?String.fromCharCode("0".charCodeAt(0)+n-52):62===n?"+":"/"}return t}var n,i=t(23),o=t(24),a=t(29),l=t(26),s=t(25),u=t(30),p=t(32),c=t(2);!function(e){e[e.ScriptInfo=0]="ScriptInfo",e[e.Styles=1]="Styles",e[e.Events=2]="Events",e[e.Fonts=3]="Fonts",e[e.Graphics=4]="Graphics",e[e.Other=5]="Other",e[e.EOF=6]="EOF"}(n||(n={}));var f=function(){function e(e){var t=this;this._stream=e,this._ass=new o.ASS,this._minimalDeferred=new p.DeferredPromise,this._deferred=new p.DeferredPromise,this._shouldSwallowBom=!0,this._currentSection=n.ScriptInfo,this._currentAttachment=null,this._stream.nextLine().then(function(e){return t._onNextLine(e)},function(e){t._minimalDeferred.reject(e),t._deferred.reject(e)})}return Object.defineProperty(e.prototype,"minimalASS",{get:function(){return this._minimalDeferred.promise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ass",{get:function(){return this._deferred.promise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentSection",{get:function(){return this._currentSection},set:function(e){if(null!==this._currentAttachment&&(this._ass.addAttachment(this._currentAttachment),this._currentAttachment=null),this._currentSection===n.ScriptInfo&&e!==n.ScriptInfo&&this._minimalDeferred.resolve(this._ass),e===n.EOF){var t=this._ass.properties;void 0===t.resolutionX||void 0===t.resolutionY?(this._minimalDeferred.reject("Malformed ASS script."),this._deferred.reject("Malformed ASS script.")):(this._minimalDeferred.resolve(this._ass),this._deferred.resolve(this._ass))}this._currentSection=e},enumerable:!0,configurable:!0}),e.prototype._onNextLine=function(e){var t=this;if(null===e)return void(this.currentSection=n.EOF);if("\r"===e[e.length-1]&&(e=e.substr(0,e.length-1)),65279===e.charCodeAt(0)&&this._shouldSwallowBom&&(e=e.substr(1)),this._shouldSwallowBom=!1,""===e);else if(";"===e[0]&&null===this._currentAttachment);else if("[Script Info]"===e)this.currentSection=n.ScriptInfo;else if("[V4+ Styles]"===e||"[V4 Styles]"===e)this.currentSection=n.Styles;else if("[Events]"===e)this.currentSection=n.Events;else if("[Fonts]"===e)this.currentSection=n.Fonts;else if("[Graphics]"===e)this.currentSection=n.Graphics;else switch(null===this._currentAttachment&&"["===e[0]&&"]"===e[e.length-1]&&(this.currentSection=n.Other),this.currentSection){case n.ScriptInfo:var o=c.parseLineIntoProperty(e);if(null!==o)switch(o.name){case"PlayResX":this._ass.properties.resolutionX=parseInt(o.value);break;case"PlayResY":this._ass.properties.resolutionY=parseInt(o.value);break;case"WrapStyle":this._ass.properties.wrappingStyle=parseInt(o.value);break;case"ScaledBorderAndShadow":this._ass.properties.scaleBorderAndShadow="yes"===o.value}break;case n.Styles:if(null===this._ass.stylesFormatSpecifier){var a=c.parseLineIntoProperty(e);null!==a&&"Format"===a.name&&(this._ass.stylesFormatSpecifier=a.value.split(",").map(function(e){return e.trim()}))}else try{this._ass.addStyle(e)}catch(l){i.debugMode}break;case n.Events:if(null===this._ass.dialoguesFormatSpecifier){var u=c.parseLineIntoProperty(e);null!==u&&"Format"===u.name&&(this._ass.dialoguesFormatSpecifier=u.value.split(",").map(function(e){return e.trim()}))}else try{this._ass.addEvent(e)}catch(l){i.debugMode}break;case n.Fonts:case n.Graphics:var p=this.currentSection===n.Fonts?/^fontname:(.+)/:/^filename:(.+)/,f=p.exec(e);if(null!==f)null!==this._currentAttachment&&(this._ass.addAttachment(this._currentAttachment),this._currentAttachment=null),this._currentAttachment=new s.Attachment(f[1].trim(),this.currentSection===n.Fonts?s.AttachmentType.Font:s.AttachmentType.Graphic);else if(null!==this._currentAttachment)try{this._currentAttachment.contents+=r(e)}catch(l){i.debugMode,this._currentAttachment=null}break;case n.Other:break;default:throw new Error("Unhandled state "+this.currentSection)}this._stream.nextLine().then(function(e){return t._onNextLine(e)},function(e){t._minimalDeferred.reject(e),t._deferred.reject(e)})},e}();e.StreamParser=f;var h=function(){function e(e){var t=this;this._stream=e,this._ass=new o.ASS,this._deferred=new p.DeferredPromise,this._shouldSwallowBom=!0,this._currentDialogueNumber=null,this._currentDialogueStart=null,this._currentDialogueEnd=null,this._currentDialogueText=null,this._stream.nextLine().then(function(e){return t._onNextLine(e)},function(e){t._deferred.reject(e)}),this._ass.properties.resolutionX=1280,this._ass.properties.resolutionY=720,this._ass.properties.wrappingStyle=1,this._ass.properties.scaleBorderAndShadow=!0;var r=new a.Style(new u.Map([["Name","Default"],["FontSize","36"]]));this._ass.styles.set(r.name,r)}return Object.defineProperty(e.prototype,"ass",{get:function(){return this._deferred.promise},enumerable:!0,configurable:!0}),e.prototype._onNextLine=function(e){var t=this;if(null===e)return null!==this._currentDialogueNumber&&null!==this._currentDialogueStart&&null!==this._currentDialogueEnd&&null!==this._currentDialogueText&&this._ass.dialogues.push(new l.Dialogue(new u.Map([["Style","Default"],["Start",this._currentDialogueStart],["End",this._currentDialogueEnd],["Text",this._currentDialogueText]]),this._ass)),void this._deferred.resolve(this._ass);if("\r"===e[e.length-1]&&(e=e.substr(0,e.length-1)),65279===e.charCodeAt(0)&&this._shouldSwallowBom&&(e=e.substr(1)),this._shouldSwallowBom=!1,""===e)null!==this._currentDialogueNumber&&null!==this._currentDialogueStart&&null!==this._currentDialogueEnd&&null!==this._currentDialogueText&&this._ass.dialogues.push(new l.Dialogue(new u.Map([["Style","Default"],["Start",this._currentDialogueStart],["End",this._currentDialogueEnd],["Text",this._currentDialogueText]]),this._ass)),this._currentDialogueNumber=this._currentDialogueStart=this._currentDialogueEnd=this._currentDialogueText=null;else if(null===this._currentDialogueNumber)/^\d+$/.test(e)&&(this._currentDialogueNumber=e);else if(null===this._currentDialogueStart&&null===this._currentDialogueEnd){var r=/^(\d\d:\d\d:\d\d,\d\d\d) --> (\d\d:\d\d:\d\d,\d\d\d)/.exec(e);null!==r&&(this._currentDialogueStart=r[1].replace(",","."),this._currentDialogueEnd=r[2].replace(",","."))}else e=e.replace(/<b>/g,"{\\b1}").replace(/\{b\}/g,"{\\b1}").replace(/<\/b>/g,"{\\b0}").replace(/\{\/b\}/g,"{\\b0}").replace(/<i>/g,"{\\i1}").replace(/\{i\}/g,"{\\i1}").replace(/<\/i>/g,"{\\i0}").replace(/\{\/i\}/g,"{\\i0}").replace(/<u>/g,"{\\u1}").replace(/\{u\}/g,"{\\u1}").replace(/<\/u>/g,"{\\u0}").replace(/\{\/u\}/g,"{\\u0}").replace(/<font color="#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})">/g,function(e,t,r,n){return"{c&H"+n+r+t+"&}"}).replace(/<\/font>/g,"{\\c}"),null!==this._currentDialogueText?this._currentDialogueText+="\\N"+e:this._currentDialogueText=e;this._stream.nextLine().then(function(e){return t._onNextLine(e)},function(e){t._deferred.reject(e)})},e}();e.SrtStreamParser=h},function(t,r){var n=r(32),i=function(){function e(e){this._str=e,this._readTill=0}return e.prototype.nextLine=function(){var e=null;if(this._readTill<this._str.length){var t=this._str.indexOf("\n",this._readTill);-1!==t?(e=n.Promise.resolve(this._str.substring(this._readTill,t)),this._readTill=t+1):(e=n.Promise.resolve(this._str.substr(this._readTill)),this._readTill=this._str.length)}else e=n.Promise.resolve(null);return e},e}();t.StringStream=i;var o=function(){function e(e){var t=this;this._xhr=e,this._readTill=0,this._pendingDeferred=null,this._failedError=null,e.addEventListener("progress",function(){return t._onXhrProgress()},!1),e.addEventListener("load",function(){return t._onXhrLoad()},!1),e.addEventListener("error",function(e){return t._onXhrError(e)},!1)}return e.prototype.nextLine=function(){if(null!==this._pendingDeferred)throw new Error("XhrStream only supports one pending unfulfilled read at a time.");
var e=this._pendingDeferred=new n.DeferredPromise;return this._tryResolveNextLine(),e.promise},e.prototype._onXhrProgress=function(){null!==this._pendingDeferred&&this._xhr.readyState!==XMLHttpRequest.DONE&&this._tryResolveNextLine()},e.prototype._onXhrLoad=function(){null!==this._pendingDeferred&&this._tryResolveNextLine()},e.prototype._onXhrError=function(e){this._failedError=e,null!==this._pendingDeferred&&this._tryResolveNextLine()},e.prototype._tryResolveNextLine=function(){if(null!==this._failedError)return void this._pendingDeferred.reject(this._failedError);var e=this._xhr.responseText,t=e.indexOf("\n",this._readTill);-1!==t?(this._pendingDeferred.resolve(e.substring(this._readTill,t)),this._readTill=t+1,this._pendingDeferred=null):this._xhr.readyState===XMLHttpRequest.DONE&&(null!==this._failedError?this._pendingDeferred.reject(this._failedError):this._readTill<e.length?(this._pendingDeferred.resolve(e.substr(this._readTill)),this._readTill=e.length):this._pendingDeferred.resolve(null),this._pendingDeferred=null)},e}();t.XhrStream=o;var a=function(){function t(t,r){this._buffer="",this._pendingDeferred=null,this._reader=t.getReader(),this._decoder=new e.TextDecoder(r,{ignoreBOM:!0})}return t.prototype.nextLine=function(){if(null!==this._pendingDeferred)throw new Error("BrowserReadableStream only supports one pending unfulfilled read at a time.");var e=this._pendingDeferred=new n.DeferredPromise;return this._tryResolveNextLine(),e.promise},t.prototype._tryResolveNextLine=function(){var e=this,t=this._buffer.indexOf("\n");-1!==t?(this._pendingDeferred.resolve(this._buffer.substr(0,t)),this._buffer=this._buffer.substr(t+1),this._pendingDeferred=null):this._reader.read().then(function(t){var r=t.value,n=t.done;n?(0===e._buffer.length?e._pendingDeferred.resolve(null):(e._pendingDeferred.resolve(e._buffer),e._buffer=""),e._pendingDeferred=null):(e._buffer+=e._decoder.decode(r,{stream:!0}),e._tryResolveNextLine())})},t}();t.BrowserReadableStream=a},function(e,t){function r(e){for(var t=atob(e.contents),r=new Uint8Array(new ArrayBuffer(t.length)),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);for(var i={dataView:new DataView(r.buffer),position:0},o=p.read(i),a=null,n=0;n<o.numTables;n++){var l=c.read(i);if(l.c1+l.c2+l.c3+l.c4==="name"){a=l;break}}i.position=a.offset;for(var u=f.read(i),d=new s.Set,n=0;n<u.count;n++){var _=h.read(i);switch(_.nameId){case 1:case 4:case 6:var g=a.offset+u.stringOffset+_.offset,v=r.subarray(g,g+_.length);switch(_.platformId){case 1:for(var y="",m=0;m<v.length;m++)y+=String.fromCharCode(v[m]);d.add(y);break;case 3:for(var b="",m=0;m<v.length;m+=2)b+=String.fromCharCode((v[m]<<8)+v[m+1]);d.add(b)}}}return d}function n(e){var t=e.__fields;return e.read=function(r){for(var n=new e,i=0;i<t.length;i++){var a=t[i],l=void 0;switch(a.type){case o.Char:l=String.fromCharCode(r.dataView.getInt8(r.position)),r.position+=1;break;case o.Uint16:l=r.dataView.getUint16(r.position),r.position+=2;break;case o.Uint32:l=r.dataView.getUint32(r.position),r.position+=4}n[a.field]=l}return n},e}function i(e){var t=u.get(e);return void 0===t&&(t=function(t,r){var n=t.constructor;void 0===n.__fields&&(n.__fields=[]),n.__fields.push({type:e,field:r})},u.set(e,t)),t}var o,a=t(34).__decorate,l=t(30),s=t(33);!function(e){e[e.Char=0]="Char",e[e.Uint16=1]="Uint16",e[e.Uint32=2]="Uint32"}(o||(o={}));var u=new l.Map,p=function(){function e(){}return a([i(o.Uint16)],e.prototype,"majorVersion",void 0),a([i(o.Uint16)],e.prototype,"minorVersion",void 0),a([i(o.Uint16)],e.prototype,"numTables",void 0),a([i(o.Uint16)],e.prototype,"searchRange",void 0),a([i(o.Uint16)],e.prototype,"entrySelector",void 0),a([i(o.Uint16)],e.prototype,"rangeShift",void 0),e=a([n],e)}(),c=function(){function e(){}return a([i(o.Char)],e.prototype,"c1",void 0),a([i(o.Char)],e.prototype,"c2",void 0),a([i(o.Char)],e.prototype,"c3",void 0),a([i(o.Char)],e.prototype,"c4",void 0),a([i(o.Uint32)],e.prototype,"checksum",void 0),a([i(o.Uint32)],e.prototype,"offset",void 0),a([i(o.Uint32)],e.prototype,"length",void 0),e=a([n],e)}(),f=function(){function e(){}return a([i(o.Uint16)],e.prototype,"formatSelector",void 0),a([i(o.Uint16)],e.prototype,"count",void 0),a([i(o.Uint16)],e.prototype,"stringOffset",void 0),e=a([n],e)}(),h=function(){function e(){}return a([i(o.Uint16)],e.prototype,"platformId",void 0),a([i(o.Uint16)],e.prototype,"encodingId",void 0),a([i(o.Uint16)],e.prototype,"languageId",void 0),a([i(o.Uint16)],e.prototype,"nameId",void 0),a([i(o.Uint16)],e.prototype,"length",void 0),a([i(o.Uint16)],e.prototype,"offset",void 0),e=a([n],e)}();e.getTtfNames=r},function(e){var t=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e}();e.MoveInstruction=t;var r=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e}();e.LineInstruction=r;var n=function(){function e(e,t,r,n,i,o){this._x1=e,this._y1=t,this._x2=r,this._y2=n,this._x3=i,this._y3=o}return Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this._x2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this._y2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x3",{get:function(){return this._x3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y3",{get:function(){return this._y3},enumerable:!0,configurable:!0}),e}();e.CubicBezierCurveInstruction=n},function(e,t){var r=t(7);e.drawing=r;var n=function(){function e(e,t,r,n){void 0===n&&(n=1),this._red=e,this._green=t,this._blue=r,this._alpha=n}return Object.defineProperty(e.prototype,"red",{get:function(){return this._red},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"green",{get:function(){return this._green},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blue",{get:function(){return this._blue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},enumerable:!0,configurable:!0}),e.prototype.withAlpha=function(t){return null!==t?new e(this._red,this._green,this._blue,t):this},e.prototype.toString=function(){return"rgba("+this._red+", "+this._green+", "+this._blue+", "+this._alpha.toFixed(3)+")"},e.prototype.interpolate=function(t,r){return new e(this._red+r*(t.red-this._red),this._green+r*(t.green-this._green),this._blue+r*(t.blue-this._blue),this._alpha+r*(t.alpha-this._alpha))},e}();e.Color=n;var i=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Comment=i;var o=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"Text { value: "+this._value.replace(/\u00A0/g,"\\h")+" }"},e}();e.Text=o;var a=function(){function e(){}return e}();e.NewLine=a;var l=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Italic=l;var s=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Bold=s;var u=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Underline=u;var p=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.StrikeThrough=p;var c=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Border=c;var f=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.BorderX=f;var h=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.BorderY=h;var d=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Shadow=d;var _=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.ShadowX=_;var g=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.ShadowY=g;var v=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Blur=v;var y=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.GaussianBlur=y;var m=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.FontName=m;var b=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.FontSize=b;var w=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.FontSizePlus=w;var S=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.FontSizeMinus=S;var O=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.FontScaleX=O;var P=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.FontScaleY=P;var C=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.LetterSpacing=C;var k=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.RotateX=k;var E=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.RotateY=E;var x=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.RotateZ=x;var j=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.SkewX=j;var A=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.SkewY=A;var T=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.PrimaryColor=T;var D=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.SecondaryColor=D;var F=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.OutlineColor=F;var M=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.ShadowColor=M;var R=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Alpha=R;var N=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.PrimaryAlpha=N;var W=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.SecondaryAlpha=W;var L=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.OutlineAlpha=L;var I=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.ShadowAlpha=I;var X=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Alignment=X;var Y=function(){function e(e){this._duration=e}return Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),e}();e.ColorKaraoke=Y;var V=function(){function e(e){this._duration=e}return Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),e}();e.SweepingColorKaraoke=V;var B=function(){function e(e){this._duration=e}return Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),e}();e.OutlineKaraoke=B;var z=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.WrappingStyle=z;var G=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.Reset=G;var q=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e}();e.Position=q;var U=function(){function e(e,t,r,n,i,o){this._x1=e,this._y1=t,this._x2=r,this._y2=n,this._t1=i,this._t2=o}return Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this._x2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this._y2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t1",{get:function(){return this._t1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t2",{get:function(){return this._t2},enumerable:!0,configurable:!0}),e}();e.Move=U;var K=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e}();e.RotationOrigin=K;var H=function(){function e(e,t){this._start=e,this._end=t}return Object.defineProperty(e.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),e}();e.Fade=H;var Z=function(){function e(e,t,r,n,i,o,a){this._a1=e,this._a2=t,this._a3=r,this._t1=n,this._t2=i,this._t3=o,this._t4=a}return Object.defineProperty(e.prototype,"a1",{get:function(){return this._a1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a2",{get:function(){return this._a2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"a3",{get:function(){return this._a3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t1",{get:function(){return this._t1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t2",{get:function(){return this._t2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t3",{get:function(){return this._t3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"t4",{get:function(){return this._t4},enumerable:!0,configurable:!0}),e}();e.ComplexFade=Z;var J=function(){function e(e,t,r,n){this._start=e,this._end=t,this._accel=r,this._tags=n}return Object.defineProperty(e.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accel",{get:function(){return this._accel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tags",{get:function(){return this._tags},enumerable:!0,configurable:!0}),e}();e.Transform=J;var $=function(){function e(e,t,r,n,i){this._x1=e,this._y1=t,this._x2=r,this._y2=n,this._inside=i}return Object.defineProperty(e.prototype,"x1",{get:function(){return this._x1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y1",{get:function(){return this._y1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x2",{get:function(){return this._x2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y2",{get:function(){return this._y2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inside",{get:function(){return this._inside},enumerable:!0,configurable:!0}),e}();e.RectangularClip=$;var Q=function(){function e(e,t,r){this._scale=e,this._instructions=t,this._inside=r}return Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instructions",{get:function(){return this._instructions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inside",{get:function(){return this._inside},enumerable:!0,configurable:!0}),e}();e.VectorClip=Q;var et=function(){function e(e){this._scale=e}return Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),e}();e.DrawingMode=et;var tt=function(){function e(e){this._value=e}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}();e.DrawingBaselineOffset=tt;var rt=function(){function e(e){this._instructions=e}return Object.defineProperty(e.prototype,"instructions",{get:function(){return this._instructions},enumerable:!0,configurable:!0}),e}();e.DrawingInstructions=rt;for(var nt=function(e,t){if(!e.prototype.hasOwnProperty("toString")){var r=Object.getOwnPropertyNames(e.prototype).filter(function(e){return"constructor"!==e});e.prototype.toString=function(){var e=this;return t+" { "+r.map(function(t){return t+": "+e[t]}).join(", ")+(r.length>0?" ":"")+"}"}}},it=t(38),ot=0,at=Object.keys(e);ot<at.length;ot++){var lt=at[ot],st=e[lt];st instanceof Function&&(nt(st,lt),it.registerClassPrototype(st.prototype))}for(var ut=0,pt=Object.keys(r);ut<pt.length;ut++){var lt=pt[ut],st=r[lt];st instanceof Function&&(nt(st,"Drawing"+lt),it.registerClassPrototype(st.prototype))}},function(e,t){var r=t(23),n=t(11),i=function(){function e(e,t){this._getCurrentTime=e,this._autoPauseAfter=t,this._manualClock=new n.ManualClock,this._nextAnimationFrameRequestId=null,this._lastKnownExternalTime=null,this._lastKnownExternalTimeObtainedAt=null}return e.prototype.play=function(){this._manualClock.enabled&&(this._startTicking(),this._manualClock.play())},e.prototype.pause=function(){if(this._manualClock.enabled){if(null===this._nextAnimationFrameRequestId)return void r.debugMode;this._stopTicking(),this._manualClock.pause()}},e.prototype.seeking=function(){this._manualClock.seek(this._getCurrentTime())},Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._manualClock.currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._manualClock.enabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._manualClock.paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rate",{get:function(){return this._manualClock.rate},enumerable:!0,configurable:!0}),e.prototype.setRate=function(e){this._manualClock.setRate(e)},e.prototype.enable=function(){return this._manualClock.enable()?(this._startTicking(),!0):!1},e.prototype.disable=function(){return this._manualClock.disable()?(this._stopTicking(),!0):!1},e.prototype.toggle=function(){this._manualClock.enabled?this.disable():this.enable()},e.prototype.setEnabled=function(e){return e?this.enable():this.disable()},e.prototype.addEventListener=function(e,t){this._manualClock.addEventListener(e,t)},e.prototype._onTimerTick=function(e){var t=this;if(!this._manualClock.enabled)return void r.debugMode;var n=this._manualClock.currentTime,i=this._getCurrentTime();this._manualClock.paused?n!==i&&(this._lastKnownExternalTime=i,this._lastKnownExternalTimeObtainedAt=e,this._manualClock.tick(i)):null!==this._lastKnownExternalTime&&i===this._lastKnownExternalTime?e-this._lastKnownExternalTimeObtainedAt>this._autoPauseAfter?(this._lastKnownExternalTimeObtainedAt=null,this._manualClock.pause()):this._manualClock.tick((e-this._lastKnownExternalTimeObtainedAt)/1e3*this._manualClock.rate+this._lastKnownExternalTime):(this._lastKnownExternalTime=i,this._lastKnownExternalTimeObtainedAt=e,this._manualClock.tick(i)),this._nextAnimationFrameRequestId=requestAnimationFrame(function(e){return t._onTimerTick(e)})},e.prototype._startTicking=function(){var e=this;null===this._nextAnimationFrameRequestId&&(this._nextAnimationFrameRequestId=requestAnimationFrame(function(t){return e._onTimerTick(t)}))},e.prototype._stopTicking=function(){null!==this._nextAnimationFrameRequestId&&(cancelAnimationFrame(this._nextAnimationFrameRequestId),this._nextAnimationFrameRequestId=null)},e}();e.AutoClock=i},function(e){var t=function(){function e(){}return e.prototype.addEventListener=function(e,t){var r=this._eventListeners.get(e);void 0===r&&this._eventListeners.set(e,r=[]),r.push(t)},e.prototype._dispatchEvent=function(e,t){var r=this._eventListeners.get(e);if(void 0!==r)for(var n=0;n<r.length;n++){var i=r[n];i.apply(this,t)}},e}();e.EventSource=t,function(e){e[e.Play=0]="Play",e[e.Tick=1]="Tick",e[e.Pause=2]="Pause",e[e.Stop=3]="Stop",e[e.RateChange=4]="RateChange"}(e.ClockEvent||(e.ClockEvent={}))},function(e,t){var r=t(31),n=t(30),i=t(10),o=function(){function e(){this._currentTime=-1,this._rate=1,this._enabled=!0,this._paused=!0,this._eventListeners=new n.Map}return e.prototype.play=function(){this._enabled&&this._paused&&(this._paused=!1,this._dispatchEvent(i.ClockEvent.Play,[]))},e.prototype.tick=function(e){this._enabled&&this._currentTime!==e&&(this.play(),this._currentTime=e,this._dispatchEvent(i.ClockEvent.Tick,[]))},e.prototype.seek=function(e){this._enabled&&(this.pause(),this._currentTime!==e&&(this.stop(),this.tick(e),this.pause()))},e.prototype.pause=function(){this._enabled&&(this._paused||(this._paused=!0,this._dispatchEvent(i.ClockEvent.Pause,[])))},e.prototype.stop=function(){this._dispatchEvent(i.ClockEvent.Stop,[])},Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rate",{get:function(){return this._rate},enumerable:!0,configurable:!0}),e.prototype.setRate=function(e){this._rate!==e&&(this._rate=e,this._dispatchEvent(i.ClockEvent.RateChange,[]))},e.prototype.enable=function(){return this._enabled?!1:(this._enabled=!0,!0)},e.prototype.disable=function(){return this._enabled?(this.pause(),this.stop(),this._enabled=!1,!0):!1},e.prototype.toggle=function(){this._enabled?this.disable():this.enable()},e.prototype.setEnabled=function(e){return e?this.enable():this.disable()},e}();e.ManualClock=o,r.mixin(o,[i.EventSource])},function(e,t){var r=t(9),n=function(){function e(e){var t=this;this._autoClock=new r.AutoClock(function(){return e.currentTime},100),e.addEventListener("playing",function(){return t._autoClock.play()},!1),e.addEventListener("pause",function(){return t._autoClock.pause()},!1),e.addEventListener("seeking",function(){return t._autoClock.seeking()},!1),e.addEventListener("ratechange",function(){return t._autoClock.setRate(e.playbackRate)},!1)}return Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._autoClock.currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._autoClock.enabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._autoClock.paused},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rate",{get:function(){return this._autoClock.rate},enumerable:!0,configurable:!0}),e.prototype.enable=function(){return this._autoClock.enable()},e.prototype.disable=function(){return this._autoClock.disable()},e.prototype.toggle=function(){this._autoClock.enabled?this.disable():this.enable()},e.prototype.setEnabled=function(e){return e?this.enable():this.disable()},e.prototype.addEventListener=function(e,t){this._autoClock.addEventListener(e,t)},e}();e.VideoClock=n},function(e,t){var r=t(34).__extends,n=t(12),i=t(21),o=function(e){function t(t,r,i){e.call(this,r,new n.VideoClock(t),document.createElement("div"),i),this._video=t,this._video.parentElement.replaceChild(this.libjassSubsWrapper,this._video),this.libjassSubsWrapper.insertBefore(this._video,this.libjassSubsWrapper.firstElementChild)}return r(t,e),t.prototype.resize=function(){var t=this._video.videoWidth,r=this._video.videoHeight,n=this._video.offsetWidth,i=this._video.offsetHeight,o=Math.min(n/t,i/r),a=t*o,l=r*o,s=(n-a)/2,u=(i-l)/2;e.prototype.resize.call(this,a,l,s,u)},t.prototype.resizeVideo=function(){this.resize()},t.prototype._ready=function(){this.resize(),e.prototype._ready.call(this)},t}(i.WebRenderer);e.DefaultRenderer=o},function(e,t){var r=t(10);e.ClockEvent=r.ClockEvent,e.EventSource=r.EventSource;var n=t(9);e.AutoClock=n.AutoClock;var i=t(11);e.ManualClock=i.ManualClock;var o=t(12);e.VideoClock=o.VideoClock;var a=t(13);e.DefaultRenderer=a.DefaultRenderer;var l=t(15);e.NullRenderer=l.NullRenderer;var s=t(21);e.WebRenderer=s.WebRenderer;var u=t(16);e.RendererSettings=u.RendererSettings},function(e,t){var r=t(10),n=t(16),i=t(23),o=function(){function e(t,i,o){var a=this;this._ass=t,this._clock=i,this._id=++e._lastRendererId,this._settings=n.RendererSettings.from(o),this._clock.addEventListener(r.ClockEvent.Play,function(){return a._onClockPlay()}),this._clock.addEventListener(r.ClockEvent.Tick,function(){return a._onClockTick()}),this._clock.addEventListener(r.ClockEvent.Pause,function(){return a._onClockPause()}),this._clock.addEventListener(r.ClockEvent.Stop,function(){return a._onClockStop()}),this._clock.addEventListener(r.ClockEvent.RateChange,function(){return a._onClockRateChange()})}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ass",{get:function(){return this._ass},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return this._settings},enumerable:!0,configurable:!0}),e.prototype.preRender=function(){},e.prototype.draw=function(){},e.prototype.enable=function(){return this._clock.enable()},e.prototype.disable=function(){return this._clock.disable()},e.prototype.toggle=function(){this._clock.toggle()},e.prototype.setEnabled=function(e){return this._clock.setEnabled(e)},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._clock.enabled},enumerable:!0,configurable:!0}),e.prototype._onClockPlay=function(){i.verboseMode},e.prototype._onClockTick=function(){var e=this._clock.currentTime;i.verboseMode;for(var t=0,r=this._ass.dialogues;t<r.length;t++){var n=r[t];n.end>e&&(n.start<=e?this.draw(n):n.start<=e+this._settings.preRenderTime&&this.preRender(n))}},e.prototype._onClockPause=function(){i.verboseMode},e.prototype._onClockStop=function(){i.verboseMode},e.prototype._onClockRateChange=function(){i.verboseMode},e._lastRendererId=-1,e}();e.NullRenderer=o},function(e,t){function r(e){return e.type===CSSRule.FONT_FACE_RULE}var n=t(30),i=function(){function e(){}return e.makeFontMapFromStyleElement=function(e){for(var t=new n.Map,i=e.sheet,o=0;o<i.cssRules.length;o++){var a=i.cssRules[o];if(r(a)){var l=a.style.getPropertyValue("font-family").match(/^["']?(.*?)["']?$/)[1],s=a.style.getPropertyValue("src");s||(s=a.cssText.split("\n").map(function(e){return e.match(/src:\s*([^;]+?)\s*;/)}).filter(function(e){return null!==e}).map(function(e){return e[1]})[0]),t.set(l,s)}}return t},e.from=function(t){(void 0===t||null===t)&&(t={});var r=t,n=r.fontMap,i=void 0===n?null:n,o=r.preRenderTime,a=void 0===o?5:o,l=r.preciseOutlines,s=void 0===l?!1:l,u=r.enableSvg,p=void 0===u?!0:u,c=r.fallbackFonts,f=void 0===c?'Arial, Helvetica, sans-serif, "Segoe UI Symbol"':c,h=r.useAttachedFonts,d=void 0===h?!1:h,_=new e;return _.fontMap=i,_.preRenderTime=a,_.preciseOutlines=s,_.enableSvg=p,_.fallbackFonts=f,_.useAttachedFonts=d,_},e}();e.RendererSettings=i},function(e,t){var r=t(30),n=function(){function e(t,n){this._style=n,this._animationStyle="",this._animationDelays=new r.Map,this._numAnimations=0,this._id=t.id+"-"+e._nextId++,this._rate=t.clock.rate}return Object.defineProperty(e.prototype,"animationStyle",{get:function(){return this._animationStyle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationDelays",{get:function(){return this._animationDelays},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){for(var r=null,n=null,i=0;i<t.length;i++){var o=t[i];null===r&&(r=o.time),n=o.time}for(var a="",l=0;l<t.length;l++){var o=t[l];a+="	"+(100*(n-r===0?1:(o.time-r)/(n-r))).toFixed(3)+"% {\n",o.properties.forEach(function(e,t){a+="		"+t+": "+e+";\n"}),a+="	}\n"}var s="animation-"+this._id+"-"+this._numAnimations++;this._style.appendChild(document.createTextNode("@-webkit-keyframes "+s+" {\n"+a+"\n}")),this._style.appendChild(document.createTextNode("@keyframes "+s+" {\n"+a+"\n}")),""!==this._animationStyle&&(this._animationStyle+=","),this._animationStyle+=s+" "+((n-r)/this._rate).toFixed(3)+"s "+e,this._animationDelays.set(s,r)},e._nextId=0,e}();e.AnimationCollection=n},function(e,t){var r=t(8),n=function(){function e(e,t){this._outputScaleX=e,this._outputScaleY=t,this._scale=1,this._baselineOffset=0}return Object.defineProperty(e.prototype,"scale",{set:function(e){this._scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baselineOffset",{set:function(e){this._baselineOffset=e},enumerable:!0,configurable:!0}),e.prototype.toSVG=function(e,t){for(var n=Math.pow(2,this._scale-1),i=this._outputScaleX/n,o=this._outputScaleY/n,a=document.createElementNS("http://www.w3.org/2000/svg","path"),l=0,s=0,u=0,p=e.instructions;u<p.length;u++){var c=p[u];
c instanceof r.drawing.MoveInstruction?(a.pathSegList.appendItem(a.createSVGPathSegMovetoAbs(c.x,c.y+this._baselineOffset)),l=Math.max(l,c.x),s=Math.max(s,c.y+this._baselineOffset)):c instanceof r.drawing.LineInstruction?(a.pathSegList.appendItem(a.createSVGPathSegLinetoAbs(c.x,c.y+this._baselineOffset)),l=Math.max(l,c.x),s=Math.max(s,c.y+this._baselineOffset)):c instanceof r.drawing.CubicBezierCurveInstruction&&(a.pathSegList.appendItem(a.createSVGPathSegCurvetoCubicAbs(c.x3,c.y3+this._baselineOffset,c.x1,c.y1+this._baselineOffset,c.x2,c.y2+this._baselineOffset)),l=Math.max(l,c.x1,c.x2,c.x3),s=Math.max(s,c.y1+this._baselineOffset,c.y2+this._baselineOffset,c.y3+this._baselineOffset))}var f=document.createElementNS("http://www.w3.org/2000/svg","svg");f.setAttribute("version","1.1"),f.width.baseVal.valueAsString=(l*i).toFixed(3)+"px",f.height.baseVal.valueAsString=(s*o).toFixed(3)+"px";var h=document.createElementNS("http://www.w3.org/2000/svg","g");return f.appendChild(h),h.setAttribute("transform","scale("+i.toFixed(3)+" "+o.toFixed(3)+")"),h.appendChild(a),a.setAttribute("fill",t.toString()),f},e}();e.DrawingStyles=n},function(e,t){function r(e,t,r,n){var i='"'+e+'"';""!==r&&(i+=", "+r),n.style.fontFamily=i,n.style.fontSize=t+"px"}function n(e,t,n,i){return r(e,t,n,i),new u.Promise(function(e){return setTimeout(function(){return e(i.offsetHeight)},1e3)})}function i(e,t,n,i){return r(e,t,n,i),i.offsetHeight}function o(e,t){return[e,180/(t-e)]}function a(e,t,r){return n(e,180,t,r).then(function(i){return n(e,360,t,r).then(function(e){return o(i,e)})})}function l(e,t,r){return 180+(e-t)*r}function s(e,t,r,n,a){var s=a.get(e);if(void 0===s){var u=i(e,180,r,n),p=i(e,360,r,n);a.set(e,s=o(u,p))}var c=s[0],f=s[1];return l(t,c,f)}var u=t(32);e.calculateFontMetrics=a,e.fontSizeForLineHeight=s},function(e){var t=function(){function e(e,t){this._time=e,this._properties=t}return Object.defineProperty(e.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),e}();e.Keyframe=t},function(t,r){var n=r(34).__extends,i=r(17),o=r(18),a=r(19),l=r(20),s=r(22),u=r(10),p=r(15),c=r(6),f=r(8),h=r(23),d=r(25),_=r(27),g=r(31),v=r(30),y=r(32),m=/^(url|local)\(["']?(.+?)["']?\)$/,b=function(t){function r(r,n,i,o){var a=this;t.call(this,r,n,function(){if(!(i instanceof HTMLDivElement)){var e=o;o=i,i=e}return o}()),this._libjassSubsWrapper=i,this._layerWrappers=[],this._layerAlignmentWrappers=[],this._fontMetricsCache=new v.Map,this._currentSubs=new v.Map,this._preRenderedSubs=new v.Map,this._eventListeners=new v.Map,this._libjassSubsWrapper.classList.add("libjass-wrapper"),this._subsWrapper=document.createElement("div"),this._libjassSubsWrapper.appendChild(this._subsWrapper),this._subsWrapper.className="libjass-subs",this._fontSizeElement=document.createElement("div"),this._libjassSubsWrapper.appendChild(this._fontSizeElement),this._fontSizeElement.className="libjass-font-measure",this._fontSizeElement.appendChild(document.createTextNode("M")),h.debugMode;var l=[],s=new v.Map,u=null===this.settings.fontMap?new v.Map:this.settings.fontMap,p=new v.Map;this.settings.useAttachedFonts&&r.attachments.forEach(function(e){if(e.type===d.AttachmentType.Font){var t=null;try{t=c.getTtfNames(e)}catch(r){return}var n="data:application/x-font-ttf;base64,"+e.contents;t.forEach(function(e){var t=u.get(e);if(void 0!==t)if("string"!=typeof t)t.push(n);else{var r=p.get(e);void 0===r&&p.set(e,r=[]),r.push(n)}else u.set(e,[n])})}}),u.forEach(function(t,r){var n;if(e.document.fonts&&e.document.fonts.add){var i="string"==typeof t?t:t.map(function(e){return null!==e.match(m)?e:'url("'+e+'")'}).join(", "),o=p.get(r);if(void 0!==o)for(var u=0;u<o.length;u++){var c=o[u];i+=', url("'+c+'")'}var f=[];e.document.fonts.forEach(function(e){(e.family===r||e.family==='"'+r+'"')&&f.push(e)});var d;if(0===f.length){var _=new FontFace(r,i),g=new FontFace('"'+r+'"',i);e.document.fonts.add(_),e.document.fonts.add(g),d=y.any([_.load(),g.load()])}else d=y.any(f.map(function(e){return e.load()}));n=a._calculateFontMetricsAfterFetch(r,d.catch(function(e){return null}))}else{var v=("string"==typeof t?t.split(/,/):t).map(function(e){return e.trim()}).map(function(e){var t=e.match(m);return null===t?e:"local"===t[1]?null:t[2]}).filter(function(e){return null!==e}),o=p.get(r);void 0!==o&&(v=v.concat(o));var b=v.map(function(e){var t=s.get(e);return void 0===t&&(t=new y.Promise(function(t,r){var n=new XMLHttpRequest;n.addEventListener("load",function(){h.debugMode,t(null)}),n.addEventListener("error",function(e){r(e)}),n.open("GET",e,!0),n.send()}),s.set(e,t)),t}),w=0===b.length?y.Promise.resolve(null):y.first(b).catch(function(e){return null});n=a._calculateFontMetricsAfterFetch(r,w)}l.push(n.then(function(e){return a._fontMetricsCache.set(r,e)}))}),y.Promise.all(l).then(function(){h.debugMode,a._ready()})}return n(r,t),Object.defineProperty(r.prototype,"libjassSubsWrapper",{get:function(){return this._libjassSubsWrapper},enumerable:!0,configurable:!0}),r.prototype.resize=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._removeAllSubs(),this._subsWrapper.style.width=e.toFixed(3)+"px",this._subsWrapper.style.height=t.toFixed(3)+"px",this._subsWrapper.style.left=r.toFixed(3)+"px",this._subsWrapper.style.top=n.toFixed(3)+"px",this._subsWrapperWidth=e,this._scaleX=e/this.ass.properties.resolutionX,this._scaleY=t/this.ass.properties.resolutionY,this._preRenderedSubs.clear(),-1!==this.clock.currentTime&&this._onClockTick()},r.prototype.preRender=function(e){var t=this,n=this._preRenderedSubs.get(e.id);if(n)return n;var a=this.clock.currentTime-e.start;if(e.containsTransformTag&&0>a)return null;var u=document.createElement("div");u.style.marginLeft=(this._scaleX*e.style.marginLeft).toFixed(3)+"px",u.style.marginRight=(this._scaleX*e.style.marginRight).toFixed(3)+"px",u.style.marginTop=u.style.marginBottom=(this._scaleY*e.style.marginVertical).toFixed(3)+"px",u.style.minWidth=(this._subsWrapperWidth-this._scaleX*(e.style.marginLeft+e.style.marginRight)).toFixed(3)+"px";var p=document.createElement("style");p.id="libjass-animation-styles-"+this.id+"-"+e.id,p.type="text/css";var c=new i.AnimationCollection(this,p),d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("version","1.1"),d.setAttribute("class","libjass-filters"),d.width.baseVal.valueAsString="0",d.height.baseVal.valueAsString="0";var g=document.createElementNS("http://www.w3.org/2000/svg","defs");d.appendChild(g);var y=null,m=new s.SpanStyles(this,e,this._scaleX,this._scaleY,this.settings,this._fontSizeElement,g,this._fontMetricsCache),b=null,w=!1,S=function(e){null!==y&&y.hasChildNodes()&&u.appendChild(m.setStylesOnSpan(y,b)),null!==b&&b.animationDelays.forEach(function(e,t){return c.animationDelays.set(t,e)}),e&&u.appendChild(w?m.makeNewLine():document.createElement("br")),y=document.createElement("span"),b=new i.AnimationCollection(t,p),w=e};S(!1);for(var O=new o.DrawingStyles(this._scaleX,this._scaleY),P=this.ass.properties.wrappingStyle,C=0,k=0,E=e.parts;k<E.length;k++){var x=E[k];if(x instanceof f.Italic)m.italic=x.value;else if(x instanceof f.Bold)m.bold=x.value;else if(x instanceof f.Underline)m.underline=x.value;else if(x instanceof f.StrikeThrough)m.strikeThrough=x.value;else if(x instanceof f.Border)m.outlineWidth=x.value,m.outlineHeight=x.value;else if(x instanceof f.BorderX)m.outlineWidth=x.value;else if(x instanceof f.BorderY)m.outlineHeight=x.value;else if(x instanceof f.Shadow)m.shadowDepthX=x.value,m.shadowDepthY=x.value;else if(x instanceof f.ShadowX)m.shadowDepthX=x.value;else if(x instanceof f.ShadowY)m.shadowDepthY=x.value;else if(x instanceof f.Blur)m.blur=x.value;else if(x instanceof f.GaussianBlur)m.gaussianBlur=x.value;else if(x instanceof f.FontName)m.fontName=x.value;else if(x instanceof f.FontSize)m.fontSize=x.value;else if(x instanceof f.FontSizePlus)m.fontSize+=x.value;else if(x instanceof f.FontSizeMinus)m.fontSize-=x.value;else if(x instanceof f.FontScaleX)m.fontScaleX=x.value;else if(x instanceof f.FontScaleY)m.fontScaleY=x.value;else if(x instanceof f.LetterSpacing)m.letterSpacing=x.value;else if(x instanceof f.RotateX)m.rotationX=x.value;else if(x instanceof f.RotateY)m.rotationY=x.value;else if(x instanceof f.RotateZ)m.rotationZ=x.value;else if(x instanceof f.SkewX)m.skewX=x.value;else if(x instanceof f.SkewY)m.skewY=x.value;else if(x instanceof f.PrimaryColor)m.primaryColor=x.value;else if(x instanceof f.SecondaryColor)m.secondaryColor=x.value;else if(x instanceof f.OutlineColor)m.outlineColor=x.value;else if(x instanceof f.ShadowColor)m.shadowColor=x.value;else if(x instanceof f.Alpha)m.primaryAlpha=x.value,m.secondaryAlpha=x.value,m.outlineAlpha=x.value,m.shadowAlpha=x.value;else if(x instanceof f.PrimaryAlpha)m.primaryAlpha=x.value;else if(x instanceof f.SecondaryAlpha)m.secondaryAlpha=x.value;else if(x instanceof f.OutlineAlpha)m.outlineAlpha=x.value;else if(x instanceof f.ShadowAlpha)m.shadowAlpha=x.value;else if(x instanceof f.Alignment);else if(x instanceof f.ColorKaraoke)S(!1),b.add("step-end",[new l.Keyframe(0,new v.Map([["color",m.secondaryColor.withAlpha(m.secondaryAlpha).toString()]])),new l.Keyframe(C,new v.Map([["color",m.primaryColor.withAlpha(m.primaryAlpha).toString()]]))]),C+=x.duration;else if(x instanceof f.WrappingStyle)P=x.value;else if(x instanceof f.Reset)m.reset(this.ass.styles.get(x.value));else if(x instanceof f.Position)u.style.position="absolute",u.style.left=(this._scaleX*x.x).toFixed(3)+"px",u.style.top=(this._scaleY*x.y).toFixed(3)+"px";else if(x instanceof f.Move)u.style.position="absolute",c.add("linear",[new l.Keyframe(0,new v.Map([["left",(this._scaleX*x.x1).toFixed(3)+"px"],["top",(this._scaleY*x.y1).toFixed(3)+"px"]])),new l.Keyframe(x.t1,new v.Map([["left",(this._scaleX*x.x1).toFixed(3)+"px"],["top",(this._scaleY*x.y1).toFixed(3)+"px"]])),new l.Keyframe(x.t2,new v.Map([["left",(this._scaleX*x.x2).toFixed(3)+"px"],["top",(this._scaleY*x.y2).toFixed(3)+"px"]])),new l.Keyframe(e.end-e.start,new v.Map([["left",(this._scaleX*x.x2).toFixed(3)+"px"],["top",(this._scaleY*x.y2).toFixed(3)+"px"]]))]);else if(x instanceof f.Fade)c.add("linear",[new l.Keyframe(0,new v.Map([["opacity","0"]])),new l.Keyframe(x.start,new v.Map([["opacity","1"]])),new l.Keyframe(e.end-e.start-x.end,new v.Map([["opacity","1"]])),new l.Keyframe(e.end-e.start,new v.Map([["opacity","0"]]))]);else if(x instanceof f.ComplexFade)c.add("linear",[new l.Keyframe(0,new v.Map([["opacity",x.a1.toFixed(3)]])),new l.Keyframe(x.t1,new v.Map([["opacity",x.a1.toFixed(3)]])),new l.Keyframe(x.t2,new v.Map([["opacity",x.a2.toFixed(3)]])),new l.Keyframe(x.t3,new v.Map([["opacity",x.a2.toFixed(3)]])),new l.Keyframe(x.t4,new v.Map([["opacity",x.a3.toFixed(3)]])),new l.Keyframe(e.end-e.start,new v.Map([["opacity",x.a3.toFixed(3)]]))]);else if(x instanceof f.Transform)for(var j=a<=x.start?0:a>=x.end?1:Math.pow((a-x.start)/(x.end-x.start),x.accel),A=0,T=x.tags;A<T.length;A++){var D=T[A];D instanceof f.Border?(m.outlineWidth+=j*(D.value-m.outlineWidth),m.outlineHeight+=j*(D.value-m.outlineHeight)):D instanceof f.BorderX?m.outlineWidth+=j*(D.value-m.outlineWidth):D instanceof f.BorderY?m.outlineHeight+=j*(D.value-m.outlineHeight):D instanceof f.Shadow?(m.shadowDepthX+=j*(D.value-m.shadowDepthX),m.shadowDepthY+=j*(D.value-m.shadowDepthY)):D instanceof f.ShadowX?m.shadowDepthX+=j*(D.value-m.shadowDepthX):D instanceof f.ShadowY?m.shadowDepthY+=j*(D.value-m.shadowDepthY):D instanceof f.Blur?m.blur+=j*(D.value-m.blur):D instanceof f.GaussianBlur?m.gaussianBlur+=j*(D.value-m.gaussianBlur):D instanceof f.FontSize?m.fontSize+=j*(D.value-m.fontSize):D instanceof f.FontSizePlus?m.fontSize+=j*D.value:D instanceof f.FontSizeMinus?m.fontSize-=j*D.value:D instanceof f.FontScaleX?m.fontScaleX+=j*(D.value-m.fontScaleX):D instanceof f.FontScaleY?m.fontScaleY+=j*(D.value-m.fontScaleY):D instanceof f.LetterSpacing?m.letterSpacing+=j*(D.value-m.letterSpacing):D instanceof f.RotateX?m.rotationX+=j*(D.value-m.rotationX):D instanceof f.RotateY?m.rotationY+=j*(D.value-m.rotationY):D instanceof f.RotateZ?m.rotationZ+=j*(D.value-m.rotationZ):D instanceof f.SkewX?m.skewX+=j*(D.value-m.skewX):D instanceof f.SkewY?m.skewY+=j*(D.value-m.skewY):D instanceof f.PrimaryColor?m.primaryColor=m.primaryColor.interpolate(D.value,j):D instanceof f.SecondaryColor?m.secondaryColor=m.secondaryColor.interpolate(D.value,j):D instanceof f.OutlineColor?m.outlineColor=m.outlineColor.interpolate(D.value,j):D instanceof f.ShadowColor?m.shadowColor=m.shadowColor.interpolate(D.value,j):D instanceof f.Alpha?(m.primaryAlpha+=j*(D.value-m.primaryAlpha),m.secondaryAlpha+=j*(D.value-m.secondaryAlpha),m.outlineAlpha+=j*(D.value-m.outlineAlpha),m.shadowAlpha+=j*(D.value-m.shadowAlpha)):D instanceof f.PrimaryAlpha?m.primaryAlpha+=j*(D.value-m.primaryAlpha):D instanceof f.SecondaryAlpha?m.secondaryAlpha+=j*(D.value-m.secondaryAlpha):D instanceof f.OutlineAlpha?m.outlineAlpha+=j*(D.value-m.outlineAlpha):D instanceof f.ShadowAlpha&&(m.shadowAlpha+=j*(D.value-m.shadowAlpha))}else x instanceof f.DrawingMode?0!==x.scale&&(O.scale=x.scale):x instanceof f.DrawingBaselineOffset?O.baselineOffset=x.value:x instanceof f.DrawingInstructions?(y.appendChild(O.toSVG(x,m.primaryColor.withAlpha(m.primaryAlpha))),S(!1)):x instanceof f.Text?(y.appendChild(document.createTextNode(x.value+"â")),S(!1)):h.debugMode&&x instanceof f.Comment?(y.appendChild(document.createTextNode(x.value)),S(!1)):x instanceof f.NewLine&&S(!0)}for(var F=0,M=e.parts;F<M.length;F++){var x=M[F];if(x instanceof f.Position||x instanceof f.Move){var R=r._transformOrigins[e.alignment],N="translate("+-R[0]+"%, "+-R[1]+"%) translate(-"+u.style.marginLeft+", -"+u.style.marginTop+")",W=R[0]+"% "+R[1]+"%";u.style.webkitTransform=N,u.style.webkitTransformOrigin=W,u.style.transform=N,u.style.transformOrigin=W;break}}switch(P){case _.WrappingStyle.EndOfLineWrapping:u.style.whiteSpace="pre-wrap";break;case _.WrappingStyle.NoLineWrapping:u.style.whiteSpace="pre";break;case _.WrappingStyle.SmartWrappingWithWiderTopLine:case _.WrappingStyle.SmartWrappingWithWiderBottomLine:u.style.whiteSpace="pre-wrap"}if(""!==u.style.position)switch(e.alignment){case 1:case 4:case 7:u.style.textAlign="left";break;case 2:case 5:case 8:u.style.textAlign="center";break;case 3:case 6:case 9:u.style.textAlign="right"}u.style.webkitAnimation=c.animationStyle,u.style.animation=c.animationStyle,u.setAttribute("data-dialogue-id",this.id+"-"+e.id),""!==p.textContent&&u.appendChild(p),g.hasChildNodes()&&u.appendChild(d);var L={sub:u,animationDelays:c.animationDelays};return e.containsTransformTag||this._preRenderedSubs.set(e.id,L),L},r.prototype.draw=function(e){var t=this;if(!this._currentSubs.has(e)||e.containsTransformTag){h.debugMode;var r=this._preRenderedSubs.get(e.id);void 0===r&&(r=this.preRender(e),h.debugMode);var n=r.sub.cloneNode(!0),i=function(n){var i=n.style.animationName||n.style.webkitAnimationName;if(void 0!==i&&""!==i){var o=i.split(",").map(function(n){n=n.trim();var i=r.animationDelays.get(n);return((i+e.start-t.clock.currentTime)/t.clock.rate).toFixed(3)+"s"}).join(", ");n.style.webkitAnimationDelay=o,n.style.animationDelay=o}};i(n);for(var o=n.querySelectorAll('[style*="animation:"]'),a=0;a<o.length;a++)i(o[a]);var l=e.layer,s="absolute"===n.style.position?0:e.alignment;if(void 0===this._layerWrappers[l]){var u=document.createElement("div");u.className="layer layer"+l;for(var p=null,c=l+1;c<this._layerWrappers.length&&null===p;c++)void 0!==this._layerWrappers[c]&&(p=this._layerWrappers[c]);this._subsWrapper.insertBefore(u,p),this._layerWrappers[l]=u,this._layerAlignmentWrappers[l]=[]}if(void 0===this._layerAlignmentWrappers[l][s]){var f=document.createElement("div");f.className="an an"+s;for(var u=this._layerWrappers[l],p=null,d=s+1;d<this._layerAlignmentWrappers[l].length&&null===p;d++)void 0!==this._layerAlignmentWrappers[l][d]&&(p=this._layerAlignmentWrappers[l][d]);u.insertBefore(f,p),this._layerAlignmentWrappers[l][s]=f}this._layerAlignmentWrappers[l][s].appendChild(n);var _=n.getElementsByTagName("style")[0];if(void 0!==_){var g=_.sheet;0===g.cssRules.length&&(g.cssText=_.textContent)}this._currentSubs.set(e,n)}},r.prototype._onClockPlay=function(){t.prototype._onClockPlay.call(this),this._removeAllSubs(),this._subsWrapper.style.display="",this._subsWrapper.classList.remove("paused")},r.prototype._onClockTick=function(){var e=this,r=this.clock.currentTime;this._currentSubs.forEach(function(t,n){(n.start>r||n.end<r||n.containsTransformTag)&&(e._currentSubs.delete(n),e._removeSub(t))}),t.prototype._onClockTick.call(this)},r.prototype._onClockPause=function(){t.prototype._onClockPause.call(this),this._subsWrapper.classList.add("paused")},r.prototype._onClockStop=function(){t.prototype._onClockStop.call(this),this._subsWrapper.style.display="none"},r.prototype._onClockRateChange=function(){t.prototype._onClockRateChange.call(this),this._preRenderedSubs.clear()},r.prototype._ready=function(){this._dispatchEvent("ready",[])},r.prototype._calculateFontMetricsAfterFetch=function(e,t){var r=this;return t.then(function(){var t=r._fontSizeElement.cloneNode(!0);return r._libjassSubsWrapper.appendChild(t),y.lastly(a.calculateFontMetrics(e,r.settings.fallbackFonts,t),function(){r._libjassSubsWrapper.removeChild(t)})})},r.prototype._removeSub=function(e){e.parentNode.removeChild(e)},r.prototype._removeAllSubs=function(){var e=this;this._currentSubs.forEach(function(t){return e._removeSub(t)}),this._currentSubs.clear()},r._transformOrigins=[null,[0,100],[50,100],[100,100],[0,50],[50,50],[100,50],[0,0],[50,0],[100,0]],r}(p.NullRenderer);t.WebRenderer=b,g.mixin(b,[u.EventSource])},function(e,t){var r=t(19),n=function(){function e(e,t,r,n,i,o,a,l){this._scaleX=r,this._scaleY=n,this._settings=i,this._fontSizeElement=o,this._svgDefsElement=a,this._fontMetricsCache=l,this._nextFilterId=0,this._id=e.id+"-"+t.id,this._defaultStyle=t.style,this.reset(null)}return e.prototype.reset=function(e){(void 0===e||null===e)&&(e=this._defaultStyle),this.italic=e.italic,this.bold=e.bold,this.underline=e.underline,this.strikeThrough=e.strikeThrough,this.outlineWidth=e.outlineThickness,this.outlineHeight=e.outlineThickness,this.shadowDepthX=e.shadowDepth,this.shadowDepthY=e.shadowDepth,this.fontName=e.fontName,this.fontSize=e.fontSize,this.fontScaleX=e.fontScaleX,this.fontScaleY=e.fontScaleY,this.letterSpacing=e.letterSpacing,this._rotationX=null,this._rotationY=null,this._rotationZ=e.rotationZ,this._skewX=null,this._skewY=null,this.primaryColor=e.primaryColor,this.secondaryColor=e.secondaryColor,this.outlineColor=e.outlineColor,this.shadowColor=e.shadowColor,this.primaryAlpha=e.primaryColor.alpha,this.secondaryAlpha=e.secondaryColor.alpha,this.outlineAlpha=e.outlineColor.alpha,this.shadowAlpha=e.shadowColor.alpha,this.blur=null,this.gaussianBlur=null},e.prototype.setStylesOnSpan=function(t,n){var i=t.childNodes[0]instanceof Text,o="";this._italic&&(o+="italic "),this._bold===!0?o+="bold ":this._bold!==!1&&(o+=this._bold+" ");var a=(this._scaleY*r.fontSizeForLineHeight(this._fontName,this._fontSize*(i?this._fontScaleX:1),this._settings.fallbackFonts,this._fontSizeElement,this._fontMetricsCache)).toFixed(3),l=(this._scaleY*this._fontSize).toFixed(3),s=this._fontName;switch(s){case"cursive":case"fantasy":case"monospace":case"sans-serif":case"serif":break;default:s='"'+s+'"'}""!==this._settings.fallbackFonts&&(s+=", "+this._settings.fallbackFonts),t.style.font=""+o+a+"px/"+l+"px "+s;var u="";this._underline&&(u="underline"),this._strikeThrough&&(u+=" line-through"),t.style.textDecoration=u.trim();var p="";if(i?this._fontScaleY!==this._fontScaleX&&(p+="scaleY("+(this._fontScaleY/this._fontScaleX).toFixed(3)+") "):(1!==this._fontScaleX&&(p+="scaleX("+this._fontScaleX+") "),1!==this._fontScaleY&&(p+="scaleY("+this._fontScaleY+") ")),null!==this._rotationY&&(p+="rotateY("+this._rotationY+"deg) "),null!==this._rotationX&&(p+="rotateX("+this._rotationX+"deg) "),0!==this._rotationZ&&(p+="rotateZ("+-1*this._rotationZ+"deg) "),null!==this._skewX||null!==this._skewY){var c=e._valueOrDefault(this._skewX,0),f=e._valueOrDefault(this._skewY,0);p+="matrix(1, "+f+", "+c+", 1, 0, 0) "}""!==p&&(t.style.webkitTransform=p,t.style.webkitTransformOrigin="50% 50%",t.style.transform=p,t.style.transformOrigin="50% 50%",t.style.display="inline-block"),t.style.letterSpacing=(this._scaleX*this._letterSpacing).toFixed(3)+"px";var h=this._scaleX*this._outlineWidth,d=this._scaleY*this._outlineHeight,_=document.createElement("span");_.appendChild(t);var g=this._primaryColor.withAlpha(this._primaryAlpha),v=this._outlineColor.withAlpha(this._outlineAlpha),y=this._shadowColor.withAlpha(this._shadowAlpha);if(this._settings.enableSvg||(0!==h||0!==d)&&v.alpha!==g.alpha||(0!==this._shadowDepthX||0!==this._shadowDepthY)&&y.alpha!==g.alpha||(g=this._primaryColor.withAlpha(1),v=this._outlineColor.withAlpha(1),y=this._shadowColor.withAlpha(1),t.style.opacity=this._primaryAlpha.toFixed(3)),t.style.color=g.toString(),this._settings.enableSvg?this._setSvgOutlineOnSpan(_,h,d,v,this._primaryAlpha):this._setTextShadowOutlineOnSpan(t,h,d,v),0!==this._shadowDepthX||0!==this._shadowDepthY){var m=y.toString()+" "+(this._shadowDepthX*this._scaleX).toFixed(3)+"px "+(this._shadowDepthY*this._scaleY).toFixed(3)+"px 0px";""===t.style.textShadow?t.style.textShadow=m:t.style.textShadow+=", "+m}return(0!==this._rotationX||0!==this._rotationY)&&(_.style.display="inline-block"),t.style.webkitAnimation=n.animationStyle,t.style.animation=n.animationStyle,_},e.prototype._setSvgOutlineOnSpan=function(e,t,r,n,i){var o="svg-filter-"+this._id+"-"+this._nextFilterId++,a=document.createElementNS("http://www.w3.org/2000/svg","filter");if(a.id=o,a.x.baseVal.valueAsString="-50%",a.width.baseVal.valueAsString="200%",a.y.baseVal.valueAsString="-50%",a.height.baseVal.valueAsString="200%",t>0||r>0){var l=0,s=!this._settings.preciseOutlines&&this._gaussianBlur>0?this._gaussianBlur:1;!function(e){if(r>=t)if(t>0){var n;for(n=0;t>=n;n+=s)e(n,r/t*Math.sqrt(t*t-n*n));n!==t+s&&e(t,0)}else e(0,r);else if(r>0){var i;for(i=0;r>=i;i+=s)e(t/r*Math.sqrt(r*r-i*i),i);i!==r+s&&e(0,r)}else e(t,0)}(function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","feMorphology");a.appendChild(r),r.in1.baseVal="source",r.operator.baseVal=SVGFEMorphologyElement.SVG_MORPHOLOGY_OPERATOR_DILATE,r.radiusX.baseVal=e,r.radiusY.baseVal=t,r.result.baseVal="outline"+l,l++});var u=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer");a.insertBefore(u,a.firstElementChild),u.in1.baseVal="SourceAlpha",u.result.baseVal="source";var p=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");u.appendChild(p),p.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,p.slope.baseVal=0===i?1:1/i,p.intercept.baseVal=0;var c=document.createElementNS("http://www.w3.org/2000/svg","feMerge");a.appendChild(c);for(var f=0;l>f;f++){var h=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");c.appendChild(h),h.in1.baseVal="outline"+f}var d=document.createElementNS("http://www.w3.org/2000/svg","feComponentTransfer");a.appendChild(d),d.setAttribute("color-interpolation-filters","sRGB");var _=document.createElementNS("http://www.w3.org/2000/svg","feFuncR");d.appendChild(_),_.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,_.slope.baseVal=0,_.intercept.baseVal=n.red/255*n.alpha;var g=document.createElementNS("http://www.w3.org/2000/svg","feFuncG");d.appendChild(g),g.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,g.slope.baseVal=0,g.intercept.baseVal=n.green/255*n.alpha;var v=document.createElementNS("http://www.w3.org/2000/svg","feFuncB");d.appendChild(v),v.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,v.slope.baseVal=0,v.intercept.baseVal=n.blue/255*n.alpha;var y=document.createElementNS("http://www.w3.org/2000/svg","feFuncA");if(d.appendChild(y),y.type.baseVal=SVGComponentTransferFunctionElement.SVG_FECOMPONENTTRANSFER_TYPE_LINEAR,y.slope.baseVal=n.alpha,y.intercept.baseVal=0,this._gaussianBlur>0){var m=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");a.appendChild(m),m.stdDeviationX.baseVal=this._gaussianBlur,m.stdDeviationY.baseVal=this._gaussianBlur}for(var f=0;f<this._blur;f++){var b=document.createElementNS("http://www.w3.org/2000/svg","feConvolveMatrix");a.appendChild(b),b.setAttribute("kernelMatrix","1 2 1 2 4 2 1 2 1"),b.edgeMode.baseVal=SVGFEConvolveMatrixElement.SVG_EDGEMODE_NONE}var w=document.createElementNS("http://www.w3.org/2000/svg","feComposite");a.appendChild(w),w.in2.baseVal="source",w.operator.baseVal=SVGFECompositeElement.SVG_FECOMPOSITE_OPERATOR_OUT;var S=document.createElementNS("http://www.w3.org/2000/svg","feMerge");a.appendChild(S);var O=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");S.appendChild(O);var P=document.createElementNS("http://www.w3.org/2000/svg","feMergeNode");S.appendChild(P),P.in1.baseVal="SourceGraphic"}else{if(this._gaussianBlur>0){var m=document.createElementNS("http://www.w3.org/2000/svg","feGaussianBlur");a.appendChild(m),m.stdDeviationX.baseVal=this._gaussianBlur,m.stdDeviationY.baseVal=this._gaussianBlur}for(var f=0;f<this._blur;f++){var b=document.createElementNS("http://www.w3.org/2000/svg","feConvolveMatrix");a.appendChild(b),b.setAttribute("kernelMatrix","1 2 1 2 4 2 1 2 1"),b.edgeMode.baseVal=SVGFEConvolveMatrixElement.SVG_EDGEMODE_NONE}}a.childElementCount>0&&(this._svgDefsElement.appendChild(a),e.style.webkitFilter='url("#'+o+'")',e.style.filter='url("#'+o+'")')},e.prototype._setTextShadowOutlineOnSpan=function(e,t,r,n){var i=this;if(t>0||r>0){var o="";!function(e){for(var n=0;t>=n;n++)for(var i=0===t?r:r*Math.sqrt(1-n*n/(t*t)),o=0;i>=o;o++)e(n,o),0!==n&&e(-n,o),0!==o&&e(n,-o),0!==n&&0!==o&&e(-n,-o)}(function(e,t){o+=", "+n.toString()+" "+e+"px "+t+"px "+i._gaussianBlur.toFixed(3)+"px"}),e.style.textShadow=o.substr(", ".length)}},e.prototype.makeNewLine=function(){var e=document.createElement("br");return e.style.lineHeight=(this._scaleY*this._fontSize).toFixed(3)+"px",e},Object.defineProperty(e.prototype,"italic",{set:function(t){this._italic=e._valueOrDefault(t,this._defaultStyle.italic)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bold",{set:function(t){this._bold=e._valueOrDefault(t,this._defaultStyle.bold)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"underline",{set:function(t){this._underline=e._valueOrDefault(t,this._defaultStyle.underline)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strikeThrough",{set:function(t){this._strikeThrough=e._valueOrDefault(t,this._defaultStyle.strikeThrough)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineWidth",{get:function(){return this._outlineWidth},set:function(t){this._outlineWidth=e._valueOrDefault(t,this._defaultStyle.outlineThickness)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineHeight",{get:function(){return this._outlineWidth},set:function(t){this._outlineHeight=e._valueOrDefault(t,this._defaultStyle.outlineThickness)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowDepthX",{get:function(){return this._shadowDepthX},set:function(t){this._shadowDepthX=e._valueOrDefault(t,this._defaultStyle.shadowDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowDepthY",{get:function(){return this._shadowDepthY},set:function(t){this._shadowDepthY=e._valueOrDefault(t,this._defaultStyle.shadowDepth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blur",{get:function(){return this._blur},set:function(t){this._blur=e._valueOrDefault(t,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gaussianBlur",{get:function(){return this._gaussianBlur},set:function(t){this._gaussianBlur=e._valueOrDefault(t,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{set:function(t){this._fontName=e._valueOrDefault(t,this._defaultStyle.fontName)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize=e._valueOrDefault(t,this._defaultStyle.fontSize)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontScaleX",{get:function(){return this._fontScaleX},set:function(t){this._fontScaleX=e._valueOrDefault(t,this._defaultStyle.fontScaleX)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontScaleY",{get:function(){return this._fontScaleY},set:function(t){this._fontScaleY=e._valueOrDefault(t,this._defaultStyle.fontScaleY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing=e._valueOrDefault(t,this._defaultStyle.letterSpacing)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{get:function(){return this._rotationX},set:function(e){this._rotationX=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{get:function(){return this._rotationY},set:function(e){this._rotationY=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{get:function(){return this._rotationZ},set:function(t){this._rotationZ=e._valueOrDefault(t,this._defaultStyle.rotationZ)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewX",{get:function(){return this._skewX},set:function(e){this._skewX=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skewY",{get:function(){return this._skewY},set:function(e){this._skewY=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primaryColor",{get:function(){return this._primaryColor},set:function(t){this._primaryColor=e._valueOrDefault(t,this._defaultStyle.primaryColor)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondaryColor",{get:function(){return this._secondaryColor},set:function(t){this._secondaryColor=e._valueOrDefault(t,this._defaultStyle.secondaryColor)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(t){this._outlineColor=e._valueOrDefault(t,this._defaultStyle.outlineColor)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){return this._shadowColor},set:function(t){this._shadowColor=e._valueOrDefault(t,this._defaultStyle.shadowColor)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primaryAlpha",{get:function(){return this._primaryAlpha},set:function(t){this._primaryAlpha=e._valueOrDefault(t,this._defaultStyle.primaryColor.alpha)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondaryAlpha",{get:function(){return this._secondaryAlpha},set:function(t){this._secondaryAlpha=e._valueOrDefault(t,this._defaultStyle.secondaryColor.alpha)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineAlpha",{get:function(){return this._outlineAlpha},set:function(t){this._outlineAlpha=e._valueOrDefault(t,this._defaultStyle.outlineColor.alpha)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowAlpha",{get:function(){return this._shadowAlpha},set:function(t){this._shadowAlpha=e._valueOrDefault(t,this._defaultStyle.shadowColor.alpha)},enumerable:!0,configurable:!0}),e._valueOrDefault=function(e,t){return null!==e?e:t},e}();e.SpanStyles=n},function(e){function t(t){e.debugMode=t}function r(t){e.verboseMode=t}e.debugMode=!1,e.verboseMode=!1,e.setDebugMode=t,e.setVerboseMode=r},function(t,r){var n=r(26),i=r(29),o=r(28),a=r(27),l=r(23),s=r(1),u=r(2),p=r(30),c=r(32),f=function(){function t(){if(this._properties=new o.ScriptProperties,this._styles=new p.Map,this._dialogues=[],this._attachments=[],this._stylesFormatSpecifier=null,this._dialoguesFormatSpecifier=null,1===arguments.length)throw new Error("Constructor `new ASS(rawASS)` has been deprecated. Use `ASS.fromString(rawASS)` instead.");
this._styles.set("Default",new i.Style(new p.Map([["Name","Default"]])))}return Object.defineProperty(t.prototype,"properties",{get:function(){return this._properties},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"styles",{get:function(){return this._styles},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dialogues",{get:function(){return this._dialogues},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"attachments",{get:function(){return this._attachments},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stylesFormatSpecifier",{get:function(){return this._stylesFormatSpecifier},set:function(e){this._stylesFormatSpecifier=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dialoguesFormatSpecifier",{get:function(){return this._dialoguesFormatSpecifier},set:function(e){this._dialoguesFormatSpecifier=e},enumerable:!0,configurable:!0}),t.prototype.addStyle=function(e){var t=u.parseLineIntoTypedTemplate(e,this._stylesFormatSpecifier);if(null!==t&&"Style"===t.type){var r=t.template;if(l.verboseMode){var n="";r.forEach(function(e,t){return n+=t+" = "+e+", "})}var o=new i.Style(r);this._styles.set(o.name,o)}},t.prototype.addEvent=function(e){var t=u.parseLineIntoTypedTemplate(e,this._dialoguesFormatSpecifier);if(null!==t&&"Dialogue"===t.type){var r=t.template;if(l.verboseMode){var i="";r.forEach(function(e,t){return i+=t+" = "+e+", "})}this.dialogues.push(new n.Dialogue(r,this))}},t.prototype.addAttachment=function(e){this._attachments.push(e)},t.fromString=function(e,r){return void 0===r&&(r=a.Format.ASS),t.fromStream(new s.StringStream(e),r)},t.fromStream=function(e,t){switch(void 0===t&&(t=a.Format.ASS),t){case a.Format.ASS:return new s.StreamParser(e).ass;case a.Format.SRT:return new s.SrtStreamParser(e).ass;default:throw new Error("Illegal value of type: "+t)}},t.fromUrl=function(r,n){void 0===n&&(n=a.Format.ASS);var i;return i="function"==typeof e.fetch&&"function"==typeof e.ReadableStream&&"function"==typeof e.ReadableStream.prototype.getReader&&"function"==typeof e.TextDecoder?e.fetch(r).then(function(e){if(e.ok===!1||void 0===e.ok&&(e.status<200||e.status>299))throw new Error("HTTP request for "+r+" failed with status code "+e.status);return t.fromReadableStream(e.body,"utf-8",n)}):c.Promise.reject(new Error("Not supported.")),i.catch(function(e){var i=new XMLHttpRequest,o=t.fromStream(new s.XhrStream(i),n);return i.open("GET",r,!0),i.send(),o})},t.fromReadableStream=function(e,r,n){return void 0===r&&(r="utf-8"),void 0===n&&(n=a.Format.ASS),t.fromStream(new s.BrowserReadableStream(e,r),n)},t}();t.ASS=f},function(e){!function(e){e[e.Font=0]="Font",e[e.Graphic=1]="Graphic"}(e.AttachmentType||(e.AttachmentType={}));var t=function(){function e(e,t){this._filename=e,this._type=t,this._contents=""}return Object.defineProperty(e.prototype,"filename",{get:function(){return this._filename},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contents",{get:function(){return this._contents},set:function(e){this._contents=e},enumerable:!0,configurable:!0}),e}();e.Attachment=t},function(e,t){var r=t(27),n=t(3),i=t(8),o=t(23),a=t(30),l=function(){function e(t,n){this._parts=null,this._containsTransformTag=!1;var i=new a.Map;t.forEach(function(e,t){i.set(t.toLowerCase(),e)}),t=i,this._id=++e._lastDialogueId;var l=t.get("style");if(void 0!==l&&null!==l&&l.constructor===String&&(l=l.replace(/^\*+/,""),null!==l.match(/^Default$/i)&&(l="Default")),this._style=n.styles.get(l),void 0===this._style&&(o.debugMode,this._style=n.styles.get("Default")),void 0===this._style)throw new Error("Unrecognized style "+l);if(this._start=e._toTime(t.get("start")),this._end=e._toTime(t.get("end")),this._layer=Math.max(r.valueOrDefault(t,"layer",parseInt,function(e){return!isNaN(e)},"0"),0),this._rawPartsString=t.get("text"),void 0===this._rawPartsString||null===this._rawPartsString||this._rawPartsString.constructor!==String)throw new Error("Dialogue doesn't have any text.")}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"start",{get:function(){return this._start},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"end",{get:function(){return this._end},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alignment",{get:function(){return null===this._parts&&this._parsePartsString(),this._alignment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parts",{get:function(){return null===this._parts&&this._parsePartsString(),this._parts},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"containsTransformTag",{get:function(){return null===this._parts&&this._parsePartsString(),this._containsTransformTag},enumerable:!0,configurable:!0}),e.prototype.toString=function(){return"#"+this._id+" ["+this._start.toFixed(3)+"-"+this._end.toFixed(3)+"] "+(null!==this._parts?this._parts.join(", "):this._rawPartsString)},e.prototype._parsePartsString=function(){var e=this;if(this._parts=n.parse(this._rawPartsString,"dialogueParts"),this._alignment=this._style.alignment,this._parts.forEach(function(t,r){t instanceof i.Alignment?e._alignment=t.value:t instanceof i.Move?(null===t.t1||null===t.t2)&&(e._parts[r]=new i.Move(t.x1,t.y1,t.x2,t.y2,0,e._end-e._start)):t instanceof i.Transform&&((null===t.start||null===t.end||null===t.accel)&&(e._parts[r]=new i.Transform(null===t.start?0:t.start,null===t.end?e._end-e._start:t.end,null===t.accel?1:t.accel,t.tags)),e._containsTransformTag=!0)}),o.debugMode){var t=this._parts.filter(function(e){return e instanceof i.Comment&&-1!==e.value.indexOf("\\")});t.length>0}},e._toTime=function(e){return e.split(":").reduce(function(e,t){return 60*e+parseFloat(t)},0)},e._lastDialogueId=-1,e}();e.Dialogue=l},function(e){function t(e,t,r,n,i){var o=e.get(t);if(void 0===o)return r(i);try{var a=r(o);if(null!==n&&!n(a))throw new Error("Validation failed.");return a}catch(l){throw new Error("Property "+t+" has invalid value "+o+" - "+l.stack)}}!function(e){e[e.ASS=0]="ASS",e[e.SRT=1]="SRT"}(e.Format||(e.Format={})),function(e){e[e.SmartWrappingWithWiderTopLine=0]="SmartWrappingWithWiderTopLine",e[e.SmartWrappingWithWiderBottomLine=3]="SmartWrappingWithWiderBottomLine",e[e.EndOfLineWrapping=1]="EndOfLineWrapping",e[e.NoLineWrapping=2]="NoLineWrapping"}(e.WrappingStyle||(e.WrappingStyle={})),function(e){e[e.Outline=1]="Outline",e[e.OpaqueBox=3]="OpaqueBox"}(e.BorderStyle||(e.BorderStyle={})),e.valueOrDefault=t},function(e){var t=function(){function e(){}return Object.defineProperty(e.prototype,"resolutionX",{get:function(){return this._resolutionX},set:function(e){this._resolutionX=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolutionY",{get:function(){return this._resolutionY},set:function(e){this._resolutionY=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrappingStyle",{get:function(){return this._wrappingStyle},set:function(e){this._wrappingStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleBorderAndShadow",{get:function(){return this._scaleBorderAndShadow},set:function(e){this._scaleBorderAndShadow=e},enumerable:!0,configurable:!0}),e}();e.ScriptProperties=t},function(e,t){var r=t(27),n=t(3),i=t(30),o=function(){function e(e){var t=new i.Map;if(e.forEach(function(e,r){t.set(r.toLowerCase(),e)}),e=t,this._name=e.get("name"),void 0===this._name||null===this._name||this._name.constructor!==String)throw new Error("Style doesn't have a name.");this._name=this._name.replace(/^\*+/,""),this._italic=!!r.valueOrDefault(e,"italic",parseFloat,function(e){return!isNaN(e)},"0"),this._bold=!!r.valueOrDefault(e,"bold",parseFloat,function(e){return!isNaN(e)},"0"),this._underline=!!r.valueOrDefault(e,"underline",parseFloat,function(e){return!isNaN(e)},"0"),this._strikeThrough=!!r.valueOrDefault(e,"strikeout",parseFloat,function(e){return!isNaN(e)},"0"),this._fontName=r.valueOrDefault(e,"fontname",function(e){return e},function(e){return e.constructor===String},"sans-serif"),this._fontSize=r.valueOrDefault(e,"fontsize",parseFloat,function(e){return!isNaN(e)},"18"),this._fontScaleX=r.valueOrDefault(e,"scalex",parseFloat,function(e){return e>=0},"100")/100,this._fontScaleY=r.valueOrDefault(e,"scaley",parseFloat,function(e){return e>=0},"100")/100,this._letterSpacing=r.valueOrDefault(e,"spacing",parseFloat,function(e){return e>=0},"0"),this._rotationZ=r.valueOrDefault(e,"angle",parseFloat,function(e){return!isNaN(e)},"0"),this._primaryColor=r.valueOrDefault(e,"primarycolour",function(e){return n.parse(e,"colorWithAlpha")},null,"&H00FFFFFF"),this._secondaryColor=r.valueOrDefault(e,"secondarycolour",function(e){return n.parse(e,"colorWithAlpha")},null,"&H00FFFF00"),this._outlineColor=r.valueOrDefault(e,"outlinecolour",function(e){return n.parse(e,"colorWithAlpha")},null,"&H00000000"),this._shadowColor=r.valueOrDefault(e,"backcolour",function(e){return n.parse(e,"colorWithAlpha")},null,"&H80000000"),this._outlineThickness=r.valueOrDefault(e,"outline",parseFloat,function(e){return e>=0},"2"),this._borderStyle=r.valueOrDefault(e,"borderstyle",parseInt,function(e){return r.BorderStyle[r.BorderStyle[e]]===e},"1"),this._shadowDepth=r.valueOrDefault(e,"shadow",parseFloat,function(e){return e>=0},"3"),this._alignment=r.valueOrDefault(e,"alignment",parseInt,function(e){return e>=1&&9>=e},"2"),this._marginLeft=r.valueOrDefault(e,"marginl",parseFloat,function(e){return!isNaN(e)},"20"),this._marginRight=r.valueOrDefault(e,"marginr",parseFloat,function(e){return!isNaN(e)},"20"),this._marginVertical=r.valueOrDefault(e,"marginv",parseFloat,function(e){return!isNaN(e)},"20")}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"italic",{get:function(){return this._italic},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bold",{get:function(){return this._bold},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"underline",{get:function(){return this._underline},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strikeThrough",{get:function(){return this._strikeThrough},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontScaleX",{get:function(){return this._fontScaleX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontScaleY",{get:function(){return this._fontScaleY},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{get:function(){return this._rotationZ},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primaryColor",{get:function(){return this._primaryColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondaryColor",{get:function(){return this._secondaryColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineColor",{get:function(){return this._outlineColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){return this._shadowColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"outlineThickness",{get:function(){return this._outlineThickness},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borderStyle",{get:function(){return this._borderStyle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowDepth",{get:function(){return this._shadowDepth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alignment",{get:function(){return this._alignment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"marginLeft",{get:function(){return this._marginLeft},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"marginRight",{get:function(){return this._marginRight},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"marginVertical",{get:function(){return this._marginVertical},enumerable:!0,configurable:!0}),e}();e.Style=o},function(t){function r(e){t.Map=null!==e?e:n}t.Map=e.Map;var n=function(){function e(e){if(this.clear(),void 0!==e){if(!Array.isArray(e))throw new Error("Non-array iterables are not supported by the SimpleMap constructor.");for(var t=0;t<e.length;t++){var r=e[t];this.set(r[0],r[1])}}}return e.prototype.get=function(e){var t=this._keyToProperty(e);return null===t?void 0:this._values[t]},e.prototype.has=function(e){var t=this._keyToProperty(e);return null===t?!1:t in this._keys},e.prototype.set=function(e,t){var r=this._keyToProperty(e);if(null===r)throw new Error("This Map implementation only supports Number and String keys, or keys with an id property.");return r in this._keys||this._size++,this._keys[r]=e,this._values[r]=t,this},e.prototype.delete=function(e){var t=this._keyToProperty(e);if(null===t)return!1;var r=t in this._keys;return r&&(delete this._keys[t],delete this._values[t],this._size--),r},e.prototype.clear=function(){this._keys=Object.create(null),this._values=Object.create(null),this._size=0},e.prototype.forEach=function(e,t){for(var r=0,n=Object.keys(this._keys);r<n.length;r++){var i=n[r];e.call(t,this._values[i],this._keys[i],this)}},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype._keyToProperty=function(e){return"number"==typeof e?"#"+e:"string"==typeof e?"'"+e:void 0!==e.id?"!"+e.id:null},e}();(void 0===t.Map||"function"!=typeof t.Map.prototype.forEach||function(){try{return 2!==new t.Map([[1,"foo"],[2,"bar"]]).size}catch(e){return!0}}())&&(t.Map=n),t.setImplementation=r},function(e){function t(e,t){for(var r=0;r<t.length;r++)for(var n=t[r],i=0,o=Object.getOwnPropertyNames(n.prototype);i<o.length;i++){var a=o[i];e.prototype[a]=n.prototype[a]}}e.mixin=t},function(t){function r(e){t.Promise=null!==e?e:s}function n(e){return i(e,[])}function i(e,r){if(0===e.length)return t.Promise.reject(r);var n=e[0],o=e.slice(1);return n.catch(function(e){return i(o,r.concat(e))})}function o(e){return new t.Promise(function(r,n){return t.Promise.all(e.map(function(e){return e.then(r,function(e){return e})})).then(n)})}function a(e,t){return e.then(function(e){return t(),e},function(e){throw t(),e})}t.Promise=e.Promise;var l=function(){var t=e.MutationObserver||e.WebkitMutationObserver;if(void 0!==e.process&&"function"==typeof e.process.nextTick)return function(t){e.process.nextTick(t)};if(void 0!==t){var r=[],n=!1,i=document.createElement("div"),o=new t(function(){for(var e=r.splice(0,r.length),t=0;t<e.length;t++){var o=e[t];o()}n=!1,r.length>0&&(i.classList.toggle("foo"),n=!0)});return o.observe(i,{attributes:!0}),function(e){r.push(e),n||(i.classList.toggle("foo"),n=!0)}}return function(e){return setTimeout(e,0)}}(),s=function(){function e(e){if(this._state=u.PENDING,this._fulfillReactions=[],this._rejectReactions=[],this._fulfilledValue=null,this._rejectedReason=null,"function"!=typeof e)throw new TypeError('typeof executor !== "function"');var t=this._createResolvingFunctions(),r=t.resolve,n=t.reject;try{e(r,n)}catch(i){n(i)}}return e.prototype.then=function(e,t){var r=new p;"function"!=typeof e&&(e=function(e){return e}),"function"!=typeof t&&(t=function(e){throw e});var n={capabilities:r,handler:e},i={capabilities:r,handler:t};switch(this._state){case u.PENDING:this._fulfillReactions.push(n),this._rejectReactions.push(i);break;case u.FULFILLED:this._enqueueFulfilledReactionJob(n,this._fulfilledValue);break;case u.REJECTED:this._enqueueRejectedReactionJob(i,this._rejectedReason)}return r.promise},e.prototype.catch=function(e){return this.then(null,e)},e.resolve=function(r){return r instanceof e?r:new t.Promise(function(e){return e(r)})},e.reject=function(e){return new t.Promise(function(t,r){return r(e)})},e.all=function(e){return new t.Promise(function(r,n){var i=[],o=e.length;return 0===o?void r(i):void e.forEach(function(e,a){return t.Promise.resolve(e).then(function(e){i[a]=e,o--,0===o&&r(i)},n)})})},e.race=function(e){return new t.Promise(function(r,n){for(var i=0;i<e.length;i++){var o=e[i];t.Promise.resolve(o).then(r,n)}})},e.prototype._createResolvingFunctions=function(){var e=this,t=!1,r=function(r){if(!t){if(t=!0,r===e)return void e._reject(new TypeError("resolution === this"));if(null===r||"object"!=typeof r&&"function"!=typeof r)return void e._fulfill(r);try{var n=r.then}catch(i){return void e._reject(i)}return"function"!=typeof n?void e._fulfill(r):void l(function(){return e._resolveWithThenable(r,n)})}},n=function(r){t||(t=!0,e._reject(r))};return{resolve:r,reject:n}},e.prototype._resolveWithThenable=function(e,t){var r=this._createResolvingFunctions(),n=r.resolve,i=r.reject;try{t.call(e,n,i)}catch(o){i(o)}},e.prototype._fulfill=function(e){var t=this._fulfillReactions;this._fulfilledValue=e,this._fulfillReactions=void 0,this._rejectReactions=void 0,this._state=u.FULFILLED;for(var r=0;r<t.length;r++){var n=t[r];this._enqueueFulfilledReactionJob(n,e)}},e.prototype._reject=function(e){var t=this._rejectReactions;this._rejectedReason=e,this._fulfillReactions=void 0,this._rejectReactions=void 0,this._state=u.REJECTED;for(var r=0;r<t.length;r++){var n=t[r];this._enqueueRejectedReactionJob(n,e)}},e.prototype._enqueueFulfilledReactionJob=function(e,t){l(function(){var r,n=e.capabilities,i=n.resolve,o=n.reject,a=e.handler;try{r=a(t)}catch(l){return void o(l)}i(r)})},e.prototype._enqueueRejectedReactionJob=function(e,t){l(function(){var r,n=e.capabilities,i=n.resolve,o=n.reject,a=e.handler;try{r=a(t)}catch(l){return void o(l)}i(r)})},e}();void 0===t.Promise&&(t.Promise=s);var u;!function(e){e[e.PENDING=0]="PENDING",e[e.FULFILLED=1]="FULFILLED",e[e.REJECTED=2]="REJECTED"}(u||(u={})),t.setImplementation=r;var p=function(){function e(){var e=this;this._promise=new t.Promise(function(t,r){Object.defineProperties(e,{resolve:{value:t,enumerable:!0},reject:{value:r,enumerable:!0}})})}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),e}();t.DeferredPromise=p,t.first=n,t.any=o,t.lastly=a},function(t){function r(e){t.Set=null!==e?e:n}t.Set=e.Set;var n=function(){function e(e){if(this.clear(),void 0!==e){if(!Array.isArray(e))throw new Error("Non-array iterables are not supported by the SimpleSet constructor.");for(var t=0;t<e.length;t++){var r=e[t];this.add(r)}}}return e.prototype.add=function(e){var t=this._toProperty(e);if(null===t)throw new Error("This Set implementation only supports Number and String values.");return t in this._elements||this._size++,this._elements[t]=e,this},e.prototype.clear=function(){this._elements=Object.create(null),this._size=0},e.prototype.has=function(e){var t=this._toProperty(e);return null===t?!1:t in this._elements},e.prototype.forEach=function(e,t){for(var r=0,n=Object.keys(this._elements);r<n.length;r++){var i=n[r],o=this._elements[i];e.call(t,o,o,this)}},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),e.prototype._toProperty=function(e){return"number"==typeof e?"#"+e:"string"==typeof e?"'"+e:null},e}();(void 0===t.Set||"function"!=typeof t.Set.prototype.forEach||function(){try{return 2!==new t.Set([1,2]).size}catch(e){return!0}}())&&(t.Set=n),t.setImplementation=r},function(e){function t(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r}function r(e,t,r){return arguments.length<3?n(e.reverse(),t):void i(e.reverse(),t,r)}function n(e,t){for(var r=0;r<e.length;r++){var n=e[r];t=n(t)||t}return t}function i(e,t,r){for(var n=0;n<e.length;n++){var i=e[n];i(t,r)}}e.__extends=t,e.__decorate=r},function(e,t){var r=t(30),n=t(32),i=t(36),o=t(38),a=function(){function e(e){var t=this;this._comm=e,this._pendingRequests=new r.Map,this._comm.addEventListener("message",function(e){return t._onMessage(e.data)},!1)}return e.prototype.request=function(t,r){var i=new n.DeferredPromise,a=++e._lastRequestId;this._pendingRequests.set(a,i);var l={requestId:a,command:t,parameters:r};return this._comm.postMessage(o.serialize(l)),i.promise},e.prototype.cancelRequest=function(e){var t=this._pendingRequests.get(e);void 0!==t&&(this._pendingRequests.delete(e),t.reject(new Error("Cancelled.")))},e.prototype._respond=function(e){var t=e.requestId,r=e.error,n=e.result;r instanceof Error&&(r={message:r.message,stack:r.stack}),this._comm.postMessage(o.serialize({command:i.WorkerCommands.Response,requestId:t,error:r,result:n}))},e.prototype._onMessage=function(e){var t=this,r=o.deserialize(e);if(r.command===i.WorkerCommands.Response){var n=r,a=this._pendingRequests.get(n.requestId);void 0!==a&&(this._pendingRequests.delete(n.requestId),null===n.error?a.resolve(n.result):a.reject(n.error))}else{var l=r,s=l.requestId,u=o.getWorkerCommandHandler(l.command);if(void 0===u)return void this._respond({requestId:s,error:new Error("No handler registered for command "+l.command),result:null});u(l.parameters).then(function(e){return{requestId:s,error:null,result:e}},function(e){return{requestId:s,error:e,result:null}}).then(function(e){return t._respond(e)})}},e._lastRequestId=-1,e}();e.WorkerChannelImpl=a,o.registerWorkerCommand(i.WorkerCommands.Ping,function(){return new n.Promise(function(e){return e(null)})})},function(e){!function(e){e[e.Response=0]="Response",e[e.Parse=1]="Parse",e[e.Ping=2]="Ping"}(e.WorkerCommands||(e.WorkerCommands={}))},function(t,r){function n(e){return void 0===e&&(e=a.src),new i.WorkerChannelImpl(new Worker(e))}var i=r(35),o=r(36);t.WorkerCommands=o.WorkerCommands,t.supported="undefined"!=typeof Worker;var a="undefined"!=typeof document&&void 0!==document.currentScript?document.currentScript:null;t.createWorker=n,"undefined"!=typeof WorkerGlobalScope&&e instanceof WorkerGlobalScope&&new i.WorkerChannelImpl(e)},function(e,t){function r(e,t){s.set(e,t)}function n(e){return s.get(e)}function i(e){e._classTag=u.size,u.set(e._classTag,e)}function o(e){return JSON.stringify(e,function(e,t){return t&&void 0!==t._classTag&&(t._classTag=t._classTag),t})}function a(e){return JSON.parse(e,function(e,t){if(t&&void 0!==t._classTag){for(var r=Object.create(u.get(t._classTag)),n=0,i=Object.keys(t);n<i.length;n++){var o=i[n];"_classTag"!==o&&(r[o]=t[o])}t=r}return t})}var l=t(30),s=new l.Map,u=new l.Map;e.registerWorkerCommand=r,e.getWorkerCommandHandler=n,e.registerClassPrototype=i,e.serialize=o,e.deserialize=a}])});