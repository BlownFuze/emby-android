define(["jqmwidget"],function(){!function(e,t){var i={animation:{},transition:{}},o=document.createElement("a"),n=["","webkit-","moz-","o-"];e.each(["animation","transition"],function(s,r){var a=0===s?r+"-name":r;e.each(n,function(n,s){return o.style[e.camelCase(s+a)]!==t?(i[r].prefix=s,!1):void 0}),i[r].duration=e.camelCase(i[r].prefix+r+"-duration"),i[r].event=e.camelCase(i[r].prefix+r+"-end"),""===i[r].prefix&&(i[r].event=i[r].event.toLowerCase())}),e(o).remove(),e.fn.animationComplete=function(o,n,s){var r,a,l=this,c=function(){clearTimeout(r),o.apply(this,arguments)},p=n&&"animation"!==n?"transition":"animation";return s===t&&(e(this).context!==document&&(a=3e3*parseFloat(e(this).css(i[p].duration))),(0===a||a===t||isNaN(a))&&(a=e.fn.animationComplete.defaultDuration)),r=setTimeout(function(){e(l).off(i[p].event,c),o.apply(l)},a),e(this).one(i[p].event,c)},e.fn.animationComplete.defaultDuration=1e3}(jQuery),function(e,t){function i(e,t,i,o){var n=o;return n=t>e?i+(e-t)/2:Math.min(Math.max(i,o-t/2),i+e-t)}function o(e){return{x:e.scrollLeft(),y:e.scrollTop(),cx:e[0].innerWidth||e.width(),cy:e[0].innerHeight||e.height()}}e.extend(e.mobile,{browser:{}}),e.mobile.browser.oldIE=function(){var e=3,t=document.createElement("div"),i=t.all||[];do t.innerHTML="<!--[if gt IE "+ ++e+"]><br><![endif]-->";while(i[0]);return e>4?e:!e}(),e.widget("mobile.popup",{options:{wrapperClass:null,theme:null,overlayTheme:null,shadow:!0,corners:!0,transition:"none",positionTo:"origin",tolerance:null,closeLinkSelector:"a[data-rel='back']",closeLinkEvents:"click.popup",navigateEvents:"navigate.popup",closeEvents:"navigate.popup pagebeforechange.popup",dismissible:!0,enhanced:!1,history:!e.mobile.browser.oldIE},_handleDocumentVmousedown:function(t){this._isOpen&&e.contains(this._ui.container[0],t.target)&&this._ignoreResizeEvents()},_create:function(){var t=this.element,i=t.attr("id"),o=this.options;o.history=o.history&&e.mobile.ajaxEnabled&&e.mobile.hashListeningEnabled,this._on(this.document,{mousedown:"_handleDocumentVmousedown"}),e.extend(this,{_scrollTop:0,_page:t.parents("div[data-role='page']"),_ui:null,_fallbackTransition:"",_currentTransition:!1,_prerequisites:null,_isOpen:!1,_tolerance:null,_resizeData:null,_ignoreResizeTo:0,_orientationchangeInProgress:!1}),0===this._page.length&&(this._page=e("body")),o.enhanced?this._ui={container:t.parent(),screen:t.parent().prev(),placeholder:e(this.document[0].getElementById(i+"-placeholder"))}:(this._ui=this._enhance(t,i),this._applyTransition(o.transition)),this._setTolerance(o.tolerance)._ui.focusElement=this._ui.container,this._on(this._ui.screen,{click:"_eatEventAndClose"}),this._on(this.window,{orientationchange:e.proxy(this,"_handleWindowOrientationchange"),resize:e.proxy(this,"_handleWindowResize")}),this._on(this.document,{focusin:"_handleDocumentFocusIn"})},_delay:function(e,t){function i(){return("string"==typeof e?o[e]:e).apply(o,arguments)}var o=this;return setTimeout(i,t||0)},_enhance:function(t,i){var o=this.options,n=o.wrapperClass,s={screen:e("<div class='ui-screen-hidden ui-popup-screen "+this._themeClassFromOption("ui-overlay-",o.overlayTheme)+"'></div>"),placeholder:e("<div style='display: none;'><!-- placeholder --></div>"),container:e("<div class='ui-popup-container ui-popup-hidden ui-popup-truncate"+(n?" "+n:"")+"'></div>")},r=this.document[0].createDocumentFragment();return r.appendChild(s.screen[0]),r.appendChild(s.container[0]),i&&(s.screen.attr("id",i+"-screen"),s.container.attr("id",i+"-popup"),s.placeholder.attr("id",i+"-placeholder").html("<!-- placeholder for "+i+" -->")),this._page[0].appendChild(r),s.placeholder.insertAfter(t),t.detach().addClass("ui-popup "+this._themeClassFromOption("ui-body-",o.theme)+" "+(o.shadow?"ui-overlay-shadow ":"")+(o.corners?"ui-corner-all ":"")).appendTo(s.container),s},_eatEventAndClose:function(e){return e.preventDefault(),e.stopImmediatePropagation(),this.options.dismissible&&this.close(),!1},_resizeScreen:function(){var e=this._ui.screen,t=this._ui.container.outerHeight(!0),i=e.removeAttr("style").height(),o=this.document.height()-1;o>i?e.height(o):t>i&&e.height(t)},_expectResizeEvent:function(){var e=o(this.window);if(this._resizeData){if(e.x===this._resizeData.windowCoordinates.x&&e.y===this._resizeData.windowCoordinates.y&&e.cx===this._resizeData.windowCoordinates.cx&&e.cy===this._resizeData.windowCoordinates.cy)return!1;clearTimeout(this._resizeData.timeoutId)}return this._resizeData={timeoutId:this._delay("_resizeTimeout",200),windowCoordinates:e},!0},_resizeTimeout:function(){this._isOpen?this._expectResizeEvent()||(this._ui.container.hasClass("ui-popup-hidden")&&(this._ui.container.removeClass("ui-popup-hidden ui-popup-truncate"),this.reposition({positionTo:"window"}),this._ignoreResizeEvents()),this._resizeScreen(),this._resizeData=null,this._orientationchangeInProgress=!1):(this._resizeData=null,this._orientationchangeInProgress=!1)},_stopIgnoringResizeEvents:function(){this._ignoreResizeTo=0},_ignoreResizeEvents:function(){this._ignoreResizeTo&&clearTimeout(this._ignoreResizeTo),this._ignoreResizeTo=this._delay("_stopIgnoringResizeEvents",1e3)},_handleWindowResize:function(){this._isOpen&&0===this._ignoreResizeTo&&(!this._expectResizeEvent()&&!this._orientationchangeInProgress||this._ui.container.hasClass("ui-popup-hidden")||this._ui.container.addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style"))},_handleWindowOrientationchange:function(){!this._orientationchangeInProgress&&this._isOpen&&0===this._ignoreResizeTo&&(this._expectResizeEvent(),this._orientationchangeInProgress=!0)},_handleDocumentFocusIn:function(t){var i,o=t.target,n=this._ui;if(this._isOpen){if(o!==n.container[0]){if(i=e(o),!e.contains(n.container[0],o))return e(this.document[0].activeElement).one("focus",e.proxy(function(){this._safelyBlur(o)},this)),n.focusElement.focus(),t.preventDefault(),t.stopImmediatePropagation(),!1;n.focusElement[0]===n.container[0]&&(n.focusElement=i)}this._ignoreResizeEvents()}},_themeClassFromOption:function(e,t){return t?"none"===t?"":e+t:e+"inherit"},_applyTransition:function(t){return t&&(this._ui.container.removeClass(this._fallbackTransition),"none"!==t&&(this._fallbackTransition=e.mobile._maybeDegradeTransition(t),"none"===this._fallbackTransition&&(this._fallbackTransition=""),this._ui.container.addClass(this._fallbackTransition))),this},_setOptions:function(e){var i=this.options,o=this.element,n=this._ui.screen;return e.wrapperClass!==t&&this._ui.container.removeClass(i.wrapperClass).addClass(e.wrapperClass),e.theme!==t&&o.removeClass(this._themeClassFromOption("ui-body-",i.theme)).addClass(this._themeClassFromOption("ui-body-",e.theme)),e.overlayTheme!==t&&(n.removeClass(this._themeClassFromOption("ui-overlay-",i.overlayTheme)).addClass(this._themeClassFromOption("ui-overlay-",e.overlayTheme)),this._isOpen&&n.addClass("in")),e.shadow!==t&&o.toggleClass("ui-overlay-shadow",e.shadow),e.corners!==t&&o.toggleClass("ui-corner-all",e.corners),e.transition!==t&&(this._currentTransition||this._applyTransition(e.transition)),e.tolerance!==t&&this._setTolerance(e.tolerance),e.disabled!==t&&e.disabled&&this.close(),this._super(e)},_setTolerance:function(i){var o,n={t:30,r:15,b:30,l:15};if(i!==t)switch(o=String(i).split(","),e.each(o,function(e,t){o[e]=parseInt(t,10)}),o.length){case 1:isNaN(o[0])||(n.t=n.r=n.b=n.l=o[0]);break;case 2:isNaN(o[0])||(n.t=n.b=o[0]),isNaN(o[1])||(n.l=n.r=o[1]);break;case 4:isNaN(o[0])||(n.t=o[0]),isNaN(o[1])||(n.r=o[1]),isNaN(o[2])||(n.b=o[2]),isNaN(o[3])||(n.l=o[3])}return this._tolerance=n,this},_clampPopupWidth:function(e){var t,i=o(this.window),n={x:this._tolerance.l,y:i.y+this._tolerance.t,cx:i.cx-this._tolerance.l-this._tolerance.r,cy:i.cy-this._tolerance.t-this._tolerance.b};return e||this._ui.container.css("max-width",n.cx),t={cx:this._ui.container.outerWidth(!0),cy:this._ui.container.outerHeight(!0)},{rc:n,menuSize:t}},_calculateFinalLocation:function(e,t){var o,n=t.rc,s=t.menuSize;return o={left:i(n.cx,s.cx,n.x,e.x),top:i(n.cy,s.cy,n.y,e.y)},o.top=Math.max(0,o.top),o.top-=Math.min(o.top,Math.max(0,o.top+s.cy-this.document.height())),o},_placementCoords:function(e){return this._calculateFinalLocation(e,this._clampPopupWidth())},_createPrerequisites:function(t,i,o){var n,s=this;n={screen:e.Deferred(),container:e.Deferred()},n.screen.then(function(){n===s._prerequisites&&t()}),n.container.then(function(){n===s._prerequisites&&i()}),Promise.all([n.screen,n.container]).then(function(){n===s._prerequisites&&(s._prerequisites=null,o())}),s._prerequisites=n},_animate:function(t){return this._ui.screen.removeClass(t.classToRemove).addClass(t.screenClassToAdd),t.prerequisites.screen.resolve(),t.transition&&"none"!==t.transition&&(t.applyTransition&&this._applyTransition(t.transition),this._fallbackTransition)?void this._ui.container.addClass(t.containerClassToAdd).removeClass(t.classToRemove).animationComplete(e.proxy(t.prerequisites.container,"resolve")):(this._ui.container.removeClass(t.classToRemove),void t.prerequisites.container.resolve())},_desiredCoords:function(t){var i,n=null,s=o(this.window),r=t.x,a=t.y,l=t.positionTo;if(l&&"origin"!==l)if("window"===l)r=s.cx/2+s.x,a=s.cy/2+s.y;else{try{n=e(l)}catch(c){n=null}n&&(n.filter(":visible"),0===n.length&&(n=null))}return n&&(i=n.offset(),r=i.left+n.outerWidth()/2,a=i.top+n.outerHeight()/2),("number"!==e.type(r)||isNaN(r))&&(r=s.cx/2+s.x),("number"!==e.type(a)||isNaN(a))&&(a=s.cy/2+s.y),{x:r,y:a}},_reposition:function(e){e={x:e.x,y:e.y,positionTo:e.positionTo},this._trigger("beforeposition",t,e),this._ui.container.offset(this._placementCoords(this._desiredCoords(e)))},reposition:function(e){this._isOpen&&this._reposition(e)},_safelyBlur:function(t){t!==this.window[0]&&"body"!==t.nodeName.toLowerCase()&&e(t).blur()},_openPrerequisitesComplete:function(){var t=this.element.attr("id");this._ui.container.addClass("ui-popup-active"),this._isOpen=!0,this._resizeScreen(),e.contains(this._ui.container[0],this.document[0].activeElement)||this._safelyBlur(this.document[0].activeElement),this._ignoreResizeEvents(),t&&this.document.find("[aria-haspopup='true'][aria-owns='"+t+"']").attr("aria-expanded",!0),this._trigger("afteropen")},_open:function(t){var i=e.extend({},this.options,t),o=function(){var e=navigator.userAgent,t=e.match(/AppleWebKit\/([0-9\.]+)/),i=!!t&&t[1],o=e.match(/Android (\d+(?:\.\d+))/),n=!!o&&o[1],s=e.indexOf("Chrome")>-1;return null!==o&&"4.0"===n&&i&&i>534.13&&!s?!0:!1}();this._createPrerequisites(e.noop,e.noop,e.proxy(this,"_openPrerequisitesComplete")),this._currentTransition=i.transition,this._applyTransition(i.transition),this._ui.screen.removeClass("ui-screen-hidden"),this._ui.container.removeClass("ui-popup-truncate"),this._reposition(i),this._ui.container.removeClass("ui-popup-hidden"),this.options.overlayTheme&&o&&this.element.closest(".ui-page").addClass("ui-popup-open"),this._animate({additionalCondition:!0,transition:i.transition,classToRemove:"",screenClassToAdd:"in",containerClassToAdd:"in",applyTransition:!1,prerequisites:this._prerequisites})},_closePrerequisiteScreen:function(){this._ui.screen.removeClass("out").addClass("ui-screen-hidden")},_closePrerequisiteContainer:function(){this._ui.container.removeClass("reverse out").addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style")},_closePrerequisitesDone:function(){var i=this._ui.container,o=this.element.attr("id");e.mobile.popup.active=t,e(":focus",i[0]).add(i[0]).blur(),o&&this.document.find("[aria-haspopup='true'][aria-owns='"+o+"']").attr("aria-expanded",!1),this._trigger("afterclose")},_close:function(t){this._ui.container.removeClass("ui-popup-active"),this._page.removeClass("ui-popup-open"),this._isOpen=!1,this._createPrerequisites(e.proxy(this,"_closePrerequisiteScreen"),e.proxy(this,"_closePrerequisiteContainer"),e.proxy(this,"_closePrerequisitesDone")),this._animate({additionalCondition:this._ui.screen.hasClass("in"),transition:t?"none":this._currentTransition,classToRemove:"in",screenClassToAdd:"out",containerClassToAdd:"reverse out",applyTransition:!0,prerequisites:this._prerequisites})},_unenhance:function(){this.options.enhanced||(this._setOptions({theme:e.mobile.popup.prototype.options.theme}),this.element.detach().insertAfter(this._ui.placeholder).removeClass("ui-popup ui-overlay-shadow ui-corner-all ui-body-inherit"),this._ui.screen.remove(),this._ui.container.remove(),this._ui.placeholder.remove())},_destroy:function(){return e.mobile.popup.active===this?(this.element.one("popupafterclose",e.proxy(this,"_unenhance")),this.close()):this._unenhance(),this},_closePopup:function(t,i){var o,n,s=this.options,r=!1;t&&t.isDefaultPrevented()||e.mobile.popup.active!==this||(window.scrollTo(0,this._scrollTop),t&&"pagebeforechange"===t.type&&i&&(o="string"==typeof i.toPage?i.toPage:i.toPage.data("url"),o=e.mobile.path.parseUrl(o),n=o.pathname+o.search+o.hash,this._myUrl!==e.mobile.path.makeUrlAbsolute(n)?r=!0:t.preventDefault()),this.window.off(s.closeEvents),this.element.off(s.closeLinkEvents,s.closeLinkSelector),this._close(r))},_bindContainerClose:function(){this.window.on(this.options.closeEvents,e.proxy(this,"_closePopup"))},widget:function(){return this._ui.container},open:function(t){var i,o,n,s,r,a,l=this,c=this.options;return e.mobile.popup.active||c.disabled?this:(e.mobile.popup.active=this,this._scrollTop=this.window.scrollTop(),c.history?(a=e.mobile.navigate.history,o=e.mobile.dialogHashKey,n=e.mobile.activePage,s=n?n.hasClass("ui-dialog"):!1,this._myUrl=i=a.getActive().url,(r=i.indexOf(o)>-1&&!s&&a.activeIndex>0)?(l._open(t),l._bindContainerClose(),this):(-1!==i.indexOf(o)||s?i=e.mobile.path.parseLocation().hash+o:i+=i.indexOf("#")>-1?o:"#"+o,this.window.one("beforenavigate",function(e){e.preventDefault(),l._open(t),l._bindContainerClose()}),this.urlAltered=!0,e.mobile.navigate(i,{role:"dialog"}),this)):(l._open(t),l._bindContainerClose(),l.element.on(c.closeLinkEvents,c.closeLinkSelector,function(e){l.close(),e.preventDefault()}),this))},close:function(){return e.mobile.popup.active!==this?this:(this._scrollTop=this.window.scrollTop(),this.options.history&&this.urlAltered?(e.mobile.pageContainer.pagecontainer("back"),this.urlAltered=!1):this._closePopup(),this)}}),e.mobile.popup.handleLink=function(t){var i,o=e.mobile.path,n=e(o.hashToSelector(o.parseUrl(t.attr("href")).hash)).first();n.length>0&&n.data("mobile-popup")&&(i=t.offset(),n.popup("open",{x:i.left+t.outerWidth()/2,y:i.top+t.outerHeight()/2,transition:t.data("transition"),positionTo:t.data("position-to")})),setTimeout(function(){t.removeClass(e.mobile.activeBtnClass)},300)},e(document).on("pagebeforechange",function(t,i){"popup"===i.options.role&&(e.mobile.popup.handleLink(i.options.link),t.preventDefault())})}(jQuery),function(e,t){function i(){var e=n.clone(),t=e.eq(0),i=e.eq(1),o=i.children();return{arEls:i.add(t),gd:t,ct:i,ar:o}}var o=e.mobile.browser.oldIE&&e.mobile.browser.oldIE<=8,n=e("<div class='ui-popup-arrow-guide'></div><div class='ui-popup-arrow-container"+(o?" ie":"")+"'><div class='ui-popup-arrow'></div></div>");e.widget("mobile.popup",e.mobile.popup,{options:{arrow:""},_create:function(){var e,t=this._super();return this.options.arrow&&(this._ui.arrow=e=this._addArrow()),t},_addArrow:function(){var e,t=this.options,o=i();return e=this._themeClassFromOption("ui-body-",t.theme),o.ar.addClass(e+(t.shadow?" ui-overlay-shadow":"")),o.arEls.hide().appendTo(this.element),o},_unenhance:function(){var e=this._ui.arrow;return e&&e.arEls.remove(),this._super()},_tryAnArrow:function(e,t,i,o,n){var s,r,a,l={},c={};return o.arFull[e.dimKey]>o.guideDims[e.dimKey]?n:(l[e.fst]=i[e.fst]+(o.arHalf[e.oDimKey]+o.menuHalf[e.oDimKey])*e.offsetFactor-o.contentBox[e.fst]+(o.clampInfo.menuSize[e.oDimKey]-o.contentBox[e.oDimKey])*e.arrowOffsetFactor,l[e.snd]=i[e.snd],s=o.result||this._calculateFinalLocation(l,o.clampInfo),r={x:s.left,y:s.top},c[e.fst]=r[e.fst]+o.contentBox[e.fst]+e.tipOffset,c[e.snd]=Math.max(s[e.prop]+o.guideOffset[e.prop]+o.arHalf[e.dimKey],Math.min(s[e.prop]+o.guideOffset[e.prop]+o.guideDims[e.dimKey]-o.arHalf[e.dimKey],i[e.snd])),a=Math.abs(i.x-c.x)+Math.abs(i.y-c.y),(!n||a<n.diff)&&(c[e.snd]-=o.arHalf[e.dimKey]+s[e.prop]+o.contentBox[e.snd],n={dir:t,diff:a,result:s,posProp:e.prop,posVal:c[e.snd]}),n)},_getPlacementState:function(e){var t,i,o=this._ui.arrow,n={clampInfo:this._clampPopupWidth(!e),arFull:{cx:o.ct.width(),cy:o.ct.height()},guideDims:{cx:o.gd.width(),cy:o.gd.height()},guideOffset:o.gd.offset()};return t=this.element.offset(),o.gd.css({left:0,top:0,right:0,bottom:0}),i=o.gd.offset(),n.contentBox={x:i.left-t.left,y:i.top-t.top,cx:o.gd.width(),cy:o.gd.height()},o.gd.removeAttr("style"),n.guideOffset={left:n.guideOffset.left-t.left,top:n.guideOffset.top-t.top},n.arHalf={cx:n.arFull.cx/2,cy:n.arFull.cy/2},n.menuHalf={cx:n.clampInfo.menuSize.cx/2,cy:n.clampInfo.menuSize.cy/2},n},_placementCoords:function(t){var i,n,s,r,a,l=this.options.arrow,c=this._ui.arrow;return c?(c.arEls.show(),a={},i=this._getPlacementState(!0),s={l:{fst:"x",snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:1,tipOffset:-i.arHalf.cx,arrowOffsetFactor:0},r:{fst:"x",snd:"y",prop:"top",dimKey:"cy",oDimKey:"cx",offsetFactor:-1,tipOffset:i.arHalf.cx+i.contentBox.cx,arrowOffsetFactor:1},b:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:-1,tipOffset:i.arHalf.cy+i.contentBox.cy,arrowOffsetFactor:1},t:{fst:"y",snd:"x",prop:"left",dimKey:"cx",oDimKey:"cy",offsetFactor:1,tipOffset:-i.arHalf.cy,arrowOffsetFactor:0}},e.each((l===!0?"l,t,r,b":l).split(","),e.proxy(function(e,o){n=this._tryAnArrow(s[o],o,t,i,n)},this)),n?(c.ct.removeClass("ui-popup-arrow-l ui-popup-arrow-t ui-popup-arrow-r ui-popup-arrow-b").addClass("ui-popup-arrow-"+n.dir).removeAttr("style").css(n.posProp,n.posVal).show(),o||(r=this.element.offset(),a[s[n.dir].fst]=c.ct.offset(),a[s[n.dir].snd]={left:r.left+i.contentBox.x,top:r.top+i.contentBox.y}),n.result):(c.arEls.hide(),this._super(t))):this._super(t)},_setOptions:function(e){var i,o=this.options.theme,n=this._ui.arrow,s=this._super(e);if(e.arrow!==t){if(!n&&e.arrow)return void(this._ui.arrow=this._addArrow());n&&!e.arrow&&(n.arEls.remove(),this._ui.arrow=null)}return n=this._ui.arrow,n&&(e.theme!==t&&(o=this._themeClassFromOption("ui-body-",o),i=this._themeClassFromOption("ui-body-",e.theme),n.ar.removeClass(o).addClass(i)),e.shadow!==t&&n.ar.toggleClass("ui-overlay-shadow",e.shadow)),s},_destroy:function(){var e=this._ui.arrow;return e&&e.arEls.remove(),this._super()}})}(jQuery)});