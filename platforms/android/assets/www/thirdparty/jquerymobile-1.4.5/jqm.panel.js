define(["jqmwidget"],function(){!function(e,n){var i={animation:{},transition:{}},a=document.createElement("a"),t=["","webkit-","moz-","o-"];e.each(["animation","transition"],function(o,s){var l=0===o?s+"-name":s;e.each(t,function(t,o){return a.style[e.camelCase(o+l)]!==n?(i[s].prefix=o,!1):void 0}),i[s].duration=e.camelCase(i[s].prefix+s+"-duration"),i[s].event=e.camelCase(i[s].prefix+s+"-end"),""===i[s].prefix&&(i[s].event=i[s].event.toLowerCase())}),e(a).remove(),e.fn.animationComplete=function(a,t,o){var s,l,p=this,r=function(){clearTimeout(s),a.apply(this,arguments)},d=t&&"animation"!==t?"transition":"animation";return o===n&&(e(this).context!==document&&(l=3e3*parseFloat(e(this).css(i[d].duration))),(0===l||l===n||isNaN(l))&&(l=e.fn.animationComplete.defaultDuration)),s=setTimeout(function(){e(p).off(i[d].event,r),a.apply(p)},l),e(this).one(i[d].event,r)},e.fn.animationComplete.defaultDuration=1e3}(jQuery),function(e,n){e.widget("mobile.panel",{options:{animate:!0,theme:null,position:"left",dismissible:!0,display:"overlay",swipeClose:!0,positionFixed:!0},_parentPage:null,_page:null,_modal:null,_panelInner:null,_wrapper:null,_create:function(){var n=this.element,i=n.closest(".ui-page, [data-role='page']");e.extend(this,{_parentPage:i.length>0?i:!1,_openedPage:null,_page:this._getPage,_panelInner:this._getPanelInner()}),"overlay"!==this.options.display&&this._getWrapper(),this._addPanelClasses(),this.options.animate&&this.element.addClass("ui-panel-animate"),this._bindUpdateLayout(),this._bindCloseEvents(),this._bindLinkListeners(),this._bindPageEvents(),this.options.dismissible&&this._createModal(),this._bindSwipeEvents()},_getPanelInner:function(){var n=this.element[0].querySelector(".ui-panel-inner");return n=n?e(n):this.element.children().wrapAll("<div class='ui-panel-inner' />").parent()},_createModal:function(){var n=this,i=n._parentPage?n._parentPage.parent():n.element.parent();n._modal=e("<div class='ui-panel-dismiss'></div>").on("mousedown",function(){n.close()}).appendTo(i)},_getPage:function(){var n=this._openedPage||this._parentPage||e(".ui-page-active");return n},_getWrapper:function(){var e=this._page().find(".ui-panel-wrapper");0===e.length&&(e=this._page().children(".ui-header:not(.ui-header-fixed), .ui-content:not(.ui-popup), .ui-footer:not(.ui-footer-fixed)").wrapAll("<div class='ui-panel-wrapper'></div>").parent()),this._wrapper=e},_getPosDisplayClasses:function(e){return e+"-position-right "+e+"-display-"+this.options.display},_getPanelClasses:function(){var e="ui-panel "+this._getPosDisplayClasses("ui-panel")+" ui-panel-closed ui-body-"+(this.options.theme?this.options.theme:"inherit");return this.options.positionFixed&&(e+=" ui-panel-fixed"),e},_addPanelClasses:function(){this.element.addClass(this._getPanelClasses())},_handleCloseClick:function(e){e.isDefaultPrevented()||this.close()},_bindCloseEvents:function(){},_positionPanel:function(n){var i=this,a=i._panelInner.outerHeight(),t=a>(window.innerHeight||e(window).height());t||!i.options.positionFixed?(t&&i._unfixPanel(),n&&this.window[0].scrollTo(0,e.mobile.defaultHomeScroll)):i._fixPanel()},_bindFixListener:function(){this._on(e(window),{resize:"_positionPanel"})},_unbindFixListener:function(){this._off(e(window),"resize")},_unfixPanel:function(){this.options.positionFixed&&this.element.removeClass("ui-panel-fixed")},_fixPanel:function(){this.options.positionFixed&&this.element.addClass("ui-panel-fixed")},_bindUpdateLayout:function(){var e=this;e.element.on("updatelayout",function(){e._open&&e._positionPanel()})},_bindLinkListeners:function(){this._on("body",{"click a":"_handleClick"})},_handleClick:function(i){var a,t=this.element.attr("id");i.currentTarget.href.split("#")[1]===t&&t!==n&&(i.preventDefault(),a=e(i.target),a.hasClass("ui-btn")&&(a.addClass(e.mobile.activeBtnClass),this.element.one("panelopen panelclose",function(){a.removeClass(e.mobile.activeBtnClass)})),this.toggle())},_bindSwipeEvents:function(){var e=this,n=e._modal?e.element.add(e._modal):e.element;e.options.swipeClose&&("left"===e.options.position?n.on("swipeleft.panel",function(){e.close()}):n.on("swiperight.panel",function(){e.close()}))},_bindPageEvents:function(){var e=this;this.document.on("panelbeforeopen",function(n){e._open&&n.target!==e.element[0]&&e.close()}).on("keyup.panel",function(n){27===n.keyCode&&e._open&&e.close()}),this._parentPage||"overlay"===this.options.display||this._on(this.document,{pageshow:function(){this._openedPage=null,this._getWrapper()}}),e._parentPage?this.document.on("pagehide","[data-role='page']",function(){e._open&&e.close(!0)}):this.document.on("pagebeforehide",function(){e._open&&e.close(!0)})},_open:!1,_pageContentOpenClasses:null,_modalOpenClasses:null,open:function(e){if(!this._open){var n=this,i=n.options,a=function(){n._off(n.document,"panelclose"),n._page().data("panel","open"),i.animate&&"overlay"!==i.display&&n._wrapper.addClass("ui-panel-animate"),!e&&i.animate?(n._wrapper||n.element).animationComplete(t,"transition"):setTimeout(t,0),i.theme&&"overlay"!==i.display&&n._page().parent().addClass("ui-panel-page-container-themed ui-panel-page-container-"+i.theme),n.element.removeClass("ui-panel-closed").addClass("ui-panel-open"),n._positionPanel(!0),n._pageContentOpenClasses=n._getPosDisplayClasses("ui-panel-page-content"),"overlay"!==i.display&&(n._page().parent().addClass("ui-panel-page-container"),n._wrapper.addClass(n._pageContentOpenClasses)),n._modalOpenClasses=n._getPosDisplayClasses("ui-panel-dismiss")+" ui-panel-dismiss-open",n._modal&&n._modal.addClass(n._modalOpenClasses).height(Math.max(n._modal.height(),n.document.height()))},t=function(){n._open&&("overlay"!==i.display&&n._wrapper.addClass("ui-panel-page-content-open"),n._bindFixListener(),n._trigger("open"),n._openedPage=n._page())};n._trigger("beforeopen"),"open"===n._page().data("panel")?n._on(n.document,{panelclose:a}):a(),n._open=!0}},close:function(e){if(this._open){var n=this,i=this.options,a=function(){n.element.removeClass("ui-panel-open"),"overlay"!==i.display&&n._wrapper.removeClass(n._pageContentOpenClasses),!e&&i.animate?(n._wrapper||n.element).animationComplete(t,"transition"):setTimeout(t,0),n._modal&&n._modal.removeClass(n._modalOpenClasses).height("")},t=function(){i.theme&&"overlay"!==i.display&&n._page().parent().removeClass("ui-panel-page-container-themed ui-panel-page-container-"+i.theme),n.element.addClass("ui-panel-closed"),"overlay"!==i.display&&(n._page().parent().removeClass("ui-panel-page-container"),n._wrapper.removeClass("ui-panel-page-content-open")),i.animate&&"overlay"!==i.display&&n._wrapper.removeClass("ui-panel-animate"),n._fixPanel(),n._unbindFixListener(),n._page().removeData("panel"),n._trigger("close"),n._openedPage=null};n._trigger("beforeclose"),a(),n._open=!1}},toggle:function(){this[this._open?"close":"open"]()},_destroy:function(){var n,i=this.options,a=e("body > :mobile-panel").length+e.mobile.activePage.find(":mobile-panel").length>1;"overlay"!==i.display&&(n=e("body > :mobile-panel").add(e.mobile.activePage.find(":mobile-panel")),0===n.not(".ui-panel-display-overlay").not(this.element).length&&this._wrapper.children().unwrap(),this._open&&(this._page().parent().removeClass("ui-panel-page-container"),i.theme&&this._page().parent().removeClass("ui-panel-page-container-themed ui-panel-page-container-"+i.theme))),a||this.document.off("panelopen panelclose"),this._open&&this._page().removeData("panel"),this._panelInner.children().unwrap(),this.element.removeClass([this._getPanelClasses(),"ui-panel-open","ui-panel-animate"].join(" ")).off("swipeleft.panel swiperight.panel").off("panelbeforeopen").off("panelhide").off("keyup.panel").off("updatelayout"),this._modal&&this._modal.remove()}})}(jQuery)});