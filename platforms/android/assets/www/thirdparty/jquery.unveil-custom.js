define(["visibleinviewport"],function(e){function t(t){return e(t,!0,m,l)}function n(e){var t=e.getAttribute("data-src");t&&(ImageStore.setImageInto(e,t),e.setAttribute("data-src",""))}function r(e){for(var t=0,n=e.length;n>t;t++)e[t]=!0}function a(e){function a(r){for(var a=[],s=!1,u=!1,c=0,m=e.length;m>c;c++){if(i[r])return;var l=e[c];!u&&t(l)?(s=!0,n(l)):(s&&(u=!0),a.push(l))}e=a,e.length||(document.removeEventListener("focus",o,!0),document.removeEventListener("scroll",o,!0),document.removeEventListener(d,o,!0),window.removeEventListener("resize",o,!0))}function o(){r(i);var e=i.length;i.length++,setTimeout(function(){a(e)},1)}if(e.length){var i=[];document.addEventListener("scroll",o,!0),document.addEventListener("focus",o,!0),document.addEventListener(d,o,!0),window.addEventListener("resize",o,!0),o()}}function o(e){for(var t=0,n=e.length;n>t;t++){var r=e[0],a=r.getAttribute("data-src");a&&(ImageStore.setImageInto(r,a),r.setAttribute("data-src",""))}}function i(e){a(e.getElementsByClassName("lazy"),e)}function s(e,t){e.setAttribute("data-src",t),o([e])}function u(e,t){"IMG"!==e.tagName?e.style.backgroundImage="url('"+t+"')":e.setAttribute("src",t),browserInfo.animate&&!browserInfo.mobile&&(e.classList.contains("noFade")||c(e,1))}function c(e,t){var n=[{opacity:"0",offset:0},{opacity:"1",offset:1}],r={duration:200,iterations:t};return e.animate(n,r)}var d=document.implementation.hasFeature("Event.wheel","3.0")?"wheel":"mousewheel",m=screen.availWidth,l=screen.availHeight;window.ImageStore={setImageInto:u},window.ImageLoader={fillImages:o,lazyImage:s,lazyChildren:i}});