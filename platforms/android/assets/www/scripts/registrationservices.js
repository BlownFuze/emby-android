define(["appStorage","shell"],function(e,t){function a(t,a){Dashboard.getPluginSecurityInfo().then(function(i){if(i.IsMBSupporter)t();else{var r=parseInt(e.getItem(s)||"0");r?(new Date).getTime()-r>2592e5?n(t,a):t():(e.setItem(s,(new Date).getTime()),t())}})}function i(){var e=[];return e.push({name:Globalize.translate("CoverArt"),icon:"photo",text:Globalize.translate("CoverArtFeatureDescription")}),e.push({name:Globalize.translate("HeaderFreeApps"),icon:"check",text:Globalize.translate("FreeAppsFeatureDescription")}),e.push(Dashboard.capabilities().SupportsSync?{name:Globalize.translate("HeaderMobileSync"),icon:"sync",text:Globalize.translate("MobileSyncFeatureDescription")}:{name:Globalize.translate("HeaderCinemaMode"),icon:"movie",text:Globalize.translate("CinemaModeFeatureDescription")}),e}function r(e){var t="";return t+='<div class="listItem">',t+='<i class="listItemIcon md-icon">'+e.icon+"</i>",t+='<div class="listItemBody two-line">',t+='<a class="clearLink" href="https://emby.media/premiere" target="_blank">',t+='<h3 class="listItemBodyText">',t+=e.name,t+="</h3>",t+='<div class="listItemBodyText secondary" style="white-space:normal;">',t+=e.text,t+="</div>",t+="</a>",t+="</div>",t+="</div>"}function n(t){require(["dialogHelper","listViewStyle","emby-button"],function(a){var n=a.createDialog({size:"fullscreen-border",removeOnClose:!0});n.classList.add("ui-body-b"),n.classList.add("background-theme-b");var o="";o+='<h2 class="dialogHeader">',o+='<button is="emby-button" type="button" class="fab mini btnCancelSupporterInfo" tabindex="-1"><i class="md-icon">arrow_back</i></button>',o+="</h2>",o+='<div class="readOnlyContent" style="margin:0 auto 0;color:#fff;padding:0 1em 1em;">',o+="<h1>"+Globalize.translate("HeaderTryEmbyPremiere")+"</h1>",o+="<p>"+Globalize.translate("MessageDidYouKnowCinemaMode")+"</p>",o+="<p>"+Globalize.translate("MessageDidYouKnowCinemaMode2")+"</p>",o+="<br/>",o+="<h1>"+Globalize.translate("HeaderBenefitsEmbyPremiere")+"</h1>",o+='<div class="paperList">',o+=i().map(r).join(""),o+="</div>",o+="<br/>",o+='<a class="clearLink" href="http://emby.media/premiere" target="_blank"><button is="emby-button" type="button" class="raised submit block" autoFocus><i class="md-icon">check</i><span>'+Globalize.translate("ButtonBecomeSupporter")+"</span></button></a>",o+='<button is="emby-button" type="button" class="raised subdued block btnCancelSupporterInfo" style="background:#444;"><i class="md-icon">close</i><span>'+Globalize.translate("ButtonClosePlayVideo")+"</span></button>",o+="</div>",n.innerHTML=o,document.body.appendChild(n),n.addEventListener("close",function(){e.setItem(s,(new Date).getTime()),t()}),a.open(n);var l,c,p=function(){a.close(n)},u=n.querySelectorAll(".btnCancelSupporterInfo");for(l=0,c=u.length;c>l;l++)u[l].addEventListener("click",p)})}function o(e,t){Dashboard.getPluginSecurityInfo().then(function(a){return a.IsMBSupporter?void e():(Dashboard.showLoadingMsg(),void ApiClient.getRegistrationInfo("Sync").then(function(a){return Dashboard.hideLoadingMsg(),a.IsRegistered?void e():void Dashboard.alert({message:Globalize.translate("HeaderSyncRequiresSupporterMembership")+'<br/><p><a href="http://emby.media/premiere" target="_blank">'+Globalize.translate("ButtonLearnMore")+"</a></p>",title:Globalize.translate("HeaderSync"),callback:t})},function(){t(),Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("ErrorValidatingSupporterInfo")})}))})}var s="lastSupporterPlaybackMessage4";return window.RegistrationServices={renderPluginInfo:function(e,t,a){require(["jQuery"],function(i){if(t.isPremium){i(".premiumPackage",e).show();var r="";if(t.isRegistered)r+="<p style='color:green;'>",r+=Globalize.translate("MessageFeatureIncludedWithSupporter");else{var n=new Date(t.expDate).getTime(),o=(new Date).getTime();o>=n?(r+="<p style='color:red;'>",r+=Globalize.translate("MessageTrialExpired")):n>new Date(1970,1,1).getTime()&&(r+="<p style='color:blue;'>",r+=Globalize.translate("MessageTrialWillExpireIn").replace("{0}",Math.round(n-o)/864e5))}if(r+="</p>",i("#regStatus",e).html(r),a.IsMBSupporter)if(i("#regInfo",e).html(t.regInfo||""),i(".premiumDescription",e).hide(),i(".supporterDescription",e).hide(),t.price>0){i(".premiumHasPrice",e).show(),i("#featureId",e).val(t.featureId),i("#featureName",e).val(t.name),i("#amount",e).val(t.price),i("#regPrice",e).html("<h3>"+Globalize.translate("ValuePriceUSD").replace("{0}","$"+t.price.toFixed(2))+"</h3>"),i("#ppButton",e).hide();var s="https://mb3admin.com/admin/service/user/getPayPalEmail?id="+t.owner;fetch(s).then(function(e){return e.json()}).then(function(t){t.payPalEmail&&(i("#payPalEmail",e).val(t.payPalEmail),i("#ppButton",e).show())})}else i(".premiumHasPrice",e).hide();else t.price?(i(".premiumDescription",e).show(),i(".supporterDescription",e).hide(),i("#regInfo",e).html("")):(i(".premiumDescription",e).hide(),i(".supporterDescription",e).show(),i("#regInfo",e).html("")),i("#ppButton",e).hide()}else i(".premiumPackage",e).hide()})},validateFeature:function(e){return new Promise(function(t,i){"playback"==e?a(t,i):"livetv"==e?t():"sync"==e?o(t,i):t()})},showPremiereInfo:function(){t.openUrl("https://emby.media/premiere")}},window.RegistrationServices});