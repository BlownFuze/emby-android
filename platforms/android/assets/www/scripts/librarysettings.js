define(["jQuery"],function(e){function a(a,t){t.MergeMetadataAndImagesByName?e(".fldImagesByName",a).hide():e(".fldImagesByName",a).show(),e("#txtSeasonZeroName",a).val(t.SeasonZeroDisplayName),e("#selectEnableRealtimeMonitor",a).val(t.EnableLibraryMonitor),e("#chkSaveMetadataHidden",a).checked(t.SaveMetadataHidden),e("#txtMetadataPath",a).val(t.MetadataPath||""),e("#chkPeopleActors",a).checked(t.PeopleMetadataOptions.DownloadActorMetadata),e("#chkPeopleComposers",a).checked(t.PeopleMetadataOptions.DownloadComposerMetadata),e("#chkPeopleDirectors",a).checked(t.PeopleMetadataOptions.DownloadDirectorMetadata),e("#chkPeopleProducers",a).checked(t.PeopleMetadataOptions.DownloadProducerMetadata),e("#chkPeopleWriters",a).checked(t.PeopleMetadataOptions.DownloadWriterMetadata),e("#chkPeopleOthers",a).checked(t.PeopleMetadataOptions.DownloadOtherPeopleMetadata),e("#chkPeopleGuestStars",a).checked(t.PeopleMetadataOptions.DownloadGuestStarMetadata),Dashboard.hideLoadingMsg()}function t(a,t){e("#selectDateAdded",a).val(t.UseFileCreationTimeForDateAdded?"1":"0")}function o(a,t){e("#txtFanartApiKey",a).val(t.UserApiKey||"")}function n(a,t){e("#chkChaptersMovies",a).checked(t.EnableMovieChapterImageExtraction),e("#chkChaptersEpisodes",a).checked(t.EnableEpisodeChapterImageExtraction),e("#chkChaptersOtherVideos",a).checked(t.EnableOtherVideoChapterImageExtraction),e("#chkExtractChaptersDuringLibraryScan",a).checked(t.ExtractDuringLibraryScan),Dashboard.hideLoadingMsg()}function r(a){ApiClient.getNamedConfiguration("fanart").then(function(t){t.UserApiKey=e("#txtFanartApiKey",a).val(),ApiClient.updateNamedConfiguration("fanart",t)})}function i(a){ApiClient.getNamedConfiguration("metadata").then(function(t){t.UseFileCreationTimeForDateAdded="1"==e("#selectDateAdded",a).val(),ApiClient.updateNamedConfiguration("metadata",t)})}function d(a){ApiClient.getNamedConfiguration("chapters").then(function(t){t.EnableMovieChapterImageExtraction=e("#chkChaptersMovies",a).checked(),t.EnableEpisodeChapterImageExtraction=e("#chkChaptersEpisodes",a).checked(),t.EnableOtherVideoChapterImageExtraction=e("#chkChaptersOtherVideos",a).checked(),t.ExtractDuringLibraryScan=e("#chkExtractChaptersDuringLibraryScan",a).checked(),ApiClient.updateNamedConfiguration("chapters",t)})}function c(){Dashboard.showLoadingMsg();var a=this;return ApiClient.getServerConfiguration().then(function(t){t.SeasonZeroDisplayName=e("#txtSeasonZeroName",a).val(),t.EnableLibraryMonitor=e("#selectEnableRealtimeMonitor",a).val(),t.SaveMetadataHidden=e("#chkSaveMetadataHidden",a).checked(),t.EnableTvDbUpdates=e("#chkEnableTvdbUpdates",a).checked(),t.EnableTmdbUpdates=e("#chkEnableTmdbUpdates",a).checked(),t.EnableFanArtUpdates=e("#chkEnableFanartUpdates",a).checked(),t.MetadataPath=e("#txtMetadataPath",a).val(),t.FanartApiKey=e("#txtFanartApiKey",a).val(),t.PeopleMetadataOptions.DownloadActorMetadata=e("#chkPeopleActors",a).checked(),t.PeopleMetadataOptions.DownloadComposerMetadata=e("#chkPeopleComposers",a).checked(),t.PeopleMetadataOptions.DownloadDirectorMetadata=e("#chkPeopleDirectors",a).checked(),t.PeopleMetadataOptions.DownloadGuestStarMetadata=e("#chkPeopleGuestStars",a).checked(),t.PeopleMetadataOptions.DownloadProducerMetadata=e("#chkPeopleProducers",a).checked(),t.PeopleMetadataOptions.DownloadWriterMetadata=e("#chkPeopleWriters",a).checked(),t.PeopleMetadataOptions.DownloadOtherPeopleMetadata=e("#chkPeopleOthers",a).checked(),ApiClient.updateServerConfiguration(t).then(Dashboard.processServerConfigurationUpdateResult)}),d(a),i(a),r(a),!1}function l(){return[{href:"library.html",name:Globalize.translate("TabFolders")},{href:"librarydisplay.html",name:Globalize.translate("TabDisplay")},{href:"librarypathmapping.html",name:Globalize.translate("TabPathSubstitution")},{href:"librarysettings.html",name:Globalize.translate("TabAdvanced")}]}return function(r){e("#btnSelectMetadataPath",r).on("click.selectDirectory",function(){require(["directorybrowser"],function(a){var t=new a;t.show({callback:function(a){a&&e("#txtMetadataPath",r).val(a),t.close()},header:Globalize.translate("HeaderSelectMetadataPath"),instruction:Globalize.translate("HeaderSelectMetadataPathHelp")})})}),e(".librarySettingsForm").off("submit",c).on("submit",c),ApiClient.getSystemInfo().then(function(e){e.SupportsLibraryMonitor?r.querySelector(".fldLibraryMonitor").classList.remove("hide"):r.querySelector(".fldLibraryMonitor").classList.add("hide")}),r.addEventListener("viewshow",function(){LibraryMenu.setTabs("librarysetup",3,l),Dashboard.showLoadingMsg();var e=this;ApiClient.getServerConfiguration().then(function(t){a(e,t)}),ApiClient.getNamedConfiguration("metadata").then(function(a){t(e,a)}),ApiClient.getNamedConfiguration("fanart").then(function(a){o(e,a)});var r=ApiClient.getNamedConfiguration("chapters"),i=ApiClient.getJSON(ApiClient.getUrl("Providers/Chapters"));Promise.all([r,i]).then(function(a){n(e,a[0],a[1])})})}});