define(["ironCardList","scrollThreshold","events","libraryBrowser","jQuery"],function(e,t,r,a,n){return function(o,i,s){function l(e){var t=d(e),r=g[t];return r||(r=g[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Series",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:v},view:a.getSavedView(t)||a.getDefaultItemsView("Poster","Poster")},r.query.ParentId=i.topParentId,a.loadSavedQueryValues(t,r.query)),r}function u(e){return l(e).query}function d(e){return e.savedQueryKey||(e.savedQueryKey=a.getSavedQueryKey("series")),e.savedQueryKey}function c(e){var t,r=p.getCurrentViewStyle();"Thumb"==r?t={items:e.Items,shape:"backdrop",preferThumb:!0,context:"tv",lazy:!0,overlayPlayButton:!0}:"ThumbCard"==r?t={items:e.Items,shape:"backdrop",preferThumb:!0,context:"tv",lazy:!0,cardLayout:!0,showTitle:!0,showSeriesYear:!0}:"Banner"==r?t={items:e.Items,shape:"banner",preferBanner:!0,context:"tv",lazy:!0}:"List"==r?html=a.getListViewHtml({items:e.Items,context:"tv",sortBy:query.SortBy}):t="PosterCard"==r?{items:e.Items,shape:"portrait",context:"tv",showTitle:!0,showYear:!0,lazy:!0,cardLayout:!0}:{items:e.Items,shape:"portrait",context:"tv",centerText:!0,lazy:!0,overlayPlayButton:!0},p.cardOptions=t}function m(e){p.isLoading=!0,Dashboard.showLoadingMsg();var t=u(e),r=t.StartIndex,n=!p.cardOptions||0==r;ApiClient.getItems(Dashboard.getCurrentUserId(),t).then(function(o){h(e);var i=!0;n&&(c(o),i=!1),a.setPosterViewData(p.cardOptions),a.setPosterViewDataOnItems(p.cardOptions,o.Items);var s=e.querySelector("#ironList");if(i)for(var l=0,u=o.Items.length;u>l;l++)s.push("items",o.Items[l]);else s.items=o.Items;setTimeout(function(){s.notifyResize(),p.scrollThreshold.resetSize()},300),a.saveQueryValues(d(e),t),Dashboard.hideLoadingMsg(),p.hasMoreItems=o.TotalRecordCount>r+o.Items.length,p.isLoading=!1})}function h(e){var t=u(e);n(".alphabetPicker",e).alphaValue(t.NameStartsWith)}function y(e){n(".alphabetPicker",e).on("alphaselect",function(t,r){var a=u(e);a.NameStartsWithOrGreater=r,a.StartIndex=0,m(e)}).on("alphaclear",function(){var t=u(e);t.NameStartsWithOrGreater="",u(e).StartIndex=0,m(e)}),e.querySelector(".btnFilter").addEventListener("click",function(){p.showFilterMenu()}),e.querySelector(".btnSort").addEventListener("click",function(t){a.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionImdbRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName"},{name:Globalize.translate("OptionMetascore"),id:"Metascore,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName"}],callback:function(){u(e).StartIndex=0,m(e)},query:u(e),button:t.target})}),e.querySelector(".btnSelectView").addEventListener("click",function(e){a.showLayoutMenu(e.target,p.getCurrentViewStyle(),"Banner,List,Poster,PosterCard,Thumb,ThumbCard".split(","))}),e.querySelector(".btnSelectView").addEventListener("layoutchange",function(t){var r=t.detail.viewStyle;l(e).view=r,a.saveViewSetting(d(e),r),u(e).StartIndex=0,m(e)})}function S(){return p.listCreated?Promise.resolve():e.getTemplate("seriesTab").then(function(e){return s.querySelector(".itemsContainer").innerHTML=e,p.listCreated=!0,new Promise(function(e){setTimeout(e,2e3)})})}function f(){!p.isLoading&&p.hasMoreItems&&(u(s).StartIndex+=v,m(s))}var p=this,v=a.getDefaultPageSize(),g={};p.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],function(e){var t=new e({query:u(s),mode:"series"});Events.on(t,"filterchange",function(){u(s).StartIndex=0,m(s)}),t.show()})},p.getCurrentViewStyle=function(){return l(s).view},y(s),p.scrollThreshold=new t(s,!1),r.on(p.scrollThreshold,"lower-threshold",f),p.renderTab=function(){S().then(function(){m(s),h(s)})},p.destroy=function(){r.off(p.scrollThreshold,"lower-threshold",f),p.scrollThreshold&&p.scrollThreshold.destroy()}}});