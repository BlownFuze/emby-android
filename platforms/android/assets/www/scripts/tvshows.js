define(["events","libraryBrowser","imageLoader","jQuery","alphaPicker"],function(e,t,a,r,n){return function(e,i,o){function l(e){var a=u(e),r=g[a];return r||(r=g[a]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Series",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:S},view:t.getSavedView(a)||t.getDefaultItemsView("Poster","Poster")},r.query.ParentId=i.topParentId,t.loadSavedQueryValues(a,r.query)),r}function s(e){return l(e).query}function u(e){return e.savedQueryKey||(e.savedQueryKey=t.getSavedQueryKey("series")),e.savedQueryKey}function d(e){Dashboard.showLoadingMsg();var n=s(e);ApiClient.getItems(Dashboard.getCurrentUserId(),n).then(function(i){window.scrollTo(0,0),c(e);var l,s=LibraryBrowser.getQueryPagingHtml({startIndex:n.StartIndex,limit:n.Limit,totalRecordCount:i.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),m=y.getCurrentViewStyle();l="Thumb"==m?t.getPosterViewHtml({items:i.Items,shape:"backdrop",preferThumb:!0,context:"tv",lazy:!0,overlayPlayButton:!0}):"ThumbCard"==m?t.getPosterViewHtml({items:i.Items,shape:"backdrop",preferThumb:!0,context:"tv",lazy:!0,cardLayout:!0,showTitle:!0,showSeriesYear:!0}):"Banner"==m?t.getPosterViewHtml({items:i.Items,shape:"banner",preferBanner:!0,context:"tv",lazy:!0}):"List"==m?t.getListViewHtml({items:i.Items,context:"tv",sortBy:n.SortBy}):t.getPosterViewHtml("PosterCard"==m?{items:i.Items,shape:"portrait",context:"tv",showTitle:!0,showYear:!0,lazy:!0,cardLayout:!0}:{items:i.Items,shape:"portrait",context:"tv",centerText:!0,lazy:!0,overlayPlayButton:!0});var S,g,v=o.querySelectorAll(".paging");for(S=0,g=v.length;g>S;S++)v[S].innerHTML=s;r(".btnNextPage",o).on("click",function(){n.StartIndex+=n.Limit,d(o)}),r(".btnPreviousPage",o).on("click",function(){n.StartIndex-=n.Limit,d(o)});var h=o.querySelector(".itemsContainer");h.innerHTML=l,a.lazyChildren(h),t.saveQueryValues(u(e),n),Dashboard.hideLoadingMsg()})}function c(e){var t=s(e);y.alphaPicker.value(t.NameStartsWithOrGreater)}function m(e){var a=e.querySelector(".alphaPicker");a.addEventListener("alphavaluechanged",function(t){var a=t.detail.value,r=s(e);r.NameStartsWithOrGreater=a,r.StartIndex=0,d(e)}),y.alphaPicker=new n({element:a,valueChangeEvent:"click"}),e.querySelector(".btnFilter").addEventListener("click",function(){y.showFilterMenu()}),e.querySelector(".btnSort").addEventListener("click",function(a){t.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionImdbRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName"},{name:Globalize.translate("OptionMetascore"),id:"Metascore,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName"}],callback:function(){s(e).StartIndex=0,d(e)},query:s(e),button:a.target})}),e.querySelector(".btnSelectView").addEventListener("click",function(e){t.showLayoutMenu(e.target,y.getCurrentViewStyle(),"Banner,List,Poster,PosterCard,Thumb,ThumbCard".split(","))}),e.querySelector(".btnSelectView").addEventListener("layoutchange",function(a){var r=a.detail.viewStyle;l(e).view=r,t.saveViewSetting(u(e),r),s(e).StartIndex=0,d(e)})}var y=this,S=t.getDefaultPageSize(),g={};y.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],function(e){var t=new e({query:s(o),mode:"series"});Events.on(t,"filterchange",function(){s(o).StartIndex=0,d(o)}),t.show()})},y.getCurrentViewStyle=function(){return l(o).view},m(o),y.renderTab=function(){d(o),c(o)},y.destroy=function(){}}});