define(["jQuery"],function(e){function a(){require(["alert"],function(e){e({title:Globalize.translate("HeaderChangeFolderType"),text:Globalize.translate("HeaderChangeFolderTypeHelp")})})}function t(e){require(["medialibrarycreator"],function(a){(new a).show({collectionTypeOptions:u(),refresh:l(e)}).then(function(a){a&&s(e)})})}function i(e,a){require(["medialibraryeditor"],function(t){(new t).show({refresh:l(e),library:a}).then(function(a){a&&s(e)})})}function n(e,a){var t=Globalize.translate("MessageAreYouSureYouWishToRemoveMediaFolder");a.Locations.length&&(t+="<br/><br/>"+Globalize.translate("MessageTheFollowingLocationWillBeRemovedFromLibrary")+"<br/><br/>",t+=a.Locations.join("<br/>")),require(["confirm"],function(i){i(t,Globalize.translate("HeaderRemoveMediaFolder")).then(function(){var t=l(e);ApiClient.removeVirtualFolder(a.Name,t).then(function(){s(e)})})})}function o(e,a){require(["prompt"],function(t){t({label:Globalize.translate("LabelNewName")}).then(function(t){if(t&&t!=a.Name){var i=l(e);ApiClient.renameVirtualFolder(a.Name,t,i).then(function(){s(e)})}})})}function r(t,r,s){var l=e(r).parents(".card")[0],c=parseInt(l.getAttribute("data-index")),u=s[c],m=[];m.push({name:Globalize.translate("ButtonChangeContentType"),id:"changetype",ironIcon:"videocam"}),m.push({name:Globalize.translate("ButtonEditImages"),id:"editimages",ironIcon:"photo"}),m.push({name:Globalize.translate("ButtonManageFolders"),id:"edit",ironIcon:"folder-open"}),m.push({name:Globalize.translate("ButtonRemove"),id:"delete",ironIcon:"remove"}),m.push({name:Globalize.translate("ButtonRename"),id:"rename",ironIcon:"mode-edit"}),require(["actionsheet"],function(e){e.show({items:m,positionTo:r,callback:function(e){switch(e){case"changetype":a(t,u);break;case"edit":i(t,u);break;case"editimages":d(t,u);break;case"rename":o(t,u);break;case"delete":n(t,u)}}})})}function s(e){Dashboard.showLoadingMsg(),ApiClient.getVirtualFolders().then(function(a){c(e,a)})}function l(a){return e(a).is("#mediaLibraryPage")}function c(a,n){var o="";n.push({Name:Globalize.translate("ButtonAddMediaLibrary"),icon:"add-circle",Locations:[],showType:!1,showLocations:!1,showMenu:!1,showNameWithIcon:!0});for(var s=0,l=n.length;l>s;s++){var c=n[s];o+=h(a,c,s)}var d=a.querySelector("#divVirtualFolders");d.innerHTML=o,e(".btnCardMenu",d).on("click",function(){r(a,this,n)}),e(".addLibrary",d).on("click",function(){t(a)}),e(".editLibrary",d).on("click",function(){var t=e(this).parents(".card")[0],o=parseInt(t.getAttribute("data-index")),r=n[o];r.ItemId&&i(a,r)}),Dashboard.hideLoadingMsg()}function d(e,a){require(["components/imageeditor/imageeditor"],function(t){t.show(a.ItemId,{theme:"a"}).then(function(a){a&&s(e)})})}function u(){return[{name:"",value:""},{name:Globalize.translate("FolderTypeMovies"),value:"movies"},{name:Globalize.translate("FolderTypeMusic"),value:"music"},{name:Globalize.translate("FolderTypeTvShows"),value:"tvshows"},{name:Globalize.translate("FolderTypeBooks"),value:"books",message:Globalize.translate("MessageBookPluginRequired")},{name:Globalize.translate("FolderTypeGames"),value:"games",message:Globalize.translate("MessageGamePluginRequired")},{name:Globalize.translate("FolderTypeHomeVideos"),value:"homevideos"},{name:Globalize.translate("FolderTypeMusicVideos"),value:"musicvideos"},{name:Globalize.translate("FolderTypePhotos"),value:"photos"},{name:Globalize.translate("FolderTypeUnset"),value:"mixed",message:Globalize.translate("MessageUnsetContentHelp")}]}function m(e){switch(e){case"movies":return"local-movies";case"music":return"library-music";case"photos":return"photo";case"livetv":return"live-tv";case"tvshows":return"live-tv";case"games":return"folder";case"trailers":return"local-movies";case"homevideos":return"video-library";case"musicvideos":return"video-library";case"books":return"folder";case"channels":return"folder";case"playlists":return"folder";default:return"folder"}}function h(e,a,t){var i="",n="";e.classList.contains("wizardPage")&&(n+="min-width:33.3%;"),i+='<div class="card backdropCard" style="'+n+'" data-index="'+t+'">',i+='<div class="cardBox visualCardBox">',i+='<div class="cardScalable">',i+='<div class="cardPadder"></div>',i+='<div class="cardContent">';var o="";a.PrimaryImageItemId&&(o=ApiClient.getScaledImageUrl(a.PrimaryImageItemId,{type:"Primary"})),o?i+='<div class="cardImage editLibrary" style="cursor:pointer;background-image:url(\''+o+"');\"></div>":a.showNameWithIcon||(i+='<div class="cardImage editLibrary iconCardImage" style="cursor:pointer;">',i+='<iron-icon icon="'+(a.icon||m(a.CollectionType))+'"></iron-icon>',i+="</div>"),i+="</div>",i+="</div>",!o&&a.showNameWithIcon&&(i+='<h1 class="cardImage iconCardImage addLibrary" style="position:absolute;top:0;left:0;right:0;bottom:0;cursor:pointer;">',i+="<div>",i+='<iron-icon icon="'+(a.icon||m(a.CollectionType))+'" style="width:45%;height:45%;color:#888;"></iron-icon>',a.showNameWithIcon&&(i+='<div style="margin:1.5em 0;position:width:100%;font-weight:500;color:#444;">',i+=a.Name,i+="</div>"),i+="</div>",i+="</h1>"),i+='<div class="cardFooter">',a.showMenu!==!1&&(i+='<div class="cardText" style="text-align:right; float:right;padding-top:5px;">',i+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="btnCardMenu"></paper-icon-button>',i+="</div>"),i+="<div class='cardText'>",i+=a.showNameWithIcon?"&nbsp;":a.Name,i+="</div>";var r=u().filter(function(e){return e.value==a.CollectionType})[0];return r=r?r.name:Globalize.translate("FolderTypeUnset"),i+="<div class='cardText'>",i+=a.showType===!1?"&nbsp;":r,i+="</div>",a.showLocations===!1?(i+="<div class='cardText'>",i+="&nbsp;",i+="</div>"):a.Locations.length?1==a.Locations.length?(i+="<div class='cardText'>",i+=a.Locations[0],i+="</div>"):(i+="<div class='cardText'>",i+=Globalize.translate("NumLocationsValue",a.Locations.length),i+="</div>"):(i+="<div class='cardText' style='color:#cc3333;'>",i+=Globalize.translate("NumLocationsValue",a.Locations.length),i+="</div>"),i+="</div>",i+="</div>",i+="</div>"}function v(){return[{href:"library.html",name:Globalize.translate("TabFolders")},{href:"librarypathmapping.html",name:Globalize.translate("TabPathSubstitution")},{href:"librarysettings.html",name:Globalize.translate("TabAdvanced")}]}pageClassOn("pageinit","mediaLibraryPage",function(){var a=this;e("#selectCollectionType",a).on("change",function(){var t=this.selectedIndex;if(-1!=t){var i=this.options[t].innerHTML.replace("*","").replace("&amp;","&"),n=this.value;e("#txtValue",a).val(i);var o=u().filter(function(e){return e.value==n})[0];e(".collectionTypeFieldDescription",a).html(o.message||"")}})}),window.WizardLibraryPage={next:function(){Dashboard.showLoadingMsg();var e=ApiClient;e.ajax({type:"POST",url:e.getUrl("System/Configuration/MetadataPlugins/Autoset")}).then(function(){Dashboard.hideLoadingMsg(),Dashboard.navigate("wizardsettings.html")})}},pageClassOn("pageshow","mediaLibraryPage",function(){var e=this;s(e)}),pageIdOn("pageshow","mediaLibraryPage",function(){LibraryMenu.setTabs("librarysetup",0,v);var a=this;e(".btnRefresh",a).taskButton({mode:"on",progressElem:a.querySelector(".refreshProgress"),taskKey:"RefreshLibrary"})}),pageIdOn("pagebeforehide","mediaLibraryPage",function(){var a=this;e(".btnRefresh",a).taskButton({mode:"off"})})});