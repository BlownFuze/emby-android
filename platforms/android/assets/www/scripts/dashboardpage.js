define(["datetime"],function(e){window.DashboardPage={newsStartIndex:0,onPageShow:function(){var e=this,a=ApiClient;a&&(Dashboard.lastSystemInfo&&(e.querySelector(".serverNameHeader").innerHTML=Dashboard.lastSystemInfo.ServerName),DashboardPage.newsStartIndex=0,Dashboard.showLoadingMsg(),DashboardPage.pollForInfo(e),DashboardPage.startInterval(a),Events.on(a,"websocketmessage",DashboardPage.onWebSocketMessage),Events.on(a,"websocketopen",DashboardPage.onWebSocketOpen),DashboardPage.lastAppUpdateCheck=null,DashboardPage.lastPluginUpdateCheck=null,Dashboard.getPluginSecurityInfo().then(function(a){DashboardPage.renderSupporterIcon(e,a)}),DashboardPage.reloadSystemInfo(e),DashboardPage.reloadNews(e),DashboardPage.sessionUpdateTimer=setInterval(DashboardPage.refreshSessionsLocally,6e4),$(".activityItems",e).activityLogList(),$(".swaggerLink",e).attr("href",a.getUrl("swagger-ui/index.html",{api_key:ApiClient.accessToken()})))},onPageHide:function(){var e=this;$(".activityItems",e).activityLogList("destroy");var a=ApiClient;a&&(Events.off(a,"websocketmessage",DashboardPage.onWebSocketMessage),Events.off(a,"websocketopen",DashboardPage.onWebSocketOpen),DashboardPage.stopInterval(a)),DashboardPage.sessionUpdateTimer&&clearInterval(DashboardPage.sessionUpdateTimer)},renderPaths:function(e,a){$("#cachePath",e).html(a.CachePath),$("#logPath",e).html(a.LogPath),$("#transcodingTemporaryPath",e).html(a.TranscodingTempPath),$("#metadataPath",e).html(a.InternalMetadataPath)},refreshSessionsLocally:function(){var e=DashboardPage.sessionsList;e&&DashboardPage.renderActiveConnections($.mobile.activePage,e)},reloadSystemInfo:function(e){ApiClient.getSystemInfo().then(function(a){e.querySelector(".serverNameHeader").innerHTML=a.ServerName,Dashboard.updateSystemInfo(a),$("#appVersionNumber",e).html(Globalize.translate("LabelVersionNumber").replace("{0}",a.Version)),$("#ports",e).html(a.SupportsHttps?Globalize.translate("LabelRunningOnPorts","<b>"+a.HttpServerPortNumber+"</b>","<b>"+a.HttpsPortNumber+"</b>"):Globalize.translate("LabelRunningOnPort","<b>"+a.HttpServerPortNumber+"</b>")),a.CanSelfRestart?$(".btnRestartContainer",e).removeClass("hide"):$(".btnRestartContainer",e).addClass("hide"),DashboardPage.renderUrls(e,a),DashboardPage.renderPendingInstallations(e,a),a.CanSelfUpdate?($("#btnUpdateApplicationContainer",e).show(),$("#btnManualUpdateContainer",e).hide()):($("#btnUpdateApplicationContainer",e).hide(),$("#btnManualUpdateContainer",e).show()),DashboardPage.renderPaths(e,a),DashboardPage.renderHasPendingRestart(e,a.HasPendingRestart)})},reloadNews:function(a){var t={StartIndex:DashboardPage.newsStartIndex,Limit:7};ApiClient.getProductNews(t).then(function(n){var s=n.Items.map(function(a){var t="";t+='<a class="clearLink" href="'+a.Link+'" target="_blank">',t+="<paper-icon-item>",t+='<paper-fab mini class="blue" icon="dvr" item-icon></paper-fab>',t+="<paper-item-body three-line>",t+="<div>",t+=a.Title,t+="</div>",t+="<div secondary>";var n=e.parseISO8601Date(a.Date,!0);return t+=n.toLocaleDateString(),t+="</div>",t+="<div secondary>",t+=a.Description,t+="</div>",t+="</paper-item-body>",t+="</paper-icon-item>",t+="</a>"}),i="";i+="<div>",i+=LibraryBrowser.getQueryPagingHtml({startIndex:t.StartIndex,limit:t.Limit,totalRecordCount:n.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1}),i+="</div>",s=s.join("")+i;var r=$(".latestNewsItems",a).html(s);$(".btnNextPage",r).on("click",function(){DashboardPage.newsStartIndex+=t.Limit,DashboardPage.reloadNews(a)}),$(".btnPreviousPage",r).on("click",function(){DashboardPage.newsStartIndex-=t.Limit,DashboardPage.reloadNews(a)})})},startInterval:function(e){e.isWebSocketOpen()&&(e.sendWebSocketMessage("SessionsStart","0,1500"),e.sendWebSocketMessage("ScheduledTasksInfoStart","0,1000"))},stopInterval:function(e){e.isWebSocketOpen()&&(e.sendWebSocketMessage("SessionsStop"),e.sendWebSocketMessage("ScheduledTasksInfoStop"))},onWebSocketMessage:function(e,a){var t=$.mobile.activePage;if("Sessions"==a.MessageType)DashboardPage.renderInfo(t,a.Data);else if("RestartRequired"==a.MessageType)DashboardPage.renderHasPendingRestart(t,!0);else if("ServerShuttingDown"==a.MessageType)DashboardPage.renderHasPendingRestart(t,!0);else if("ServerRestarting"==a.MessageType)DashboardPage.renderHasPendingRestart(t,!0);else if("ScheduledTasksInfo"==a.MessageType){var n=a.Data;DashboardPage.renderRunningTasks(t,n)}else("PackageInstalling"==a.MessageType||"PackageInstallationCompleted"==a.MessageType)&&(DashboardPage.pollForInfo(t,!0),DashboardPage.reloadSystemInfo(t))},onWebSocketOpen:function(){var e=this;DashboardPage.startInterval(e)},pollForInfo:function(e,a){var t=window.ApiClient;t&&(t.getSessions().then(function(t){DashboardPage.renderInfo(e,t,a)}),t.getScheduledTasks().then(function(a){DashboardPage.renderRunningTasks(e,a)}))},renderInfo:function(e,a,t){DashboardPage.renderActiveConnections(e,a),DashboardPage.renderPluginUpdateInfo(e,t),Dashboard.hideLoadingMsg()},renderActiveConnections:function(e,a){var t="";DashboardPage.sessionsList=a;var n=$(".activeDevices",e);$(".card",n).addClass("deadSession");for(var s=0,i=a.length;i>s;s++){var r=a[s],o="session"+r.Id,l=$("#"+o,e);if(l.length)DashboardPage.updateSession(l,r);else{var d=r.NowPlayingItem,g=d?"card activeSession":"card activeSession";r.TranscodingInfo&&r.TranscodingInfo.CompletionPercentage&&(g+=" transcodingSession"),t+='<div class="'+g+'" id="'+o+'">',t+='<div class="cardBox" style="box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);margin:4px;">',t+='<div class="cardScalable">',t+='<div class="cardPadder"></div>',t+='<div class="cardContent">',t+='<div class="sessionNowPlayingContent"';var c=DashboardPage.getNowPlayingImageUrl(d);c&&(t+=' data-src="'+c+'" style="display:inline-block;background-image:url(\''+c+"');\""),t+="></div>",t+='<div class="sessionNowPlayingInnerContent">',t+='<div class="sessionAppInfo">';var p=DashboardPage.getClientImage(r);p&&(t+=p),t+='<div class="sessionAppName" style="display:inline-block;">',t+='<div class="sessionDeviceName">'+r.DeviceName+"</div>",t+='<div class="sessionAppSecondaryText">'+DashboardPage.getAppSecondaryText(r)+"</div>",t+="</div>",t+="</div>",t+='<div class="sessionNowPlayingTime">'+DashboardPage.getSessionNowPlayingTime(r)+"</div>",t+='<div class="sessionNowPlayingStreamInfo">'+DashboardPage.getSessionNowPlayingStreamInfo(r)+"</div>";var m=DashboardPage.getNowPlayingName(r);if(t+='<div class="sessionNowPlayingInfo" data-imgsrc="'+m.image+'">',t+=m.html,t+="</div>",d&&d.RunTimeTicks){var h=r.PlayState.PositionTicks||0,u=100*h/d.RunTimeTicks;t+='<progress class="itemProgressBar playbackProgress" min="0" max="100" value="'+u+'"></progress>'}else t+='<progress class="itemProgressBar playbackProgress" min="0" max="100" style="display:none;"></progress>';t+=r.TranscodingInfo&&r.TranscodingInfo.CompletionPercentage?'<progress class="itemProgressBar transcodingProgress" min="0" max="100" value="'+r.TranscodingInfo.CompletionPercentage.toFixed(1)+'"></progress>':'<progress class="itemProgressBar transcodingProgress" min="0" max="100" style="display:none;"></progress>',t+="</div>",t+="</div>",t+="</div>",t+='<div style="padding:1em;border-top:1px solid #eee;background:#fff;text-align:center;text-transform:uppercase;display:flex;align-items:center;justify-content:center;">';var b=DashboardPage.getUserImage(r);t+=b?'<img style="border-radius:50px;margin-right:.5em;" src="'+b+'" />':'<div style="height:24px;"></div>',t+='<div class="sessionUserName">',t+=DashboardPage.getUsersHtml(r)||"&nbsp;",t+="</div>",t+="</div>",t+="</div>",t+="</div>"}}n.append(t),$(".deadSession",n).remove()},getSessionNowPlayingStreamInfo:function(e){var a="";return e.TranscodingInfo&&e.TranscodingInfo.IsAudioDirect&&e.TranscodingInfo.IsVideoDirect?a+=Globalize.translate("LabelPlayMethodDirectStream"):"Transcode"==e.PlayState.PlayMethod?(a+=Globalize.translate("LabelPlayMethodTranscoding"),e.TranscodingInfo&&e.TranscodingInfo.Framerate&&(a+=" - "+e.TranscodingInfo.Framerate+" fps")):"DirectStream"==e.PlayState.PlayMethod?a+=Globalize.translate("LabelPlayMethodDirectPlay"):"DirectPlay"==e.PlayState.PlayMethod&&(a+=Globalize.translate("LabelPlayMethodDirectPlay")),a},getSessionNowPlayingTime:function(a){var t="";t+=a.PlayState.PositionTicks?e.getDisplayRunningTime(a.PlayState.PositionTicks):"--:--:--",t+=" / ";var n=a.NowPlayingItem;return t+=n&&n.RunTimeTicks?e.getDisplayRunningTime(n.RunTimeTicks):"--:--:--"},getAppSecondaryText:function(e){return e.ApplicationVersion},getNowPlayingName:function(e){var a="",t=e.NowPlayingItem;if(!t)return{html:"Last seen "+humane_date(e.LastActivityDate),image:a};var n=t.Name,s="";t.Artists&&t.Artists.length?(s=n,n=t.Artists[0]):t.SeriesName||t.Album?(s=n,n=t.SeriesName||t.Album):t.ProductionYear&&(s=t.ProductionYear),t.LogoItemId&&(a=ApiClient.getScaledImageUrl(t.LogoItemId,{tag:e.LogoImageTag,maxHeight:24,maxWidth:130,type:"Logo"}),n='<img src="'+a+'" style="max-height:24px;max-width:130px;" />');var i=s?n+"<br/>"+s:n;return{html:i,image:a}},getUsersHtml:function(e){var a=[];e.UserId&&a.push(e.UserName);for(var t=0,n=e.AdditionalUsers.length;n>t;t++)a.push(e.AdditionalUsers[t].UserName);return a.join(", ")},getUserImage:function(e){return e.UserId&&e.UserPrimaryImageTag?ApiClient.getUserImageUrl(e.UserId,{tag:e.UserPrimaryImageTag,height:24,type:"Primary"}):null},updateSession:function(e,a){e.removeClass("deadSession");var t=a.NowPlayingItem;t?e.addClass("playingSession"):e.removeClass("playingSession"),$(".sessionNowPlayingStreamInfo",e).html(DashboardPage.getSessionNowPlayingStreamInfo(a)),$(".sessionNowPlayingTime",e).html(DashboardPage.getSessionNowPlayingTime(a)),$(".sessionUserName",e).html(DashboardPage.getUsersHtml(a)||"&nbsp;"),$(".sessionAppSecondaryText",e).html(DashboardPage.getAppSecondaryText(a)),$(".sessionTranscodingFramerate",e).html(a.TranscodingInfo&&a.TranscodingInfo.Framerate?a.TranscodingInfo.Framerate+" fps":"");var n=DashboardPage.getNowPlayingName(a),s=$(".sessionNowPlayingInfo",e);if(n.image&&n.image==s.attr("data-imgsrc")||(s.html(n.html),s.attr("data-imgsrc",n.image||"")),t&&t.RunTimeTicks){var i=a.PlayState.PositionTicks||0,r=100*i/t.RunTimeTicks;$(".playbackProgress",e).show().val(r)}else $(".playbackProgress",e).hide();a.TranscodingInfo&&a.TranscodingInfo.CompletionPercentage?(e.addClass("transcodingSession"),$(".transcodingProgress",e).show().val(a.TranscodingInfo.CompletionPercentage)):($(".transcodingProgress",e).hide(),e.removeClass("transcodingSession"));var o=DashboardPage.getNowPlayingImageUrl(t)||"",l=$(".sessionNowPlayingContent",e)[0];o!=l.getAttribute("data-src")&&(l.style.backgroundImage=o?"url('"+o+"')":"",l.setAttribute("data-src",o))},getClientImage:function(e){var a=e.Client.toLowerCase(),t=e.DeviceName.toLowerCase();if(e.AppIconUrl)return"<img src='"+e.AppIconUrl+"' />";if("dashboard"==a||"emby web client"==a){var n;return n=-1!=t.indexOf("chrome")?"css/images/clients/chrome.png":"css/images/clients/html5.png","<img src='"+n+"' alt='Emby Web Client' />"}return-1!=a.indexOf("android")?"<img src='css/images/clients/android.png' />":-1!=a.indexOf("ios")?"<img src='css/images/clients/ios.png' />":"mb-classic"==a?"<img src='css/images/clients/mbc.png' />":"roku"==a?"<img src='css/images/clients/roku.jpg' />":"windows phone"==a?"<img src='css/images/clients/windowsphone.png' />":"dlna"==a?"<img src='css/images/clients/dlna.png' />":"kodi"==a||"xbmc"==a?"<img src='css/images/clients/kodi.png' />":"chromecast"==a?"<img src='css/images/clients/chromecast.png' />":null},getNowPlayingImageUrl:function(e){return e&&e.BackdropImageTag?ApiClient.getScaledImageUrl(e.BackdropItemId,{type:"Backdrop",width:275,tag:e.BackdropImageTag}):e&&e.ThumbImageTag?ApiClient.getScaledImageUrl(e.ThumbItemId,{type:"Thumb",width:275,tag:e.ThumbImageTag}):e&&e.PrimaryImageTag?ApiClient.getScaledImageUrl(e.PrimaryImageItemId,{type:"Primary",width:275,tag:e.PrimaryImageTag}):null},systemUpdateTaskKey:"SystemUpdateTask",renderRunningTasks:function(e,a){var t="";a=a.filter(function(e){return"Idle"!=e.State&&!e.IsHidden}),$("#btnUpdateApplication",e).buttonEnabled(a.filter(function(e){return e.Key==DashboardPage.systemUpdateTaskKey}).length?!1:!0),a.length?$("#runningTasksCollapsible",e).show():$("#runningTasksCollapsible",e).hide();for(var n=0,s=a.length;s>n;n++){var i=a[n];if(t+="<p>",t+=i.Name+"<br/>","Running"==i.State){var r=(i.CurrentProgressPercentage||0).toFixed(1);t+='<progress max="100" value="'+r+'" title="'+r+'%">',t+=""+r+"%",t+="</progress>",t+="<span style='color:#009F00;margin-left:5px;margin-right:5px;'>"+r+"%</span>",t+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonStop")+'" onclick="DashboardPage.stopTask(\''+i.Id+'\');"><iron-icon icon="cancel"></iron-icon></button>'}else"Cancelling"==i.State&&(t+='<span style="color:#cc0000;">'+Globalize.translate("LabelStopping")+"</span>");t+="</p>"}$("#divRunningTasks",e).html(t)},renderUrls:function(e,a){if(a.LocalAddress){var t=Globalize.translate("LabelLocalAccessUrl",'<a href="'+a.LocalAddress+'" target="_blank">'+a.LocalAddress+"</a>");$(".localUrl",e).html(t).show().trigger("create")}else $(".externalUrl",e).hide();if(a.WanAddress){var n=a.WanAddress,s=Globalize.translate("LabelRemoteAccessUrl",'<a href="'+n+'" target="_blank">'+n+"</a>");$(".externalUrl",e).html(s).show().trigger("create")}else $(".externalUrl",e).hide()},renderSupporterIcon:function(e,a){var t,n;AppInfo.enableSupporterMembership?a.IsMBSupporter?(t="css/images/supporter/supporterbadge.png",n=Globalize.translate("MessageThankYouForSupporting"),$(".supporterIconContainer",e).html('<a class="imageLink supporterIcon" href="http://emby.media/premiere" target="_blank" title="'+n+'"><img src="'+t+'" style="height:32px;vertical-align: middle; margin-right: .5em;" /></a><span style="position:relative;top:2px;text-decoration:none;">'+n+"</span>")):(t="css/images/supporter/nonsupporterbadge.png",n=Globalize.translate("MessagePleaseSupportProject"),$(".supporterIconContainer",e).html('<a class="imageLink supporterIcon" href="http://emby.media/premiere" target="_blank" title="'+n+'"><img src="'+t+'" style="height:32px;vertical-align: middle; margin-right: .5em;" /><span style="position:relative;top:2px;text-decoration:none;">'+n+"</span></a>")):$(".supporterIconContainer",e).remove()},renderHasPendingRestart:function(e,a){if(a)e.querySelector("#pUpToDate").classList.add("hide"),$("#pUpdateNow",e).hide();else{if(DashboardPage.lastAppUpdateCheck&&(new Date).getTime()-DashboardPage.lastAppUpdateCheck<18e5)return;DashboardPage.lastAppUpdateCheck=(new Date).getTime(),ApiClient.getAvailableApplicationUpdate().then(function(a){var t=a[0];t?(e.querySelector("#pUpToDate").classList.add("hide"),$("#pUpdateNow",e).show(),$("#newVersionNumber",e).html(Globalize.translate("VersionXIsAvailableForDownload").replace("{0}",t.versionStr))):(e.querySelector("#pUpToDate").classList.remove("hide"),$("#pUpdateNow",e).hide())})}},renderPendingInstallations:function(e,a){if(!a.CompletedInstallations.length)return void $("#collapsiblePendingInstallations",e).hide();$("#collapsiblePendingInstallations",e).show();for(var t="",n=0,s=a.CompletedInstallations.length;s>n;n++){var i=a.CompletedInstallations[n];t+="<div><strong>"+i.Name+"</strong> ("+i.Version+")</div>"}$("#pendingInstallations",e).html(t)},renderPluginUpdateInfo:function(e,a){!a&&DashboardPage.lastPluginUpdateCheck&&(new Date).getTime()-DashboardPage.lastPluginUpdateCheck<18e5||(DashboardPage.lastPluginUpdateCheck=(new Date).getTime(),ApiClient.getAvailablePluginUpdates().then(function(a){var t=$("#pPluginUpdates",e);if(!a.length)return void t.hide();t.show();for(var n="",s=0,i=a.length;i>s;s++){var r=a[s];n+="<p><strong>"+Globalize.translate("NewVersionOfSomethingAvailable").replace("{0}",r.name)+"</strong></p>",n+='<button type="button" data-icon="arrow-d" data-theme="b" onclick="DashboardPage.installPluginUpdate(this);" data-name="'+r.name+'" data-guid="'+r.guid+'" data-version="'+r.versionStr+'" data-classification="'+r.classification+'">'+Globalize.translate("ButtonUpdateNow")+"</button>"}t.html(n)}))},installPluginUpdate:function(e){$(e).buttonEnabled(!1);var a=e.getAttribute("data-name"),t=e.getAttribute("data-guid"),n=e.getAttribute("data-version"),s=e.getAttribute("data-classification");Dashboard.showLoadingMsg(),ApiClient.installPlugin(a,t,s,n).then(function(){Dashboard.hideLoadingMsg()})},updateApplication:function(){var e=$.mobile.activePage;$("#btnUpdateApplication",e).buttonEnabled(!1),Dashboard.showLoadingMsg(),ApiClient.getScheduledTasks().then(function(a){var t=a.filter(function(e){return e.Key==DashboardPage.systemUpdateTaskKey})[0];ApiClient.startScheduledTask(t.Id).then(function(){DashboardPage.pollForInfo(e),Dashboard.hideLoadingMsg()})})},stopTask:function(e){var a=$.mobile.activePage;ApiClient.stopScheduledTask(e).then(function(){DashboardPage.pollForInfo(a)})},restart:function(){require(["confirm"],function(e){e(Globalize.translate("MessageConfirmRestart"),Globalize.translate("HeaderRestart")).then(function(){$("#btnRestartServer").buttonEnabled(!1),$("#btnShutdown").buttonEnabled(!1),Dashboard.restartServer()})})},shutdown:function(){require(["confirm"],function(e){e(Globalize.translate("MessageConfirmShutdown"),Globalize.translate("HeaderShutdown")).then(function(){$("#btnRestartServer").buttonEnabled(!1),$("#btnShutdown").buttonEnabled(!1),ApiClient.shutdownServer()})})}},$(document).on("pageshow","#dashboardPage",DashboardPage.onPageShow).on("pagebeforehide","#dashboardPage",DashboardPage.onPageHide),function(a){function t(a){var t="";t+="<paper-icon-item>";var n="Error"==a.Severity||"Fatal"==a.Severity||"Warn"==a.Severity?"#cc0000":"#52B54B";if(a.UserId&&a.UserPrimaryImageTag){var s=ApiClient.getUserImageUrl(a.UserId,{type:"Primary",tag:a.UserPrimaryImageTag,height:40});t+='<paper-fab mini style="background-color:'+n+";background-image:url('"+s+"');background-repeat:no-repeat;background-position:center center;background-size: cover;\" item-icon></paper-fab>"}else t+='<paper-fab mini icon="dvr" style="background-color:'+n+'" item-icon></paper-fab>';t+="<paper-item-body three-line>",t+="<div>",t+=a.Name,t+="</div>",t+="<div secondary>";var i=e.parseISO8601Date(a.Date,!0);return t+=i.toLocaleDateString()+" "+i.toLocaleTimeString().toLowerCase(),t+="</div>",t+="<div secondary>",t+=a.ShortOverview||"",t+="</div>",t+="</paper-item-body>",t+="</paper-icon-item>"}function n(e,n,i,r){var o=n.Items.map(t).join("");if(n.TotalRecordCount>r){var l={StartIndex:i,Limit:r};o+=LibraryBrowser.getQueryPagingHtml({startIndex:l.StartIndex,limit:l.Limit,totalRecordCount:n.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1})}a(e).html(o),a(".btnNextPage",e).on("click",function(){s(e,i+r,r)}),a(".btnPreviousPage",e).on("click",function(){s(e,i-r,r)}),a(".btnShowOverview",e).on("click",function(){var e=a(this).parents(".newsItem"),t=a(".newsItemLongDescription",e).html(),n=a(".notificationName",e).html();Dashboard.alert({message:'<div style="max-height:300px; overflow: auto;">'+t+"</div>",title:n})})}function s(e,a,t){null==a&&(a=parseInt(e.getAttribute("data-activitystartindex")||"0")),t=t||parseInt(e.getAttribute("data-activitylimit")||"7");var s=new Date;s.setTime(s.getTime()-864e5),ApiClient.getJSON(ApiClient.getUrl("System/ActivityLog/Entries",{startIndex:a,limit:t,minDate:s.toISOString()})).then(function(s){e.setAttribute("data-activitystartindex",a),e.setAttribute("data-activitylimit",t),n(e,s,a,t)})}function i(e){e.each(function(){s(this)}).addClass("activityLogListWidget");var a=ApiClient;a&&(Events.on(a,"websocketopen",l),Events.on(a,"websocketmessage",d))}function r(e){e.isWebSocketOpen()&&e.sendWebSocketMessage("ActivityLogEntryStart","0,1500")}function o(e){e.isWebSocketOpen()&&e.sendWebSocketMessage("ActivityLogEntryStop","0,1500")}function l(){var e=ApiClient;e&&r(e)}function d(e,t){var n=t;"ActivityLogEntry"===n.MessageType&&a(".activityLogListWidget").each(function(){s(this)})}function g(){var e=ApiClient;e&&(Events.off(e,"websocketopen",l),Events.off(e,"websocketmessage",d),o(e))}a.fn.activityLogList=function(e){"destroy"==e?(this.removeClass("activityLogListWidget"),g(this)):i(this);var a=ApiClient;return a&&r(a),this}}(jQuery,document,window),function(e,a){function t(a,t){ApiClient.getDisplayPreferences("dashboard",t,"dashboard").then(function(n){n.CustomPrefs[o]=r,ApiClient.updateDisplayPreferences("dashboard",n,t,"dashboard"),e(a).off("pageshow",i)})}function n(a,t){var n=Dashboard.getCurrentUserId();t.getDisplayPreferences("dashboard",n,"dashboard").then(function(t){if(t.CustomPrefs[o]==r)e(".welcomeMessage",a).hide();else{var n=e(".welcomeMessage",a).show();t.CustomPrefs[o]?(e(".tourHeader",n).html(Globalize.translate("HeaderWelcomeBack")),e(".tourButtonText",n).html(Globalize.translate("ButtonTakeTheTourToSeeWhatsNew"))):(e(".tourHeader",n).html(Globalize.translate("HeaderWelcomeToProjectServerDashboard")),e(".tourButtonText",n).html(Globalize.translate("ButtonTakeTheTour")))}})}function s(a,n){require(["slideshow"],function(){var s=[{imageUrl:"css/images/tour/admin/dashboard.png",title:Globalize.translate("DashboardTourDashboard")},{imageUrl:"css/images/tour/admin/help.png",title:Globalize.translate("DashboardTourHelp")},{imageUrl:"css/images/tour/admin/users.png",title:Globalize.translate("DashboardTourUsers")},{imageUrl:"css/images/tour/admin/sync.png",title:Globalize.translate("DashboardTourSync")},{imageUrl:"css/images/tour/admin/cinemamode.png",title:Globalize.translate("DashboardTourCinemaMode")},{imageUrl:"css/images/tour/admin/chapters.png",title:Globalize.translate("DashboardTourChapters")},{imageUrl:"css/images/tour/admin/subtitles.png",title:Globalize.translate("DashboardTourSubtitles")},{imageUrl:"css/images/tour/admin/plugins.png",title:Globalize.translate("DashboardTourPlugins")},{imageUrl:"css/images/tour/admin/notifications.png",title:Globalize.translate("DashboardTourNotifications")},{imageUrl:"css/images/tour/admin/scheduledtasks.png",title:Globalize.translate("DashboardTourScheduledTasks")},{imageUrl:"css/images/tour/admin/mobile.png",title:Globalize.translate("DashboardTourMobile")},{imageUrl:"css/images/tour/enjoy.jpg",title:Globalize.translate("MessageEnjoyYourStay")}];require(["slideshow"],function(i){var r=new i({slides:s,interactive:!0,loop:!1});r.show(),t(a,n),e(".welcomeMessage",a).hide()})})}function i(){var e=this,a=ApiClient;a&&!AppInfo.isNativeApp&&n(e,a)}var r="12",o="welcomeTour";e(a).on("pageinit","#dashboardPage",function(){var a=this;e(".btnTakeTour",a).on("click",function(){s(a,Dashboard.getCurrentUserId())})}).on("pageshow","#dashboardPage",i)}(jQuery,document,window),function(){$(document).on("pageshow",".type-interior",function(){var e=this;Dashboard.getPluginSecurityInfo().then(function(a){if(!$(".customSupporterPromotion",e).length&&($(".supporterPromotion",e).remove(),!a.IsMBSupporter&&AppInfo.enableSupporterMembership)){var t='<div class="supporterPromotion"><a class="clearLink" href="http://emby.media/premiere" target="_blank"><paper-button raised class="block" style="text-transform:none;background-color:#52B54B;color:#fff;"><div>'+Globalize.translate("HeaderSupportTheTeam")+'</div><div style="font-weight:normal;margin-top:5px;">'+Globalize.translate("TextEnjoyBonusFeatures")+"</div></paper-button></a></div>";$(".content-primary",e).append(t)}})})}()});