var DashboardPage={newsStartIndex:0,onPageShow:function(){var e=this,a=ApiClient;a&&(Dashboard.lastSystemInfo&&Dashboard.setPageTitle(Dashboard.lastSystemInfo.ServerName),DashboardPage.newsStartIndex=0,Dashboard.showLoadingMsg(),DashboardPage.pollForInfo(e),DashboardPage.startInterval(a),Events.on(a,"websocketmessage",DashboardPage.onWebSocketMessage),Events.on(a,"websocketopen",DashboardPage.onWebSocketOpen),DashboardPage.lastAppUpdateCheck=null,DashboardPage.lastPluginUpdateCheck=null,Dashboard.getPluginSecurityInfo().then(function(a){DashboardPage.renderSupporterIcon(e,a)}),DashboardPage.reloadSystemInfo(e),DashboardPage.reloadNews(e),DashboardPage.sessionUpdateTimer=setInterval(DashboardPage.refreshSessionsLocally,6e4),$(".activityItems",e).activityLogList(),$(".swaggerLink",e).attr("href",a.getUrl("swagger-ui/index.html",{api_key:ApiClient.accessToken()})))},onPageHide:function(){var e=this;$(".activityItems",e).activityLogList("destroy");var a=ApiClient;a&&(Events.off(a,"websocketmessage",DashboardPage.onWebSocketMessage),Events.off(a,"websocketopen",DashboardPage.onWebSocketOpen),DashboardPage.stopInterval(a)),DashboardPage.sessionUpdateTimer&&clearInterval(DashboardPage.sessionUpdateTimer)},renderPaths:function(e,a){$("#cachePath",e).html(a.CachePath),$("#logPath",e).html(a.LogPath),$("#transcodingTemporaryPath",e).html(a.TranscodingTempPath),$("#metadataPath",e).html(a.InternalMetadataPath)},refreshSessionsLocally:function(){var e=DashboardPage.sessionsList;e&&DashboardPage.renderActiveConnections($.mobile.activePage,e)},reloadSystemInfo:function(e){ApiClient.getSystemInfo().then(function(a){Dashboard.setPageTitle(a.ServerName),Dashboard.updateSystemInfo(a),$("#appVersionNumber",e).html(Globalize.translate("LabelVersionNumber").replace("{0}",a.Version)),$("#ports",e).html(a.SupportsHttps?Globalize.translate("LabelRunningOnPorts","<b>"+a.HttpServerPortNumber+"</b>","<b>"+a.HttpsPortNumber+"</b>"):Globalize.translate("LabelRunningOnPort","<b>"+a.HttpServerPortNumber+"</b>")),a.CanSelfRestart?$(".btnRestartContainer",e).removeClass("hide"):$(".btnRestartContainer",e).addClass("hide"),DashboardPage.renderUrls(e,a),DashboardPage.renderPendingInstallations(e,a),a.CanSelfUpdate?($("#btnUpdateApplicationContainer",e).show(),$("#btnManualUpdateContainer",e).hide()):($("#btnUpdateApplicationContainer",e).hide(),$("#btnManualUpdateContainer",e).show()),DashboardPage.renderPaths(e,a),DashboardPage.renderHasPendingRestart(e,a.HasPendingRestart)})},reloadNews:function(e){var a={StartIndex:DashboardPage.newsStartIndex,Limit:7};ApiClient.getProductNews(a).then(function(t){var s=t.Items.map(function(e){var a="";a+='<a class="clearLink" href="'+e.Link+'" target="_blank">',a+="<paper-icon-item>",a+='<paper-fab mini class="blue" icon="dvr" item-icon></paper-fab>',a+="<paper-item-body three-line>",a+="<div>",a+=e.Title,a+="</div>",a+="<div secondary>";var t=parseISO8601Date(e.Date,{toLocal:!0});return a+=t.toLocaleDateString(),a+="</div>",a+="<div secondary>",a+=e.Description,a+="</div>",a+="</paper-item-body>",a+="</paper-icon-item>",a+="</a>"}),n="";n+="<div>",n+=LibraryBrowser.getQueryPagingHtml({startIndex:a.StartIndex,limit:a.Limit,totalRecordCount:t.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1}),n+="</div>",s=s.join("")+n;var r=$(".latestNewsItems",e).html(s).trigger("create");$(".btnNextPage",r).on("click",function(){DashboardPage.newsStartIndex+=a.Limit,DashboardPage.reloadNews(e)}),$(".btnPreviousPage",r).on("click",function(){DashboardPage.newsStartIndex-=a.Limit,DashboardPage.reloadNews(e)})})},startInterval:function(e){e.isWebSocketOpen()&&(e.sendWebSocketMessage("SessionsStart","0,1500"),e.sendWebSocketMessage("ScheduledTasksInfoStart","0,1000"))},stopInterval:function(e){e.isWebSocketOpen()&&(e.sendWebSocketMessage("SessionsStop"),e.sendWebSocketMessage("ScheduledTasksInfoStop"))},onWebSocketMessage:function(e,a){var t=$.mobile.activePage;if("Sessions"==a.MessageType)DashboardPage.renderInfo(t,a.Data);else if("RestartRequired"==a.MessageType)DashboardPage.renderHasPendingRestart(t,!0);else if("ServerShuttingDown"==a.MessageType)DashboardPage.renderHasPendingRestart(t,!0);else if("ServerRestarting"==a.MessageType)DashboardPage.renderHasPendingRestart(t,!0);else if("ScheduledTasksInfo"==a.MessageType){var s=a.Data;DashboardPage.renderRunningTasks(t,s)}else("PackageInstalling"==a.MessageType||"PackageInstallationCompleted"==a.MessageType)&&(DashboardPage.pollForInfo(t,!0),DashboardPage.reloadSystemInfo(t))},onWebSocketOpen:function(){var e=this;DashboardPage.startInterval(e)},pollForInfo:function(e,a){var t=window.ApiClient;t&&(t.getSessions().then(function(t){DashboardPage.renderInfo(e,t,a)}),t.getScheduledTasks().then(function(a){DashboardPage.renderRunningTasks(e,a)}))},renderInfo:function(e,a,t){DashboardPage.renderActiveConnections(e,a),DashboardPage.renderPluginUpdateInfo(e,t),Dashboard.hideLoadingMsg()},renderActiveConnections:function(e,a){var t="";DashboardPage.sessionsList=a;var s=$(".activeDevices",e);$(".card",s).addClass("deadSession");for(var n=0,r=a.length;r>n;n++){var i=a[n],o="session"+i.Id,l=$("#"+o,e);if(l.length)DashboardPage.updateSession(l,i);else{var d=i.NowPlayingItem,g=d?"card activeSession":"card activeSession";i.TranscodingInfo&&i.TranscodingInfo.CompletionPercentage&&(g+=" transcodingSession"),t+='<div class="'+g+'" id="'+o+'">',t+='<div class="cardBox" style="box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);margin:4px;">',t+='<div class="cardScalable">',t+='<div class="cardPadder"></div>',t+='<div class="cardContent">',t+='<div class="sessionNowPlayingContent"';var c=DashboardPage.getNowPlayingImageUrl(d);c&&(t+=' data-src="'+c+'" style="display:inline-block;background-image:url(\''+c+"');\""),t+="></div>",t+='<div class="sessionNowPlayingInnerContent">',t+='<div class="sessionAppInfo">';var p=DashboardPage.getClientImage(i);p&&(t+=p),t+='<div class="sessionAppName" style="display:inline-block;">',t+='<div class="sessionDeviceName">'+i.DeviceName+"</div>",t+='<div class="sessionAppSecondaryText">'+DashboardPage.getAppSecondaryText(i)+"</div>",t+="</div>",t+="</div>",t+='<div class="sessionNowPlayingTime">'+DashboardPage.getSessionNowPlayingTime(i)+"</div>",t+='<div class="sessionNowPlayingStreamInfo">'+DashboardPage.getSessionNowPlayingStreamInfo(i)+"</div>";var m=DashboardPage.getNowPlayingName(i);if(t+='<div class="sessionNowPlayingInfo" data-imgsrc="'+m.image+'">',t+=m.html,t+="</div>",d&&d.RunTimeTicks){var h=i.PlayState.PositionTicks||0,b=100*h/d.RunTimeTicks;t+='<progress class="itemProgressBar playbackProgress" min="0" max="100" value="'+b+'"></progress>'}else t+='<progress class="itemProgressBar playbackProgress" min="0" max="100" style="display:none;"></progress>';t+=i.TranscodingInfo&&i.TranscodingInfo.CompletionPercentage?'<progress class="itemProgressBar transcodingProgress" min="0" max="100" value="'+i.TranscodingInfo.CompletionPercentage.toFixed(1)+'"></progress>':'<progress class="itemProgressBar transcodingProgress" min="0" max="100" style="display:none;"></progress>',t+="</div>",t+="</div>",t+="</div>",t+='<div style="padding:1em;border-top:1px solid #eee;background:#fff;text-align:center;text-transform:uppercase;display:flex;align-items:center;justify-content:center;">';var u=DashboardPage.getUserImage(i);t+=u?'<img style="border-radius:50px;margin-right:.5em;" src="'+u+'" />':'<div style="height:24px;"></div>',t+='<div class="sessionUserName">',t+=DashboardPage.getUsersHtml(i)||"&nbsp;",t+="</div>",t+="</div>",t+="</div>",t+="</div>"}}s.append(t),$(".deadSession",s).remove()},getSessionNowPlayingStreamInfo:function(e){var a="";return e.TranscodingInfo&&e.TranscodingInfo.IsAudioDirect&&e.TranscodingInfo.IsVideoDirect?a+=Globalize.translate("LabelPlayMethodDirectStream"):"Transcode"==e.PlayState.PlayMethod?a+=Globalize.translate("LabelPlayMethodTranscoding"):"DirectStream"==e.PlayState.PlayMethod?a+=Globalize.translate("LabelPlayMethodDirectPlay"):"DirectPlay"==e.PlayState.PlayMethod&&(a+=Globalize.translate("LabelPlayMethodDirectPlay")),a},getSessionNowPlayingTime:function(e){var a="";a+=e.PlayState.PositionTicks?Dashboard.getDisplayTime(e.PlayState.PositionTicks):"--:--:--",a+=" / ";var t=e.NowPlayingItem;return a+=t&&t.RunTimeTicks?Dashboard.getDisplayTime(t.RunTimeTicks):"--:--:--"},getAppSecondaryText:function(e){return e.ApplicationVersion},getNowPlayingName:function(e){var a="",t=e.NowPlayingItem;if(!t)return{html:"Last seen "+humane_date(e.LastActivityDate),image:a};var s=t.Name,n="";t.Artists&&t.Artists.length?(n=s,s=t.Artists[0]):t.SeriesName||t.Album?(n=s,s=t.SeriesName||t.Album):t.ProductionYear&&(n=t.ProductionYear),t.LogoItemId&&(a=ApiClient.getScaledImageUrl(t.LogoItemId,{tag:e.LogoImageTag,maxHeight:24,maxWidth:130,type:"Logo"}),s='<img src="'+a+'" style="max-height:24px;max-width:130px;" />');var r=n?s+"<br/>"+n:s;return{html:r,image:a}},getUsersHtml:function(e){var a=[];e.UserId&&a.push(e.UserName);for(var t=0,s=e.AdditionalUsers.length;s>t;t++)a.push(e.AdditionalUsers[t].UserName);return a.join(", ")},getUserImage:function(e){return e.UserId&&e.UserPrimaryImageTag?ApiClient.getUserImageUrl(e.UserId,{tag:e.UserPrimaryImageTag,height:24,type:"Primary"}):null},updateSession:function(e,a){e.removeClass("deadSession");var t=a.NowPlayingItem;t?e.addClass("playingSession"):e.removeClass("playingSession"),$(".sessionNowPlayingStreamInfo",e).html(DashboardPage.getSessionNowPlayingStreamInfo(a)),$(".sessionNowPlayingTime",e).html(DashboardPage.getSessionNowPlayingTime(a)),$(".sessionUserName",e).html(DashboardPage.getUsersHtml(a)||"&nbsp;"),$(".sessionAppSecondaryText",e).html(DashboardPage.getAppSecondaryText(a)),$(".sessionTranscodingFramerate",e).html(a.TranscodingInfo&&a.TranscodingInfo.Framerate?a.TranscodingInfo.Framerate+" fps":"");var s=DashboardPage.getNowPlayingName(a),n=$(".sessionNowPlayingInfo",e);if(s.image&&s.image==n.attr("data-imgsrc")||(n.html(s.html),n.attr("data-imgsrc",s.image||"")),t&&t.RunTimeTicks){var r=a.PlayState.PositionTicks||0,i=100*r/t.RunTimeTicks;$(".playbackProgress",e).show().val(i)}else $(".playbackProgress",e).hide();a.TranscodingInfo&&a.TranscodingInfo.CompletionPercentage?(e.addClass("transcodingSession"),$(".transcodingProgress",e).show().val(a.TranscodingInfo.CompletionPercentage)):($(".transcodingProgress",e).hide(),e.removeClass("transcodingSession"));var o=DashboardPage.getNowPlayingImageUrl(t)||"",l=$(".sessionNowPlayingContent",e)[0];o!=l.getAttribute("data-src")&&(l.style.backgroundImage=o?"url('"+o+"')":"",l.setAttribute("data-src",o))},getClientImage:function(e){var a=e.Client.toLowerCase(),t=e.DeviceName.toLowerCase();if(e.AppIconUrl)return"<img src='"+e.AppIconUrl+"' />";if("dashboard"==a||"emby web client"==a){var s;return s=-1!=t.indexOf("chrome")?"css/images/clients/chrome.png":"css/images/clients/html5.png","<img src='"+s+"' alt='Emby Web Client' />"}return-1!=a.indexOf("android")?"<img src='css/images/clients/android.png' />":-1!=a.indexOf("ios")?"<img src='css/images/clients/ios.png' />":"mb-classic"==a?"<img src='css/images/clients/mbc.png' />":"roku"==a?"<img src='css/images/clients/roku.jpg' />":"windows phone"==a?"<img src='css/images/clients/windowsphone.png' />":"dlna"==a?"<img src='css/images/clients/dlna.png' />":"kodi"==a||"xbmc"==a?"<img src='css/images/clients/kodi.png' />":"chromecast"==a?"<img src='css/images/clients/chromecast.png' />":null},getNowPlayingImageUrl:function(e){return e&&e.BackdropImageTag?ApiClient.getScaledImageUrl(e.BackdropItemId,{type:"Backdrop",width:275,tag:e.BackdropImageTag}):e&&e.ThumbImageTag?ApiClient.getScaledImageUrl(e.ThumbItemId,{type:"Thumb",width:275,tag:e.ThumbImageTag}):e&&e.PrimaryImageTag?ApiClient.getScaledImageUrl(e.PrimaryImageItemId,{type:"Primary",width:275,tag:e.PrimaryImageTag}):null},systemUpdateTaskKey:"SystemUpdateTask",renderRunningTasks:function(e,a){var t="";a=a.filter(function(e){return"Idle"!=e.State&&!e.IsHidden}),$("#btnUpdateApplication",e).buttonEnabled(a.filter(function(e){return e.Key==DashboardPage.systemUpdateTaskKey}).length?!1:!0),a.length?$("#runningTasksCollapsible",e).show():$("#runningTasksCollapsible",e).hide();for(var s=0,n=a.length;n>s;s++){var r=a[s];if(t+="<p>",t+=r.Name+"<br/>","Running"==r.State){var i=(r.CurrentProgressPercentage||0).toFixed(1);t+='<progress max="100" value="'+i+'" title="'+i+'%">',t+=""+i+"%",t+="</progress>",t+="<span style='color:#009F00;margin-left:5px;margin-right:5px;'>"+i+"%</span>",t+='<paper-icon-button title="'+Globalize.translate("ButtonStop")+'" icon="cancel" onclick="DashboardPage.stopTask(\''+r.Id+"');\"></paper-icon-button>"}else"Cancelling"==r.State&&(t+='<span style="color:#cc0000;">'+Globalize.translate("LabelStopping")+"</span>");t+="</p>"}$("#divRunningTasks",e).html(t).trigger("create")},renderUrls:function(e,a){if(a.LocalAddress){var t=Globalize.translate("LabelLocalAccessUrl",'<a href="'+a.LocalAddress+'" target="_blank">'+a.LocalAddress+"</a>");$(".localUrl",e).html(t).show().trigger("create")}else $(".externalUrl",e).hide();if(a.WanAddress){var s=a.WanAddress,n=Globalize.translate("LabelRemoteAccessUrl",'<a href="'+s+'" target="_blank">'+s+"</a>");$(".externalUrl",e).html(n).show().trigger("create")}else $(".externalUrl",e).hide()},renderSupporterIcon:function(e,a){var t,s;AppInfo.enableSupporterMembership?a.IsMBSupporter?(t="css/images/supporter/supporterbadge.png",s=Globalize.translate("MessageThankYouForSupporting"),$(".supporterIconContainer",e).html('<a class="imageLink supporterIcon" href="http://emby.media/premiere" target="_blank" title="'+s+'"><img src="'+t+'" style="height:32px;vertical-align: middle; margin-right: .5em;" /></a><span style="position:relative;top:2px;text-decoration:none;">'+s+"</span>")):(t="css/images/supporter/nonsupporterbadge.png",s=Globalize.translate("MessagePleaseSupportProject"),$(".supporterIconContainer",e).html('<a class="imageLink supporterIcon" href="http://emby.media/premiere" target="_blank" title="'+s+'"><img src="'+t+'" style="height:32px;vertical-align: middle; margin-right: .5em;" /><span style="position:relative;top:2px;text-decoration:none;">'+s+"</span></a>")):$(".supporterIconContainer",e).remove()},renderHasPendingRestart:function(e,a){if(a)$("#pUpToDate",e).hide(),$("#pUpdateNow",e).hide();else{if(DashboardPage.lastAppUpdateCheck&&(new Date).getTime()-DashboardPage.lastAppUpdateCheck<18e5)return;DashboardPage.lastAppUpdateCheck=(new Date).getTime(),ApiClient.getAvailableApplicationUpdate().then(function(a){var t=a[0];t?($("#pUpToDate",e).hide(),$("#pUpdateNow",e).show(),$("#newVersionNumber",e).html(Globalize.translate("VersionXIsAvailableForDownload").replace("{0}",t.versionStr))):($("#pUpToDate",e).show(),$("#pUpdateNow",e).hide())})}},renderPendingInstallations:function(e,a){if(!a.CompletedInstallations.length)return void $("#collapsiblePendingInstallations",e).hide();$("#collapsiblePendingInstallations",e).show();for(var t="",s=0,n=a.CompletedInstallations.length;n>s;s++){var r=a.CompletedInstallations[s];t+="<div><strong>"+r.Name+"</strong> ("+r.Version+")</div>"}$("#pendingInstallations",e).html(t)},renderPluginUpdateInfo:function(e,a){!a&&DashboardPage.lastPluginUpdateCheck&&(new Date).getTime()-DashboardPage.lastPluginUpdateCheck<18e5||(DashboardPage.lastPluginUpdateCheck=(new Date).getTime(),ApiClient.getAvailablePluginUpdates().then(function(a){var t=$("#pPluginUpdates",e);if(!a.length)return void t.hide();t.show();for(var s="",n=0,r=a.length;r>n;n++){var i=a[n];s+="<p><strong>"+Globalize.translate("NewVersionOfSomethingAvailable").replace("{0}",i.name)+"</strong></p>",s+='<button type="button" data-icon="arrow-d" data-theme="b" onclick="DashboardPage.installPluginUpdate(this);" data-name="'+i.name+'" data-guid="'+i.guid+'" data-version="'+i.versionStr+'" data-classification="'+i.classification+'">'+Globalize.translate("ButtonUpdateNow")+"</button>"}t.html(s).trigger("create")}))},installPluginUpdate:function(e){$(e).buttonEnabled(!1);var a=e.getAttribute("data-name"),t=e.getAttribute("data-guid"),s=e.getAttribute("data-version"),n=e.getAttribute("data-classification");Dashboard.showLoadingMsg(),ApiClient.installPlugin(a,t,n,s).then(function(){Dashboard.hideLoadingMsg()})},updateApplication:function(){var e=$.mobile.activePage;$("#btnUpdateApplication",e).buttonEnabled(!1),Dashboard.showLoadingMsg(),ApiClient.getScheduledTasks().then(function(a){var t=a.filter(function(e){return e.Key==DashboardPage.systemUpdateTaskKey})[0];ApiClient.startScheduledTask(t.Id).then(function(){DashboardPage.pollForInfo(e),Dashboard.hideLoadingMsg()})})},stopTask:function(e){var a=$.mobile.activePage;ApiClient.stopScheduledTask(e).then(function(){DashboardPage.pollForInfo(a)})},restart:function(){require(["confirm"],function(e){e(Globalize.translate("MessageConfirmRestart"),Globalize.translate("HeaderRestart")).then(function(){$("#btnRestartServer").buttonEnabled(!1),$("#btnShutdown").buttonEnabled(!1),Dashboard.restartServer()})})},shutdown:function(){require(["confirm"],function(e){e(Globalize.translate("MessageConfirmShutdown"),Globalize.translate("HeaderShutdown")).then(function(){$("#btnRestartServer").buttonEnabled(!1),$("#btnShutdown").buttonEnabled(!1),ApiClient.shutdownServer()})})}};$(document).on("pageshow","#dashboardPage",DashboardPage.onPageShow).on("pagebeforehide","#dashboardPage",DashboardPage.onPageHide),function(e){function a(e){var a="";a+="<paper-icon-item>";var t="Error"==e.Severity||"Fatal"==e.Severity||"Warn"==e.Severity?"#cc0000":"#52B54B";if(e.UserId&&e.UserPrimaryImageTag){var s=ApiClient.getUserImageUrl(e.UserId,{type:"Primary",tag:e.UserPrimaryImageTag,height:40});a+='<paper-fab mini style="background-color:'+t+";background-image:url('"+s+"');background-repeat:no-repeat;background-position:center center;background-size: cover;\" item-icon></paper-fab>"}else a+='<paper-fab mini icon="dvr" style="background-color:'+t+'" item-icon></paper-fab>';a+="<paper-item-body three-line>",a+="<div>",a+=e.Name,a+="</div>",a+="<div secondary>";var n=parseISO8601Date(e.Date,{toLocal:!0});return a+=n.toLocaleDateString()+" "+n.toLocaleTimeString().toLowerCase(),a+="</div>",a+="<div secondary>",a+=e.ShortOverview||"",a+="</div>",a+="</paper-item-body>",a+="</paper-icon-item>"}function t(t,n,r,i){var o=n.Items.map(a).join("");if(n.TotalRecordCount>i){var l={StartIndex:r,Limit:i};o+=LibraryBrowser.getQueryPagingHtml({startIndex:l.StartIndex,limit:l.Limit,totalRecordCount:n.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1})}e(t).html(o).trigger("create"),e(".btnNextPage",t).on("click",function(){s(t,r+i,i)}),e(".btnPreviousPage",t).on("click",function(){s(t,r-i,i)}),e(".btnShowOverview",t).on("click",function(){var a=e(this).parents(".newsItem"),t=e(".newsItemLongDescription",a).html(),s=e(".notificationName",a).html();Dashboard.alert({message:'<div style="max-height:300px; overflow: auto;">'+t+"</div>",title:s})})}function s(e,a,s){null==a&&(a=parseInt(e.getAttribute("data-activitystartindex")||"0")),s=s||parseInt(e.getAttribute("data-activitylimit")||"7");var n=new Date;n.setTime(n.getTime()-864e5),ApiClient.getJSON(ApiClient.getUrl("System/ActivityLog/Entries",{startIndex:a,limit:s,minDate:n.toISOString()})).then(function(n){e.setAttribute("data-activitystartindex",a),e.setAttribute("data-activitylimit",s),t(e,n,a,s)})}function n(e){e.each(function(){s(this)}).addClass("activityLogListWidget");var a=ApiClient;a&&(Events.on(a,"websocketopen",o),Events.on(a,"websocketmessage",l))}function r(e){e.isWebSocketOpen()&&e.sendWebSocketMessage("ActivityLogEntryStart","0,1500")}function i(e){e.isWebSocketOpen()&&e.sendWebSocketMessage("ActivityLogEntryStop","0,1500")}function o(){var e=ApiClient;e&&r(e)}function l(a,t){var n=t;"ActivityLogEntry"===n.MessageType&&e(".activityLogListWidget").each(function(){s(this)})}function d(){var e=ApiClient;e&&(Events.off(e,"websocketopen",o),Events.off(e,"websocketmessage",l),i(e))}e.fn.activityLogList=function(e){"destroy"==e?(this.removeClass("activityLogListWidget"),d(this)):n(this);var a=ApiClient;return a&&r(a),this}}(jQuery,document,window),function(e,a){function t(a,t){ApiClient.getDisplayPreferences("dashboard",t,"dashboard").then(function(s){s.CustomPrefs[o]=i,ApiClient.updateDisplayPreferences("dashboard",s,t,"dashboard"),e(a).off("pageshow",r)})}function s(a,t){var s=Dashboard.getCurrentUserId();t.getDisplayPreferences("dashboard",s,"dashboard").then(function(t){if(t.CustomPrefs[o]==i)e(".welcomeMessage",a).hide();else{var s=e(".welcomeMessage",a).show();t.CustomPrefs[o]?(e(".tourHeader",s).html(Globalize.translate("HeaderWelcomeBack")),e(".tourButtonText",s).html(Globalize.translate("ButtonTakeTheTourToSeeWhatsNew"))):(e(".tourHeader",s).html(Globalize.translate("HeaderWelcomeToProjectServerDashboard")),e(".tourButtonText",s).html(Globalize.translate("ButtonTakeTheTour")))}})}function n(a,s){require(["slideshow"],function(){var n=[{imageUrl:"css/images/tour/dashboard/dashboard.png",title:Globalize.translate("DashboardTourDashboard")},{imageUrl:"css/images/tour/dashboard/help.png",title:Globalize.translate("DashboardTourHelp")},{imageUrl:"css/images/tour/dashboard/users.png",title:Globalize.translate("DashboardTourUsers")},{imageUrl:"css/images/tour/dashboard/sync.png",title:Globalize.translate("DashboardTourSync")},{imageUrl:"css/images/tour/dashboard/cinemamode.png",title:Globalize.translate("DashboardTourCinemaMode")},{imageUrl:"css/images/tour/dashboard/chapters.png",title:Globalize.translate("DashboardTourChapters")},{imageUrl:"css/images/tour/dashboard/subtitles.png",title:Globalize.translate("DashboardTourSubtitles")},{imageUrl:"css/images/tour/dashboard/plugins.png",title:Globalize.translate("DashboardTourPlugins")},{imageUrl:"css/images/tour/dashboard/notifications.png",title:Globalize.translate("DashboardTourNotifications")},{imageUrl:"css/images/tour/dashboard/scheduledtasks.png",title:Globalize.translate("DashboardTourScheduledTasks")},{imageUrl:"css/images/tour/dashboard/mobile.png",title:Globalize.translate("DashboardTourMobile")},{imageUrl:"css/images/tour/enjoy.jpg",title:Globalize.translate("MessageEnjoyYourStay")}];require(["slideshow"],function(r){var i=new r({slides:n,interactive:!0,loop:!1});i.show(),t(a,s),e(".welcomeMessage",a).hide()})})}function r(){var e=this,a=ApiClient;a&&!AppInfo.isNativeApp&&s(e,a)}var i="12",o="welcomeTour";e(a).on("pageinit","#dashboardPage",function(){var a=this;e(".btnTakeTour",a).on("click",function(){n(a,Dashboard.getCurrentUserId())})}).on("pageshow","#dashboardPage",r)}(jQuery,document,window),function(){$(document).on("pageshow",".type-interior",function(){var e=this;Dashboard.getPluginSecurityInfo().then(function(a){if(!$(".customSupporterPromotion",e).length&&($(".supporterPromotion",e).remove(),!a.IsMBSupporter&&AppInfo.enableSupporterMembership)){var t='<div class="supporterPromotion"><a class="clearLink" href="http://emby.media/premiere" target="_blank"><paper-button raised class="block" style="text-transform:none;background-color:#52B54B;color:#fff;"><div>'+Globalize.translate("HeaderSupportTheTeam")+'</div><div style="font-weight:normal;margin-top:5px;">'+Globalize.translate("TextEnjoyBonusFeatures")+"</div></paper-button></a></div>";$(".content-primary",e).append(t)}})})}();