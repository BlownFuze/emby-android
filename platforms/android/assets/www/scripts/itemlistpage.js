!function(e){function t(){var e=a(),t=l[e];return t||(t=l[e]={query:{SortBy:"SortName",SortOrder:"Ascending",Fields:"DateCreated,PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()}},t.query.Filters="",t.query.NameStartsWithOrGreater="",t.view=LibraryBrowser.getSavedView(e)||LibraryBrowser.getDefaultItemsView("Poster","Poster"),t.query.ParentId=getParameterByName("parentId"),LibraryBrowser.loadSavedQueryValues(e,t.query)),t}function r(){return t().query}function a(){return LibraryBrowser.getSavedQueryKey()}function i(o){Dashboard.showLoadingMsg();var l=r(),u=Dashboard.getCurrentUserId(),d=l.ParentId?ApiClient.getItem(u,l.ParentId):ApiClient.getRootFolder(u),m=ApiClient.getItems(u,l);Promise.all([d,m]).then(function(r){var u=r[0];s=u;var d=r[1];window.scrollTo(0,0);var m=t().view,c="",g=LibraryBrowser.getQueryPagingHtml({startIndex:l.StartIndex,limit:l.Limit,totalRecordCount:d.TotalRecordCount,viewButton:!0,showLimit:!1,addLayoutButton:!0,currentLayout:m,viewIcon:"filter-list",sortButton:!0,layouts:"Poster,PosterCard,Thumb"});o.querySelector(".listTopPaging").innerHTML=g,n(o);var y=getParameterByName("context"),h={items:d.Items,shape:"auto",centerText:!0,lazy:!0,coverImage:"PhotoAlbum"==u.Type};"Backdrop"==m?(h.shape="backdrop",h.showTitle=!0,h.preferBackdrop=!0,c=LibraryBrowser.getPosterViewHtml(h)):"Poster"==m?(h.showTitle="photos"==y?"auto":!0,h.overlayText="photos"==y,c=LibraryBrowser.getPosterViewHtml(h)):"PosterCard"==m&&(h.showTitle=!0,h.showYear=!0,h.cardLayout=!0,h.centerText=!1,c=LibraryBrowser.getPosterViewHtml(h));var b=o.querySelector("#items");b.innerHTML=c+g,ImageLoader.lazyChildren(b),e(".btnNextPage",o).on("click",function(){l.StartIndex+=l.Limit,i(o)}),e(".btnPreviousPage",o).on("click",function(){l.StartIndex-=l.Limit,i(o)}),e(".btnChangeLayout",o).on("layoutchange",function(e,r){t().view=r,LibraryBrowser.saveViewSetting(a(),r),i(o)}),e(".btnSort",o).on("click",function(){LibraryBrowser.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionCommunityRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionCriticRating"),id:"CriticRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName"},{name:Globalize.translate("OptionRuntime"),id:"Runtime,SortName"}],callback:function(){i(o)},query:l})}),LibraryBrowser.saveQueryValues(getParameterByName("parentId"),l);var p=u.Name;null!=u.IndexNumber&&(p=u.IndexNumber+" - "+p),null!=u.ParentIndexNumber&&(p=u.ParentIndexNumber+"."+p),LibraryMenu.setTitle(p),e(o).trigger("displayingitem",[{item:u}]),LibraryBrowser.setLastRefreshed(o),Dashboard.hideLoadingMsg()})}function n(t){var a=r();e(".chkStandardFilter",t).each(function(){var e=","+(a.Filters||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),e(".alphabetPicker",t).alphaValue(a.NameStartsWithOrGreater)}function o(){var t=r(),a=e(this).parents(".page"),i=LibraryBrowser.getListItemInfo(this);return"Photo"==i.mediaType?(require(["scripts/photos"],function(){Photos.startSlideshow(a,t,i.id)}),!1):void 0}var s,l={};pageIdOn("pageinit","itemListPage",function(){var t=this;e(".chkStandardFilter",this).on("change",function(){var e=r(),a=this.getAttribute("data-filter"),n=e.Filters||"";n=(","+n).replace(","+a,"").substring(1),this.checked&&(n=n?n+","+a:a),e.StartIndex=0,e.Filters=n,i(t)}),e(".alphabetPicker",this).on("alphaselect",function(e,a){var n=r();n.NameStartsWithOrGreater=a,n.StartIndex=0,i(t)}).on("alphaclear",function(){var e=r();e.NameStartsWithOrGreater="",i(t)}),e(t).on("click",".mediaItem",o)}),pageIdOn("pagebeforeshow","itemListPage",function(){var e=this;i(e),n(e),LibraryMenu.setBackButtonVisible(getParameterByName("context"))}),pageIdOn("pagebeforehide","itemListPage",function(){s=null})}(jQuery,document);