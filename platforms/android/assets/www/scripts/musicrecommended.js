define(["jQuery","libraryBrowser","scrollStyles"],function(e,t){function r(){var t=e(window).width();return t>=1920?9:t>=1200?12:t>=1e3?10:8}function a(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function n(){return a()?"overflowSquare":"square"}function i(e,a){Dashboard.showLoadingMsg();var i=Dashboard.getCurrentUserId(),o={IncludeItemTypes:"Audio",Limit:r(),Fields:"PrimaryImageAspectRatio,SyncInfo",ParentId:a,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getJSON(ApiClient.getUrl("Users/"+i+"/Items/Latest",o)).then(function(r){var a=e.querySelector("#recentlyAddedSongs");a.innerHTML=t.getPosterViewHtml({items:r,showUnplayedIndicator:!1,showLatestItemsPopup:!1,shape:n(),showTitle:!0,showParentTitle:!0,lazy:!0,centerText:!0,overlayPlayButton:!0}),ImageLoader.lazyChildren(a),Dashboard.hideLoadingMsg()})}function o(a,i){var o={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:r(),Recursive:!0,Fields:"PrimaryImageAspectRatio,AudioInfo,SyncInfo",Filters:"IsPlayed",ParentId:i,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(Dashboard.getCurrentUserId(),o).then(function(r){var i;i=r.Items.length?e("#recentlyPlayed",a).show()[0]:e("#recentlyPlayed",a).hide()[0];var o=i.querySelector(".itemsContainer");o.innerHTML=t.getPosterViewHtml({items:r.Items,showUnplayedIndicator:!1,shape:n(),showTitle:!0,showParentTitle:!0,defaultAction:"instantmix",lazy:!0,centerText:!0,overlayMoreButton:!0}),ImageLoader.lazyChildren(o)})}function s(a,i){var o={SortBy:"PlayCount",SortOrder:"Descending",IncludeItemTypes:"Audio",Limit:r(),Recursive:!0,Fields:"PrimaryImageAspectRatio,AudioInfo,SyncInfo",Filters:"IsPlayed",ParentId:i,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(Dashboard.getCurrentUserId(),o).then(function(r){var i;i=r.Items.length?e("#topPlayed",a).show()[0]:e("#topPlayed",a).hide()[0];var o=i.querySelector(".itemsContainer");o.innerHTML=t.getPosterViewHtml({items:r.Items,showUnplayedIndicator:!1,shape:n(),showTitle:!0,showParentTitle:!0,defaultAction:"instantmix",lazy:!0,centerText:!0,overlayMoreButton:!0}),ImageLoader.lazyChildren(o)})}function l(a){var i={SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,CumulativeRunTimeTicks,CanDelete,SyncInfo",StartIndex:0,Limit:r(),EnableTotalRecordCount:!1};ApiClient.getItems(Dashboard.getCurrentUserId(),i).then(function(r){var i;i=r.Items.length?e("#playlists",a).show()[0]:e("#playlists",a).hide()[0];var o=i.querySelector(".itemsContainer");o.innerHTML=t.getPosterViewHtml({items:r.Items,shape:n(),showTitle:!0,lazy:!0,coverImage:!0,showItemCounts:!0,centerText:!0,overlayPlayButton:!0}),ImageLoader.lazyChildren(o)})}function d(e,t){var r=LibraryMenu.getTopParentId();i(t,r),l(t,r),o(t,r),s(t,r),require(["components/favoriteitems"],function(e){e.render(t,Dashboard.getCurrentUserId(),r,["favoriteArtists","favoriteAlbums","favoriteSongs"])})}return pageIdOn("pagebeforeshow","musicRecommendedPage",function(){var e=this;if(!e.getAttribute("data-title")){var t=LibraryMenu.getTopParentId();t?ApiClient.getItem(Dashboard.getCurrentUserId(),t).then(function(t){e.setAttribute("data-title",t.Name),LibraryMenu.setTitle(t.Name)}):(e.setAttribute("data-title",Globalize.translate("TabMusic")),LibraryMenu.setTitle(Globalize.translate("TabMusic")))}}),function(r,a){function n(){Dashboard.showLoadingMsg();var e=r.querySelector(".pageTabContent[data-index='0']");d(r,e)}function i(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function o(e,t){var n=e.querySelector(".pageTabContent[data-index='"+t+"']"),i=[];switch(t){case 0:break;case 1:i.push("scripts/musicalbums");break;case 2:i.push("scripts/musicalbumartists");break;case 3:i.push("scripts/musicartists");break;case 4:i.push("scripts/songs"),i.push("paper-icon-item"),i.push("paper-item-body");break;case 5:i.push("scripts/musicgenres");break;case 6:i.push("scripts/musicfolders")}require(i,function(e){0==t&&(s.tabContent=n);var i=l[t];i||(i=t?new e(r,a,n):s,l[t]=i,i.initTab&&i.initTab()),-1==u.indexOf(t)&&(u.push(t),i.renderTab())})}var s=this;s.initTab=function(){var t=r.querySelector(".pageTabContent[data-index='0']"),a=t.querySelectorAll(".itemsContainer");i()?e(a).addClass("hiddenScrollX"):e(a).removeClass("hiddenScrollX"),e(a).createCardMenus()},s.renderTab=function(){n()};var l=[],u=[],c=r.querySelector(".libraryViewNav"),m="music.html",y=a.topParentId;y&&(m+="?topParentId="+y),t.configurePaperLibraryTabs(r,c,r.querySelectorAll(".pageTabContent"),[0,4,5,6]),c.addEventListener("tabchange",function(e){o(r,parseInt(e.detail.selectedTabIndex))}),r.addEventListener("viewdestroy",function(){l.forEach(function(e){e.destroy&&e.destroy()})})}});