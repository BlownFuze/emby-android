define(["jQuery","cardBuilder","emby-itemscontainer"],function(e,t){function n(e){var t=r(e),n=m[t];return n||(n=m[t]={query:{SortBy:"",SortOrder:"Ascending",Fields:"PrimaryImageAspectRatio,SyncInfo",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()}},LibraryBrowser.loadSavedQueryValues(t,n.query)),n}function a(e){return n(e).query}function r(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("channelitems")),e.savedQueryKey}function i(e,t){return e.pageParams||(e.pageParams={}),e.pageParams[t]||(e.pageParams[t]=getParameterByName(t)),e.pageParams[t]}function o(t){var r=i(t,"id");ApiClient.getJSON(ApiClient.getUrl("Channels/"+r+"/Features")).then(function(r){r.CanFilter?e(".filterControls",t).show():e(".filterControls",t).hide(),r.SupportsSortOrderToggle?e(".sortOrderToggle",t).show():e(".sortOrderToggle",t).hide();var i=r.MaxPageSize,o=a(t);i&&(o.Limit=Math.min(i,o.Limit||i)),n(t).sortFields=r.DefaultSortFields,l(t)})}function l(n){Dashboard.showLoadingMsg();var r=i(n,"id"),o=i(n,"folderId"),m=a(n);m.UserId=Dashboard.getCurrentUserId(),o?ApiClient.getItem(m.UserId,o).then(function(e){LibraryMenu.setTitle(e.Name)}):ApiClient.getItem(m.UserId,r).then(function(e){LibraryMenu.setTitle(e.Name)}),m.folderId=o,ApiClient.getJSON(ApiClient.getUrl("Channels/"+r+"/Items",m)).then(function(a){window.scrollTo(0,0);var r="",i=LibraryBrowser.getQueryPagingHtml({startIndex:m.StartIndex,limit:m.Limit,totalRecordCount:a.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,sortButton:!0,filterButton:!0});d(n),r=t.getCardsHtml({items:a.Items,shape:"auto",defaultShape:"square",context:"channels",showTitle:!0,coverImage:!0,showYear:!0,lazy:!0,centerText:!0});var o,g,c=n.querySelectorAll(".paging");for(o=0,g=c.length;g>o;o++)c[o].innerHTML=i;var f=n.querySelector("#items");f.innerHTML=r,ImageLoader.lazyChildren(f),e(".btnNextPage",n).on("click",function(){m.StartIndex+=m.Limit,l(n)}),e(".btnPreviousPage",n).on("click",function(){m.StartIndex-=m.Limit,l(n)}),e(".btnFilter",n).on("click",function(){s(n)}),e(".btnSort",n).on("click",function(){u(n)}),Dashboard.hideLoadingMsg()},function(){Dashboard.hideLoadingMsg()})}function s(e){require(["components/filterdialog/filterdialog"],function(t){var n=new t({query:a(e)});Events.on(n,"filterchange",function(){l(e)}),n.show()})}function u(e){var t=n(e).sortFields,r=[];r.push({name:Globalize.translate("OptionDefaultSort"),id:""}),-1!=t.indexOf("Name")&&r.push({name:Globalize.translate("OptionNameSort"),id:"SortName"}),-1!=t.indexOf("CommunityRating")&&r.push({name:Globalize.translate("OptionCommunityRating"),id:"CommunityRating"}),-1!=t.indexOf("DateCreated")&&r.push({name:Globalize.translate("OptionDateAdded"),id:"DateCreated"}),-1!=t.indexOf("PlayCount")&&r.push({name:Globalize.translate("OptionPlayCount"),id:"PlayCount"}),-1!=t.indexOf("PremiereDate")&&r.push({name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate"}),-1!=t.indexOf("Runtime")&&r.push({name:Globalize.translate("OptionRuntime"),id:"Runtime"}),LibraryBrowser.showSortMenu({items:r,callback:function(){l(e)},query:a(e)})}function d(){}var m={};pageIdOn("pagebeforeshow","channelItemsPage",function(){var e=this;o(e),d(e)})});