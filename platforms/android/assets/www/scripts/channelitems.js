define(["jQuery"],function(e){function t(e){var t=r(e),n=d[t];return n||(n=d[t]={query:{SortBy:"",SortOrder:"Ascending",Fields:"PrimaryImageAspectRatio,SyncInfo",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()}},LibraryBrowser.loadSavedQueryValues(t,n.query)),n}function n(e){return t(e).query}function r(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("channelitems")),e.savedQueryKey}function a(e,t){return e.pageParams||(e.pageParams={}),e.pageParams[t]||(e.pageParams[t]=getParameterByName(t)),e.pageParams[t]}function i(r){var i=a(r,"id");ApiClient.getJSON(ApiClient.getUrl("Channels/"+i+"/Features")).then(function(a){a.CanFilter?e(".filterControls",r).show():e(".filterControls",r).hide(),a.SupportsSortOrderToggle?e(".sortOrderToggle",r).show():e(".sortOrderToggle",r).hide();var i=a.MaxPageSize,l=n(r);i&&(l.Limit=Math.min(i,l.Limit||i)),t(r).sortFields=a.DefaultSortFields,o(r)})}function o(t){Dashboard.showLoadingMsg();var r=a(t,"id"),i=a(t,"folderId"),d=n(t);d.UserId=Dashboard.getCurrentUserId(),i?ApiClient.getItem(d.UserId,i).then(function(e){LibraryMenu.setTitle(e.Name)}):ApiClient.getItem(d.UserId,r).then(function(e){LibraryMenu.setTitle(e.Name)}),d.folderId=i,ApiClient.getJSON(ApiClient.getUrl("Channels/"+r+"/Items",d)).then(function(n){window.scrollTo(0,0);var r="",a=LibraryBrowser.getQueryPagingHtml({startIndex:d.StartIndex,limit:d.Limit,totalRecordCount:n.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,sortButton:!0,filterButton:!0});t.querySelector(".listTopPaging").innerHTML=a,u(t),r=LibraryBrowser.getPosterViewHtml({items:n.Items,shape:"auto",defaultShape:"square",context:"channels",showTitle:!0,coverImage:!0,showYear:!0,lazy:!0,centerText:!0});var i=t.querySelector("#items");i.innerHTML=r+a,ImageLoader.lazyChildren(i),e(".btnNextPage",t).on("click",function(){d.StartIndex+=d.Limit,o(t)}),e(".btnPreviousPage",t).on("click",function(){d.StartIndex-=d.Limit,o(t)}),e(".btnFilter",t).on("click",function(){l(t)}),e(".btnSort",t).on("click",function(){s(t)}),Dashboard.hideLoadingMsg()},function(){Dashboard.hideLoadingMsg()})}function l(e){require(["components/filterdialog/filterdialog"],function(t){var r=new t({query:n(e)});Events.on(r,"filterchange",function(){o(e)}),r.show()})}function s(e){var r=t(e).sortFields,a=[];a.push({name:Globalize.translate("OptionDefaultSort"),id:""}),-1!=r.indexOf("Name")&&a.push({name:Globalize.translate("OptionNameSort"),id:"SortName"}),-1!=r.indexOf("CommunityRating")&&a.push({name:Globalize.translate("OptionCommunityRating"),id:"CommunityRating"}),-1!=r.indexOf("DateCreated")&&a.push({name:Globalize.translate("OptionDateAdded"),id:"DateCreated"}),-1!=r.indexOf("PlayCount")&&a.push({name:Globalize.translate("OptionPlayCount"),id:"PlayCount"}),-1!=r.indexOf("PremiereDate")&&a.push({name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate"}),-1!=r.indexOf("Runtime")&&a.push({name:Globalize.translate("OptionRuntime"),id:"Runtime"}),LibraryBrowser.showSortMenu({items:a,callback:function(){o(e)},query:n(e)})}function u(){}var d={};pageIdOn("pagebeforeshow","channelItemsPage",function(){var e=this;i(e),u(e)})});