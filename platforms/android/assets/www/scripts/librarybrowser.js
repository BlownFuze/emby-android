var LibraryBrowser=function(e,a,t){function r(e){return e.replace(/&/g,"&amp;").replace(i,function(e){var a=e.charCodeAt(0),t=e.charCodeAt(1);return"&#"+(1024*(a-55296)+(t-56320)+65536)+";"}).replace(n,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var i=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,n=/([^\#-~| |!])/g,o="pagesize_v4",s={getDefaultPageSize:function(e,a){return 100},getDefaultItemsView:function(e,a){return browserInfo.mobile?a:e},getSavedQueryKey:function(a){return e.location.href.split("#")[0]+(a||"")},loadSavedQueryValues:function(e,a){var t=appStorage.getItem(e+"_"+Dashboard.getCurrentUserId());return t?(t=JSON.parse(t),$.extend(a,t)):a},saveQueryValues:function(e,a){var t={};a.SortBy&&(t.SortBy=a.SortBy),a.SortOrder&&(t.SortOrder=a.SortOrder);try{appStorage.setItem(e+"_"+Dashboard.getCurrentUserId(),JSON.stringify(t))}catch(r){}},saveViewSetting:function(e,a){try{appStorage.setItem(e+"_"+Dashboard.getCurrentUserId()+"_view",a)}catch(t){}},getSavedView:function(e){var a=appStorage.getItem(e+"_"+Dashboard.getCurrentUserId()+"_view");return a},getSavedViewSetting:function(e){var a=$.Deferred(),t=LibraryBrowser.getSavedView(e);return a.resolveWith(null,[t]),a.promise()},needsRefresh:function(e){var a=parseInt(e.getAttribute("data-lastrefresh")||"0");if(!a)return!0;if(NavHelper.isBack())return Logger.log("Not refreshing data because IsBack=true"),!1;var t,r=(new Date).getTime();return t=AppInfo.isNativeApp?3e5:browserInfo.ipad||browserInfo.iphone||browserInfo.android?1e4:3e4,t>r-a?(Logger.log("Not refreshing data due to age"),!1):!0},setLastRefreshed:function(e){e.setAttribute("data-lastrefresh",(new Date).getTime()),e.classList.add("hasrefreshtime")},enableFullPaperTabs:function(){return browserInfo.animate&&!browserInfo.mobile?!0:AppInfo.isNativeApp},animatePaperTabs:function(){return LibraryBrowser.enableFullPaperTabs()&&browserInfo.animate?browserInfo.mobile?!1:!0:!1},allowSwipe:function(e){function a(e){return"PAPER-SLIDER"==e.tagName?!1:e.classList?!e.classList.contains("hiddenScrollX")&&!e.classList.contains("smoothScrollX"):!0}for(var t=e;null!=t;){if(!a(t))return!1;t=t.parentNode}return!0},getTabsAnimationConfig:function(e){return browserInfo.mobile,{entry:{name:"fade-in-animation",node:e,timing:{duration:160,easing:"ease-out"}},exit:{name:"fade-out-animation",node:e,timing:{duration:200,easing:"ease-out"}}}},configureSwipeTabs:function(e,a,t){LibraryBrowser.animatePaperTabs()&&(browserInfo.mobile?(t.entryAnimation="slide-from-right-animation",t.exitAnimation="slide-left-animation"):(t.entryAnimation="fade-in-animation",t.exitAnimation="fade-out-animation"));var r=t.querySelectorAll("neon-animatable").length;require(["hammer"],function(e){var i=new e(t);i.get("swipe").set({direction:e.DIRECTION_HORIZONTAL}),i.on("swipeleft",function(e){if(LibraryBrowser.allowSwipe(e.target)){var i=parseInt(t.selected||"0");r-1>i&&(LibraryBrowser.animatePaperTabs()&&(t.entryAnimation="slide-from-right-animation",t.exitAnimation="slide-left-animation"),a.selectNext())}}),i.on("swiperight",function(e){if(LibraryBrowser.allowSwipe(e.target)){var r=parseInt(t.selected||"0");r>0&&(LibraryBrowser.animatePaperTabs()&&(t.entryAnimation="slide-from-left-animation",t.exitAnimation="slide-right-animation"),a.selectPrevious())}})})},navigateOnLibraryTabSelect:function(){return!LibraryBrowser.enableFullPaperTabs()},configurePaperLibraryTabs:function(e,a,t){function r(e,a){var t=[{opacity:"1",transform:"none",offset:0},{opacity:"0",transform:"translate3d(-100%, 0, 0)",offset:1}],r={duration:300,iterations:a};return e.animate(t,r)}if(browserInfo.chrome&&(a.noink=!0),LibraryBrowser.enableFullPaperTabs())browserInfo.safari?(a.noSlide=!0,a.noBar=!0):LibraryBrowser.configureSwipeTabs(e,a,t),$(".libraryViewNav",e).addClass("paperLibraryViewNav").removeClass("libraryViewNavWithMinHeight");else{a.noSlide=!0,a.noBar=!0;var i=$(".legacyTabs",e);t.addEventListener("iron-select",function(){var e=t.selected;$("a",i).removeClass("ui-btn-active")[e].classList.add("ui-btn-active")}),$(".libraryViewNav",e).removeClass("libraryViewNavWithMinHeight")}$(e).on("pagebeforeshow",LibraryBrowser.onTabbedpagebeforeshow),t.addEventListener("iron-select",function(){var e=this,t=LibraryBrowser.animatePaperTabs()||!a.noSlide?300:0;setTimeout(function(){e.dispatchEvent(new CustomEvent("tabchange",{}))},t)}),LibraryBrowser.navigateOnLibraryTabSelect()||a.addEventListener("iron-select",function(){var e=!browserInfo.safari;e=!1;var a=t.selected;if(null!=a&&e){var i=this.selected,n=t.querySelectorAll(".pageTabContent")[a];r(n,1).onfinish=function(){t.selected=i}}else t.selected=this.selected})},onTabbedpagebeforeshow:function(){var e=this,a=0,t=!1;e.getAttribute("data-firstload")||(a=300,t=!0,e.setAttribute("data-firstload","1")),a?setTimeout(function(){LibraryBrowser.onTabbedpagebeforeshowInternal(e,t)},a):LibraryBrowser.onTabbedpagebeforeshowInternal(e,t)},onTabbedpagebeforeshowInternal:function(e,a){if(a){Logger.log("selected tab is null, checking query string");var t=parseInt(getParameterByName("tab")||"0");if(Logger.log("selected tab will be "+t),LibraryBrowser.enableFullPaperTabs()){var r=e.querySelector("paper-tabs");if(r.selected)return;r.selected=t}else e.querySelector("neon-animated-pages").selected=t}else{var i=e.querySelector("neon-animated-pages");if(LibraryBrowser.enableFullPaperTabs()&&!NavHelper.isBack()&&i.selected){var n=i.entryAnimation,o=i.exitAnimation;return i.entryAnimation=null,i.exitAnimation=null,e.querySelector("paper-tabs").selected=0,i.entryAnimation=n,void(i.exitAnimation=o)}i.dispatchEvent(new CustomEvent("tabchange",{}))}},showTab:function(t,r){if(!LibraryBrowser.enableFullPaperTabs())return r&&(t=replaceQueryString(t,"tab",r)),void Dashboard.navigate(t);var i=function(){if(-1!=e.location.href.toLowerCase().indexOf(t.toLowerCase())){var a=this.querySelector("neon-animated-pages");if(a){var i=a.entryAnimation,n=a.exitAnimation;a.entryAnimation=null,a.exitAnimation=null;var o=this.querySelector("paper-tabs"),s=browserInfo.chrome?0:100;setTimeout(function(){var e=o.noSlide;o.noSlide=!0,o.selected=r,a.entryAnimation=i,a.exitAnimation=n,o.noSlide=e},s)}}};-1!=e.location.href.toLowerCase().indexOf(t.toLowerCase())?i.call($($.mobile.activePage)[0]):($(a).one("pagebeforeshow",".page",i),Dashboard.navigate(t))},canShare:function(e,a){return a.Policy.EnablePublicSharing},getDateParamValue:function(e){function a(e){return 10>e?"0"+e:e}var t=e;return""+t.getFullYear()+a(t.getMonth()+1)+a(t.getDate())+a(t.getHours())+a(t.getMinutes())+a(t.getSeconds())},playAllFromHere:function(e,a){e(a,100,"MediaSources,Chapters").then(function(e){MediaController.play({items:e.Items})})},queueAllFromHere:function(e,a){fn(a,100,"MediaSources,Chapters").then(function(e){MediaController.queue({items:e.Items})})},getItemCountsHtml:function(e,a){var t,r=[];if("Playlist"==a.Type){if(t="",a.CumulativeRunTimeTicks){var i=a.CumulativeRunTimeTicks/6e8;i=i||1,t+=Globalize.translate("ValueMinutes",Math.round(i))}else t+=Globalize.translate("ValueMinutes",0);r.push(t)}else"movies"==e.context?(a.MovieCount&&(t=1==a.MovieCount?Globalize.translate("ValueOneMovie"):Globalize.translate("ValueMovieCount",a.MovieCount),r.push(t)),a.TrailerCount&&(t=1==a.TrailerCount?Globalize.translate("ValueOneTrailer"):Globalize.translate("ValueTrailerCount",a.TrailerCount),r.push(t))):"tv"==e.context?(a.SeriesCount&&(t=1==a.SeriesCount?Globalize.translate("ValueOneSeries"):Globalize.translate("ValueSeriesCount",a.SeriesCount),r.push(t)),a.EpisodeCount&&(t=1==a.EpisodeCount?Globalize.translate("ValueOneEpisode"):Globalize.translate("ValueEpisodeCount",a.EpisodeCount),r.push(t))):"games"==e.context?a.GameCount&&(t=1==a.GameCount?Globalize.translate("ValueOneGame"):Globalize.translate("ValueGameCount",a.GameCount),r.push(t)):"music"==e.context&&(a.AlbumCount&&(t=1==a.AlbumCount?Globalize.translate("ValueOneAlbum"):Globalize.translate("ValueAlbumCount",a.AlbumCount),r.push(t)),a.SongCount&&(t=1==a.SongCount?Globalize.translate("ValueOneSong"):Globalize.translate("ValueSongCount",a.SongCount),r.push(t)),a.MusicVideoCount&&(t=1==a.MusicVideoCount?Globalize.translate("ValueOneMusicVideo"):Globalize.translate("ValueMusicVideoCount",a.MusicVideoCount),r.push(t)));return r.join(" â€¢ ")},getArtistLinksHtml:function(e,a){for(var t=[],r=0,i=e.length;i>r;r++){var n=e[r],o=a?' class="'+a+'"':"";t.push("<a"+o+' href="itemdetails.html?id='+n.Id+'">'+n.Name+"</a>")}return t=t.join(" / ")},playInExternalPlayer:function(e){Dashboard.loadExternalPlayer().then(function(){ExternalPlayer.showMenu(e)})},showPlayMenu:function(e,a,t,r,i,n){var o=AppInfo.supportsExternalPlayers&&AppSettings.enableExternalPlayers();if(!(n||"Audio"==i||r||o&&"Video"==i))return void MediaController.play(a);var s=[];n&&s.push({name:Globalize.translate("ButtonResume"),id:"resume",ironIcon:"play-arrow"}),s.push({name:Globalize.translate("ButtonPlay"),id:"play",ironIcon:"play-arrow"}),!r&&o&&"Audio"!=i&&s.push({name:Globalize.translate("ButtonPlayExternalPlayer"),id:"externalplayer",ironIcon:"airplay"}),MediaController.canQueueMediaType(i,t)&&s.push({name:Globalize.translate("ButtonQueue"),id:"queue",ironIcon:"playlist-add"}),("Audio"==t||"MusicAlbum"==t||"MusicArtist"==t||"MusicGenre"==t)&&s.push({name:Globalize.translate("ButtonInstantMix"),id:"instantmix",ironIcon:"shuffle"}),(r||"MusicArtist"==t||"MusicGenre"==t)&&s.push({name:Globalize.translate("ButtonShuffle"),id:"shuffle",ironIcon:"shuffle"}),require(["actionsheet"],function(){ActionSheetElement.show({items:s,positionTo:e,callback:function(e){switch(e){case"play":MediaController.play(a);break;case"externalplayer":LibraryBrowser.playInExternalPlayer(a);break;case"resume":MediaController.play({ids:[a],startPositionTicks:n});break;case"queue":MediaController.queue(a);break;case"instantmix":MediaController.instantMix(a);break;case"shuffle":MediaController.shuffle(a)}}})})},supportsEditing:function(e){return"UserRootFolder"==e||"UserView"==e?!1:!0},getMoreCommands:function(e,a){var t=[];return LibraryBrowser.supportsAddingToCollection(e)&&t.push("addtocollection"),PlaylistManager.supportsPlaylists(e)&&t.push("playlist"),"BoxSet"==e.Type||"Playlist"==e.Type?t.push("delete"):e.CanDelete&&t.push("delete"),a.Policy.IsAdministrator&&(LibraryBrowser.supportsEditing(e.Type)&&t.push("edit"),"Video"==e.MediaType&&"TvChannel"!=e.Type&&"Program"!=e.Type&&"Virtual"!=e.LocationType&&t.push("editsubtitles"),t.push("editimages")),t.push("refresh"),SyncManager.isAvailable(e,a)&&t.push("sync"),e.CanDownload&&AppInfo.supportsDownloading&&t.push("download"),LibraryBrowser.canShare(e,a)&&t.push("share"),("Movie"==e.Type||"Trailer"==e.Type||"Series"==e.Type||"Game"==e.Type||"BoxSet"==e.Type||"Person"==e.Type||"Book"==e.Type||"MusicAlbum"==e.Type||"MusicArtist"==e.Type)&&t.push("identify"),t},refreshItem:function(e){ApiClient.refreshItem(e,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!0}),Dashboard.alert(Globalize.translate("MessageRefreshQueued"))},deleteItem:function(e){setTimeout(function(){var a=Globalize.translate("ConfirmDeleteItem");Dashboard.confirm(a,Globalize.translate("HeaderDeleteItem"),function(a){a&&(ApiClient.deleteItem(e),Events.trigger(LibraryBrowser,"itemdeleting",[e]))})},250)},editImages:function(e){require(["components/imageeditor/imageeditor"],function(){ImageEditor.show(e)})},editSubtitles:function(e){require(["components/subtitleeditor/subtitleeditor"],function(){SubtitleEditor.show(e)})},editMetadata:function(e){Dashboard.navigate("edititemmetadata.html?id="+e)},showMoreCommands:function(a,t,r){var i=[];-1!=r.indexOf("addtocollection")&&i.push({name:Globalize.translate("ButtonAddToCollection"),id:"addtocollection",ironIcon:"add"}),-1!=r.indexOf("playlist")&&i.push({name:Globalize.translate("ButtonAddToPlaylist"),id:"playlist",ironIcon:"playlist-add"}),-1!=r.indexOf("delete")&&i.push({name:Globalize.translate("ButtonDelete"),id:"delete",ironIcon:"delete"}),-1!=r.indexOf("download")&&i.push({name:Globalize.translate("ButtonDownload"),id:"download",ironIcon:"file-download"}),-1!=r.indexOf("edit")&&i.push({name:Globalize.translate("ButtonEdit"),id:"edit",ironIcon:"mode-edit"}),-1!=r.indexOf("editimages")&&i.push({name:Globalize.translate("ButtonEditImages"),id:"editimages",ironIcon:"photo"}),-1!=r.indexOf("editsubtitles")&&i.push({name:Globalize.translate("ButtonEditSubtitles"),id:"editsubtitles",ironIcon:"closed-caption"}),-1!=r.indexOf("identify")&&i.push({name:Globalize.translate("ButtonIdentify"),id:"identify",ironIcon:"info"}),-1!=r.indexOf("refresh")&&i.push({name:Globalize.translate("ButtonRefresh"),id:"refresh",ironIcon:"refresh"}),-1!=r.indexOf("share")&&i.push({name:Globalize.translate("ButtonShare"),id:"share",ironIcon:"share"}),require(["actionsheet"],function(){ActionSheetElement.show({items:i,positionTo:a,callback:function(a){switch(a){case"share":require(["sharingmanager"],function(){SharingManager.showMenu(Dashboard.getCurrentUserId(),t)});break;case"addtocollection":require(["collectioneditor"],function(e){(new e).show([t])});break;case"playlist":PlaylistManager.showPanel([t]);break;case"delete":LibraryBrowser.deleteItem(t);break;case"download":var r=ApiClient.getUrl("Items/"+t+"/Download",{api_key:ApiClient.accessToken()});e.location.href=r;break;case"edit":LibraryBrowser.editMetadata(t);break;case"editsubtitles":LibraryBrowser.editSubtitles(t);break;case"editimages":LibraryBrowser.editImages(t);break;case"identify":LibraryBrowser.identifyItem(t);break;case"refresh":ApiClient.refreshItem(t,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!0})}}})})},identifyItem:function(e){require(["components/itemidentifier/itemidentifier"],function(){ItemIdentifier.show(e)})},getHref:function(e,a,t){var r=LibraryBrowser.getHrefInternal(e,a);return"tv"==a&&(t||(t=LibraryMenu.getTopParentId()),t&&(r+=-1==r.indexOf("?")?"?topParentId=":"&topParentId=",r+=t)),r},getHrefInternal:function(e,a){if(!e)throw new Error("item cannot be null");if(e.url)return e.url;var t=e.Id||e.ItemId;if("livetv"==e.CollectionType)return"livetv.html";if("channels"==e.CollectionType)return"channels.html";if("folders"!=a){if("movies"==e.CollectionType)return"movies.html?topParentId="+e.Id;if("boxsets"==e.CollectionType)return"collections.html?topParentId="+e.Id;if("tvshows"==e.CollectionType)return"tv.html?topParentId="+e.Id;if("music"==e.CollectionType)return"music.html?topParentId="+e.Id;if("games"==e.CollectionType)return"gamesrecommended.html?topParentId="+e.Id;if("playlists"==e.CollectionType)return"playlists.html?topParentId="+e.Id;if("photos"==e.CollectionType)return"photos.html?topParentId="+e.Id}if("CollectionFolder"==e.Type)return"itemlist.html?topParentId="+e.Id+"&parentid="+e.Id;if("PhotoAlbum"==e.Type)return"itemlist.html?context=photos&parentId="+t;if("Playlist"==e.Type)return"itemdetails.html?id="+t;if("TvChannel"==e.Type)return"itemdetails.html?id="+t;if("Channel"==e.Type)return"channelitems.html?id="+t;if("ChannelFolderItem"==e.Type)return"channelitems.html?id="+e.ChannelId+"&folderId="+e.Id;if("Program"==e.Type)return"itemdetails.html?id="+t;if("BoxSet"==e.Type)return"itemdetails.html?id="+t;if("MusicAlbum"==e.Type)return"itemdetails.html?id="+t;if("GameSystem"==e.Type)return"itemdetails.html?id="+t;if("Genre"==e.Type)return"itemdetails.html?id="+t;if("MusicGenre"==e.Type)return"itemdetails.html?id="+t;if("GameGenre"==e.Type)return"itemdetails.html?id="+t;if("Studio"==e.Type)return"itemdetails.html?id="+t;if("Person"==e.Type)return"itemdetails.html?id="+t;if("Recording"==e.Type)return"itemdetails.html?id="+t;if("MusicArtist"==e.Type)return"itemdetails.html?id="+t;var r=a?"&context="+a:"";return"Series"==e.Type||"Season"==e.Type||"Episode"==e.Type?"itemdetails.html?id="+t+r:e.IsFolder?t?"itemlist.html?parentId="+t:"#":"itemdetails.html?id="+t},getImageUrl:function(e,a,t,r){return r=r||{},r.type=a,r.index=t,r.tag="Backdrop"==a?e.BackdropImageTags[t]:"Screenshot"==a?e.ScreenshotImageTags[t]:"Primary"==a?e.PrimaryImageTag||e.ImageTags[a]:e.ImageTags[a],ApiClient.getScaledImageUrl(e.Id||e.ItemId,r)},getListViewIndex:function(e,a){if("disc"==a.index)return null==e.ParentIndexNumber?"":Globalize.translate("ValueDiscNumber",e.ParentIndexNumber);var t,r,i=(a.sortBy||"").toLowerCase();return 0==i.indexOf("sortname")?"Episode"==e.Type?"":(r=(e.SortName||e.Name||"?")[0].toUpperCase(),t=r.charCodeAt(0),65>t||t>90?"#":r.toUpperCase()):0==i.indexOf("officialrating")?e.OfficialRating||Globalize.translate("HeaderUnrated"):0==i.indexOf("communityrating")?null==e.CommunityRating?Globalize.translate("HeaderUnrated"):Math.floor(e.CommunityRating):0==i.indexOf("criticrating")?null==e.CriticRating?Globalize.translate("HeaderUnrated"):Math.floor(e.CriticRating):0==i.indexOf("metascore")?null==e.Metascore?Globalize.translate("HeaderUnrated"):Math.floor(e.Metascore):0==i.indexOf("albumartist")&&e.AlbumArtist?(r=e.AlbumArtist[0].toUpperCase(),t=r.charCodeAt(0),65>t||t>90?"#":r.toUpperCase()):""},getUserDataCssClass:function(e){return e?"libraryItemUserData"+e.replace(new RegExp(" ","g"),""):""},getListViewHtml:function(e){var a="";e.title&&(a+="<h1>",a+=e.title,a+="</h1>"),a+='<div class="paperList itemsListview">';var t=0,r="";return a+=e.items.map(function(i){var n="";if(e.showIndex!==!1){var o=LibraryBrowser.getListViewIndex(i,e);o!=r&&(a+="</div>",n+=0==t?"<h1>":'<h1 style="margin-top:2em;">',n+=o,n+="</h1>",n+='<div class="paperList itemsListview">',r=o)}var s=LibraryBrowser.getItemDataAttributes(i,e,t),l="listItem",d=LibraryBrowser.getHref(i,e.context);n+='<paper-icon-item class="'+l+'"'+s+' data-itemid="'+i.Id+'" data-playlistitemid="'+(i.PlaylistItemId||"")+'" data-href="'+d+'" data-icon="false">';var u,m=e.smallIcon?70:80,c="Episode"==i.Type||"Game"==i.Type||e.smallIcon?2:1.5;if(i.ImageTags.Primary?u=ApiClient.getScaledImageUrl(i.Id,{maxWidth:m,tag:i.ImageTags.Primary,type:"Primary",index:0,minScale:c}):i.AlbumId&&i.AlbumPrimaryImageTag?u=ApiClient.getScaledImageUrl(i.AlbumId,{type:"Primary",maxWidth:m,tag:i.AlbumPrimaryImageTag,minScale:c}):i.AlbumId&&i.SeriesPrimaryImageTag?u=ApiClient.getScaledImageUrl(i.SeriesId,{type:"Primary",maxWidth:m,tag:i.SeriesPrimaryImageTag,minScale:c}):i.ParentPrimaryImageTag&&(u=ApiClient.getImageUrl(i.ParentPrimaryImageItemId,{type:"Primary",maxWidth:m,tag:i.ParentPrimaryImageTag,minScale:c})),u){var p=16;n+=e.smallIcon?p>t?'<div class="listviewImage small" style="background-image:url(\''+u+"');\" item-icon></div>":'<div class="listviewImage lazy small" data-src="'+u+'" item-icon></div>':p>t?'<div class="listviewImage" style="background-image:url(\''+u+"');\" item-icon></div>":'<div class="listviewImage lazy" data-src="'+u+'" item-icon></div>'}else n+=e.smallIcon?'<div class="listviewImage small" item-icon></div>':'<div class="listviewImage" item-icon></div>';var g=[];"Episode"==i.Type?g.push(i.SeriesName||"&nbsp;"):"MusicAlbum"==i.Type&&g.push(i.AlbumArtist||"&nbsp;");var h=LibraryBrowser.getPosterViewDisplayName(i);e.showIndexNumber&&null!=i.IndexNumber&&(h=i.IndexNumber+". "+h),g.push(h),"Audio"==i.Type&&g.push(i.ArtistItems.map(function(e){return e.Name}).join(", ")||"&nbsp;"),"Game"==i.Type?g.push(i.GameSystem||"&nbsp;"):"MusicGenre"==i.Type?g.push("&nbsp;"):"MusicArtist"==i.Type?g.push("&nbsp;"):"TvChannel"==i.Type?i.CurrentProgram&&g.push(LibraryBrowser.getPosterViewDisplayName(i.CurrentProgram)):g.push(LibraryBrowser.getMiscInfoHtml(i)),n+=g.length>2?"<paper-item-body three-line>":"<paper-item-body two-line>";var b=e.defaultAction;("play"==b||"playallfromhere"==b)&&"Full"!=i.PlayAccess&&(b=null);var y=b?' data-action="'+b+'" class="itemWithAction mediaItem clearLink"':' class="mediaItem clearLink"';n+="<a"+y+' href="'+d+'">';for(var f=0,I=g.length;I>f;f++)n+=0==f?"<div>":"<div secondary>",n+=g[f]||"&nbsp;",n+="</div>";return n+="</a>",n+="</paper-item-body>",n+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="listviewMenuButton"></paper-icon-button>',n+='<span class="listViewUserDataButtons">',n+=LibraryBrowser.getUserDataIconsHtml(i),n+="</span>",n+="</paper-icon-item>",t++,n}).join(""),a+="</div>"},getItemDataAttributes:function(e,a,t){var r=[],i=LibraryBrowser.getItemCommands(e,a);r.push('data-itemid="'+e.Id+'"'),r.push('data-commands="'+i.join(",")+'"'),a.context&&r.push('data-context="'+(a.context||"")+'"'),r.push('data-itemtype="'+e.Type+'"'),e.MediaType&&r.push('data-mediatype="'+(e.MediaType||"")+'"'),e.UserData.PlaybackPositionTicks&&r.push('data-positionticks="'+(e.UserData.PlaybackPositionTicks||0)+'"'),r.push('data-playaccess="'+(e.PlayAccess||"")+'"'),r.push('data-locationtype="'+(e.LocationType||"")+'"'),r.push('data-index="'+t+'"'),e.AlbumId&&r.push('data-albumid="'+e.AlbumId+'"'),e.ChannelId&&r.push('data-channelid="'+e.ChannelId+'"'),e.ArtistItems&&e.ArtistItems.length&&r.push('data-artistid="'+e.ArtistItems[0].Id+'"');var n=r.join(" ");return n&&(n=" "+n),n},supportsAddingToCollection:function(e){var a=["Person","Genre","MusicGenre","Studio","GameGenre","BoxSet","Playlist","UserView","CollectionFolder","Audio","Episode","TvChannel","Program","MusicAlbum"];return!e.CollectionType&&-1==a.indexOf(e.Type)&&"Photo"!=e.MediaType},getItemCommands:function(e,a){var t=[];return LibraryBrowser.supportsEditing(e.Type)&&t.push("edit"),e.LocalTrailerCount&&t.push("trailer"),("Audio"==e.MediaType||"MusicAlbum"==e.Type||"MusicArtist"==e.Type||"MusicGenre"==e.Type||"music"==e.CollectionType)&&t.push("instantmix"),(e.IsFolder||"MusicArtist"==e.Type||"MusicGenre"==e.Type)&&t.push("shuffle"),PlaylistManager.supportsPlaylists(e)&&t.push(a.showRemoveFromPlaylist?"removefromplaylist":"playlist"),a.showAddToCollection!==!1&&LibraryBrowser.supportsAddingToCollection(e)&&t.push("addtocollection"),a.showRemoveFromCollection&&t.push("removefromcollection"),a.playFromHere&&(t.push("playfromhere"),t.push("queuefromhere")),("Playlist"==e.Type||"BoxSet"==e.Type)&&e.CanDelete&&t.push("delete"),SyncManager.isAvailable(e)&&t.push("sync"),"Program"!=e.Type||e.TimerId||e.SeriesTimerId||t.push("record"),"Video"==e.MediaType&&"TvChannel"!=e.Type&&"Program"!=e.Type&&"Virtual"!=e.LocationType&&t.push("editsubtitles"),t.push("editimages"),t},screenWidth:function(){var a=$(e).width();return a},shapes:["square","portrait","banner","smallBackdrop","homePageSmallBackdrop","backdrop","overflowBackdrop","overflowPortrait","overflowSquare"],getPostersPerRow:function(e){function t(t){var i=$('<div class="card '+t+'Card"><div class="cardBox"><div class="cardImage"></div></div></div>').appendTo(a.body),n=$(".cardImage",i).innerWidth();(!n||isNaN(n))&&(r=!1,n=Math.min(400,e/2));var o=e/n;return i.remove(),Math.floor(o)}for(var r=!0,i={},n=0,o=LibraryBrowser.shapes.length;o>n;n++){var s=LibraryBrowser.shapes[n];i[s]=t(s)}return i.cache=r,i},posterSizes:[],getPosterViewInfo:function(){for(var e=LibraryBrowser.screenWidth(),a=LibraryBrowser.posterSizes,t=0,r=a.length;r>t;t++)if(a[t].screenWidth==e)return a[t];var i=LibraryBrowser.getPosterViewInfoInternal(e);return i.screenWidth=e,i.cache&&a.push(i),i},getPosterViewInfoInternal:function(e){var a=LibraryBrowser.getPostersPerRow(e),t={};t.screenWidth=e,AppInfo.hasLowImageBandwidth||(e*=1.2);for(var r=100,i=0,n=LibraryBrowser.shapes.length;n>i;i++){var o=LibraryBrowser.shapes[i],s=e/a[o];browserInfo.mobile||(s=Math.round(s/r)*r),t[o+"Width"]=Math.round(s)}return t.cache=a.cache,t},getPosterViewHtml:function(e){var a,t=e.items;e.shape=e.shape||"portrait";var r="",i=LibraryBrowser.getAveragePrimaryImageAspectRatio(t),n=i&&Math.abs(i-1.777777778)<.3,o=i&&Math.abs(i-1)<.33||i&&Math.abs(i-1.3333334)<.01;("auto"==e.shape||"autohome"==e.shape)&&(n?e.shape="auto"==e.shape?"backdrop":"backdrop":o?(e.coverImage=!0,e.shape="square"):i&&i>1.9?(e.shape="banner",e.coverImage=!0):e.shape=i&&Math.abs(i-.6666667)<.2?"auto"==e.shape?"portrait":"portrait":e.defaultShape||("auto"==e.shape?"square":"square"));var s=LibraryBrowser.getPosterViewInfo(),l=s.backdropWidth,d=s.portraitWidth,u=s.squareWidth,m=s.bannerWidth;n?d=l:o&&(d=u),"overflowBackdrop"==e.shape?l=s.overflowBackdropWidth:"overflowPortrait"==e.shape?d=s.overflowPortraitWidth:"overflowSquare"==e.shape?u=s.overflowSquareWidth:"smallBackdrop"==e.shape?l=s.smallBackdropWidth:"homePageSmallBackdrop"==e.shape?(l=s.homePageSmallBackdropWidth,d=s.homePageSmallBackdropWidth):"detailPagePortrait"==e.shape?d=200:"detailPageSquare"==e.shape?(d=240,u=240):"detailPage169"==e.shape&&(d=320,l=320);for(var c,p=0,g=t.length;g>p;p++){var h=t[p];if(c=null,i=LibraryBrowser.getAveragePrimaryImageAspectRatio([h]),e.showStartDateIndex){if(h.StartDate)try{c=LibraryBrowser.getFutureDateText(parseISO8601Date(h.StartDate,{toLocal:!0}),!0)}catch(b){}var y=c||Globalize.translate("HeaderUnknownDate");y!=a&&(r+='<h1 class="timelineHeader" style="text-align:center;">'+y+"</h1>",a=y)}else if(e.timeline){var f=h.ProductionYear||Globalize.translate("HeaderUnknownYear");f!=a&&(r+='<h1 class="timelineHeader">'+f+"</h1>",a=f)}r+=LibraryBrowser.getPosterViewItemHtml(h,p,e,i,l,d,u,m)}return r},getPosterViewItemHtml:function(e,a,t,r,i,n,o,s){var l,d="",u=null,m=null,c=null,p=!1,g=t.enableImageEnhancers!==!1,h="card";t.fullWidthOnMobile&&(h+=" fullWidthCardOnMobile");var b="auto"==t.showTitle?!0:t.showTitle,y=t.coverImage;t.autoThumb&&e.ImageTags&&e.ImageTags.Primary&&e.PrimaryImageAspectRatio&&e.PrimaryImageAspectRatio>=1.34?(m=n,c=r?Math.round(n/r):null,u=ApiClient.getImageUrl(e.Id,{type:"Primary",maxHeight:c,maxWidth:m,tag:e.ImageTags.Primary,enableImageEnhancers:g}),null!=c&&(y=!0)):t.autoThumb&&e.ImageTags&&e.ImageTags.Thumb?u=ApiClient.getScaledImageUrl(e.Id,{type:"Thumb",maxWidth:i,tag:e.ImageTags.Thumb,enableImageEnhancers:g}):t.preferBackdrop&&e.BackdropImageTags&&e.BackdropImageTags.length?u=ApiClient.getScaledImageUrl(e.Id,{type:"Backdrop",maxWidth:i,tag:e.BackdropImageTags[0],enableImageEnhancers:g}):t.preferThumb&&e.ImageTags&&e.ImageTags.Thumb?u=ApiClient.getScaledImageUrl(e.Id,{type:"Thumb",maxWidth:i,tag:e.ImageTags.Thumb,enableImageEnhancers:g}):t.preferBanner&&e.ImageTags&&e.ImageTags.Banner?u=ApiClient.getScaledImageUrl(e.Id,{type:"Banner",maxWidth:s,tag:e.ImageTags.Banner,enableImageEnhancers:g}):t.preferThumb&&e.SeriesThumbImageTag&&t.inheritThumb!==!1?u=ApiClient.getScaledImageUrl(e.SeriesId,{type:"Thumb",maxWidth:i,tag:e.SeriesThumbImageTag,enableImageEnhancers:g}):t.preferThumb&&e.ParentThumbItemId&&t.inheritThumb!==!1?u=ApiClient.getThumbImageUrl(e.ParentThumbItemId,{type:"Thumb",maxWidth:i,enableImageEnhancers:g}):t.preferThumb&&e.BackdropImageTags&&e.BackdropImageTags.length?(u=ApiClient.getScaledImageUrl(e.Id,{type:"Backdrop",maxWidth:i,tag:e.BackdropImageTags[0],enableImageEnhancers:g}),p=!0):e.ImageTags&&e.ImageTags.Primary?(m=n,c=r?Math.round(n/r):null,u=ApiClient.getImageUrl(e.Id,{type:"Primary",maxHeight:c,maxWidth:m,tag:e.ImageTags.Primary,enableImageEnhancers:g}),null!=c&&(y=!0)):e.ParentPrimaryImageTag?u=ApiClient.getImageUrl(e.ParentPrimaryImageItemId,{type:"Primary",maxWidth:n,tag:e.ParentPrimaryImageTag,enableImageEnhancers:g}):e.AlbumId&&e.AlbumPrimaryImageTag?(c=o,m=r?Math.round(c*r):null,u=ApiClient.getScaledImageUrl(e.AlbumId,{type:"Primary",maxHeight:c,maxWidth:m,tag:e.AlbumPrimaryImageTag,enableImageEnhancers:g}),null!=m&&(y=!0)):"Season"==e.Type&&e.ImageTags&&e.ImageTags.Thumb?u=ApiClient.getScaledImageUrl(e.Id,{type:"Thumb",maxWidth:i,tag:e.ImageTags.Thumb,enableImageEnhancers:g}):e.BackdropImageTags&&e.BackdropImageTags.length?u=ApiClient.getScaledImageUrl(e.Id,{type:"Backdrop",maxWidth:i,tag:e.BackdropImageTags[0],enableImageEnhancers:g}):e.ImageTags&&e.ImageTags.Thumb?u=ApiClient.getScaledImageUrl(e.Id,{type:"Thumb",maxWidth:i,tag:e.ImageTags.Thumb,enableImageEnhancers:g}):e.SeriesThumbImageTag?u=ApiClient.getScaledImageUrl(e.SeriesId,{type:"Thumb",maxWidth:i,tag:e.SeriesThumbImageTag,enableImageEnhancers:g}):e.ParentThumbItemId?u=ApiClient.getThumbImageUrl(e,{type:"Thumb",maxWidth:i,enableImageEnhancers:g}):"Audio"==e.MediaType||"MusicAlbum"==e.Type||"MusicArtist"==e.Type?(e.Name&&b&&(l="library-music"),h+=" defaultBackground"):"Recording"==e.Type||"Program"==e.Type||"TvChannel"==e.Type?(e.Name&&b&&(l="folder-open"),h+=" defaultBackground"):"Video"==e.MediaType||"Season"==e.Type||"Series"==e.Type?(e.Name&&b&&(l="videocam"),h+=" defaultBackground"):"Person"==e.Type?(e.Name&&b&&(l="person"),h+=" defaultBackground"):(e.Name&&b&&(l="folder-open"),h+=" defaultBackground"),l=e.icon||l,h+=" "+t.shape+"Card";var f=e.MediaSourceCount||1,I=t.linkItem===!1?"#":LibraryBrowser.getHref(e,t.context);t.showChildCountIndicator&&e.ChildCount&&t.showLatestItemsPopup!==!1&&(h+=" groupedCard"),!b&&!t.showItemCounts||t.overlayText||(h+=" bottomPaddedCard");var v=LibraryBrowser.getItemDataAttributes(e,t,a),T=t.defaultAction;("play"==T||"playallfromhere"==T)&&"Full"!=e.PlayAccess&&(T=null);var P=T?' data-action="'+T+'"':"";d+="<div"+v+' class="'+h+'">';var w="";u&&!t.lazy&&(w+="background-image:url('"+u+"');");var C="cardImage";l&&(C+=" iconCardImage"),y&&(C+=" coveredCardImage"),t.centerImage&&(C+=" centeredCardImage");var S="";t.lazy&&u&&(C+=" lazy",S=' data-src="'+u+'"');var A="cardBox";t.cardLayout&&(A+=" visualCardBox"),d+='<div class="'+A+'">',d+='<div class="cardScalable">',d+='<div class="cardPadder"></div>';var B="cardContent";B+=" mediaItem",t.defaultAction&&(B+=" itemWithAction");var L=t.transition!==!1&&AppInfo.enableSectionTransitions?' data-transition="slide"':"",k=e.onclick?' onclick="'+e.onclick+'"':"";d+="<a"+k+L+' class="'+B+'" href="'+I+'"'+P+">",d+='<div class="'+C+'" style="'+w+'"'+S+">",l&&(d+='<iron-icon icon="'+l+'"></iron-icon>'),d+="</div>",d+='<div class="cardOverlayTarget"></div>',"Virtual"==e.LocationType||"Offline"==e.LocationType?t.showLocationTypeIndicator!==!1&&(d+=LibraryBrowser.getOfflineIndicatorHtml(e)):t.showUnplayedIndicator!==!1?d+=LibraryBrowser.getPlayedIndicatorHtml(e):t.showChildCountIndicator&&(d+=LibraryBrowser.getGroupCountIndicator(e)),d+=LibraryBrowser.getSyncIndicator(e),f>1&&(d+='<div class="mediaSourceIndicator">'+f+"</div>");var x=t.showProgress===!1||e.IsFolder?"":LibraryBrowser.getItemProgressBarHtml("Recording"==e.Type?e:e.UserData),D=!1;if(t.overlayText||p&&!b){var M=x?"cardFooter fullCardFooter":"cardFooter";d+=LibraryBrowser.getCardFooterText(e,t,b,u,p,M,x),D=!0}else x&&(d+='<div class="cardFooter fullCardFooter lightCardFooter">',d+="<div class='cardProgress cardText'>",d+=x,d+="</div>",d+="</div>",x="");return d+="</a>",!t.overlayPlayButton||e.IsPlaceHolder||"Virtual"==e.LocationType&&e.MediaType&&"Program"!=e.Type||(d+='<paper-icon-button icon="play-arrow" class="cardOverlayPlayButton" onclick="return false;"></paper-icon-button>'),t.overlayMoreButton&&(d+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="cardOverlayMoreButton" onclick="return false;"></paper-icon-button>'),d+="</div>",t.overlayText||D||(d+=LibraryBrowser.getCardFooterText(e,t,b,u,p,"cardFooter outerCardFooter",x)),d+="</div>",d+="</div>"},getCardFooterText:function(e,a,t,i,n,o,s){var l="";l+='<div class="'+o+'">',a.cardLayout&&(l+='<div class="cardButtonContainer">',l+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="listviewMenuButton btnCardOptions"></paper-icon-button>',l+="</div>");var d="auto"!=a.showTitle||e.IsFolder||"Photo"!=e.MediaType?LibraryBrowser.getPosterViewDisplayName(e,a.displayAsSpecial):"";i||t||(l+="<div class='cardDefaultText'>",l+=r(d),l+="</div>");var u=a.centerText?"cardText cardTextCentered":"cardText",m=[];if(a.showParentTitle&&m.push(e.EpisodeTitle?e.Name:e.SeriesName||e.Album||e.AlbumArtist||e.GameSystem||""),(t||n)&&m.push(r(d)),a.showItemCounts){var c=LibraryBrowser.getItemCountsHtml(a,e);m.push(c)}if(a.textLines)for(var p=a.textLines(e),g=0,h=p.length;h>g;g++)m.push(p[g]);if(a.showSongCount){var b="";e.SongCount&&(b=1==e.SongCount?Globalize.translate("ValueOneSong"):Globalize.translate("ValueSongCount",e.SongCount)),m.push(b)}if(a.showPremiereDate)if(e.PremiereDate)try{m.push(LibraryBrowser.getPremiereDateText(e))
}catch(y){m.push("")}else m.push("");if(a.showYear&&m.push(e.ProductionYear||""),a.showSeriesYear&&m.push("Continuing"==e.Status?Globalize.translate("ValueSeriesYearToPresent",e.ProductionYear||""):e.ProductionYear||""),a.showProgramAirInfo){var f=parseISO8601Date(e.StartDate,{toLocal:!0}),I=e.StartDate?f.toLocaleString():"";m.push(I||"&nbsp;"),m.push(e.ChannelName||"&nbsp;")}return l+=LibraryBrowser.getCardTextLines(m,u,!a.overlayText),a.overlayText&&s&&(l+="<div class='cardText cardProgress'>",l+=s,l+="</div>"),l+="</div>"},getListItemInfo:function(e){for(var a=e;!a.getAttribute("data-itemid");)a=a.parentNode;var t=a.getAttribute("data-itemid"),r=a.getAttribute("data-index"),i=a.getAttribute("data-mediatype");return{id:t,index:r,mediaType:i,context:a.getAttribute("data-context")}},getCardTextLines:function(e,a,t){var r,i,n="",o=0;for(r=0,i=e.length;i>r;r++){var s=e[r];s&&(n+="<div class='"+a+"'>",n+=s,n+="</div>",o++)}if(t)for(;i>o;)n+="<div class='"+a+"'>&nbsp;</div>",o++;return n},getFutureDateText:function(e){var a=[];a[0]=Globalize.translate("OptionSunday"),a[1]=Globalize.translate("OptionMonday"),a[2]=Globalize.translate("OptionTuesday"),a[3]=Globalize.translate("OptionWednesday"),a[4]=Globalize.translate("OptionThursday"),a[5]=Globalize.translate("OptionFriday"),a[6]=Globalize.translate("OptionSaturday");var t=a[e.getDay()];return e=e.toLocaleDateString(),-1==e.toLowerCase().indexOf(t.toLowerCase())?t+" "+e:e},getPremiereDateText:function(e,a){if(!a){var t="";return e.AirTime&&(t+=e.AirTime),e.SeriesStudio&&(t+=t?" on "+e.SeriesStudio:e.SeriesStudio),t}var r=LibraryBrowser.getFutureDateText(a);return e.AirTime&&(r+=" at "+e.AirTime),e.SeriesStudio&&(r+=" on "+e.SeriesStudio),r},getPosterViewDisplayName:function(e,a,t){if(!e)throw new Error("null item passed into getPosterViewDisplayName");var r=e.EpisodeTitle||e.Name||"";if("TvChannel"==e.Type)return e.Number?e.Number+" "+r:r;if(a&&"Episode"==e.Type&&0==e.ParentIndexNumber)r=Globalize.translate("ValueSpecialEpisodeName",r);else if("Episode"==e.Type&&null!=e.IndexNumber&&null!=e.ParentIndexNumber){var i=e.IndexNumber,n="E"+i;t!==!1&&(n="S"+e.ParentIndexNumber+", "+n),e.IndexNumberEnd&&(i=e.IndexNumberEnd,n+="-"+i),r=n+" - "+r}return r},getOfflineIndicatorHtml:function(e){if("Offline"==e.LocationType)return'<div class="posterRibbon offlinePosterRibbon">'+Globalize.translate("HeaderOffline")+"</div>";if("Episode"==e.Type){try{var a=parseISO8601Date(e.PremiereDate,{toLocal:!0});if(e.PremiereDate&&(new Date).getTime()<a.getTime())return'<div class="posterRibbon unairedPosterRibbon">'+Globalize.translate("HeaderUnaired")+"</div>"}catch(t){}return'<div class="posterRibbon missingPosterRibbon">'+Globalize.translate("HeaderMissing")+"</div>"}return""},getPlayedIndicatorHtml:function(e){if("Series"==e.Type||"Season"==e.Type||"BoxSet"==e.Type||"Video"==e.MediaType||"Game"==e.MediaType||"Book"==e.MediaType){if(e.UserData.UnplayedItemCount)return'<div class="playedIndicator">'+e.UserData.UnplayedItemCount+"</div>";if("TvChannel"!=e.Type&&(e.UserData.PlayedPercentage&&e.UserData.PlayedPercentage>=100||e.UserData&&e.UserData.Played))return'<div class="playedIndicator"><iron-icon icon="check"></iron-icon></div>'}return""},getGroupCountIndicator:function(e){return e.ChildCount?'<div class="playedIndicator">'+e.ChildCount+"</div>":""},getSyncIndicator:function(e){if("Synced"==e.SyncStatus)return'<div class="syncIndicator"><iron-icon icon="sync"></iron-icon></div>';var a=e.SyncPercent;return a?'<div class="syncIndicator"><iron-icon icon="sync"></iron-icon></div>':"Queued"==e.SyncStatus||"Converting"==e.SyncStatus||"ReadyToTransfer"==e.SyncStatus||"Transferring"==e.SyncStatus?'<div class="syncIndicator"><iron-icon icon="sync"></iron-icon></div>':""},getAveragePrimaryImageAspectRatio:function(e){for(var a=[],t=0,r=e.length;r>t;t++){var i=e[t].PrimaryImageAspectRatio||0;i&&(a[a.length]=i)}if(!a.length)return null;a.sort(function(e,a){return e-a});var n,o=Math.floor(a.length/2);return n=a.length%2?a[o]:(a[o-1]+a[o])/2,Math.abs(.66666666667-n)<=.15?.66666666667:Math.abs(1.777777778-n)<=.2?1.777777778:Math.abs(1-n)<=.15?1:Math.abs(1.33333333333-n)<=.15?1.33333333333:n},metroColors:["#6FBD45","#4BB3DD","#4164A5","#E12026","#800080","#E1B222","#008040","#0094FF","#FF00C7","#FF870F","#7F0037"],getRandomMetroColor:function(){var e=Math.floor(Math.random()*(LibraryBrowser.metroColors.length-1));return LibraryBrowser.metroColors[e]},getMetroColor:function(e){if(e){for(var a=String(e.substr(0,1).charCodeAt()),t=0,r=0;r<a.length;r++)t+=parseInt(a.charAt(r));var i=String(t).substr(-1);return LibraryBrowser.metroColors[i]}return LibraryBrowser.getRandomMetroColor()},renderName:function(e,a,t,r){var i=LibraryBrowser.getPosterViewDisplayName(e,!1,!1);Dashboard.setPageTitle(i),t?a.html('<a class="detailPageParentLink" href="'+LibraryBrowser.getHref(e,r)+'">'+i+"</a>").trigger("create"):a.html(i)},renderParentName:function(e,a,t){var r=[],i=t?"&context="+t:"";e.AlbumArtists?r.push(LibraryBrowser.getArtistLinksHtml(e.AlbumArtists,"detailPageParentLink")):e.ArtistItems&&e.ArtistItems.length&&"MusicVideo"==e.Type?r.push(LibraryBrowser.getArtistLinksHtml(e.ArtistItems,"detailPageParentLink")):e.SeriesName&&"Episode"==e.Type&&r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.SeriesId+i+'">'+e.SeriesName+"</a>"),e.SeriesName&&"Season"==e.Type?r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.SeriesId+i+'">'+e.SeriesName+"</a>"):null!=e.ParentIndexNumber&&"Episode"==e.Type?r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.SeasonId+i+'">'+e.SeasonName+"</a>"):e.Album&&"Audio"==e.Type&&(e.AlbumId||e.ParentId)?r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+(e.AlbumId||e.ParentId)+i+'">'+e.Album+"</a>"):e.Album&&"MusicVideo"==e.Type&&e.AlbumId?r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.AlbumId+i+'">'+e.Album+"</a>"):e.Album?r.push(e.Album):"Program"==e.Type&&e.EpisodeTitle&&r.push(e.Name),r.length?a.show().html(r.join(" - ")).trigger("create"):a.hide()},renderLinks:function(e,a){var t=[];if(a.HomePageUrl&&t.push('<a class="textlink" href="'+a.HomePageUrl+'" target="_blank">'+Globalize.translate("ButtonWebsite")+"</a>"),a.ExternalUrls)for(var r=0,i=a.ExternalUrls.length;i>r;r++){var n=a.ExternalUrls[r];t.push('<a class="textlink" href="'+n.Url+'" target="_blank">'+n.Name+"</a>")}if(t.length){var o=t.join("&nbsp;&nbsp;/&nbsp;&nbsp;");o=Globalize.translate("ValueLinks",o),e.innerHTML=o,$(e).trigger("create"),$(e).show()}else $(e).hide()},getDefaultPageSizeSelections:function(){return[20,50,100,200,300,400,500]},showLayoutMenu:function(e,a){var t=e.getAttribute("data-layouts");t=t?t.split(","):["List","Poster","PosterCard","Thumb","ThumbCard"];var r=t.map(function(e){return{name:Globalize.translate("Option"+e),id:e,ironIcon:a==e?"check":null}});require(["actionsheet"],function(){ActionSheetElement.show({items:r,positionTo:e,callback:function(a){$(e).trigger("layoutchange",[a])}})})},openViewPanel:function(e,a){$("."+a,jQuery(e).parents(".page")).removeClass("hide").panel("toggle")},getQueryPagingHtml:function(e){var a=e.startIndex,t=e.limit,r=e.totalRecordCount;if(t&&e.updatePageSizeSetting!==!1)try{appStorage.setItem(e.pageSizeKey||o,t)}catch(i){}var n="",s=Math.min(a+t,r),l=r>20||r>t;if(n+='<div class="listPaging">',l){n+='<span style="vertical-align:middle;">';var d=r?a+1:0;n+=d+"-"+s+" of "+r,n+="</span>"}if(l||e.viewButton||e.sortButton||e.addLayoutButton){if(n+='<div style="display:inline-block;margin-left:10px;">',l&&(n+='<paper-icon-button class="btnPreviousPage" icon="arrow-back" '+(a?"":"disabled")+"></paper-icon-button>",n+='<paper-icon-button class="btnNextPage" icon="arrow-forward" '+(a+t>=r?"disabled":"")+"></paper-icon-button>"),e.addLayoutButton&&(n+='<paper-icon-button title="'+Globalize.translate("ButtonSelectView")+'" class="btnChangeLayout" data-layouts="'+(e.layouts||"")+'" onclick="LibraryBrowser.showLayoutMenu(this, \''+(e.currentLayout||"")+'\');" icon="view-comfy"></paper-icon-button>'),e.sortButton&&(n+='<paper-icon-button class="btnSort" title="'+Globalize.translate("ButtonSort")+'" icon="sort-by-alpha"></paper-icon-button>'),e.viewButton){var u=e.viewPanelClass||"viewPanel",m=Globalize.translate("filter-list"==e.viewIcon?"ButtonFilter":"ButtonMenu");n+='<paper-icon-button title="'+m+'" icon="'+(e.viewIcon||AppInfo.moreIcon)+'" onclick="LibraryBrowser.openViewPanel(this, \''+u+"');\"></paper-icon-button>"}if(n+="</div>",l&&e.showLimit){var c="selectPageSize",p=e.pageSizes||LibraryBrowser.getDefaultPageSizeSelections(),g=p.map(function(e){return t==e?'<option value="'+e+'" selected="selected">'+e+"</option>":'<option value="'+e+'">'+e+"</option>"}).join("");n+='<div class="pageSizeContainer"><label style="font-size:inherit;" class="labelPageSize" for="'+c+'">'+Globalize.translate("LabelLimit")+'</label><select style="width:auto;" class="selectPageSize" id="'+c+'" data-inline="true" data-mini="true">'+g+"</select></div>"}}return n+="</div>"},showSortMenu:function(e){require(["paper-dialog","components/paperdialoghelper","paper-radio-button","paper-radio-group","scale-up-animation"],function(){var t=a.createElement("paper-dialog");t.setAttribute("with-backdrop","with-backdrop"),t.setAttribute("role","alertdialog"),t.entryAnimation="fade-in-animation",t.exitAnimation="fade-out-animation",browserInfo.animate&&(t.animationConfig={entry:{name:"scale-up-animation",node:t,timing:{duration:160,easing:"ease-out"}},exit:{name:"fade-out-animation",node:t,timing:{duration:200,easing:"ease-in"}}});var r="",i=!1;browserInfo.android&&(i=!0),r+="<h2>",r+=Globalize.translate("HeaderSortBy"),r+="</h2>",i&&(r+="<paper-dialog-scrollable>"),r+='<paper-radio-group class="groupSortBy" selected="'+(e.query.SortBy||"").replace(",","_")+'">';for(var n=0,o=e.items.length;o>n;n++){var s=e.items[n];r+='<paper-radio-button class="menuSortBy block" data-id="'+s.id+'" name="'+s.id.replace(",","_")+'">'+s.name+"</paper-radio-button>"}r+="</paper-radio-group>",r+="<p>",r+=Globalize.translate("HeaderSortOrder"),r+="</p>",r+='<paper-radio-group class="groupSortOrder" selected="'+(e.query.SortOrder||"Ascending")+'">',r+='<paper-radio-button name="Ascending" class="menuSortOrder block">'+Globalize.translate("OptionAscending")+"</paper-radio-button>",r+='<paper-radio-button name="Descending" class="menuSortOrder block">'+Globalize.translate("OptionDescending")+"</paper-radio-button>",r+="</paper-radio-group>",i&&(r+="</paper-dialog-scrollable>"),r+='<div class="buttons">',r+="<paper-button dialog-dismiss>"+Globalize.translate("ButtonClose")+"</paper-button>",r+="</div>",t.innerHTML=r,a.body.appendChild(t),t.addEventListener("iron-overlay-closed",function(){t.parentNode.removeChild(t)}),PaperDialogHelper.openWithHash(t,"sortmenu"),$(".groupSortBy",t).on("iron-select",function(){e.query.SortBy=this.selected.replace("_",","),e.query.StartIndex=0,e.callback&&e.callback()}),$(".groupSortOrder",t).on("iron-select",function(){e.query.SortOrder=this.selected,e.query.StartIndex=0,e.callback&&e.callback()})})},getRatingHtml:function(e){var a="";return e.CommunityRating&&(a+="<div class='starRating' title='"+e.CommunityRating+"'></div>",a+='<div class="starRatingValue">',a+=e.CommunityRating.toFixed(1),a+="</div>"),null!=e.CriticRating&&(a+=e.CriticRating>=60?'<div class="fresh rottentomatoesicon" title="Rotten Tomatoes"></div>':'<div class="rotten rottentomatoesicon" title="Rotten Tomatoes"></div>',a+='<div class="criticRating" title="Rotten Tomatoes">'+e.CriticRating+"%</div>"),a},getItemProgressBarHtml:function(e){if("Recording"==e.Type&&e.CompletionPercentage)return'<progress class="itemProgressBar recordingProgressBar" min="0" max="100" value="'+e.CompletionPercentage+'"></progress>';var a=e.PlayedPercentage;return a&&100>a?'<progress class="itemProgressBar" min="0" max="100" value="'+a+'"></progress>':null},getUserDataButtonHtml:function(e,a,t,r,i,n){var o="fab"==n?"paper-fab":"paper-icon-button";return"<"+o+' title="'+i+'" data-itemid="'+a+'" icon="'+r+'" class="'+t+'" onclick="LibraryBrowser.'+e+'(this);return false;"></'+o+">"},getUserDataIconsHtml:function(e,a,t){var r="",i=e.UserData||{},n=e.Id;if(a!==!1){var o=Globalize.translate("TooltipPlayed");("Video"==e.MediaType||"Series"==e.Type||"Season"==e.Type||"BoxSet"==e.Type||"Playlist"==e.Type)&&"TvChannel"!=e.Type&&(r+=i.Played?LibraryBrowser.getUserDataButtonHtml("markPlayed",n,"btnUserItemRating btnUserItemRatingOn","check",o,t):LibraryBrowser.getUserDataButtonHtml("markPlayed",n,"btnUserItemRating","check",o,t))}var s=Globalize.translate("TooltipLike"),l=Globalize.translate("TooltipDislike");"undefined"==typeof i.Likes?(r+=LibraryBrowser.getUserDataButtonHtml("markDislike",n,"btnUserItemRating","thumb-down",l,t),r+=LibraryBrowser.getUserDataButtonHtml("markLike",n,"btnUserItemRating","thumb-up",s,t)):i.Likes?(r+=LibraryBrowser.getUserDataButtonHtml("markDislike",n,"btnUserItemRating","thumb-down",l,t),r+=LibraryBrowser.getUserDataButtonHtml("markLike",n,"btnUserItemRating btnUserItemRatingOn","thumb-up",s,t)):(r+=LibraryBrowser.getUserDataButtonHtml("markDislike",n,"btnUserItemRating btnUserItemRatingOn","thumb-down",l,t),r+=LibraryBrowser.getUserDataButtonHtml("markLike",n,"btnUserItemRating","thumb-up",s,t));var d=Globalize.translate("TooltipFavorite");return r+=i.IsFavorite?LibraryBrowser.getUserDataButtonHtml("markFavorite",n,"btnUserItemRating btnUserItemRatingOn","favorite",d,t):LibraryBrowser.getUserDataButtonHtml("markFavorite",n,"btnUserItemRating","favorite",d,t)},markPlayed:function(e){var a=e.getAttribute("data-itemid"),t=!e.classList.contains("btnUserItemRatingOn");t?(ApiClient.markPlayed(Dashboard.getCurrentUserId(),a),e.classList.add("btnUserItemRatingOn")):(ApiClient.markUnplayed(Dashboard.getCurrentUserId(),a),e.classList.remove("btnUserItemRatingOn"))},markFavorite:function(e){var a=e.getAttribute("data-itemid"),t=$(e),r=!t.hasClass("btnUserItemRatingOn");ApiClient.updateFavoriteStatus(Dashboard.getCurrentUserId(),a,r),r?t.addClass("btnUserItemRatingOn"):t.removeClass("btnUserItemRatingOn")},markLike:function(e){var a=e.getAttribute("data-itemid"),t=$(e);t.hasClass("btnUserItemRatingOn")?(ApiClient.clearUserItemRating(Dashboard.getCurrentUserId(),a),t.removeClass("btnUserItemRatingOn")):(ApiClient.updateUserItemRating(Dashboard.getCurrentUserId(),a,!0),t.addClass("btnUserItemRatingOn")),t.prev().removeClass("btnUserItemRatingOn")},markDislike:function(e){var a=e.getAttribute("data-itemid"),t=$(e);t.hasClass("btnUserItemRatingOn")?(ApiClient.clearUserItemRating(Dashboard.getCurrentUserId(),a),t.removeClass("btnUserItemRatingOn")):(ApiClient.updateUserItemRating(Dashboard.getCurrentUserId(),a,!1),t.addClass("btnUserItemRatingOn")),t.next().removeClass("btnUserItemRatingOn")},renderDetailImage:function(e,a,t,r){var i=a.ImageTags||{};a.PrimaryImageTag&&(i.Primary=a.PrimaryImageTag);var n,o="",s="portrait",l=360,d=!1;r&&i.Thumb?(n=ApiClient.getScaledImageUrl(a.Id,{type:"Thumb",maxHeight:l,tag:a.ImageTags.Thumb}),s="thumb"):i.Primary?(n=ApiClient.getScaledImageUrl(a.Id,{type:"Primary",maxHeight:l,tag:a.ImageTags.Primary}),d=!0):a.BackdropImageTags&&a.BackdropImageTags.length?(n=ApiClient.getScaledImageUrl(a.Id,{type:"Backdrop",maxHeight:l,tag:a.BackdropImageTags[0]}),s="thumb"):i.Thumb?(n=ApiClient.getScaledImageUrl(a.Id,{type:"Thumb",maxHeight:l,tag:a.ImageTags.Thumb}),s="thumb"):i.Disc?(n=ApiClient.getScaledImageUrl(a.Id,{type:"Disc",maxHeight:l,tag:a.ImageTags.Disc}),s="square"):a.AlbumId&&a.AlbumPrimaryImageTag?(n=ApiClient.getScaledImageUrl(a.AlbumId,{type:"Primary",maxHeight:l,tag:a.AlbumPrimaryImageTag}),s="square"):"Audio"==a.MediaType||"MusicAlbum"==a.Type||"MusicGenre"==a.Type?(n="css/images/items/detail/audio.png",s="square"):"Game"==a.MediaType||"GameGenre"==a.Type?(n="css/images/items/detail/game.png",s="square"):"Person"==a.Type?(n="css/images/items/detail/person.png",s="square"):"Genre"==a.Type||"Studio"==a.Type?(n="css/images/items/detail/video.png",s="square"):"TvChannel"==a.Type?(n="css/images/items/detail/tv.png",s="square"):(n="css/images/items/detail/video.png",s="square"),o+='<div style="position:relative;">',t&&(o+="<a onclick='LibraryBrowser.editImages(\""+a.Id+"\");' class='itemDetailGalleryLink' href='#'>"),d&&a.PrimaryImageAspectRatio&&(a.PrimaryImageAspectRatio>=1.48?s="thumb":a.PrimaryImageAspectRatio>=.85&&a.PrimaryImageAspectRatio<=1.34&&(s="square")),o+="<img class='itemDetailImage lazy' src='css/images/empty.png' />",t&&(o+="</a>");var u=a.IsFolder||!a.UserData?"":LibraryBrowser.getItemProgressBarHtml("Recording"==a.Type?a:a.UserData);o+='<div class="detailImageProgressContainer">',u&&(o+=u),o+="</div>",o+="</div>",e.innerHTML=o,"thumb"==s?(e.classList.add("thumbDetailImageContainer"),e.classList.remove("portraitDetailImageContainer"),e.classList.remove("squareDetailImageContainer")):"square"==s?(e.classList.remove("thumbDetailImageContainer"),e.classList.remove("portraitDetailImageContainer"),e.classList.add("squareDetailImageContainer")):(e.classList.remove("thumbDetailImageContainer"),e.classList.add("portraitDetailImageContainer"),e.classList.remove("squareDetailImageContainer")),ImageLoader.lazyImage(e.querySelector("img"),n)},refreshDetailImageUserData:function(e,a){var t=a.IsFolder||!a.UserData?"":LibraryBrowser.getItemProgressBarHtml("Recording"==a.Type?a:a.UserData),r=e.querySelector(".detailImageProgressContainer");r.innerHTML=t||""},getDisplayTime:function(e){if("string"===(typeof e).toString().toLowerCase())try{e=parseISO8601Date(e,{toLocal:!0})}catch(a){return e}var t,r=e.toLocaleTimeString().toLowerCase(),i=e.getHours(),n=e.getMinutes();if(-1!=r.indexOf("am")||-1!=r.indexOf("pm")){var o=i>11?"pm":"am";i=i%12||12,t=i,n&&(t+=":",10>n&&(t+="0"),t+=n),t+=o}else t=i+":",10>n&&(t+="0"),t+=n;return t},getMiscInfoHtml:function(e){var a,t,r=[];if(e.IsSeries&&!e.IsRepeat&&(require(["livetvcss"]),r.push('<span class="newTvProgram">'+Globalize.translate("LabelNewProgram")+"</span>")),e.IsLive&&r.push('<span class="liveTvProgram">'+Globalize.translate("LabelLiveProgram")+"</span>"),e.ChannelId&&e.ChannelName&&("Program"==e.Type||"Recording"==e.Type)&&r.push('<a class="textlink" href="itemdetails.html?id='+e.ChannelId+'">'+e.ChannelName+"</a>"),("Episode"==e.Type||"Photo"==e.MediaType)&&e.PremiereDate)try{t=parseISO8601Date(e.PremiereDate,{toLocal:!0}),a=t.toLocaleDateString(),r.push(a)}catch(i){Logger.log("Error parsing date: "+e.PremiereDate)}if(e.StartDate)try{t=parseISO8601Date(e.StartDate,{toLocal:!0}),a=t.toLocaleDateString(),r.push(a),"Recording"!=e.Type&&(a=LibraryBrowser.getDisplayTime(t),r.push(a))}catch(i){Logger.log("Error parsing date: "+e.PremiereDate)}if(e.ProductionYear&&"Series"==e.Type)if("Continuing"==e.Status)r.push(Globalize.translate("ValueSeriesYearToPresent",e.ProductionYear));else if(e.ProductionYear){if(a=e.ProductionYear,e.EndDate)try{var n=parseISO8601Date(e.EndDate,{toLocal:!0}).getFullYear();n!=e.ProductionYear&&(a+="-"+parseISO8601Date(e.EndDate,{toLocal:!0}).getFullYear())}catch(i){Logger.log("Error parsing date: "+e.EndDate)}r.push(a)}if("Series"!=e.Type&&"Episode"!=e.Type&&"Photo"!=e.MediaType)if(e.ProductionYear)r.push(e.ProductionYear);else if(e.PremiereDate)try{a=parseISO8601Date(e.PremiereDate,{toLocal:!0}).getFullYear(),r.push(a)}catch(i){Logger.log("Error parsing date: "+e.PremiereDate)}var o;if(e.RunTimeTicks&&"Series"!=e.Type&&("Audio"==e.Type?r.push(Dashboard.getDisplayTime(e.RunTimeTicks)):(o=e.RunTimeTicks/6e8,o=o||1,r.push(Math.round(o)+"min"))),e.CumulativeRunTimeTicks&&"Series"!=e.Type&&"Season"!=e.Type&&r.push(Dashboard.getDisplayTime(e.CumulativeRunTimeTicks)),e.OfficialRating&&"Season"!==e.Type&&"Episode"!==e.Type&&r.push(e.OfficialRating),e.IsHD&&r.push(Globalize.translate("LabelHDProgram")),e.Video3DFormat&&r.push("3D"),"Photo"==e.MediaType&&e.Width&&e.Height&&r.push(e.Width+"x"+e.Height),e.SeriesTimerId){var s="";s+='<a href="livetvseriestimer.html?id='+e.SeriesTimerId+'" title="'+Globalize.translate("ButtonViewSeriesRecording")+'">',s+='<div class="timerCircle seriesTimerCircle"></div>',s+='<div class="timerCircle seriesTimerCircle"></div>',s+='<div class="timerCircle seriesTimerCircle"></div>',s+="</a>",r.push(s),require(["livetvcss"])}else if(e.TimerId){var s="";s+='<a href="livetvtimer.html?id='+e.TimerId+'">',s+='<div class="timerCircle"></div>',s+="</a>",r.push(s),require(["livetvcss"])}return r.join("&nbsp;&nbsp;&nbsp;&nbsp;")},renderOverview:function(e,a){$(e).each(function(){var e=this,t=a.Overview||"";$("a",e).each(function(){this.setAttribute("target","_blank")}),t?(e.innerHTML=t,e.classList.remove("empty")):(e.innerHTML="",e.classList.add("empty"))})},renderStudios:function(e,a,t){if(a.Studios&&a.Studios.length&&"Series"!=a.Type){for(var r="",i=0,n=a.Studios.length;n>i;i++)i>0&&(r+="&nbsp;&nbsp;/&nbsp;&nbsp;"),r+=t?a.Studios[i].Name:'<a class="textlink" href="itemdetails.html?id='+a.Studios[i].Id+'">'+a.Studios[i].Name+"</a>";var o=a.Studios.length>1?"ValueStudios":"ValueStudio";r=Globalize.translate(o,r),e.show().html(r).trigger("create")}else e.hide()},renderGenres:function(e,a,t,r){for(var i="",n=a.Genres||[],o=0,s=n.length;s>o&&!(t&&o>=t);o++){o>0&&(i+="<span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>");var l="Audio"==a.Type||"MusicArtist"==a.Type||"MusicAlbum"==a.Type?"musicgenre":"genre";"Game"==a.MediaType&&(l="gamegenre"),i+=r?n[o]:'<a class="textlink" href="itemdetails.html?'+l+"="+ApiClient.encodeName(n[o])+'">'+n[o]+"</a>"}e.html(i).trigger("create")},renderPremiereDate:function(e,a){if(a.PremiereDate)try{var t=parseISO8601Date(a.PremiereDate,{toLocal:!0}),r=(new Date).getTime()>t.getTime()?"ValuePremiered":"ValuePremieres";e.show().html(Globalize.translate(r,t.toLocaleDateString()))}catch(i){e.hide()}else e.hide()},renderAwardSummary:function(e,a){a.AwardSummary?e.show().html(Globalize.translate("ValueAwards",a.AwardSummary)):e.hide()},renderDetailPageBackdrop:function(e,a){var r,i=t.availWidth,n=!1;return a.BackdropImageTags&&a.BackdropImageTags.length?(r=ApiClient.getScaledImageUrl(a.Id,{type:"Backdrop",index:0,maxWidth:i,tag:a.BackdropImageTags[0]}),ImageLoader.lazyImage($("#itemBackdrop",e).addClass("noFade").removeClass("noBackdrop")[0],r),n=!0):a.ParentBackdropItemId&&a.ParentBackdropImageTags&&a.ParentBackdropImageTags.length?(r=ApiClient.getScaledImageUrl(a.ParentBackdropItemId,{type:"Backdrop",index:0,tag:a.ParentBackdropImageTags[0],maxWidth:i}),ImageLoader.lazyImage($("#itemBackdrop",e).addClass("noFade").removeClass("noBackdrop")[0],r),n=!0):$("#itemBackdrop",e).addClass("noBackdrop").css("background-image","none"),n}};return a.documentElement.classList.add(s.enableFullPaperTabs()?"fullPaperLibraryTabs":"basicPaperLibraryTabs"),s}(window,document,screen);