define(["playlistManager","appSettings","appStorage","apphost","datetime","jQuery","scrollStyles"],function(e,t,a,r,i,n){function o(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}var s=function(s,l,d){function u(e){return e.replace(/&/g,"&amp;").replace(c,function(e){var t=e.charCodeAt(0),a=e.charCodeAt(1);return"&#"+(1024*(t-55296)+(a-56320)+65536)+";"}).replace(p,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function m(e){if(e){if(e=e.toLowerCase(),-1!=e.indexOf("portrait"))return 2/3;if(-1!=e.indexOf("backdrop"))return 16/9;if(-1!=e.indexOf("square"))return 1}return null}var c=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,p=/([^\#-~| |!])/g,g="pagesize_v4",h={getDefaultPageSize:function(e,t){return 100},getDefaultItemsView:function(e,t){return browserInfo.mobile?t:e},getSavedQueryKey:function(e){return s.location.href.split("#")[0]+(e||"")},loadSavedQueryValues:function(e,t){var r=a.getItem(e+"_"+Dashboard.getCurrentUserId());return r?(r=JSON.parse(r),Object.assign(t,r)):t},saveQueryValues:function(e,t){var r={};t.SortBy&&(r.SortBy=t.SortBy),t.SortOrder&&(r.SortOrder=t.SortOrder);try{a.setItem(e+"_"+Dashboard.getCurrentUserId(),JSON.stringify(r))}catch(i){}},saveViewSetting:function(e,t){try{a.setItem(e+"_"+Dashboard.getCurrentUserId()+"_view",t)}catch(r){}},getSavedView:function(e){var t=a.getItem(e+"_"+Dashboard.getCurrentUserId()+"_view");return t},getSavedViewSetting:function(e){return new Promise(function(t){var a=LibraryBrowser.getSavedView(e);t(a)})},needsRefresh:function(e){var t=parseInt(e.getAttribute("data-lastrefresh")||"0");if(!t)return!0;var a,r=(new Date).getTime();return a=AppInfo.isNativeApp?3e5:browserInfo.ipad||browserInfo.iphone||browserInfo.android?1e4:3e4,a>r-t?!1:!0},setLastRefreshed:function(e){e.setAttribute("data-lastrefresh",(new Date).getTime()),e.classList.add("hasrefreshtime")},allowSwipe:function(e){function t(e){return"PAPER-SLIDER"==e.tagName?!1:e.classList?!e.classList.contains("hiddenScrollX")&&!e.classList.contains("smoothScrollX")&&!e.classList.contains("libraryViewNav"):!0}for(var a=e;null!=a;){if(!t(a))return!1;a=a.parentNode}return!0},selectedTab:function(e,t){if(null==t){var a=e.querySelector(".mdl-tabs__tab.is-active");return a?parseInt(a.getAttribute("data-index")):0}var r=LibraryBrowser.selectedTab(e);if(r==t)e.dispatchEvent(new CustomEvent("tabchange",{detail:{selectedTabIndex:t}}));else{var i=e.querySelectorAll(".mdl-tabs__tab");i[t].click()}},configureSwipeTabs:function(e,t){var a=t.querySelectorAll(".mdl-tabs__panel").length;require(["hammer"],function(e){var r=new e(t);r.get("swipe").set({direction:e.DIRECTION_HORIZONTAL}),r.on("swipeleft",function(e){if(LibraryBrowser.allowSwipe(e.target)){var r=parseInt(LibraryBrowser.selectedTab(t)||"0");a-1>r&&LibraryBrowser.selectedTab(t,r+1)}}),r.on("swiperight",function(e){if(LibraryBrowser.allowSwipe(e.target)){var a=parseInt(LibraryBrowser.selectedTab(t)||"0");a>0&&LibraryBrowser.selectedTab(t,a-1)}})})},configurePaperLibraryTabs:function(e,t){browserInfo.safari||LibraryBrowser.configureSwipeTabs(e,t),t.querySelector(".mdl-tabs__tab-bar").addEventListener("click",function(e){var a=o(e.target,"mdl-tabs__tab");a&&t.dispatchEvent(new CustomEvent("tabchange",{detail:{selectedTabIndex:parseInt(a.getAttribute("data-index"))}}))}),e.addEventListener("viewbeforeshow",LibraryBrowser.onTabbedpagebeforeshow)},onTabbedpagebeforeshow:function(e){var t=e.target,a=0,r=!1;t.getAttribute("data-firstload")||(a=300,r=!0,t.setAttribute("data-firstload","1")),a?setTimeout(function(){LibraryBrowser.onTabbedpagebeforeshowInternal(t,e,r)},a):LibraryBrowser.onTabbedpagebeforeshowInternal(t,e,r)},onTabbedpagebeforeshowInternal:function(e,t,a){var r=e.querySelector(".mdl-tabs");if(a){var i=null!=e.firstTabIndex?e.firstTabIndex:parseInt(getParameterByName("tab")||"0");LibraryBrowser.selectedTab(r,i)}else{if(!t.detail.isRestored)return void LibraryBrowser.selectedTab(r,0);r.dispatchEvent(new CustomEvent("tabchange",{detail:{selectedTabIndex:LibraryBrowser.selectedTab(r)}}))}},showTab:function(e,t){var a=function(){l.removeEventListener("pagebeforeshow",a),-1!=s.location.href.toLowerCase().indexOf(e.toLowerCase())&&(this.firstTabIndex=t)};-1!=s.location.href.toLowerCase().indexOf(e.toLowerCase())?a.call(n.mobile.activePage):(pageClassOn("pagebeforeshow","page",a),Dashboard.navigate(e))},canShare:function(e,t){return"Timer"==e.Type?!1:t.Policy.EnablePublicSharing},getDateParamValue:function(e){function t(e){return 10>e?"0"+e:e}var a=e;return""+a.getFullYear()+t(a.getMonth()+1)+t(a.getDate())+t(a.getHours())+t(a.getMinutes())+t(a.getSeconds())},playAllFromHere:function(e,t){e(t,100,"MediaSources,Chapters").then(function(e){MediaController.play({items:e.Items})})},queueAllFromHere:function(e,t){fn(t,100,"MediaSources,Chapters").then(function(e){MediaController.queue({items:e.Items})})},getItemCountsHtml:function(e,t){var a,r=[];if("Playlist"==t.Type){if(a="",t.CumulativeRunTimeTicks){var i=t.CumulativeRunTimeTicks/6e8;i=i||1,a+=Globalize.translate("ValueMinutes",Math.round(i))}else a+=Globalize.translate("ValueMinutes",0);r.push(a)}else"movies"==e.context?(t.MovieCount&&(a=1==t.MovieCount?Globalize.translate("ValueOneMovie"):Globalize.translate("ValueMovieCount",t.MovieCount),r.push(a)),t.TrailerCount&&(a=1==t.TrailerCount?Globalize.translate("ValueOneTrailer"):Globalize.translate("ValueTrailerCount",t.TrailerCount),r.push(a))):"tv"==e.context?(t.SeriesCount&&(a=1==t.SeriesCount?Globalize.translate("ValueOneSeries"):Globalize.translate("ValueSeriesCount",t.SeriesCount),r.push(a)),t.EpisodeCount&&(a=1==t.EpisodeCount?Globalize.translate("ValueOneEpisode"):Globalize.translate("ValueEpisodeCount",t.EpisodeCount),r.push(a))):"games"==e.context?t.GameCount&&(a=1==t.GameCount?Globalize.translate("ValueOneGame"):Globalize.translate("ValueGameCount",t.GameCount),r.push(a)):"music"==e.context&&(t.AlbumCount&&(a=1==t.AlbumCount?Globalize.translate("ValueOneAlbum"):Globalize.translate("ValueAlbumCount",t.AlbumCount),r.push(a)),t.SongCount&&(a=1==t.SongCount?Globalize.translate("ValueOneSong"):Globalize.translate("ValueSongCount",t.SongCount),r.push(a)),t.MusicVideoCount&&(a=1==t.MusicVideoCount?Globalize.translate("ValueOneMusicVideo"):Globalize.translate("ValueMusicVideoCount",t.MusicVideoCount),r.push(a)));return r.join(" â€¢ ")},getArtistLinksHtml:function(e,t){for(var a=[],r=0,i=e.length;i>r;r++){var n=e[r],o=t?' class="'+t+'"':"";a.push("<a"+o+' href="itemdetails.html?id='+n.Id+'">'+n.Name+"</a>")}return a=a.join(" / ")},playInExternalPlayer:function(e){Dashboard.loadExternalPlayer().then(function(){ExternalPlayer.showMenu(e)})},showPlayMenu:function(e,a,r,i,n,o){var s=AppInfo.supportsExternalPlayers&&t.enableExternalPlayers();if(!(o||"Audio"==n||i||s&&"Video"==n))return void MediaController.play(a);var l=[];o&&l.push({name:Globalize.translate("ButtonResume"),id:"resume",ironIcon:"play-arrow"}),l.push({name:Globalize.translate("ButtonPlay"),id:"play",ironIcon:"play-arrow"}),!i&&s&&"Audio"!=n&&l.push({name:Globalize.translate("ButtonPlayExternalPlayer"),id:"externalplayer",ironIcon:"airplay"}),MediaController.canQueueMediaType(n,r)&&l.push({name:Globalize.translate("ButtonQueue"),id:"queue",ironIcon:"playlist-add"}),("Audio"==r||"MusicAlbum"==r||"MusicArtist"==r||"MusicGenre"==r)&&l.push({name:Globalize.translate("ButtonInstantMix"),id:"instantmix",ironIcon:"shuffle"}),(i||"MusicArtist"==r||"MusicGenre"==r)&&l.push({name:Globalize.translate("ButtonShuffle"),id:"shuffle",ironIcon:"shuffle"}),require(["actionsheet"],function(t){t.show({items:l,positionTo:e,callback:function(e){switch(e){case"play":MediaController.play(a);break;case"externalplayer":LibraryBrowser.playInExternalPlayer(a);break;case"resume":MediaController.play({ids:[a],startPositionTicks:o});break;case"queue":MediaController.queue(a);break;case"instantmix":MediaController.instantMix(a);break;case"shuffle":MediaController.shuffle(a)}}})})},supportsEditing:function(e){return"UserRootFolder"==e||"UserView"==e||"Timer"==e?!1:!0},getMoreCommands:function(t,a){var i=[];return LibraryBrowser.supportsAddingToCollection(t)&&i.push("addtocollection"),e.supportsPlaylists(t)&&i.push("playlist"),"BoxSet"==t.Type||"Playlist"==t.Type?i.push("delete"):t.CanDelete&&i.push("delete"),a.Policy.IsAdministrator&&(LibraryBrowser.supportsEditing(t.Type)&&i.push("edit"),"Video"==t.MediaType&&"TvChannel"!=t.Type&&"Program"!=t.Type&&"Virtual"!=t.LocationType&&i.push("editsubtitles"),"Timer"!=t.Type&&i.push("editimages")),a.Policy.IsAdministrator&&i.push("refresh"),LibraryBrowser.enableSync(t,a)&&i.push("sync"),t.CanDownload&&r.supports("filedownload")&&i.push("download"),LibraryBrowser.canShare(t,a)&&i.push("share"),LibraryBrowser.canIdentify(a,t.Type)&&i.push("identify"),i},canIdentify:function(e,t){return"Movie"!=t&&"Trailer"!=t&&"Series"!=t&&"Game"!=t&&"BoxSet"!=t&&"Person"!=t&&"Book"!=t&&"MusicAlbum"!=t&&"MusicArtist"!=t||!e.Policy.IsAdministrator?!1:!0},refreshItem:function(e){ApiClient.refreshItem(e,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!0}),require(["toast"],function(e){e(Globalize.translate("MessageRefreshQueued"))})},deleteItems:function(e){return new Promise(function(t,a){var r=Globalize.translate("ConfirmDeleteItem"),i=Globalize.translate("HeaderDeleteItem");e.length>1&&(r=Globalize.translate("ConfirmDeleteItems"),i=Globalize.translate("HeaderDeleteItems")),require(["confirm"],function(n){n(r,i).then(function(){e.map(function(e){ApiClient.deleteItem(e),Events.trigger(LibraryBrowser,"itemdeleting",[e])});t()},a)})})},editImages:function(e){require(["components/imageeditor/imageeditor"],function(t){t.show(e)})},editSubtitles:function(e){require(["components/subtitleeditor/subtitleeditor"],function(t){t.show(e)})},editMetadata:function(e){require(["components/metadataeditor/metadataeditor"],function(t){t.show(e)})},editTimer:function(e){require(["components/recordingeditor/recordingeditor"],function(t){t.show(e)})},showMoreCommands:function(e,t,a,r){var i=[];-1!=r.indexOf("addtocollection")&&i.push({name:Globalize.translate("ButtonAddToCollection"),id:"addtocollection",ironIcon:"add"}),-1!=r.indexOf("playlist")&&i.push({name:Globalize.translate("ButtonAddToPlaylist"),id:"playlist",ironIcon:"playlist-add"}),-1!=r.indexOf("delete")&&i.push({name:Globalize.translate("ButtonDelete"),id:"delete",ironIcon:"delete"}),-1!=r.indexOf("download")&&i.push({name:Globalize.translate("ButtonDownload"),id:"download",ironIcon:"file-download"}),-1!=r.indexOf("edit")&&i.push({name:Globalize.translate("ButtonEdit"),id:"edit",ironIcon:"mode-edit"}),-1!=r.indexOf("editimages")&&i.push({name:Globalize.translate("ButtonEditImages"),id:"editimages",ironIcon:"photo"}),-1!=r.indexOf("editsubtitles")&&i.push({name:Globalize.translate("ButtonEditSubtitles"),id:"editsubtitles",ironIcon:"closed-caption"}),-1!=r.indexOf("identify")&&i.push({name:Globalize.translate("ButtonIdentify"),id:"identify",ironIcon:"info"}),-1!=r.indexOf("refresh")&&i.push({name:Globalize.translate("ButtonRefresh"),id:"refresh",ironIcon:"refresh"}),-1!=r.indexOf("share")&&i.push({name:Globalize.translate("ButtonShare"),id:"share",ironIcon:"share"});var n=ApiClient.serverInfo().Id;require(["actionsheet"],function(r){r.show({items:i,positionTo:e,callback:function(e){switch(e){case"share":require(["sharingmanager"],function(e){e.showMenu({serverId:n,itemId:t})});break;case"addtocollection":require(["collectioneditor"],function(e){(new e).show([t])});break;case"playlist":require(["playlistManager"],function(e){e.showPanel([t])});break;case"delete":LibraryBrowser.deleteItems([t]);break;case"download":require(["fileDownloader"],function(e){var a=ApiClient.getUrl("Items/"+t+"/Download",{api_key:ApiClient.accessToken()});e.download([{url:a,itemId:t,serverId:n}])});break;case"edit":"Timer"==a?LibraryBrowser.editTimer(t):LibraryBrowser.editMetadata(t);break;case"editsubtitles":LibraryBrowser.editSubtitles(t);break;case"editimages":LibraryBrowser.editImages(t);break;case"identify":LibraryBrowser.identifyItem(t);break;case"refresh":ApiClient.refreshItem(t,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!0}),require(["toast"],function(e){e(Globalize.translate("MessageRefreshQueued"))})}}})})},identifyItem:function(e){require(["components/itemidentifier/itemidentifier"],function(t){t.show(e)})},getHref:function(e,t,a){var r=LibraryBrowser.getHrefInternal(e,t);return"tv"==t&&(a||(a=LibraryMenu.getTopParentId()),a&&(r+=-1==r.indexOf("?")?"?topParentId=":"&topParentId=",r+=a)),r},getHrefInternal:function(e,t){if(!e)throw new Error("item cannot be null");if(e.url)return e.url;var a=e.Id||e.ItemId;if("livetv"==e.CollectionType)return"livetv.html";if("channels"==e.CollectionType)return"channels.html";if("folders"!=t){if("movies"==e.CollectionType)return"movies.html?topParentId="+e.Id;if("boxsets"==e.CollectionType)return"collections.html?topParentId="+e.Id;if("tvshows"==e.CollectionType)return"tv.html?topParentId="+e.Id;if("music"==e.CollectionType)return"music.html?topParentId="+e.Id;if("games"==e.CollectionType)return"gamesrecommended.html?topParentId="+e.Id;if("playlists"==e.CollectionType)return"playlists.html?topParentId="+e.Id;if("photos"==e.CollectionType)return"photos.html?topParentId="+e.Id}else if(e.IsFolder)return a?"itemlist.html?parentId="+a:"#";if("CollectionFolder"==e.Type)return"itemlist.html?topParentId="+e.Id+"&parentId="+e.Id;if("PhotoAlbum"==e.Type)return"itemlist.html?context=photos&parentId="+a;if("Playlist"==e.Type)return"itemdetails.html?id="+a;if("TvChannel"==e.Type)return"itemdetails.html?id="+a;if("Channel"==e.Type)return"channelitems.html?id="+a;if(e.IsFolder&&"Channel"==e.SourceType||"ChannelFolderItem"==e.Type)return"channelitems.html?id="+e.ChannelId+"&folderId="+e.Id;if("Program"==e.Type)return"itemdetails.html?id="+a;if("BoxSet"==e.Type)return"itemdetails.html?id="+a;if("MusicAlbum"==e.Type)return"itemdetails.html?id="+a;if("GameSystem"==e.Type)return"itemdetails.html?id="+a;if("Genre"==e.Type)return"itemdetails.html?id="+a;if("MusicGenre"==e.Type)return"itemdetails.html?id="+a;if("GameGenre"==e.Type)return"itemdetails.html?id="+a;if("Studio"==e.Type)return"itemdetails.html?id="+a;if("Person"==e.Type)return"itemdetails.html?id="+a;if("Recording"==e.Type)return"itemdetails.html?id="+a;if("MusicArtist"==e.Type)return"itemdetails.html?id="+a;var r=t?"&context="+t:"";return"Series"==e.Type||"Season"==e.Type||"Episode"==e.Type?"itemdetails.html?id="+a+r:e.IsFolder?a?"itemlist.html?parentId="+a:"#":"itemdetails.html?id="+a},getImageUrl:function(e,t,a,r){return r=r||{},r.type=t,r.index=a,r.tag="Backdrop"==t?e.BackdropImageTags[a]:"Screenshot"==t?e.ScreenshotImageTags[a]:"Primary"==t?e.PrimaryImageTag||e.ImageTags[t]:e.ImageTags[t],ApiClient.getScaledImageUrl(e.Id||e.ItemId,r)},getListViewIndex:function(e,t){if("disc"==t.index)return null==e.ParentIndexNumber?"":Globalize.translate("ValueDiscNumber",e.ParentIndexNumber);var a,r,i=(t.sortBy||"").toLowerCase();return 0==i.indexOf("sortname")?"Episode"==e.Type?"":(r=(e.SortName||e.Name||"?")[0].toUpperCase(),a=r.charCodeAt(0),65>a||a>90?"#":r.toUpperCase()):0==i.indexOf("officialrating")?e.OfficialRating||Globalize.translate("HeaderUnrated"):0==i.indexOf("communityrating")?null==e.CommunityRating?Globalize.translate("HeaderUnrated"):Math.floor(e.CommunityRating):0==i.indexOf("criticrating")?null==e.CriticRating?Globalize.translate("HeaderUnrated"):Math.floor(e.CriticRating):0==i.indexOf("metascore")?null==e.Metascore?Globalize.translate("HeaderUnrated"):Math.floor(e.Metascore):0==i.indexOf("albumartist")&&e.AlbumArtist?(r=e.AlbumArtist[0].toUpperCase(),a=r.charCodeAt(0),65>a||a>90?"#":r.toUpperCase()):""},getUserDataCssClass:function(e){return e?"libraryItemUserData"+e.replace(new RegExp(" ","g"),""):""},getListViewHtml:function(e){require(["paper-icon-item","paper-item-body"]);var t="";e.title&&(t+="<h1>",t+=e.title,t+="</h1>"),t+='<div class="paperList itemsListview">';var a=0,r="";return t+=e.items.map(function(i){var n="";if(e.showIndex!==!1){var o=LibraryBrowser.getListViewIndex(i,e);o!=r&&(t+="</div>",n+=0==a?"<h1>":'<h1 style="margin-top:2em;">',n+=o,n+="</h1>",n+='<div class="paperList itemsListview">',r=o)}var s=LibraryBrowser.getItemDataAttributes(i,e,a),l="listItem",d=LibraryBrowser.getHref(i,e.context);n+='<paper-icon-item class="'+l+'"'+s+' data-itemid="'+i.Id+'" data-playlistitemid="'+(i.PlaylistItemId||"")+'" data-href="'+d+'" data-icon="false">';var u,m=e.smallIcon?70:80,c="Episode"==i.Type||"Game"==i.Type||e.smallIcon?2:1.5;i.ImageTags.Primary?u=ApiClient.getScaledImageUrl(i.Id,{maxWidth:m,tag:i.ImageTags.Primary,type:"Primary",index:0,minScale:c}):i.AlbumId&&i.AlbumPrimaryImageTag?u=ApiClient.getScaledImageUrl(i.AlbumId,{type:"Primary",maxWidth:m,tag:i.AlbumPrimaryImageTag,minScale:c}):i.AlbumId&&i.SeriesPrimaryImageTag?u=ApiClient.getScaledImageUrl(i.SeriesId,{type:"Primary",maxWidth:m,tag:i.SeriesPrimaryImageTag,minScale:c}):i.ParentPrimaryImageTag&&(u=ApiClient.getImageUrl(i.ParentPrimaryImageItemId,{type:"Primary",maxWidth:m,tag:i.ParentPrimaryImageTag,minScale:c})),n+=u?e.smallIcon?'<div class="listviewImage lazy small" data-src="'+u+'" item-icon></div>':'<div class="listviewImage lazy" data-src="'+u+'" item-icon></div>':e.smallIcon?'<div class="listviewImage small" item-icon></div>':'<div class="listviewImage" item-icon></div>';var p=[];"Episode"==i.Type?p.push(i.SeriesName||"&nbsp;"):"MusicAlbum"==i.Type&&p.push(i.AlbumArtist||"&nbsp;");var g=LibraryBrowser.getPosterViewDisplayName(i);e.showIndexNumber&&null!=i.IndexNumber&&(g=i.IndexNumber+". "+g),p.push(g),"Audio"==i.Type&&p.push(i.ArtistItems.map(function(e){return e.Name}).join(", ")||"&nbsp;"),"Game"==i.Type?p.push(i.GameSystem||"&nbsp;"):"MusicGenre"==i.Type?p.push("&nbsp;"):"MusicArtist"==i.Type?p.push("&nbsp;"):"TvChannel"==i.Type?i.CurrentProgram&&p.push(LibraryBrowser.getPosterViewDisplayName(i.CurrentProgram)):p.push(LibraryBrowser.getMiscInfoHtml(i)),n+=p.length>2?"<paper-item-body three-line>":"<paper-item-body two-line>";var h=e.defaultAction;("play"==h||"playallfromhere"==h)&&"Full"!=i.PlayAccess&&(h=null);var b=h?' data-action="'+h+'" class="itemWithAction mediaItem clearLink"':' class="mediaItem clearLink"';n+="<a"+b+' href="'+d+'">';for(var y=0,I=p.length;I>y;y++)n+=0==y?"<div>":"<div secondary>",n+=p[y]||"&nbsp;",n+="</div>";return n+="</a>",n+="</paper-item-body>",n+='<button is="paper-icon-button-light" class="listviewMenuButton"><iron-icon icon="'+AppInfo.moreIcon+'"></iron-icon></button>',n+='<span class="listViewUserDataButtons">',n+=LibraryBrowser.getUserDataIconsHtml(i),n+="</span>",n+="</paper-icon-item>",a++,n}).join(""),t+="</div>"},getItemDataAttributesList:function(e,t,a){var r=[],i=LibraryBrowser.getItemCommands(e,t);return r.push({name:"itemid",value:e.Id}),r.push({name:"commands",value:i.join(",")}),t.context&&r.push({name:"context",value:t.context||""}),e.IsFolder&&r.push({name:"isfolder",value:e.IsFolder}),r.push({name:"itemtype",value:e.Type}),e.MediaType&&r.push({name:"mediatype",value:e.MediaType||""}),e.UserData&&e.UserData.PlaybackPositionTicks&&r.push({name:"positionticks",value:e.UserData.PlaybackPositionTicks||0}),r.push({name:"playaccess",value:e.PlayAccess||""}),r.push({name:"locationtype",value:e.LocationType||""}),r.push({name:"index",value:a}),e.AlbumId&&r.push({name:"albumid",value:e.AlbumId}),e.ChannelId&&r.push({name:"channelid",value:e.ChannelId}),e.ArtistItems&&e.ArtistItems.length&&r.push({name:"artistid",value:e.ArtistItems[0].Id}),r},getItemDataAttributes:function(e,t,a){var r=LibraryBrowser.getItemDataAttributesList(e,t,a).map(function(e){return"data-"+e.name+'="'+e.value+'"'}),i=r.join(" ");return i&&(i=" "+i),i},supportsAddingToCollection:function(e){var t=["Person","Genre","MusicGenre","Studio","GameGenre","BoxSet","Playlist","UserView","CollectionFolder","Audio","Episode","TvChannel","Program","MusicAlbum","Timer"];return!e.CollectionType&&-1==t.indexOf(e.Type)&&"Photo"!=e.MediaType},enableSync:function(e,t){return AppInfo.isNativeApp&&!Dashboard.capabilities().SupportsSync?!1:t&&!t.Policy.EnableSync?!1:e.SupportsSync},getItemCommands:function(t,a){var r=[];return LibraryBrowser.supportsEditing(t.Type)&&r.push("edit"),t.LocalTrailerCount&&r.push("trailer"),("Audio"==t.MediaType||"MusicAlbum"==t.Type||"MusicArtist"==t.Type||"MusicGenre"==t.Type||"music"==t.CollectionType)&&r.push("instantmix"),(t.IsFolder||"MusicArtist"==t.Type||"MusicGenre"==t.Type)&&r.push("shuffle"),e.supportsPlaylists(t)&&r.push(a.showRemoveFromPlaylist?"removefromplaylist":"playlist"),a.showAddToCollection!==!1&&LibraryBrowser.supportsAddingToCollection(t)&&r.push("addtocollection"),a.showRemoveFromCollection&&r.push("removefromcollection"),a.playFromHere&&(r.push("playfromhere"),r.push("queuefromhere")),t.CanDelete&&r.push("delete"),LibraryBrowser.enableSync(t)&&r.push("sync"),"Program"!=t.Type||t.TimerId||t.SeriesTimerId||r.push("record"),"Video"==t.MediaType&&"TvChannel"!=t.Type&&"Program"!=t.Type&&"Virtual"!=t.LocationType&&r.push("editsubtitles"),"Timer"!=t.Type&&r.push("editimages"),r},shapes:["square","portrait","banner","smallBackdrop","homePageSmallBackdrop","backdrop","overflowBackdrop","overflowPortrait","overflowSquare"],getPostersPerRow:function(e){function t(t){switch(t){case"portrait":return e>=2200?10:e>=2100?9:e>=1600?8:e>=1400?7:e>=1200?6:e>=800?5:e>=640?4:3;case"square":return e>=2100?9:e>=1800?8:e>=1400?7:e>=1200?6:e>=900?5:e>=700?4:e>=500?3:2;case"banner":return e>=2200?4:e>=1200?3:e>=800?2:1;case"backdrop":return e>=2500?6:e>=2100?5:e>=1200?4:e>=770?3:e>=420?2:1}var r=n('<div class="card '+t+'Card"><div class="cardBox"><div class="cardImage"></div></div></div>').appendTo(l.body),i=n(".cardImage",r).innerWidth();(!i||isNaN(i))&&(a=!1,i=Math.min(400,e/2));var o=e/i;return r.remove(),Math.floor(o)}for(var a=!0,r={},i=0,o=LibraryBrowser.shapes.length;o>i;i++){var s=LibraryBrowser.shapes[i];r[s]=t(s)}return r.cache=a,r},posterSizes:[],getPosterViewInfo:function(){for(var e=s.innerWidth,t=LibraryBrowser.posterSizes,a=0,r=t.length;r>a;a++)if(t[a].screenWidth==e)return t[a];var i=LibraryBrowser.getPosterViewInfoInternal(e);return i.screenWidth=e,i.cache&&t.push(i),i},getPosterViewInfoInternal:function(e){var t=LibraryBrowser.getPostersPerRow(e),a={};a.screenWidth=e,AppInfo.hasLowImageBandwidth?AppInfo.isNativeApp||(e*=.7):e*=1.2;for(var r=100,i=0,n=LibraryBrowser.shapes.length;n>i;i++){var o=LibraryBrowser.shapes[i],s=e/t[o];browserInfo.mobile||(s=Math.round(s/r)*r),a[o+"Width"]=Math.round(s)}return a.cache=t.cache,a},setPosterViewData:function(e){var t=e.items;e.shape=e.shape||"portrait";var a=LibraryBrowser.getAveragePrimaryImageAspectRatio(t),r=a&&Math.abs(a-1.777777778)<.3,i=a&&Math.abs(a-1)<.33||a&&Math.abs(a-1.3333334)<.01;("auto"==e.shape||"autohome"==e.shape)&&(r?e.shape="auto"==e.shape?"backdrop":"backdrop":i?(e.coverImage=!0,e.shape="square"):a&&a>1.9?(e.shape="banner",e.coverImage=!0):e.shape=a&&Math.abs(a-.6666667)<.2?"auto"==e.shape?"portrait":"portrait":e.defaultShape||("auto"==e.shape?"square":"square"));var n=LibraryBrowser.getPosterViewInfo(),o=n.backdropWidth,s=n.portraitWidth,l=n.squareWidth,d=n.bannerWidth;r?s=o:i&&(s=l),"overflowBackdrop"==e.shape?o=n.overflowBackdropWidth:"overflowPortrait"==e.shape?s=n.overflowPortraitWidth:"overflowSquare"==e.shape?l=n.overflowSquareWidth:"smallBackdrop"==e.shape?o=n.smallBackdropWidth:"homePageSmallBackdrop"==e.shape?(o=n.homePageSmallBackdropWidth,s=n.homePageSmallBackdropWidth):"detailPagePortrait"==e.shape?s=200:"detailPageSquare"==e.shape?(s=240,l=240):"detailPage169"==e.shape&&(s=320,o=320),e.uiAspect=m(e.shape),e.primaryImageAspectRatio=a,e.posterWidth=s,e.thumbWidth=o,e.bannerWidth=d,e.squareSize=l},getPosterViewHtml:function(e){LibraryBrowser.setPosterViewData(e);var t,a=e.items;e.shape=e.shape||"portrait";for(var r,n,o="",s=e.thumbWidth,l=e.posterWidth,d=e.squareSize,u=e.bannerWidth,m=e.uiAspect,c=0,p=a.length;p>c;c++){var g=a[c];if(n=null,r=LibraryBrowser.getAveragePrimaryImageAspectRatio([g]),e.showStartDateIndex){if(g.StartDate)try{n=LibraryBrowser.getFutureDateText(i.parseISO8601Date(g.StartDate,!0),!0)}catch(h){}var b=n||Globalize.translate("HeaderUnknownDate");b!=t&&(o+='<h1 class="timelineHeader" style="text-align:center;">'+b+"</h1>",t=b)}else if(e.timeline){var y=g.ProductionYear||Globalize.translate("HeaderUnknownYear");y!=t&&(o+='<h1 class="timelineHeader">'+y+"</h1>",t=y)}o+=LibraryBrowser.getPosterViewItemHtml(g,c,e,r,s,l,d,u,m)}return o},getPosterViewItemHtml:function(e,t,a,r,i,n,o,s,l){var d,u="",m=null,c=null,p=null,g=!1,h=a.enableImageEnhancers!==!1,b="card";a.fullWidthOnMobile&&(b+=" fullWidthCardOnMobile");var y="auto"==a.showTitle?!0:a.showTitle;"PhotoAlbum"==e.Type&&(y=!0);var I=a.coverImage,f="Timer"==e.Type?e.ProgramInfo||e:e;a.autoThumb&&f.ImageTags&&f.ImageTags.Primary&&f.PrimaryImageAspectRatio&&f.PrimaryImageAspectRatio>=1.34?(c=n,p=r?Math.round(n/r):null,m=ApiClient.getImageUrl(f.Id,{type:"Primary",maxHeight:p,maxWidth:c,tag:f.ImageTags.Primary,enableImageEnhancers:h}),r&&l&&Math.abs(r-l)<=.2&&(I=!0)):a.autoThumb&&f.ImageTags&&f.ImageTags.Thumb?m=ApiClient.getScaledImageUrl(f.Id,{type:"Thumb",maxWidth:i,tag:f.ImageTags.Thumb,enableImageEnhancers:h}):a.preferBackdrop&&f.BackdropImageTags&&f.BackdropImageTags.length?m=ApiClient.getScaledImageUrl(f.Id,{type:"Backdrop",maxWidth:i,tag:f.BackdropImageTags[0],enableImageEnhancers:h}):a.preferThumb&&f.ImageTags&&f.ImageTags.Thumb?m=ApiClient.getScaledImageUrl(f.Id,{type:"Thumb",maxWidth:i,tag:f.ImageTags.Thumb,enableImageEnhancers:h}):a.preferBanner&&f.ImageTags&&f.ImageTags.Banner?m=ApiClient.getScaledImageUrl(f.Id,{type:"Banner",maxWidth:s,tag:f.ImageTags.Banner,enableImageEnhancers:h}):a.preferThumb&&f.SeriesThumbImageTag&&a.inheritThumb!==!1?m=ApiClient.getScaledImageUrl(f.SeriesId,{type:"Thumb",maxWidth:i,tag:f.SeriesThumbImageTag,enableImageEnhancers:h}):a.preferThumb&&f.ParentThumbItemId&&a.inheritThumb!==!1?m=ApiClient.getThumbImageUrl(f.ParentThumbItemId,{type:"Thumb",maxWidth:i,enableImageEnhancers:h}):a.preferThumb&&f.BackdropImageTags&&f.BackdropImageTags.length?(m=ApiClient.getScaledImageUrl(f.Id,{type:"Backdrop",maxWidth:i,tag:f.BackdropImageTags[0],enableImageEnhancers:h}),g=!0):f.ImageTags&&f.ImageTags.Primary?(c=n,p=r?Math.round(n/r):null,m=ApiClient.getImageUrl(f.Id,{type:"Primary",maxHeight:p,maxWidth:c,tag:f.ImageTags.Primary,enableImageEnhancers:h}),r&&l&&Math.abs(r-l)<=.2&&(I=!0)):f.ParentPrimaryImageTag?m=ApiClient.getImageUrl(f.ParentPrimaryImageItemId,{type:"Primary",maxWidth:n,tag:e.ParentPrimaryImageTag,enableImageEnhancers:h}):f.AlbumId&&f.AlbumPrimaryImageTag?(p=o,c=r?Math.round(p*r):null,m=ApiClient.getScaledImageUrl(f.AlbumId,{type:"Primary",maxHeight:p,maxWidth:c,tag:f.AlbumPrimaryImageTag,enableImageEnhancers:h}),r&&l&&Math.abs(r-l)<=.2&&(I=!0)):"Season"==f.Type&&f.ImageTags&&f.ImageTags.Thumb?m=ApiClient.getScaledImageUrl(f.Id,{type:"Thumb",maxWidth:i,tag:f.ImageTags.Thumb,enableImageEnhancers:h}):f.BackdropImageTags&&f.BackdropImageTags.length?m=ApiClient.getScaledImageUrl(f.Id,{type:"Backdrop",maxWidth:i,tag:f.BackdropImageTags[0],enableImageEnhancers:h}):f.ImageTags&&f.ImageTags.Thumb?m=ApiClient.getScaledImageUrl(f.Id,{type:"Thumb",maxWidth:i,tag:f.ImageTags.Thumb,enableImageEnhancers:h}):f.SeriesThumbImageTag?m=ApiClient.getScaledImageUrl(f.SeriesId,{type:"Thumb",maxWidth:i,tag:f.SeriesThumbImageTag,enableImageEnhancers:h}):f.ParentThumbItemId?m=ApiClient.getThumbImageUrl(f,{type:"Thumb",maxWidth:i,enableImageEnhancers:h}):"Audio"==e.MediaType||"MusicAlbum"==e.Type||"MusicArtist"==e.Type?(e.Name&&y&&(d="library-music"),b+=" defaultBackground"):"Recording"==e.Type||"Program"==e.Type||"TvChannel"==e.Type?(e.Name&&y&&(d="folder-open"),b+=" defaultBackground"):"Video"==e.MediaType||"Season"==e.Type||"Series"==e.Type?(e.Name&&y&&(d="videocam"),b+=" defaultBackground"):"Person"==e.Type?(e.Name&&y&&(d="person"),b+=" defaultBackground"):(e.Name&&y&&(d="folder-open"),b+=" defaultBackground"),d=e.icon||d,b+=" "+a.shape+"Card";var v=e.MediaSourceCount||1,T=a.linkItem===!1?"#":LibraryBrowser.getHref(e,a.context);a.showChildCountIndicator&&e.ChildCount&&a.showLatestItemsPopup!==!1&&(b+=" groupedCard"),!y&&!a.showItemCounts||a.overlayText||(b+=" bottomPaddedCard");var P=LibraryBrowser.getItemDataAttributes(e,a,t),S=a.defaultAction;("play"==S||"playallfromhere"==S)&&"Full"!=e.PlayAccess&&(S=null);var w=S?' data-action="'+S+'"':"";u+="<div"+P+' class="'+b+'">';var C="";m&&!a.lazy&&(C+="background-image:url('"+m+"');");var A="cardImage";d&&(A+=" iconCardImage"),I&&(A+=" coveredCardImage",("Photo"==e.MediaType||"PhotoAlbum"==e.Type||"Folder"==e.Type||"Program"==e.Type||"Recording"==e.Type)&&(A+=" noScale")),a.centerImage&&(A+=" centeredCardImage");var B="";a.lazy&&m&&(A+=" lazy",B=' data-src="'+m+'"');var L="cardBox";a.cardLayout&&(L+=" visualCardBox"),u+='<div class="'+L+'">',u+='<div class="cardScalable">',u+='<div class="cardPadder"></div>';var x="cardContent";x+=" mediaItem",a.defaultAction&&(x+=" itemWithAction");var D=a.transition!==!1&&AppInfo.enableSectionTransitions?' data-transition="slide"':"",k=e.onclick?' onclick="'+e.onclick+'"':"";u+="<a"+k+D+' class="'+x+'" href="'+T+'"'+w+">",u+='<div class="'+A+'" style="'+C+'"'+B+">",d&&(u+='<iron-icon icon="'+d+'"></iron-icon>'),u+="</div>","Virtual"==e.LocationType||"Offline"==e.LocationType?a.showLocationTypeIndicator!==!1&&(u+=LibraryBrowser.getOfflineIndicatorHtml(e)):a.showUnplayedIndicator!==!1?u+=LibraryBrowser.getPlayedIndicatorHtml(e):a.showChildCountIndicator&&(u+=LibraryBrowser.getGroupCountIndicator(e)),e.SeriesTimerId&&(u+='<iron-icon icon="fiber-smart-record" class="seriesTimerIndicator"></iron-icon>'),u+=LibraryBrowser.getSyncIndicator(e),v>1&&(u+='<div class="mediaSourceIndicator">'+v+"</div>");var M=a.showProgress===!1||e.IsFolder?"":LibraryBrowser.getItemProgressBarHtml("Recording"==e.Type?e:e.UserData||{}),G=!1;if(a.overlayText||g&&!y){var z=M?"cardFooter fullCardFooter":"cardFooter";u+=LibraryBrowser.getCardFooterText(e,a,y,m,g,z,M),G=!0}else M&&(u+='<div class="cardFooter fullCardFooter lightCardFooter">',u+="<div class='cardProgress cardText'>",u+=M,u+="</div>",u+="</div>",M="");return u+="</a>",!a.overlayPlayButton||e.IsPlaceHolder||"Virtual"==e.LocationType&&e.MediaType&&"Program"!=e.Type||"Person"==e.Type||(u+='<div class="cardOverlayButtonContainer"><button is="paper-icon-button-light" class="cardOverlayPlayButton" onclick="return false;"><iron-icon icon="play-arrow"></iron-icon></button></div>'),a.overlayMoreButton&&(u+='<div class="cardOverlayButtonContainer"><button is="paper-icon-button-light" class="cardOverlayMoreButton" onclick="return false;"><iron-icon icon="'+AppInfo.moreIcon+'"></iron-icon></button></div>'),u+="</div>",a.overlayText||G||(u+=LibraryBrowser.getCardFooterText(e,a,y,m,g,"cardFooter outerCardFooter",M)),u+="</div>",u+="</div>"},getCardFooterText:function(e,t,a,r,n,o,s){var l="";t.cardLayout&&(l+='<div class="cardButtonContainer">',l+='<button is="paper-icon-button-light" class="listviewMenuButton btnCardOptions"><iron-icon icon="'+AppInfo.moreIcon+'"></iron-icon></button>',l+="</div>");var d="auto"!=t.showTitle||e.IsFolder||"Photo"!=e.MediaType?LibraryBrowser.getPosterViewDisplayName(e,t.displayAsSpecial):"";r||a||(l+="<div class='cardDefaultText'>",l+=u(d),l+="</div>");var m=t.centerText?"cardText cardTextCentered":"cardText",c=[];if(t.showParentTitle&&c.push(e.EpisodeTitle?e.Name:e.SeriesName||e.Album||e.AlbumArtist||e.GameSystem||""),(a||n)&&c.push(u(d)),t.showItemCounts){var p=LibraryBrowser.getItemCountsHtml(t,e);c.push(p)}if(t.textLines)for(var g=t.textLines(e),h=0,b=g.length;b>h;h++)c.push(g[h]);if(t.showSongCount){var y="";e.SongCount&&(y=1==e.SongCount?Globalize.translate("ValueOneSong"):Globalize.translate("ValueSongCount",e.SongCount)),c.push(y)}if(t.showPremiereDate)if(e.PremiereDate)try{c.push(LibraryBrowser.getPremiereDateText(e))
}catch(I){c.push("")}else c.push("");if(t.showYear&&c.push(e.ProductionYear||""),t.showChannelName&&c.push(e.ChannelName||""),t.showAirTime){var f;if(e.StartDate)try{var v=i.parseISO8601Date(e.StartDate);f=v.toLocaleDateString(),f+=", "+i.getDisplayTime(v),e.EndDate&&(v=i.parseISO8601Date(e.EndDate),f+=" - "+i.getDisplayTime(v))}catch(T){}c.push(f||"")}if("TvChannel"==e.Type&&c.push(e.CurrentProgram?LibraryBrowser.getPosterViewDisplayName(e.CurrentProgram):""),t.showSeriesYear&&c.push("Continuing"==e.Status?Globalize.translate("ValueSeriesYearToPresent",e.ProductionYear||""):e.ProductionYear||""),t.showProgramAirInfo){var v=i.parseISO8601Date(e.StartDate,!0),P=e.StartDate?v.toLocaleString():"";c.push(P||"&nbsp;"),c.push(e.ChannelName||"&nbsp;")}return l+=LibraryBrowser.getCardTextLines(c,m,!t.overlayText),t.overlayText&&s&&(l+="<div class='cardText cardProgress'>",l+=s,l+="</div>"),l&&(l='<div class="'+o+'">'+l,l+="</div>"),l},getListItemInfo:function(e){for(var t=e;!t.getAttribute("data-itemid");)t=t.parentNode;var a=t.getAttribute("data-itemid"),r=t.getAttribute("data-index"),i=t.getAttribute("data-mediatype");return{id:a,index:r,mediaType:i,context:t.getAttribute("data-context")}},getCardTextLines:function(e,t,a){var r,i,n="",o=0;for(r=0,i=e.length;i>r;r++){var s=e[r];s&&(n+="<div class='"+t+"'>",n+=s,n+="</div>",o++)}if(a)for(;i>o;)n+="<div class='"+t+"'>&nbsp;</div>",o++;return n},getFutureDateText:function(e){var t=[];t[0]=Globalize.translate("OptionSunday"),t[1]=Globalize.translate("OptionMonday"),t[2]=Globalize.translate("OptionTuesday"),t[3]=Globalize.translate("OptionWednesday"),t[4]=Globalize.translate("OptionThursday"),t[5]=Globalize.translate("OptionFriday"),t[6]=Globalize.translate("OptionSaturday");var a=t[e.getDay()];return e=e.toLocaleDateString(),-1==e.toLowerCase().indexOf(a.toLowerCase())?a+" "+e:e},getPremiereDateText:function(e,t){if(!t){var a="";return e.AirTime&&(a+=e.AirTime),e.SeriesStudio&&(a+=a?" on "+e.SeriesStudio:e.SeriesStudio),a}var r=LibraryBrowser.getFutureDateText(t);return e.AirTime&&(r+=" at "+e.AirTime),e.SeriesStudio&&(r+=" on "+e.SeriesStudio),r},getPosterViewDisplayName:function(e,t,a){if(!e)throw new Error("null item passed into getPosterViewDisplayName");var r=e.EpisodeTitle||e.Name||"";if("TvChannel"==e.Type)return e.Number?e.Number+" "+r:r;if(t&&"Episode"==e.Type&&0==e.ParentIndexNumber)r=Globalize.translate("ValueSpecialEpisodeName",r);else if("Episode"==e.Type&&null!=e.IndexNumber&&null!=e.ParentIndexNumber){var i=e.IndexNumber,n="E"+i;a!==!1&&(n="S"+e.ParentIndexNumber+", "+n),e.IndexNumberEnd&&(i=e.IndexNumberEnd,n+="-"+i),r=n+" - "+r}return r},getOfflineIndicatorHtml:function(e){if("Offline"==e.LocationType)return'<div class="posterRibbon offlinePosterRibbon">'+Globalize.translate("HeaderOffline")+"</div>";if("Episode"==e.Type){try{var t=i.parseISO8601Date(e.PremiereDate,!0);if(e.PremiereDate&&(new Date).getTime()<t.getTime())return'<div class="posterRibbon unairedPosterRibbon">'+Globalize.translate("HeaderUnaired")+"</div>"}catch(a){}return'<div class="posterRibbon missingPosterRibbon">'+Globalize.translate("HeaderMissing")+"</div>"}return""},getPlayedIndicatorHtml:function(e){if("Series"==e.Type||"Season"==e.Type||"BoxSet"==e.Type||"Video"==e.MediaType||"Game"==e.MediaType||"Book"==e.MediaType){if(e.UserData.UnplayedItemCount)return'<div class="playedIndicator">'+e.UserData.UnplayedItemCount+"</div>";if("TvChannel"!=e.Type&&(e.UserData.PlayedPercentage&&e.UserData.PlayedPercentage>=100||e.UserData&&e.UserData.Played))return'<div class="playedIndicator"><iron-icon icon="check"></iron-icon></div>'}return""},getGroupCountIndicator:function(e){return e.ChildCount?'<div class="playedIndicator">'+e.ChildCount+"</div>":""},getSyncIndicator:function(e){if("Synced"==e.SyncStatus)return'<div class="syncIndicator"><iron-icon icon="sync"></iron-icon></div>';var t=e.SyncPercent;return t?'<div class="syncIndicator"><iron-icon icon="sync"></iron-icon></div>':"Queued"==e.SyncStatus||"Converting"==e.SyncStatus||"ReadyToTransfer"==e.SyncStatus||"Transferring"==e.SyncStatus?'<div class="syncIndicator"><iron-icon icon="sync"></iron-icon></div>':""},getAveragePrimaryImageAspectRatio:function(e){for(var t=[],a=0,r=e.length;r>a;a++){var i=e[a].PrimaryImageAspectRatio||0;i&&(t[t.length]=i)}if(!t.length)return null;t.sort(function(e,t){return e-t});var n,o=Math.floor(t.length/2);return n=t.length%2?t[o]:(t[o-1]+t[o])/2,Math.abs(.66666666667-n)<=.15?.66666666667:Math.abs(1.777777778-n)<=.2?1.777777778:Math.abs(1-n)<=.15?1:Math.abs(1.33333333333-n)<=.15?1.33333333333:n},metroColors:["#6FBD45","#4BB3DD","#4164A5","#E12026","#800080","#E1B222","#008040","#0094FF","#FF00C7","#FF870F","#7F0037"],getRandomMetroColor:function(){var e=Math.floor(Math.random()*(LibraryBrowser.metroColors.length-1));return LibraryBrowser.metroColors[e]},getMetroColor:function(e){if(e){for(var t=String(e.substr(0,1).charCodeAt()),a=0,r=0;r<t.length;r++)a+=parseInt(t.charAt(r));var i=String(a).substr(-1);return LibraryBrowser.metroColors[i]}return LibraryBrowser.getRandomMetroColor()},renderName:function(e,t,a,r){var i=LibraryBrowser.getPosterViewDisplayName(e,!1,!1);Dashboard.setPageTitle(i),t.html(a?'<a class="detailPageParentLink" href="'+LibraryBrowser.getHref(e,r)+'">'+i+"</a>":i)},renderParentName:function(e,t,a){var r=[],i=a?"&context="+a:"";e.AlbumArtists?r.push(LibraryBrowser.getArtistLinksHtml(e.AlbumArtists,"detailPageParentLink")):e.ArtistItems&&e.ArtistItems.length&&"MusicVideo"==e.Type?r.push(LibraryBrowser.getArtistLinksHtml(e.ArtistItems,"detailPageParentLink")):e.SeriesName&&"Episode"==e.Type&&r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.SeriesId+i+'">'+e.SeriesName+"</a>"),e.SeriesName&&"Season"==e.Type?r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.SeriesId+i+'">'+e.SeriesName+"</a>"):null!=e.ParentIndexNumber&&"Episode"==e.Type?r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.SeasonId+i+'">'+e.SeasonName+"</a>"):e.Album&&"Audio"==e.Type&&(e.AlbumId||e.ParentId)?r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+(e.AlbumId||e.ParentId)+i+'">'+e.Album+"</a>"):e.Album&&"MusicVideo"==e.Type&&e.AlbumId?r.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.AlbumId+i+'">'+e.Album+"</a>"):e.Album?r.push(e.Album):"Program"==e.Type&&e.EpisodeTitle&&r.push(e.Name),r.length?t.show().html(r.join(" - ")):t.hide()},renderLinks:function(e,t){var a=[];if(t.HomePageUrl&&a.push('<a class="textlink" href="'+t.HomePageUrl+'" target="_blank">'+Globalize.translate("ButtonWebsite")+"</a>"),t.ExternalUrls)for(var r=0,i=t.ExternalUrls.length;i>r;r++){var n=t.ExternalUrls[r];a.push('<a class="textlink" href="'+n.Url+'" target="_blank">'+n.Name+"</a>")}if(a.length){var o=a.join("&nbsp;&nbsp;/&nbsp;&nbsp;");o=Globalize.translate("ValueLinks",o),e.innerHTML=o,e.classList.remove("hide")}else e.classList.add("hide")},showLayoutMenu:function(e,t,a){var r=!0;a||(r=!1,a=e.getAttribute("data-layouts"),a=a?a.split(","):["List","Poster","PosterCard","Thumb","ThumbCard"]);var i=a.map(function(e){return{name:Globalize.translate("Option"+e),id:e,selected:t==e}});require(["actionsheet"],function(t){t.show({items:i,positionTo:e,callback:function(t){r?e.dispatchEvent(new CustomEvent("layoutchange",{detail:{viewStyle:t},bubbles:!0,cancelable:!1})):require(["jQuery"],function(a){a(e).trigger("layoutchange",[t])})}})})},getQueryPagingHtml:function(e){var t=e.startIndex,r=e.limit,i=e.totalRecordCount;if(r&&e.updatePageSizeSetting!==!1)try{a.setItem(e.pageSizeKey||g,r)}catch(n){}var o="",s=Math.min(t+r,i),l=i>20||i>r;if(o+='<div class="listPaging">',l){o+='<span style="vertical-align:middle;">';var d=i?t+1:0;o+=d+"-"+s+" of "+i,o+="</span>"}if((l||e.viewButton||e.filterButton||e.sortButton||e.addLayoutButton)&&(o+='<div style="display:inline-block;margin-left:10px;">',l&&(o+='<button is="paper-icon-button-light" class="btnPreviousPage" '+(t?"":"disabled")+'><iron-icon icon="arrow-back"></iron-icon></button>',o+='<button is="paper-icon-button-light" class="btnNextPage" '+(t+r>=i?"disabled":"")+'><iron-icon icon="arrow-forward"></iron-icon></button>'),e.addLayoutButton&&(o+='<button is="paper-icon-button-light" title="'+Globalize.translate("ButtonSelectView")+'" class="btnChangeLayout" data-layouts="'+(e.layouts||"")+'" onclick="LibraryBrowser.showLayoutMenu(this, \''+(e.currentLayout||"")+'\');"><iron-icon icon="view-comfy"></iron-icon></button>'),e.sortButton&&(o+='<button is="paper-icon-button-light" class="btnSort" title="'+Globalize.translate("ButtonSort")+'"><iron-icon icon="sort-by-alpha"></iron-icon></button>'),e.filterButton&&(o+='<button is="paper-icon-button-light" class="btnFilter" title="'+Globalize.translate("ButtonFilter")+'"><iron-icon icon="filter-list"></iron-icon></button>'),o+="</div>",l&&e.showLimit)){var u="selectPageSize",m=e.pageSizes||[20,50,100,200,300,400,500],c=m.map(function(e){return r==e?'<option value="'+e+'" selected="selected">'+e+"</option>":'<option value="'+e+'">'+e+"</option>"}).join("");o+='<div class="pageSizeContainer"><label class="labelPageSize" for="'+u+'">'+Globalize.translate("LabelLimit")+'</label><select style="width:auto;" class="selectPageSize" id="'+u+'" data-inline="true" data-mini="true">'+c+"</select></div>"}return o+="</div>"},showSortMenu:function(e){require(["dialogHelper","paper-radio-button","paper-radio-group"],function(t){var a=t.createDialog({removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:200});a.classList.add("ui-body-a"),a.classList.add("background-theme-a");var r="";r+='<div style="margin:0;padding:1.25em 1.5em 1.5em;">',r+='<h2 style="margin:0 0 .5em;">',r+=Globalize.translate("HeaderSortBy"),r+="</h2>",r+='<paper-radio-group class="groupSortBy" selected="'+(e.query.SortBy||"").replace(",","_")+'">';for(var i=0,n=e.items.length;n>i;i++){var o=e.items[i];r+='<paper-radio-button class="menuSortBy" style="display:block;" data-id="'+o.id+'" name="'+o.id.replace(",","_")+'">'+o.name+"</paper-radio-button>"}r+="</paper-radio-group>",r+='<h2 style="margin: 1em 0 .5em;">',r+=Globalize.translate("HeaderSortOrder"),r+="</h2>",r+='<paper-radio-group class="groupSortOrder" selected="'+(e.query.SortOrder||"Ascending")+'">',r+='<paper-radio-button name="Ascending" style="display:block;"  class="menuSortOrder block">'+Globalize.translate("OptionAscending")+"</paper-radio-button>",r+='<paper-radio-button name="Descending" style="display:block;"  class="menuSortOrder block">'+Globalize.translate("OptionDescending")+"</paper-radio-button>",r+="</paper-radio-group>",r+="</div>",a.innerHTML=r,l.body.appendChild(a);var s=browserInfo.animate?0:100;setTimeout(function(){t.open(a)},s),a.querySelector(".groupSortBy").addEventListener("iron-select",function(){var t=this.selected.replace("_",","),a=e.query.SortBy!=t;e.query.SortBy=t,e.query.StartIndex=0,e.callback&&a&&e.callback()}),a.querySelector(".groupSortOrder").addEventListener("iron-select",function(){var t=this.selected,a=e.query.SortOrder!=t;e.query.SortOrder=t,e.query.StartIndex=0,e.callback&&a&&e.callback()})})},getRatingHtml:function(e){var t="";return e.CommunityRating&&(t+="<div class='starRating' title='"+e.CommunityRating+"'></div>",t+='<div class="starRatingValue">',t+=e.CommunityRating.toFixed(1),t+="</div>"),null!=e.CriticRating&&(t+=e.CriticRating>=60?'<div class="fresh rottentomatoesicon" title="Rotten Tomatoes"></div>':'<div class="rotten rottentomatoesicon" title="Rotten Tomatoes"></div>',t+='<div class="criticRating" title="Rotten Tomatoes">'+e.CriticRating+"%</div>"),t},getItemProgressBarHtml:function(e){if("Recording"==e.Type&&e.CompletionPercentage)return'<progress class="itemProgressBar recordingProgressBar" min="0" max="100" value="'+e.CompletionPercentage+'"></progress>';var t=e.PlayedPercentage;return t&&100>t?'<progress class="itemProgressBar" min="0" max="100" value="'+t+'"></progress>':null},getUserDataButtonHtml:function(e,t,a,r,i,n){if("fab"==n){var o="paper-fab";return"<"+o+' title="'+i+'" data-itemid="'+t+'" icon="'+r+'" class="'+a+'" onclick="LibraryBrowser.'+e+'(this);return false;"></'+o+">"}return'<button is="paper-icon-button-light" title="'+i+'" data-itemid="'+t+'"  class="'+a+'" onclick="LibraryBrowser.'+e+'(this);return false;"><iron-icon icon="'+r+'"></iron-icon></button>'},getUserDataIconsHtml:function(e,t,a){var r="",i=e.UserData||{},n=e.Id;if(t!==!1){var o=Globalize.translate("TooltipPlayed");("Video"==e.MediaType||"Series"==e.Type||"Season"==e.Type||"BoxSet"==e.Type||"Playlist"==e.Type)&&"TvChannel"!=e.Type&&(r+=i.Played?LibraryBrowser.getUserDataButtonHtml("markPlayed",n,"btnUserItemRating btnUserItemRatingOn","check",o,a):LibraryBrowser.getUserDataButtonHtml("markPlayed",n,"btnUserItemRating","check",o,a))}var s=Globalize.translate("TooltipFavorite");return r+=i.IsFavorite?LibraryBrowser.getUserDataButtonHtml("markFavorite",n,"btnUserItemRating btnUserItemRatingOn","favorite",s,a):LibraryBrowser.getUserDataButtonHtml("markFavorite",n,"btnUserItemRating","favorite",s,a)},markPlayed:function(e){var t=e.getAttribute("data-itemid"),a=!e.classList.contains("btnUserItemRatingOn");a?(ApiClient.markPlayed(Dashboard.getCurrentUserId(),t),e.classList.add("btnUserItemRatingOn")):(ApiClient.markUnplayed(Dashboard.getCurrentUserId(),t),e.classList.remove("btnUserItemRatingOn"))},markFavorite:function(e){require(["jQuery"],function(t){var a=e.getAttribute("data-itemid"),r=t(e),i=!r.hasClass("btnUserItemRatingOn");ApiClient.updateFavoriteStatus(Dashboard.getCurrentUserId(),a,i),i?r.addClass("btnUserItemRatingOn"):r.removeClass("btnUserItemRatingOn")})},renderDetailImage:function(e,t,a,r){var i=t.ImageTags||{};t.PrimaryImageTag&&(i.Primary=t.PrimaryImageTag);var n,o="",s="portrait",l=360,d=!1;r&&i.Thumb?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Thumb",maxHeight:l,tag:t.ImageTags.Thumb}),s="thumb"):i.Primary?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Primary",maxHeight:l,tag:t.ImageTags.Primary}),d=!0):t.BackdropImageTags&&t.BackdropImageTags.length?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Backdrop",maxHeight:l,tag:t.BackdropImageTags[0]}),s="thumb"):i.Thumb?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Thumb",maxHeight:l,tag:t.ImageTags.Thumb}),s="thumb"):i.Disc?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Disc",maxHeight:l,tag:t.ImageTags.Disc}),s="square"):t.AlbumId&&t.AlbumPrimaryImageTag?(n=ApiClient.getScaledImageUrl(t.AlbumId,{type:"Primary",maxHeight:l,tag:t.AlbumPrimaryImageTag}),s="square"):"Audio"==t.MediaType||"MusicAlbum"==t.Type||"MusicGenre"==t.Type?(n="css/images/items/detail/audio.png",s="square"):"Game"==t.MediaType||"GameGenre"==t.Type?(n="css/images/items/detail/game.png",s="square"):"Person"==t.Type?(n="css/images/items/detail/person.png",s="square"):"Genre"==t.Type||"Studio"==t.Type?(n="css/images/items/detail/video.png",s="square"):"TvChannel"==t.Type?(n="css/images/items/detail/tv.png",s="square"):(n="css/images/items/detail/video.png",s="square"),o+='<div style="position:relative;">',a&&(o+="<a onclick='LibraryBrowser.editImages(\""+t.Id+"\");' class='itemDetailGalleryLink' href='#'>"),d&&t.PrimaryImageAspectRatio&&(t.PrimaryImageAspectRatio>=1.48?s="thumb":t.PrimaryImageAspectRatio>=.85&&t.PrimaryImageAspectRatio<=1.34&&(s="square")),o+="<img class='itemDetailImage lazy' src='css/images/empty.png' />",a&&(o+="</a>");var u=t.IsFolder||!t.UserData?"":LibraryBrowser.getItemProgressBarHtml("Recording"==t.Type?t:t.UserData);o+='<div class="detailImageProgressContainer">',u&&(o+=u),o+="</div>",o+="</div>",e.innerHTML=o,"thumb"==s?(e.classList.add("thumbDetailImageContainer"),e.classList.remove("portraitDetailImageContainer"),e.classList.remove("squareDetailImageContainer")):"square"==s?(e.classList.remove("thumbDetailImageContainer"),e.classList.remove("portraitDetailImageContainer"),e.classList.add("squareDetailImageContainer")):(e.classList.remove("thumbDetailImageContainer"),e.classList.add("portraitDetailImageContainer"),e.classList.remove("squareDetailImageContainer"));var m=e.querySelector("img");m.onload=function(){-1==m.src.indexOf("empty.png")&&m.classList.add("loaded")},ImageLoader.lazyImage(m,n)},refreshDetailImageUserData:function(e,t){var a=t.IsFolder||!t.UserData?"":LibraryBrowser.getItemProgressBarHtml("Recording"==t.Type?t:t.UserData),r=e.querySelector(".detailImageProgressContainer");r.innerHTML=a||""},getMiscInfoHtml:function(e){var t,a,r=[];if(e.IsSeries&&!e.IsRepeat&&(require(["livetvcss"]),r.push('<span class="newTvProgram">'+Globalize.translate("AttributeNew")+"</span>")),e.IsLive&&r.push('<span class="liveTvProgram">'+Globalize.translate("AttributeLive")+"</span>"),e.ChannelId&&e.ChannelName&&("Program"==e.Type||"Recording"==e.Type)&&r.push('<a class="textlink" href="itemdetails.html?id='+e.ChannelId+'">'+e.ChannelName+"</a>"),("Episode"==e.Type||"Photo"==e.MediaType)&&e.PremiereDate)try{a=i.parseISO8601Date(e.PremiereDate,!0),t=a.toLocaleDateString(),r.push(t)}catch(n){}if(e.StartDate)try{a=i.parseISO8601Date(e.StartDate,!0),t=a.toLocaleDateString(),r.push(t),"Recording"!=e.Type&&(t=i.getDisplayTime(a),r.push(t))}catch(n){}if(e.ProductionYear&&"Series"==e.Type)if("Continuing"==e.Status)r.push(Globalize.translate("ValueSeriesYearToPresent",e.ProductionYear));else if(e.ProductionYear){if(t=e.ProductionYear,e.EndDate)try{var o=i.parseISO8601Date(e.EndDate,!0).getFullYear();o!=e.ProductionYear&&(t+="-"+i.parseISO8601Date(e.EndDate,!0).getFullYear())}catch(n){}r.push(t)}if("Series"!=e.Type&&"Episode"!=e.Type&&"Photo"!=e.MediaType)if(e.ProductionYear)r.push(e.ProductionYear);else if(e.PremiereDate)try{t=i.parseISO8601Date(e.PremiereDate,!0).getFullYear(),r.push(t)}catch(n){}var s;if(e.RunTimeTicks&&"Series"!=e.Type&&("Audio"==e.Type?r.push(i.getDisplayRunningTime(e.RunTimeTicks)):(s=e.RunTimeTicks/6e8,s=s||1,r.push(Math.round(s)+"min"))),e.CumulativeRunTimeTicks&&"Series"!=e.Type&&"Season"!=e.Type&&r.push(i.getDisplayRunningTime(e.CumulativeRunTimeTicks)),e.OfficialRating&&"Season"!==e.Type&&"Episode"!==e.Type&&r.push(e.OfficialRating),e.IsHD&&r.push(Globalize.translate("LabelHDProgram")),e.Video3DFormat&&r.push("3D"),"Photo"==e.MediaType&&e.Width&&e.Height&&r.push(e.Width+"x"+e.Height),e.SeriesTimerId){var l="";l+='<a href="livetvseriestimer.html?id='+e.SeriesTimerId+'" title="'+Globalize.translate("ButtonViewSeriesRecording")+'">',l+='<div class="timerCircle seriesTimerCircle"></div>',l+='<div class="timerCircle seriesTimerCircle"></div>',l+='<div class="timerCircle seriesTimerCircle"></div>',l+="</a>",r.push(l),require(["livetvcss"])}else if(e.TimerId){var l="";l+='<button type="button" class="clearButton" onclick="LibraryBrowser.editTimer(\''+e.TimerId+"');\">",l+='<div class="timerCircle"></div>',l+="</button>",r.push(l),require(["livetvcss"])}return r.join("&nbsp;&nbsp;&nbsp;&nbsp;")},renderOverview:function(e,t){for(var a=0,r=e.length;r>a;a++){var i=e[a],n=t.Overview||"";if(n){i.innerHTML=n,i.classList.remove("empty");for(var o=i.querySelectorAll("a"),s=0,l=o.length;l>s;s++)o[s].setAttribute("target","_blank")}else i.innerHTML="",i.classList.add("empty")}},renderStudios:function(e,t,a){if(t.Studios&&t.Studios.length&&"Series"!=t.Type){for(var r="",i=0,n=t.Studios.length;n>i;i++)i>0&&(r+="&nbsp;&nbsp;/&nbsp;&nbsp;"),r+=a?t.Studios[i].Name:'<a class="textlink" href="itemdetails.html?id='+t.Studios[i].Id+'">'+t.Studios[i].Name+"</a>";var o=t.Studios.length>1?"ValueStudios":"ValueStudio";r=Globalize.translate(o,r),e.show().html(r).trigger("create")}else e.hide()},renderGenres:function(e,t,a,r){for(var i="",n=t.Genres||[],o=0,s=n.length;s>o&&!(a&&o>=a);o++){o>0&&(i+="<span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>");var l="Audio"==t.Type||"MusicArtist"==t.Type||"MusicAlbum"==t.Type?"musicgenre":"genre";"Game"==t.MediaType&&(l="gamegenre"),i+=r?n[o]:'<a class="textlink" href="itemdetails.html?'+l+"="+ApiClient.encodeName(n[o])+'">'+n[o]+"</a>"}e.html(i).trigger("create")},renderPremiereDate:function(e,t){if(t.PremiereDate)try{var a=i.parseISO8601Date(t.PremiereDate,!0),r=(new Date).getTime()>a.getTime()?"ValuePremiered":"ValuePremieres";e.show().html(Globalize.translate(r,a.toLocaleDateString()))}catch(n){e.hide()}else e.hide()},renderAwardSummary:function(e,t){t.AwardSummary?e.show().html(Globalize.translate("ValueAwards",t.AwardSummary)):e.hide()},renderDetailPageBackdrop:function(e,t){var a,r=d.availWidth,i=!1,n=e.querySelector("#itemBackdrop");return t.BackdropImageTags&&t.BackdropImageTags.length?(a=ApiClient.getScaledImageUrl(t.Id,{type:"Backdrop",index:0,maxWidth:r,tag:t.BackdropImageTags[0]}),n.classList.add("noFade"),n.classList.remove("noBackdrop"),ImageLoader.lazyImage(n,a),i=!0):t.ParentBackdropItemId&&t.ParentBackdropImageTags&&t.ParentBackdropImageTags.length?(a=ApiClient.getScaledImageUrl(t.ParentBackdropItemId,{type:"Backdrop",index:0,tag:t.ParentBackdropImageTags[0],maxWidth:r}),n.classList.add("noFade"),n.classList.remove("noBackdrop"),ImageLoader.lazyImage(n,a),i=!0):(n.classList.add("noBackdrop"),n.style.backgroundImage=""),i}};return h}(window,document,screen);return window.LibraryBrowser=s,s});