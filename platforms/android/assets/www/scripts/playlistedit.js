define(["appStorage","jQuery","listView"],function(e,r,t){function i(){var e=a(),r=l[e];return r||(r=l[e]={query:{Fields:"PrimaryImageAspectRatio,SyncInfo",EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:200},view:LibraryBrowser.getSavedView(e)||LibraryBrowser.getDefaultItemsView("List","List")},r.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(e,r.query)),r}function n(){return i().query}function a(){return LibraryBrowser.getSavedQueryKey()}function o(e,a){Dashboard.showLoadingMsg();var s=n();s.UserId=Dashboard.getCurrentUserId(),ApiClient.getJSON(ApiClient.getUrl("Playlists/"+a.Id+"/Items",s)).then(function(n){window.scrollTo(0,0);var l="";l+=LibraryBrowser.getQueryPagingHtml({startIndex:s.StartIndex,limit:s.Limit,totalRecordCount:n.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1});var d=i().view;"List"==d&&(l=t.getListViewHtml({items:n.Items,sortBy:s.SortBy,showIndex:!1,showRemoveFromPlaylist:!0,playFromHere:!0,action:"playallfromhere",smallIcon:!0,dragHandle:!0,playlistId:a.Id}));var u=e.querySelector("#childrenContent .itemsContainer");u.innerHTML=l,ImageLoader.lazyChildren(u),r(".btnNextPage",u).on("click",function(){s.StartIndex+=s.Limit,o(e,a)}),r(".btnPreviousPage",u).on("click",function(){s.StartIndex-=s.Limit,o(e,a)}),Dashboard.hideLoadingMsg()})}function s(e,r){var t=e.querySelector("#childrenContent .itemsContainer");t.enableDragReordering(!0),t.addEventListener("needsrefresh",function(){o(e,r)})}var l={};window.PlaylistViewer={render:function(e,r){e.playlistInit||(e.playlistInit=!0,s(e,r)),o(e,r)}}});