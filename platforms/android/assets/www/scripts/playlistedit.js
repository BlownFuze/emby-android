!function(e){function r(){var e=a(),r=l[e];return r||(r=l[e]={query:{Fields:"PrimaryImageAspectRatio,SyncInfo",EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()},view:LibraryBrowser.getSavedView(e)||LibraryBrowser.getDefaultItemsView("List","List")},r.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(e,r.query)),r}function t(){return r().query}function a(){return LibraryBrowser.getSavedQueryKey()}function i(a,s){Dashboard.showLoadingMsg();var l=t();l.UserId=Dashboard.getCurrentUserId(),ApiClient.getJSON(ApiClient.getUrl("Playlists/"+s.Id+"/Items",l)).then(function(t){window.scrollTo(0,0);var d="";d+=LibraryBrowser.getQueryPagingHtml({startIndex:l.StartIndex,limit:l.Limit,totalRecordCount:t.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1});var u=r().view;"List"==u&&(d=LibraryBrowser.getListViewHtml({items:t.Items,sortBy:l.SortBy,showIndex:!1,showRemoveFromPlaylist:!0,playFromHere:!0,defaultAction:"playallfromhere",smallIcon:!0}));var g=a.querySelector("#childrenContent .itemsContainer");g.innerHTML=d;for(var y=[],c=g.querySelectorAll("PAPER-ICON-ITEM"),m=0,f=c.length;f>m;m++)y.push(c[m]);var p=g.querySelector(".paperList");AppInfo.isTouchPreferred||require(["sortable"],function(e){new e(p,{draggable:".listItem",onEnd:function(e){n(e,a,s)}})}),ImageLoader.lazyChildren(g),e(g).createCardMenus(),e(g).off("needsrefresh").on("needsrefresh",function(){i(a,s)}).off("removefromplaylist").on("removefromplaylist",function(e,r){o(a,s,[r])}),e(".btnNextPage",g).on("click",function(){l.StartIndex+=l.Limit,i(a,s)}),e(".btnPreviousPage",g).on("click",function(){l.StartIndex-=l.Limit,i(a,s)}),Dashboard.hideLoadingMsg()})}function n(e,r,t){var a=e.item,n=e.newIndex,o=a.getAttribute("data-playlistitemid");Dashboard.showLoadingMsg(),ApiClient.ajax({url:ApiClient.getUrl("Playlists/"+t.Id+"/Items/"+o+"/Move/"+n),type:"POST"}).then(function(){Dashboard.hideLoadingMsg()},function(){Dashboard.hideLoadingMsg(),i(r,t)})}function o(e,r,t){ApiClient.ajax({url:ApiClient.getUrl("Playlists/"+r.Id+"/Items",{EntryIds:t.join(",")}),type:"DELETE"}).then(function(){i(e,r)})}function s(){if(!AppInfo.isTouchPreferred){var e="7";appStorage.getItem("playlistitemdragdrophelp")!=e&&(appStorage.setItem("playlistitemdragdrophelp",e),Dashboard.alert({message:Globalize.translate("TryDragAndDropMessage"),title:Globalize.translate("HeaderTryDragAndDrop")}))}}var l={};window.PlaylistViewer={render:function(e,r){i(e,r),s()}}}(jQuery,document);