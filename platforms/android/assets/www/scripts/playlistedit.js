define(["jQuery","listView"],function(e,r){function t(){var e=i(),r=s[e];return r||(r=s[e]={query:{Fields:"PrimaryImageAspectRatio,SyncInfo",EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:200},view:LibraryBrowser.getSavedView(e)||LibraryBrowser.getDefaultItemsView("List","List")},r.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(e,r.query)),r}function n(){return t().query}function i(){return LibraryBrowser.getSavedQueryKey()}function a(t,i){Dashboard.showLoadingMsg();var o=n();o.UserId=Dashboard.getCurrentUserId(),ApiClient.getJSON(ApiClient.getUrl("Playlists/"+i.Id+"/Items",o)).then(function(n){window.scrollTo(0,0);var s="";s+=LibraryBrowser.getQueryPagingHtml({startIndex:o.StartIndex,limit:o.Limit,totalRecordCount:n.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1}),s+=r.getListViewHtml({items:n.Items,sortBy:o.SortBy,showIndex:!1,showRemoveFromPlaylist:!0,playFromHere:!0,action:"playallfromhere",smallIcon:!0,dragHandle:!0,playlistId:i.Id});var l=t.querySelector("#childrenContent .itemsContainer");l.innerHTML=s,ImageLoader.lazyChildren(l),e(".btnNextPage",l).on("click",function(){o.StartIndex+=o.Limit,a(t,i)}),e(".btnPreviousPage",l).on("click",function(){o.StartIndex-=o.Limit,a(t,i)}),Dashboard.hideLoadingMsg()})}function o(e,r){var t=e.querySelector("#childrenContent .itemsContainer");t.enableDragReordering(!0),t.addEventListener("needsrefresh",function(){a(e,r)})}var s={};window.PlaylistViewer={render:function(e,r){e.playlistInit||(e.playlistInit=!0,o(e,r)),a(e,r)}}});