define(["jQuery","listView"],function(e,r){function t(){var e=n(),r=s[e];return r||(r=s[e]={query:{Fields:"PrimaryImageAspectRatio,SyncInfo",EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:200},view:LibraryBrowser.getSavedView(e)||"List"},r.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(e,r.query)),r}function i(){return t().query}function n(){return LibraryBrowser.getSavedQueryKey()}function a(t,n){Dashboard.showLoadingMsg();var o=i();o.UserId=Dashboard.getCurrentUserId(),ApiClient.getJSON(ApiClient.getUrl("Playlists/"+n.Id+"/Items",o)).then(function(i){window.scrollTo(0,0);var s="";s+=LibraryBrowser.getQueryPagingHtml({startIndex:o.StartIndex,limit:o.Limit,totalRecordCount:i.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1}),s+=r.getListViewHtml({items:i.Items,sortBy:o.SortBy,showIndex:!1,showRemoveFromPlaylist:!0,playFromHere:!0,action:"playallfromhere",smallIcon:!0,dragHandle:!0,playlistId:n.Id});var l=t.querySelector("#childrenContent .itemsContainer");l.classList.add("vertical-list"),l.classList.remove("vertical-wrap"),l.innerHTML=s,ImageLoader.lazyChildren(l),e(".btnNextPage",l).on("click",function(){o.StartIndex+=o.Limit,a(t,n)}),e(".btnPreviousPage",l).on("click",function(){o.StartIndex-=o.Limit,a(t,n)}),Dashboard.hideLoadingMsg()})}function o(e,r){var t=e.querySelector("#childrenContent .itemsContainer");t.enableDragReordering(!0),t.addEventListener("needsrefresh",function(){a(e,r)})}var s={};window.PlaylistViewer={render:function(e,r){e.playlistInit||(e.playlistInit=!0,o(e,r)),a(e,r)}}});