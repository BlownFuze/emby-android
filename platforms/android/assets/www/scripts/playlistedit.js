define(["appStorage","jQuery","listView"],function(e,t,r){function i(){var e=a(),t=l[e];return t||(t=l[e]={query:{Fields:"PrimaryImageAspectRatio,SyncInfo",EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:200},view:LibraryBrowser.getSavedView(e)||LibraryBrowser.getDefaultItemsView("List","List")},t.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(e,t.query)),t}function n(){return i().query}function a(){return LibraryBrowser.getSavedQueryKey()}function o(e,a){Dashboard.showLoadingMsg();var s=n();s.UserId=Dashboard.getCurrentUserId(),ApiClient.getJSON(ApiClient.getUrl("Playlists/"+a.Id+"/Items",s)).then(function(n){window.scrollTo(0,0);var l="";l+=LibraryBrowser.getQueryPagingHtml({startIndex:s.StartIndex,limit:s.Limit,totalRecordCount:n.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1});var d=i().view;"List"==d&&(l=r.getListViewHtml({items:n.Items,sortBy:s.SortBy,showIndex:!1,showRemoveFromPlaylist:!0,playFromHere:!0,action:"playallfromhere",smallIcon:!0,dragHandle:!0}));var u=e.querySelector("#childrenContent .itemsContainer");u.setAttribute("data-playlistid",a.Id),u.innerHTML=l,ImageLoader.lazyChildren(u),t(".btnNextPage",u).on("click",function(){s.StartIndex+=s.Limit,o(e,a)}),t(".btnPreviousPage",u).on("click",function(){s.StartIndex-=s.Limit,o(e,a)}),Dashboard.hideLoadingMsg()})}function s(e,t){var r=e.querySelector("#childrenContent .itemsContainer");r.enableDragReordering(!0),r.addEventListener("needsrefresh",function(){o(e,t)})}var l={};window.PlaylistViewer={render:function(e,t){e.playlistInit||(e.playlistInit=!0,s(e,t)),o(e,t)}}});