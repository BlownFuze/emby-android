define([],function(){function e(e,a){var s=a.userId;ApiClient.getUser(s).then(function(a){Dashboard.getCurrentUser().then(function(s){Dashboard.setPageTitle(a.Name);var t=!0,r=!1;"Guest"==a.ConnectLinkType?(e.querySelector(".localAccessSection").classList.add("hide"),t=!1):a.HasConfiguredPassword?(e.querySelector("#btnResetPassword").classList.remove("hide"),e.querySelector("#fldCurrentPassword").classList.remove("hide"),r=!0):(e.querySelector("#btnResetPassword").classList.add("hide"),e.querySelector("#fldCurrentPassword").classList.add("hide")),t&&(s.Policy.IsAdministrator||a.Policy.EnableUserPreferenceAccess)?e.querySelector(".passwordSection").classList.remove("hide"):e.querySelector(".passwordSection").classList.add("hide"),r&&(s.Policy.IsAdministrator||a.Policy.EnableUserPreferenceAccess)?e.querySelector(".localAccessSection").classList.remove("hide"):e.querySelector(".localAccessSection").classList.add("hide");var o=e.querySelector("#txtEasyPassword");o.value="",a.HasConfiguredEasyPassword?(o.placeholder="******",e.querySelector("#btnResetEasyPassword").classList.remove("hide")):(o.removeAttribute("placeholder"),o.placeholder="",e.querySelector("#btnResetEasyPassword").classList.add("hide")),e.querySelector(".chkEnableLocalEasyPassword").checked=a.Configuration.EnableLocalPassword})}),e.querySelector("#txtCurrentPassword").value="",e.querySelector("#txtNewPassword").value="",e.querySelector("#txtNewPasswordConfirm").value=""}return function(a,s){function t(){var e=s.userId,t=a.querySelector("#txtEasyPassword").value;t?ApiClient.updateEasyPassword(e,t).then(function(){r(e)}):r(e)}function r(t){ApiClient.getUser(t).then(function(t){t.Configuration.EnableLocalPassword=a.querySelector(".chkEnableLocalEasyPassword").checked,ApiClient.updateUserConfiguration(t.Id,t.Configuration).then(function(){Dashboard.hideLoadingMsg(),require(["toast"],function(e){e(Globalize.translate("MessageSettingsSaved"))}),e(a,s)})})}function o(){var t=getParameterByName("userId"),r=a.querySelector("#txtCurrentPassword").value,o=a.querySelector("#txtNewPassword").value;ApiClient.updateUserPassword(t,r,o).then(function(){Dashboard.hideLoadingMsg(),require(["toast"],function(e){e(Globalize.translate("PasswordSaved"))}),e(a,s)},function(){Dashboard.hideLoadingMsg(),Dashboard.alert({title:Globalize.translate("HeaderLoginFailure"),message:Globalize.translate("MessageInvalidUser")})})}function n(e){var a=this;return a.querySelector("#txtNewPassword").value!=a.querySelector("#txtNewPasswordConfirm").value?require(["toast"],function(e){e(Globalize.translate("PasswordMatchError"))}):(Dashboard.showLoadingMsg(),o()),e.preventDefault(),!1}function i(e){return Dashboard.showLoadingMsg(),t(),e.preventDefault(),!1}function l(){var t=Globalize.translate("PasswordResetConfirmation");require(["confirm"],function(r){r(t,Globalize.translate("PasswordResetHeader")).then(function(){var t=getParameterByName("userId");Dashboard.showLoadingMsg(),ApiClient.resetUserPassword(t).then(function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("PasswordResetComplete"),title:Globalize.translate("PasswordResetHeader")}),e(a,s)})})})}function d(){var t=Globalize.translate("PinCodeResetConfirmation");require(["confirm"],function(r){r(t,Globalize.translate("HeaderPinCodeReset")).then(function(){var t=getParameterByName("userId");Dashboard.showLoadingMsg(),ApiClient.resetEasyPassword(t).then(function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("PinCodeResetComplete"),title:Globalize.translate("HeaderPinCodeReset")}),e(a,s)})})})}a.querySelector(".updatePasswordForm").addEventListener("submit",n),a.querySelector(".localAccessForm").addEventListener("submit",i),a.querySelector("#btnResetEasyPassword").addEventListener("click",d),a.querySelector("#btnResetPassword").addEventListener("click",l),a.addEventListener("viewshow",function(){e(a,s)})}});