define(["paperdialoghelper","browser","paper-menu","paper-dialog","scale-up-animation","fade-out-animation"],function(t,e){function n(t,e){for(;!t.classList||!t.classList.contains(e);)if(t=t.parentNode,!t)return null;return t}function i(i){var o="";o+='<div style="margin:0;padding:.8em 1em;">';var a,r=$(window).height();i.positionTo&&r>=540&&(a=$(i.positionTo).offset(),a.top+=$(i.positionTo).innerHeight()/2,a.left+=$(i.positionTo).innerWidth()/2,a.top-=24,a.left-=24,a.top-=55*i.items.length/2,a.left-=80,a.top-=$(window).scrollTop(),a.left-=$(window).scrollLeft(),a.top=Math.min(a.top,$(window).height()-300),a.left=Math.min(a.left,$(window).width()-300),a.top=Math.max(a.top,0),a.left=Math.max(a.left,0)),i.title&&(o+="<h3>",o+=i.title,o+="</h3>");var l=i.items.filter(function(t){return t.ironIcon}),s=l.length,p=i.title&&(!l.length||l.length!=i.items.length);o+=p?'<paper-menu style="text-align:center;">':"<paper-menu>";for(var c=0,d=i.items.length;d>c;c++){var m=i.items[c];o+='<paper-menu-item class="actionSheetMenuItem" data-id="'+m.id+'" style="display:block;">',m.ironIcon?o+=p?'<iron-icon style="margin-right:.5em;" icon="'+m.ironIcon+'"></iron-icon>':'<iron-icon icon="'+m.ironIcon+'"></iron-icon>':s&&!p&&(o+="<iron-icon></iron-icon>"),o+="<span>"+m.name+"</span>",o+="</paper-menu-item>"}o+="</paper-menu>",o+="</div>",i.showCancel&&(o+='<div class="buttons">',o+="<paper-button dialog-dismiss>"+Globalize.translate("ButtonCancel")+"</paper-button>",o+="</div>");var u=t.createDialog({modal:!1,entryAnimationDuration:160,exitAnimationDuration:200,enableHistory:i.enableHistory});u.innerHTML=o,a&&(u.style.position="fixed",u.style.left=a.left+"px",u.style.top=a.top+"px"),document.body.appendChild(u),t.open(u),u.addEventListener("iron-overlay-closed",function(){u.parentNode.removeChild(u)});var f=e.firefox?"mousedown":"click";u.addEventListener(f,function(e){var o=n(e.target,"actionSheetMenuItem");if(o){var a=o.getAttribute("data-id");t.close(u),setTimeout(function(){i.callback&&i.callback(a)},100)}})}return{show:i}});