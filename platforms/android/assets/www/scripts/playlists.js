define(["listView","cardBuilder","libraryBrowser","emby-itemscontainer"],function(e,t,r){return function(a){function i(e){var t=o(e),r=c[t];return r||(r=c[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,CumulativeRunTimeTicks,CanDelete",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()},view:LibraryBrowser.getSavedView(t)||"PosterCard"},r.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(t,r.query)),r}function s(e){return i(e).query}function o(e){return e.savedQueryKey||(e.savedQueryKey=r.getSavedQueryKey()),e.savedQueryKey}function n(){Dashboard.showLoadingMsg()}function u(){Dashboard.hideLoadingMsg()}function l(){var e=i(a).view,t=a.querySelector(".itemsContainer");"List"==e?(t.classList.add("vertical-list"),t.classList.remove("vertical-wrap")):(t.classList.remove("vertical-list"),t.classList.add("vertical-wrap")),t.innerHTML=""}function d(){n();var r=s(a),c=ApiClient.getItems(Dashboard.getCurrentUserId(),r),y=Dashboard.getCurrentUser();Promise.all([c,y]).then(function(s){{var n=s[0];s[1]}window.scrollTo(0,0);var c="",y=i(a).view;a.querySelector(".listTopPaging").innerHTML=LibraryBrowser.getQueryPagingHtml({startIndex:r.StartIndex,limit:r.Limit,totalRecordCount:n.TotalRecordCount,viewButton:!1,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!0,layouts:"List,Poster,PosterCard,Thumb,ThumbCard",currentLayout:y}),n.TotalRecordCount?(c="List"==y?e.getListViewHtml({items:n.Items,sortBy:r.SortBy}):t.getCardsHtml("PosterCard"==y?{items:n.Items,shape:"square",showTitle:!0,lazy:!0,coverImage:!0,showItemCounts:!0,cardLayout:!0}:"Thumb"==y?{items:n.Items,shape:"backdrop",showTitle:!0,centerText:!0,lazy:!0,preferThumb:!0,overlayPlayButton:!0}:"ThumbCard"==y?{items:n.Items,shape:"backdrop",showTitle:!0,lazy:!0,preferThumb:!0,cardLayout:!0,showItemCounts:!0}:{items:n.Items,shape:"square",showTitle:!0,lazy:!0,coverImage:!0,showItemCounts:!0,centerText:!0,overlayPlayButton:!0}),a.querySelector(".noItemsMessage").classList.add("hide")):a.querySelector(".noItemsMessage").classList.remove("hide");var m=a.querySelector(".itemsContainer");m.innerHTML=c,ImageLoader.lazyChildren(m);var v=a.querySelector(".btnNextPage");v&&v.addEventListener("click",function(){r.StartIndex+=r.Limit,d()});var L=a.querySelector(".btnPreviousPage");L&&L.addEventListener("click",function(){r.StartIndex-=r.Limit,d()});var g=a.querySelector(".btnChangeLayout");g&&g.addEventListener("layoutchange",function(e){var t=e.detail.viewStyle;i(a).view=t,LibraryBrowser.saveViewSetting(o(a),t),l(),d()}),LibraryBrowser.saveQueryValues(o(a),r),u()})}var c={};a.addEventListener("viewbeforeshow",function(){d()}),l()}});