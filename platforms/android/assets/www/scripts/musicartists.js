define(["events","libraryBrowser","imageLoader","alphaPicker"],function(e,t,r,n){return function(e,a,i){function o(e){var r=u(e),n=g[r];return n||(n=g[r]={query:{SortBy:"SortName",SortOrder:"Ascending",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,DateCreated,SyncInfo,ItemCounts",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",Limit:LibraryBrowser.getDefaultPageSize()},view:t.getSavedView(r)||t.getDefaultItemsView("PosterCard","PosterCard")},n.query.ParentId=a.topParentId,t.loadSavedQueryValues(r,n.query)),n}function s(e){return o(e).query}function u(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey(y.mode)),e.savedQueryKey}function l(e){Dashboard.showLoadingMsg();var n=s(e),a="albumartists"==y.mode?ApiClient.getAlbumArtists(Dashboard.getCurrentUserId(),n):ApiClient.getArtists(Dashboard.getCurrentUserId(),n);a.then(function(a){function o(){n.StartIndex+=n.Limit,l(i)}function s(){n.StartIndex-=n.Limit,l(i)}window.scrollTo(0,0),d(e);var c,g=LibraryBrowser.getQueryPagingHtml({startIndex:n.StartIndex,limit:n.Limit,totalRecordCount:a.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),m=y.getCurrentViewStyle();c="List"==m?LibraryBrowser.getListViewHtml({items:a.Items,context:"music",sortBy:n.SortBy}):LibraryBrowser.getPosterViewHtml("PosterCard"==m?{items:a.Items,shape:"square",context:"music",showTitle:!0,coverImage:!0,lazy:!0,cardLayout:!0,showSongCount:!0}:{items:a.Items,shape:"square",context:"music",showTitle:!0,coverImage:!0,lazy:!0,centerText:!0,overlayPlayButton:!0});var v,S,h=i.querySelectorAll(".paging");for(v=0,S=h.length;S>v;v++)h[v].innerHTML=g;for(h=i.querySelectorAll(".btnNextPage"),v=0,S=h.length;S>v;v++)h[v].addEventListener("click",o);for(h=i.querySelectorAll(".btnPreviousPage"),v=0,S=h.length;S>v;v++)h[v].addEventListener("click",s);var f=i.querySelector(".itemsContainer");f.innerHTML=c,r.lazyChildren(f),t.saveQueryValues(u(e),n),Dashboard.hideLoadingMsg()})}function d(e){var t=s(e);y.alphaPicker.value(t.NameStartsWithOrGreater)}function c(e){var r=e.querySelector(".alphaPicker");r.addEventListener("alphavaluechanged",function(t){var r=t.detail.value,n=s(e);n.NameStartsWithOrGreater=r,n.StartIndex=0,l(e)}),y.alphaPicker=new n({element:r,valueChangeEvent:"click"}),e.querySelector(".btnFilter").addEventListener("click",function(){y.showFilterMenu()});var a=e.querySelector(".btnSelectView");a.addEventListener("click",function(e){t.showLayoutMenu(e.target,y.getCurrentViewStyle(),"List,Poster,PosterCard".split(","))}),a.addEventListener("layoutchange",function(r){var n=r.detail.viewStyle;o(e).view=n,t.saveViewSetting(u(e),n),s(e).StartIndex=0,l(e)})}var y=this,g={};y.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],function(e){var t=new e({query:s(i),mode:y.mode});Events.on(t,"filterchange",function(){s(i).StartIndex=0,l(i)}),t.show()})},y.getCurrentViewStyle=function(){return o(i).view},c(i),y.renderTab=function(){l(i),d(i)},y.destroy=function(){}}});