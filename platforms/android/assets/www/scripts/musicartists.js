define(["events","libraryBrowser","imageLoader","alphaPicker","listView","emby-itemscontainer"],function(e,t,r,n,a){return function(e,i,o){function s(e){var r=l(e),n=m[r];return n||(n=m[r]={query:{SortBy:"SortName",SortOrder:"Ascending",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,DateCreated,SyncInfo,ItemCounts",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",Limit:LibraryBrowser.getDefaultPageSize()},view:t.getSavedView(r)||t.getDefaultItemsView("PosterCard","PosterCard")},n.query.ParentId=i.topParentId,t.loadSavedQueryValues(r,n.query)),n}function u(e){return s(e).query}function l(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey(g.mode)),e.savedQueryKey}function d(e){Dashboard.showLoadingMsg();var n=u(e),i="albumartists"==g.mode?ApiClient.getAlbumArtists(Dashboard.getCurrentUserId(),n):ApiClient.getArtists(Dashboard.getCurrentUserId(),n);i.then(function(i){function s(){n.StartIndex+=n.Limit,d(o)}function u(){n.StartIndex-=n.Limit,d(o)}window.scrollTo(0,0),c(e);var y,m=LibraryBrowser.getQueryPagingHtml({startIndex:n.StartIndex,limit:n.Limit,totalRecordCount:i.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),v=g.getCurrentViewStyle();y="List"==v?a.getListViewHtml({items:i.Items,sortBy:n.SortBy}):LibraryBrowser.getPosterViewHtml("PosterCard"==v?{items:i.Items,shape:"square",context:"music",showTitle:!0,coverImage:!0,lazy:!0,cardLayout:!0,showSongCount:!0}:{items:i.Items,shape:"square",context:"music",showTitle:!0,coverImage:!0,lazy:!0,centerText:!0,overlayPlayButton:!0});var S,h,f=o.querySelectorAll(".paging");for(S=0,h=f.length;h>S;S++)f[S].innerHTML=m;for(f=o.querySelectorAll(".btnNextPage"),S=0,h=f.length;h>S;S++)f[S].addEventListener("click",s);for(f=o.querySelectorAll(".btnPreviousPage"),S=0,h=f.length;h>S;S++)f[S].addEventListener("click",u);var w=o.querySelector(".itemsContainer");w.innerHTML=y,r.lazyChildren(w),t.saveQueryValues(l(e),n),Dashboard.hideLoadingMsg()})}function c(e){var t=u(e);g.alphaPicker.value(t.NameStartsWithOrGreater)}function y(e){var r=e.querySelector(".alphaPicker");r.addEventListener("alphavaluechanged",function(t){var r=t.detail.value,n=u(e);n.NameStartsWithOrGreater=r,n.StartIndex=0,d(e)}),g.alphaPicker=new n({element:r,valueChangeEvent:"click"}),e.querySelector(".btnFilter").addEventListener("click",function(){g.showFilterMenu()});var a=e.querySelector(".btnSelectView");a.addEventListener("click",function(e){t.showLayoutMenu(e.target,g.getCurrentViewStyle(),"List,Poster,PosterCard".split(","))}),a.addEventListener("layoutchange",function(r){var n=r.detail.viewStyle;s(e).view=n,t.saveViewSetting(l(e),n),u(e).StartIndex=0,d(e)})}var g=this,m={};g.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],function(e){var t=new e({query:u(o),mode:g.mode});Events.on(t,"filterchange",function(){u(o).StartIndex=0,d(o)}),t.show()})},g.getCurrentViewStyle=function(){return s(o).view},y(o),g.renderTab=function(){d(o),c(o)},g.destroy=function(){}}});