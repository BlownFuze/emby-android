var SupporterKeyPage={onPageShow:function(){SupporterKeyPage.load(this)},load:function(e){Dashboard.showLoadingMsg(),ApiClient.getPluginSecurityInfo().then(function(r){$("#txtSupporterKey",e).val(r.SupporterKey),r.SupporterKey&&!r.IsMBSupporter?(e.querySelector("#txtSupporterKey").classList.add("invalidEntry"),$(".notSupporter",e).show()):(e.querySelector("#txtSupporterKey").classList.remove("invalidEntry"),$(".notSupporter",e).hide()),Dashboard.hideLoadingMsg()})},updateSupporterKey:function(){Dashboard.showLoadingMsg();var e=this,r=$("#txtSupporterKey",e).val(),t={SupporterKey:r};return ApiClient.updatePluginSecurityInfo(t).then(function(){Dashboard.resetPluginSecurityInfo(),Dashboard.hideLoadingMsg(),Dashboard.alert(r?{message:Globalize.translate("MessageKeyUpdated"),title:Globalize.translate("HeaderConfirmation")}:{message:Globalize.translate("MessageKeyRemoved"),title:Globalize.translate("HeaderConfirmation")});var t=$(e).parents(".page")[0];SupporterKeyPage.load(t)}),!1},linkSupporterKeys:function(){Dashboard.showLoadingMsg();var e=this,r=$("#txtNewEmail",e).val(),t=$("#txtNewKey",e).val(),a=$("#txtOldKey",e).val(),o={email:r,newkey:t,oldkey:a},s="https://mb3admin.com/admin/service/supporter/linkKeys";return $.post(s,o).then(function(e){var r=JSON.parse(e);Dashboard.hideLoadingMsg(),Dashboard.alert(r.Success?Globalize.translate("MessageKeysLinked"):r.ErrorMessage)}),!1},retrieveSupporterKey:function(){Dashboard.showLoadingMsg();var e=this,r=$("#txtEmail",e).val(),t="https://mb3admin.com/admin/service/supporter/retrievekey?email="+r;return $.post(t).then(function(e){var t=JSON.parse(e);Dashboard.hideLoadingMsg(),Dashboard.alert(t.Success?Globalize.translate("MessageKeyEmailedTo").replace("{0}",r):t.ErrorMessage)}),!1}};$(document).on("pageshow","#supporterKeyPage",SupporterKeyPage.onPageShow),function(){function e(e){Dashboard.getPluginSecurityInfo().then(function(r){r.IsMBSupporter?$(".supporterContainer",e).addClass("hide"):$(".supporterContainer",e).removeClass("hide")})}$(document).on("pageinit","#supporterKeyPage",function(){var e=this;$("#supporterKeyForm").on("submit",SupporterKeyPage.updateSupporterKey),$("#lostKeyForm").on("submit",SupporterKeyPage.retrieveSupporterKey),$("#linkKeysForm").on("submit",SupporterKeyPage.linkSupporterKeys),$(".benefits",e).html(Globalize.translate("HeaderSupporterBenefit",'<a href="http://emby.media/premiere" target="_blank">',"</a>"))}).on("pageshow","#supporterKeyPage",function(){var r=this;e(r)})}();