define(["alphaPicker"],function(e){return function(t,r,a){function i(e){var t=o(e),a=y[t];return a||(a=y[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Movie",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,MediaSourceCount,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()},view:LibraryBrowser.getSavedView(t)||LibraryBrowser.getDefaultItemsView("Poster","Poster")},a.query.ParentId=r.topParentId,LibraryBrowser.loadSavedQueryValues(t,a.query)),a}function n(e){return i(e).query}function o(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("movies")),e.savedQueryKey}function l(e){Dashboard.showLoadingMsg();var t=Dashboard.getCurrentUserId(),r=n(e),m=i(e).view;ApiClient.getItems(t,r).then(function(t){function d(){r.StartIndex+=r.Limit,l(a)}function y(){r.StartIndex-=r.Limit,l(a)}function c(t){var r=t.detail.viewStyle;"Timeline"==r&&(n(e).SortBy="ProductionYear,PremiereDate,SortName",n(e).SortOrder="Descending"),i(e).view=r,LibraryBrowser.saveViewSetting(o(e),r),l(e)}function g(){s(e)}function h(){LibraryBrowser.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionBudget"),id:"Budget,SortName"},{name:Globalize.translate("OptionImdbRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionCriticRating"),id:"CriticRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName"},{name:Globalize.translate("OptionMetascore"),id:"Metascore,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName"},{name:Globalize.translate("OptionRevenue"),id:"Revenue,SortName"},{name:Globalize.translate("OptionRuntime"),id:"Runtime,SortName"},{name:Globalize.translate("OptionVideoBitrate"),id:"VideoBitRate,SortName"}],callback:function(){l(e)},query:r})}window.scrollTo(0,0);var b="",S=LibraryBrowser.getQueryPagingHtml({startIndex:r.StartIndex,limit:r.Limit,totalRecordCount:t.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!0,sortButton:!0,currentLayout:m,layouts:"Banner,List,Poster,PosterCard,Thumb,ThumbCard,Timeline",filterButton:!0});e.querySelector(".listTopPaging").innerHTML=S,u(e),"Thumb"==m?b=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"backdrop",preferThumb:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}):"ThumbCard"==m?b=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"backdrop",preferThumb:!0,lazy:!0,showTitle:!0,cardLayout:!0,showYear:!0,showDetailsMenu:!0}):"Banner"==m?b=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"banner",preferBanner:!0,lazy:!0,showDetailsMenu:!0}):"List"==m?b=LibraryBrowser.getListViewHtml({items:t.Items,sortBy:r.SortBy}):"Poster"==m?b=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"portrait",centerText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}):"PosterCard"==m?b=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"portrait",showTitle:!0,showYear:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0}):"Timeline"==m&&(b=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"portrait",showTitle:!0,timeline:!0,centerText:!0,lazy:!0,showDetailsMenu:!0}));var w=e.querySelector(".itemsContainer");w.innerHTML=b+S,ImageLoader.lazyChildren(w);var v,p,L;for(v=a.querySelectorAll(".btnNextPage"),p=0,L=v.length;L>p;p++)v[p].addEventListener("click",d);for(v=a.querySelectorAll(".btnPreviousPage"),p=0,L=v.length;L>p;p++)v[p].addEventListener("click",y);for(v=a.querySelectorAll(".btnChangeLayout"),p=0,L=v.length;L>p;p++)v[p].addEventListener("layoutchange",c);for(v=a.querySelectorAll(".btnFilter"),p=0,L=v.length;L>p;p++)v[p].addEventListener("click",g);for(v=a.querySelectorAll(".btnSort"),p=0,L=v.length;L>p;p++)v[p].addEventListener("click",h);LibraryBrowser.saveQueryValues(o(e),r),Dashboard.hideLoadingMsg()})}function s(e){require(["components/filterdialog/filterdialog"],function(t){var r=new t({query:n(e),mode:"movies"});Events.on(r,"filterchange",function(){l(e)}),r.show()})}function u(e){var t=n(e);d.alphaPicker.value(t.NameStartsWithOrGreater)}function m(t){var r=t.querySelector(".alphaPicker");r.addEventListener("alphavaluechanged",function(e){var r=e.detail.value,a=n(t);a.NameStartsWithOrGreater=r,a.StartIndex=0,l(t)}),d.alphaPicker=new e({element:r,valueChangeEvent:"click"}),t.querySelector(".itemsContainer").addEventListener("needsrefresh",function(){l(t)})}var d=this,y={};d.initTab=function(){m(a)},d.renderTab=function(){l(a),u(a)}}});