define(["jQuery","alphaPicker"],function(e,t){return function(r,a,i){function n(e){var t=s(e),r=c[t];return r||(r=c[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Movie",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,MediaSourceCount,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()},view:LibraryBrowser.getSavedView(t)||LibraryBrowser.getDefaultItemsView("Poster","Poster")},r.query.ParentId=a.topParentId,LibraryBrowser.loadSavedQueryValues(t,r.query)),r}function o(e){return n(e).query}function s(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("movies")),e.savedQueryKey}function l(t){Dashboard.showLoadingMsg();var r=Dashboard.getCurrentUserId(),a=o(t),i=n(t).view;ApiClient.getItems(r,a).then(function(r){window.scrollTo(0,0);var d="",y=LibraryBrowser.getQueryPagingHtml({startIndex:a.StartIndex,limit:a.Limit,totalRecordCount:r.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!0,sortButton:!0,currentLayout:i,layouts:"Banner,List,Poster,PosterCard,Thumb,ThumbCard,Timeline",filterButton:!0});t.querySelector(".listTopPaging").innerHTML=y,m(t),"Thumb"==i?d=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:"backdrop",preferThumb:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}):"ThumbCard"==i?d=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:"backdrop",preferThumb:!0,lazy:!0,showTitle:!0,cardLayout:!0,showYear:!0,showDetailsMenu:!0}):"Banner"==i?d=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:"banner",preferBanner:!0,lazy:!0,showDetailsMenu:!0}):"List"==i?d=LibraryBrowser.getListViewHtml({items:r.Items,sortBy:a.SortBy}):"Poster"==i?d=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:"portrait",centerText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}):"PosterCard"==i?d=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:"portrait",showTitle:!0,showYear:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0}):"Timeline"==i&&(d=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:"portrait",showTitle:!0,timeline:!0,centerText:!0,lazy:!0,showDetailsMenu:!0}));var c=t.querySelector(".itemsContainer");c.innerHTML=d+y,ImageLoader.lazyChildren(c),e(".btnNextPage",t).on("click",function(){a.StartIndex+=a.Limit,l(t)}),e(".btnPreviousPage",t).on("click",function(){a.StartIndex-=a.Limit,l(t)}),e(".btnChangeLayout",t).on("layoutchange",function(e,r){"Timeline"==r&&(o(t).SortBy="ProductionYear,PremiereDate,SortName",o(t).SortOrder="Descending"),n(t).view=r,LibraryBrowser.saveViewSetting(s(t),r),l(t)}),e(".btnFilter",t).on("click",function(){u(t)}),e(".btnSort",t).on("click",function(){LibraryBrowser.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionBudget"),id:"Budget,SortName"},{name:Globalize.translate("OptionImdbRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionCriticRating"),id:"CriticRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName"},{name:Globalize.translate("OptionMetascore"),id:"Metascore,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName"},{name:Globalize.translate("OptionRevenue"),id:"Revenue,SortName"},{name:Globalize.translate("OptionRuntime"),id:"Runtime,SortName"},{name:Globalize.translate("OptionVideoBitrate"),id:"VideoBitRate,SortName"}],callback:function(){l(t)},query:a})}),LibraryBrowser.saveQueryValues(s(t),a),Dashboard.hideLoadingMsg()})}function u(e){require(["components/filterdialog/filterdialog"],function(t){var r=new t({query:o(e),mode:"movies"});Events.on(r,"filterchange",function(){l(e)}),r.show()})}function m(e){var t=o(e);y.alphaPicker.value(t.NameStartsWithOrGreater)}function d(e){var r=e.querySelector(".alphaPicker");r.addEventListener("alphavaluechanged",function(t){var r=t.detail.value,a=o(e);a.NameStartsWithOrGreater=r,a.StartIndex=0,l(e)}),y.alphaPicker=new t({element:r}),e.querySelector(".itemsContainer").addEventListener("needsrefresh",function(){l(e)})}var y=this,c={};y.initTab=function(){d(i)},y.renderTab=function(){l(i),m(i)}}});