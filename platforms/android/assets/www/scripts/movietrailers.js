define(["jQuery"],function(e){function t(e){var t=a(e),r=l[t];return r||(r=l[t]={query:{SortBy:"SortName",SortOrder:"Ascending",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()}},LibraryBrowser.loadSavedQueryValues(t,r.query)),r.query}function a(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("trailers")),e.savedQueryKey}function r(o){Dashboard.showLoadingMsg();var l=t(o);l.UserId=Dashboard.getCurrentUserId(),ApiClient.getJSON(ApiClient.getUrl("Trailers",l)).then(function(t){window.scrollTo(0,0),t.Items.length?e(".noItemsMessage",o).hide():e(".noItemsMessage",o).show();var s="",u=LibraryBrowser.getQueryPagingHtml({startIndex:l.StartIndex,limit:l.Limit,totalRecordCount:t.TotalRecordCount,sortButton:!0,showLimit:!1,updatePageSizeSetting:!1,filterButton:!0});o.querySelector(".listTopPaging").innerHTML=u,i(o),s=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"portrait",lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0});var d=o.querySelector(".itemsContainer");d.innerHTML=s+u,ImageLoader.lazyChildren(d),e(".btnNextPage",o).on("click",function(){l.StartIndex+=l.Limit,r(o)}),e(".btnPreviousPage",o).on("click",function(){l.StartIndex-=l.Limit,r(o)}),e(".btnFilter",o).on("click",function(){n(o)}),e(".btnSort",o).on("click",function(){LibraryBrowser.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionImdbRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName"}],callback:function(){r(o)},query:l})}),LibraryBrowser.saveQueryValues(a(o),l),Dashboard.hideLoadingMsg()})}function n(e){require(["components/filterdialog/filterdialog"],function(a){var n=new a({query:t(e)});Events.on(n,"filterchange",function(){r(e)}),n.show()})}function i(a){var r=t(a);e(".alphabetPicker",a).alphaValue(r.NameStartsWithOrGreater)}function o(a,n){e(".alphabetPicker",n).on("alphaselect",function(e,i){var o=t(a);o.NameStartsWithOrGreater=i,o.StartIndex=0,r(n)}).on("alphaclear",function(){var e=t(a);e.NameStartsWithOrGreater="",r(n)}),e(".itemsContainer",n).on("needsrefresh",function(){r(n)})}var l={};window.MoviesPage.initTrailerTab=function(e,t){o(e,t)},window.MoviesPage.renderTrailerTab=function(e,t){LibraryBrowser.needsRefresh(t)&&(r(t),i(t))}});