define(["events","libraryBrowser","imageLoader","alphaPicker"],function(e,t,a,r){return function(e,n,i){function o(e){var a=s(e),r=g[a];return r||(r=g[a]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Trailer",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:y},view:t.getSavedView(a)||t.getDefaultItemsView("Poster","Poster")},t.loadSavedQueryValues(a,r.query)),r}function l(e){return o(e).query}function s(e){return e.savedQueryKey||(e.savedQueryKey=t.getSavedQueryKey("trailers")),e.savedQueryKey}function u(){Dashboard.showLoadingMsg();var e=l(i);ApiClient.getItems(Dashboard.getCurrentUserId(),e).then(function(r){function n(){e.StartIndex+=e.Limit,u()}function o(){e.StartIndex-=e.Limit,u()}window.scrollTo(0,0),m(i);var l,d=LibraryBrowser.getQueryPagingHtml({startIndex:e.StartIndex,limit:e.Limit,totalRecordCount:r.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),y=c.getCurrentViewStyle();l="Thumb"==y?t.getPosterViewHtml({items:r.Items,shape:"backdrop",preferThumb:!0,context:"movies",lazy:!0,overlayPlayButton:!0}):"ThumbCard"==y?t.getPosterViewHtml({items:r.Items,shape:"backdrop",preferThumb:!0,context:"movies",lazy:!0,cardLayout:!0,showTitle:!0,showYear:!0}):"Banner"==y?t.getPosterViewHtml({items:r.Items,shape:"banner",preferBanner:!0,context:"movies",lazy:!0}):"List"==y?t.getListViewHtml({items:r.Items,context:"movies",sortBy:e.SortBy}):t.getPosterViewHtml("PosterCard"==y?{items:r.Items,shape:"portrait",context:"movies",showTitle:!0,showYear:!0,lazy:!0,cardLayout:!0}:{items:r.Items,shape:"portrait",context:"movies",centerText:!0,lazy:!0,overlayPlayButton:!0});var g,v,h=i.querySelectorAll(".paging");for(g=0,v=h.length;v>g;g++)h[g].innerHTML=d;for(h=i.querySelectorAll(".btnNextPage"),g=0,v=h.length;v>g;g++)h[g].addEventListener("click",n);for(h=i.querySelectorAll(".btnPreviousPage"),g=0,v=h.length;v>g;g++)h[g].addEventListener("click",o);r.Items.length||(l='<p style="text-align:center;">'+Globalize.translate("MessageNoTrailersFound")+"</p>");var S=i.querySelector(".itemsContainer");S.innerHTML=l,a.lazyChildren(S),t.saveQueryValues(s(i),e),Dashboard.hideLoadingMsg()})}function m(e){var t=l(e);c.alphaPicker.value(t.NameStartsWithOrGreater)}function d(e){var a=e.querySelector(".alphaPicker");a.addEventListener("alphavaluechanged",function(t){var a=t.detail.value,r=l(e);r.NameStartsWithOrGreater=a,r.StartIndex=0,u()}),c.alphaPicker=new r({element:a,valueChangeEvent:"click"}),e.querySelector(".btnFilter").addEventListener("click",function(){c.showFilterMenu()}),e.querySelector(".btnSort").addEventListener("click",function(a){t.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionImdbRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName"}],callback:function(){l(e).StartIndex=0,u()},query:l(e),button:a.target})})}var c=this,y=t.getDefaultPageSize(),g={};c.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],function(e){var t=new e({query:l(i),mode:"movies"});Events.on(t,"filterchange",function(){l(i).StartIndex=0,u()}),t.show()})},c.getCurrentViewStyle=function(){return o(i).view},d(i),c.renderTab=function(){u(),m(i)},c.destroy=function(){}}});