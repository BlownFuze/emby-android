define(["userSettings","appStorage"],function(e,a){function n(n,s){n.querySelector(".chkDisplayMissingEpisodes").checked=s.Configuration.DisplayMissingEpisodes||!1,n.querySelector(".chkDisplayUnairedEpisodes").checked=s.Configuration.DisplayUnairedEpisodes||!1,n.querySelector("#selectThemeSong").value=a.getItem("enableThemeSongs-"+s.Id)||"",n.querySelector("#selectBackdrop").value=a.getItem("enableBackdrops-"+s.Id)||"",n.querySelector("#selectLanguage").value=e.language()||"",Dashboard.hideLoadingMsg()}function s(n,s){return s.Configuration.DisplayMissingEpisodes=n.querySelector(".chkDisplayMissingEpisodes").checked,s.Configuration.DisplayUnairedEpisodes=n.querySelector(".chkDisplayUnairedEpisodes").checked,e.language(n.querySelector("#selectLanguage").value),a.setItem("enableThemeSongs-"+s.Id,n.querySelector("#selectThemeSong").value),a.setItem("enableBackdrops-"+s.Id,n.querySelector("#selectBackdrop").value),ApiClient.updateUserConfiguration(s.Id,s.Configuration)}function t(e){var a=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(a).then(function(a){s(e,a).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})}return function(e){e.querySelector(".displayPreferencesForm").addEventListener("submit",function(a){return t(e),a.preventDefault(),!1}),AppInfo.enableAutoSave?e.querySelector(".btnSave").classList.add("hide"):e.querySelector(".btnSave").classList.remove("hide"),e.addEventListener("viewshow",function(){var a=this;Dashboard.showLoadingMsg();var s=getParameterByName("userId")||Dashboard.getCurrentUserId();ApiClient.getUser(s).then(function(s){n(a,s);for(var t=e.querySelectorAll(".requiresUserPreferences"),r=0,i=t.length;i>r;r++)s.Policy.EnableUserPreferenceAccess?t[r].classList.remove("hide"):t[r].classList.add("hide")}),AppInfo.supportsUserDisplayLanguageSetting?a.querySelector(".languageSection").classList.remove("hide"):a.querySelector(".languageSection").classList.add("hide")}),e.addEventListener("viewbeforehide",function(){var e=this;AppInfo.enableAutoSave&&t(e)})}});