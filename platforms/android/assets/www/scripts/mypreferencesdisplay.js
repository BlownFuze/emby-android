define(["userSettings"],function(e){function a(a,n){a.querySelector(".chkDisplayMissingEpisodes").checked=n.Configuration.DisplayMissingEpisodes||!1,a.querySelector(".chkDisplayUnairedEpisodes").checked=n.Configuration.DisplayUnairedEpisodes||!1,a.querySelector(".chkGroupMoviesIntoCollections").checked=n.Configuration.GroupMoviesIntoBoxSets||!1,$("#selectThemeSong",a).val(appStorage.getItem("enableThemeSongs-"+n.Id)||""),$("#selectBackdrop",a).val(appStorage.getItem("enableBackdrops-"+n.Id)||""),$("#selectLanguage",a).val(e.language()||""),Dashboard.hideLoadingMsg()}function n(a,n){return n.Configuration.DisplayMissingEpisodes=a.querySelector(".chkDisplayMissingEpisodes").checked,n.Configuration.DisplayUnairedEpisodes=a.querySelector(".chkDisplayUnairedEpisodes").checked,n.Configuration.GroupMoviesIntoBoxSets=a.querySelector(".chkGroupMoviesIntoCollections").checked,e.language(a.querySelector("#selectLanguage").value),appStorage.setItem("enableThemeSongs-"+n.Id,$("#selectThemeSong",a).val()),appStorage.setItem("enableBackdrops-"+n.Id,$("#selectBackdrop",a).val()),ApiClient.updateUserConfiguration(n.Id,n.Configuration)}function s(e){var a=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(a).then(function(a){n(e,a).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})}function o(){var e=$(this).parents(".page")[0];return s(e),!1}pageIdOn("pageinit","displayPreferencesPage",function(){var e=this;$(".displayPreferencesForm").off("submit",o).on("submit",o),AppInfo.enableAutoSave?e.querySelector(".btnSave").classList.add("hide"):e.querySelector(".btnSave").classList.remove("hide")}),pageIdOn("pageshow","displayPreferencesPage",function(){var e=this;Dashboard.showLoadingMsg();var n=getParameterByName("userId")||Dashboard.getCurrentUserId();ApiClient.getUser(n).then(function(n){a(e,n),n.Policy.EnableUserPreferenceAccess?$(".requiresUserPreferences",e).show():$(".requiresUserPreferences",e).hide()}),$(".fldEnableBackdrops",e).show(),AppInfo.supportsUserDisplayLanguageSetting?$(".languageSection",e).show():$(".languageSection",e).hide()}),pageIdOn("pagebeforehide","displayPreferencesPage",function(){var e=this;AppInfo.enableAutoSave&&s(e)})});