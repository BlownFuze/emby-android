define(["jQuery"],function(e){function t(t,a,n,i){var r=i.OperatingSystem.toLowerCase();-1!=r.indexOf("windows")?e("#windowsStartupDescription",t).show():e("#windowsStartupDescription",t).hide(),i.SupportsAutoRunAtStartup?e("#fldRunAtStartup",t).show():e("#fldRunAtStartup",t).hide(),t.querySelector("#txtServerName").value=a.ServerName||"",t.querySelector("#txtCachePath").value=a.CachePath||"",e("#selectLocalizationLanguage",t).html(n.map(function(e){return'<option value="'+e.Value+'">'+e.Name+"</option>"})).val(a.UICulture),o=a.UICulture,e("#chkUsageData",t).checked(a.EnableAnonymousUsageReporting),e("#chkRunAtStartup",t).checked(a.RunAtStartup),i.CanSelfUpdate?(e(".fldAutomaticUpdates",t).show(),e(".lnlAutomaticUpdateLevel",t).html(Globalize.translate("LabelAutomaticUpdateLevel"))):(e(".fldAutomaticUpdates",t).hide(),e(".lnlAutomaticUpdateLevel",t).html(Globalize.translate("LabelAutomaticUpdateLevelForPlugins"))),e("#chkEnableAutomaticServerUpdates",t).checked(a.EnableAutoUpdate),e("#chkEnableAutomaticRestart",t).checked(a.EnableAutomaticRestart),i.CanSelfRestart?e("#fldEnableAutomaticRestart",t).show():e("#fldEnableAutomaticRestart",t).hide(),e("#selectAutomaticUpdateLevel",t).val(a.SystemUpdateLevel).trigger("change"),e("#chkEnableDashboardResponseCache",t).checked(a.EnableDashboardResponseCaching),e("#chkEnableMinification",t).checked(a.EnableDashboardResourceMinification),e("#txtDashboardSourcePath",t).val(a.DashboardSourcePath).trigger("change"),Dashboard.hideLoadingMsg()}function a(){Dashboard.showLoadingMsg();{var t=this;e(t).parents(".page")}return ApiClient.getServerConfiguration().then(function(a){a.ServerName=t.querySelector("#txtServerName").value,a.UICulture=e("#selectLocalizationLanguage",t).val(),a.CachePath=t.querySelector("#txtCachePath").value,a.UICulture!=o&&Dashboard.showDashboardRefreshNotification(),a.EnableAnonymousUsageReporting=e("#chkUsageData",t).checked(),a.RunAtStartup=e("#chkRunAtStartup",t).checked(),a.SystemUpdateLevel=e("#selectAutomaticUpdateLevel",t).val(),a.EnableAutomaticRestart=e("#chkEnableAutomaticRestart",t).checked(),a.EnableAutoUpdate=e("#chkEnableAutomaticServerUpdates",t).checked(),a.EnableDashboardResourceMinification=e("#chkEnableMinification",t).checked(),a.EnableDashboardResponseCaching=e("#chkEnableDashboardResponseCache",t).checked(),a.DashboardSourcePath=e("#txtDashboardSourcePath",t).val(),ApiClient.updateServerConfiguration(a).then(function(){ApiClient.getNamedConfiguration(i).then(function(e){e.LoginDisclaimer=t.querySelector("#txtLoginDisclaimer").value,e.CustomCss=t.querySelector("#txtCustomCss").value;var a=n&&e.CustomCss!=n.CustomCss;ApiClient.updateNamedConfiguration(i,e).then(Dashboard.processServerConfigurationUpdateResult),a&&Dashboard.showDashboardRefreshNotification()})})}),!1}var n,o,i="branding";return function(o){e("#selectAutomaticUpdateLevel",o).on("change",function(){"Dev"==this.value?e("#devBuildWarning",o).show():e("#devBuildWarning",o).hide()}),e("#btnSelectCachePath",o).on("click.selectDirectory",function(){require(["directorybrowser"],function(e){var t=new e;t.show({callback:function(e){e&&(o.querySelector("#txtCachePath").value=e),t.close()},header:Globalize.translate("HeaderSelectServerCachePath"),instruction:Globalize.translate("HeaderSelectServerCachePathHelp")})})}),e(".dashboardGeneralForm",o).off("submit",a).on("submit",a),o.addEventListener("viewshow",function(){var e=ApiClient.getServerConfiguration(),a=ApiClient.getJSON(ApiClient.getUrl("Localization/Options")),r=ApiClient.getSystemInfo();Promise.all([e,a,r]).then(function(e){t(o,e[0],e[1],e[2])}),ApiClient.getNamedConfiguration(i).then(function(e){n=e,o.querySelector("#txtLoginDisclaimer").value=e.LoginDisclaimer||"",o.querySelector("#txtCustomCss").value=e.CustomCss||""})})}});