define(["jQuery"],function(e){function t(t,r,o){Dashboard.lastSystemInfo&&Dashboard.setPageTitle(Dashboard.lastSystemInfo.ServerName),a(t),t.querySelector("#txtServerName").value=r.ServerName||"",t.querySelector("#txtCachePath").value=r.CachePath||"",e("#selectLocalizationLanguage",t).html(o.map(function(e){return'<option value="'+e.Value+'">'+e.Name+"</option>"})).val(r.UICulture),n=r.UICulture,Dashboard.hideLoadingMsg()}function a(){ApiClient.getSystemInfo().then(function(e){Dashboard.setPageTitle(e.ServerName)})}function r(){Dashboard.showLoadingMsg();var t=this,r=e(t).parents(".page");return ApiClient.getServerConfiguration().then(function(s){s.ServerName=t.querySelector("#txtServerName").value,s.UICulture=e("#selectLocalizationLanguage",t).val(),s.CachePath=t.querySelector("#txtCachePath").value,s.UICulture!=n&&Dashboard.showDashboardRefreshNotification(),ApiClient.updateServerConfiguration(s).then(function(){a(r),ApiClient.getNamedConfiguration(i).then(function(e){e.LoginDisclaimer=t.querySelector("#txtLoginDisclaimer").value,e.CustomCss=t.querySelector("#txtCustomCss").value;var a=o&&e.CustomCss!=o.CustomCss;ApiClient.updateNamedConfiguration(i,e).then(Dashboard.processServerConfigurationUpdateResult),a&&Dashboard.showDashboardRefreshNotification()})})}),!1}var o,n,i="branding";e(document).on("pageinit","#dashboardGeneralPage",function(){var t=this;e("#btnSelectCachePath",t).on("click.selectDirectory",function(){require(["directorybrowser"],function(e){var a=new e;a.show({callback:function(e){e&&(t.querySelector("#txtCachePath").value=e),a.close()},header:Globalize.translate("HeaderSelectServerCachePath"),instruction:Globalize.translate("HeaderSelectServerCachePathHelp")})})}),e(".dashboardGeneralForm").off("submit",r).on("submit",r)}).on("pageshow","#dashboardGeneralPage",function(){Dashboard.showLoadingMsg();var e=this,a=ApiClient.getServerConfiguration(),r=ApiClient.getJSON(ApiClient.getUrl("Localization/Options"));Promise.all([a,r]).then(function(a){t(e,a[0],a[1])}),ApiClient.getNamedConfiguration(i).then(function(t){o=t,e.querySelector("#txtLoginDisclaimer").value=t.LoginDisclaimer||"",e.querySelector("#txtCustomCss").value=t.CustomCss||""})})});