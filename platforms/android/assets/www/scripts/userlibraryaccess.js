define(["jQuery"],function(e){function c(c,n,i){var l="";l+='<div class="paperListLabel">'+Globalize.translate("HeaderLibraries")+"</div>",l+='<div class="paperCheckboxList paperList">';for(var a=0,t=i.length;t>a;a++){var s=i[a],r=n.Policy.EnableAllFolders||-1!=n.Policy.EnabledFolders.indexOf(s.Id),o=r?' checked="checked"':"";l+='<paper-checkbox class="chkFolder" data-id="'+s.Id+'" type="checkbox"'+o+">"+s.Name+"</paper-checkbox>"}l+="</div>",e(".folderAccess",c).html(l).trigger("create"),e("#chkEnableAllFolders",c).checked(n.Policy.EnableAllFolders).trigger("change")}function n(c,n,i){var l="";l+='<div class="paperListLabel">'+Globalize.translate("HeaderChannels")+"</div>",l+='<div class="paperCheckboxList paperList">';for(var a=0,t=i.length;t>a;a++){var s=i[a],r=n.Policy.EnableAllChannels||-1!=n.Policy.EnabledChannels.indexOf(s.Id),o=r?' checked="checked"':"";l+='<paper-checkbox class="chkChannel" data-id="'+s.Id+'" type="checkbox"'+o+">"+s.Name+"</paper-checkbox>"}l+="</div>",e(".channelAccess",c).show().html(l).trigger("create"),i.length?e(".channelAccessContainer",c).show():e(".channelAccessContainer",c).hide(),e("#chkEnableAllChannels",c).checked(n.Policy.EnableAllChannels).trigger("change")}function i(c,n,i){var l="";l+='<div class="paperListLabel">'+Globalize.translate("HeaderDevices")+"</div>",l+='<div class="paperCheckboxList paperList">';for(var a=0,t=i.length;t>a;a++){var s=i[a],r=n.Policy.EnableAllDevices||-1!=n.Policy.EnabledDevices.indexOf(s.Id)?' checked="checked"':"";l+='<paper-checkbox class="chkChannel" data-id="'+s.Id+'" type="checkbox"'+r+">"+s.Name+" - "+s.AppName+"</paper-checkbox>"}l+="</div>",e(".deviceAccess",c).show().html(l).trigger("create"),e("#chkEnableAllDevices",c).checked(n.Policy.EnableAllDevices).trigger("change"),n.Policy.IsAdministrator?c.querySelector(".deviceAccessContainer").classList.add("hide"):c.querySelector(".deviceAccessContainer").classList.remove("hide")}function l(l,a,t,s,r,o){e(l).trigger("userloaded",[a]),Dashboard.setPageTitle(a.Name),n(l,a,r),c(l,a,s),i(l,a,o),Dashboard.hideLoadingMsg()}function a(){Dashboard.hideLoadingMsg(),require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})}function t(c,n){c.Policy.EnableAllFolders=e("#chkEnableAllFolders",n).checked(),c.Policy.EnabledFolders=c.Policy.EnableAllFolders?[]:e(".chkFolder",n).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-id")}),c.Policy.EnableAllChannels=e("#chkEnableAllChannels",n).checked(),c.Policy.EnabledChannels=c.Policy.EnableAllChannels?[]:e(".chkChannel",n).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-id")}),c.Policy.EnableAllDevices=e("#chkEnableAllDevices",n).checked(),c.Policy.EnabledDevices=c.Policy.EnableAllDevices?[]:e(".chkDevice",n).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-id")}),c.Policy.BlockedChannels=null,c.Policy.BlockedMediaFolders=null,ApiClient.updateUserPolicy(c.Id,c.Policy).then(function(){a(n)})}function s(){var c=e(this).parents(".page");Dashboard.showLoadingMsg();var n=getParameterByName("userId");return ApiClient.getUser(n).then(function(e){t(e,c)}),!1}e(document).on("pageinit","#userLibraryAccessPage",function(){var c=this;e("#chkEnableAllDevices",c).on("change",function(){this.checked?e(".deviceAccessListContainer",c).hide():e(".deviceAccessListContainer",c).show()}),e("#chkEnableAllChannels",c).on("change",function(){this.checked?e(".channelAccessListContainer",c).hide():e(".channelAccessListContainer",c).show()}),e("#chkEnableAllFolders",c).on("change",function(){this.checked?e(".folderAccessListContainer",c).hide():e(".folderAccessListContainer",c).show()}),e(".userLibraryAccessForm").off("submit",s).on("submit",s)}).on("pageshow","#userLibraryAccessPage",function(){var c=this;Dashboard.showLoadingMsg();var n,i=getParameterByName("userId");if(i)n=ApiClient.getUser(i);else{var a=e.Deferred();a.resolveWith(null,[{Configuration:{}}]),n=a.promise()}var t=Dashboard.getCurrentUser(),s=ApiClient.getJSON(ApiClient.getUrl("Library/MediaFolders",{IsHidden:!1})),r=ApiClient.getJSON(ApiClient.getUrl("Channels")),o=ApiClient.getJSON(ApiClient.getUrl("Devices",{SupportsPersistentIdentifier:!0}));Promise.all([n,t,s,r,o]).then(function(e){l(c,e[0],e[1],e[2].Items,e[3].Items,e[4].Items)})})});