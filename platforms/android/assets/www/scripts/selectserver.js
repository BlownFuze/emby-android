!function(){function e(e,a){Dashboard.showLoadingMsg(),ConnectionManager.connectToServer(a).then(function(e){Dashboard.hideLoadingMsg();var a=e.ApiClient;switch(e.State){case MediaBrowser.ConnectionState.SignedIn:Dashboard.onServerChanged(a.getCurrentUserId(),a.accessToken(),a),Dashboard.navigate("home.html");break;case MediaBrowser.ConnectionState.ServerSignIn:Dashboard.onServerChanged(null,null,a),Dashboard.navigate("login.html?serverid="+e.Servers[0].Id);break;case MediaBrowser.ConnectionState.ServerUpdateNeeded:Dashboard.alert({message:Globalize.translate("ServerUpdateNeeded",'<a href="https://emby.media">https://emby.media</a>')});break;default:n()}})}function n(){Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")})}function a(e){var n="";return n+='<paper-icon-item class="serverItem" data-id="'+e.Id+'">',n+='<paper-fab mini class="blue lnkServer" icon="wifi" item-icon></paper-fab>',n+='<paper-item-body class="lnkServer" two-line>',n+='<a class="clearLink" href="#">',n+="<div>",n+=e.Name,n+="</div>",n+="</a>",n+="</paper-item-body>",e.Id&&(n+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="btnServerMenu"></paper-icon-button>'),n+="</paper-icon-item>"}function t(n,t){t.length?($(".noServersMessage",n).hide(),$(".serverList",n).show()):($(".noServersMessage",n).show(),$(".serverList",n).hide());var o="";o+=t.map(a).join("");var i=$(".serverList",n).html(o);$(".lnkServer",i).on("click",function(){var a=$(this).parents(".serverItem")[0],o=a.getAttribute("data-id"),i=t.filter(function(e){return e.Id==o})[0];e(n,i)}),$(".btnServerMenu",i).on("click",function(){c(this)})}function o(){setTimeout(function(){Dashboard.hideModalLoadingMsg(),Dashboard.alert({message:Globalize.translate("DefaultErrorMessage")})},300)}function i(e,n){Dashboard.showModalLoadingMsg(),ConnectionManager.acceptServer(n).then(function(){Dashboard.hideModalLoadingMsg(),u(e)},function(){o()})}function r(e,n){Dashboard.showModalLoadingMsg(),ConnectionManager.deleteServer(n).then(function(){Dashboard.hideModalLoadingMsg(),u(e)},function(){o()})}function s(e,n){Dashboard.showModalLoadingMsg(),ConnectionManager.rejectServer(n).then(function(){Dashboard.hideModalLoadingMsg(),u(e)},function(){o()})}function c(e){var n=$(e).parents(".serverItem"),a=$(e).parents(".page"),t=n.attr("data-id"),o=[];o.push({name:Globalize.translate("ButtonDelete"),id:"delete",ironIcon:"delete"}),require(["actionsheet"],function(n){n.show({items:o,positionTo:e,callback:function(e){switch(e){case"delete":r(a,t)}}})})}function d(e){var n=$(e).parents(".inviteItem"),a=$(e).parents(".page"),t=n.attr("data-id"),o=[];o.push({name:Globalize.translate("ButtonAccept"),id:"accept",ironIcon:"add"}),o.push({name:Globalize.translate("ButtonReject"),id:"reject",ironIcon:"cancel"}),require(["actionsheet"],function(n){n.show({items:o,positionTo:e,callback:function(e){switch(e){case"accept":i(a,t);break;case"reject":s(a,t)}}})})}function l(e){var n="";return n+='<paper-icon-item class="inviteItem" data-id="'+e.Id+'">',n+='<paper-fab mini class="blue lnkServer" icon="wifi" item-icon></paper-fab>',n+="<paper-item-body two-line>",n+="<div>",n+=e.Name,n+="</div>",n+="</paper-item-body>",n+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="btnInviteMenu"></paper-icon-button>',n+="</paper-icon-item>"}function h(e,n){n.length?$(".invitationSection",e).show():$(".invitationSection",e).hide();var a=n.map(l).join(""),t=$(".invitationList",e).html(a);$(".btnInviteMenu",t).on("click",function(){d(this)})}function g(e){ConnectionManager.isLoggedIntoConnect()?ConnectionManager.getUserInvitations().then(function(n){h(e,n)}):h(e,[])}function u(e){Dashboard.showLoadingMsg(),ConnectionManager.getAvailableServers().then(function(n){n=n.slice(0),t(e,n),Dashboard.hideLoadingMsg()}),g(e),ConnectionManager.isLoggedIntoConnect()?$(".connectLogin",e).hide():$(".connectLogin",e).show()}function p(e){"1"==getParameterByName("showuser")?$(e).addClass("libraryPage").addClass("noSecondaryNavPage").removeClass("standalonePage"):$(e).removeClass("libraryPage").removeClass("noSecondaryNavPage").addClass("standalonePage")}pageIdOn("pagebeforeshow","selectServerPage",function(){var e=this;p(e)}),pageIdOn("pageshow","selectServerPage",function(){var e=this;u(e)})}();