define(["paper-icon-button-light"],function(){function e(e){"1"==getParameterByName("showuser")?(e.classList.add("libraryPage"),e.classList.add("noSecondaryNavPage"),e.classList.remove("standalonePage")):(e.classList.add("standalonePage"),e.classList.remove("noSecondaryNavPage"),e.classList.remove("libraryPage"))}function n(){Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")})}function t(e){var n="";return n+='<paper-icon-item class="serverItem" data-id="'+e.Id+'">',n+='<paper-fab mini class="blue lnkServer" icon="wifi" item-icon></paper-fab>',n+='<paper-item-body class="lnkServer" two-line>',n+='<a class="clearLink" href="#">',n+="<div>",n+=e.Name,n+="</div>",n+="</a>",n+="</paper-item-body>",e.Id&&(n+='<button is="paper-icon-button-light" class="btnServerMenu"><iron-icon icon="'+AppInfo.moreIcon+'"></iron-icon></button>'),n+="</paper-icon-item>"}function a(e,n){n.length?(e.querySelector(".noServersMessage").classList.add("hide"),e.querySelector(".serverList").classList.remove("hide")):(e.querySelector(".serverList").classList.add("hide"),e.querySelector(".noServersMessage").classList.remove("hide"));var a="";a+=n.map(t).join(""),e.querySelector(".serverList").innerHTML=a}function i(){Dashboard.hideModalLoadingMsg(),Dashboard.alert({message:Globalize.translate("DefaultErrorMessage")})}function o(e,n){for(;!e.classList||!e.classList.contains(n);)if(e=e.parentNode,!e)return null;return e}return function(t){function r(e,t){Dashboard.showLoadingMsg(),ConnectionManager.connectToServer(t).then(function(e){Dashboard.hideLoadingMsg();var t=e.ApiClient;switch(e.State){case MediaBrowser.ConnectionState.SignedIn:Dashboard.onServerChanged(t.getCurrentUserId(),t.accessToken(),t),Dashboard.navigate("home.html");break;case MediaBrowser.ConnectionState.ServerSignIn:Dashboard.onServerChanged(null,null,t),Dashboard.navigate("login.html?serverid="+e.Servers[0].Id);break;case MediaBrowser.ConnectionState.ServerUpdateNeeded:Dashboard.alert(alert({text:Globalize.translate("core#ServerUpdateNeeded","https://emby.media"),html:Globalize.translate("core#ServerUpdateNeeded",'<a href="https://emby.media">https://emby.media</a>')}));break;default:n()}})}function s(e,n){Dashboard.showModalLoadingMsg(),ConnectionManager.acceptServer(n).then(function(){Dashboard.hideModalLoadingMsg(),b(e)},function(){i()})}function c(e,n){Dashboard.showModalLoadingMsg(),ConnectionManager.deleteServer(n).then(function(){Dashboard.hideModalLoadingMsg(),b(e)},function(){i()})}function d(e,n){Dashboard.showModalLoadingMsg(),ConnectionManager.rejectServer(n).then(function(){Dashboard.hideModalLoadingMsg(),b(e)},function(){i()})}function l(e){var n=o(e,"serverItem"),t=o(e,"page"),a=n.getAttribute("data-id"),i=[];i.push({name:Globalize.translate("ButtonDelete"),id:"delete",ironIcon:"delete"}),require(["actionsheet"],function(n){n.show({items:i,positionTo:e,callback:function(e){switch(e){case"delete":c(t,a)}}})})}function u(e){var n=o(e,"inviteItem"),t=o(e,"page"),a=n.getAttribute("data-id"),i=[];i.push({name:Globalize.translate("ButtonAccept"),id:"accept",ironIcon:"add"}),i.push({name:Globalize.translate("ButtonReject"),id:"reject",ironIcon:"cancel"}),require(["actionsheet"],function(n){n.show({items:i,positionTo:e,callback:function(e){switch(e){case"accept":s(t,a);break;case"reject":d(t,a)}}})})}function h(e){var n="";return n+='<paper-icon-item class="inviteItem" data-id="'+e.Id+'">',n+='<paper-fab mini class="blue lnkServer" icon="wifi" item-icon></paper-fab>',n+="<paper-item-body two-line>",n+="<div>",n+=e.Name,n+="</div>",n+="</paper-item-body>",n+='<button is="paper-icon-button-light" class="btnInviteMenu"><iron-icon icon="'+AppInfo.moreIcon+'"></iron-icon></button>',n+="</paper-icon-item>"}function g(e,n){n.length?e.querySelector(".invitationSection").classList.remove("hide"):e.querySelector(".invitationSection").classList.add("hide");var t=n.map(h).join("");e.querySelector(".invitationList").innerHTML=t}function v(e){ConnectionManager.isLoggedIntoConnect()?ConnectionManager.getUserInvitations().then(function(n){g(e,n)}):g(e,[])}function b(e){Dashboard.showLoadingMsg(),ConnectionManager.getAvailableServers().then(function(n){n=n.slice(0),p=n,a(e,n),Dashboard.hideLoadingMsg()}),v(e),ConnectionManager.isLoggedIntoConnect()?e.querySelector(".connectLogin").classList.add("hide"):e.querySelector(".connectLogin").classList.remove("hide")}var p;t.querySelector(".invitationList").addEventListener("click",function(e){var n=o(e.target,"btnInviteMenu");n&&u(n)}),t.querySelector(".serverList").addEventListener("click",function(e){var n=o(e.target,"lnkServer");if(n){var t=o(n,"serverItem"),a=t.getAttribute("data-id"),i=p.filter(function(e){return e.Id==a})[0];r(page,i)}var s=o(e.target,"btnServerMenu");s&&l(s)}),t.addEventListener("viewbeforeshow",function(){e(this)}),t.addEventListener("viewshow",function(){b(this)})}});