var LoginPage={getApiClient:function(){var a=getParameterByName("serverid");return new Promise(function(e){e(a?ConnectionManager.getOrCreateApiClient(a):ApiClient)})},onPageShow:function(){Dashboard.showLoadingMsg();var a=this;LoginPage.getApiClient().then(function(e){e.getPublicUsers().then(function(t){var n=!t.length;n?LoginPage.showManualForm(a,!1,!1):(LoginPage.showVisualForm(a),LoginPage.loadUserList(a,e,t)),Dashboard.hideLoadingMsg()}),e.getJSON(e.getUrl("Branding/Configuration")).then(function(e){$(".disclaimer",a).html(e.LoginDisclaimer||"")})}),Dashboard.isConnectMode()?$(".connectButtons",a).show():$(".connectButtons",a).hide()},cancelLogin:function(){LoginPage.showVisualForm($.mobile.activePage)},showManualForm:function(a,e,t){$(".visualLoginForm",a).hide(),$(".manualLoginForm",a).show(),t?$("#txtManualPassword input",a).focus():$("#txtManualName input",a).focus(),e?$(".btnCancel",a).show():$(".btnCancel",a).hide()},showVisualForm:function(a){$(".visualLoginForm",a).show(),$(".manualLoginForm",a).hide()},getLastSeenText:function(a){return a?"Last seen "+humane_date(a):""},authenticateUserByName:function(a,e,t,n){Dashboard.showLoadingMsg(),e.authenticateUserByName(t,n).then(function(a){var t,n=a.User,i=getParameterByName("serverid");t=n.Policy.IsAdministrator&&!i?"dashboard.html":"home.html",Dashboard.hideLoadingMsg(),Dashboard.onServerChanged(n.Id,a.AccessToken,e),Dashboard.navigate(t)},function(){$("#pw",a).val(""),$("#txtManualName",a).val(""),$("#txtManualPassword",a).val(""),Dashboard.hideLoadingMsg(),setTimeout(function(){require(["toast"],function(a){a(Globalize.translate("MessageInvalidUser"))})},300)})},loadUserList:function(a,e,t){for(var n="",i=0,o=t.length;o>i;i++){var s=t[i];n+='<div class="card squareCard bottomPaddedCard"><div class="cardBox visualCardBox">',n+='<div class="cardScalable">',n+='<div class="cardPadder"></div>',n+='<a class="cardContent" href="#" data-ajax="false" data-haspw="'+s.HasPassword+'" data-username="'+s.Name+'" data-userid="'+s.Id+'">';var r;if(s.PrimaryImageTag)r=e.getUserImageUrl(s.Id,{width:300,tag:s.PrimaryImageTag,type:"Primary"}),n+='<div class="cardImage" style="background-image:url(\''+r+"');\"></div>";else{var g=LibraryBrowser.getMetroColor(s.Id);r="css/images/logindefault.png",n+='<div class="cardImage" style="background-image:url(\''+r+"');background-color:"+g+';"></div>'}n+="</a>",n+="</div>",n+='<div class="cardFooter">',n+='<div class="cardText">'+s.Name+"</div>",n+='<div class="cardText">';var d=LoginPage.getLastSeenText(s.LastActivityDate);n+=""!=d?d:"&nbsp;",n+="</div>",n+="</div>",n+="</div>",n+="</div>"}var l=$("#divUsers",a).html(n);$("a",l).on("click",function(){var t=this.getAttribute("data-userid"),n=this.getAttribute("data-username"),i=this.getAttribute("data-haspw");"manual"==t?LoginPage.showManualForm(a,!0):"false"==i?LoginPage.authenticateUserByName(a,e,n,""):($("#txtManualName",a).val(n),$("#txtManualPassword",a).val(""),LoginPage.showManualForm(a,!0,!0))})},onManualSubmit:function(){var a=$(this).parents(".page");return LoginPage.getApiClient().then(function(e){LoginPage.authenticateUserByName(a,e,$("#txtManualName",a).val(),$("#txtManualPassword",a).val())}),!1}};$(document).on("pageinit","#loginPage",function(){var a=this;$(".manualLoginForm",a).off("submit",LoginPage.onManualSubmit).on("submit",LoginPage.onManualSubmit),$(".btnForgotPassword",a).on("click",function(){Dashboard.navigate("forgotpassword.html")})}).on("pageshow","#loginPage",LoginPage.onPageShow);