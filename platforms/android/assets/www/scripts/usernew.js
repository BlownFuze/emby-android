!function(e,n,a){function l(n,a){var l="";l+='<fieldset data-role="controlgroup">',l+="<legend>"+Globalize.translate("HeaderLibraries")+"</legend>";for(var t=0,r=a.length;r>t;t++){var i=a[t],c="mediaFolder"+t,s=' checked="checked"';l+='<input class="chkFolder" data-id="'+i.Id+'" type="checkbox" id="'+c+'"'+s+" />",l+='<label for="'+c+'">'+i.Name+"</label>"}l+="</fieldset>",e(".folderAccess",n).html(l).trigger("create"),e("#chkEnableAllFolders",n).checked(!0).checkboxradio("refresh").trigger("change")}function t(n,a){var l="";l+='<fieldset data-role="controlgroup">',l+="<legend>"+Globalize.translate("HeaderChannels")+"</legend>";for(var t=0,r=a.length;r>t;t++){var i=a[t],c="channels"+t,s=' checked="checked"';l+='<input class="chkChannel" data-id="'+i.Id+'" type="checkbox" id="'+c+'"'+s+" />",l+='<label for="'+c+'">'+i.Name+"</label>"}l+="</fieldset>",e(".channelAccess",n).show().html(l).trigger("create"),a.length?e(".channelAccessContainer",n).show():e(".channelAccessContainer",n).hide(),e("#chkEnableAllChannels",n).checked(!0).checkboxradio("refresh").trigger("change")}function r(n){e("#txtUserName",n).val(""),Dashboard.showLoadingMsg();var a=ApiClient.getJSON(ApiClient.getUrl("Library/MediaFolders",{IsHidden:!1})),r=ApiClient.getJSON(ApiClient.getUrl("Channels"));Promise.all([a,r]).then(function(e){l(n,e[0].Items),t(n,e[1].Items),Dashboard.hideLoadingMsg()})}function i(n){var a=e("#txtUserName",n).val();ApiClient.createUser(a).then(function(a){a.Policy.EnableAllFolders=e("#chkEnableAllFolders",n).checked(),a.Policy.EnabledFolders=a.Policy.EnableAllFolders?[]:e(".chkFolder:checked",n).map(function(){return this.getAttribute("data-id")}).get(),a.Policy.EnableAllChannels=e("#chkEnableAllChannels",n).checked(),a.Policy.EnabledChannels=a.Policy.EnableAllChannels?[]:e(".chkChannel:checked",n).map(function(){return this.getAttribute("data-id")}).get(),ApiClient.updateUserPolicy(a.Id,a.Policy).then(function(){Dashboard.navigate("useredit.html?userId="+a.Id)})},function(e){400==e.status?Dashboard.alert({message:n.querySelector(".labelNewUserNameHelp").innerHTML}):require(["toast"],function(e){e(Globalize.translate("DefaultErrorMessage"))}),Dashboard.hideLoadingMsg()})}function c(){var n=e(this).parents(".page")[0];return Dashboard.showLoadingMsg(),i(n),!1}function s(e){r(e)}e(a).on("pageinit","#newUserPage",function(){var n=this;e("#chkEnableAllChannels",n).on("change",function(){this.checked?e(".channelAccessListContainer",n).hide():e(".channelAccessListContainer",n).show()}),e("#chkEnableAllFolders",n).on("change",function(){this.checked?e(".folderAccessListContainer",n).hide():e(".folderAccessListContainer",n).show()}),e(".newUserProfileForm").off("submit",c).on("submit",c)}).on("pageshow","#newUserPage",function(){var e=this;s(e)})}(jQuery,window,document);