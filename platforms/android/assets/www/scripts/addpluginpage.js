!function(e,i,t){function a(i,t){for(var a="",n=0,s=Math.min(i.versions.length,10);s>n;n++){var r=i.versions[n];a+='<h2 style="margin:.5em 0;">'+r.versionStr+" ("+r.classification+")</h2>",a+='<div style="margin-bottom:1.5em;">'+r.description+"</div>"}e("#revisionHistory",t).html(a)}function n(i,t,a){for(var n="",s=0,r=i.versions.length;r>s;s++){var l=i.versions[s];n+='<option value="'+l.versionStr+"|"+l.classification+'">'+l.versionStr+" ("+l.classification+")</option>"}var o=e("#selectVersion",t).html(n);a||e("#pCurrentVersion",t).hide().html("");var g=i.versions.filter(function(e){return"Release"==e.classification})[0];if(g||(g=i.versions.filter(function(e){return"Beta"==e.classification})[0]),g){var h=g.versionStr+"|"+g.classification;o.val(h)}}function s(i,t){ApiClient.getPackageReviews(i,null,null,3).then(function(i){var a="";if(i&&i.length>0){a+='<div data-role="collapsible" data-collapsed="true" style="margin-top: 2em;" >',a+="<h3>"+Globalize.translate("HeaderLatestReviews")+"</h3>",a+="<div><br/>";for(var n=0;n<i.length;n++){var s=i[n];a+="<div>",a+="<span class='storeItemReviewText'>",a+=new Date(s.timestamp).toDateString(),a+=" "+RatingHelpers.getStoreRatingHtml(s.rating,s.id,s.name,!0),a+=" "+s.title,a+="</span>",s.review&&(a+="<p class='storeItemReviewText'>",a+=s.review,a+="</p>"),a+="</div>",a+="<hr/>"}a+="</div>",a+="</div>"}e("#latestReviews",t).html(a).trigger("create")})}function r(i,t,r,l){var o=t.filter(function(e){return e.Name==i.name})[0];if(n(i,l,o),a(i,l),i.totalRatings>0&&s(i.id,l),e(".pluginName",l).html(i.name),"Server"==i.targetSystem)e("#btnInstallDiv",l).removeClass("hide"),e("#nonServerMsg",l).hide(),e("#pSelectVersion",l).removeClass("hide");else{e("#btnInstallDiv",l).addClass("hide"),e("#pSelectVersion",l).addClass("hide");var g=Globalize.translate("MessageInstallPluginFromApp");e("#nonServerMsg",l).html(g).show()}i.shortDescription?e("#tagline",l).show().html(i.shortDescription):e("#tagline",l).hide(),e("#overview",l).html(i.overview||""),e("#developer",l).html(i.owner),RegistrationServices.renderPluginInfo(l,i,r);var h=RatingHelpers.getStoreRatingHtml(i.avgRating,i.id,i.name);if(h+="<span class='storeReviewCount'>",h+=" "+Globalize.translate("ValueReviewCount").replace("{0}",i.totalRatings),h+="</span>",e("#ratingLine",l).html(h),i.richDescUrl?(e("#pViewWebsite",l).show(),e("#pViewWebsite a",l).attr("href",i.richDescUrl)):e("#pViewWebsite",l).hide(),i.previewImage||i.thumbImage){var d=i.tileColor||"#38c",u=i.previewImage?i.previewImage:i.thumbImage;e("#pPreviewImage",l).show().html("<img src='"+u+"' style='max-width: 100%;-moz-box-shadow: 0 0 20px 3px "+d+";-webkit-box-shadow: 0 0 20px 3px "+d+";box-shadow: 0 0 20px 3px "+d+";' />")}else e("#pPreviewImage",l).hide().html("");if(o){var v=Globalize.translate("MessageYouHaveVersionInstalled").replace("{0}","<strong>"+o.Version+"</strong>");e("#pCurrentVersion",l).show().html(v)}else e("#pCurrentVersion",l).hide().html("");Dashboard.hideLoadingMsg()}function l(i,t,a,n,s){var r=e("#developer",i).html().toLowerCase(),l=function(e){e&&(Dashboard.showLoadingMsg(),ApiClient.installPlugin(t,a,n,s).then(function(){Dashboard.hideLoadingMsg()}))};if("luke"!=r&&"ebr"!=r){Dashboard.hideLoadingMsg();var o=Globalize.translate("MessagePluginInstallDisclaimer");o+="<br/>",o+="<br/>",o+=Globalize.translate("PleaseConfirmPluginInstallation"),require(["confirm"],function(e){e(o,Globalize.translate("HeaderConfirmPluginInstallation")).then(function(){l(!0)},function(){l(!1)})})}else l(!0)}function o(){var i=this;i.onSubmit=function(){Dashboard.showLoadingMsg();var i=e(this).parents("#addPluginPage")[0];i.querySelector("#btnInstall").disabled=!0;var t=getParameterByName("name"),a=getParameterByName("guid");return ApiClient.getInstalledPlugins().then(function(n){var s=n.filter(function(e){return e.Name==t})[0],r=e("#selectVersion",i).val().split("|"),o=r[0];s&&s.Version==o?(Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("MessageAlreadyInstalled"),title:Globalize.translate("HeaderPluginInstallation")})):l(i,t,a,r[1],o)}),!1}}e(i).on("pageinit","#addPluginPage",function(){e(".addPluginForm").off("submit",AddPluginPage.onSubmit).on("submit",AddPluginPage.onSubmit)}).on("pageshow","#addPluginPage",function(){var e=this;Dashboard.showLoadingMsg();var i=getParameterByName("name"),t=getParameterByName("guid"),a=ApiClient.getPackageInfo(i,t),n=ApiClient.getInstalledPlugins(),s=ApiClient.getPluginSecurityInfo();Promise.all([a,n,s]).then(function(i){r(i[0],i[1],i[2],e)})}).on("pagebeforeshow pageinit pageshow","#addPluginPage",function(){var i=this,t=getParameterByName("context");e(".syncTabs",i).hide(),e(".pluginTabs",i).hide(),e(".livetvTabs",i).hide(),e(".notificationsTabs",i).hide(),"sync"==t?(e(".syncTabs",i).show(),i.setAttribute("data-helpurl","https://github.com/MediaBrowser/Wiki/wiki/Sync"),Dashboard.setPageTitle(Globalize.translate("TitleSync"))):"livetv"==t?(e(".livetvTabs",i).show(),Dashboard.setPageTitle(Globalize.translate("TitleLiveTV")),i.setAttribute("data-helpurl","https://github.com/MediaBrowser/Wiki/wiki/Live%20TV")):"notifications"==t?(e(".notificationsTabs",i).show(),Dashboard.setPageTitle(Globalize.translate("TitleNotifications")),i.setAttribute("data-helpurl","https://github.com/MediaBrowser/Wiki/wiki/Notifications")):(e(".pluginTabs",i).show(),i.setAttribute("data-helpurl","https://github.com/MediaBrowser/Wiki/wiki/Plugins"),Dashboard.setPageTitle(Globalize.translate("TitlePlugins")))}),t.AddPluginPage=new o}(jQuery,document,window);