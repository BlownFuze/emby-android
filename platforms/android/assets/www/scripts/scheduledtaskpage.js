Array.prototype.remove=function(e,i){var r=this.slice((i||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,r)};var ScheduledTaskPage={refreshScheduledTask:function(){Dashboard.showLoadingMsg();var e=getParameterByName("id");ApiClient.getScheduledTask(e).then(ScheduledTaskPage.loadScheduledTask)},loadScheduledTask:function(e){var i=$($.mobile.activePage)[0];$(".taskName",i).html(e.Name),$("#pTaskDescription",i).html(e.Description),require(["paper-fab","paper-item-body","paper-icon-item"],function(){ScheduledTaskPage.loadTaskTriggers(i,e)}),Dashboard.hideLoadingMsg()},loadTaskTriggers:function(e,i){var r="";r+='<div class="paperList">';for(var t=0,a=i.Triggers.length;a>t;t++){var l=i.Triggers[t];if(r+="<paper-icon-item>",r+='<paper-fab mini icon="schedule" class="blue" item-icon></paper-fab>',r+="<paper-item-body two-line>",r+="<div>"+ScheduledTaskPage.getTriggerFriendlyName(l)+"</div>",l.MaxRuntimeMs){r+="<div secondary>";var n=l.MaxRuntimeMs/36e5;r+=1==n?Globalize.translate("ValueTimeLimitSingleHour"):Globalize.translate("ValueTimeLimitMultiHour",n),r+="</div>"}r+="</paper-item-body>",r+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonDelete")+'" onclick="ScheduledTaskPage.confirmDeleteTrigger('+t+');"><iron-icon icon="delete"></iron-icon></button>',r+="</paper-icon-item>"}r+="</div>",e.querySelector(".taskTriggers").innerHTML=r},getTriggerFriendlyName:function(e){if("DailyTrigger"==e.Type)return"Daily at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("WeeklyTrigger"==e.Type)return e.DayOfWeek+"s at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("SystemEventTrigger"==e.Type&&"WakeFromSleep"==e.SystemEvent)return"On wake from sleep";if("IntervalTrigger"==e.Type){var i=e.IntervalTicks/36e9;return.25==i?"Every 15 minutes":.5==i?"Every 30 minutes":.75==i?"Every 45 minutes":1==i?"Every hour":"Every "+i+" hours"}return"StartupTrigger"==e.Type?"On application startup":e.Type},getDisplayTime:function(e){var i=e/36e9;1>i&&(i=0),i=Math.floor(i),e-=36e9*i;var r=Math.floor(e/6e8),t="am";return i>11&&(t="pm"),i%=12,0==i&&(i=12),10>r&&(r="0"+r),i+":"+r+" "+t},showAddTriggerPopup:function(){var e=$.mobile.activePage;$("#selectTriggerType",e).val("DailyTrigger").trigger("change"),$("#popupAddTrigger",e).on("popupafteropen",function(){$("#addTriggerForm input:first",this).focus()}).popup("open").on("popupafterclose",function(){$("#addTriggerForm",e).off("submit"),$(this).off("popupafterclose")})},confirmDeleteTrigger:function(e){require(["confirm"],function(i){i(Globalize.translate("MessageDeleteTaskTrigger"),Globalize.translate("HeaderDeleteTaskTrigger")).then(function(){ScheduledTaskPage.deleteTrigger(e)})})},deleteTrigger:function(e){Dashboard.showLoadingMsg();var i=getParameterByName("id");ApiClient.getScheduledTask(i).then(function(i){i.Triggers.remove(e),ApiClient.updateScheduledTaskTriggers(i.Id,i.Triggers).then(function(){ScheduledTaskPage.refreshScheduledTask()})})},refreshTriggerFields:function(e){var i=$.mobile.activePage;"DailyTrigger"==e?($("#fldTimeOfDay",i).show(),$("#fldDayOfWeek",i).hide(),$("#fldSelectSystemEvent",i).hide(),$("#fldSelectInterval",i).hide(),$("#txtTimeOfDay",i).attr("required","required")):"WeeklyTrigger"==e?($("#fldTimeOfDay",i).show(),$("#fldDayOfWeek",i).show(),$("#fldSelectSystemEvent",i).hide(),$("#fldSelectInterval",i).hide(),$("#txtTimeOfDay",i).attr("required","required")):"SystemEventTrigger"==e?($("#fldTimeOfDay",i).hide(),$("#fldDayOfWeek",i).hide(),$("#fldSelectSystemEvent",i).show(),$("#fldSelectInterval",i).hide(),$("#txtTimeOfDay",i).removeAttr("required")):"IntervalTrigger"==e?($("#fldTimeOfDay",i).hide(),$("#fldDayOfWeek",i).hide(),$("#fldSelectSystemEvent",i).hide(),$("#fldSelectInterval",i).show(),$("#txtTimeOfDay",i).removeAttr("required")):"StartupTrigger"==e&&($("#fldTimeOfDay",i).hide(),$("#fldDayOfWeek",i).hide(),$("#fldSelectSystemEvent",i).hide(),$("#fldSelectInterval",i).hide(),$("#txtTimeOfDay",i).removeAttr("required"))},getTriggerToAdd:function(){var e=$.mobile.activePage,i={Type:$("#selectTriggerType",e).val()};"DailyTrigger"==i.Type?i.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($("#txtTimeOfDay",e).val()):"WeeklyTrigger"==i.Type?(i.DayOfWeek=$("#selectDayOfWeek",e).val(),i.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($("#txtTimeOfDay",e).val())):"SystemEventTrigger"==i.Type?i.SystemEvent=$("#selectSystemEvent",e).val():"IntervalTrigger"==i.Type&&(i.IntervalTicks=$("#selectInterval",e).val());var r=$("#txtTimeLimit",e).val()||"0";return r=36e5*parseFloat(r),i.MaxRuntimeMs=r||null,i},getTimeOfDayTicks:function(e){var i=e.split(":"),r=i[0],t=i[1].split(" ")[0],a=60*r*60*1e3*1e4;return a+=60*t*1e3*1e4}};!function(){function e(){Dashboard.showLoadingMsg();var e=getParameterByName("id");return ApiClient.getScheduledTask(e).then(function(e){e.Triggers.push(ScheduledTaskPage.getTriggerToAdd()),ApiClient.updateScheduledTaskTriggers(e.Id,e.Triggers).then(function(){$("#popupAddTrigger").popup("close"),ScheduledTaskPage.refreshScheduledTask()})}),!1}$(document).on("pageinit","#scheduledTaskPage",function(){var i=this;$(".addTriggerForm").off("submit",e).on("submit",e),i.querySelector(".timeFieldExample").innerHTML=Globalize.translate("ValueExample","1:00 PM")}).on("pageshow","#scheduledTaskPage",function(){ScheduledTaskPage.refreshScheduledTask()})}();