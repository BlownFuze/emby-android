Array.prototype.remove=function(e,r){var i=this.slice((r||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,i)};var ScheduledTaskPage={refreshScheduledTask:function(){Dashboard.showLoadingMsg();var e=getParameterByName("id");ApiClient.getScheduledTask(e).then(ScheduledTaskPage.loadScheduledTask)},loadScheduledTask:function(e){var r=$($.mobile.activePage)[0];$(".taskName",r).html(e.Name),$("#pTaskDescription",r).html(e.Description),require(["paper-fab","paper-item-body","paper-icon-item"],function(){ScheduledTaskPage.loadTaskTriggers(r,e)}),Dashboard.hideLoadingMsg()},loadTaskTriggers:function(e,r){var i="";i+='<div class="paperList">';for(var t=0,a=r.Triggers.length;a>t;t++){var l=r.Triggers[t];if(i+="<paper-icon-item>",i+='<paper-fab mini icon="schedule" class="blue" item-icon></paper-fab>',i+="<paper-item-body two-line>",i+="<div>"+ScheduledTaskPage.getTriggerFriendlyName(l)+"</div>",l.MaxRuntimeMs){i+="<div secondary>";var d=l.MaxRuntimeMs/36e5;i+=1==d?Globalize.translate("ValueTimeLimitSingleHour"):Globalize.translate("ValueTimeLimitMultiHour",d),i+="</div>"}i+="</paper-item-body>",i+='<paper-icon-button icon="delete" title="'+Globalize.translate("ButtonDelete")+'" onclick="ScheduledTaskPage.confirmDeleteTrigger('+t+');"></paper-icon-button>',i+="</paper-icon-item>"}i+="</div>",e.querySelector(".taskTriggers").innerHTML=i},getTriggerFriendlyName:function(e){if("DailyTrigger"==e.Type)return"Daily at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("WeeklyTrigger"==e.Type)return e.DayOfWeek+"s at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("SystemEventTrigger"==e.Type&&"WakeFromSleep"==e.SystemEvent)return"On wake from sleep";if("IntervalTrigger"==e.Type){var r=e.IntervalTicks/36e9;return.25==r?"Every 15 minutes":.5==r?"Every 30 minutes":.75==r?"Every 45 minutes":1==r?"Every hour":"Every "+r+" hours"}return"StartupTrigger"==e.Type?"On application startup":e.Type},getDisplayTime:function(e){var r=e/36e9;1>r&&(r=0),r=Math.floor(r),e-=36e9*r;var i=Math.floor(e/6e8),t="am";return r>11&&(t="pm"),r%=12,0==r&&(r=12),10>i&&(i="0"+i),r+":"+i+" "+t},showAddTriggerPopup:function(){var e=$.mobile.activePage;$("#selectTriggerType",e).val("DailyTrigger").trigger("change"),$("#popupAddTrigger",e).on("popupafteropen",function(){$("#addTriggerForm input:first",this).focus()}).popup("open").on("popupafterclose",function(){$("#addTriggerForm",e).off("submit"),$(this).off("popupafterclose")})},confirmDeleteTrigger:function(e){Dashboard.confirm(Globalize.translate("MessageDeleteTaskTrigger"),Globalize.translate("HeaderDeleteTaskTrigger"),function(r){r&&ScheduledTaskPage.deleteTrigger(e)})},deleteTrigger:function(e){Dashboard.showLoadingMsg();var r=getParameterByName("id");ApiClient.getScheduledTask(r).then(function(r){r.Triggers.remove(e),ApiClient.updateScheduledTaskTriggers(r.Id,r.Triggers).then(function(){ScheduledTaskPage.refreshScheduledTask()})})},refreshTriggerFields:function(e){var r=$.mobile.activePage;"DailyTrigger"==e?($("#fldTimeOfDay",r).show(),$("#fldDayOfWeek",r).hide(),$("#fldSelectSystemEvent",r).hide(),$("#fldSelectInterval",r).hide(),$("#txtTimeOfDay",r).attr("required","required")):"WeeklyTrigger"==e?($("#fldTimeOfDay",r).show(),$("#fldDayOfWeek",r).show(),$("#fldSelectSystemEvent",r).hide(),$("#fldSelectInterval",r).hide(),$("#txtTimeOfDay",r).attr("required","required")):"SystemEventTrigger"==e?($("#fldTimeOfDay",r).hide(),$("#fldDayOfWeek",r).hide(),$("#fldSelectSystemEvent",r).show(),$("#fldSelectInterval",r).hide(),$("#txtTimeOfDay",r).removeAttr("required")):"IntervalTrigger"==e?($("#fldTimeOfDay",r).hide(),$("#fldDayOfWeek",r).hide(),$("#fldSelectSystemEvent",r).hide(),$("#fldSelectInterval",r).show(),$("#txtTimeOfDay",r).removeAttr("required")):"StartupTrigger"==e&&($("#fldTimeOfDay",r).hide(),$("#fldDayOfWeek",r).hide(),$("#fldSelectSystemEvent",r).hide(),$("#fldSelectInterval",r).hide(),$("#txtTimeOfDay",r).removeAttr("required"))},getTriggerToAdd:function(){var e=$.mobile.activePage,r={Type:$("#selectTriggerType",e).val()};"DailyTrigger"==r.Type?r.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($("#txtTimeOfDay",e).val()):"WeeklyTrigger"==r.Type?(r.DayOfWeek=$("#selectDayOfWeek",e).val(),r.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($("#txtTimeOfDay",e).val())):"SystemEventTrigger"==r.Type?r.SystemEvent=$("#selectSystemEvent",e).val():"IntervalTrigger"==r.Type&&(r.IntervalTicks=$("#selectInterval",e).val());var i=$("#txtTimeLimit",e).val()||"0";return i=36e5*parseFloat(i),r.MaxRuntimeMs=i||null,r},getTimeOfDayTicks:function(e){var r=e.split(":"),i=r[0],t=r[1].split(" ")[0],a=60*i*60*1e3*1e4;return a+=60*t*1e3*1e4}};!function(){function e(){Dashboard.showLoadingMsg();var e=getParameterByName("id");return ApiClient.getScheduledTask(e).then(function(e){e.Triggers.push(ScheduledTaskPage.getTriggerToAdd()),ApiClient.updateScheduledTaskTriggers(e.Id,e.Triggers).then(function(){$("#popupAddTrigger").popup("close"),ScheduledTaskPage.refreshScheduledTask()})}),!1}$(document).on("pageinit","#scheduledTaskPage",function(){$(".addTriggerForm").off("submit",e).on("submit",e)}).on("pageshow","#scheduledTaskPage",function(){ScheduledTaskPage.refreshScheduledTask()})}();