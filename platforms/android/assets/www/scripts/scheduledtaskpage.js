Array.prototype.remove=function(e,t){var i=this.slice((t||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,i)};var ScheduledTaskPage={refreshScheduledTask:function(){Dashboard.showLoadingMsg();var e=getParameterByName("id");ApiClient.getScheduledTask(e).then(ScheduledTaskPage.loadScheduledTask)},loadScheduledTask:function(e){var t=$($.mobile.activePage)[0];$(".taskName",t).html(e.Name),$("#pTaskDescription",t).html(e.Description),require(["listViewStyle"],function(){ScheduledTaskPage.loadTaskTriggers(t,e)}),Dashboard.hideLoadingMsg()},loadTaskTriggers:function(e,t){var i="";i+='<div class="paperList">';for(var r=0,a=t.Triggers.length;a>r;r++){var l=t.Triggers[r];if(i+='<div class="listItem">',i+='<i class="md-icon listItemIcon">schedule</i>',i+='<div class="listItemBody two-line">',i+="<div class='listItemBodyText'>"+ScheduledTaskPage.getTriggerFriendlyName(l)+"</div>",l.MaxRuntimeMs){i+='<div class="listItemBodyText secondary">';var s=l.MaxRuntimeMs/36e5;i+=1==s?Globalize.translate("ValueTimeLimitSingleHour"):Globalize.translate("ValueTimeLimitMultiHour",s),i+="</div>"}i+="</div>",i+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonDelete")+'" onclick="ScheduledTaskPage.confirmDeleteTrigger('+r+');"><i class="md-icon">delete</i></button>',i+="</div>"}i+="</div>",e.querySelector(".taskTriggers").innerHTML=i},getTriggerFriendlyName:function(e){if("DailyTrigger"==e.Type)return"Daily at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("WeeklyTrigger"==e.Type)return e.DayOfWeek+"s at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("SystemEventTrigger"==e.Type&&"WakeFromSleep"==e.SystemEvent)return"On wake from sleep";if("IntervalTrigger"==e.Type){var t=e.IntervalTicks/36e9;return.25==t?"Every 15 minutes":.5==t?"Every 30 minutes":.75==t?"Every 45 minutes":1==t?"Every hour":"Every "+t+" hours"}return"StartupTrigger"==e.Type?"On application startup":e.Type},getDisplayTime:function(e){var t=e/36e9;1>t&&(t=0),t=Math.floor(t),e-=36e9*t;var i=Math.floor(e/6e8),r="am";return t>11&&(r="pm"),t%=12,0==t&&(t=12),10>i&&(i="0"+i),t+":"+i+" "+r},showAddTriggerPopup:function(){var e=$.mobile.activePage;$("#selectTriggerType",e).val("DailyTrigger").trigger("change"),$("#popupAddTrigger",e).on("popupafteropen",function(){$("#addTriggerForm input:first",this).focus()}).popup("open").on("popupafterclose",function(){$("#addTriggerForm",e).off("submit"),$(this).off("popupafterclose")})},confirmDeleteTrigger:function(e){require(["confirm"],function(t){t(Globalize.translate("MessageDeleteTaskTrigger"),Globalize.translate("HeaderDeleteTaskTrigger")).then(function(){ScheduledTaskPage.deleteTrigger(e)})})},deleteTrigger:function(e){Dashboard.showLoadingMsg();var t=getParameterByName("id");ApiClient.getScheduledTask(t).then(function(t){t.Triggers.remove(e),ApiClient.updateScheduledTaskTriggers(t.Id,t.Triggers).then(function(){ScheduledTaskPage.refreshScheduledTask()})})},refreshTriggerFields:function(e){var t=$.mobile.activePage;"DailyTrigger"==e?($("#fldTimeOfDay",t).show(),$("#fldDayOfWeek",t).hide(),$("#fldSelectSystemEvent",t).hide(),$("#fldSelectInterval",t).hide(),$("#txtTimeOfDay",t).attr("required","required")):"WeeklyTrigger"==e?($("#fldTimeOfDay",t).show(),$("#fldDayOfWeek",t).show(),$("#fldSelectSystemEvent",t).hide(),$("#fldSelectInterval",t).hide(),$("#txtTimeOfDay",t).attr("required","required")):"SystemEventTrigger"==e?($("#fldTimeOfDay",t).hide(),$("#fldDayOfWeek",t).hide(),$("#fldSelectSystemEvent",t).show(),$("#fldSelectInterval",t).hide(),$("#txtTimeOfDay",t).removeAttr("required")):"IntervalTrigger"==e?($("#fldTimeOfDay",t).hide(),$("#fldDayOfWeek",t).hide(),$("#fldSelectSystemEvent",t).hide(),$("#fldSelectInterval",t).show(),$("#txtTimeOfDay",t).removeAttr("required")):"StartupTrigger"==e&&($("#fldTimeOfDay",t).hide(),$("#fldDayOfWeek",t).hide(),$("#fldSelectSystemEvent",t).hide(),$("#fldSelectInterval",t).hide(),$("#txtTimeOfDay",t).removeAttr("required"))},getTriggerToAdd:function(){var e=$.mobile.activePage,t={Type:$("#selectTriggerType",e).val()};"DailyTrigger"==t.Type?t.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($("#txtTimeOfDay",e).val()):"WeeklyTrigger"==t.Type?(t.DayOfWeek=$("#selectDayOfWeek",e).val(),t.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($("#txtTimeOfDay",e).val())):"SystemEventTrigger"==t.Type?t.SystemEvent=$("#selectSystemEvent",e).val():"IntervalTrigger"==t.Type&&(t.IntervalTicks=$("#selectInterval",e).val());var i=$("#txtTimeLimit",e).val()||"0";return i=36e5*parseFloat(i),t.MaxRuntimeMs=i||null,t},getTimeOfDayTicks:function(e){var t=e.split(":"),i=t[0],r=t[1].split(" ")[0],a=60*i*60*1e3*1e4;return a+=60*r*1e3*1e4}};!function(){function e(){Dashboard.showLoadingMsg();var e=getParameterByName("id");return ApiClient.getScheduledTask(e).then(function(e){e.Triggers.push(ScheduledTaskPage.getTriggerToAdd()),ApiClient.updateScheduledTaskTriggers(e.Id,e.Triggers).then(function(){$("#popupAddTrigger").popup("close"),ScheduledTaskPage.refreshScheduledTask()})}),!1}$(document).on("pageinit","#scheduledTaskPage",function(){var t=this;$(".addTriggerForm").off("submit",e).on("submit",e),t.querySelector(".timeFieldExample").innerHTML=Globalize.translate("ValueExample","1:00 PM")}).on("pageshow","#scheduledTaskPage",function(){ScheduledTaskPage.refreshScheduledTask()})}();