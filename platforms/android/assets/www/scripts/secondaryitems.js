define(["libraryBrowser","listView","emby-itemscontainer"],function(e,t){return function(r,i){function n(e,t){"Person"==t.Type?e.PersonIds=t.Id:"Genre"==t.Type?e.Genres=t.Name:"MusicGenre"==t.Type?e.Genres=t.Name:"GameGenre"==t.Type?e.Genres=t.Name:"Studio"==t.Type?e.StudioIds=t.Id:"MusicArtist"==t.Type?e.ArtistIds=t.Id:e.ParentId=t.Id}function a(t){var r=o(),a=d[r];if(!a){a=d[r]={query:{SortBy:"SortName",SortOrder:"Ascending",Recursive:"false"!==i.recursive,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:e.getDefaultPageSize()}};var s=i.type;s&&(a.query.IncludeItemTypes=s,"Audio"==s&&(a.query.SortBy="Album,SortName"));var l=i.filters;s&&(a.query.Filters=l),t&&n(a.query,t),e.loadSavedQueryValues(r,a.query)}return a.query}function o(){return e.getSavedQueryKey()}function s(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function l(t){var i=s(t.target,"mediaItem");if(i){var n=e.getListItemInfo(i);if("Photo"==n.mediaType){var o=a();return require(["scripts/photos"],function(){Photos.startSlideshow(r,o,n.id)}),!1}}}function u(i){Dashboard.showLoadingMsg();var n=a(i);ApiClient.getItems(Dashboard.getCurrentUserId(),n).then(function(i){function a(){n.StartIndex+=n.Limit,u(r)}function o(){n.StartIndex-=n.Limit,u(r)}window.scrollTo(0,0);var s="",l=e.getQueryPagingHtml({startIndex:n.StartIndex,limit:n.Limit,totalRecordCount:i.TotalRecordCount,showLimit:!1});if(r.querySelector(".listTopPaging").innerHTML=l,"Audio"==n.IncludeItemTypes)s='<div style="max-width:1000px;margin:auto;">'+t.getListViewHtml({items:i.Items,playFromHere:!0,action:"playallfromhere",smallIcon:!0})+"</div>";else{var d={items:i.Items,shape:"auto",centerText:!0,lazy:!0};"MusicAlbum"==n.IncludeItemTypes?(d.overlayText=!1,d.showParentTitle=!0,d.showTitle=!0,d.overlayPlayButton=!0):"MusicArtist"==n.IncludeItemTypes?(d.overlayText=!1,d.overlayPlayButton=!0):"Episode"==n.IncludeItemTypes&&(d.overlayText=!1,d.showParentTitle=!0,d.showTitle=!0,d.overlayPlayButton=!0),s=e.getPosterViewHtml(d)}var y=r.querySelector("#items");y.innerHTML=s+l,ImageLoader.lazyChildren(y);var c,m,I;for(I=r.querySelectorAll(".btnNextPage"),c=0,m=I.length;m>c;c++)I[c].addEventListener("click",a);for(I=r.querySelectorAll(".btnPreviousPage"),c=0,m=I.length;m>c;c++)I[c].addEventListener("click",o);Dashboard.hideLoadingMsg()})}var d={};r.addEventListener("click",l),r.addEventListener("viewbeforeshow",function(){i.parentId?ApiClient.getItem(Dashboard.getCurrentUserId(),i.parentId).then(function(e){LibraryMenu.setTitle(e.Name),u(e)}):u()})}});