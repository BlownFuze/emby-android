define(["libraryBrowser","listView","cardBuilder","emby-itemscontainer"],function(e,t,r){return function(i,a){function n(e,t){"Person"==t.Type?e.PersonIds=t.Id:"Genre"==t.Type?e.Genres=t.Name:"MusicGenre"==t.Type?e.Genres=t.Name:"GameGenre"==t.Type?e.Genres=t.Name:"Studio"==t.Type?e.StudioIds=t.Id:"MusicArtist"==t.Type?e.ArtistIds=t.Id:e.ParentId=t.Id}function s(t){var r=o(),i=y[r];if(!i){i=y[r]={query:{SortBy:"SortName",SortOrder:"Ascending",Recursive:"false"!==a.recursive,Fields:"PrimaryImageAspectRatio,SortName,BasicSyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:e.getDefaultPageSize()}};var s=a.type;s&&(i.query.IncludeItemTypes=s,"Audio"==s&&(i.query.SortBy="Album,SortName"));var l=a.filters;s&&(i.query.Filters=l),t&&n(i.query,t),e.loadSavedQueryValues(r,i.query)}return i.query}function o(){return e.getSavedQueryKey()}function l(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function u(t){var r=l(t.target,"mediaItem");if(r){var a=e.getListItemInfo(r);if("Photo"==a.mediaType){var n=s();return require(["scripts/photos"],function(){Photos.startSlideshow(i,n,a.id)}),!1}}}function d(e){var t=s(e),r=i.querySelector("#items");"Audio"==t.IncludeItemTypes?(r.classList.add("vertical-list"),r.classList.remove("vertical-wrap")):(r.classList.remove("vertical-list"),r.classList.add("vertical-wrap"))}function c(a){Dashboard.showLoadingMsg();var n=s(a);ApiClient.getItems(Dashboard.getCurrentUserId(),n).then(function(a){function s(){n.StartIndex+=n.Limit,c(i)}function o(){n.StartIndex-=n.Limit,c(i)}window.scrollTo(0,0);var l="",u=e.getQueryPagingHtml({startIndex:n.StartIndex,limit:n.Limit,totalRecordCount:a.TotalRecordCount,showLimit:!1});i.querySelector(".listTopPaging").innerHTML=u;var d=i.querySelector("#items");if("Audio"==n.IncludeItemTypes)l=t.getListViewHtml({items:a.Items,playFromHere:!0,action:"playallfromhere",smallIcon:!0});else{var y={items:a.Items,shape:"auto",centerText:!0,lazy:!0};"MusicAlbum"==n.IncludeItemTypes?(y.overlayText=!1,y.showParentTitle=!0,y.showTitle=!0,y.overlayPlayButton=!0):"MusicArtist"==n.IncludeItemTypes?(y.overlayText=!1,y.overlayPlayButton=!0):"Episode"==n.IncludeItemTypes&&(y.overlayText=!1,y.showParentTitle=!0,y.showTitle=!0,y.overlayPlayButton=!0),l=r.getCardsHtml(y)}d.innerHTML=l+u,ImageLoader.lazyChildren(d);var m,I,v;for(v=i.querySelectorAll(".btnNextPage"),m=0,I=v.length;I>m;m++)v[m].addEventListener("click",s);for(v=i.querySelectorAll(".btnPreviousPage"),m=0,I=v.length;I>m;m++)v[m].addEventListener("click",o);Dashboard.hideLoadingMsg()})}var y={};i.addEventListener("click",u),i.addEventListener("viewbeforeshow",function(){a.parentId?ApiClient.getItem(Dashboard.getCurrentUserId(),a.parentId).then(function(e){LibraryMenu.setTitle(e.Name),d(e),c(e)}):(d(),c())})}});