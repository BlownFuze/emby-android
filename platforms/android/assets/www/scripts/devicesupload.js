define(["jQuery"],function(e){function a(a,o,i){o.length?(e(".noDevices",a).hide(),e(".devicesUploadForm",a).show()):(e(".noDevices",a).show(),e(".devicesUploadForm",a).hide()),e("#txtUploadPath",a).val(i.CameraUploadPath||""),e("#chkSubfolder",a).checked(i.EnableCameraUploadSubfolders).checkboxradio("refresh"),t(a,o,i)}function t(a,t,o){var i="";i+='<fieldset data-role="controlgroup">',i+="<legend>",i+=Globalize.translate("LabelEnableCameraUploadFor"),i+="</legend>";var n=0;i+=t.map(function(e){var a="",t="chk"+n;a+='<label for="'+t+'">',a+=e.Name,e.AppName&&(a+="<br/><span>"+e.AppName+"</span>"),a+="</label>";var i=-1!=o.EnabledCameraUploadDevices.indexOf(e.Id),l=i?' checked="checked"':"";return a+='<input type="checkbox" id="'+t+'" class="chkDevice" data-id="'+e.Id+'"'+l+" />",n++,a}).join(""),i+="</fieldset>",i+='<div class="fieldDescription">',i+=Globalize.translate("LabelEnableCameraUploadForHelp"),i+="</div>",e(".devicesList",a).html(i).trigger("create")}function o(e){Dashboard.showLoadingMsg();var t=ApiClient.getNamedConfiguration("devices"),o=ApiClient.getJSON(ApiClient.getUrl("Devices",{SupportsContentUploading:!0}));Promise.all([t,o]).then(function(t){a(e,t[1].Items,t[0]),Dashboard.hideLoadingMsg()})}function i(a){ApiClient.getNamedConfiguration("devices").then(function(t){t.CameraUploadPath=e("#txtUploadPath",a).val(),t.EnabledCameraUploadDevices=e(".chkDevice:checked",a).get().map(function(e){return e.getAttribute("data-id")}),t.EnableCameraUploadSubfolders=e("#chkSubfolder",a).checked(),ApiClient.updateNamedConfiguration("devices",t).then(Dashboard.processServerConfigurationUpdateResult)})}function n(){var a=this,t=e(a).parents(".page");return i(t),!1}e(document).on("pageinit","#devicesUploadPage",function(){var a=this;e("#btnSelectUploadPath",a).on("click.selectDirectory",function(){require(["directorybrowser"],function(t){var o=new t;o.show({callback:function(t){t&&e("#txtUploadPath",a).val(t),o.close()},header:Globalize.translate("HeaderSelectUploadPath")})})}),e(".devicesUploadForm").off("submit",n).on("submit",n)}).on("pageshow","#devicesUploadPage",function(){var e=this;o(e)})});