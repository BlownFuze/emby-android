define(["jQuery","cardStyle"],function(a){function n(a,n,e){var t=Globalize.translate("UninstallPluginConfirmation").replace("{0}",e);require(["confirm"],function(e){e(t,Globalize.translate("UninstallPluginHeader")).then(function(){Dashboard.showLoadingMsg(),ApiClient.uninstallPlugin(n).then(function(){r(a)})})})}function e(){Dashboard.alert({message:Globalize.translate("NoPluginConfigurationMessage")})}function t(){Dashboard.alert({message:Globalize.translate("MessagePluginConfigurationRequiresLocalAccess")})}function i(n,e){var t=a.grep(e,function(a){return a.PluginId==n.Id})[0],i="",l=Dashboard.isConnectMode(),o=t?Dashboard.getConfigurationPageUrl(t.Name):null,s=t&&!l?o:null;return i+="<div data-id='"+n.Id+"' data-name='"+n.Name+"' class='card backdropCard bottomPaddedCard scalableCard'>",i+='<div class="cardBox visualCardBox">',i+='<div class="cardScalable">',i+='<div class="cardPadder"></div>',i+=s?'<a class="cardContent" href="'+s+'">':o?l?'<div class="cardContent connectModePluginCard">':'<div class="cardContent">':'<div class="cardContent noConfigPluginCard noHoverEffect">',i+=n.ImageUrl?'<div class="cardImage" style="background-image:url(\''+n.ImageUrl+"');\">":'<div class="cardImage" style="background-image:url(\'css/images/items/list/collection.png\');">',i+="</div>",i+=s?"</a>":"</div>",i+="</div>",i+='<div class="cardFooter">',i+='<div style="text-align:right; float:right;padding-top:5px;">',i+='<button type="button" is="paper-icon-button-light" class="btnCardMenu autoSize"><i class="md-icon">more_vert</i></button>',i+="</div>",i+="<div class='cardText'>",i+=n.Name,i+="</div>",i+="<div class='cardText'>",i+=n.Version,i+="</div>",i+="</div>",i+="</div>",i+="</div>"}function l(a,n,e){ApiClient.getJSON(ApiClient.getUrl("web/configurationpages")+"?pageType=PluginConfiguration").then(function(t){o(a,n,t,e)})}function o(n,l,o,r){l=l.sort(function(a,n){return a.Name>n.Name?1:-1});var d=l.map(function(a){return i(a,o)}).join("");if(l.length){var c=a(".installedPlugins",n).addClass("itemsContainer").addClass("vertical-wrap").html(d);a(".noConfigPluginCard",c).on("click",function(){e()}),a(".connectModePluginCard",c).on("click",function(){t()}),a(".btnCardMenu",c).on("click",function(){s(n,this)})}else r&&(d+='<div style="padding:5px;">',AppInfo.enableAppStorePolicy?d+="<p>"+Globalize.translate("MessageNoPluginsDueToAppStore")+"</p>":(d+="<p>"+Globalize.translate("MessageNoPluginsInstalled")+"</p>",d+='<p><a href="plugincatalog.html">',d+=Globalize.translate("BrowsePluginCatalogMessage"),d+="</a></p>"),d+="</div>"),a(".installedPlugins",n).html(d);Dashboard.hideLoadingMsg()}function s(e,t){var i=a(t).parents(".card"),l=i.attr("data-id"),o=i.attr("data-name"),s=a(".cardContent",i).attr("href"),r=[];s&&r.push({name:Globalize.translate("ButtonSettings"),id:"open",ironIcon:"mode-edit"}),r.push({name:Globalize.translate("ButtonUninstall"),id:"delete",ironIcon:"delete"}),require(["actionsheet"],function(a){a.show({items:r,positionTo:t,callback:function(a){switch(a){case"open":Dashboard.navigate(s);break;case"delete":n(e,l,o)}}})})}function r(a){Dashboard.showLoadingMsg(),ApiClient.getInstalledPlugins().then(function(n){l(a,n,!0)})}function d(){return[{href:"plugins.html",name:Globalize.translate("TabMyPlugins")},{href:"plugincatalog.html",name:Globalize.translate("TabCatalog")}]}a(document).on("pageshow","#pluginsPage",function(){LibraryMenu.setTabs("plugins",0,d),r(this)}),window.PluginsPage={renderPlugins:l}});