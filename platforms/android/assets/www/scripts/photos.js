define(["jQuery","cardBuilder","emby-itemscontainer"],function(e,t){function r(){var e=i(),t=u[e];return t||(t=u[e]={query:{SortBy:"IsFolder,SortName",SortOrder:"Ascending",Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()}},t.query.Recursive=!1,t.query.MediaTypes=null,t.query.ParentId=getParameterByName("parentId")||LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(e,t.query)),t.query}function i(){return LibraryBrowser.getSavedQueryKey("v1")}function a(n){Dashboard.showLoadingMsg();var o=r();ApiClient.getItems(Dashboard.getCurrentUserId(),o).then(function(r){window.scrollTo(0,0);var s="",u=LibraryBrowser.getQueryPagingHtml({startIndex:o.StartIndex,limit:o.Limit,totalRecordCount:r.TotalRecordCount,viewButton:!1,showLimit:!1});n.querySelector(".listTopPaging").innerHTML=u,"Poster"==d&&(s=t.getCardsHtml({items:r.Items,shape:"square",context:getParameterByName("context")||"photos",overlayText:!0,lazy:!0,coverImage:!0,showTitle:!1,centerText:!0}));var l=n.querySelector(".itemsContainer");l.innerHTML=s+u,ImageLoader.lazyChildren(l),e(".btnNextPage",n).on("click",function(){o.StartIndex+=o.Limit,a(n)}),e(".btnPreviousPage",n).on("click",function(){o.StartIndex-=o.Limit,a(n)}),LibraryBrowser.saveQueryValues(i(),o),Dashboard.hideLoadingMsg()})}function n(t,r,i){var a=Dashboard.getCurrentUserId(),n=e.extend({},r);n.StartIndex=0,n.Limit=null,n.MediaTypes="Photo",n.Recursive=!0,n.Filters="IsNotFolder",ApiClient.getItems(a,n).then(function(e){o(t,e.Items,i)})}function o(e,t,r){var i=t.map(function(e){return e.Id}).indexOf(r);-1==i&&(i=0),require(["slideshow"],function(e){var r=new e({showTitle:!1,cover:!1,items:t,startIndex:i,interval:7e3,interactive:!0});r.show()})}function s(){var t=e(this).parents(".page")[0],i=LibraryBrowser.getListItemInfo(this);if("Photo"==i.mediaType){var a=r();return Photos.startSlideshow(t,a,i.id),!1}}var d="Poster",u={};pageIdOn("pageinit","photosPage",function(){var t=this;a(t,0),e(t).on("click",".mediaItem",s)}),window.Photos={startSlideshow:n}});