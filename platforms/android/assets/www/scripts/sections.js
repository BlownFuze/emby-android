define(["libraryBrowser","appSettings","scrollStyles","paper-button","paper-icon-button-light"],function(e,t){function a(e){return ApiClient.getUserViews({},e).then(function(e){for(var t=e.Items,a=[],r=0,i=t.length;i>r;r++){var n=t[r];AppInfo.isNativeApp&&browserInfo.safari&&"livetv"==n.CollectionType||a.push(n)}return a})}function r(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function i(){return r()?"overflowBackdrop":"backdrop"}function n(){return r()?"overflowPortrait":"portrait"}function s(t){for(var a="",r=0,i=t.length;i>r;r++){var n,s=t[r],o="rgba(82, 181, 75, 0.9)";switch(s.CollectionType){case"movies":n="local-movies",o="rgba(176, 94, 81, 0.9)";break;case"music":n="library-music",o="rgba(217, 145, 67, 0.9)";break;case"photos":n="photo",o="rgba(127, 0, 0, 0.9)";break;case"livetv":n="live-tv",o="rgba(217, 145, 67, 0.9)";break;case"tvshows":n="live-tv",o="rgba(77, 88, 164, 0.9)";break;case"games":n="folder",o="rgba(183, 202, 72, 0.9)";break;case"trailers":n="local-movies",o="rgba(176, 94, 81, 0.9)";break;case"homevideos":n="video-library",o="rgba(110, 52, 32, 0.9)";break;case"musicvideos":n="video-library",o="rgba(143, 54, 168, 0.9)";break;case"books":n="folder";break;case"channels":n="folder",o="rgba(51, 136, 204, 0.9)";break;case"playlists":n="folder";break;default:n="folder"}var l="card smallBackdropCard buttonCard";s.CollectionType&&(l+=" "+s.CollectionType+"buttonCard");var d=s.url||e.getHref(s),c=s.onclick?' onclick="'+s.onclick+'"':"";n=s.icon||n,a+="<a"+c+' data-itemid="'+s.Id+'" class="'+l+'" href="'+d+'">',a+='<div class="cardBox" style="background-color:'+o+';margin:4px;border-radius:4px;">',a+="<div class='cardText' style='padding:8px 10px;color:#fff;'>",a+='<iron-icon icon="'+n+'"></iron-icon>',a+='<span style="margin-left:.7em;">'+s.Name+"</span>",a+="</div>",a+="</div>",a+="</a>"}return a}function o(e,t,r){return a(t).then(function(t){var a="<br/>";return r&&(a+='<h1 class="listHeader">'+Globalize.translate("HeaderMyMedia")+"</h1>"),a+="<div>",a+=s(t),a+="</div>",d().then(function(t){e.innerHTML=a+t})})}function l(e,t){return Math.floor(Math.random()*(t-e+1))+e}function d(){var e=864e5;AppInfo.isNativeApp&&(e=1728e5);var a="lastappinfopresent5",r=parseInt(t.get(a)||"0");return r?(new Date).getTime()-r<e?Promise.resolve(""):Dashboard.getPluginSecurityInfo().then(function(e){if(t.set(a,(new Date).getTime()),e.IsMBSupporter)return"";var r=[p];return browserInfo.safari&&AppInfo.isNativeApp||r.push(m),t.set(a,(new Date).getTime()),r[l(0,1)]()}):(t.set(a,(new Date).getTime()),Promise.resolve(""))}function c(e,t){return'<div class="card backdropCard"><div class="cardBox"><div class="cardScalable"><div class="cardPadder"></div><a class="cardContent" href="'+t+'" target="_blank"><div class="cardImage lazy" data-src="'+e+'"></div></a></div></div></div>'}function m(){var e="";e+="<div>",e+='<h1>Try Emby Theater<button is="paper-icon-button-light" style="margin-left:1em;" onclick="jQuery(this.parentNode.parentNode).remove();"><iron-icon icon="close"></iron-icon></button></h1>';var t=AppInfo.isNativeApp?"Emby Theater":'<a href="https://emby.media/download" target="_blank">Emby Theater</a>';return e+="<p>A beautiful app for your TV and large screen tablet. "+t+" runs on Windows, Xbox One, Google Chrome, FireFox, Microsoft Edge and Opera.</p>",e+='<div class="itemsContainer">',e+=c("https://raw.githubusercontent.com/MediaBrowser/Emby.Resources/master/apps/theater1.png","https://emby.media/download"),e+=c("https://raw.githubusercontent.com/MediaBrowser/Emby.Resources/master/apps/theater2.png","https://emby.media/download"),e+=c("https://raw.githubusercontent.com/MediaBrowser/Emby.Resources/master/apps/theater3.png","https://emby.media/download"),e+="</div>",e+="<br/>",e+="</div>"}function p(){var e="";e+="<div>",e+='<h1>Try Emby Premiere<button is="paper-icon-button-light" style="margin-left:1em;" onclick="jQuery(this.parentNode.parentNode).remove();"><iron-icon icon="close"></iron-icon></button></h1>';var t=AppInfo.isNativeApp?"":'<a href="https://emby.media/premiere" target="_blank">Learn more</a>';return e+="<p>Design beautiful Cover Art, enjoy free access to Emby apps, and more. "+t+"</p>",e+='<div class="itemsContainer">',e+=c("https://raw.githubusercontent.com/MediaBrowser/Emby.Resources/master/apps/theater1.png","https://emby.media/premiere"),e+=c("https://raw.githubusercontent.com/MediaBrowser/Emby.Resources/master/apps/theater2.png","https://emby.media/premiere"),e+=c("https://raw.githubusercontent.com/MediaBrowser/Emby.Resources/master/apps/theater3.png","https://emby.media/premiere"),e+="</div>",e+="<br/>",e+="</div>"}function h(t,a){var r={Limit:20,Fields:"PrimaryImageAspectRatio,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb"};return ApiClient.getJSON(ApiClient.getUrl("Users/"+a.Id+"/Items/Latest",r)).then(function(a){var r="",i=!1;a.length&&(r+="<div>",r+='<h1 class="listHeader">'+Globalize.translate("HeaderLatestMedia")+"</h1>",r+="</div>",r+='<div class="itemsContainer">',r+=e.getPosterViewHtml({items:a,preferThumb:!0,shape:"backdrop",showUnplayedIndicator:!1,showChildCountIndicator:!0,lazy:!0,cardLayout:i,showTitle:i,showYear:i,showDetailsMenu:!0,context:"home"}),r+="</div>"),t.innerHTML=r,ImageLoader.lazyChildren(t),e.createCardMenus(t)})}function u(t,a){var i={Limit:12,Fields:"PrimaryImageAspectRatio,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",IncludeItemTypes:"Movie"};return ApiClient.getJSON(ApiClient.getUrl("Users/"+a.Id+"/Items/Latest",i)).then(function(a){var i="",s=r();a.length&&(i+='<h1 class="listHeader">'+Globalize.translate("HeaderLatestMovies")+"</h1>",i+=s?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">',i+=e.getPosterViewHtml({items:a,shape:n(),showUnplayedIndicator:!1,showChildCountIndicator:!0,lazy:!0,context:"home",centerText:!0,overlayPlayButton:!0}),i+="</div>"),t.innerHTML=i,ImageLoader.lazyChildren(t),e.createCardMenus(t)})}function v(t,a){var n={Limit:12,Fields:"PrimaryImageAspectRatio,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",IncludeItemTypes:"Episode"};return ApiClient.getJSON(ApiClient.getUrl("Users/"+a.Id+"/Items/Latest",n)).then(function(a){var n="",s=r();a.length&&(n+='<h1 class="listHeader">'+Globalize.translate("HeaderLatestEpisodes")+"</h1>",n+=s?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">',n+=e.getPosterViewHtml({items:a,preferThumb:!0,shape:i(),showUnplayedIndicator:!1,showChildCountIndicator:!0,lazy:!0,context:"home",overlayPlayButton:!0}),n+="</div>"),t.innerHTML=n,ImageLoader.lazyChildren(t),e.createCardMenus(t)})}function y(t,a){var r=window.innerWidth,i={Limit:r>=2400?10:r>=1600?10:r>=1440?8:r>=800?7:6,Fields:"PrimaryImageAspectRatio,SyncInfo",Filters:"IsUnplayed",UserId:a};return ApiClient.getJSON(ApiClient.getUrl("Channels/Items/Latest",i)).then(function(a){var r="";a.Items.length&&(r+='<h1 class="listHeader">'+Globalize.translate("HeaderLatestChannelMedia")+"</h1>",r+='<div class="itemsContainer">',r+=e.getPosterViewHtml({items:a.Items,shape:"auto",showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}),r+="</div>"),t.innerHTML=r,ImageLoader.lazyChildren(t),e.createCardMenus(t)})}function b(t,i,n,o,l,c){return a(i.Id).then(function(a){var i="";if(i+=l?'<div class="hiddenSectionOnMobile">':"<div>",a.length){var o=window.innerWidth;i+="<div>",i+='<h1 class="listHeader">'+Globalize.translate("HeaderMyMedia")+"</h1>",i+="</div>";var m=r()&&browserInfo.safari&&o>800;i+=m?'<div class="hiddenScrollX itemsContainer homeTopViews">':'<div class="itemsContainer homeTopViews">',i+=e.getPosterViewHtml({items:a,shape:m?"overflowBackdrop":n,showTitle:c,centerText:!0,lazy:!0,autoThumb:!0,transition:!1}),i+="</div>"}return i+="</div>",l&&(i+='<div class="hiddenSectionOnNonMobile" style="margin-top:1em;">',i+=s(a),i+="</div>"),d().then(function(a){t.innerHTML=i+a,ImageLoader.lazyChildren(t),e.createCardMenus(t,{showDetailsMenu:!1})})})}function g(t,a){var n=window.innerWidth,s={SortBy:"DatePlayed",SortOrder:"Descending",MediaTypes:"Video",Filters:"IsResumable",Limit:n>=1920?8:n>=1600?8:n>=1200?9:6,Recursive:!0,Fields:"PrimaryImageAspectRatio,SyncInfo",CollapseBoxSetItems:!1,ExcludeLocationTypes:"Virtual",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};return ApiClient.getItems(a,s).then(function(a){var n="";a.Items.length&&(n+='<h1 class="listHeader">'+Globalize.translate("HeaderResume")+"</h1>",n+=r()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">',n+=e.getPosterViewHtml({items:a.Items,preferThumb:!0,shape:i(),overlayText:!1,showTitle:!0,showParentTitle:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0,context:"home",centerText:!0}),n+="</div>"),t.innerHTML=n,ImageLoader.lazyChildren(t),e.createCardMenus(t)})}function f(t,a){var n={Limit:20,Fields:"PrimaryImageAspectRatio,SeriesInfo,DateCreated,SyncInfo",UserId:a,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getNextUpEpisodes(n).then(function(a){var n="";a.Items.length&&(n+='<h1 class="listHeader">'+Globalize.translate("HeaderNextUp")+"</h1>",n+=r()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">',n+=e.getPosterViewHtml({items:a.Items,preferThumb:!0,shape:i(),overlayText:!1,showTitle:!0,showParentTitle:!0,lazy:!0,overlayPlayButton:!0,context:"home",centerText:!0}),n+="</div>"),t.innerHTML=n,ImageLoader.lazyChildren(t),e.createCardMenus(t)})}function I(e,t,a){return a=Object.assign(a||{},{UserId:t,SupportsLatestItems:!0}),ApiClient.getJSON(ApiClient.getUrl("Channels",a)).then(function(t){var a=t.Items,r=a.map(function(e){return'<div id="channel'+e.Id+'"></div>'}).join("");e.innerHTML=r;for(var i=0,n=a.length;n>i;i++){var s=a[i];w(e,s,i)}})}function w(t,a){var r=window.innerWidth,i={Limit:r>=1600?10:r>=1440?5:r>=800?6:6,Fields:"PrimaryImageAspectRatio,SyncInfo",Filters:"IsUnplayed",UserId:Dashboard.getCurrentUserId(),ChannelIds:a.Id};ApiClient.getJSON(ApiClient.getUrl("Channels/Items/Latest",i)).then(function(r){var i="";if(r.Items.length){i+='<div class="homePageSection">',i+="<div>";var n=Globalize.translate("HeaderLatestFromChannel").replace("{0}",a.Name);i+='<h1 style="display:inline-block; vertical-align:middle;" class="listHeader">'+n+"</h1>",i+='<a href="channelitems.html?id='+a.Id+'" class="clearLink" style="margin-left:2em;"><paper-button raised class="more mini"><span>'+Globalize.translate("ButtonMore")+"</span></paper-button></a>",i+="</div>",i+='<div class="itemsContainer">',i+=e.getPosterViewHtml({items:r.Items,shape:"autohome",defaultShape:"square",showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}),i+="</div>",i+="</div>"}var s=t.querySelector("#channel"+a.Id);s.innerHTML=i,ImageLoader.lazyChildren(s),e.createCardMenus(s)})}function C(t,a,i){return ApiClient.getLiveTvRecordings({userId:a,limit:5,Fields:"PrimaryImageAspectRatio,SyncInfo",IsInProgress:!1}).then(function(a){var n="";if(a.Items.length){var s=0!==i?"listHeader":"listHeader";n+="<div>",n+='<h1 style="display:inline-block; vertical-align:middle;" class="'+s+'">'+Globalize.translate("HeaderLatestTvRecordings")+"</h1>",n+='<a href="livetv.html?tab=3" onclick="LibraryBrowser.showTab(\'livetv.html\',3);" class="clearLink" style="margin-left:2em;"><paper-button raised class="more mini"><span>'+Globalize.translate("ButtonMore")+"</span></paper-button></a>",n+="</div>"}n+=r()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">',n+=e.getPosterViewHtml({items:a.Items,shape:r()?"autooverflow":"auto",showTitle:!0,showParentTitle:!0,coverImage:!0,lazy:!0,showDetailsMenu:!0,centerText:!0,overlayPlayButton:!0}),n+="</div>",t.innerHTML=n,ImageLoader.lazyChildren(t),e.createCardMenus(t)})}return window.Sections={loadRecentlyAdded:h,loadLatestChannelMedia:y,loadLibraryTiles:b,loadResume:g,loadNextUp:f,loadLatestChannelItems:I,loadLatestLiveTvRecordings:C,loadlibraryButtons:o,loadLatestMovies:u,loadLatestEpisodes:v},window.Sections});