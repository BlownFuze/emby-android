!function(e){function t(){var e=AppSettings.maxStreamingBitrate(),t={};return t.MaxStreamingBitrate=e,t.MaxStaticBitrate=1e8,t.MusicStreamingTranscodingBitrate=192e3,t.DirectPlayProfiles=[],t.DirectPlayProfiles.push({Container:"m4v,3gp,ts,mpegts,mov,xvid,vob,mkv,wmv,asf,ogm,ogv,m2v,avi,mpg,mpeg,mp4,webm,wtv,dvr-ms",Type:"Video"}),t.DirectPlayProfiles.push({Container:"aac,mp3,mpa,wav,wma,mp2,ogg,oga,webma,ape,opus,flac",Type:"Audio"}),t.TranscodingProfiles=[],t.TranscodingProfiles.push({Container:"mkv",Type:"Video",AudioCodec:"aac,mp3,ac3",VideoCodec:"h264",Context:"Streaming"}),t.TranscodingProfiles.push({Container:"mp3",Type:"Audio",AudioCodec:"mp3",Context:"Streaming",Protocol:"http"}),t.ContainerProfiles=[],t.CodecProfiles=[],t.SubtitleProfiles=[],t.SubtitleProfiles.push({Format:"srt",Method:"Embed"}),t.SubtitleProfiles.push({Format:"subrip",Method:"Embed"}),t.SubtitleProfiles.push({Format:"ass",Method:"Embed"}),t.SubtitleProfiles.push({Format:"ssa",Method:"Embed"}),t.SubtitleProfiles.push({Format:"pgs",Method:"Embed"}),t.SubtitleProfiles.push({Format:"pgssub",Method:"Embed"}),t.SubtitleProfiles.push({Format:"dvdsub",Method:"Embed"}),t.SubtitleProfiles.push({Format:"vtt",Method:"Embed"}),t.SubtitleProfiles.push({Format:"sub",Method:"Embed"}),t.SubtitleProfiles.push({Format:"idx",Method:"Embed"}),t.SubtitleProfiles.push({Format:"smi",Method:"Embed"}),t.ResponseProfiles=[],t}function a(e){var a=$.Deferred(),i=t(),l=0;return MediaPlayer.tryStartPlayback(i,e,l,function(t){r(e,t,l,a)}),a.promise()}function r(e,t,a,r){Dashboard.hideLoadingMsg(),P=e,y=t,b={PlayState:{}},MediaPlayer.createStreamInfo("Video",e,t,a).then(function(a){var i=a.url,l=getParameterByName("AudioStreamIndex",i);l&&(b.PlayState.AudioStreamIndex=parseInt(l)),b.PlayState.SubtitleStreamIndex=self.currentSubtitleStreamIndex,b.PlayState.PlayMethod="true"==getParameterByName("static",i)?"DirectStream":"Transcode",b.PlayState.LiveStreamId=getParameterByName("LiveStreamId",i),b.PlayState.PlaySessionId=getParameterByName("PlaySessionId",i),b.PlayState.MediaSourceId=t.Id,b.PlayState.CanSeek=!1,b.NowPlayingItem=MediaPlayer.getNowPlayingItemForReporting(e,t),r.resolveWith(null,[a])})}function i(e){var t=b;return t.PlayState.PositionTicks=e,t}function l(){d();var e=i(),t={ItemId:e.NowPlayingItem.Id,NowPlayingItem:e.NowPlayingItem};t=$.extend(t,e.PlayState),ApiClient.reportPlaybackStart(t),f=setInterval(function(){o(null)},1e4),setTimeout(function(){s(P)},1e3)}function o(e){var t=i(e),a={ItemId:t.NowPlayingItem.Id,NowPlayingItem:t.NowPlayingItem};a=$.extend(a,t.PlayState),ApiClient.reportPlaybackProgress(a)}function n(e){var t=i(e),a={itemId:t.NowPlayingItem.Id,mediaSourceId:t.PlayState.MediaSourceId,positionTicks:t.PlayState.PositionTicks};t.PlayState.LiveStreamId&&(a.LiveStreamId=t.PlayState.LiveStreamId),t.PlayState.PlaySessionId&&(a.PlaySessionId=t.PlayState.PlaySessionId),ApiClient.reportPlaybackStopped(a),f&&(clearInterval(f),f=null)}function s(e){require(["jqmpopup","jqmlistview"],function(){$(".externalPlayerPostPlayFlyout").popup("close").remove();var t='<div data-role="popup" class="externalPlayerPostPlayFlyout" data-history="false" data-theme="a" data-dismissible="false">';t+='<ul data-role="listview" style="min-width: 220px;">',t+='<li data-role="list-divider" style="padding: 1em;text-align:center;">'+Globalize.translate("HeaderExternalPlayerPlayback")+"</li>",t+="</ul>",t+='<div style="padding:1em;">';var a=e.RunTimeTicks;e.RunTimeTicks&&e.RunTimeTicks>=3e9&&(a=!1,t+='<fieldset data-role="controlgroup">',t+="<legend>"+Globalize.translate("LabelMarkAs")+"</legend>",t+='<label for="radioMarkUnwatched">'+Globalize.translate("OptionUnwatched")+"</label>",t+='<input type="radio" id="radioMarkUnwatched" name="radioGroupMarkPlaystate" class="radioPlaystate" />',t+='<label for="radioMarkWatched">'+Globalize.translate("OptionWatched")+"</label>",t+='<input type="radio" id="radioMarkWatched" checked="checked" name="radioGroupMarkPlaystate" class="radioPlaystate" />',t+='<label for="radioMarkInProgress">'+Globalize.translate("OptionInProgress")+"</label>",t+='<input type="radio" id="radioMarkInProgress" name="radioGroupMarkPlaystate" class="radioPlaystate" />',t+="</fieldset>",t+="<br/>",t+='<p style="margin-top: 0;">'+Globalize.translate("LabelResumePoint")+"</p>",t+='<div class="sliderContainer" style="display:block;margin-top:4px;">',t+='<input class="playstateSlider" type="range" step=".001" min="0" max="100" value="0" style="display:none;" data-theme="a" data-highlight="true" />',t+="</div>",t+='<div class="sliderValue" style="text-align:center;margin:2px 0 4px;">0:00:00</div>',t+="<br/>"),t+='<button type="button" class="btnDone" data-theme="b" data-icon="check">'+Globalize.translate("ButtonImDone")+"</button>",t+="</div>",t+="</div>",$(document.body).append(t);var r=$(".externalPlayerPostPlayFlyout").popup({}).trigger("create").popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove()});$(".radioPlaystate",r).on("change",function(){$(".playstateSlider",r).slider($("#radioMarkInProgress",r).checked()?"enable":"disable")}).trigger("change"),$(".btnDone",r).on("click",function(){$(".externalPlayerPostPlayFlyout").popup("close").remove();var t=0;if($("#radioMarkInProgress",r).checked()){var i=$(".playstateSlider",r).val(),l=.01*e.RunTimeTicks*Number(i);t=l}else a||$("#radioMarkWatched",r).checked()?t=y.RunTimeTicks:$("#radioMarkUnwatched",r).checked()&&(t=0);n(t)}),$(".playstateSlider",r).on("change",function(){var t=$(this).val(),a=.01*e.RunTimeTicks*Number(t),i=Dashboard.getDisplayTime(a);$(".sliderValue",r).html(i)})})}function d(){$(".externalPlayerFlyout").popup("close").remove()}function u(e,t){require(["jqmpopup","jqmlistview"],function(){d();var e='<div data-role="popup" class="externalPlayerFlyout" data-theme="a" data-dismissible="false">';e+='<ul data-role="listview" style="min-width: 200px;">',e+='<li data-role="list-divider" style="padding: 1em;text-align:center;">'+Globalize.translate("HeaderSelectExternalPlayer")+"</li>",e+="</ul>",e+='<div style="padding:1em;">',e+=t.map(function(e){return'<a href="'+e.url+'" data-role="button" data-icon="play" class="btnExternalPlayer" data-theme="b" data-mini="true">'+e.name+"</a>"}).join(""),e+="</div>",e+="</div>",$(document.body).append(e);var a=$(".externalPlayerFlyout").popup({}).trigger("create").popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove()});$(".btnExternalPlayer",a).on("click",function(){ExternalPlayer.onPlaybackStart()})})}function p(e){var t=Dashboard.getCurrentUserId();ApiClient.getItem(t,e).then(function(e){a(e).then(function(t){setTimeout(function(){ExternalPlayer.showPlayerSelectionMenu(e,t.url,t.mimeType)},500)})})}function c(e){var t=$.Deferred(),a=[{name:"Vlc",url:"vlc://"+e,id:"vlc"}];return t.resolveWith(null,[a]),t.promise()}function m(e,t,a){ExternalPlayer.getExternalPlayers(t,a).then(function(t){u(e,t)})}var y,P,b,f;e.ExternalPlayer={showMenu:p,onPlaybackStart:l,getExternalPlayers:c,showPlayerSelectionMenu:m}}(window);