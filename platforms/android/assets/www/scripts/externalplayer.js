!function(e){function a(){var e=AppSettings.maxStreamingBitrate(),a={};a.MaxStreamingBitrate=e,a.MaxStaticBitrate=4e7,a.MusicStreamingTranscodingBitrate=Math.min(e,192e3),a.DirectPlayProfiles=[],a.DirectPlayProfiles.push({Container:"mkv,mov,mp4,m4v,wmv",Type:"Video"}),a.DirectPlayProfiles.push({Container:"aac,mp3,flac,wma",Type:"Audio"}),a.TranscodingProfiles=[],a.TranscodingProfiles.push({Container:"ts",Type:"Video",AudioCodec:"aac",VideoCodec:"h264",Context:"Streaming",Protocol:"hls"}),a.TranscodingProfiles.push({Container:"aac",Type:"Audio",AudioCodec:"aac",Context:"Streaming",Protocol:"hls"}),a.ContainerProfiles=[];var t=[],i="6";return t.push({Condition:"LessThanEqual",Property:"AudioChannels",Value:i}),a.CodecProfiles=[],a.CodecProfiles.push({Type:"Audio",Conditions:t}),a.CodecProfiles.push({Type:"VideoAudio",Codec:"mp3",Conditions:[{Condition:"LessThanEqual",Property:"AudioChannels",Value:i}]}),a.CodecProfiles.push({Type:"VideoAudio",Codec:"aac",Conditions:[{Condition:"LessThanEqual",Property:"AudioChannels",Value:i}]}),a.CodecProfiles.push({Type:"Video",Codec:"h264",Conditions:[{Condition:"EqualsAny",Property:"VideoProfile",Value:"high|main|baseline|constrained baseline"},{Condition:"LessThanEqual",Property:"VideoLevel",Value:"50"}]}),a.SubtitleProfiles=[],a.SubtitleProfiles.push({Format:"srt",Method:"Embed"}),a.SubtitleProfiles.push({Format:"subrip",Method:"Embed"}),a.SubtitleProfiles.push({Format:"ass",Method:"Embed"}),a.SubtitleProfiles.push({Format:"ssa",Method:"Embed"}),a.SubtitleProfiles.push({Format:"pgs",Method:"Embed"}),a.SubtitleProfiles.push({Format:"pgssub",Method:"Embed"}),a.SubtitleProfiles.push({Format:"dvdsub",Method:"Embed"}),a.SubtitleProfiles.push({Format:"vtt",Method:"Embed"}),a.SubtitleProfiles.push({Format:"sub",Method:"Embed"}),a.SubtitleProfiles.push({Format:"idx",Method:"Embed"}),a.ResponseProfiles=[],a}function t(e){var t=$.Deferred(),o=a(),r=0;return MediaPlayer.tryStartPlayback(o,e,r,function(a){i(e,a,r,t)}),t.promise()}function i(e,a,t,i){Dashboard.hideModalLoadingMsg(),m=e,P=a,h={PlayState:{}},MediaPlayer.createStreamInfo("Video",e,a,t).then(function(t){var o=t.url,r=getParameterByName("AudioStreamIndex",o);r&&(h.PlayState.AudioStreamIndex=parseInt(r)),h.PlayState.SubtitleStreamIndex=self.currentSubtitleStreamIndex,h.PlayState.PlayMethod="true"==getParameterByName("static",o)?"DirectStream":"Transcode",h.PlayState.LiveStreamId=getParameterByName("LiveStreamId",o),h.PlayState.PlaySessionId=getParameterByName("PlaySessionId",o),h.PlayState.MediaSourceId=a.Id,h.PlayState.CanSeek=!1,h.NowPlayingItem=MediaPlayer.getNowPlayingItemForReporting(e,a),i.resolveWith(null,[t])})}function o(e){var a=h;return a.PlayState.PositionTicks=e,a}function r(){d();var e=o(),a={ItemId:e.NowPlayingItem.Id,NowPlayingItem:e.NowPlayingItem};a=$.extend(a,e.PlayState),ApiClient.reportPlaybackStart(a),f=setInterval(function(){l(null)},1e4),setTimeout(function(){s(m)},1e3)}function l(e){var a=o(e),t={ItemId:a.NowPlayingItem.Id,NowPlayingItem:a.NowPlayingItem};t=$.extend(t,a.PlayState),ApiClient.reportPlaybackProgress(t)}function n(e){var a=o(e),t={itemId:a.NowPlayingItem.Id,mediaSourceId:a.PlayState.MediaSourceId,positionTicks:a.PlayState.PositionTicks};a.PlayState.LiveStreamId&&(t.LiveStreamId=a.PlayState.LiveStreamId),a.PlayState.PlaySessionId&&(t.PlaySessionId=a.PlayState.PlaySessionId),ApiClient.reportPlaybackStopped(t),f&&(clearInterval(f),f=null)}function s(e){require(["jqmpopup","jqmlistview"],function(){$(".externalPlayerPostPlayFlyout").popup("close").remove();var a='<div data-role="popup" class="externalPlayerPostPlayFlyout" data-history="false" data-theme="a" data-dismissible="false">';a+='<ul data-role="listview" style="min-width: 220px;">',a+='<li data-role="list-divider" style="padding: 1em;text-align:center;">'+Globalize.translate("HeaderExternalPlayerPlayback")+"</li>",a+="</ul>",a+='<div style="padding:1em;">';var t=e.RunTimeTicks;e.RunTimeTicks&&e.RunTimeTicks>=3e9&&(t=!1,a+='<fieldset data-role="controlgroup">',a+="<legend>"+Globalize.translate("LabelMarkAs")+"</legend>",a+='<label for="radioMarkUnwatched">'+Globalize.translate("OptionUnwatched")+"</label>",a+='<input type="radio" id="radioMarkUnwatched" name="radioGroupMarkPlaystate" class="radioPlaystate" />',a+='<label for="radioMarkWatched">'+Globalize.translate("OptionWatched")+"</label>",a+='<input type="radio" id="radioMarkWatched" checked="checked" name="radioGroupMarkPlaystate" class="radioPlaystate" />',a+='<label for="radioMarkInProgress">'+Globalize.translate("OptionInProgress")+"</label>",a+='<input type="radio" id="radioMarkInProgress" name="radioGroupMarkPlaystate" class="radioPlaystate" />',a+="</fieldset>",a+="<br/>",a+='<p style="margin-top: 0;">'+Globalize.translate("LabelResumePoint")+"</p>",a+='<div class="sliderContainer" style="display:block;margin-top:4px;">',a+='<input class="playstateSlider" type="range" step=".001" min="0" max="100" value="0" style="display:none;" data-theme="a" data-highlight="true" />',a+="</div>",a+='<div class="sliderValue" style="text-align:center;margin:2px 0 4px;">0:00:00</div>',a+="<br/>"),a+='<button type="button" class="btnDone" data-theme="b" data-icon="check">'+Globalize.translate("ButtonImDone")+"</button>",a+="</div>",a+="</div>",$(document.body).append(a);var i=$(".externalPlayerPostPlayFlyout").popup({}).trigger("create").popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove()});$(".radioPlaystate",i).on("change",function(){$(".playstateSlider",i).slider($("#radioMarkInProgress",i).checked()?"enable":"disable")}).trigger("change"),$(".btnDone",i).on("click",function(){$(".externalPlayerPostPlayFlyout").popup("close").remove();var a=0;if($("#radioMarkInProgress",i).checked()){var o=$(".playstateSlider",i).val(),r=.01*e.RunTimeTicks*Number(o);a=r}else t||$("#radioMarkWatched",i).checked()?a=P.RunTimeTicks:$("#radioMarkUnwatched",i).checked()&&(a=0);n(a)}),$(".playstateSlider",i).on("change",function(){var a=$(this).val(),t=.01*e.RunTimeTicks*Number(a),o=Dashboard.getDisplayTime(t);$(".sliderValue",i).html(o),Logger.log("slidin",a,self.currentDurationTicks,t)})})}function d(){$(".externalPlayerFlyout").popup("close").remove()}function u(e,a){require(["jqmpopup","jqmlistview"],function(){d();var e='<div data-role="popup" class="externalPlayerFlyout" data-theme="a" data-dismissible="false">';e+='<ul data-role="listview" style="min-width: 200px;">',e+='<li data-role="list-divider" style="padding: 1em;text-align:center;">'+Globalize.translate("HeaderSelectExternalPlayer")+"</li>",e+="</ul>",e+='<div style="padding:1em;">',e+=a.map(function(e){return'<a href="'+e.url+'" data-role="button" data-icon="play" class="btnExternalPlayer" data-theme="b" data-mini="true">'+e.name+"</a>"}).join(""),e+="</div>",e+="</div>",$(document.body).append(e);var t=$(".externalPlayerFlyout").popup({}).trigger("create").popup("open").on("popupafterclose",function(){$(this).off("popupafterclose").remove()});$(".btnExternalPlayer",t).on("click",function(){ExternalPlayer.onPlaybackStart()})})}function c(e){var a=Dashboard.getCurrentUserId();ApiClient.getItem(a,e).then(function(e){t(e).then(function(a){setTimeout(function(){ExternalPlayer.showPlayerSelectionMenu(e,a.url,a.mimeType)},500)})})}function p(e){var a=$.Deferred(),t=[{name:"Vlc",url:"vlc://"+e,id:"vlc"}];return a.resolveWith(null,[t]),a.promise()}function y(e,a,t){ExternalPlayer.getExternalPlayers(a,t).then(function(a){u(e,a)})}var P,m,h,f;e.ExternalPlayer={showMenu:c,onPlaybackStart:r,getExternalPlayers:p,showPlayerSelectionMenu:y}}(window);