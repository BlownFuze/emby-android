define(["jQuery"],function(e){function t(e){var t="";return t+='<table id="tblReport" data-role="table" data-mode="reflow" class="tblLibraryReport stripedTable ui-responsive table-stroke detailTable" style="display:table;">',t+="<thead>",e.Headers.map(function(e){var i='<th data-priority="persist">';e.ShowHeaderLabel&&(e.SortField&&(i+='<a class="lnkColumnSort" href="#" data-sortfield="'+e.SortField+'" style="text-decoration:underline;">'),i+=e.Name||"&nbsp;",e.SortField&&(i+="</a>",e.SortField===g&&(i+="Descending"===p.SortOrder?'<span style="font-weight:bold;margin-left:5px;vertical-align:top;font-size:14px">&darr;</span>':'<span style="font-weight:bold;margin-left:5px;vertical-align:top;font-size:14px;">&uarr;</span>'))),i+="</th>",t+=i}),t+="</thead>",t+="<tbody>",e.IsGrouped===!1?e.Rows.map(function(a){t+=i(e.Headers,a)}):e.Groups.map(function(a){t+='<tr style="background-color: rgb(51, 51, 51);">',t+='<th scope="rowgroup" colspan="'+e.Headers.length+'">'+(a.Name||"&nbsp;")+"</th>",t+="</tr>",a.Rows.map(function(a){t+=i(e.Headers,a)}),t+="<tr>",t+='<th scope="rowgroup" colspan="'+e.Headers.length+'">&nbsp;</th>',t+="</tr>"}),t+="</tbody>",t+="</table>"}function i(e,t){var i="";i+="<tr>";for(var r=0;r<e.length;r++){var s=e[r],n=t.Columns[r];i+=a(s,t,n)}return i+="</tr>"}function a(e,t,i){var a="";switch(a+="<td>",e.ItemViewType){case"None":a+=i.Name;break;case"Detail":var r=t.Id;i.Id&&(r=i.Id),a+='<a href="itemdetails.html?id='+r+'">'+i.Name+"</a>";break;case"Edit":a+='<a href="edititemmetadata.html?id='+t.Id+'">'+i.Name+"</a>";break;case"List":a+='<a href="itemlist.html?id='+t.Id+'">'+i.Name+"</a>";break;case"ItemByNameDetails":a+='<a href="itemdetails.html?id='+i.Id+"&context="+t.RowType+'">'+i.Name+"</a>";break;case"EmbeddedImage":t.HasEmbeddedImage&&(a+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>');break;case"SubtitleImage":t.HasSubtitles&&(a+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>');break;case"TrailersImage":t.HasLocalTrailer&&(a+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>');break;case"SpecialsImage":t.HasSpecials&&(a+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>');break;case"LockDataImage":t.HasLockData&&(a+='<img src="css/images/editor/lock.png"  style="width:18px"/>');break;case"TagsPrimaryImage":t.HasImageTagsPrimary||(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missingprimaryimage.png" title="Missing primary image." style="width:18px"/></a>');break;case"TagsBackdropImage":t.HasImageTagsBackdrop||"Episode"!==t.RowType&&"Season"!==t.RowType&&"Audio"!==t.MediaType&&"TvChannel"!==t.RowType&&"MusicAlbum"!==t.RowType&&(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missingbackdrop.png" title="Missing backdrop image." style="width:18px"/></a>');break;case"TagsLogoImage":t.HasImageTagsLogo||("Movie"===t.RowType||"Trailer"===t.RowType||"Series"===t.RowType||"MusicArtist"===t.RowType||"BoxSet"===t.RowType)&&(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missinglogo.png" title="Missing logo image." style="width:18px"/></a>');break;case"UserPrimaryImage":if(t.UserId){var s=ApiClient.getUserImageUrl(t.UserId,{height:24,type:"Primary"});a+=s?'<img src="'+s+'" />':""}break;case"StatusImage":t.HasLockData&&(a+='<img src="css/images/editor/lock.png"  style="width:18px"/>'),t.HasLocalTrailer||"Movie"!==t.RowType||(a+='<img src="css/images/editor/missingtrailer.png" title="Missing local trailer."  style="width:18px"/>'),t.HasImageTagsPrimary||(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missingprimaryimage.png" title="Missing primary image." style="width:18px"/></a>'),t.HasImageTagsBackdrop||"Episode"!==t.RowType&&"Season"!==t.RowType&&"Audio"!==t.MediaType&&"TvChannel"!==t.RowType&&"MusicAlbum"!==t.RowType&&(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missingbackdrop.png" title="Missing backdrop image." style="width:18px"/></a>'),t.HasImageTagsLogo||("Movie"===t.RowType||"Trailer"===t.RowType||"Series"===t.RowType||"MusicArtist"===t.RowType||"BoxSet"===t.RowType)&&(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missinglogo.png" title="Missing logo image." style="width:18px"/></a>');break;default:a+=i.Name}return a+="</td>"}function r(e){var t="";return t+='<div class="detailSection" >',t+='<div class="detailSectionContent">',e.Groups.map(function(e){t+='<div class="card transparentCard bannerCard"  style="vertical-align: top;">',t+='<div class="visualCardBox">',t+='<div class="cardBox " >',t+='<div class="detailSection">',t+='<div class="detailSectionHeader">',t+="<span>"+e.Header+"&nbsp;</span>",t+="</div>",t+='<div class="detailSectionContent">',t+='<div class="childrenItemsContainer itemsContainer" style="text-align: left;">',t+='<ul class="itemsListview ui-listview" >';for(var i=e.Items.length-1,a=0;u>a;a++){if(t+='<li class="ui-li listItem ui-li-has-alt ui-first-child">',i>=a){var r=e.Items[a];t+='<a class="item ui-btn"',r.Id>""&&(t+=' href="itemdetails.html?id='+r.Id+'"'),t+=">"+r.Name+"&nbsp;</a>",t+='<a title="" class="listviewMenuButton ui-btn ui-btn-inline">'+r.Value+"&nbsp;</a>"}else t+='<a class="item ui-btn">&nbsp;</a>';t+="</li>"}t+="</ul>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>"}),t+="</div>",t+="</div>"}function s(){p.UserId=Dashboard.getCurrentUserId(),p.HasQueryLimit=!1;var e=ApiClient.getUrl("Reports/Items/Download",p);e&&(window.location.href=e)}function n(t){p.UserId=Dashboard.getCurrentUserId();var i="";i=ApiClient.getUrl("Reports/Headers",p),ApiClient.getJSON(i).then(function(i){var a="None";e("#selectReportGroup",t).find("option").remove().end(),e("#selectReportGroup",t).append('<option value="None"></option>'),i.map(function(i){if(("Screen"===i.DisplayType||"ScreenExport"===i.DisplayType)&&i.CanGroup&&i.FieldName.length>0){var r='<option value="'+i.FieldName+'">'+i.Name+"</option>";e("#selectReportGroup",t).append(r),p.GroupBy===i.FieldName&&(a=i.FieldName)}}),e("#selectPageSize",t).val(a)})}function o(i,a){window.scrollTo(0,0);var s="";"ReportData"===p.ReportView||"ReportStatistics"===p.ReportView?(e("#selectIncludeItemTypesBox",i).show(),e("#tabFilter",i).show()):(e("#selectIncludeItemTypesBox",i).hide(),e("#tabFilterBox",i).hide(),e("#tabFilter",i).hide());var n=LibraryBrowser.getQueryPagingHtml({startIndex:p.StartIndex,limit:p.Limit,totalRecordCount:a.TotalRecordCount,updatePageSizeSetting:!1,viewButton:!0,showLimit:!1});switch("ReportData"===p.ReportView||"ReportActivities"===p.ReportView?(e(".listTopPaging",i).html(n).trigger("create"),e(".listTopPaging",i).show(),e(".listBottomPaging",i).html(n).trigger("create"),e(".listBottomPaging",i).show(),e(".btnNextPage",i).on("click",function(){p.StartIndex+=p.Limit,c(i)}),e(".btnNextPage",i).show(),e(".btnPreviousPage",i).on("click",function(){p.StartIndex-=p.Limit,c(i)}),e(".btnPreviousPage",i).show(),e("#btnReportExport",i).show(),e("#selectPageSizeBox",i).show(),e("#selectReportGroupingBox",i).show(),e("#grpReportsColumns",i).show(),s+=t(a),e(".reporContainer",i).html(s).trigger("create"),e(".lnkColumnSort",i).on("click",function(){var e=this.getAttribute("data-sortfield");p.SortBy===e?"Descending"===p.SortOrder?(p.SortOrder="Ascending",p.SortBy=g):(p.SortOrder="Descending",p.SortBy=e):(p.SortOrder="Ascending",p.SortBy=e),p.StartIndex=0,c(i)})):(e(".listTopPaging",i).html(n).trigger("create"),e(".listTopPaging",i).show(),e(".listBottomPaging",i).hide(),e(".btnNextPage",i).hide(),e(".btnPreviousPage",i).hide(),e("#btnReportExport",i).hide(),e("#selectPageSizeBox",i).hide(),e("#selectReportGroupingBox",i).hide(),e("#grpReportsColumns",i).hide(),s+=r(a),e(".reporContainer",i).html(s).trigger("create")),e("#GroupStatus",i).hide(),e("#GroupAirDays",i).hide(),e("#GroupEpisodes",i).hide(),p.IncludeItemTypes){case"Series":case"Season":e("#GroupStatus",i).show(),e("#GroupAirDays",i).show();break;case"Episode":e("#GroupStatus",i).show(),e("#GroupAirDays",i).show(),e("#GroupEpisodes",i).show()}e(".viewPanel",i).refresh}function c(e){Dashboard.showLoadingMsg(),p.UserId=Dashboard.getCurrentUserId();var t="";switch(p.ReportView){case"ReportData":p.HasQueryLimit=!0,t=ApiClient.getUrl("Reports/Items",p);break;case"ReportStatistics":p.TopItems=u,p.HasQueryLimit=!1,t=ApiClient.getUrl("Reports/Statistics",p);break;case"ReportActivities":p.HasQueryLimit=!0,t=ApiClient.getUrl("Reports/Activities",p)}ApiClient.getJSON(t).then(function(t){d(e),o(e,t)}),Dashboard.hideLoadingMsg()}function d(t){e(".chkStandardFilter",t).each(function(){var e=","+(p.Filters||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}).checkboxradio("refresh"),e(".chkVideoTypeFilter",t).each(function(){var e=","+(p.VideoTypes||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}).checkboxradio("refresh"),e(".chkStatus",t).each(function(){var e=","+(p.SeriesStatus||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}).checkboxradio("refresh"),e(".chkAirDays",t).each(function(){var e=","+(p.AirDays||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}).checkboxradio("refresh"),e("#chk3D",t).checked(1==p.Is3D).checkboxradio("refresh"),e("#chkHD",t).checked(1==p.IsHD).checkboxradio("refresh"),e("#chkSD",t).checked(0==p.IsHD).checkboxradio("refresh"),e("#chkSubtitle",t).checked(1==p.HasSubtitles).checkboxradio("refresh"),e("#chkTrailer",t).checked(1==p.HasTrailer).checkboxradio("refresh"),e("#chkMissingTrailer",t).checked(0==p.HasTrailer).checkboxradio("refresh"),e("#chkSpecialFeature",t).checked(1==p.HasSpecialFeature).checkboxradio("refresh"),e("#chkThemeSong",t).checked(1==p.HasThemeSong).checkboxradio("refresh"),e("#chkThemeVideo",t).checked(1==p.HasThemeVideo).checkboxradio("refresh"),e("#selectPageSize",t).val(p.Limit),e("#chkMissingRating",t).checked(0==p.HasOfficialRating).checkboxradio("refresh"),e("#chkMissingOverview",t).checked(0==p.HasOverview).checkboxradio("refresh"),e("#chkYearMismatch",t).checked(1==p.IsYearMismatched).checkboxradio("refresh"),e("#chkIsLocked",t).checked(1==p.IsLocked).checkboxradio("refresh"),e("#chkMissingImdbId",t).checked(0==p.HasImdbId).checkboxradio("refresh"),e("#chkMissingTmdbId",t).checked(0==p.HasTmdbId).checkboxradio("refresh"),e("#chkMissingTvdbId",t).checked(0==p.HasTvdbId).checkboxradio("refresh"),e("#chkSpecialEpisode",t).checked(0==p.ParentIndexNumber).checkboxradio("refresh"),e("#chkMissingEpisode",t).checked(1==p.IsMissing).checkboxradio("refresh"),e("#chkFutureEpisode",t).checked(1==p.IsUnaired).checkboxradio("refresh"),e("#selectIncludeItemTypes").val(p.IncludeItemTypes),e("#isFavorite").val(1==p.IsFavorite?"true":0==p.IsFavorite?"false":"-")}function l(e){h||(h=!0,QueryReportFilters.loadFilters(e,Dashboard.getCurrentUserId(),p,function(){c(e)}),QueryReportColumns.loadColumns(e,Dashboard.getCurrentUserId(),p,function(){c(e)}))}var h,g="SortName",u=5,p={StartIndex:0,Limit:100,IncludeItemTypes:"Movie",HasQueryLimit:!0,GroupBy:"None",ReportView:"ReportData",DisplayType:"Screen"};e(document).on("pageinit","#libraryReportManagerPage",function(){var t=this;e("#selectIncludeItemTypes",t).on("change",function(){p.StartIndex=0,p.ReportView=e("#selectViewType",t).val(),p.IncludeItemTypes=this.value,p.SortOrder="Ascending",p.ReportColumns=null,e(".btnReportExport",t).hide(),h=!1,n(t),l(t),c(t)}),e("#selectViewType",t).on("change",function(){p.StartIndex=0,p.ReportView=this.value,p.IncludeItemTypes=e("#selectIncludeItemTypes",t).val(),p.SortOrder="Ascending",h=!1,p.ReportColumns=null,n(t),l(t),c(t)}),e("#selectReportGroup",t).on("change",function(){p.GroupBy=this.value,p.StartIndex=0,c(t)}),e("#btnReportExportCsv",t).on("click",function(e){p.ExportType="CSV",s(t,e)}),e("#btnReportExportExcel",t).on("click",function(e){p.ExportType="Excel",s(t,e)}),e("#btnResetReportColumns",t).on("click",function(){p.ReportColumns=null,p.StartIndex=0,h=!1,l(t),c(t)}),e(".viewPanel",t).on("panelopen",function(){l(t)}),e("#selectPageSize",t).on("change",function(){p.Limit=parseInt(this.value),p.StartIndex=0,c(t)}),e("#isFavorite",t).on("change",function(){p.IsFavorite="true"==this.value?!0:"false"==this.value?!1:null,p.StartIndex=0,c(t)}),e(".chkStandardFilter",this).on("change",function(){var e=this.getAttribute("data-filter"),i=p.Filters||"";i=(","+i).replace(","+e,"").substring(1),this.checked&&(i=i?i+","+e:e),p.StartIndex=0,p.Filters=i,c(t)}),e(".chkVideoTypeFilter",this).on("change",function(){var e=this.getAttribute("data-filter"),i=p.VideoTypes||"";i=(","+i).replace(","+e,"").substring(1),this.checked&&(i=i?i+","+e:e),p.StartIndex=0,p.VideoTypes=i,c(t)}),e("#chk3D",this).on("change",function(){p.StartIndex=0,p.Is3D=this.checked?!0:null,c(t)}),e("#chkHD",this).on("change",function(){p.StartIndex=0,p.IsHD=this.checked?!0:null,c(t)}),e("#chkSD",this).on("change",function(){p.StartIndex=0,p.IsHD=this.checked?!1:null,c(t)}),e("#chkSubtitle",this).on("change",function(){p.StartIndex=0,p.HasSubtitles=this.checked?!0:null,c(t)}),e("#chkTrailer",this).on("change",function(){p.StartIndex=0,p.HasTrailer=this.checked?!0:null,c(t)}),e("#chkMissingTrailer",this).on("change",function(){p.StartIndex=0,p.HasTrailer=this.checked?!1:null,c(t)}),e("#chkSpecialFeature",this).on("change",function(){p.StartIndex=0,p.HasSpecialFeature=this.checked?!0:null,c(t)}),e("#chkThemeSong",this).on("change",function(){p.StartIndex=0,p.HasThemeSong=this.checked?!0:null,c(t)}),e("#chkThemeVideo",this).on("change",function(){p.StartIndex=0,p.HasThemeVideo=this.checked?!0:null,c(t)}),e("#radioBasicFilters",this).on("change",function(){this.checked?(e(".basicFilters",t).show(),e(".advancedFilters",t).hide()):e(".basicFilters",t).hide()}),e("#radioAdvancedFilters",this).on("change",function(){this.checked?(e(".advancedFilters",t).show(),e(".basicFilters",t).hide()):e(".advancedFilters",t).hide()}),e("#chkIsLocked",t).on("change",function(){p.StartIndex=0,p.IsLocked=this.checked?!0:null,c(t)}),e("#chkMissingOverview",t).on("change",function(){p.StartIndex=0,p.HasOverview=this.checked?!1:null,c(t)}),e("#chkMissingEpisode",t).on("change",function(){p.StartIndex=0,p.IsMissing=this.checked?!0:!1,c(t)}),e("#chkMissingRating",t).on("change",function(){p.StartIndex=0,p.HasOfficialRating=this.checked?!1:null,c(t)}),e("#chkMissingImdbId",t).on("change",function(){p.StartIndex=0,p.HasImdbId=this.checked?!1:null,c(t)}),e("#chkMissingTmdbId",t).on("change",function(){p.StartIndex=0,p.HasTmdbId=this.checked?!1:null,c(t)}),e("#chkMissingTvdbId",t).on("change",function(){p.StartIndex=0,p.HasTvdbId=this.checked?!1:null,c(t)}),e("#chkYearMismatch",t).on("change",function(){p.StartIndex=0,p.IsYearMismatched=this.checked?!0:null,c(t)}),e("#chkMissingEpisode",t).on("change",function(){p.StartIndex=0,p.IsMissing=this.checked?!0:!1,c(t)}),e("#chkFutureEpisode",t).on("change",function(){p.StartIndex=0,this.checked?(p.IsUnaired=!0,p.IsVirtualUnaired=null):(p.IsUnaired=null,p.IsVirtualUnaired=!1),c(t)}),e("#chkSpecialEpisode",t).on("change",function(){p.ParentIndexNumber=this.checked?0:null,c(t)}),e(".chkAirDays",this).on("change",function(){var e=this.getAttribute("data-filter"),i=p.AirDays||"";i=(","+i).replace(","+e,"").substring(1),this.checked&&(i=i?i+","+e:e),p.AirDays=i,p.StartIndex=0,c(t)}),e(".chkStatus",this).on("change",function(){var e=this.getAttribute("data-filter"),i=p.SeriesStatus||"";i=(","+i).replace(","+e,"").substring(1),this.checked&&(i=i?i+","+e:e),p.SeriesStatus=i,p.StartIndex=0,c(t)}),e(t.getElementsByClassName("viewTabButton")).on("click",function(){var t=e(this).parents(".viewPanel");e(".viewTabButton",t).removeClass("ui-btn-active"),this.classList.add("ui-btn-active"),e(".viewTab",t).addClass("hide"),e("."+this.getAttribute("data-tab"),t).removeClass("hide")})}).on("pageshow","#libraryReportManagerPage",function(){p.UserId=Dashboard.getCurrentUserId();var t=this;p.SortOrder="Ascending",QueryReportFilters.onPageShow(t,p),QueryReportColumns.onPageShow(t,p),e("#selectIncludeItemTypes",t).val(p.IncludeItemTypes).trigger("change"),d(t),h=!1,d(this)})}),define(["jQuery"],function(e){function t(t,i,a,r){var s;s=r.length?e(i,t).show():e(i,t).hide();var n="";n+='<div data-role="controlgroup">';var o=0,c="chk"+i.substring(1);n+=r.map(function(e){var t="",i=c+o,r=e,s=e,n=!1;return e.FieldName&&(r=e.Name,s=e.FieldName,n=e.Visible),t+='<label for="'+i+'">'+r+"</label>",t+='<input id="'+i+'" type="checkbox" data-filter="'+s+'" class="'+a+'"',n&&(t+=' checked="checked" '),t+="/>",o++,t}).join(""),n+="</div>",e(".filterOptions",s).html(n).trigger("create")}function i(e,i){i.Tags&&(i.Tags.length=Math.min(i.Tags.length,50)),t(e,".genreFilters","chkGenreFilter",i.Genres),t(e,".officialRatingFilters","chkOfficialRatingFilter",i.OfficialRatings),t(e,".tagFilters","chkTagFilter",i.Tags),t(e,".yearFilters","chkYearFilter",i.Years)}function a(e,i){i.Tags&&(i.Tags.length=Math.min(i.Tags.length,50)),t(e,".reportsColumns","chkReportColumns",i)}function r(t,i,a){e(".chkGenreFilter",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.Genres||"",r="|";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.Genres=t,a()}),e(".chkTagFilter",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.Tags||"",r="|";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.Tags=t,a()}),e(".chkYearFilter",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.Years||"",r=",";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.Years=t,a()}),e(".chkOfficialRatingFilter",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.OfficialRatings||"",r="|";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.OfficialRatings=t,a()})}function s(t,i,a){e(".chkReportColumns",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.ReportColumns||"",r="|";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.ReportColumns=t,a()})}function n(e,t,a,s){return ApiClient.getJSON(ApiClient.getUrl("Items/Filters",{UserId:t,ParentId:a.ParentId,IncludeItemTypes:a.IncludeItemTypes,ReportView:a.ReportView})).then(function(t){i(e,t),r(e,a,s)})}function o(e,t,i,r){return ApiClient.getJSON(ApiClient.getUrl("Reports/Headers",{UserId:t,IncludeItemTypes:i.IncludeItemTypes,ReportView:i.ReportView})).then(function(t){a(e,t);var n="",o="|";t.map(function(e){("Screen"===e.DisplayType||"ScreenExport"===e.DisplayType)&&(n=n?n+o+e.FieldName:e.FieldName)}),i.ReportColumns||(i.ReportColumns=n),s(e,i,r)})}function c(e,t){t.Genres=null,t.Years=null,t.OfficialRatings=null,t.Tags=null}function d(e,t){t.ReportColumns=null}window.QueryReportFilters={loadFilters:n,onPageShow:c},window.QueryReportColumns={loadColumns:o,onPageShow:d}});