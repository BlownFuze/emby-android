define(["jQuery"],function(e){function t(e){var t="";return t+='<table id="tblReport" data-role="table" data-mode="reflow" class="tblLibraryReport stripedTable ui-responsive table-stroke detailTable" style="display:table;">',t+="<thead>",e.Headers.map(function(e){var i='<th data-priority="persist">';e.ShowHeaderLabel&&(e.SortField&&(i+='<a class="lnkColumnSort" href="#" data-sortfield="'+e.SortField+'" style="text-decoration:underline;">'),i+=e.Name||"&nbsp;",e.SortField&&(i+="</a>",e.SortField===y&&(i+="Descending"===T.SortOrder?'<span style="font-weight:bold;margin-left:5px;vertical-align:top;font-size:14px">&darr;</span>':'<span style="font-weight:bold;margin-left:5px;vertical-align:top;font-size:14px;">&uarr;</span>'))),i+="</th>",t+=i}),t+="</thead>",t+="<tbody>",e.IsGrouped===!1?e.Rows.map(function(a){t+=i(e.Headers,a)}):e.Groups.map(function(a){t+='<tr style="background-color: rgb(51, 51, 51);">',t+='<th scope="rowgroup" colspan="'+e.Headers.length+'">'+(a.Name||"&nbsp;")+"</th>",t+="</tr>",a.Rows.map(function(a){t+=i(e.Headers,a)}),t+="<tr>",t+='<th scope="rowgroup" colspan="'+e.Headers.length+'">&nbsp;</th>',t+="</tr>"}),t+="</tbody>",t+="</table>"}function i(e,t){var i="";i+="<tr>";for(var r=0;r<e.length;r++){var s=e[r],n=t.Columns[r];i+=a(s,t,n)}return i+="</tr>"}function a(e,t,i){var a="";switch(a+="<td>",e.ItemViewType){case"None":a+=i.Name;break;case"Detail":var r=t.Id;i.Id&&(r=i.Id),a+='<a href="itemdetails.html?id='+r+'">'+i.Name+"</a>";break;case"Edit":a+='<a href="edititemmetadata.html?id='+t.Id+'">'+i.Name+"</a>";break;case"List":a+='<a href="itemlist.html?id='+t.Id+'">'+i.Name+"</a>";break;case"ItemByNameDetails":a+='<a href="itemdetails.html?id='+i.Id+"&context="+t.RowType+'">'+i.Name+"</a>";break;case"EmbeddedImage":t.HasEmbeddedImage&&(a+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>');break;case"SubtitleImage":t.HasSubtitles&&(a+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>');break;case"TrailersImage":t.HasLocalTrailer&&(a+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>');break;case"SpecialsImage":t.HasSpecials&&(a+='<div class="libraryReportIndicator clearLibraryReportIndicator"><div class="ui-icon-check ui-btn-icon-notext"></div></div>');break;case"LockDataImage":t.HasLockData&&(a+='<iron-icon icon="lock" style="height:18px"></iron-icon>');break;case"TagsPrimaryImage":t.HasImageTagsPrimary||(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missingprimaryimage.png" title="Missing primary image." style="width:18px"/></a>');break;case"TagsBackdropImage":t.HasImageTagsBackdrop||"Episode"!==t.RowType&&"Season"!==t.RowType&&"Audio"!==t.MediaType&&"TvChannel"!==t.RowType&&"MusicAlbum"!==t.RowType&&(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missingbackdrop.png" title="Missing backdrop image." style="width:18px"/></a>');break;case"TagsLogoImage":t.HasImageTagsLogo||("Movie"===t.RowType||"Trailer"===t.RowType||"Series"===t.RowType||"MusicArtist"===t.RowType||"BoxSet"===t.RowType)&&(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missinglogo.png" title="Missing logo image." style="width:18px"/></a>');break;case"UserPrimaryImage":if(t.UserId){var s=ApiClient.getUserImageUrl(t.UserId,{height:24,type:"Primary"});a+=s?'<img src="'+s+'" />':""}break;case"StatusImage":t.HasLockData&&(a+='<iron-icon icon="lock" style="height:18px"></iron-icon>'),t.HasLocalTrailer||"Movie"!==t.RowType||(a+='<iron-icon icon="videocam" title="Missing local trailer." style="height:18px"></iron-icon>'),t.HasImageTagsPrimary||(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missingprimaryimage.png" title="Missing primary image." style="width:18px"/></a>'),t.HasImageTagsBackdrop||"Episode"!==t.RowType&&"Season"!==t.RowType&&"Audio"!==t.MediaType&&"TvChannel"!==t.RowType&&"MusicAlbum"!==t.RowType&&(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missingbackdrop.png" title="Missing backdrop image." style="width:18px"/></a>'),t.HasImageTagsLogo||("Movie"===t.RowType||"Trailer"===t.RowType||"Series"===t.RowType||"MusicArtist"===t.RowType||"BoxSet"===t.RowType)&&(a+='<a href="edititemimages.html?id='+t.Id+'"><img src="css/images/editor/missinglogo.png" title="Missing logo image." style="width:18px"/></a>');break;default:a+=i.Name}return a+="</td>"}function r(e){var t="";return t+='<div class="detailSection" >',t+='<div class="detailSectionContent">',e.Groups.map(function(e){t+='<div class="card transparentCard bannerCard"  style="vertical-align: top;">',t+='<div class="visualCardBox">',t+='<div class="cardBox " >',t+='<div class="detailSection">',t+='<div class="detailSectionHeader">',t+="<span>"+e.Header+"&nbsp;</span>",t+="</div>",t+='<div class="detailSectionContent">',t+='<div class="childrenItemsContainer itemsContainer" style="text-align: left;">',t+='<ul class="itemsListview ui-listview" >';for(var i=e.Items.length-1,a=0;S>a;a++){if(t+='<li class="ui-li listItem ui-li-has-alt ui-first-child">',i>=a){var r=e.Items[a];t+='<a class="item ui-btn"',r.Id>""&&(t+=' href="itemdetails.html?id='+r.Id+'"'),t+=">"+r.Name+"&nbsp;</a>",t+='<a title="" class="listviewMenuButton ui-btn ui-btn-inline">'+r.Value+"&nbsp;</a>"}else t+='<a class="item ui-btn">&nbsp;</a>';t+="</li>"}t+="</ul>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>"}),t+="</div>",t+="</div>"}function s(){T.UserId=Dashboard.getCurrentUserId(),T.HasQueryLimit=!1;var e=ApiClient.getUrl("Reports/Items/Download",T);e&&(window.location.href=e)}function n(t){T.UserId=Dashboard.getCurrentUserId();var i="";i=ApiClient.getUrl("Reports/Headers",T),ApiClient.getJSON(i).then(function(i){var a="None";e("#selectReportGroup",t).find("option").remove().end(),e("#selectReportGroup",t).append('<option value="None"></option>'),i.map(function(i){if(("Screen"===i.DisplayType||"ScreenExport"===i.DisplayType)&&i.CanGroup&&i.FieldName.length>0){var r='<option value="'+i.FieldName+'">'+i.Name+"</option>";e("#selectReportGroup",t).append(r),T.GroupBy===i.FieldName&&(a=i.FieldName)}}),e("#selectPageSize",t).val(a)})}function o(i,a){window.scrollTo(0,0);var s="";"ReportData"===T.ReportView||"ReportStatistics"===T.ReportView?(e("#selectIncludeItemTypesBox",i).show(),e("#tabFilter",i).show()):(e("#selectIncludeItemTypesBox",i).hide(),e("#tabFilterBox",i).hide(),e("#tabFilter",i).hide());var n=LibraryBrowser.getQueryPagingHtml({startIndex:T.StartIndex,limit:T.Limit,totalRecordCount:a.TotalRecordCount,updatePageSizeSetting:!1,viewButton:!0,showLimit:!1});switch("ReportData"===T.ReportView||"ReportActivities"===T.ReportView?(e(".listTopPaging",i).html(n).trigger("create"),e(".listTopPaging",i).show(),e(".listBottomPaging",i).html(n).trigger("create"),e(".listBottomPaging",i).show(),e(".btnNextPage",i).on("click",function(){T.StartIndex+=T.Limit,c(i)}),e(".btnNextPage",i).show(),e(".btnPreviousPage",i).on("click",function(){T.StartIndex-=T.Limit,c(i)}),e(".btnPreviousPage",i).show(),e("#btnReportExport",i).show(),e("#selectPageSizeBox",i).show(),e("#selectReportGroupingBox",i).show(),e("#grpReportsColumns",i).show(),s+=t(a),e(".reporContainer",i).html(s).trigger("create"),e(".lnkColumnSort",i).on("click",function(){var e=this.getAttribute("data-sortfield");T.SortBy===e?"Descending"===T.SortOrder?(T.SortOrder="Ascending",T.SortBy=y):(T.SortOrder="Descending",T.SortBy=e):(T.SortOrder="Ascending",T.SortBy=e),T.StartIndex=0,c(i)})):(e(".listTopPaging",i).html(n).trigger("create"),e(".listTopPaging",i).show(),e(".listBottomPaging",i).hide(),e(".btnNextPage",i).hide(),e(".btnPreviousPage",i).hide(),e("#btnReportExport",i).hide(),e("#selectPageSizeBox",i).hide(),e("#selectReportGroupingBox",i).hide(),e("#grpReportsColumns",i).hide(),s+=r(a),e(".reporContainer",i).html(s).trigger("create")),e("#GroupStatus",i).hide(),e("#GroupAirDays",i).hide(),e("#GroupEpisodes",i).hide(),T.IncludeItemTypes){case"Series":case"Season":e("#GroupStatus",i).show(),e("#GroupAirDays",i).show();break;case"Episode":e("#GroupStatus",i).show(),e("#GroupAirDays",i).show(),e("#GroupEpisodes",i).show()}e(".viewPanel",i).refresh}function c(e){Dashboard.showLoadingMsg(),T.UserId=Dashboard.getCurrentUserId();var t="";switch(T.ReportView){case"ReportData":T.HasQueryLimit=!0,t=ApiClient.getUrl("Reports/Items",T);break;case"ReportStatistics":T.TopItems=S,T.HasQueryLimit=!1,t=ApiClient.getUrl("Reports/Statistics",T);break;case"ReportActivities":T.HasQueryLimit=!0,t=ApiClient.getUrl("Reports/Activities",T)}ApiClient.getJSON(t).then(function(t){d(e),o(e,t)}),Dashboard.hideLoadingMsg()}function d(t){e(".chkStandardFilter",t).each(function(){var e=","+(T.Filters||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}).checkboxradio("refresh"),e(".chkVideoTypeFilter",t).each(function(){var e=","+(T.VideoTypes||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}).checkboxradio("refresh"),e(".chkStatus",t).each(function(){var e=","+(T.SeriesStatus||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}).checkboxradio("refresh"),e(".chkAirDays",t).each(function(){var e=","+(T.AirDays||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}).checkboxradio("refresh"),e("#chk3D",t).checked(1==T.Is3D).checkboxradio("refresh"),e("#chkHD",t).checked(1==T.IsHD).checkboxradio("refresh"),e("#chkSD",t).checked(0==T.IsHD).checkboxradio("refresh"),e("#chkSubtitle",t).checked(1==T.HasSubtitles).checkboxradio("refresh"),e("#chkTrailer",t).checked(1==T.HasTrailer).checkboxradio("refresh"),e("#chkMissingTrailer",t).checked(0==T.HasTrailer).checkboxradio("refresh"),e("#chkSpecialFeature",t).checked(1==T.HasSpecialFeature).checkboxradio("refresh"),e("#chkThemeSong",t).checked(1==T.HasThemeSong).checkboxradio("refresh"),e("#chkThemeVideo",t).checked(1==T.HasThemeVideo).checkboxradio("refresh"),e("#selectPageSize",t).val(T.Limit),e("#chkMissingRating",t).checked(0==T.HasOfficialRating).checkboxradio("refresh"),e("#chkMissingOverview",t).checked(0==T.HasOverview).checkboxradio("refresh"),e("#chkIsLocked",t).checked(1==T.IsLocked).checkboxradio("refresh"),e("#chkMissingImdbId",t).checked(0==T.HasImdbId).checkboxradio("refresh"),e("#chkMissingTmdbId",t).checked(0==T.HasTmdbId).checkboxradio("refresh"),e("#chkMissingTvdbId",t).checked(0==T.HasTvdbId).checkboxradio("refresh"),e("#chkSpecialEpisode",t).checked(0==T.ParentIndexNumber).checkboxradio("refresh"),e("#chkMissingEpisode",t).checked(1==T.IsMissing).checkboxradio("refresh"),e("#chkFutureEpisode",t).checked(1==T.IsUnaired).checkboxradio("refresh"),e("#selectIncludeItemTypes").val(T.IncludeItemTypes),e("#isFavorite").val(1==T.IsFavorite?"true":0==T.IsFavorite?"false":"-")}function l(e){v||(v=!0,QueryReportFilters.loadFilters(e,Dashboard.getCurrentUserId(),T,function(){c(e)}),QueryReportColumns.loadColumns(e,Dashboard.getCurrentUserId(),T,function(){c(e)}))}function h(t,i,a,r){var s;s=r.length?e(i,t).show():e(i,t).hide();var n="";n+='<div data-role="controlgroup">';var o=0,c="chk"+i.substring(1);n+=r.map(function(e){var t="",i=c+o,r=e,s=e,n=!1;return e.FieldName&&(r=e.Name,s=e.FieldName,n=e.Visible),t+='<label for="'+i+'">'+r+"</label>",t+='<input id="'+i+'" type="checkbox" data-filter="'+s+'" class="'+a+'"',n&&(t+=' checked="checked" '),t+="/>",o++,t}).join(""),n+="</div>",e(".filterOptions",s).html(n).trigger("create")}function u(e,t){t.Tags&&(t.Tags.length=Math.min(t.Tags.length,50)),h(e,".genreFilters","chkGenreFilter",t.Genres),h(e,".officialRatingFilters","chkOfficialRatingFilter",t.OfficialRatings),h(e,".tagFilters","chkTagFilter",t.Tags),h(e,".yearFilters","chkYearFilter",t.Years)}function g(e,t){t.Tags&&(t.Tags.length=Math.min(t.Tags.length,50)),h(e,".reportsColumns","chkReportColumns",t)}function p(t,i,a){e(".chkGenreFilter",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.Genres||"",r="|";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.Genres=t,a()}),e(".chkTagFilter",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.Tags||"",r="|";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.Tags=t,a()}),e(".chkYearFilter",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.Years||"",r=",";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.Years=t,a()}),e(".chkOfficialRatingFilter",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.OfficialRatings||"",r="|";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.OfficialRatings=t,a()})}function m(t,i,a){e(".chkReportColumns",t).on("change",function(){var e=this.getAttribute("data-filter"),t=i.ReportColumns||"",r="|";t=(r+t).replace(r+e,"").substring(1),this.checked&&(t=t?t+r+e:e),i.StartIndex=0,i.ReportColumns=t,a()})}function k(e,t,i,a){return ApiClient.getJSON(ApiClient.getUrl("Items/Filters",{UserId:t,ParentId:i.ParentId,IncludeItemTypes:i.IncludeItemTypes,ReportView:i.ReportView})).then(function(t){u(e,t),p(e,i,a)})}function f(e,t,i,a){return ApiClient.getJSON(ApiClient.getUrl("Reports/Headers",{UserId:t,IncludeItemTypes:i.IncludeItemTypes,ReportView:i.ReportView})).then(function(t){g(e,t);var r="",s="|";t.map(function(e){("Screen"===e.DisplayType||"ScreenExport"===e.DisplayType)&&(r=r?r+s+e.FieldName:e.FieldName)}),i.ReportColumns||(i.ReportColumns=r),m(e,i,a)})}function I(e,t){t.Genres=null,t.Years=null,t.OfficialRatings=null,t.Tags=null}function b(e,t){t.ReportColumns=null}var v,y="SortName",S=5,T={StartIndex:0,Limit:100,IncludeItemTypes:"Movie",HasQueryLimit:!0,GroupBy:"None",ReportView:"ReportData",DisplayType:"Screen"};e(document).on("pageinit","#libraryReportManagerPage",function(){var t=this;e("#selectIncludeItemTypes",t).on("change",function(){T.StartIndex=0,T.ReportView=e("#selectViewType",t).val(),T.IncludeItemTypes=this.value,T.SortOrder="Ascending",T.ReportColumns=null,e(".btnReportExport",t).hide(),v=!1,n(t),l(t),c(t)}),e("#selectViewType",t).on("change",function(){T.StartIndex=0,T.ReportView=this.value,T.IncludeItemTypes=e("#selectIncludeItemTypes",t).val(),T.SortOrder="Ascending",v=!1,T.ReportColumns=null,n(t),l(t),c(t)}),e("#selectReportGroup",t).on("change",function(){T.GroupBy=this.value,T.StartIndex=0,c(t)}),e("#btnReportExportCsv",t).on("click",function(e){T.ExportType="CSV",s(t,e)}),e("#btnReportExportExcel",t).on("click",function(e){T.ExportType="Excel",s(t,e)}),e("#btnResetReportColumns",t).on("click",function(){T.ReportColumns=null,T.StartIndex=0,v=!1,l(t),c(t)}),e(".viewPanel",t).on("panelopen",function(){l(t)}),e("#selectPageSize",t).on("change",function(){T.Limit=parseInt(this.value),T.StartIndex=0,c(t)}),e("#isFavorite",t).on("change",function(){T.IsFavorite="true"==this.value?!0:"false"==this.value?!1:null,T.StartIndex=0,c(t)}),e(".chkStandardFilter",this).on("change",function(){var e=this.getAttribute("data-filter"),i=T.Filters||"";i=(","+i).replace(","+e,"").substring(1),this.checked&&(i=i?i+","+e:e),T.StartIndex=0,T.Filters=i,c(t)}),e(".chkVideoTypeFilter",this).on("change",function(){var e=this.getAttribute("data-filter"),i=T.VideoTypes||"";i=(","+i).replace(","+e,"").substring(1),this.checked&&(i=i?i+","+e:e),T.StartIndex=0,T.VideoTypes=i,c(t)}),e("#chk3D",this).on("change",function(){T.StartIndex=0,T.Is3D=this.checked?!0:null,c(t)}),e("#chkHD",this).on("change",function(){T.StartIndex=0,T.IsHD=this.checked?!0:null,c(t)}),e("#chkSD",this).on("change",function(){T.StartIndex=0,T.IsHD=this.checked?!1:null,c(t)}),e("#chkSubtitle",this).on("change",function(){T.StartIndex=0,T.HasSubtitles=this.checked?!0:null,c(t)}),e("#chkTrailer",this).on("change",function(){T.StartIndex=0,T.HasTrailer=this.checked?!0:null,c(t)}),e("#chkMissingTrailer",this).on("change",function(){T.StartIndex=0,T.HasTrailer=this.checked?!1:null,c(t)}),e("#chkSpecialFeature",this).on("change",function(){T.StartIndex=0,T.HasSpecialFeature=this.checked?!0:null,c(t)}),e("#chkThemeSong",this).on("change",function(){T.StartIndex=0,T.HasThemeSong=this.checked?!0:null,c(t)}),e("#chkThemeVideo",this).on("change",function(){T.StartIndex=0,T.HasThemeVideo=this.checked?!0:null,c(t)}),e("#radioBasicFilters",this).on("change",function(){this.checked?(e(".basicFilters",t).show(),e(".advancedFilters",t).hide()):e(".basicFilters",t).hide()}),e("#radioAdvancedFilters",this).on("change",function(){this.checked?(e(".advancedFilters",t).show(),e(".basicFilters",t).hide()):e(".advancedFilters",t).hide()}),e("#chkIsLocked",t).on("change",function(){T.StartIndex=0,T.IsLocked=this.checked?!0:null,c(t)}),e("#chkMissingOverview",t).on("change",function(){T.StartIndex=0,T.HasOverview=this.checked?!1:null,c(t)}),e("#chkMissingEpisode",t).on("change",function(){T.StartIndex=0,T.IsMissing=this.checked?!0:!1,c(t)}),e("#chkMissingRating",t).on("change",function(){T.StartIndex=0,T.HasOfficialRating=this.checked?!1:null,c(t)}),e("#chkMissingImdbId",t).on("change",function(){T.StartIndex=0,T.HasImdbId=this.checked?!1:null,c(t)}),e("#chkMissingTmdbId",t).on("change",function(){T.StartIndex=0,T.HasTmdbId=this.checked?!1:null,c(t)}),e("#chkMissingTvdbId",t).on("change",function(){T.StartIndex=0,T.HasTvdbId=this.checked?!1:null,c(t)}),e("#chkMissingEpisode",t).on("change",function(){T.StartIndex=0,T.IsMissing=this.checked?!0:!1,c(t)}),e("#chkFutureEpisode",t).on("change",function(){T.StartIndex=0,this.checked?(T.IsUnaired=!0,T.IsVirtualUnaired=null):(T.IsUnaired=null,T.IsVirtualUnaired=!1),c(t)}),e("#chkSpecialEpisode",t).on("change",function(){T.ParentIndexNumber=this.checked?0:null,c(t)}),e(".chkAirDays",this).on("change",function(){var e=this.getAttribute("data-filter"),i=T.AirDays||"";i=(","+i).replace(","+e,"").substring(1),this.checked&&(i=i?i+","+e:e),T.AirDays=i,T.StartIndex=0,c(t)}),e(".chkStatus",this).on("change",function(){var e=this.getAttribute("data-filter"),i=T.SeriesStatus||"";i=(","+i).replace(","+e,"").substring(1),this.checked&&(i=i?i+","+e:e),T.SeriesStatus=i,T.StartIndex=0,c(t)}),e(t.getElementsByClassName("viewTabButton")).on("click",function(){var t=e(this).parents(".viewPanel");e(".viewTabButton",t).removeClass("ui-btn-active"),this.classList.add("ui-btn-active"),e(".viewTab",t).addClass("hide"),e("."+this.getAttribute("data-tab"),t).removeClass("hide")})}).on("pageshow","#libraryReportManagerPage",function(){T.UserId=Dashboard.getCurrentUserId();var t=this;T.SortOrder="Ascending",QueryReportFilters.onPageShow(t,T),QueryReportColumns.onPageShow(t,T),e("#selectIncludeItemTypes",t).val(T.IncludeItemTypes).trigger("change"),d(t),v=!1,d(this)}),window.QueryReportFilters={loadFilters:k,onPageShow:I},window.QueryReportColumns={loadColumns:f,onPageShow:b}});