define(["jQuery"],function(e){function t(t,i,n){e("#chkSubtitlesMovies",t).checked(i.DownloadMovieSubtitles),e("#chkSubtitlesEpisodes",t).checked(i.DownloadEpisodeSubtitles),e("#chkSkipIfGraphicalSubsPresent",t).checked(i.SkipIfGraphicalSubtitlesPresent),e("#chkSkipIfAudioTrackPresent",t).checked(i.SkipIfAudioTrackMatches),e("#txtOpenSubtitleUsername",t).val(i.OpenSubtitlesUsername),e("#txtOpenSubtitlePassword",t).val(""),a(t,i,n),Dashboard.hideLoadingMsg()}function a(t,a,i){for(var n="",s=0,o=i.length;o>s;s++){var u=i[s];n+='<paper-checkbox class="chkLang" data-lang="'+u.ThreeLetterISOLanguageName.toLowerCase()+'">'+u.DisplayName+"</paper-checkbox>"}e(".downloadLanguages",t).html(n);var c=a.DownloadLanguages||[];e(".chkLang",t).each(function(){this.checked=-1!=c.indexOf(this.getAttribute("data-lang"))})}function i(){Dashboard.showLoadingMsg();var t=this;return ApiClient.getNamedConfiguration("subtitles").then(function(a){a.DownloadMovieSubtitles=e("#chkSubtitlesMovies",t).checked(),a.DownloadEpisodeSubtitles=e("#chkSubtitlesEpisodes",t).checked(),a.SkipIfGraphicalSubtitlesPresent=e("#chkSkipIfGraphicalSubsPresent",t).checked(),a.SkipIfAudioTrackMatches=e("#chkSkipIfAudioTrackPresent",t).checked(),a.OpenSubtitlesUsername=e("#txtOpenSubtitleUsername",t).val();var i=e("#txtOpenSubtitlePassword",t).val();i&&(a.OpenSubtitlesPasswordHash=i),a.DownloadLanguages=e(".chkLang",t).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-lang")}),ApiClient.updateNamedConfiguration("subtitles",a).then(Dashboard.processServerConfigurationUpdateResult)}),!1}e(document).on("pageinit","#metadataSubtitlesPage",function(){e(".metadataSubtitlesForm").off("submit",i).on("submit",i)}).on("pageshow","#metadataSubtitlesPage",function(){Dashboard.showLoadingMsg();var e=this,a=ApiClient.getNamedConfiguration("subtitles"),i=ApiClient.getCultures();Promise.all([a,i]).then(function(a){t(e,a[0],a[1])})})});