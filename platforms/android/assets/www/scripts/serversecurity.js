define(["datetime","jQuery"],function(e,t){function n(e,t){require(["confirm"],function(n){n(Globalize.translate("MessageConfirmRevokeApiKey"),Globalize.translate("HeaderConfirmRevokeApiKey")).then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Auth/Keys/"+t)}).then(function(){i(e)})})})}function a(a,i,r){var l=i.map(function(t){var n="";n+="<tr>",n+="<td>",n+='<button data-token="'+t.AccessToken+'" class="btnRevoke" data-mini="true" title="'+Globalize.translate("ButtonRevoke")+'" style="margin:0;">'+Globalize.translate("ButtonRevoke")+"</button>",n+="</td>",n+='<td style="vertical-align:middle;">',n+=t.AccessToken,n+="</td>",n+='<td style="vertical-align:middle;">',n+=t.AppName||"",n+="</td>",n+='<td style="vertical-align:middle;">',n+=t.DeviceName||"",n+="</td>",n+='<td style="vertical-align:middle;">';var a=r.filter(function(e){return e.Id==t.UserId})[0];a&&(n+=a.Name),n+="</td>",n+='<td style="vertical-align:middle;">';var i=e.parseISO8601Date(t.DateCreated,!0);return n+=e.toLocaleDateString(i)+" "+e.getDisplayTime(i),n+="</td>",n+="</tr>"}).join(""),o=t(".resultBody",a).html(l).parents(".tblApiKeys").table("refresh").trigger("create");t(".btnRevoke",o).on("click",function(){n(a,this.getAttribute("data-token"))}),Dashboard.hideLoadingMsg()}function i(e){Dashboard.showLoadingMsg(),ApiClient.getUsers().then(function(t){ApiClient.getJSON(ApiClient.getUrl("Auth/Keys")).then(function(n){a(e,n.Items,t)})})}function r(e){require(["prompt"],function(t){t({title:Globalize.translate("HeaderNewApiKey"),label:Globalize.translate("LabelAppName"),description:Globalize.translate("LabelAppNameExample")}).then(function(t){ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Auth/Keys",{App:t})}).then(function(){i(e)})})})}function l(){return[{href:"dashboardhosting.html",name:Globalize.translate("TabHosting")},{href:"serversecurity.html",name:Globalize.translate("TabSecurity")}]}pageIdOn("pageinit","serverSecurityPage",function(){var e=this;t(".btnNewKey",e).on("click",function(){r(e)})}),pageIdOn("pagebeforeshow","serverSecurityPage",function(){LibraryMenu.setTabs("adminadvanced",1,l);var e=this;i(e)})});