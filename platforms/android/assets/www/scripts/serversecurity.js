!function(e){function t(e,t){Dashboard.confirm(Globalize.translate("MessageConfirmRevokeApiKey"),Globalize.translate("HeaderConfirmRevokeApiKey"),function(n){n&&(Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Auth/Keys/"+t)}).then(function(){a(e)}))})}function n(n,a,i){var r=a.map(function(e){var t="";t+="<tr>",t+="<td>",t+='<button data-token="'+e.AccessToken+'" class="btnRevoke" data-mini="true" title="'+Globalize.translate("ButtonRevoke")+'" style="margin:0;">'+Globalize.translate("ButtonRevoke")+"</button>",t+="</td>",t+='<td style="vertical-align:middle;">',t+=e.AccessToken,t+="</td>",t+='<td style="vertical-align:middle;">',t+=e.AppName||"",t+="</td>",t+='<td style="vertical-align:middle;">',t+=e.DeviceName||"",t+="</td>",t+='<td style="vertical-align:middle;">';var n=i.filter(function(t){return t.Id==e.UserId})[0];n&&(t+=n.Name),t+="</td>",t+='<td style="vertical-align:middle;">';var a=parseISO8601Date(e.DateCreated,{toLocal:!0});return t+=a.toLocaleDateString()+" "+LibraryBrowser.getDisplayTime(a),t+="</td>",t+="</tr>"}).join(""),o=e(".resultBody",n).html(r).parents(".tblApiKeys").table("refresh").trigger("create");e(".btnRevoke",o).on("click",function(){t(n,this.getAttribute("data-token"))}),Dashboard.hideLoadingMsg()}function a(e){Dashboard.showLoadingMsg(),ApiClient.getUsers().then(function(t){ApiClient.getJSON(ApiClient.getUrl("Auth/Keys")).then(function(a){n(e,a.Items,t)})})}function i(){var t=this,n=e(t).parents(".page");return Dashboard.showLoadingMsg(),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Auth/Keys",{App:e("#txtAppName",t).val()})}).then(function(){e(".newKeyPanel",n).panel("close"),a(n)}),!1}pageIdOn("pageinit","serverSecurityPage",function(){var t=this;e(".btnNewKey",t).on("click",function(){e(".newKeyPanel",t).panel("toggle"),e("#txtAppName",t).val("").focus()}),e(".newKeyForm").off("submit",i).on("submit",i)}),pageIdOn("pagebeforeshow","serverSecurityPage",function(){var e=this;a(e)})}(jQuery,document);