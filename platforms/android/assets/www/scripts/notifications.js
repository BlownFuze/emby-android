define(["libraryBrowser"],function(i){function t(){var i=this;i.getNotificationsSummaryPromise=null,i.total=0,i.getNotificationsSummary=function(){var t=window.ApiClient;if(t)return i.getNotificationsSummaryPromise=i.getNotificationsSummaryPromise||t.getNotificationSummary(Dashboard.getCurrentUserId()),i.getNotificationsSummaryPromise},i.updateNotificationCount=function(){if(Dashboard.getCurrentUserId()&&window.ApiClient){var t=i.getNotificationsSummary();t&&t.then(function(i){var t=document.querySelector(".btnNotificationsInner");t&&(t.classList.remove("levelNormal"),t.classList.remove("levelWarning"),t.classList.remove("levelError"),t.innerHTML=i.UnreadCount,i.UnreadCount&&t.classList.add("level"+i.MaxUnreadNotificationLevel))})}},i.markNotificationsRead=function(t,e){ApiClient.markNotificationsRead(Dashboard.getCurrentUserId(),t,!0).then(function(){i.getNotificationsSummaryPromise=null,i.updateNotificationCount(),e&&e()})},i.showNotificationsList=function(i,t,n){e(i,t,n,!0)}}function e(i,t,e,o){var a=window.ApiClient;return a?a.getNotifications(Dashboard.getCurrentUserId(),{StartIndex:i,Limit:t}).then(function(a){n(a.Notifications,a.TotalRecordCount,i,t,e,o)}):void 0}function n(t,e,n,a,r,s){if(!e)return void r.html('<p style="padding:.5em 1em;">'+Globalize.translate("LabelNoUnreadNotifications")+"</p>");Notifications.total=e;var c="";if(e>a&&s===!0){var d={StartIndex:n,Limit:a};c+=i.getQueryPagingHtml({startIndex:d.StartIndex,limit:d.Limit,totalRecordCount:e,showLimit:!1,updatePageSizeSetting:!1})}require(["humanedate","paper-fab","paper-item-body","paper-icon-item"],function(){for(var i=0,e=t.length;e>i;i++){var n=t[i];c+=o(n)}r.html(c).trigger("create")})}function o(i){var t="";return i.Url&&(t+='<a class="clearLink" href="'+i.Url+'" target="_blank">'),t+="<paper-icon-item>",t+="Error"==i.Level?'<paper-fab mini class="" style="background:#cc3333;" icon="error" item-icon></paper-fab>':'<paper-fab mini  class="blue" icon="dvr" item-icon></paper-fab>',t+="<paper-item-body three-line>",t+="<div>",t+=i.Name,t+="</div>",t+="<div secondary>",t+=humane_date(i.Date),t+="</div>",i.Description&&(t+="<div secondary>",t+=i.Description,t+="</div>"),t+="</paper-item-body>",t+="</paper-icon-item>",i.Url&&(t+="</a>"),t}function a(i,t){("NotificationUpdated"===t.MessageType||"NotificationAdded"===t.MessageType||"NotificationsMarkedRead"===t.MessageType)&&(Notifications.getNotificationsSummaryPromise=null,Notifications.updateNotificationCount())}function r(i){Events.off(i,"websocketmessage",a),Events.on(i,"websocketmessage",a)}window.Notifications=new t;var s=!0;window.ApiClient&&r(window.ApiClient),Events.on(ConnectionManager,"apiclientcreated",function(i,t){r(t)}),Events.on(ConnectionManager,"localusersignedin",function(){s=!0}),Events.on(ConnectionManager,"localusersignedout",function(){s=!0}),pageClassOn("pageshow","type-interior",function(){s&&Notifications.updateNotificationCount()})});