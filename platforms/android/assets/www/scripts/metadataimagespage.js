define(["jQuery","listViewStyle"],function(e){function t(t,a){for(var i="",n=0,r=a.length;r>n;n++){var o=a[n],s=0==n?' selected="selected"':"";i+='<option value="'+o.type+'"'+s+">"+Globalize.translate(o.name)+"</option>"}e("#selectItemType",t).html(i).trigger("change"),Dashboard.hideLoadingMsg()}function a(e,t){Dashboard.showLoadingMsg(),h=t;var a=ApiClient.getServerConfiguration(),i=ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataPlugins"));Promise.all([a,i]).then(function(a){var i=a[0],r=a[1];i=i.MetadataOptions.filter(function(e){return e.ItemType==t})[0],i?(n(e,t,i,r),Dashboard.hideLoadingMsg()):ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).then(function(a){i=a,n(e,t,i,r),Dashboard.hideLoadingMsg()})})}function i(t,a){a?(t.show(),e("input",t).attr("required","required")):(t.hide(),e("input",t).attr("required","").removeAttr("required"))}function n(t,a,n,c){var p=c.filter(function(e){return a==e.ItemType})[0];i(e(".backdropFields",t),-1!=p.SupportedImageTypes.indexOf("Backdrop")),i(e(".screenshotFields",t),-1!=p.SupportedImageTypes.indexOf("Screenshot")),e(".imageType",t).each(function(){var e=this.getAttribute("data-imagetype");-1==p.SupportedImageTypes.indexOf(e)?this.classList.add("hide"):this.classList.remove("hide"),this.checked=r(n,e).Limit?!0:!1});var m=r(n,"Backdrop");e("#txtMaxBackdrops",t).val(m.Limit),e("#txtMinBackdropDownloadWidth",t).val(m.MinWidth);var u=r(n,"Screenshot");e("#txtMaxScreenshots",t).val(u.Limit),e("#txtMinScreenshotDownloadWidth",t).val(u.MinWidth),d(t,a,n,p),l(t,a,n,p),s(t,a,n,p),o(t,a,n,p)}function r(e,t){return e.ImageOptions.filter(function(e){return e.Type==t})[0]||{Type:t,MinWidth:"Backdrop"==t?1280:0,Limit:"Backdrop"==t?3:1}}function o(t,a,i,n){var r=n.Plugins.filter(function(e){return"ImageFetcher"==e.Type}),o="";if(!r.length)return void e(".imageFetchers",t).html(o).hide();var s,l,d;for(o+='<div class="paperListLabel">'+Globalize.translate("LabelImageFetchers")+"</div>",o+='<div class="paperList">',s=0,l=r.length;l>s;s++){d=r[s];var c=-1==i.DisabledImageFetchers.indexOf(d.Name)?' checked="checked"':"";o+='<div class="listItem imageFetcherItem" data-pluginname="'+d.Name+'">',o+='<paper-checkbox class="chkImageFetcher" data-pluginname="'+d.Name+'" item-icon'+c+"></paper-checkbox>",o+='<div class="listItemBody">',o+='<h3 class="listItemBodyText">',o+=d.Name,o+="</h3>",o+="</div>",o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonUp")+'" class="btnUp" style="padding:3px 8px;"><i class="md-icon">keyboard_arrow_up</i></button>',o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonDown")+'" class="btnDown" style="padding:3px 8px;"><i class="md-icon">keyboard_arrow_down</i></button>',o+="</div>"}o+="</div>",o+='<div class="fieldDescription">'+Globalize.translate("LabelImageFetchersHelp")+"</div>";var p=e(".imageFetchers",t).html(o).show();e(".btnDown",p).on("click",function(){var t=e(this).parents(".imageFetcherItem")[0],a=e(t).next(".imageFetcherItem")[0];a&&(t.parentNode.removeChild(t),e(t).insertAfter(a))}),e(".btnUp",p).on("click",function(){var t=e(this).parents(".imageFetcherItem")[0],a=e(t).prev(".imageFetcherItem")[0];a&&(t.parentNode.removeChild(t),e(t).insertBefore(a))})}function s(t,a,i,n){var r=n.Plugins.filter(function(e){return"MetadataSaver"==e.Type}),o="";if(!r.length)return void e(".metadataSavers",t).html(o).hide();o+='<div class="paperListLabel">'+Globalize.translate("LabelMetadataSavers")+"</div>",o+='<div class="paperCheckboxList paperList">';for(var s=0,l=r.length;l>s;s++){var d=r[s],c=-1==i.DisabledMetadataSavers.indexOf(d.Name)?' checked="checked"':"";o+='<paper-checkbox class="chkMetadataSaver"'+c+' data-pluginname="'+d.Name+'">'+d.Name+"</paper-checkbox>"}o+="</div>",o+='<div class="fieldDescription" style="margin-top:.25em;">'+Globalize.translate("LabelMetadataSaversHelp")+"</div>",t.querySelector(".metadataSavers").innerHTML=o}function l(t,a,i,n){var r=n.Plugins.filter(function(e){return"MetadataFetcher"==e.Type}),o="";if(!r.length)return void e(".metadataFetchers",t).html(o).hide();var s,l,d;for(o+='<div class="paperListLabel">'+Globalize.translate("LabelMetadataDownloaders")+"</div>",o+='<div class="paperList">',s=0,l=r.length;l>s;s++){d=r[s];var c=-1==i.DisabledMetadataFetchers.indexOf(d.Name)?' checked="checked"':"";o+='<div class="listItem metadataFetcherItem" data-pluginname="'+d.Name+'">',o+='<paper-checkbox class="chkMetadataFetcher" data-pluginname="'+d.Name+'" item-icon'+c+"></paper-checkbox>",o+='<div class="listItemBody">',o+='<h3 class="listItemBodyText">',o+=d.Name,o+="</h3>",o+="</div>",o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonUp")+'" class="btnUp" style="padding:3px 8px;"><i class="md-icon">keyboard_arrow_up</i></button>',o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonDown")+'" class="btnDown" style="padding:3px 8px;"><i class="md-icon">keyboard_arrow_down</i></button>',o+="</div>"}o+="</div>",o+='<div class="fieldDescription">'+Globalize.translate("LabelMetadataDownloadersHelp")+"</div>";var p=e(".metadataFetchers",t).html(o).show();e(".btnDown",p).on("click",function(){var t=e(this).parents(".metadataFetcherItem")[0],a=e(t).next(".metadataFetcherItem")[0];a&&(t.parentNode.removeChild(t),e(t).insertAfter(a))}),e(".btnUp",p).on("click",function(){var t=e(this).parents(".metadataFetcherItem")[0],a=e(t).prev(".metadataFetcherItem")[0];a&&(t.parentNode.removeChild(t),e(t).insertBefore(a))})}function d(t,a,i,n){var r=n.Plugins.filter(function(e){return"LocalMetadataProvider"==e.Type}),o="";if(r.length<2)return void e(".metadataReaders",t).html(o).hide();o+='<div class="paperListLabel">'+Globalize.translate("LabelMetadataReaders")+"</div>",o+='<div class="paperList">';for(var s=0,l=r.length;l>s;s++){var d=r[s];o+='<div class="listItem localReaderOption" data-pluginname="'+d.Name+'">',o+='<i class="listItemIcon md-icon">live_tv</i>',o+='<div class="listItemBody">',o+='<h3 class="listItemBodyText">',o+=d.Name,o+="</h3>",o+="</div>",s>0?o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonUp")+'" class="btnLocalReaderUp btnLocalReaderMove" data-pluginindex="'+s+'"><i class="md-icon">keyboard_arrow_up</i></button>':r.length>1&&(o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonDown")+'" class="btnLocalReaderDown btnLocalReaderMove" data-pluginindex="'+s+'"><i class="md-icon">keyboard_arrow_down</i></button>'),o+="</div>"}o+="</div>",o+='<div class="fieldDescription">'+Globalize.translate("LabelMetadataReadersHelp")+"</div>",e(".metadataReaders",t).html(o).show()}function c(e){t(e,[{name:"OptionMovies",type:"Movie"},{name:"OptionCollections",type:"BoxSet"},{name:"OptionSeries",type:"Series"},{name:"OptionSeasons",type:"Season"},{name:"OptionEpisodes",type:"Episode"},{name:"OptionGames",type:"Game"},{name:"OptionGameSystems",type:"GameSystem"},{name:"OptionMusicArtists",type:"MusicArtist"},{name:"OptionMusicAlbums",type:"MusicAlbum"},{name:"OptionMusicVideos",type:"MusicVideo"},{name:"OptionSongs",type:"Audio"},{name:"OptionHomeVideos",type:"Video"},{name:"OptionBooks",type:"Book"},{name:"OptionPeople",type:"Person"}])}function p(t,a){a.DisabledMetadataSavers=e(".chkMetadataSaver",t).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-pluginname")}),a.LocalMetadataReaderOrder=e(".localReaderOption",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.DisabledMetadataFetchers=e(".chkMetadataFetcher",t).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-pluginname")}),a.MetadataFetcherOrder=e(".chkMetadataFetcher",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.DisabledImageFetchers=e(".chkImageFetcher",t).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-pluginname")}),a.ImageFetcherOrder=e(".chkImageFetcher",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.ImageOptions=e(".imageType:not(.hide)",t).get().map(function(e){return{Type:e.getAttribute("data-imagetype"),Limit:e.checked?1:0,MinWidth:0}}),a.ImageOptions.push({Type:"Backdrop",Limit:e("#txtMaxBackdrops",t).val(),MinWidth:e("#txtMinBackdropDownloadWidth",t).val()}),a.ImageOptions.push({Type:"Screenshot",Limit:e("#txtMaxScreenshots",t).val(),MinWidth:e("#txtMinScreenshotDownloadWidth",t).val()})}function m(){var e=this;return Dashboard.showLoadingMsg(),ApiClient.getServerConfiguration().then(function(t){var a=h,i=t.MetadataOptions.filter(function(e){return e.ItemType==a})[0];i?(p(e,i),ApiClient.updateServerConfiguration(t).then(Dashboard.processServerConfigurationUpdateResult)):ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).then(function(i){i.ItemType=a,t.MetadataOptions.push(i),p(e,i),ApiClient.updateServerConfiguration(t).then(Dashboard.processServerConfigurationUpdateResult)})}),!1}function u(){return[{href:"metadata.html",name:Globalize.translate("TabSettings")},{href:"metadataimages.html",name:Globalize.translate("TabServices")},{href:"metadatanfo.html",name:Globalize.translate("TabNfoSettings")}]}var h;e(document).on("pageinit","#metadataImagesConfigurationPage",function(){var t=this;e(".metadataReaders",t).on("click",".btnLocalReaderMove",function(){var t=e(this).parents(".localReaderOption"),a=t.parents(".paperList");if(e(this).hasClass("btnLocalReaderDown")){var i=t.next();t.remove().insertAfter(i)}else{var n=t.prev();t.remove().insertBefore(n)}e(".localReaderOption",a).each(function(){e(this).prev(".localReaderOption").length?e(".btnLocalReaderMove",this).addClass("btnLocalReaderUp").removeClass("btnLocalReaderDown").attr("icon","keyboard-arrow-up"):e(".btnLocalReaderMove",this).addClass("btnLocalReaderDown").removeClass("btnLocalReaderUp").attr("icon","keyboard-arrow-down")})}),e("#selectItemType",t).on("change",function(){a(t,this.value)}),e(".metadataImagesConfigurationForm").off("submit",m).on("submit",m)}).on("pageshow","#metadataImagesConfigurationPage",function(){LibraryMenu.setTabs("metadata",1,u),Dashboard.showLoadingMsg();var e=this;c(e)})});