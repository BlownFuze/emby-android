define(["events","libraryBrowser","imageLoader","listView","cardBuilder","emby-itemscontainer"],function(e,t,r,a,i){return function(e,n,o){function s(e){var r=d(e),a=g[r];return a||(a=g[r]={query:{SortBy:"SeriesSortName,SortName",SortOrder:"Ascending",IncludeItemTypes:"Episode",Recursive:!0,Fields:"PrimaryImageAspectRatio,MediaSourceCount,UserData",IsMissing:!1,IsVirtualUnaired:!1,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",StartIndex:0,Limit:y},view:t.getSavedView(r)||"Poster"},a.query.ParentId=n.topParentId,t.loadSavedQueryValues(r,a.query)),a}function l(e){return s(e).query}function d(e){return e.savedQueryKey||(e.savedQueryKey=t.getSavedQueryKey("episodes")),e.savedQueryKey}function u(){var e=S.getCurrentViewStyle(),t=o.querySelector(".itemsContainer");"List"==e?(t.classList.add("vertical-list"),t.classList.remove("vertical-wrap")):(t.classList.remove("vertical-list"),t.classList.add("vertical-wrap")),t.innerHTML=""}function c(e){Dashboard.showLoadingMsg();var n=l(e);ApiClient.getItems(Dashboard.getCurrentUserId(),n).then(function(s){function l(){n.StartIndex+=n.Limit,c(o)}function u(){n.StartIndex-=n.Limit,c(o)}window.scrollTo(0,0);var m,y=LibraryBrowser.getQueryPagingHtml({startIndex:n.StartIndex,limit:n.Limit,totalRecordCount:s.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),g=S.getCurrentViewStyle(),v=o.querySelector(".itemsContainer");m="List"==g?a.getListViewHtml({items:s.Items,sortBy:n.SortBy,showParentTitle:!0}):i.getCardsHtml("PosterCard"==g?{items:s.Items,shape:"backdrop",showTitle:!0,showParentTitle:!0,scalable:!0,cardLayout:!0}:{items:s.Items,shape:"backdrop",showTitle:!0,showParentTitle:!0,overlayText:!0,scalable:!0,overlayPlayButton:!0});var f,w,L=o.querySelectorAll(".paging");for(f=0,w=L.length;w>f;f++)L[f].innerHTML=y;for(L=o.querySelectorAll(".btnNextPage"),f=0,w=L.length;w>f;f++)L[f].addEventListener("click",l);for(L=o.querySelectorAll(".btnPreviousPage"),f=0,w=L.length;w>f;f++)L[f].addEventListener("click",u);v.innerHTML=m,r.lazyChildren(v),t.saveQueryValues(d(e),n),Dashboard.hideLoadingMsg()})}function m(e){e.querySelector(".itemsContainer").addEventListener("needsrefresh",function(){c(e)}),e.querySelector(".btnFilter").addEventListener("click",function(){S.showFilterMenu()}),e.querySelector(".btnSort").addEventListener("click",function(r){t.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SeriesSortName,SortName"},{name:Globalize.translate("OptionTvdbRating"),id:"CommunityRating,SeriesSortName,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SeriesSortName,SortName"},{name:Globalize.translate("OptionPremiereDate"),id:"PremiereDate,SeriesSortName,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SeriesSortName,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SeriesSortName,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SeriesSortName,SortName"},{name:Globalize.translate("OptionRuntime"),id:"Runtime,SeriesSortName,SortName"},{name:Globalize.translate("OptionVideoBitrate"),id:"VideoBitRate,SeriesSortName,SortName"}],callback:function(){c(e)},query:l(e),button:r.target})});var r=e.querySelector(".btnSelectView");r.addEventListener("click",function(e){t.showLayoutMenu(e.target,S.getCurrentViewStyle(),"List,Poster,PosterCard".split(","))}),r.addEventListener("layoutchange",function(r){var a=r.detail.viewStyle;s(e).view=a,t.saveViewSetting(d(e),a),u(),c(e)})}var S=this,y=t.getDefaultPageSize(),g={};S.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],function(e){var t=new e({query:l(o),mode:"episodes"});Events.on(t,"filterchange",function(){c(o)}),t.show()})},S.getCurrentViewStyle=function(){return s(o).view},m(o),u(),S.renderTab=function(){c(o)},S.destroy=function(){}}});