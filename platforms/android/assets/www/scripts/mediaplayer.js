!function(e,t,r,n,a,i){function o(){function t(){var e=b.currentMediaRenderer,t=b.getCurrentSrc(e);if(-1!=(t||"").indexOf(".m3u8"))return!0;var r=e.duration();return r&&!isNaN(r)&&r!=Number.POSITIVE_INFINITY&&r!=Number.NEGATIVE_INFINITY}function o(e,t,r){function n(){Events.off(this,"play",n),Events.on(this,"ended",b.onPlaybackStopped),Events.on(this,"ended",b.playNextAfterEnded),b.startProgressInterval(),p()}f(),Events.off(e,"ended",b.onPlaybackStopped),Events.off(e,"ended",b.playNextAfterEnded),Events.on(e,"play",n),"Video"==b.currentItem.MediaType?ApiClient.stopActiveEncodings(t).then(function(){b.setSrcIntoRenderer(e,r,b.currentItem,b.currentMediaSource)}):b.setSrcIntoRenderer(e,r,b.currentItem,b.currentMediaSource)}function s(e){var t,r=e[0];return"Playlist"==r.Type?t=b.getItemsForPlayback({ParentId:r.Id}):"MusicArtist"==r.Type?t=b.getItemsForPlayback({ArtistIds:r.Id,Filters:"IsNotFolder",Recursive:!0,SortBy:"SortName",MediaTypes:"Audio"}):"MusicGenre"==r.Type?t=b.getItemsForPlayback({Genres:r.Name,Filters:"IsNotFolder",Recursive:!0,SortBy:"SortName",MediaTypes:"Audio"}):r.IsFolder&&(t=b.getItemsForPlayback({ParentId:r.Id,Filters:"IsNotFolder",Recursive:!0,SortBy:"SortName",MediaTypes:"Audio,Video"})),new Promise(t?function(e){t.then(function(t){e(t.Items)})}:function(t){t(e)})}function u(e,t){var r=t.map(function(e){return MediaController.supportsDirectPlay(e)});return Promise.all(r).then(function(e){for(var r=0,n=t.length;n>r;r++)t[r].enableDirectPlay=e[r]||!1;var a=t.filter(function(e){return e.enableDirectPlay})[0];return a||(a=t.filter(function(e){return e.SupportsDirectStream})[0]),a=a||t.filter(function(e){return e.SupportsTranscoding})[0]})}function l(e,t,r,n){b.tryStartPlayback(e,t,r,function(e){d(t,e,r,n)})}function d(e,t,r,n){Dashboard.hideLoadingMsg(),b.currentMediaSource=t,b.currentItem=e,"Video"===e.MediaType?requirejs(["videorenderer","scripts/mediaplayer-video"],function(){b.playVideo(e,b.currentMediaSource,r,n)}):"Audio"===e.MediaType&&P(e,b.currentMediaSource,r,n)}function c(e){return e.ErrorCode?(MediaController.showPlaybackInfoErrorMessage(e.ErrorCode),!1):!0}function m(e){Events.off(e,"volumechange",v),Events.off(e,"pause",T),Events.off(e,"playing",S),Events.off(e,"timeupdate",I)}function p(){var e=b.currentMediaRenderer;if(e.enableProgressReporting!==!1){var t=b.getPlayerStateInternal(e,b.currentItem,b.currentMediaSource),r={QueueableMediaTypes:t.NowPlayingItem.MediaType,ItemId:t.NowPlayingItem.Id,NowPlayingItem:t.NowPlayingItem};r=$.extend(r,t.PlayState),ApiClient.reportPlaybackProgress(r)}}function f(){C&&(r(C),C=null)}function y(){var t=e.createElement("video");return!(!t.canPlayType||!t.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"').replace(/no/,""))}function g(){if(k)return k;var t=[],r=e.createElement("video");return r.canPlayType("video/webm").replace(/no/,"")&&t.push("webm"),r.canPlayType('audio/mp4; codecs="ac-3"').replace(/no/,"")&&t.push("ac3"),y()&&t.push("h264"),(e.createElement("audio").canPlayType("audio/aac").replace(/no/,"")||browserInfo.firefox)&&t.push("aac"),e.createElement("audio").canPlayType("audio/mp3").replace(/no/,"")&&t.push("mp3"),e.createElement("audio").canPlayType('audio/ogg; codecs="opus"').replace(/no/,"")&&t.push("opus"),e.createElement("audio").canPlayType("audio/webm").replace(/no/,"")&&t.push("webma"),browserInfo.chrome&&t.push("mkv"),k=t,t}function I(){var e=b.getCurrentTicks(this);b.setCurrentTime(e)}function P(e,t,r,n){requirejs(["audiorenderer"],function(){h(e,t,r),n&&n()})}function h(e,t,r){b.createStreamInfo("Audio",e,t,r).then(function(r){function n(){Events.off(i,"playing",n),Events.on(i,"ended",b.onPlaybackStopped),Events.on(i,"ended",b.playNextAfterEnded),b.onPlaybackStart(i,e,t)}b.startTimeTicksOffset=r.startTimeTicksOffset;var a=b.getSavedVolume(),i=new AudioRenderer({poster:b.getPosterUrl(e)});Events.on(i,"volumechange",v),Events.on(i,"playing",n),Events.on(i,"pause",T),Events.on(i,"playing",S),Events.on(i,"timeupdate",I),b.currentMediaRenderer=i,b.currentDurationTicks=b.currentMediaSource.RunTimeTicks,i.init().then(function(){i.volume(a),b.onBeforePlaybackStart(i,e,t),i.setCurrentSrc(r,e,t),b.streamInfo=r})})}function v(){b.onPlaystateChange(this),b.setCurrentTime(b.getCurrentTicks())}function T(){b.onPlaystateChange(this),b.setCurrentTime(b.getCurrentTicks())}function S(){b.onPlaystateChange(this),b.setCurrentTime(b.getCurrentTicks())}var C,b=this,M=-1;b.currentMediaRenderer=null,b.currentItem=null,b.currentMediaSource=null,b.currentDurationTicks=null,b.startTimeTicksOffset=null,b.playlist=[],b.isLocalPlayer=!0,b.isDefaultPlayer=!0,b.streamInfo={},b.name="Html5 Player",b.getTargets=function(){return new Promise(function(e){e(b.getTargetsInternal())})},b.getTargetsInternal=function(){var e=[{name:Globalize.translate("MyDevice"),id:AppInfo.deviceId,playerName:b.name,playableMediaTypes:["Audio","Video"],isLocalPlayer:!0,supportedCommands:Dashboard.getSupportedRemoteCommands()}];return e},b.getDeviceProfile=function(e){return new Promise(function(t){require(["qualityoptions"],function(r){var n=AppSettings.maxStreamingBitrate();e||(e=r.getVideoQualityOptions(n).filter(function(e){return e.selected})[0].maxHeight);var a=AppInfo.isNativeApp&&browserInfo.android,i=g(),o=-1!=i.indexOf("webm"),s=(-1!=i.indexOf("ac3"),-1!=i.indexOf("aac")),u=-1!=i.indexOf("mp3"),l=-1!=i.indexOf("mkv"),d={};d.MaxStreamingBitrate=n,d.MaxStaticBitrate=8e6,d.MusicStreamingTranscodingBitrate=Math.min(n,192e3),d.DirectPlayProfiles=[];var c=[];l&&u&&c.push("mp3"),s&&c.push("aac"),l||u&&c.push("mp3"),-1!=i.indexOf("h264")&&d.DirectPlayProfiles.push({Container:"mp4,m4v",Type:"Video",VideoCodec:"h264",AudioCodec:c.join(",")}),l&&d.DirectPlayProfiles.push({Container:"mkv,mov",Type:"Video",VideoCodec:"h264",AudioCodec:c.join(",")});var m=AppInfo.directPlayVideoContainers;m&&m.length&&d.DirectPlayProfiles.push({Container:m.join(","),Type:"Video"}),["opus","mp3","aac","webma"].forEach(function(e){-1!=i.indexOf(e)&&d.DirectPlayProfiles.push({Container:"webma"==e?"webma,webm":e,Type:"Audio"})});var p=AppInfo.directPlayAudioContainers;if(p&&p.length&&d.DirectPlayProfiles.push({Container:p.join(","),Type:"Audio"}),o&&d.DirectPlayProfiles.push({Container:"webm",Type:"Video"}),d.TranscodingProfiles=[],!l||a||browserInfo.mobile||d.TranscodingProfiles.push({Container:"mkv",Type:"Video",AudioCodec:c.join(","),VideoCodec:"h264",Context:"Streaming"}),b.canPlayHls()&&(d.TranscodingProfiles.push({Container:"ts",Type:"Video",AudioCodec:c.join(","),VideoCodec:"h264",Context:"Streaming",Protocol:"hls"}),s&&browserInfo.safari&&!AppInfo.isNativeApp&&d.TranscodingProfiles.push({Container:"ts",Type:"Audio",AudioCodec:"aac",Context:"Streaming",Protocol:"hls"})),o&&d.TranscodingProfiles.push({Container:"webm",Type:"Video",AudioCodec:"vorbis",VideoCodec:"vpx",Context:"Streaming",Protocol:"http"}),d.TranscodingProfiles.push({Container:"mp4",Type:"Video",AudioCodec:c.join(","),VideoCodec:"h264",Context:"Streaming",Protocol:"http"}),d.TranscodingProfiles.push({Container:"mp4",Type:"Video",AudioCodec:c.join(","),VideoCodec:"h264",Context:"Static",Protocol:"http"}),["opus","mp3","aac"].forEach(function(e){-1!=i.indexOf(e)&&(d.TranscodingProfiles.push({Container:e,Type:"Audio",AudioCodec:e,Context:"Streaming",Protocol:"http"}),d.TranscodingProfiles.push({Container:e,Type:"Audio",AudioCodec:e,Context:"Static",Protocol:"http"}))}),d.ContainerProfiles=[],d.CodecProfiles=[],d.CodecProfiles.push({Type:"Audio",Conditions:[{Condition:"LessThanEqual",Property:"AudioChannels",Value:"2"}]}),a)d.CodecProfiles.push({Type:"VideoAudio",Codec:"dca",Conditions:[{Condition:"LessThanEqual",Property:"AudioChannels",Value:6}]}),d.CodecProfiles.push({Type:"VideoAudio",Codec:"aac,mp3",Conditions:[{Condition:"LessThanEqual",Property:"AudioChannels",Value:"6"}]});else{var f="6";d.CodecProfiles.push({Type:"VideoAudio",Codec:"aac",Container:"mkv,mov",Conditions:[{Condition:"NotEquals",Property:"AudioProfile",Value:"HE-AAC"},{Condition:"Equals",Property:"IsSecondaryAudio",Value:"false",IsRequired:"false"},{Condition:"LessThanEqual",Property:"AudioChannels",Value:f}]}),d.CodecProfiles.push({Type:"VideoAudio",Conditions:[{Condition:"Equals",Property:"IsSecondaryAudio",Value:"false",IsRequired:"false"},{Condition:"LessThanEqual",Property:"AudioChannels",Value:f}]})}d.CodecProfiles.push(a?{Type:"Video",Codec:"h264",Conditions:[{Condition:"EqualsAny",Property:"VideoProfile",Value:"high|main|baseline|constrained baseline"},{Condition:"LessThanEqual",Property:"VideoLevel",Value:"41"}]}:{Type:"Video",Codec:"h264",Conditions:[{Condition:"NotEquals",Property:"IsAnamorphic",Value:"true",IsRequired:!1},{Condition:"EqualsAny",Property:"VideoProfile",Value:"high|main|baseline|constrained baseline"},{Condition:"LessThanEqual",Property:"VideoLevel",Value:"41"},{Condition:"LessThanEqual",Property:"Height",Value:e}]}),a||d.CodecProfiles.push({Type:"Video",Codec:"vpx",Conditions:[{Condition:"NotEquals",Property:"IsAnamorphic",Value:"true",IsRequired:!1},{Condition:"LessThanEqual",Property:"Height",Value:e}]}),d.SubtitleProfiles=[],b.supportsTextTracks()&&(a?(d.SubtitleProfiles.push({Format:"srt",Method:"External"}),d.SubtitleProfiles.push({Format:"srt",Method:"Embed"}),d.SubtitleProfiles.push({Format:"subrip",Method:"Embed"}),d.SubtitleProfiles.push({Format:"ass",Method:"Embed"}),d.SubtitleProfiles.push({Format:"ssa",Method:"Embed"}),d.SubtitleProfiles.push({Format:"pgs",Method:"Embed"}),d.SubtitleProfiles.push({Format:"pgssub",Method:"Embed"}),d.SubtitleProfiles.push({Format:"dvdsub",Method:"Embed"}),d.SubtitleProfiles.push({Format:"vtt",Method:"Embed"}),d.SubtitleProfiles.push({Format:"sub",Method:"Embed"}),d.SubtitleProfiles.push({Format:"idx",Method:"Embed"}),d.SubtitleProfiles.push({Format:"smi",Method:"Embed"})):d.SubtitleProfiles.push({Format:"vtt",Method:"External"})),d.ResponseProfiles=[],d.ResponseProfiles.push({Type:"Video",Container:"m4v",MimeType:"video/mp4"}),d.ResponseProfiles.push({Type:"Video",Container:"mov",MimeType:"video/webm"}),t(d)})})};var A;b.supportsTextTracks=function(){return null==A&&(A=null!=e.createElement("video").textTracks),A},b.getCurrentSrc=function(e){return e.currentSrc()},b.getCurrentTicks=function(e){var t=Math.floor(1e4*(e||b.currentMediaRenderer).currentTime());return t+=b.startTimeTicksOffset},b.playNextAfterEnded=function(){Events.off(this,"ended",b.playNextAfterEnded),b.nextTrack()},b.startProgressInterval=function(){f();var e=ApiClient.isWebSocketOpen()?1200:5e3;browserInfo.safari&&(e=Math.max(e,5e3)),b.lastProgressReport=0,C=a(function(){b.currentMediaRenderer&&(new Date).getTime()-b.lastProgressReport>e&&(b.lastProgressReport=(new Date).getTime(),p())},250)},b.getCurrentMediaExtension=function(e){return e=e.split("?")[0],e.substring(e.lastIndexOf("."))},b.canPlayNativeHls=function(){if(AppInfo.isNativeApp)return!0;var t=e.createElement("video");return t.canPlayType("application/x-mpegURL").replace(/no/,"")||t.canPlayType("application/vnd.apple.mpegURL").replace(/no/,"")?!0:!1},b.canPlayHls=function(){return b.canPlayNativeHls()?!0:null!=i.MediaSource&&!browserInfo.firefox},b.changeStream=function(e,r){var n=b.currentMediaRenderer;if(t()&&null==r)return void n.currentTime(e/1e4);r=r||{};var a=n.currentSrc(),i=getParameterByName("PlaySessionId",a),s=getParameterByName("LiveStreamId",a);b.getDeviceProfile().then(function(t){var u=null==r.AudioStreamIndex?getParameterByName("AudioStreamIndex",a)||null:r.AudioStreamIndex;"string"==typeof u&&(u=parseInt(u));var l=null==r.SubtitleStreamIndex?getParameterByName("SubtitleStreamIndex",a)||null:r.SubtitleStreamIndex;"string"==typeof l&&(l=parseInt(l)),MediaController.getPlaybackInfo(b.currentItem.Id,t,e,b.currentMediaSource,u,l,s).then(function(t){c(t)&&(b.currentMediaSource=t.MediaSources[0],b.createStreamInfo(b.currentItem.MediaType,b.currentItem,b.currentMediaSource,e).then(function(e){return e.url?(b.currentSubtitleStreamIndex=l,void o(n,i,e)):(MediaController.showPlaybackInfoErrorMessage("NoCompatibleStream"),void b.stop())}))})})},b.setSrcIntoRenderer=function(e,t,r,n){for(var a=n.MediaStreams.filter(function(e){return"Subtitle"==e.Type}),i=a.filter(function(e){return"External"==e.DeliveryMethod}),o=[],s=0,u=i.length;u>s;s++){var l=i[s],d=l.IsExternalUrl?l.DeliveryUrl:ApiClient.getUrl(l.DeliveryUrl);o.push({url:d,language:l.Language||"und",isDefault:l.Index==n.DefaultSubtitleStreamIndex})}b.startTimeTicksOffset=t.startTimeTicksOffset||0,e.setCurrentSrc(t,r,n,o),b.streamInfo=t},b.setCurrentTime=function(e,r,n){e=Math.floor(e);var a=Dashboard.getDisplayTime(e),i=b.currentMediaRenderer;if(b.currentDurationTicks&&(a+=" / "+Dashboard.getDisplayTime(b.currentDurationTicks),r)){var o=e/b.currentDurationTicks;o*=100,r.value=o}r&&(r.disabled=!((b.currentDurationTicks||0)>0||t())),n&&n.html(a);var s=b.getPlayerStateInternal(i,b.currentItem,b.currentMediaSource);Events.trigger(b,"positionchange",[s])},b.canQueueMediaType=function(e){return b.currentItem&&b.currentItem.MediaType==e},b.play=function(e){Dashboard.showLoadingMsg(),Dashboard.getCurrentUser().then(function(t){e.items?s(e.items).then(function(r){b.playWithIntros(r,e,t)}):b.getItemsForPlayback({Ids:e.ids.join(",")}).then(function(r){s(r.Items).then(function(r){b.playWithIntros(r,e,t)})})})},b.playWithIntros=function(e,t,r){var n=e[0];return"Video"===n.MediaType&&Dashboard.showLoadingMsg(),t.startPositionTicks||"Video"!==n.MediaType||!AppSettings.enableCinemaMode()?void b.playInternal(n,t.startPositionTicks,function(){b.setPlaylistState(0,e)}):void ApiClient.getJSON(ApiClient.getUrl("Users/"+r.Id+"/Items/"+n.Id+"/Intros")).then(function(r){e=r.Items.concat(e),b.playInternal(e[0],t.startPositionTicks,function(){b.setPlaylistState(0,e)})})},b.createStreamInfo=function(e,t,r,n){var a,i,o=$.Deferred(),s=0,u=n?n/1e7:0,l=u?"#t="+u:"",d="Transcode";if("Video"==e)if(i="video/"+r.Container,r.enableDirectPlay)a=r.Path,d="DirectPlay";else if(r.SupportsDirectStream){var c={Static:!0,mediaSourceId:r.Id,deviceId:ApiClient.deviceId(),api_key:ApiClient.accessToken()};r.LiveStreamId&&(c.LiveStreamId=r.LiveStreamId),a=ApiClient.getUrl("Videos/"+t.Id+"/stream."+r.Container,c),a+=l,d="DirectStream"}else r.SupportsTranscoding&&(a=ApiClient.getUrl(r.TranscodingUrl),"hls"==r.TranscodingSubProtocol?(a+=l,i="application/x-mpegURL"):(-1==a.indexOf(".mkv")&&(a+="&EnableAutoStreamCopy=false"),s=n||0,i="video/"+r.TranscodingContainer));else if(i="audio/"+r.Container,r.enableDirectPlay)a=r.Path,d="DirectPlay";else{var m=r.SupportsDirectStream;if(m){var p=(r.Container||"").toLowerCase(),c={Static:!0,mediaSourceId:r.Id,deviceId:ApiClient.deviceId(),api_key:ApiClient.accessToken()};r.LiveStreamId&&(c.LiveStreamId=r.LiveStreamId),a=ApiClient.getUrl("Audio/"+t.Id+"/stream."+p,c),a+=l,d="DirectStream"}else r.SupportsTranscoding&&(a=ApiClient.getUrl(r.TranscodingUrl),"hls"==r.TranscodingSubProtocol?(a+=l,i="application/x-mpegURL"):(s=n||0,i="audio/"+r.TranscodingContainer))}var f={url:a,mimeType:i,startTimeTicksOffset:s,startPositionInSeekParam:u,playMethod:d};return"DirectPlay"==d&&"File"==r.Protocol?require(["localassetmanager"],function(){LocalAssetManager.translateFilePath(f.url).then(function(e){f.url=e,o.resolveWith(null,[f])})}):o.resolveWith(null,[f]),o.promise()},b.lastBitrateDetections={},b.playInternal=function(e,t,r){if(null==e)throw new Error("item cannot be null");if(b.isPlaying()&&b.stop(!1),"Audio"!==e.MediaType&&"Video"!==e.MediaType)throw new Error("Unrecognized media type");if(e.IsPlaceHolder)return Dashboard.hideLoadingMsg(),void MediaController.showPlaybackInfoErrorMessage("PlaceHolder");var n=function(){b.getDeviceProfile().then(function(n){l(n,e,t,r)})},a=ApiClient.serverAddress();"Video"==e.MediaType&&AppSettings.enableAutomaticBitrateDetection()&&(new Date).getTime()-(b.lastBitrateDetections[a]||0)>3e5?(Dashboard.showLoadingMsg(),ApiClient.detectBitrate().then(function(e){b.lastBitrateDetections[a]=(new Date).getTime(),AppSettings.maxStreamingBitrate(e),n()},n)):n()},b.tryStartPlayback=function(e,t,r,n){"Video"===t.MediaType&&Dashboard.showLoadingMsg(),MediaController.getPlaybackInfo(t.Id,e,r).then(function(a){c(a)&&u(t.MediaType,a.MediaSources).then(function(i){i?i.RequiresOpening?MediaController.getLiveStream(t.Id,a.PlaySessionId,e,r,i,null,null).then(function(e){MediaController.supportsDirectPlay(e.MediaSource).then(function(t){e.MediaSource.enableDirectPlay=t,n(e.MediaSource)})}):n(i):(Dashboard.hideLoadingMsg(),MediaController.showPlaybackInfoErrorMessage("NoCompatibleStream"))})})},b.getPosterUrl=function(e){var t=Math.max(n.height,n.width);return e.BackdropImageTags&&e.BackdropImageTags.length?ApiClient.getScaledImageUrl(e.Id,{type:"Backdrop",index:0,maxWidth:t,tag:e.BackdropImageTags[0]}):e.ParentBackdropItemId&&e.ParentBackdropImageTags&&e.ParentBackdropImageTags.length?ApiClient.getScaledImageUrl(e.ParentBackdropItemId,{type:"Backdrop",index:0,maxWidth:t,tag:e.ParentBackdropImageTags[0]}):null},b.displayContent=function(e){Dashboard.onBrowseCommand(e)},b.getItemsForPlayback=function(e){var t=Dashboard.getCurrentUserId();return e.Ids&&1==e.Ids.split(",").length?new Promise(function(r){ApiClient.getItem(t,e.Ids.split(",")).then(function(e){r({Items:[e],TotalRecordCount:1})})}):(e.Limit=e.Limit||100,e.Fields=x,e.ExcludeLocationTypes="Virtual",ApiClient.getItems(t,e))},b.removeFromPlaylist=function(e){b.playlist.remove(e)},b.currentPlaylistIndex=function(e){if(null==e)return M;var t=b.playlist[e];b.playInternal(t,0,function(){b.setPlaylistState(e)})},b.setPlaylistState=function(e,t){isNaN(e)||(M=e),t&&(b.playlist=t),b.updatePlaylistUi&&b.updatePlaylistUi()},b.nextTrack=function(){var e;switch(b.getRepeatMode()){case"RepeatOne":e=M;break;case"RepeatAll":e=M+1,e>=b.playlist.length&&(e=0);break;default:e=M+1}var t=b.playlist[e];t&&b.playInternal(t,0,function(){b.setPlaylistState(e)})},b.previousTrack=function(){var e=M-1;if(e>=0){var t=b.playlist[e];t&&b.playInternal(t,0,function(){b.setPlaylistState(e)})}},b.queueItemsNext=function(e){for(var t=1,r=0,n=e.length;n>r;r++)b.playlist.splice(t,0,e[r]),t++},b.queueItems=function(e){for(var t=0,r=e.length;r>t;t++)b.playlist.push(e[t])},b.queue=function(e){return b.playlist.length?void Dashboard.getCurrentUser().then(function(){e.items?s(e.items).then(function(e){b.queueItems(e)}):b.getItemsForPlayback({Ids:e.ids.join(",")}).then(function(e){s(e.Items).then(function(e){b.queueItems(e)})})}):void b.play(e)},b.queueNext=function(e){return b.playlist.length?void Dashboard.getCurrentUser().then(function(){e.items?b.queueItemsNext(e.items):b.getItemsForPlayback({Ids:e.ids.join(",")}).then(function(t){e.items=t.Items,b.queueItemsNext(e.items)})}):void b.play(e)},b.pause=function(){b.currentMediaRenderer.pause()},b.unpause=function(){b.currentMediaRenderer.unpause()},b.seek=function(e){b.changeStream(e)},b.mute=function(){b.setVolume(0)},b.unMute=function(){b.setVolume(100*b.getSavedVolume())},b.volume=function(){return 100*b.currentMediaRenderer.volume()},b.toggleMute=function(){b.currentMediaRenderer&&(b.volume()?b.mute():b.unMute())},b.volumeDown=function(){b.currentMediaRenderer&&b.setVolume(Math.max(b.volume()-2,0))},b.volumeUp=function(){b.currentMediaRenderer&&b.setVolume(Math.min(b.volume()+2,100))},b.setVolume=function(e){b.currentMediaRenderer&&(b.currentMediaRenderer.volume(e/100),b.onVolumeChanged(b.currentMediaRenderer))},b.saveVolume=function(e){e&&appStorage.setItem("volume",e)},b.getSavedVolume=function(){return appStorage.getItem("volume")||.5},b.shuffle=function(e){var t=Dashboard.getCurrentUserId();ApiClient.getItem(t,e).then(function(r){var n={UserId:t,Fields:x,Limit:100,Filters:"IsNotFolder",Recursive:!0,SortBy:"Random"};if("MusicArtist"==r.Type)n.MediaTypes="Audio",n.ArtistIds=r.Id;else if("MusicGenre"==r.Type)n.MediaTypes="Audio",n.Genres=r.Name;else{if(!r.IsFolder)return;n.ParentId=e}b.getItemsForPlayback(n).then(function(e){b.play({items:e.Items})})})},b.instantMix=function(e){var t=100;ApiClient.getInstantMixFromItem(e,{UserId:Dashboard.getCurrentUserId(),Fields:x,Limit:t}).then(function(e){b.play({items:e.Items})})},b.stop=function(e){var t=b.currentMediaRenderer;t?(Events.off(t,"ended",b.playNextAfterEnded),t.stop(),Events.trigger(t,"ended"),m(t),t.cleanup(e),b.currentMediaRenderer=null,b.currentItem=null,b.currentMediaSource=null,b.currentSubtitleStreamIndex=null,b.streamInfo={}):(b.currentMediaRenderer=null,b.currentItem=null,b.currentMediaSource=null,b.currentSubtitleStreamIndex=null,b.streamInfo={}),b.resetEnhancements&&b.resetEnhancements()},b.isPlaying=function(){return b.playlist.length>0},b.getPlayerState=function(){return new Promise(function(e){var t=b.getPlayerStateInternal(b.currentMediaRenderer,b.currentItem,b.currentMediaSource);e(t)})},b.getPlayerStateInternal=function(e,r,n){var a={PlayState:{}};if(e){a.PlayState.VolumeLevel=100*e.volume(),a.PlayState.IsMuted=0==e.volume(),a.PlayState.IsPaused=e.paused(),a.PlayState.PositionTicks=b.getCurrentTicks(e),a.PlayState.RepeatMode=b.getRepeatMode();var i=e.currentSrc();if(i){var o=getParameterByName("AudioStreamIndex",i);o&&(a.PlayState.AudioStreamIndex=parseInt(o)),a.PlayState.SubtitleStreamIndex=b.currentSubtitleStreamIndex,a.PlayState.PlayMethod=b.streamInfo.playMethod,a.PlayState.LiveStreamId=n.LiveStreamId,a.PlayState.PlaySessionId=getParameterByName("PlaySessionId",i)}}return n&&(a.PlayState.MediaSourceId=n.Id,a.NowPlayingItem={RunTimeTicks:n.RunTimeTicks},a.PlayState.CanSeek=(n.RunTimeTicks||0)>0||t()),r&&(a.NowPlayingItem=b.getNowPlayingItemForReporting(r,n)),a},b.getNowPlayingItemForReporting=function(e,t){var r={};r.RunTimeTicks=t.RunTimeTicks,r.Id=e.Id,r.MediaType=e.MediaType,r.Type=e.Type,r.Name=e.Name,r.IndexNumber=e.IndexNumber,r.IndexNumberEnd=e.IndexNumberEnd,r.ParentIndexNumber=e.ParentIndexNumber,r.ProductionYear=e.ProductionYear,r.PremiereDate=e.PremiereDate,r.SeriesName=e.SeriesName,r.Album=e.Album,r.Artists=e.Artists;var n=e.ImageTags||{};return e.SeriesPrimaryImageTag?(r.PrimaryImageItemId=e.SeriesId,r.PrimaryImageTag=e.SeriesPrimaryImageTag):n.Primary?(r.PrimaryImageItemId=e.Id,r.PrimaryImageTag=n.Primary):e.AlbumPrimaryImageTag?(r.PrimaryImageItemId=e.AlbumId,r.PrimaryImageTag=e.AlbumPrimaryImageTag):e.SeriesPrimaryImageTag&&(r.PrimaryImageItemId=e.SeriesId,r.PrimaryImageTag=e.SeriesPrimaryImageTag),e.BackdropImageTags&&e.BackdropImageTags.length?(r.BackdropItemId=e.Id,r.BackdropImageTag=e.BackdropImageTags[0]):e.ParentBackdropImageTags&&e.ParentBackdropImageTags.length&&(r.BackdropItemId=e.ParentBackdropItemId,r.BackdropImageTag=e.ParentBackdropImageTags[0]),n.Thumb&&(r.ThumbItemId=e.Id,r.ThumbImageTag=n.Thumb),n.Logo?(r.LogoItemId=e.Id,r.LogoImageTag=n.Logo):e.ParentLogoImageTag&&(r.LogoItemId=e.ParentLogoItemId,r.LogoImageTag=e.ParentLogoImageTag),r},b.beginPlayerUpdates=function(){},b.endPlayerUpdates=function(){},b.onBeforePlaybackStart=function(e,t,r){var n=b.getPlayerStateInternal(e,t,r);Events.trigger(b,"beforeplaybackstart",[n])},b.onPlaybackStart=function(e,t,r){var n=b.getPlayerStateInternal(e,t,r);Events.trigger(b,"playbackstart",[n]),b.startProgressInterval()},b.onVolumeChanged=function(e){b.saveVolume(e.volume());var t=b.getPlayerStateInternal(e,b.currentItem,b.currentMediaSource);Events.trigger(b,"volumechange",[t])},b.cleanup=function(){},b.onPlaybackStopped=function(){e.body.classList.remove("bodyWithPopupOpen");var t=this;m(t),Events.off(t,"ended",b.onPlaybackStopped);var r=b.currentItem,n=b.currentMediaSource,a=b.getPlayerStateInternal(t,r,n);b.cleanup(t),f(),"Video"==r.MediaType&&b.resetEnhancements(),Events.trigger(b,"playbackstop",[a])},b.onPlaystateChange=function(e){var t=b.getPlayerStateInternal(e,b.currentItem,b.currentMediaSource);Events.trigger(b,"playstatechange",[t])},i.addEventListener("beforeunload",function(){b.currentItem&&b.currentMediaRenderer&&C&&b.onPlaybackStopped.call(b.currentMediaRenderer)});var k;b.canAutoPlayAudio=function(){return AppInfo.isNativeApp?!0:browserInfo.mobile?!1:!0};var E="RepeatNone";b.getRepeatMode=function(){return E},b.setRepeatMode=function(e){E=e};var x="MediaSources,Chapters";b.tryPair=function(){return new Promise(function(e){e()})}}i.MediaPlayer=new o,i.MediaController.registerPlayer(i.MediaPlayer),i.MediaController.setActivePlayer(i.MediaPlayer,i.MediaPlayer.getTargetsInternal()[0])}(document,setTimeout,clearTimeout,screen,setInterval,window);