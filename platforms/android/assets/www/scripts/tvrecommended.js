define(["libraryBrowser","scripts/alphapicker"],function(e){function t(){return"Thumb"}function r(){return"Poster"}function a(e){Dashboard.showLoadingMsg(),o(e),s(e)}function s(r){var a=AppInfo.hasLowImageBandwidth?16:24,s={Limit:a,Fields:"PrimaryImageAspectRatio,SeriesInfo,DateCreated,SyncInfo",UserId:Dashboard.getCurrentUserId(),ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};s.ParentId=LibraryMenu.getTopParentId(),ApiClient.getNextUpEpisodes(s).then(function(a){a.Items.length?r.querySelector(".noNextUpItems").classList.add("hide"):r.querySelector(".noNextUpItems").classList.remove("hide");var s=t(),n="";"ThumbCard"==s?n+=e.getPosterViewHtml({items:a.Items,shape:"backdrop",showTitle:!0,preferThumb:!0,showParentTitle:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0}):"Thumb"==s&&(n+=e.getPosterViewHtml({items:a.Items,shape:"backdrop",showTitle:!0,showParentTitle:!0,overlayText:!1,lazy:!0,preferThumb:!0,showDetailsMenu:!0,centerText:!0,overlayPlayButton:AppInfo.enableAppLayouts}));var i=r.querySelector("#nextUpItems");i.innerHTML=n,ImageLoader.lazyChildren(i),Dashboard.hideLoadingMsg(),e.setLastRefreshed(r)})}function n(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function i(){return n()?"overflowBackdrop":"backdrop"}function o(t){var a=LibraryMenu.getTopParentId(),s=6,n={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Episode",Filters:"IsResumable",Limit:s,Recursive:!0,Fields:"PrimaryImageAspectRatio,SeriesInfo,UserData,SyncInfo",ExcludeLocationTypes:"Virtual",ParentId:a,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getItems(Dashboard.getCurrentUserId(),n).then(function(a){a.Items.length?t.querySelector("#resumableSection").classList.remove("hide"):t.querySelector("#resumableSection").classList.add("hide");var s=r(),n="";"PosterCard"==s?n+=e.getPosterViewHtml({items:a.Items,shape:i(),showTitle:!0,showParentTitle:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0,preferThumb:!0}):"Poster"==s&&(n+=e.getPosterViewHtml({items:a.Items,shape:i(),showTitle:!0,showParentTitle:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0,preferThumb:!0,centerText:!0}));var o=t.querySelector("#resumableItems");o.innerHTML=n,ImageLoader.lazyChildren(o)})}function l(t,r){n()?r.querySelector("#resumableItems").classList.add("hiddenScrollX"):r.querySelector("#resumableItems").classList.remove("hiddenScrollX"),e.createCardMenus(r.querySelector("#resumableItems"))}function d(t,r){e.needsRefresh(r)&&a(r)}function u(e,t){var r=e.querySelector(".pageTabContent[data-index='"+t+"']"),a=[],s="TvPage",n="",i="";switch(t){case 0:i="initSuggestedTab",n="renderSuggestedTab";break;case 1:a.push("scripts/tvlatest"),n="renderLatestTab";break;case 2:a.push("scripts/tvupcoming"),n="renderUpcomingTab";break;case 3:a.push("scripts/tvshows"),n="renderSeriesTab",i="initSeriesTab";break;case 4:a.push("scripts/episodes"),n="renderEpisodesTab",i="initEpisodesTab";break;case 5:a.push("scripts/tvgenres"),n="renderGenresTab";break;case 6:a.push("scripts/tvstudios"),n="renderStudiosTab"}require(a,function(){i&&!r.initComplete&&(window[s][i](e,r),r.initComplete=!0),window[s][n](e,r)})}function c(e,t){if(t.NowPlayingItem&&"Video"==t.NowPlayingItem.MediaType){var r=$.mobile.activePage,a=r.querySelector("neon-animated-pages");a.dispatchEvent(new CustomEvent("tabchange",{}))}}return window.TvPage=window.TvPage||{},window.TvPage.renderSuggestedTab=d,window.TvPage.initSuggestedTab=l,function(t){var r=t.querySelector("paper-tabs"),a=t.querySelector("neon-animated-pages"),s="tv.html",i=LibraryMenu.getTopParentId();i&&(s+="?topParentId="+i),n()?t.querySelector("#resumableItems").classList.add("hiddenScrollX"):t.querySelector("#resumableItems").classList.remove("hiddenScrollX"),e.createCardMenus(t.querySelector("#resumableItems")),e.configurePaperLibraryTabs(t,r,a,s),a.addEventListener("tabchange",function(){u(t,parseInt(this.selected))}),t.addEventListener("viewbeforeshow",function(){var e=this;if(!e.getAttribute("data-title")){var t=LibraryMenu.getTopParentId();t?ApiClient.getItem(Dashboard.getCurrentUserId(),t).then(function(t){e.setAttribute("data-title",t.Name),LibraryMenu.setTitle(t.Name)}):(e.setAttribute("data-title",Globalize.translate("TabShows")),LibraryMenu.setTitle(Globalize.translate("TabShows")))}Events.on(MediaController,"playbackstop",c)}),t.addEventListener("viewbeforehide",function(){Events.off(MediaController,"playbackstop",c)})}});