define(["libraryBrowser","scripts/alphapicker","scrollStyles"],function(e){return function(t,r){function a(){return"Thumb"}function s(){return"Poster"}function n(){Dashboard.showLoadingMsg(),c(),i()}function i(){var r={Limit:24,Fields:"PrimaryImageAspectRatio,SeriesInfo,DateCreated,SyncInfo",UserId:Dashboard.getCurrentUserId(),ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};r.ParentId=LibraryMenu.getTopParentId(),ApiClient.getNextUpEpisodes(r).then(function(r){r.Items.length?t.querySelector(".noNextUpItems").classList.add("hide"):t.querySelector(".noNextUpItems").classList.remove("hide");var s=a(),n="";"ThumbCard"==s?n+=e.getPosterViewHtml({items:r.Items,shape:"backdrop",showTitle:!0,preferThumb:!0,showParentTitle:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0}):"Thumb"==s&&(n+=e.getPosterViewHtml({items:r.Items,shape:"backdrop",showTitle:!0,showParentTitle:!0,overlayText:!1,lazy:!0,preferThumb:!0,showDetailsMenu:!0,centerText:!0,overlayPlayButton:AppInfo.enableAppLayouts}));var i=t.querySelector("#nextUpItems");i.innerHTML=n,ImageLoader.lazyChildren(i),Dashboard.hideLoadingMsg()})}function o(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function l(){return o()?"overflowBackdrop":"backdrop"}function c(){var r=LibraryMenu.getTopParentId(),a=6,n={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Episode",Filters:"IsResumable",Limit:a,Recursive:!0,Fields:"PrimaryImageAspectRatio,SeriesInfo,UserData,SyncInfo",ExcludeLocationTypes:"Virtual",ParentId:r,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(Dashboard.getCurrentUserId(),n).then(function(r){r.Items.length?t.querySelector("#resumableSection").classList.remove("hide"):t.querySelector("#resumableSection").classList.add("hide");var a=s(),n="";"PosterCard"==a?n+=e.getPosterViewHtml({items:r.Items,shape:l(),showTitle:!0,showParentTitle:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0,preferThumb:!0}):"Poster"==a&&(n+=e.getPosterViewHtml({items:r.Items,shape:l(),showTitle:!0,showParentTitle:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0,preferThumb:!0,centerText:!0}));var i=t.querySelector("#resumableItems");i.innerHTML=n,ImageLoader.lazyChildren(i)})}function d(e,a){var s=e.querySelector(".pageTabContent[data-index='"+a+"']"),n=[];switch(a){case 0:break;case 1:n.push("scripts/tvlatest");break;case 2:n.push("scripts/tvupcoming");break;case 3:n.push("scripts/tvshows");break;case 4:n.push("scripts/episodes");break;case 5:n.push("scripts/tvgenres");break;case 6:n.push("scripts/tvstudios")}require(n,function(e){0==a&&(m.tabContent=s);var n=b[a];n||(n=a?new e(t,r,s):m,b[a]=n,n.initTab&&n.initTab()),-1==p.indexOf(a)&&(p.push(a),n.renderTab())})}function u(t,r){r.NowPlayingItem&&"Video"==r.NowPlayingItem.MediaType&&(p=[],h.dispatchEvent(new CustomEvent("tabchange",{detail:{selectedTabIndex:e.selectedTab(h)}})))}var m=this;m.initTab=function(){var t=m.tabContent;o()?t.querySelector("#resumableItems").classList.add("hiddenScrollX"):t.querySelector("#resumableItems").classList.remove("hiddenScrollX"),e.createCardMenus(t.querySelector("#resumableItems"))},m.renderTab=function(){n()};var b=[],p=[],h=t.querySelector(".libraryViewNav"),y="tv.html",I=r.topParentId;I&&(y+="?topParentId="+I),o()?t.querySelector("#resumableItems").classList.add("hiddenScrollX"):t.querySelector("#resumableItems").classList.remove("hiddenScrollX"),e.createCardMenus(t.querySelector("#resumableItems")),e.configurePaperLibraryTabs(t,h,t.querySelectorAll(".pageTabContent"),[0,1,2,4,5,6]),h.addEventListener("tabchange",function(e){d(t,parseInt(e.detail.selectedTabIndex))}),t.addEventListener("viewbeforeshow",function(){if(!t.getAttribute("data-title")){var e=r.topParentId;e?ApiClient.getItem(Dashboard.getCurrentUserId(),e).then(function(e){t.setAttribute("data-title",e.Name),LibraryMenu.setTitle(e.Name)}):(t.setAttribute("data-title",Globalize.translate("TabShows")),LibraryMenu.setTitle(Globalize.translate("TabShows")))}Events.on(MediaController,"playbackstop",u)}),t.addEventListener("viewbeforehide",function(){Events.off(MediaController,"playbackstop",u)}),t.addEventListener("viewdestroy",function(){b.forEach(function(e){e.destroy&&e.destroy()})})}});