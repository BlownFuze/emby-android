define(["datetime","dom","emby-itemscontainer"],function(){function e(){return LiveTvHelpers.getDaysOfWeek().map(function(e){return e.value})}function n(n,r){for(var t=e(),i=0,c=t.length;c>i;i++){var o=t[i];n.querySelector("#chk"+o).checked=-1!=r.indexOf(o)}}function r(n){for(var r=e(),t=[],i=0,c=r.length;c>i;i++){var o=r[i];n.querySelector("#chk"+o).checked&&t.push(o)}return t}return function(e,t){function i(e,r){e.querySelector(".itemName").innerHTML=r.Name,e.querySelector("#txtPrePaddingMinutes").value=r.PrePaddingSeconds/60,e.querySelector("#txtPostPaddingMinutes").value=r.PostPaddingSeconds/60,e.querySelector("#chkNewOnly").checked=r.RecordNewOnly,e.querySelector("#chkAllChannels").checked=r.RecordAnyChannel,e.querySelector("#chkAnyTime").checked=r.RecordAnyTime,n(e,r.Days),Dashboard.hideLoadingMsg()}function c(e){var n=this,i=t.id;return ApiClient.getLiveTvSeriesTimer(i).then(function(e){e.PrePaddingSeconds=60*n.querySelector("#txtPrePaddingMinutes").value,e.PostPaddingSeconds=60*n.querySelector("#txtPostPaddingMinutes").value,e.RecordNewOnly=n.querySelector("#chkNewOnly").checked,e.RecordAnyChannel=n.querySelector("#chkAllChannels").checked,e.RecordAnyTime=n.querySelector("#chkAnyTime").checked,e.Days=r(n),ApiClient.updateLiveTvSeriesTimer(e)}),e.preventDefault(),!1}function o(e,n){var r=n.Items;LiveTvHelpers.getTimersHtml(r).then(function(n){var r=e.querySelector(".scheduleTab");r.innerHTML=n,ImageLoader.lazyChildren(r)})}function d(){var n=t.id;Dashboard.showLoadingMsg(),ApiClient.getLiveTvSeriesTimer(n).then(function(n){i(e,n)}),ApiClient.getLiveTvTimers({seriesTimerId:n}).then(function(n){o(e,n)})}e.querySelector("form").addEventListener("change",function(){e.querySelector(".btnSubmit").click()}),e.querySelector(".liveTvSeriesTimerForm").addEventListener("submit",c),e.querySelector(".scheduleTab").addEventListener("timercancelled",d),e.addEventListener("viewbeforeshow",d)}});