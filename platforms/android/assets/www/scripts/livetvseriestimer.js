define(["datetime","jQuery"],function(e,n){function i(e,n){require(["confirm"],function(i){i(Globalize.translate("MessageConfirmRecordingCancellation"),Globalize.translate("HeaderConfirmRecordingCancellation")).then(function(){Dashboard.showLoadingMsg(),ApiClient.cancelLiveTvTimer(n).then(function(){Dashboard.hideLoadingMsg(),require(["toast"],function(e){e(Globalize.translate("MessageRecordingCancelled"))}),l(e)})})})}function a(i,a){s=a,n(".itemName",i).html(a.Name),n("#txtPrePaddingMinutes",i).val(a.PrePaddingSeconds/60),n("#txtPostPaddingMinutes",i).val(a.PostPaddingSeconds/60),n("#chkNewOnly",i).checked(a.RecordNewOnly),n("#chkAllChannels",i).checked(a.RecordAnyChannel),n("#chkAnyTime",i).checked(a.RecordAnyTime);var t="";a.RecordAnyChannel?t+=Globalize.translate("LabelAllChannels"):a.ChannelId&&(t+='<a href="itemdetails.html?id='+a.ChannelId+'">'+a.ChannelName+"</a>"),n(".channel",i).html(t).trigger("create"),r(i,a.Days),a.RecordAnyTime?n(".time",i).html(Globalize.translate("LabelAnytime")).trigger("create"):a.ChannelId&&n(".time",i).html(e.getDisplayTime(a.StartDate)).trigger("create"),Dashboard.hideLoadingMsg()}function t(){return LiveTvHelpers.getDaysOfWeek().map(function(e){return e.value})}function r(e,i){for(var a=t(),r=0,o=a.length;o>r;r++){var c=a[r];n("#chk"+c,e).checked(-1!=i.indexOf(c))}}function o(e){for(var i=t(),a=[],r=0,o=i.length;o>r;r++){var c=i[r];n("#chk"+c,e).checked()&&a.push(c)}return a}function c(){Dashboard.showLoadingMsg();var e=this;return ApiClient.getLiveTvSeriesTimer(s.Id).then(function(i){i.PrePaddingSeconds=60*n("#txtPrePaddingMinutes",e).val(),i.PostPaddingSeconds=60*n("#txtPostPaddingMinutes",e).val(),i.RecordNewOnly=n("#chkNewOnly",e).checked(),i.RecordAnyChannel=n("#chkAllChannels",e).checked(),i.RecordAnyTime=n("#chkAnyTime",e).checked(),i.Days=o(e),ApiClient.updateLiveTvSeriesTimer(i).then(function(){Dashboard.hideLoadingMsg(),require(["toast"],function(e){e(Globalize.translate("MessageRecordingSaved"))})})}),!1}function d(e,a){var t=a.Items;LiveTvHelpers.getTimersHtml(t).then(function(a){var t=n(".scheduleTab",e).html(a)[0];ImageLoader.lazyChildren(t),n(".btnDeleteTimer",t).on("click",function(){var n=this.getAttribute("data-timerid");i(e,n)})})}function l(e){Dashboard.showLoadingMsg();var n=getParameterByName("id");ApiClient.getLiveTvSeriesTimer(n).then(function(n){a(e,n)}),ApiClient.getLiveTvTimers({seriesTimerId:n}).then(function(n){d(e,n)})}var s;n(document).on("pageinit","#liveTvSeriesTimerPage",function(){var e=this;n(".radioSeriesTimerTab",e).on("change",function(){n(".tab",e).hide(),n("."+this.value+"Tab",e).show()}),n(".liveTvSeriesTimerForm").off("submit",c).on("submit",c)}).on("pagebeforeshow","#liveTvSeriesTimerPage",function(){var e=this;n(".radioProfileTab",e).checked(!1).checkboxradio("refresh"),n("#radioSettings",e).checked(!0).checkboxradio("refresh").trigger("change"),l(e)}).on("pagebeforehide","#liveTvSeriesTimerPage",function(){s=null})});