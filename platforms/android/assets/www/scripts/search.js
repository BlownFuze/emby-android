define(["libraryBrowser"],function(e){function n(){b&&(clearTimeout(b),b=null)}function t(e){return"Audio"==e.Type?[[e.AlbumArtist,e.Album].join(" - ")]:"MusicAlbum"==e.Type?[e.AlbumArtist]:"MusicArtist"==e.Type?[Globalize.translate("LabelArtist")]:"Movie"==e.Type?[Globalize.translate("LabelMovie")]:"MusicVideo"==e.Type?[Globalize.translate("LabelMusicVideo")]:"Episode"==e.Type?[Globalize.translate("LabelEpisode")]:"Series"==e.Type?[Globalize.translate("LabelSeries")]:"BoxSet"==e.Type?[Globalize.translate("LabelCollection")]:e.ChannelName?[e.ChannelName]:[e.Type]}function a(){var e=this;e.showSearchPanel=function(){m()}}function i(n,a){a=a.map(function(e){return e.Id=e.ItemId,e.ImageTags={},e.UserData={},e.PrimaryImageTag&&(e.ImageTags.Primary=e.PrimaryImageTag),e});var i=e.getPosterViewHtml({items:a,shape:"auto",lazy:!0,overlayText:!1,showTitle:!0,centerImage:!0,centerText:!0,textLines:t,overlayPlayButton:!0}),o=n.querySelector(".itemsContainer");o.innerHTML=i,ImageLoader.lazyChildren(o)}function o(e,n){var t=b;Dashboard.showLoadingMsg(),ApiClient.getSearchHints({userId:Dashboard.getCurrentUserId(),searchTerm:n,limit:30}).then(function(n){t==b&&i(e,n.SearchHints),Dashboard.hideLoadingMsg()},function(){Dashboard.hideLoadingMsg()})}function r(e,t){if(!t){var a=e.querySelector(".itemsContainer");return a&&(a.innerHTML=""),void n()}n(),b=setTimeout(function(){o(e,t)},300)}function s(n){var t=document.querySelector(".searchResultsOverlay");if(n&&!t){var a=document.createElement("div");a.className="searchResultsOverlay ui-body-b smoothScrollY background-theme-b",a.innerHTML='<div class="searchResultsContainer"><div class="itemsContainer"></div></div></div>',document.body.appendChild(a),e.createCardMenus(a)}return t}function u(e){var n;e?(n=s(!0),y||c(n,1),y=!0,document.body.classList.add("bodyWithPopupOpen"),r(n,e)):(n=s(!1),n&&(r(n,""),y&&(l(n,1),y=!1),document.body.classList.remove("bodyWithPopupOpen")))}function c(e,n){var t=[{opacity:"0",offset:0},{opacity:"1",offset:1}],a={duration:200,iterations:n,fill:"both"};e.animate(t,a)}function l(e,n){var t=[{opacity:"1",offset:0},{opacity:"0",offset:1}],a={duration:600,iterations:n,fill:"both"};e.animate(t,a).onfinish=function(){e.parentNode.removeChild(e)}}function d(){require(["searchmenu"],function(){Events.on(window.SearchMenu,"closed",h),Events.on(window.SearchMenu,"change",function(e,n){u(n)})})}function h(){u(""),f()}function m(){require(["searchmenu"],function(){window.SearchMenu.show()})}function f(){require(["searchmenu"],function(){window.SearchMenu.hide()})}var b;window.Search=new a;var y;document.addEventListener("pagebeforehide",h),document.addEventListener("headercreated",function(){d()})});