!function(){function e(e,n,a){Dashboard.showModalLoadingMsg(),ConnectionManager.loginToConnect(n,a).then(function(){Dashboard.hideModalLoadingMsg(),Dashboard.navigate("selectserver.html")},function(){Dashboard.hideModalLoadingMsg(),Dashboard.alert({message:Globalize.translate("MessageInvalidUser"),title:Globalize.translate("HeaderLoginFailure")}),$("#txtManualPassword",e).val("")})}function n(e,n){switch(Dashboard.hideModalLoadingMsg(),n.State){case MediaBrowser.ConnectionState.SignedIn:var a=n.ApiClient;Dashboard.onServerChanged(a.getCurrentUserId(),a.accessToken(),a),Dashboard.navigate("index.html");break;case MediaBrowser.ConnectionState.ServerSignIn:Dashboard.navigate("login.html?serverid="+n.Servers[0].Id,!1,"none");break;case MediaBrowser.ConnectionState.ServerSelection:Dashboard.navigate("selectserver.html",!1,"none");break;case MediaBrowser.ConnectionState.ConnectSignIn:t(e,"welcome");break;case MediaBrowser.ConnectionState.ServerUpdateNeeded:Dashboard.alert({message:Globalize.translate("ServerUpdateNeeded",'<a href="https://emby.media">https://emby.media</a>')});break;case MediaBrowser.ConnectionState.Unavailable:Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")})}}function a(e){Dashboard.showModalLoadingMsg(),ConnectionManager.connect().then(function(a){n(e,a)})}function o(e){var n=getParameterByName("mode")||"auto";if("auto"==n){if(AppInfo.isNativeApp)return void a(e);n="connect"}t(e,n)}function t(e,n){"welcome"==n?($(".connectLoginForm",e).hide(),$(".welcomeContainer",e).show(),$(".manualServerForm",e).hide(),$(".signupForm",e).hide()):"connect"==n?($(".connectLoginForm",e).show(),$(".welcomeContainer",e).hide(),$(".manualServerForm",e).hide(),$(".signupForm",e).hide()):"manualserver"==n?($(".manualServerForm",e).show(),$(".connectLoginForm",e).hide(),$(".welcomeContainer",e).hide(),$(".signupForm",e).hide()):"signup"==n&&($(".manualServerForm",e).hide(),$(".connectLoginForm",e).hide(),$(".welcomeContainer",e).hide(),$(".signupForm",e).show(),g(e))}function r(){Dashboard.navigate("selectserver.html")}function i(){var e=$(this).parents(".page");return h(e),!1}function s(){var e=$(this).parents(".page");return m(e),!1}function l(){if(!d())return!1;var e=$(this).parents(".page");return ConnectionManager.signupForConnect($("#txtSignupEmail",e).val(),$("#txtSignupUsername",e).val(),$("#txtSignupPassword",e).val(),$("#txtSignupPasswordConfirm",e).val()).then(function(){Dashboard.alert({message:Globalize.translate("MessageThankYouForConnectSignUp"),callback:function(){Dashboard.navigate("connectlogin.html?mode=welcome")}})},function(e){Dashboard.alert("passwordmatch"==e.errorCode?{message:Globalize.translate("ErrorMessagePasswordNotMatchConfirm")}:"USERNAME_IN_USE"==e.errorCode?{message:Globalize.translate("ErrorMessageUsernameInUse")}:"EMAIL_IN_USE"==e.errorCode?{message:Globalize.translate("ErrorMessageEmailInUse")}:{message:Globalize.translate("DefaultErrorMessage")})}),!1}function c(){return!AppInfo.isNativeApp&&0==window.location.href.toLowerCase().indexOf("https")}function d(){return AppInfo.isNativeApp}function g(){d()&&c()&&require(["https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit"],function(){})}function m(e){var a=$("#txtServerHost",e).val(),o=$("#txtServerPort",e).val();o&&(a+=":"+o),Dashboard.showModalLoadingMsg(),ConnectionManager.connectToAddress(a).then(function(a){n(e,a)},function(){n(e,{State:MediaBrowser.ConnectionState.Unavailable})})}function h(n){var a=$("#txtManualName",n).val(),o=$("#txtManualPassword",n).val();e(n,a,o)}$(document).on("pageinit","#connectLoginPage",function(){var e=this;$(".btnSkipConnect",e).on("click",function(){r()}),$(".connectLoginForm").off("submit",i).on("submit",i),$(".manualServerForm").off("submit",s).on("submit",s),$(".signupForm").off("submit",l).on("submit",l),$(".btnSignupForConnect",e).on("click",function(){return d()?(Dashboard.navigate("connectlogin.html?mode=signup"),!1):void 0}),$(".btnCancelSignup",e).on("click",function(){history.back()}),$(".btnCancelManualServer",e).on("click",function(){history.back()}),$(".btnWelcomeNext",e).on("click",function(){Dashboard.navigate("connectlogin.html?mode=connect")});var n=e.querySelector(".terms");n.innerHTML=Globalize.translate("LoginDisclaimer")+"<div style='margin-top:5px;'><a href='http://emby.media/terms' target='_blank'>"+Globalize.translate("TermsOfUse")+"</a></div>",AppInfo.isNativeApp?n.classList.add("hide"):n.classList.remove("hide")}).on("pagebeforeshow","#connectLoginPage",function(){var e=this;$("#txtSignupEmail",e).val(""),$("#txtSignupUsername",e).val(""),$("#txtSignupPassword",e).val(""),$("#txtSignupPasswordConfirm",e).val("");var n='<a href="http://emby.media" target="_blank">http://emby.media</a>';$(".embyIntroDownloadMessage",e).html(Globalize.translate("EmbyIntroDownloadMessage",n))}).on("pageshow","#connectLoginPage",function(){var e=this;o(e)})}();