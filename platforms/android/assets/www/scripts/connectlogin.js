define([],function(){function e(e,t,a){Dashboard.showLoadingMsg(),ConnectionManager.loginToConnect(t,a).then(function(){Dashboard.hideLoadingMsg(),Dashboard.navigate("selectserver.html")},function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("MessageInvalidUser"),title:Globalize.translate("HeaderLoginFailure")}),e.querySelector("#txtManualPassword").value=""})}function t(e,t){switch(Dashboard.hideLoadingMsg(),t.State){case MediaBrowser.ConnectionState.SignedIn:var a=t.ApiClient;Dashboard.onServerChanged(a.getCurrentUserId(),a.accessToken(),a),Dashboard.navigate("home.html");break;case MediaBrowser.ConnectionState.ServerSignIn:Dashboard.navigate("login.html?serverid="+t.Servers[0].Id,!1,"none");break;case MediaBrowser.ConnectionState.ServerSelection:Dashboard.navigate("selectserver.html",!1,"none");break;case MediaBrowser.ConnectionState.ConnectSignIn:n(e,"welcome");break;case MediaBrowser.ConnectionState.ServerUpdateNeeded:Dashboard.alert({message:Globalize.translate("ServerUpdateNeeded",'<a href="https://emby.media">https://emby.media</a>')});break;case MediaBrowser.ConnectionState.Unavailable:Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")})}}function a(e){Dashboard.showLoadingMsg(),ConnectionManager.connect().then(function(a){t(e,a)})}function r(e){var t=getParameterByName("mode")||"auto";if("auto"==t){if(AppInfo.isNativeApp)return void a(e);t="connect"}n(e,t)}function n(e,t){"welcome"==t?(e.querySelector(".connectLoginForm").classList.add("hide"),e.querySelector(".welcomeContainer").classList.remove("hide"),e.querySelector(".manualServerForm").classList.add("hide"),e.querySelector(".signupForm").classList.add("hide")):"connect"==t?(e.querySelector(".connectLoginForm").classList.remove("hide"),e.querySelector(".welcomeContainer").classList.add("hide"),e.querySelector(".manualServerForm").classList.add("hide"),e.querySelector(".signupForm").classList.add("hide")):"manualserver"==t?(e.querySelector(".manualServerForm").classList.remove("hide"),e.querySelector(".connectLoginForm").classList.add("hide"),e.querySelector(".welcomeContainer").classList.add("hide"),e.querySelector(".signupForm").classList.add("hide")):"signup"==t&&(e.querySelector(".manualServerForm").classList.add("hide"),e.querySelector(".connectLoginForm").classList.add("hide"),e.querySelector(".welcomeContainer").classList.add("hide"),e.querySelector(".signupForm").classList.remove("hide"),l(e))}function o(){Dashboard.navigate("selectserver.html")}function i(){return!AppInfo.isNativeApp&&0==window.location.href.toLowerCase().indexOf("https")}function s(){return AppInfo.isNativeApp||0==window.location.href.toLowerCase().indexOf("https")}function l(e){s()&&i()&&require(["https://www.google.com/recaptcha/api.js?render=explicit"],function(){setTimeout(function(){var t=e.querySelector(".recaptchaContainer");u=grecaptcha.render(t,{sitekey:"6Le2LAgTAAAAAK06Wvttt_yUnbISTy6q3Azqp9po",theme:"dark"})},100)})}function c(e){var a=e.querySelector("#txtServerHost").value,r=e.querySelector("#txtServerPort").value;r&&(a+=":"+r),Dashboard.showLoadingMsg(),ConnectionManager.connectToAddress(a).then(function(a){t(e,a)},function(){t(e,{State:MediaBrowser.ConnectionState.Unavailable})})}function d(t){var a=t.querySelector("#txtManualName").value,r=t.querySelector("#txtManualPassword").value;e(t,a,r)}var u;return function(e){function t(t){return d(e),t.preventDefault(),!1}function a(t){return c(e),t.preventDefault(),!1}function n(t){if(!s())return t.preventDefault(),!1;var a=e,r=u?grecaptcha.getResponse(u):null;return ConnectionManager.signupForConnect({email:a.querySelector("#txtSignupEmail",a).value,username:a.querySelector("#txtSignupUsername",a).value,password:a.querySelector("#txtSignupPassword",a).value,passwordConfirm:a.querySelector("#txtSignupPasswordConfirm",a).value,grecaptcha:r}).then(function(){Dashboard.alert({message:Globalize.translate("MessageThankYouForConnectSignUp"),callback:function(){Dashboard.navigate("connectlogin.html?mode=welcome")}})},function(e){Dashboard.alert("passwordmatch"==e.errorCode?{message:Globalize.translate("ErrorMessagePasswordNotMatchConfirm")}:"USERNAME_IN_USE"==e.errorCode?{message:Globalize.translate("ErrorMessageUsernameInUse")}:"EMAIL_IN_USE"==e.errorCode?{message:Globalize.translate("ErrorMessageEmailInUse")}:{message:Globalize.translate("DefaultErrorMessage")})}),t.preventDefault(),!1}e.querySelector(".btnSkipConnect").addEventListener("click",o),e.querySelector(".connectLoginForm").addEventListener("submit",t),e.querySelector(".manualServerForm").addEventListener("submit",a),e.querySelector(".signupForm").addEventListener("submit",n),e.querySelector(".btnSignupForConnect").addEventListener("click",function(e){return s()?(e.preventDefault(),e.stopPropagation(),Dashboard.navigate("connectlogin.html?mode=signup"),!1):void 0}),e.querySelector(".btnCancelSignup").addEventListener("click",function(){history.back()}),e.querySelector(".btnCancelManualServer").addEventListener("click",function(){history.back()}),e.querySelector(".btnWelcomeNext").addEventListener("click",function(){Dashboard.navigate("connectlogin.html?mode=connect")});var i=e.querySelector(".terms");i.innerHTML=Globalize.translate("LoginDisclaimer")+"<div style='margin-top:5px;'><a href='http://emby.media/terms' target='_blank'>"+Globalize.translate("TermsOfUse")+"</a></div>",AppInfo.isNativeApp?(i.classList.add("hide"),e.querySelector(".tvAppInfo").classList.add("hide")):(i.classList.remove("hide"),e.querySelector(".tvAppInfo").classList.remove("hide")),e.addEventListener("viewbeforeshow",function(){var e=this;if(e.querySelector("#txtSignupEmail").value="",e.querySelector("#txtSignupUsername").value="",e.querySelector("#txtSignupPassword").value="",e.querySelector("#txtSignupPasswordConfirm").value="",browserInfo.safari&&AppInfo.isNativeApp)e.querySelector(".embyIntroDownloadMessage").innerHTML=Globalize.translate("EmbyIntroDownloadMessageWithoutLink");else{var t='<a href="http://emby.media" target="_blank">http://emby.media</a>';e.querySelector(".embyIntroDownloadMessage").innerHTML=Globalize.translate("EmbyIntroDownloadMessage",t)}}),e.addEventListener("viewshow",function(){r(e)})}});