define([],function(){function e(e,a,t){Dashboard.showModalLoadingMsg(),ConnectionManager.loginToConnect(a,t).then(function(){Dashboard.hideModalLoadingMsg(),Dashboard.navigate("selectserver.html")},function(){Dashboard.hideModalLoadingMsg(),Dashboard.alert({message:Globalize.translate("MessageInvalidUser"),title:Globalize.translate("HeaderLoginFailure")}),e.querySelector("#txtManualPassword").value=""})}function a(e,a){switch(Dashboard.hideModalLoadingMsg(),a.State){case MediaBrowser.ConnectionState.SignedIn:var t=a.ApiClient;Dashboard.onServerChanged(t.getCurrentUserId(),t.accessToken(),t),Dashboard.navigate("home.html");break;case MediaBrowser.ConnectionState.ServerSignIn:Dashboard.navigate("login.html?serverid="+a.Servers[0].Id,!1,"none");break;case MediaBrowser.ConnectionState.ServerSelection:Dashboard.navigate("selectserver.html",!1,"none");break;case MediaBrowser.ConnectionState.ConnectSignIn:n(e,"welcome");break;case MediaBrowser.ConnectionState.ServerUpdateNeeded:Dashboard.alert({message:Globalize.translate("ServerUpdateNeeded",'<a href="https://emby.media">https://emby.media</a>')});break;case MediaBrowser.ConnectionState.Unavailable:Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")})}}function t(e){Dashboard.showModalLoadingMsg(),ConnectionManager.connect().then(function(t){a(e,t)})}function r(e){var a=getParameterByName("mode")||"auto";if("auto"==a){if(AppInfo.isNativeApp)return void t(e);a="connect"}n(e,a)}function n(e,a){"welcome"==a?(e.querySelector(".connectLoginForm").classList.add("hide"),e.querySelector(".welcomeContainer").classList.remove("hide"),e.querySelector(".manualServerForm").classList.add("hide"),e.querySelector(".signupForm").classList.add("hide")):"connect"==a?(e.querySelector(".connectLoginForm").classList.remove("hide"),e.querySelector(".welcomeContainer").classList.add("hide"),e.querySelector(".manualServerForm").classList.add("hide"),e.querySelector(".signupForm").classList.add("hide")):"manualserver"==a?(e.querySelector(".manualServerForm").classList.remove("hide"),e.querySelector(".connectLoginForm").classList.add("hide"),e.querySelector(".welcomeContainer").classList.add("hide"),e.querySelector(".signupForm").classList.add("hide")):"signup"==a&&(e.querySelector(".manualServerForm").classList.add("hide"),e.querySelector(".connectLoginForm").classList.add("hide"),e.querySelector(".welcomeContainer").classList.add("hide"),e.querySelector(".signupForm").classList.remove("hide"),l(e))}function o(){Dashboard.navigate("selectserver.html")}function i(){return!AppInfo.isNativeApp&&0==window.location.href.toLowerCase().indexOf("https")}function s(){return AppInfo.isNativeApp}function l(){s()&&i()&&require(["https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit"],function(){})}function c(e){var t=e.querySelector("#txtServerHost").value,r=e.querySelector("#txtServerPort").value;r&&(t+=":"+r),Dashboard.showModalLoadingMsg(),ConnectionManager.connectToAddress(t).then(function(t){a(e,t)},function(){a(e,{State:MediaBrowser.ConnectionState.Unavailable})})}function d(a){var t=a.querySelector("#txtManualName").value,r=a.querySelector("#txtManualPassword").value;e(a,t,r)}return function(e){function a(a){return d(e),a.preventDefault(),!1}function t(a){return c(e),a.preventDefault(),!1}function n(a){if(!s())return a.preventDefault(),!1;var t=e;return ConnectionManager.signupForConnect(t.querySelector("#txtSignupEmail",t).value,t.querySelector("#txtSignupUsername",t).value,t.querySelector("#txtSignupPassword",t).value,t.querySelector("#txtSignupPasswordConfirm",t).value).then(function(){Dashboard.alert({message:Globalize.translate("MessageThankYouForConnectSignUp"),callback:function(){Dashboard.navigate("connectlogin.html?mode=welcome")}})},function(e){Dashboard.alert("passwordmatch"==e.errorCode?{message:Globalize.translate("ErrorMessagePasswordNotMatchConfirm")}:"USERNAME_IN_USE"==e.errorCode?{message:Globalize.translate("ErrorMessageUsernameInUse")}:"EMAIL_IN_USE"==e.errorCode?{message:Globalize.translate("ErrorMessageEmailInUse")}:{message:Globalize.translate("DefaultErrorMessage")})}),a.preventDefault(),!1}e.querySelector(".btnSkipConnect").addEventListener("click",o),e.querySelector(".connectLoginForm").addEventListener("submit",a),e.querySelector(".manualServerForm").addEventListener("submit",t),e.querySelector(".signupForm").addEventListener("submit",n),e.querySelector(".btnSignupForConnect").addEventListener("click",function(e){return s()?(e.preventDefault(),e.stopPropagation(),Dashboard.navigate("connectlogin.html?mode=signup"),!1):void 0}),e.querySelector(".btnCancelSignup").addEventListener("click",function(){history.back()}),e.querySelector(".btnCancelManualServer").addEventListener("click",function(){history.back()}),e.querySelector(".btnWelcomeNext").addEventListener("click",function(){Dashboard.navigate("connectlogin.html?mode=connect")});var i=e.querySelector(".terms");i.innerHTML=Globalize.translate("LoginDisclaimer")+"<div style='margin-top:5px;'><a href='http://emby.media/terms' target='_blank'>"+Globalize.translate("TermsOfUse")+"</a></div>",AppInfo.isNativeApp?(i.classList.add("hide"),e.querySelector(".tvAppInfo").classList.add("hide")):(i.classList.remove("hide"),e.querySelector(".tvAppInfo").classList.remove("hide")),e.addEventListener("viewbeforeshow",function(){var e=this;if(e.querySelector("#txtSignupEmail").value="",e.querySelector("#txtSignupUsername").value="",e.querySelector("#txtSignupPassword").value="",e.querySelector("#txtSignupPasswordConfirm").value="",browserInfo.safari&&AppInfo.isNativeApp)e.querySelector(".embyIntroDownloadMessage").innerHTML=Globalize.translate("EmbyIntroDownloadMessageWithoutLink");else{var a='<a href="http://emby.media" target="_blank">http://emby.media</a>';e.querySelector(".embyIntroDownloadMessage").innerHTML=Globalize.translate("EmbyIntroDownloadMessage",a)}}),e.addEventListener("viewshow",function(){r(e)})}});