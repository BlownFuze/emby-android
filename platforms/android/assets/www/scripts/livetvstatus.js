define(["jQuery"],function(e){function t(e,t){var i=Globalize.translate("MessageConfirmResetTuner");require(["confirm"],function(a){a(i,Globalize.translate("HeaderResetTuner")).then(function(){Dashboard.showLoadingMsg(),ApiClient.resetLiveTvTuner(t).then(function(){Dashboard.hideLoadingMsg(),s(e)})})})}function i(i,a){var n="";if(a.length){n+='<div class="paperList">';for(var r=0,o=a.length;o>r;r++){var s=a[r];n+="<paper-icon-item>",n+='<paper-fab mini style="background:#52B54B;" icon="live-tv" item-icon></paper-fab>',n+="<paper-item-body two-line>",n+="<div>",n+=s.Name,n+="</div>",n+="<div secondary>",n+=s.SourceType,n+="</div>",n+="<div secondary>","RecordingTv"==s.Status?s.ChannelName?(n+='<a href="itemdetails.html?id='+s.ChannelId+'">',n+=Globalize.translate("StatusRecordingProgram").replace("{0}",s.ChannelName),n+="</a>"):n+=Globalize.translate("StatusRecording"):"LiveTv"==s.Status?s.ChannelName?(n+='<a href="itemdetails.html?id='+s.ChannelId+'">',n+=Globalize.translate("StatusWatchingProgram").replace("{0}",s.ChannelName),n+="</a>"):n+=Globalize.translate("StatusWatching"):n+=s.Status,n+="</div>",n+="</paper-item-body>",s.CanReset&&(n+='<paper-icon-button icon="refresh" data-tunerid="'+s.Id+'" title="'+Globalize.translate("ButtonResetTuner")+'" class="btnResetTuner"></paper-icon-button>'),n+="</paper-icon-item>"}n+="</div>"}a.length?i.querySelector(".tunerSection").classList.remove("hide"):i.querySelector(".tunerSection").classList.add("hide");var l=e(".tunerList",i).html(n);e(".btnResetTuner",l).on("click",function(){var e=this.getAttribute("data-tunerid");t(i,e)})}function a(e){var t="";t+="<div>";var i=e.HomePageUrl||"#";t+='<p><a href="'+i+'" target="_blank">'+e.Name+"</a></p>";var a=e.Version||"Unknown";a+=e.HasUpdateAvailable?' <a style="margin-left: .25em;" href="'+i+'" target="_blank">'+Globalize.translate("LiveTvUpdateAvailable")+"</a>":'<img src="css/images/checkmarkgreen.png" style="height: 17px; margin-left: 10px; margin-right: 0; position: relative; top: 5px; border-radius:3px;" /> '+Globalize.translate("LabelVersionUpToDate"),t+="<p>"+a+"</p>";var n=e.Status;return"Ok"==e.Status?n='<span style="color:green;">'+n+"</span>":(e.StatusMessage&&(n+=" ("+e.StatusMessage+")"),n='<span style="color:red;">'+n+"</span>"),t+="<p>"+Globalize.translate("ValueStatus",n)+"</p>",t+="</div>"}function n(t,n){n.IsEnabled?e(".liveTvStatusContent",t).show():e(".liveTvStatusContent",t).hide();var o=n.Services.filter(function(e){return e.IsVisible});o.length?e(".servicesSection",t).show():e(".servicesSection",t).hide(),e(".servicesList",t).html(o.map(a).join(""));for(var s=[],l=0,d=n.Services.length;d>l;l++)for(var u=0,v=n.Services[l].Tuners.length;v>u;u++)s.push(n.Services[l].Tuners[u]);i(t,s),ApiClient.getNamedConfiguration("livetv").then(function(e){r(t,e.TunerHosts),c(t,e.ListingProviders)}),Dashboard.hideLoadingMsg()}function r(t,i){var a="";if(i.length){a+='<div class="paperList">';for(var n=0,r=i.length;r>n;n++){var s=i[n],l="livetvtunerprovider-"+s.Type+".html?id="+s.Id;a+="<paper-icon-item>",a+='<paper-fab mini style="background:#52B54B;" icon="live-tv" item-icon></paper-fab>',a+="<paper-item-body two-line>",a+='<a class="clearLink" href="'+l+'">',a+="<div>",a+=s.FriendlyName||u(s.Type),a+="</div>",a+="<div secondary>",a+=s.Url,a+="</div>",a+="</a>",a+="</paper-item-body>",a+='<paper-icon-button icon="delete" data-id="'+s.Id+'" title="'+Globalize.translate("ButtonDelete")+'" class="btnDeleteDevice"></paper-icon-button>',a+="</paper-icon-item>"}a+="</div>"}var c=e(".devicesList",t).html(a);e(".btnDeleteDevice",c).on("click",function(){var e=this.getAttribute("data-id");o(t,e)})}function o(e,t){var i=Globalize.translate("MessageConfirmDeleteTunerDevice");require(["confirm"],function(a){a(i,Globalize.translate("HeaderDeleteDevice")).then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("LiveTv/TunerHosts",{Id:t})}).then(function(){s(e)})})})}function s(e){Dashboard.showLoadingMsg(),ApiClient.getLiveTvInfo().then(function(t){n(e,t)})}function l(t){t.querySelector(".dlgAddDevice").close(),Dashboard.showLoadingMsg(),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/TunerHosts"),data:JSON.stringify({Type:e("#selectTunerDeviceType",t).val(),Url:e("#txtDevicePath",t).val()}),contentType:"application/json"}).then(function(){s(t)},function(){Dashboard.alert({message:Globalize.translate("ErrorAddingTunerDevice")})})}function c(t,i){var a="";if(i.length){a+='<div class="paperList">';for(var n=0,r=i.length;r>n;n++){var o=i[n];a+="<paper-icon-item>",a+='<paper-fab mini style="background:#52B54B;" icon="dvr" item-icon></paper-fab>',a+="<paper-item-body two-line>",a+='<a class="clearLink" href="'+p(o.Type)+"&id="+o.Id+'">',a+="<div>",a+=v(o.Type),a+="</div>",a+="</a>",a+="</paper-item-body>",a+='<paper-icon-button icon="delete" data-id="'+o.Id+'" title="'+Globalize.translate("ButtonDelete")+'" class="btnDelete"></paper-icon-button>',a+="</paper-icon-item>"}a+="</div>"}var s=e(".providerList",t).html(a);e(".btnDelete",s).on("click",function(){var e=this.getAttribute("data-id");d(t,e)})}function d(e,t){var i=Globalize.translate("MessageConfirmDeleteGuideProvider");require(["confirm"],function(a){a(i,Globalize.translate("HeaderDeleteProvider")).then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("LiveTv/ListingProviders",{Id:t})}).then(function(){s(e)},function(){s(e)})})})}function u(e){switch(e=e.toLowerCase()){case"m3u":return"M3U Playlist";case"hdhomerun":return"HDHomerun";case"satip":return"DVB";default:return"Unknown"}}function v(e){switch(e=e.toLowerCase()){case"schedulesdirect":return"Schedules Direct";case"emby":return"Emby Guide";default:return"Unknown"}}function p(e){switch(e=e.toLowerCase()){case"schedulesdirect":return"livetvguideprovider.html?type=schedulesdirect";case"emby":return"livetvguideprovider.html?type=emby"}}function h(e){var t=[];t.push({name:"Schedules Direct",id:"SchedulesDirect"}),t.push({name:Globalize.translate("ButtonOther"),id:"other"}),require(["actionsheet"],function(i){i.show({items:t,positionTo:e,callback:function(e){"other"==e?Dashboard.alert({message:Globalize.translate("ForAdditionalLiveTvOptions")}):Dashboard.navigate(p(e))}})})}function f(e){var t=[];t.push({name:u("satip"),id:"satip"}),t.push({name:"HDHomerun",id:"hdhomerun"}),t.push({name:u("m3u"),id:"m3u"}),t.push({name:Globalize.translate("ButtonOther"),id:"other"}),require(["actionsheet"],function(i){i.show({items:t,positionTo:e,callback:function(e){"other"==e?Dashboard.alert({message:Globalize.translate("ForAdditionalLiveTvOptions")}):Dashboard.navigate("livetvtunerprovider-"+e+".html")}})})}e(document).on("pageinit","#liveTvStatusPage",function(){var t=this;e(".btnAddDevice",t).on("click",function(){f(this)}),e(".formAddDevice",t).on("submit",function(){return l(t),!1}),e(".btnAddProvider",t).on("click",function(){h(this)})}).on("pageshow","#liveTvStatusPage",function(){var t=this;s(t),e(".btnRefresh",t).taskButton({mode:"on",progressElem:t.querySelector(".refreshGuideProgress"),taskKey:"RefreshGuide"})}).on("pagehide","#liveTvStatusPage",function(){var t=this;e(".btnRefreshGuide",t).taskButton({mode:"off"})})});