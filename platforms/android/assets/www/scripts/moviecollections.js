define(["events","libraryBrowser","imageLoader","alphaPicker","listView","emby-itemscontainer"],function(e,t,r,a,n){return function(e,i,o){function l(e){var r=u(e),a=g[r];return a||(a=g[r]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"BoxSet",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:v},view:t.getSavedView(r)||t.getDefaultItemsView("Poster","Poster")},t.loadSavedQueryValues(r,a.query)),a}function s(e){return l(e).query}function u(e){return e.savedQueryKey||(e.savedQueryKey=t.getSavedQueryKey("movies")),e.savedQueryKey}function c(e){Dashboard.showLoadingMsg();var a=s(e);ApiClient.getItems(Dashboard.getCurrentUserId(),a).then(function(i){function l(){a.StartIndex+=a.Limit,c(o)}function s(){a.StartIndex-=a.Limit,c(o)}window.scrollTo(0,0),d(e);var m,v=LibraryBrowser.getQueryPagingHtml({startIndex:a.StartIndex,limit:a.Limit,totalRecordCount:i.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),g=y.getCurrentViewStyle();m="Thumb"==g?t.getPosterViewHtml({items:i.Items,shape:"backdrop",preferThumb:!0,context:"movies",lazy:!0,overlayPlayButton:!0}):"ThumbCard"==g?t.getPosterViewHtml({items:i.Items,shape:"backdrop",preferThumb:!0,context:"movies",lazy:!0,cardLayout:!0,showTitle:!0,showItemCounts:!0}):"Banner"==g?t.getPosterViewHtml({items:i.Items,shape:"banner",preferBanner:!0,context:"movies",lazy:!0}):"List"==g?n.getListViewHtml({items:i.Items,context:"movies",sortBy:a.SortBy}):t.getPosterViewHtml("PosterCard"==g?{items:i.Items,shape:"auto",context:"movies",showTitle:!0,showYear:!0,lazy:!0,cardLayout:!0,showItemCounts:!0}:{items:i.Items,shape:"auto",context:"movies",centerText:!0,lazy:!0,overlayPlayButton:!0});var S,h,f=o.querySelectorAll(".paging");for(S=0,h=f.length;h>S;S++)f[S].innerHTML=v;for(f=o.querySelectorAll(".btnNextPage"),S=0,h=f.length;h>S;S++)f[S].addEventListener("click",l);for(f=o.querySelectorAll(".btnPreviousPage"),S=0,h=f.length;h>S;S++)f[S].addEventListener("click",s);i.Items.length||(m='<p style="text-align:center;">'+Globalize.translate("MessageNoCollectionsAvailable")+"</p>");var w=o.querySelector(".itemsContainer");w.innerHTML=m,r.lazyChildren(w),t.saveQueryValues(u(e),a),Dashboard.hideLoadingMsg()})}function d(e){var t=s(e);y.alphaPicker.value(t.NameStartsWithOrGreater)}function m(e){var r=e.querySelector(".alphaPicker");r.addEventListener("alphavaluechanged",function(t){var r=t.detail.value,a=s(e);a.NameStartsWithOrGreater=r,a.StartIndex=0,c(e)}),y.alphaPicker=new a({element:r,valueChangeEvent:"click"}),e.querySelector(".btnSort").addEventListener("click",function(r){t.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionImdbRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName"}],callback:function(){s(e).StartIndex=0,c(e)},query:s(e),button:r.target})});var n=e.querySelector(".btnSelectView");n.addEventListener("click",function(e){t.showLayoutMenu(e.target,y.getCurrentViewStyle(),"List,Poster,PosterCard,Thumb,ThumbCard".split(","))}),n.addEventListener("layoutchange",function(r){var a=r.detail.viewStyle;l(e).view=a,t.saveViewSetting(u(e),a),s(e).StartIndex=0,c(e)}),e.querySelector(".btnNewCollection").addEventListener("click",function(){require(["collectionEditor"],function(e){var t=ApiClient.serverInfo().Id;(new e).show({items:[],serverId:t})})})}var y=this,v=t.getDefaultPageSize(),g={};y.getCurrentViewStyle=function(){return l(o).view},m(o),y.renderTab=function(){c(o),d(o)},y.destroy=function(){}}});