define(["jQuery"],function(e){function t(t,n,i){var o="";o+='<div class="checkboxList">',o+=i.map(function(e){var t="",i="chkGroupFolder"+e.Id,o=null!=n.Configuration.ExcludeFoldersFromGrouping&&-1==n.Configuration.ExcludeFoldersFromGrouping.indexOf(e.Id)||-1!=n.Configuration.GroupedFolders.indexOf(e.Id),r=o?' checked="checked"':"";return t+="<label>",t+='<input type="checkbox" is="emby-checkbox" class="chkGroupFolder" data-folderid="'+e.Id+'" id="'+i+'"'+r+"/>",t+="<span>"+e.Name+"</span>",t+="</label>"}).join(""),o+="</div>",e(".folderGroupList",t).html(o)}function n(t,n,i){var o="";o+='<div class="checkboxList">',o+=i.Items.map(function(e){var t="",i="chkIncludeInLatest"+e.Id,o=-1==n.Configuration.LatestItemsExcludes.indexOf(e.Id),r=o?' checked="checked"':"";return t+="<label>",t+='<input type="checkbox" is="emby-checkbox" class="chkIncludeInLatest" data-folderid="'+e.Id+'" id="'+i+'"'+r+"/>",t+="<span>"+e.Name+"</span>",t+="</label>"}).join(""),o+="</div>",e(".latestItemsList",t).html(o)}function i(t,n,i){var o="",r=0;o+=i.Items.map(function(e){var t="";return t+='<paper-icon-item class="viewItem" data-viewid="'+e.Id+'">',t+='<paper-fab mini style="background-color:#444;" icon="folder-open" item-icon></paper-fab>',t+="<paper-item-body>",t+="<div>",t+=e.Name,t+="</div>",t+="</paper-item-body>",r>0?t+='<button type="button" is="paper-icon-button-light" class="btnViewItemUp btnViewItemMove autoSize" title="'+Globalize.translate("ButtonUp")+'"><i class="md-icon">keyboard_arrow_up</i></button>':i.Items.length>1&&(t+='<button type="button" is="paper-icon-button-light" class="btnViewItemDown btnViewItemMove autoSize" title="'+Globalize.translate("ButtonDown")+'"><i class="md-icon">keyboard_arrow_down</i></button>'),t+="</paper-icon-item>",r++,t}).join(""),e(".viewOrderList",t).html(o)}function o(o,r,a){o.querySelector(".chkHidePlayedFromLatest").checked=r.Configuration.HidePlayedInLatest||!1,o.querySelector(".chkDisplayChannelsInline").checked=!r.Configuration.EnableChannelView,e("#selectHomeSection1",o).val(a.CustomPrefs.home0||""),e("#selectHomeSection2",o).val(a.CustomPrefs.home1||""),e("#selectHomeSection3",o).val(a.CustomPrefs.home2||""),e("#selectHomeSection4",o).val(a.CustomPrefs.home3||"");var s=ApiClient.getItems(r.Id,{sortBy:"SortName"}),c=ApiClient.getUserViews({},r.Id),l=ApiClient.getJSON(ApiClient.getUrl("Users/"+r.Id+"/GroupingOptions"));Promise.all([s,c,l]).then(function(e){t(o,r,e[2]),n(o,r,e[0]),i(o,r,e[1]),Dashboard.hideLoadingMsg()})}function r(){return AppInfo.isNativeApp?"Emby Mobile":"webclient"}function a(t,n,i){return n.Configuration.HidePlayedInLatest=t.querySelector(".chkHidePlayedFromLatest").checked,n.Configuration.EnableChannelView=!t.querySelector(".chkDisplayChannelsInline").checked,n.Configuration.LatestItemsExcludes=e(".chkIncludeInLatest",t).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-folderid")}),n.Configuration.ExcludeFoldersFromGrouping=null,n.Configuration.GroupedFolders=e(".chkGroupFolder",t).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-folderid")}),n.Configuration.OrderedViews=e(".viewItem",t).get().map(function(e){return e.getAttribute("data-viewid")}),i.CustomPrefs.home0=e("#selectHomeSection1",t).val(),i.CustomPrefs.home1=e("#selectHomeSection2",t).val(),i.CustomPrefs.home2=e("#selectHomeSection3",t).val(),i.CustomPrefs.home3=e("#selectHomeSection4",t).val(),ApiClient.updateDisplayPreferences("home",i,n.Id,r()).then(function(){return ApiClient.updateUserConfiguration(n.Id,n.Configuration)})}function s(e){Dashboard.showLoadingMsg();var t=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(t).then(function(t){ApiClient.getDisplayPreferences("home",t.Id,r()).then(function(n){a(e,t,n).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})})}function c(){var t=e(this).parents(".page")[0];return s(t),!1}pageIdOn("pageinit","homeScreenPreferencesPage",function(){var t=this;e(".viewOrderList",t).on("click",".btnViewItemMove",function(){var t=e(this).parents(".viewItem"),n=t.parents(".paperList");if(e(this).hasClass("btnViewItemDown")){var i=t.next();t.remove().insertAfter(i)}else{var o=t.prev();t.remove().insertBefore(o)}e(".viewItem",n).each(function(){var t=e(".btnViewItemMove",this)[0];e(this).prev(".viewItem").length?(t.classList.add("btnViewItemUp"),t.classList.remove("btnViewItemDown"),t.icon="keyboard-arrow-up"):(t.classList.remove("btnViewItemUp"),t.classList.add("btnViewItemDown"),t.icon="keyboard-arrow-down")})}),e(".homeScreenPreferencesForm").off("submit",c).on("submit",c),AppInfo.enableAutoSave?t.querySelector(".btnSave").classList.add("hide"):t.querySelector(".btnSave").classList.remove("hide")}),pageIdOn("pageshow","homeScreenPreferencesPage",function(){var e=this;Dashboard.showLoadingMsg();var t=getParameterByName("userId")||Dashboard.getCurrentUserId();ApiClient.getUser(t).then(function(t){ApiClient.getDisplayPreferences("home",t.Id,r()).then(function(n){o(e,t,n)})})}),pageIdOn("pagebeforehide","homeScreenPreferencesPage",function(){var e=this;AppInfo.enableAutoSave&&s(e)})});