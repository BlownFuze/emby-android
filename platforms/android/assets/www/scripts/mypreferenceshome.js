define(["jQuery"],function(e){function t(t,n,o){var i="";i+='<div class="checkboxList">',i+=o.map(function(e){var t="",o="chkGroupFolder"+e.Id,i=null!=n.Configuration.ExcludeFoldersFromGrouping&&-1==n.Configuration.ExcludeFoldersFromGrouping.indexOf(e.Id)||-1!=n.Configuration.GroupedFolders.indexOf(e.Id),r=i?' checked="checked"':"";return t+="<label>",t+='<input type="checkbox" is="emby-checkbox" class="chkGroupFolder" data-folderid="'+e.Id+'" id="'+o+'"'+r+"/>",t+="<span>"+e.Name+"</span>",t+="</label>"}).join(""),i+="</div>",e(".folderGroupList",t).html(i)}function n(t,n,o){var i="";i+='<div class="checkboxList">',i+=o.Items.map(function(e){var t="",o="chkIncludeInLatest"+e.Id,i=-1==n.Configuration.LatestItemsExcludes.indexOf(e.Id),r=i?' checked="checked"':"";return t+="<label>",t+='<input type="checkbox" is="emby-checkbox" class="chkIncludeInLatest" data-folderid="'+e.Id+'" id="'+o+'"'+r+"/>",t+="<span>"+e.Name+"</span>",t+="</label>"}).join(""),i+="</div>",e(".latestItemsList",t).html(i)}function o(t,n,o){var i="",r=0;i+=o.Items.map(function(e){var t="";return t+='<paper-icon-item class="viewItem" data-viewid="'+e.Id+'">',t+='<paper-fab mini style="background-color:#444;" icon="folder-open" item-icon></paper-fab>',t+="<paper-item-body>",t+="<div>",t+=e.Name,t+="</div>",t+="</paper-item-body>",r>0?t+='<button type="button" is="paper-icon-button-light" class="btnViewItemUp btnViewItemMove" title="'+Globalize.translate("ButtonUp")+'"><iron-icon icon="keyboard-arrow-up"></iron-icon></button>':o.Items.length>1&&(t+='<button type="button" is="paper-icon-button-light" class="btnViewItemDown btnViewItemMove" title="'+Globalize.translate("ButtonDown")+'"><iron-icon icon="keyboard-arrow-down"></iron-icon></button>'),t+="</paper-icon-item>",r++,t}).join(""),e(".viewOrderList",t).html(i)}function i(i,r,a){i.querySelector(".chkHidePlayedFromLatest").checked=r.Configuration.HidePlayedInLatest||!1,i.querySelector(".chkDisplayChannelsInline").checked=!r.Configuration.EnableChannelView,e("#selectHomeSection1",i).val(a.CustomPrefs.home0||""),e("#selectHomeSection2",i).val(a.CustomPrefs.home1||""),e("#selectHomeSection3",i).val(a.CustomPrefs.home2||""),e("#selectHomeSection4",i).val(a.CustomPrefs.home3||"");var s=ApiClient.getItems(r.Id,{sortBy:"SortName"}),c=ApiClient.getUserViews({},r.Id),l=ApiClient.getJSON(ApiClient.getUrl("Users/"+r.Id+"/GroupingOptions"));Promise.all([s,c,l]).then(function(e){t(i,r,e[2]),n(i,r,e[0]),o(i,r,e[1]),Dashboard.hideLoadingMsg()})}function r(){return AppInfo.isNativeApp?"Emby Mobile":"webclient"}function a(t,n,o){return n.Configuration.HidePlayedInLatest=t.querySelector(".chkHidePlayedFromLatest").checked,n.Configuration.EnableChannelView=!t.querySelector(".chkDisplayChannelsInline").checked,n.Configuration.LatestItemsExcludes=e(".chkIncludeInLatest",t).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-folderid")}),n.Configuration.ExcludeFoldersFromGrouping=null,n.Configuration.GroupedFolders=e(".chkGroupFolder",t).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-folderid")}),n.Configuration.OrderedViews=e(".viewItem",t).get().map(function(e){return e.getAttribute("data-viewid")}),o.CustomPrefs.home0=e("#selectHomeSection1",t).val(),o.CustomPrefs.home1=e("#selectHomeSection2",t).val(),o.CustomPrefs.home2=e("#selectHomeSection3",t).val(),o.CustomPrefs.home3=e("#selectHomeSection4",t).val(),ApiClient.updateDisplayPreferences("home",o,n.Id,r()).then(function(){return ApiClient.updateUserConfiguration(n.Id,n.Configuration)})}function s(e){Dashboard.showLoadingMsg();var t=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(t).then(function(t){ApiClient.getDisplayPreferences("home",t.Id,r()).then(function(n){a(e,t,n).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})})}function c(){var t=e(this).parents(".page")[0];return s(t),!1}pageIdOn("pageinit","homeScreenPreferencesPage",function(){var t=this;e(".viewOrderList",t).on("click",".btnViewItemMove",function(){var t=e(this).parents(".viewItem"),n=t.parents(".paperList");if(e(this).hasClass("btnViewItemDown")){var o=t.next();t.remove().insertAfter(o)}else{var i=t.prev();t.remove().insertBefore(i)}e(".viewItem",n).each(function(){var t=e(".btnViewItemMove",this)[0];e(this).prev(".viewItem").length?(t.classList.add("btnViewItemUp"),t.classList.remove("btnViewItemDown"),t.icon="keyboard-arrow-up"):(t.classList.remove("btnViewItemUp"),t.classList.add("btnViewItemDown"),t.icon="keyboard-arrow-down")})}),e(".homeScreenPreferencesForm").off("submit",c).on("submit",c),AppInfo.enableAutoSave?t.querySelector(".btnSave").classList.add("hide"):t.querySelector(".btnSave").classList.remove("hide")}),pageIdOn("pageshow","homeScreenPreferencesPage",function(){var e=this;Dashboard.showLoadingMsg();var t=getParameterByName("userId")||Dashboard.getCurrentUserId();ApiClient.getUser(t).then(function(t){ApiClient.getDisplayPreferences("home",t.Id,r()).then(function(n){i(e,t,n)})})}),pageIdOn("pagebeforehide","homeScreenPreferencesPage",function(){var e=this;AppInfo.enableAutoSave&&s(e)})});