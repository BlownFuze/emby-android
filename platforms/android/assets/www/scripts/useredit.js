define(["jQuery"],function(e){function n(n,c){d=c,c.Policy.IsDisabled?e(".disabledUserBanner",n).show():e(".disabledUserBanner",n).hide(),"Guest"==c.ConnectLinkType?(e("#fldConnectInfo",n).hide(),e("#txtUserName",n).prop("disabled","disabled")):(e("#txtUserName",n).prop("disabled","").removeAttr("disabled"),e("#fldConnectInfo",n).show()),e(".lnkEditUserPreferences",n).attr("href","mypreferencesmenu.html?userId="+c.Id),Dashboard.setPageTitle(c.Name),e("#txtUserName",n).val(c.Name),e("#txtConnectUserName",n).val(d.ConnectUserName),e("#chkIsAdmin",n).checked(c.Policy.IsAdministrator),e("#chkDisabled",n).checked(c.Policy.IsDisabled),e("#chkIsHidden",n).checked(c.Policy.IsHidden),e("#chkRemoteControlSharedDevices",n).checked(c.Policy.EnableSharedDeviceControl),e("#chkEnableRemoteControlOtherUsers",n).checked(c.Policy.EnableRemoteControlOfOtherUsers),e("#chkEnableDownloading",n).checked(c.Policy.EnableContentDownloading),e("#chkManageLiveTv",n).checked(c.Policy.EnableLiveTvManagement),e("#chkEnableLiveTvAccess",n).checked(c.Policy.EnableLiveTvAccess),e("#chkEnableContentDeletion",n).checked(c.Policy.EnableContentDeletion),e("#chkDisableUserPreferences",n).checked(!c.Policy.EnableUserPreferenceAccess),e("#chkEnableMediaPlayback",n).checked(c.Policy.EnableMediaPlayback),e("#chkEnableAudioPlaybackTranscoding",n).checked(c.Policy.EnableAudioPlaybackTranscoding),e("#chkEnableVideoPlaybackTranscoding",n).checked(c.Policy.EnableVideoPlaybackTranscoding),e("#chkEnableSync",n).checked(c.Policy.EnableSync),e("#chkEnableSyncTranscoding",n).checked(c.Policy.EnableSyncTranscoding),e("#chkEnableSharing",n).checked(c.Policy.EnablePublicSharing),Dashboard.hideLoadingMsg()}function c(e,n,c,o){var t=e.ConnectUserName||"",i=n,l=ApiClient.getUrl("Users/"+e.Id+"/Connect/Link");t&&!i?ApiClient.ajax({type:"DELETE",url:l}).then(function(){Dashboard.alert({message:Globalize.translate("MessageEmbyAccontRemoved"),title:Globalize.translate("HeaderEmbyAccountRemoved"),callback:c})},function(){Dashboard.alert({message:Globalize.translate("ErrorRemovingEmbyConnectAccount")})}):t!=i?ApiClient.ajax({type:"POST",url:l,data:{ConnectUsername:i},dataType:"json"}).then(function(e){var n=e.IsPending?"MessagePendingEmbyAccountAdded":"MessageEmbyAccountAdded";Dashboard.alert({message:Globalize.translate(n),title:Globalize.translate("HeaderEmbyAccountAdded"),callback:c})},function(){a(".")}):o&&o()}function a(e){var n,c;e?(n=Globalize.translate("ErrorAddingEmbyConnectAccount1",'<a href="https://emby.media/connect" target="_blank">https://emby.media/connect</a>'),n+="<br/><br/>"+Globalize.translate("ErrorAddingEmbyConnectAccount2","apps@emby.media"),c=Globalize.translate("ErrorAddingEmbyConnectAccount1","https://emby.media/connect"),c+="\n\n"+Globalize.translate("ErrorAddingEmbyConnectAccount2","apps@emby.media")):n=c=Globalize.translate("DefaultErrorMessage"),require(["alert"],function(e){e({text:c,html:n})})}function o(n,a){Dashboard.hideLoadingMsg();var o=d.ConnectUserName||"",t=e("#txtConnectUserName",n).val();o==t?require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))}):c(a,e("#txtConnectUserName",n).val(),function(){r(n)})}function t(n,c){n.Name=e("#txtUserName",c).val(),n.Policy.IsAdministrator=e("#chkIsAdmin",c).checked(),n.Policy.IsHidden=e("#chkIsHidden",c).checked(),n.Policy.IsDisabled=e("#chkDisabled",c).checked(),n.Policy.EnableRemoteControlOfOtherUsers=e("#chkEnableRemoteControlOtherUsers",c).checked(),n.Policy.EnableLiveTvManagement=e("#chkManageLiveTv",c).checked(),n.Policy.EnableLiveTvAccess=e("#chkEnableLiveTvAccess",c).checked(),n.Policy.EnableContentDeletion=e("#chkEnableContentDeletion",c).checked(),n.Policy.EnableUserPreferenceAccess=!e("#chkDisableUserPreferences",c).checked(),n.Policy.EnableSharedDeviceControl=e("#chkRemoteControlSharedDevices",c).checked(),n.Policy.EnableMediaPlayback=e("#chkEnableMediaPlayback",c).checked(),n.Policy.EnableAudioPlaybackTranscoding=e("#chkEnableAudioPlaybackTranscoding",c).checked(),n.Policy.EnableVideoPlaybackTranscoding=e("#chkEnableVideoPlaybackTranscoding",c).checked(),n.Policy.EnableContentDownloading=e("#chkEnableDownloading",c).checked(),n.Policy.EnableSync=e("#chkEnableSync",c).checked(),n.Policy.EnableSyncTranscoding=e("#chkEnableSyncTranscoding",c).checked(),n.Policy.EnablePublicSharing=e("#chkEnableSharing",c).checked(),ApiClient.updateUser(n).then(function(){ApiClient.updateUserPolicy(n.Id,n.Policy).then(function(){o(c,n)})})}function i(){var n=e(this).parents(".page");return Dashboard.showLoadingMsg(),l().then(function(e){t(e,n)}),!1}function l(){var e=getParameterByName("userId");return ApiClient.getUser(e)}function r(e){Dashboard.showLoadingMsg(),l().then(function(c){n(e,c)})}var d;e(document).on("pageinit","#editUserPage",function(){e(".editUserProfileForm").off("submit",i).on("submit",i)}).on("pagebeforeshow","#editUserPage",function(){var e=this;r(e)})});