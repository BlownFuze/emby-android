define(["events","libraryBrowser","imageLoader"],function(e,t,n){return function(e,r,a){function i(e){var n=l(e),a=c[n];return a||(a=c[n]={query:{SortBy:"Album,SortName",SortOrder:"Ascending",IncludeItemTypes:"Audio",Recursive:!0,Fields:"AudioInfo,ParentId,SyncInfo",Limit:100,StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary"}},a.query.ParentId=r.topParentId,t.loadSavedQueryValues(n,a.query)),a}function o(e){return i(e).query}function l(e){return e.savedQueryKey||(e.savedQueryKey=t.getSavedQueryKey("songs")),e.savedQueryKey}function u(e){Dashboard.showLoadingMsg();var r=o(e);ApiClient.getItems(Dashboard.getCurrentUserId(),r).then(function(i){function o(){r.StartIndex+=r.Limit,u(a)}function s(){r.StartIndex-=r.Limit,u(a)}window.scrollTo(0,0),d(e);var m,c,y=LibraryBrowser.getQueryPagingHtml({startIndex:r.StartIndex,limit:r.Limit,totalRecordCount:i.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),b=LibraryBrowser.getListViewHtml({items:i.Items,showIndex:!0,defaultAction:"play",smallIcon:!0}),f=a.querySelectorAll(".paging");for(m=0,c=f.length;c>m;m++)f[m].innerHTML=y;for(f=a.querySelectorAll(".btnNextPage"),m=0,c=f.length;c>m;m++)f[m].addEventListener("click",o);for(f=a.querySelectorAll(".btnPreviousPage"),m=0,c=f.length;c>m;m++)f[m].addEventListener("click",s);var g=a.querySelector(".itemsContainer");g.innerHTML=b,n.lazyChildren(g),t.saveQueryValues(l(e),r),Dashboard.hideLoadingMsg()})}function d(){}function s(e){e.querySelector(".btnFilter").addEventListener("click",function(){m.showFilterMenu()}),e.querySelector(".btnSort").addEventListener("click",function(n){t.showSortMenu({items:[{name:Globalize.translate("OptionTrackName"),id:"Name"},{name:Globalize.translate("OptionAlbum"),id:"Album,SortName"},{name:Globalize.translate("OptionAlbumArtist"),id:"AlbumArtist,Album,SortName"},{name:Globalize.translate("OptionArtist"),id:"Artist,Album,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,AlbumArtist,Album,SortName"},{name:Globalize.translate("OptionRuntime"),id:"Runtime,AlbumArtist,Album,SortName"}],callback:function(){o(e).StartIndex=0,u(e)},query:o(e),button:n.target})})}var m=this,c={};m.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],function(e){var t=new e({query:o(a),mode:"songs"});Events.on(t,"filterchange",function(){o(a).StartIndex=0,u(a)}),t.show()})},m.getCurrentViewStyle=function(){return i(a).view},s(a),m.renderTab=function(){u(a),d(a)},m.destroy=function(){}}});