define(["libraryBrowser"],function(e){function t(e){if(AppInfo.isNativeApp&&browserInfo.safari)switch(e){case 0:return d;case 1:return"resume";case 2:return"nextup";case 3:return"latestmovies";case 4:return"latestepisodes";case 5:return"latesttvrecordings";default:return""}switch(e){case 0:return d;case 1:return"resume";case 2:return"latestmedia";case 3:return"latesttvrecordings";default:return""}}function r(e,r,a,s){var o=r.Id,i=a.CustomPrefs["home"+s]||t(s);"folders"==i&&(i=d);var n="0"!=a.CustomPrefs.enableLibraryTileNames,l=e.querySelector(".section"+s);return"latestmedia"==i?Sections.loadRecentlyAdded(l,r):"latestmovies"==i?Sections.loadLatestMovies(l,r):"latestepisodes"==i?Sections.loadLatestEpisodes(l,r):"librarytiles"==i?Sections.loadLibraryTiles(l,r,"backdrop",s,!1,n):"smalllibrarytiles"==i?Sections.loadLibraryTiles(l,r,"homePageSmallBackdrop",s,!1,n):"smalllibrarytiles-automobile"==i?Sections.loadLibraryTiles(l,r,"homePageSmallBackdrop",s,!0,n):"librarytiles-automobile"==i?Sections.loadLibraryTiles(l,r,"backdrop",s,!0,n):"librarybuttons"==i?Sections.loadlibraryButtons(l,o,s):"resume"==i?Sections.loadResume(l,o):"nextup"==i?Sections.loadNextUp(l,o):"latesttvrecordings"==i?Sections.loadLatestLiveTvRecordings(l,o):"latestchannelmedia"==i?Sections.loadLatestChannelMedia(l,o):(l.innerHTML="",new Promise(function(e){e()}))}function a(e,t,a){var s,o,i=6,n=e.querySelector(".sections");if(!n.innerHTML.length){var l="";for(s=0,o=i;o>s;s++)l+='<div class="homePageSection section'+s+'"></div>';n.innerHTML=l}var u=[];for(s=0,o=i;o>s;s++)u.push(r(e,t,a,s));return Promise.all(u)}function s(){return AppInfo.isNativeApp?"Emby Mobile":"webclient"}function o(e,t){b("home",t).then(function(e){e.CustomPrefs[g]=m,ApiClient.updateDisplayPreferences("home",e,t,s())})}function i(e,t){if(t.CustomPrefs[g]==m)$(".welcomeMessage",e).hide();else{Dashboard.hideLoadingMsg();var r=$(".welcomeMessage",e).show();t.CustomPrefs[g]?($(".tourHeader",r).html(Globalize.translate("HeaderWelcomeBack")),$(".tourButtonText",r).html(Globalize.translate("ButtonTakeTheTourToSeeWhatsNew"))):($(".tourHeader",r).html(Globalize.translate("HeaderWelcomeToProjectWebClient")),$(".tourButtonText",r).html(Globalize.translate("ButtonTakeTheTour")))}}function n(e,t){require(["slideshow"],function(){var r=[{imageUrl:"css/images/tour/web/tourcontent.jpg",title:Globalize.translate("WebClientTourContent")},{imageUrl:"css/images/tour/web/tourmovies.jpg",title:Globalize.translate("WebClientTourMovies")},{imageUrl:"css/images/tour/web/tourmouseover.jpg",title:Globalize.translate("WebClientTourMouseOver")},{imageUrl:"css/images/tour/web/tourtaphold.jpg",title:Globalize.translate("WebClientTourTapHold")},{imageUrl:"css/images/tour/web/tourmysync.png",title:Globalize.translate("WebClientTourMySync")},{imageUrl:"css/images/tour/web/toureditor.png",title:Globalize.translate("WebClientTourMetadataManager")},{imageUrl:"css/images/tour/web/tourplaylist.png",title:Globalize.translate("WebClientTourPlaylists")},{imageUrl:"css/images/tour/web/tourcollections.jpg",title:Globalize.translate("WebClientTourCollections")},{imageUrl:"css/images/tour/web/tourusersettings1.png",title:Globalize.translate("WebClientTourUserPreferences1")},{imageUrl:"css/images/tour/web/tourusersettings2.png",title:Globalize.translate("WebClientTourUserPreferences2")},{imageUrl:"css/images/tour/web/tourusersettings3.png",title:Globalize.translate("WebClientTourUserPreferences3")},{imageUrl:"css/images/tour/web/tourusersettings4.png",title:Globalize.translate("WebClientTourUserPreferences4")},{imageUrl:"css/images/tour/web/tourmobile1.jpg",title:Globalize.translate("WebClientTourMobile1")},{imageUrl:"css/images/tour/web/tourmobile2.png",title:Globalize.translate("WebClientTourMobile2")},{imageUrl:"css/images/tour/enjoy.jpg",title:Globalize.translate("MessageEnjoyYourStay")}];require(["slideshow"],function(a){var s=new a({slides:r,interactive:!0,loop:!1});s.show(),o(e,t),$(".welcomeMessage",e).hide()})})}function l(t,r){if(e.needsRefresh(r)&&window.ApiClient){var s=Dashboard.getCurrentUserId();Dashboard.showLoadingMsg(),b("home",s).then(function(s){Dashboard.getCurrentUser().then(function(o){a(r,o,s).then(function(){AppInfo.isNativeApp||i(t,s),Dashboard.hideLoadingMsg(),e.setLastRefreshed(r)})})})}}function u(e,t){var r=e.querySelector(".pageTabContent[data-index='"+t+"']"),a=[],s="HomePage",o="";switch(t){case 0:a.push("scripts/sections"),o="renderHomeTab";break;case 1:a.push("scripts/homenextup"),o="renderNextUp";break;case 2:a.push("scripts/favorites"),o="renderFavorites";break;case 3:a.push("scripts/homeupcoming"),o="renderUpcoming";break;default:return}require(a,function(){window[s][o](e,r)})}function c(e,t){if(t.NowPlayingItem&&"Video"==t.NowPlayingItem.MediaType){var r=$.mobile.activePage,a=r.querySelector("neon-animated-pages");a.dispatchEvent(new CustomEvent("tabchange",{}))}}function b(e,t){return ApiClient.getDisplayPreferences(e,t,s())}var d="smalllibrarytiles",m="14",g="homePageTour";return window.HomePage={renderHomeTab:l},function(t){var r=t.querySelector("neon-animated-pages");e.configurePaperLibraryTabs(t,t.querySelector("paper-tabs"),r,"home.html"),r.addEventListener("tabchange",function(e){u(t,parseInt(e.target.selected))}),t.querySelector(".btnTakeTour").addEventListener("click",function(){n(t,Dashboard.getCurrentUserId())}),AppInfo.enableHomeTabs?(t.classList.remove("noSecondaryNavPage"),t.querySelector(".libraryViewNav").classList.remove("hide")):(t.classList.add("noSecondaryNavPage"),t.querySelector(".libraryViewNav").classList.add("hide")),t.addEventListener("viewshow",function(){Events.on(MediaController,"playbackstop",c)}),t.addEventListener("viewbeforehide",function(){Events.off(MediaController,"playbackstop",c)})}});