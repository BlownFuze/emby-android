!function(e,t,a){function n(t,a){var n="";n+="<option value=''></option>";for(var i=0,r=a.length;r>i;i++){var o=a[i];n+="<option value='"+o.ThreeLetterISOLanguageName+"'>"+o.DisplayName+"</option>"}e(t).html(n)}function i(t,a,i,r){r.then(function(i){n(e("#selectAudioLanguage",t),i),n(e("#selectSubtitleLanguage",t),i),e("#selectAudioLanguage",t).val(a.Configuration.AudioLanguagePreference||""),e("#selectSubtitleLanguage",t).val(a.Configuration.SubtitleLanguagePreference||"")}),e("#selectSubtitlePlaybackMode",t).val(a.Configuration.SubtitleMode||"").trigger("change"),t.querySelector(".chkPlayDefaultAudioTrack").checked=a.Configuration.PlayDefaultAudioTrack||!1,t.querySelector(".chkEnableCinemaMode").checked=AppSettings.enableCinemaMode(),t.querySelector(".chkEnableChromecastAc3").checked=AppSettings.enableChromecastAc3(),t.querySelector(".chkExternalVideoPlayer").checked=AppSettings.enableExternalPlayers();var o=MediaPlayer.getVideoQualityOptions().map(function(e){return'<option value="'+e.bitrate+'">'+e.name+"</option>"}).join("");o='<option value="">'+Globalize.translate("OptionAutomatic")+"</option>"+o,e("#selectMaxBitrate",t).html(o),e("#selectMaxBitrate",t).val(AppSettings.enableAutomaticBitrateDetection()?"":AppSettings.maxStreamingBitrate()),e("#selectMaxChromecastBitrate",t).val(AppSettings.maxChromecastBitrate()),Dashboard.hideLoadingMsg()}function r(t){Dashboard.showLoadingMsg();var a=getParameterByName("userId")||Dashboard.getCurrentUserId(),n=ApiClient.getUser(a),r=Dashboard.getCurrentUser(),o=ApiClient.getCultures();Promise.all([n,r]).then(function(e){i(t,e[1],e[0],o)}),ApiClient.getNamedConfiguration("cinemamode").then(function(a){a.EnableIntrosForMovies||a.EnableIntrosForEpisodes?e(".cinemaModeOptions",t).show():e(".cinemaModeOptions",t).hide()})}function o(t,a){a.Configuration.AudioLanguagePreference=e("#selectAudioLanguage",t).val(),a.Configuration.SubtitleLanguagePreference=e("#selectSubtitleLanguage",t).val(),a.Configuration.SubtitleMode=e("#selectSubtitlePlaybackMode",t).val(),a.Configuration.PlayDefaultAudioTrack=t.querySelector(".chkPlayDefaultAudioTrack").checked,AppSettings.enableCinemaMode(t.querySelector(".chkEnableCinemaMode").checked),ApiClient.updateUserConfiguration(a.Id,a.Configuration).then(function(){Dashboard.hideLoadingMsg(),Dashboard.alert(Globalize.translate("SettingsSaved"))},function(){Dashboard.hideLoadingMsg()})}function l(){var t=e(this).parents(".page")[0];Dashboard.showLoadingMsg(),AppSettings.enableExternalPlayers(t.querySelector(".chkExternalVideoPlayer").checked),e("#selectMaxBitrate",t).val()?(AppSettings.maxStreamingBitrate(e("#selectMaxBitrate",t).val()),AppSettings.enableAutomaticBitrateDetection(!1)):AppSettings.enableAutomaticBitrateDetection(!0),AppSettings.maxChromecastBitrate(e("#selectMaxChromecastBitrate",t).val()),AppSettings.enableChromecastAc3(t.querySelector(".chkEnableChromecastAc3").checked);var a=getParameterByName("userId")||Dashboard.getCurrentUserId();return ApiClient.getUser(a).then(function(e){o(t,e)}),!1}e(a).on("pageinit","#languagePreferencesPage",function(){var t=this;e("#selectSubtitlePlaybackMode",t).on("change",function(){e(".subtitlesHelp",t).hide(),e(".subtitles"+this.value+"Help",t).show()}),e(".languagePreferencesForm").off("submit",l).on("submit",l)}).on("pageshow","#languagePreferencesPage",function(){var t=this;AppInfo.supportsExternalPlayers?e(".fldExternalPlayer",t).show():e(".fldExternalPlayer",t).hide(),AppInfo.supportsExternalPlayerMenu?(e(".labelNativeExternalPlayers",t).show(),e(".labelGenericExternalPlayers",t).hide()):(e(".labelGenericExternalPlayers",t).show(),e(".labelNativeExternalPlayers",t).hide()),r(t)})}(jQuery,window,document);