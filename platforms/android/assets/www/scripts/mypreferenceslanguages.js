!function(e){function t(t,a){var n="";n+="<option value=''></option>";for(var i=0,o=a.length;o>i;i++){var r=a[i];n+="<option value='"+r.ThreeLetterISOLanguageName+"'>"+r.DisplayName+"</option>"}e(t).html(n)}function a(a,n,i,o){o.then(function(i){t(e("#selectAudioLanguage",a),i),t(e("#selectSubtitleLanguage",a),i),e("#selectAudioLanguage",a).val(n.Configuration.AudioLanguagePreference||""),e("#selectSubtitleLanguage",a).val(n.Configuration.SubtitleLanguagePreference||""),a.querySelector(".chkEpisodeAutoPlay").checked=n.Configuration.EnableNextEpisodeAutoPlay||!1}),e("#selectSubtitlePlaybackMode",a).val(n.Configuration.SubtitleMode||"").trigger("change"),a.querySelector(".chkPlayDefaultAudioTrack").checked=n.Configuration.PlayDefaultAudioTrack||!1,a.querySelector(".chkEnableCinemaMode").checked=AppSettings.enableCinemaMode(),a.querySelector(".chkExternalVideoPlayer").checked=AppSettings.enableExternalPlayers(),require(["qualityoptions"],function(t){var n=t.getVideoQualityOptions(AppSettings.maxStreamingBitrate()).map(function(e){return'<option value="'+e.bitrate+'">'+e.name+"</option>"}).join("");n='<option value="">'+Globalize.translate("OptionAutomatic")+"</option>"+n,e("#selectMaxBitrate",a).html(n),e("#selectMaxChromecastBitrate",a).html(n),e("#selectMaxBitrate",a).val(AppSettings.enableAutomaticBitrateDetection()?"":AppSettings.maxStreamingBitrate()),e("#selectMaxChromecastBitrate",a).val(AppSettings.maxChromecastBitrate()),Dashboard.hideLoadingMsg()})}function n(t){Dashboard.showLoadingMsg();var n=getParameterByName("userId")||Dashboard.getCurrentUserId(),i=ApiClient.getUser(n),o=Dashboard.getCurrentUser(),r=ApiClient.getCultures();Promise.all([i,o]).then(function(e){a(t,e[1],e[0],r)}),ApiClient.getNamedConfiguration("cinemamode").then(function(a){a.EnableIntrosForMovies||a.EnableIntrosForEpisodes?e(".cinemaModeOptions",t).show():e(".cinemaModeOptions",t).hide()})}function i(t,a){return a.Configuration.AudioLanguagePreference=e("#selectAudioLanguage",t).val(),a.Configuration.SubtitleLanguagePreference=e("#selectSubtitleLanguage",t).val(),a.Configuration.SubtitleMode=e("#selectSubtitlePlaybackMode",t).val(),a.Configuration.PlayDefaultAudioTrack=t.querySelector(".chkPlayDefaultAudioTrack").checked,a.Configuration.EnableNextEpisodeAutoPlay=t.querySelector(".chkEpisodeAutoPlay").checked,AppSettings.enableCinemaMode(t.querySelector(".chkEnableCinemaMode").checked),ApiClient.updateUserConfiguration(a.Id,a.Configuration)}function o(t){AppSettings.enableExternalPlayers(t.querySelector(".chkExternalVideoPlayer").checked),e("#selectMaxBitrate",t).val()?(AppSettings.maxStreamingBitrate(e("#selectMaxBitrate",t).val()),AppSettings.enableAutomaticBitrateDetection(!1)):AppSettings.enableAutomaticBitrateDetection(!0),AppSettings.maxChromecastBitrate(e("#selectMaxChromecastBitrate",t).val());var a=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(a).then(function(e){i(t,e).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})}function r(){var t=e(this).parents(".page")[0];return o(t),!1}pageIdOn("pageinit","languagePreferencesPage",function(){var t=this;e("#selectSubtitlePlaybackMode",t).on("change",function(){e(".subtitlesHelp",t).hide(),e(".subtitles"+this.value+"Help",t).show()}),e(".languagePreferencesForm").off("submit",r).on("submit",r),AppInfo.enableAutoSave?t.querySelector(".btnSave").classList.add("hide"):t.querySelector(".btnSave").classList.remove("hide")}),pageIdOn("pageshow","languagePreferencesPage",function(){var t=this;AppInfo.supportsExternalPlayers?e(".fldExternalPlayer",t).show():e(".fldExternalPlayer",t).hide(),AppInfo.supportsExternalPlayerMenu?(e(".labelNativeExternalPlayers",t).show(),e(".labelGenericExternalPlayers",t).hide()):(e(".labelGenericExternalPlayers",t).show(),e(".labelNativeExternalPlayers",t).hide()),n(t)}),pageIdOn("pagebeforehide","languagePreferencesPage",function(){var e=this;AppInfo.enableAutoSave&&o(e)})}(jQuery,window,document);