define(["appSettings","userSettings","jQuery"],function(e,a,t){function n(e,a){var n="";n+="<option value=''></option>";for(var i=0,o=a.length;o>i;i++){var r=a[i];n+="<option value='"+r.ThreeLetterISOLanguageName+"'>"+r.DisplayName+"</option>"}t(e).html(n)}function i(i,o,r,l){l.then(function(e){n(t("#selectAudioLanguage",i),e),n(t("#selectSubtitleLanguage",i),e),t("#selectAudioLanguage",i).val(o.Configuration.AudioLanguagePreference||""),t("#selectSubtitleLanguage",i).val(o.Configuration.SubtitleLanguagePreference||""),i.querySelector(".chkEpisodeAutoPlay").checked=o.Configuration.EnableNextEpisodeAutoPlay||!1}),t("#selectSubtitlePlaybackMode",i).val(o.Configuration.SubtitleMode||"").trigger("change"),i.querySelector(".chkPlayDefaultAudioTrack").checked=o.Configuration.PlayDefaultAudioTrack||!1,i.querySelector(".chkEnableCinemaMode").checked=a.enableCinemaMode(),i.querySelector(".chkExternalVideoPlayer").checked=e.enableExternalPlayers(),require(["qualityoptions"],function(a){var n=a.getVideoQualityOptions(e.maxStreamingBitrate()).map(function(e){return'<option value="'+e.bitrate+'">'+e.name+"</option>"}).join("");n='<option value="">'+Globalize.translate("OptionAutomatic")+"</option>"+n,t("#selectMaxBitrate",i).html(n),t("#selectMaxChromecastBitrate",i).html(n),t("#selectMaxBitrate",i).val(e.enableAutomaticBitrateDetection()?"":e.maxStreamingBitrate()),t("#selectMaxChromecastBitrate",i).val(e.maxChromecastBitrate()),Dashboard.hideLoadingMsg()})}function o(e){Dashboard.showLoadingMsg();var a=getParameterByName("userId")||Dashboard.getCurrentUserId(),n=ApiClient.getUser(a),o=Dashboard.getCurrentUser(),r=ApiClient.getCultures();Promise.all([n,o]).then(function(a){i(e,a[1],a[0],r)}),ApiClient.getNamedConfiguration("cinemamode").then(function(a){a.EnableIntrosForMovies||a.EnableIntrosForEpisodes?t(".cinemaModeOptions",e).show():t(".cinemaModeOptions",e).hide()})}function r(e,n){return n.Configuration.AudioLanguagePreference=t("#selectAudioLanguage",e).val(),n.Configuration.SubtitleLanguagePreference=t("#selectSubtitleLanguage",e).val(),n.Configuration.SubtitleMode=t("#selectSubtitlePlaybackMode",e).val(),n.Configuration.PlayDefaultAudioTrack=e.querySelector(".chkPlayDefaultAudioTrack").checked,n.Configuration.EnableNextEpisodeAutoPlay=e.querySelector(".chkEpisodeAutoPlay").checked,a.enableCinemaMode(e.querySelector(".chkEnableCinemaMode").checked),ApiClient.updateUserConfiguration(n.Id,n.Configuration)}function l(a){e.enableExternalPlayers(a.querySelector(".chkExternalVideoPlayer").checked),t("#selectMaxBitrate",a).val()?(e.maxStreamingBitrate(t("#selectMaxBitrate",a).val()),e.enableAutomaticBitrateDetection(!1)):e.enableAutomaticBitrateDetection(!0),e.maxChromecastBitrate(t("#selectMaxChromecastBitrate",a).val());var n=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(n).then(function(e){r(a,e).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})}function u(){var e=t(this).parents(".page")[0];return l(e),!1}pageIdOn("pageinit","languagePreferencesPage",function(){var e=this;t("#selectSubtitlePlaybackMode",e).on("change",function(){t(".subtitlesHelp",e).hide(),t(".subtitles"+this.value+"Help",e).show()}),t(".languagePreferencesForm").off("submit",u).on("submit",u),AppInfo.enableAutoSave?e.querySelector(".btnSave").classList.add("hide"):e.querySelector(".btnSave").classList.remove("hide")}),pageIdOn("pageshow","languagePreferencesPage",function(){var e=this;AppInfo.supportsExternalPlayers?t(".fldExternalPlayer",e).show():t(".fldExternalPlayer",e).hide(),AppInfo.supportsExternalPlayerMenu?(t(".labelNativeExternalPlayers",e).show(),t(".labelGenericExternalPlayers",e).hide()):(t(".labelGenericExternalPlayers",e).show(),t(".labelNativeExternalPlayers",e).hide()),o(e)}),pageIdOn("pagebeforehide","languagePreferencesPage",function(){var e=this;AppInfo.enableAutoSave&&l(e)})});