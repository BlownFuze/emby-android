define(["libraryBrowser","components/categorysyncbuttons","scrollStyles","emby-itemscontainer"],function(e,t){function a(){return"Poster"}function r(){return"Thumb"}function n(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function i(){return n()?"overflowPortrait":"portrait"}function o(){return n()?"overflowBackdrop":"backdrop"}function s(t,r,n){var o={IncludeItemTypes:"Movie",Limit:18,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",ParentId:n,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getJSON(ApiClient.getUrl("Users/"+r+"/Items/Latest",o)).then(function(r){var n=a(),o="";"PosterCard"==n?o+=e.getPosterViewHtml({items:r,lazy:!0,shape:i(),overlayText:!1,showTitle:!0,showYear:!0,cardLayout:!0,showDetailsMenu:!0}):"Poster"==n&&(o+=e.getPosterViewHtml({items:r,shape:i(),centerText:!0,lazy:!0,overlayText:!1,showDetailsMenu:!0,overlayPlayButton:!0}));var s=t.querySelector("#recentlyAddedItems");s.innerHTML=o,ImageLoader.lazyChildren(s)})}function l(t,a,n){var i=window.innerWidth,s={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Movie",Filters:"IsResumable",Limit:i>=1920?5:i>=1600?4:3,Recursive:!0,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",CollapseBoxSetItems:!1,ParentId:n,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(a,s).then(function(a){a.Items.length?t.querySelector("#resumableSection").classList.remove("hide"):t.querySelector("#resumableSection").classList.add("hide");var n=r(),i="";"ThumbCard"==n?i+=e.getPosterViewHtml({items:a.Items,preferThumb:!0,shape:o(),showTitle:!0,showYear:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0}):"Thumb"==n&&(i+=e.getPosterViewHtml({items:a.Items,preferThumb:!0,shape:o(),overlayText:!0,showTitle:!1,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}));var s=t.querySelector("#resumableItems");s.innerHTML=i,ImageLoader.lazyChildren(s)})}function c(t){var r="",o="";switch(t.RecommendationType){case"SimilarToRecentlyPlayed":o=Globalize.translate("RecommendationBecauseYouWatched").replace("{0}",t.BaselineItemName);break;case"SimilarToLikedItem":o=Globalize.translate("RecommendationBecauseYouLike").replace("{0}",t.BaselineItemName);break;case"HasDirectorFromRecentlyPlayed":case"HasLikedDirector":o=Globalize.translate("RecommendationDirectedBy").replace("{0}",t.BaselineItemName);break;case"HasActorFromRecentlyPlayed":case"HasLikedActor":o=Globalize.translate("RecommendationStarring").replace("{0}",t.BaselineItemName)}r+='<div class="homePageSection">',r+='<h1 class="listHeader">'+o+"</h1>",r+=n()?'<div is="emby-itemscontainer" class="hiddenScrollX">':'<div is="emby-itemscontainer">';var s=a();return"PosterCard"==s?r+=e.getPosterViewHtml({items:t.Items,lazy:!0,shape:i(),overlayText:!1,showTitle:!0,showYear:!0,cardLayout:!0,showDetailsMenu:!0}):"Poster"==s&&(r+=e.getPosterViewHtml({items:t.Items,shape:i(),centerText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0})),r+="</div>",r+="</div>"}function d(e,t){var a=window.innerWidth,r=ApiClient.getUrl("Movies/Recommendations",{userId:t,categoryLimit:6,ItemLimit:a>=1920?8:a>=1600?8:a>=1200?6:5,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"});ApiClient.getJSON(r).then(function(t){if(!t.length)return e.querySelector(".noItemsMessage").classList.remove("hide"),void(e.querySelector(".recommendations").innerHTML="");var a=t.map(c).join("");e.querySelector(".noItemsMessage").classList.add("hide");var r=e.querySelector(".recommendations");r.innerHTML=a,ImageLoader.lazyChildren(r)})}function m(e,t){for(var a=t.querySelectorAll(".itemsContainer"),r=0,i=a.length;i>r;r++)n()?a[r].classList.add("hiddenScrollX"):a[r].classList.remove("hiddenScrollX")}function u(e,t,a){var r=t.topParentId,n=Dashboard.getCurrentUserId();l(a,n,r),s(a,n,r),AppInfo.enableMovieHomeSuggestions&&d(a,n,r)}return function(a,r){function n(e,t,n){var i=[];switch(t){case 0:break;case 1:i.push("scripts/movies");break;case 2:i.push("scripts/movietrailers");break;case 3:i.push("scripts/moviecollections");break;case 4:i.push("scripts/moviegenres");break;case 5:i.push("scripts/moviestudios")}require(i,function(e){var i;0==t&&(i=a.querySelector(".pageTabContent[data-index='"+t+"']"),l.tabContent=i);var o=b[t];o||(i=a.querySelector(".pageTabContent[data-index='"+t+"']"),o=t?new e(a,r,i):l,b[t]=o,o.initTab&&o.initTab()),n(o)})}function i(e,t){n(e,t,function(e){-1==p.indexOf(t)&&e.preRender&&e.preRender()})}function o(e,t){n(e,t,function(e){-1==p.indexOf(t)&&(p.push(t),e.renderTab())})}function s(t,a){a.NowPlayingItem&&"Video"==a.NowPlayingItem.MediaType&&(p=[],c.dispatchEvent(new CustomEvent("tabchange",{detail:{selectedTabIndex:e.selectedTab(c)}})))}var l=this;l.initTab=function(){var e=a.querySelector(".pageTabContent[data-index='0']");t.init(e),m(a,e)},l.renderTab=function(){var e=a.querySelector(".pageTabContent[data-index='0']");u(a,r,e)};var c=a.querySelector(".libraryViewNav"),d="movies.html",y=r.topParentId;y&&(d+="?topParentId="+y),e.configurePaperLibraryTabs(a,c,a.querySelectorAll(".pageTabContent"),[0,3,4,5]);var b=[],p=[];c.addEventListener("beforetabchange",function(e){i(a,parseInt(e.detail.selectedTabIndex))}),c.addEventListener("tabchange",function(e){o(a,parseInt(e.detail.selectedTabIndex))}),a.addEventListener("viewbeforeshow",function(){if(!a.getAttribute("data-title")){var e=r.topParentId;e?ApiClient.getItem(Dashboard.getCurrentUserId(),e).then(function(e){a.setAttribute("data-title",e.Name),LibraryMenu.setTitle(e.Name)}):(a.setAttribute("data-title",Globalize.translate("TabMovies")),LibraryMenu.setTitle(Globalize.translate("TabMovies")))}}),a.addEventListener("viewshow",function(){Events.on(MediaController,"playbackstop",s)}),a.addEventListener("viewbeforehide",function(){Events.off(MediaController,"playbackstop",s)})}});