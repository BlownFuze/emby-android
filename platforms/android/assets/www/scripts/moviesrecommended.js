define(["libraryBrowser","scrollStyles"],function(e){function t(){return"Poster"}function a(){return"Thumb"}function r(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function n(){return r()?"overflowPortrait":"portrait"}function i(){return r()?"overflowBackdrop":"backdrop"}function o(a,r,i){var o={IncludeItemTypes:"Movie",Limit:18,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",ParentId:i,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getJSON(ApiClient.getUrl("Users/"+r+"/Items/Latest",o)).then(function(r){var i=t(),o="";"PosterCard"==i?o+=e.getPosterViewHtml({items:r,lazy:!0,shape:n(),overlayText:!1,showTitle:!0,showYear:!0,cardLayout:!0,showDetailsMenu:!0}):"Poster"==i&&(o+=e.getPosterViewHtml({items:r,shape:n(),centerText:!0,lazy:!0,overlayText:!1,showDetailsMenu:!0,overlayPlayButton:!0}));var s=a.querySelector("#recentlyAddedItems");s.innerHTML=o,ImageLoader.lazyChildren(s)})}function s(t,r,n){var o=window.innerWidth,s={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Movie",Filters:"IsResumable",Limit:o>=1920?5:o>=1600?4:3,Recursive:!0,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",CollapseBoxSetItems:!1,ParentId:n,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(r,s).then(function(r){r.Items.length?t.querySelector("#resumableSection").classList.remove("hide"):t.querySelector("#resumableSection").classList.add("hide");var n=a(),o="";"ThumbCard"==n?o+=e.getPosterViewHtml({items:r.Items,preferThumb:!0,shape:i(),showTitle:!0,showYear:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0}):"Thumb"==n&&(o+=e.getPosterViewHtml({items:r.Items,preferThumb:!0,shape:i(),overlayText:!0,showTitle:!1,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}));var s=t.querySelector("#resumableItems");s.innerHTML=o,ImageLoader.lazyChildren(s)})}function l(a){var i="",o="";switch(a.RecommendationType){case"SimilarToRecentlyPlayed":o=Globalize.translate("RecommendationBecauseYouWatched").replace("{0}",a.BaselineItemName);break;case"SimilarToLikedItem":o=Globalize.translate("RecommendationBecauseYouLike").replace("{0}",a.BaselineItemName);break;case"HasDirectorFromRecentlyPlayed":case"HasLikedDirector":o=Globalize.translate("RecommendationDirectedBy").replace("{0}",a.BaselineItemName);break;case"HasActorFromRecentlyPlayed":case"HasLikedActor":o=Globalize.translate("RecommendationStarring").replace("{0}",a.BaselineItemName)}i+='<div class="homePageSection">',i+='<h1 class="listHeader">'+o+"</h1>",i+=r()?'<div class="hiddenScrollX">':"<div>";var s=t();return"PosterCard"==s?i+=e.getPosterViewHtml({items:a.Items,lazy:!0,shape:n(),overlayText:!1,showTitle:!0,showYear:!0,cardLayout:!0,showDetailsMenu:!0}):"Poster"==s&&(i+=e.getPosterViewHtml({items:a.Items,shape:n(),centerText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0})),i+="</div>",i+="</div>"}function c(e,t){var a=window.innerWidth,r=ApiClient.getUrl("Movies/Recommendations",{userId:t,categoryLimit:6,ItemLimit:a>=1920?8:a>=1600?8:a>=1200?6:5,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"});ApiClient.getJSON(r).then(function(t){if(!t.length)return e.querySelector(".noItemsMessage").classList.remove("hide"),void(e.querySelector(".recommendations").innerHTML="");var a=t.map(l).join("");e.querySelector(".noItemsMessage").classList.add("hide");var r=e.querySelector(".recommendations");r.innerHTML=a,ImageLoader.lazyChildren(r)})}function d(t,a){for(var n=a.querySelectorAll(".itemsContainer"),i=0,o=n.length;o>i;i++)r()?n[i].classList.add("hiddenScrollX"):n[i].classList.remove("hiddenScrollX"),e.createCardMenus(n[i])}function m(e,t,a){var r=t.topParentId,n=Dashboard.getCurrentUserId();s(a,n,r),o(a,n,r),AppInfo.enableMovieHomeSuggestions&&c(a,n,r)}return function(t,a){function r(e,r,n){var i=[];switch(r){case 0:break;case 1:i.push("scripts/movies");break;case 2:i.push("scripts/movietrailers");break;case 3:i.push("scripts/moviecollections");break;case 4:i.push("scripts/moviegenres");break;case 5:i.push("scripts/moviestudios")}require(i,function(e){var i;0==r&&(i=t.querySelector(".pageTabContent[data-index='"+r+"']"),s.tabContent=i);var o=y[r];o||(i=t.querySelector(".pageTabContent[data-index='"+r+"']"),o=r?new e(t,a,i):s,y[r]=o,o.initTab&&o.initTab()),n(o)})}function n(e,t){r(e,t,function(e){-1==p.indexOf(t)&&e.preRender&&e.preRender()})}function i(e,t){r(e,t,function(e){-1==p.indexOf(t)&&(p.push(t),e.renderTab())})}function o(t,a){a.NowPlayingItem&&"Video"==a.NowPlayingItem.MediaType&&(p=[],l.dispatchEvent(new CustomEvent("tabchange",{detail:{selectedTabIndex:e.selectedTab(l)}})))}var s=this;s.initTab=function(){var e=t.querySelector(".pageTabContent[data-index='0']");d(t,e)},s.renderTab=function(){var e=t.querySelector(".pageTabContent[data-index='0']");m(t,a,e)},e.createCardMenus(t.querySelector(".recommendations"));var l=t.querySelector(".libraryViewNav"),c="movies.html",u=a.topParentId;u&&(c+="?topParentId="+u),e.configurePaperLibraryTabs(t,l,t.querySelectorAll(".pageTabContent"),[0,3,4,5]);var y=[],p=[];l.addEventListener("beforetabchange",function(e){n(t,parseInt(e.detail.selectedTabIndex))}),l.addEventListener("tabchange",function(e){i(t,parseInt(e.detail.selectedTabIndex))}),t.addEventListener("viewbeforeshow",function(){if(!t.getAttribute("data-title")){var e=a.topParentId;e?ApiClient.getItem(Dashboard.getCurrentUserId(),e).then(function(e){t.setAttribute("data-title",e.Name),LibraryMenu.setTitle(e.Name)}):(t.setAttribute("data-title",Globalize.translate("TabMovies")),LibraryMenu.setTitle(Globalize.translate("TabMovies")))}}),t.addEventListener("viewshow",function(){Events.on(MediaController,"playbackstop",o)}),t.addEventListener("viewbeforehide",function(){Events.off(MediaController,"playbackstop",o)})}});