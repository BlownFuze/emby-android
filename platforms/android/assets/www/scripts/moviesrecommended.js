define(["jQuery"],function(e){function t(){return"Poster"}function a(){return"Thumb"}function r(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function i(){return r()?"overflowPortrait":"portrait"}function n(){return r()?"overflowBackdrop":"backdrop"}function o(e,a,r){var n=18,o={IncludeItemTypes:"Movie",Limit:n,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",ParentId:r,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getJSON(ApiClient.getUrl("Users/"+a+"/Items/Latest",o)).then(function(a){var r=t(),n="";"PosterCard"==r?n+=LibraryBrowser.getPosterViewHtml({items:a,lazy:!0,shape:i(),overlayText:!1,showTitle:!0,showYear:!0,cardLayout:!0,showDetailsMenu:!0}):"Poster"==r&&(n+=LibraryBrowser.getPosterViewHtml({items:a,shape:i(),centerText:!0,lazy:!0,overlayText:!1,showDetailsMenu:!0,overlayPlayButton:!0}));var o=e.querySelector("#recentlyAddedItems");o.innerHTML=n,ImageLoader.lazyChildren(o),LibraryBrowser.setLastRefreshed(e)})}function s(t,r,i){var o=e(window).width(),s={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Movie",Filters:"IsResumable",Limit:o>=1920?6:o>=1600?4:3,Recursive:!0,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",CollapseBoxSetItems:!1,ParentId:i,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"};ApiClient.getItems(r,s).then(function(r){r.Items.length?e("#resumableSection",t).show():e("#resumableSection",t).hide();var i=a(),o="";"ThumbCard"==i?o+=LibraryBrowser.getPosterViewHtml({items:r.Items,preferThumb:!0,shape:n(),showTitle:!0,showYear:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0}):"Thumb"==i&&(o+=LibraryBrowser.getPosterViewHtml({items:r.Items,preferThumb:!0,shape:n(),overlayText:!0,showTitle:!1,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}));var s=t.querySelector("#resumableItems");s.innerHTML=o,ImageLoader.lazyChildren(s)})}function l(e){var a="",n="";switch(e.RecommendationType){case"SimilarToRecentlyPlayed":n=Globalize.translate("RecommendationBecauseYouWatched").replace("{0}",e.BaselineItemName);break;case"SimilarToLikedItem":n=Globalize.translate("RecommendationBecauseYouLike").replace("{0}",e.BaselineItemName);break;case"HasDirectorFromRecentlyPlayed":case"HasLikedDirector":n=Globalize.translate("RecommendationDirectedBy").replace("{0}",e.BaselineItemName);break;case"HasActorFromRecentlyPlayed":case"HasLikedActor":n=Globalize.translate("RecommendationStarring").replace("{0}",e.BaselineItemName)}a+='<div class="homePageSection">',a+='<h1 class="listHeader">'+n+"</h1>",a+=r()?'<div class="hiddenScrollX">':"<div>";var o=t();return"PosterCard"==o?a+=LibraryBrowser.getPosterViewHtml({items:e.Items,lazy:!0,shape:i(),overlayText:!1,showTitle:!0,showYear:!0,cardLayout:!0,showDetailsMenu:!0}):"Poster"==o&&(a+=LibraryBrowser.getPosterViewHtml({items:e.Items,shape:i(),centerText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0})),a+="</div>",a+="</div>"}function c(t,a){var r=e(window).width(),i=ApiClient.getUrl("Movies/Recommendations",{userId:a,categoryLimit:r>=1200?4:3,ItemLimit:r>=1920?9:r>=1600?8:r>=1200?7:6,Fields:"PrimaryImageAspectRatio,MediaSourceCount,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"});ApiClient.getJSON(i).then(function(a){if(!a.length)return e(".noItemsMessage",t).show(),void(t.querySelector(".recommendations").innerHTML="");var r=a.map(l).join("");e(".noItemsMessage",t).hide();var i=t.querySelector(".recommendations");i.innerHTML=r,ImageLoader.lazyChildren(i)})}function d(t,a){var i=a.querySelectorAll(".itemsContainer");r()?e(i).addClass("hiddenScrollX"):e(i).removeClass("hiddenScrollX"),e(i).createCardMenus()}function m(e,t){var a=LibraryMenu.getTopParentId(),r=Dashboard.getCurrentUserId();LibraryBrowser.needsRefresh(t)&&(s(t,r,a),o(t,r,a),AppInfo.enableMovieHomeSuggestions&&c(t,r,a))}function u(e,t){var a=e.querySelector(".pageTabContent[data-index='"+t+"']"),r=[],i="MoviesPage",n="",o="";switch(t){case 0:o="initSuggestedTab",n="renderSuggestedTab";break;case 1:r.push("scripts/movies"),n="renderMoviesTab",o="initMoviesTab";break;case 2:r.push("scripts/movietrailers"),n="renderTrailerTab",o="initTrailerTab";break;case 3:r.push("scripts/moviecollections"),n="renderCollectionsTab",o="initCollectionsTab";break;case 4:r.push("scripts/moviegenres"),n="renderGenresTab";break;case 5:r.push("scripts/moviestudios"),n="renderStudiosTab"}require(r,function(){o&&!a.initComplete&&(window[i][o](e,a),a.initComplete=!0),window[i][n](e,a)})}function y(t,a){if(a.NowPlayingItem&&"Video"==a.NowPlayingItem.MediaType){var r=e(e.mobile.activePage)[0],i=r.querySelector("neon-animated-pages");i.dispatchEvent(new CustomEvent("tabchange",{}))}}window.MoviesPage=window.MoviesPage||{},window.MoviesPage.renderSuggestedTab=m,window.MoviesPage.initSuggestedTab=d,pageIdOn("pageinit","moviesPage",function(){var t=this;e(".recommendations",t).createCardMenus();var a=t.querySelector("paper-tabs"),r=t.querySelector("neon-animated-pages"),i="movies.html",n=LibraryMenu.getTopParentId();n&&(i+="?topParentId="+n),LibraryBrowser.configurePaperLibraryTabs(t,a,r,i),r.addEventListener("tabchange",function(e){u(t,parseInt(e.target.selected))})}),pageIdOn("pagebeforeshow","moviesPage",function(){var e=this;if(!e.getAttribute("data-title")){var t=LibraryMenu.getTopParentId();t?ApiClient.getItem(Dashboard.getCurrentUserId(),t).then(function(t){e.setAttribute("data-title",t.Name),LibraryMenu.setTitle(t.Name)}):(e.setAttribute("data-title",Globalize.translate("TabMovies")),LibraryMenu.setTitle(Globalize.translate("TabMovies")))}Events.on(MediaController,"playbackstop",y)}),pageIdOn("pagebeforehide","moviesPage",function(){Events.off(MediaController,"playbackstop",y)})});