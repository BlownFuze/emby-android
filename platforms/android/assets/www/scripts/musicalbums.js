define(["jQuery","alphaPicker"],function(e,t){return function(r,a,i){function n(e){var t=s(e),r=d[t];return r||(r=d[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicAlbum",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",Limit:LibraryBrowser.getDefaultPageSize()},view:LibraryBrowser.getSavedView(t)||LibraryBrowser.getDefaultItemsView("Poster","Poster")},r.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(t,r.query)),r}function o(e){return n(e).query}function s(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("albums")),e.savedQueryKey}function l(t){Dashboard.showLoadingMsg();var r=o(t);ApiClient.getItems(Dashboard.getCurrentUserId(),r).then(function(a){window.scrollTo(0,0);var i="",c=n(t).view,d=LibraryBrowser.getQueryPagingHtml({startIndex:r.StartIndex,limit:r.Limit,totalRecordCount:a.TotalRecordCount,showLimit:!1,sortButton:!0,addLayoutButton:!0,currentLayout:c,updatePageSizeSetting:!1,layouts:"List,Poster,PosterCard,Timeline",filterButton:!0});t.querySelector(".listTopPaging").innerHTML=d,m(t),"Poster"==c?i=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"square",context:"music",showTitle:!0,showParentTitle:!0,lazy:!0,centerText:!0,overlayPlayButton:!0}):"PosterCard"==c?i=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"square",context:"music",showTitle:!0,coverImage:!0,showParentTitle:!0,lazy:!0,cardLayout:!0}):"List"==c?i=LibraryBrowser.getListViewHtml({items:a.Items,context:"music",sortBy:r.SortBy}):"Timeline"==c&&(i=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"square",context:"music",showTitle:!0,showParentTitle:!0,timeline:!0,lazy:!0}));var y=t.querySelector("#items");y.innerHTML=i+d,ImageLoader.lazyChildren(y),e(".btnNextPage",t).on("click",function(){r.StartIndex+=r.Limit,l(t)}),e(".btnPreviousPage",t).on("click",function(){r.StartIndex-=r.Limit,l(t)}),e(".btnFilter",t).on("click",function(){u(t)}),e(".btnChangeLayout",t).on("layoutchange",function(e,r){"Timeline"==r&&(o(t).SortBy="ProductionYear,PremiereDate,SortName",o(t).SortOrder="Descending"),n(t).view=r,LibraryBrowser.saveViewSetting(s(t),r),l(t)}),e(".btnSort",t).on("click",function(){LibraryBrowser.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionAlbumArtist"),id:"AlbumArtist,SortName"},{name:Globalize.translate("OptionCommunityRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionCriticRating"),id:"CriticRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"ProductionYear,PremiereDate,SortName"}],callback:function(){l(t)},query:r})}),LibraryBrowser.saveQueryValues(s(t),r),Dashboard.hideLoadingMsg()})}function u(e){require(["components/filterdialog/filterdialog"],function(t){var r=new t({query:o(e),mode:"albums"});Events.on(r,"filterchange",function(){l(e)}),r.show()})}function m(e){var t=o(e);c.alphaPicker.value(t.NameStartsWithOrGreater)}var c=this,d={},y=i.querySelector(".alphaPicker");y.addEventListener("alphavaluechanged",function(e){var t=e.detail.value,r=o(i);r.NameStartsWithOrGreater=t,r.StartIndex=0,l(i)}),c.alphaPicker=new t({element:y}),c.renderTab=function(){l(i)}}});