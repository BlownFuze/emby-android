define(["jQuery"],function(e){return function(t,r,a){function i(e){var t=o(e),r=c[t];return r||(r=c[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicAlbum",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",Limit:LibraryBrowser.getDefaultPageSize()},view:LibraryBrowser.getSavedView(t)||LibraryBrowser.getDefaultItemsView("Poster","Poster")},r.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(t,r.query)),r}function n(e){return i(e).query}function o(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("albums")),e.savedQueryKey}function s(t){Dashboard.showLoadingMsg();var r=n(t);ApiClient.getItems(Dashboard.getCurrentUserId(),r).then(function(a){window.scrollTo(0,0);var m="",c=i(t).view,y=LibraryBrowser.getQueryPagingHtml({startIndex:r.StartIndex,limit:r.Limit,totalRecordCount:a.TotalRecordCount,showLimit:!1,sortButton:!0,addLayoutButton:!0,currentLayout:c,updatePageSizeSetting:!1,layouts:"List,Poster,PosterCard,Timeline",filterButton:!0});t.querySelector(".listTopPaging").innerHTML=y,u(t),"Poster"==c?m=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"square",context:"music",showTitle:!0,showParentTitle:!0,lazy:!0,centerText:!0,overlayPlayButton:!0}):"PosterCard"==c?m=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"square",context:"music",showTitle:!0,coverImage:!0,showParentTitle:!0,lazy:!0,cardLayout:!0}):"List"==c?m=LibraryBrowser.getListViewHtml({items:a.Items,context:"music",sortBy:r.SortBy}):"Timeline"==c&&(m=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"square",context:"music",showTitle:!0,showParentTitle:!0,timeline:!0,lazy:!0}));var d=t.querySelector("#items");d.innerHTML=m+y,ImageLoader.lazyChildren(d),e(".btnNextPage",t).on("click",function(){r.StartIndex+=r.Limit,s(t)}),e(".btnPreviousPage",t).on("click",function(){r.StartIndex-=r.Limit,s(t)}),e(".btnFilter",t).on("click",function(){l(t)}),e(".btnChangeLayout",t).on("layoutchange",function(e,r){"Timeline"==r&&(n(t).SortBy="ProductionYear,PremiereDate,SortName",n(t).SortOrder="Descending"),i(t).view=r,LibraryBrowser.saveViewSetting(o(t),r),s(t)}),e(".btnSort",t).on("click",function(){LibraryBrowser.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionAlbumArtist"),id:"AlbumArtist,SortName"},{name:Globalize.translate("OptionCommunityRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionCriticRating"),id:"CriticRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"ProductionYear,PremiereDate,SortName"}],callback:function(){s(t)},query:r})}),LibraryBrowser.saveQueryValues(o(t),r),Dashboard.hideLoadingMsg()})}function l(e){require(["components/filterdialog/filterdialog"],function(t){var r=new t({query:n(e),mode:"albums"});Events.on(r,"filterchange",function(){s(e)}),r.show()})}function u(t){var r=n(t);e(".alphabetPicker",t).alphaValue(r.NameStartsWithOrGreater)}var m=this,c={};e(".alphabetPicker",a).on("alphaselect",function(e,t){var r=n(a);-1==r.SortBy.indexOf("AlbumArtist")?(r.NameStartsWithOrGreater=t,r.AlbumArtistStartsWithOrGreater=""):(r.AlbumArtistStartsWithOrGreater=t,r.NameStartsWithOrGreater=""),r.StartIndex=0,s(a)}).on("alphaclear",function(){var e=n(a);e.NameStartsWithOrGreater="",e.AlbumArtistStartsWithOrGreater="",s(a)}),m.renderTab=function(){s(a)}}});