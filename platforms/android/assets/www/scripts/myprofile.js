!function(e,a,t,r){function o(a){var t=getParameterByName("userId");Dashboard.showLoadingMsg(),ApiClient.getUser(t).then(function(t){e(".username",a).html(t.Name),Events.trigger(e("#uploadUserImage",a).val("")[0],"change"),Dashboard.setPageTitle(t.Name);var r;r=t.PrimaryImageTag?ApiClient.getUserImageUrl(t.Id,{height:200,tag:t.PrimaryImageTag,type:"Primary"}):"css/images/logindefault.png",e("#fldImage",a).show().html("").html("<img width='140px' src='"+r+"' />");var o=!1;"Guest"==t.ConnectLinkType?(e("#btnDeleteImage",a).hide(),e(".connectMessage",a).show()):t.PrimaryImageTag?(e("#btnDeleteImage",a).show(),e("#headerUploadNewImage",a).show(),o=!0,e(".connectMessage",a).hide()):(o=!0,e("#btnDeleteImage",a).hide(),e("#headerUploadNewImage",a).show(),e(".connectMessage",a).hide()),o&&AppInfo.supportsFileInput?e(".newImageForm",a).show():e(".newImageForm",a).hide(),Dashboard.hideLoadingMsg()})}function s(){Dashboard.hideLoadingMsg();var a=e(e.mobile.activePage)[0];o(a)}function n(e){switch(Dashboard.hideLoadingMsg(),e.target.error.code){case e.target.error.NOT_FOUND_ERR:Dashboard.alert(Globalize.translate("FileNotFound"));break;case e.target.error.NOT_READABLE_ERR:Dashboard.alert(Globalize.translate("FileReadError"));break;case e.target.error.ABORT_ERR:break;default:Dashboard.alert(Globalize.translate("FileReadError"))}}function i(){e("#fldUpload",e.mobile.activePage).hide()}function d(){Dashboard.hideLoadingMsg(),Dashboard.alert(Globalize.translate("FileReadCancelled"))}function l(a,t){var o=t[0];if(!o||!o.type.match("image.*"))return e("#userImageOutput",a).html(""),e("#fldUpload",a).hide(),void(m=null);m=o;var s=new r;s.onerror=n,s.onloadstart=i,s.onabort=d,s.onload=function(t){var r=['<img style="max-width:500px;max-height:200px;" src="',t.target.result,'" title="',escape(o.name),'"/>'].join("");e("#userImageOutput",a).html(r),e("#fldUpload",a).show()},s.readAsDataURL(o)}function g(a){return a.preventDefault(),l(e.mobile.activePage,a.originalEvent.dataTransfer.files),!1}function c(e){return e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="Copy",!1}function u(){var e=this;e.onImageSubmit=function(){var e=m;if(!e)return!1;if("image/png"!=e.type&&"image/jpeg"!=e.type&&"image/jpeg"!=e.type)return!1;Dashboard.showLoadingMsg();var a=getParameterByName("userId");return ApiClient.uploadUserImage(a,"Primary",e).then(s),!1}}var m;a.MyProfilePage=new u,e(t).on("pageinit","#userImagePage",function(){var a=this;o(a),e("#userImageDropZone",a).on("dragover",c).on("drop",g),e("#btnDeleteImage",a).on("click",function(){Dashboard.confirm(Globalize.translate("DeleteImageConfirmation"),Globalize.translate("DeleteImage"),function(e){if(e){Dashboard.showLoadingMsg();var a=getParameterByName("userId");ApiClient.deleteUserImage(a,"primary").then(s)}})}),e(".newImageForm").off("submit",MyProfilePage.onImageSubmit).on("submit",MyProfilePage.onImageSubmit),a.querySelector("#uploadUserImage").addEventListener("change",function(e){l(a,e.target.files)})})}(jQuery,window,document,window.FileReader),function(e,a,t){function r(a){var t=getParameterByName("userId");ApiClient.getUser(t).then(function(t){Dashboard.setPageTitle(t.Name),"Guest"==t.ConnectLinkType?(e(".localAccessSection",a).hide(),e(".passwordSection",a).hide()):t.HasConfiguredPassword?(e("#btnResetPassword",a).show(),e("#fldCurrentPassword",a).show(),e(".localAccessSection",a).show(),e(".passwordSection",a).show()):(e("#btnResetPassword",a).hide(),e("#fldCurrentPassword",a).hide(),e(".localAccessSection",a).hide(),e(".passwordSection",a).show()),t.HasConfiguredEasyPassword?(e("#txtEasyPassword",a).val("").attr("placeholder","******"),e("#btnResetEasyPassword",a).removeClass("hide")):(e("#txtEasyPassword",a).val("").attr("placeholder",""),e("#btnResetEasyPassword",a).addClass("hide")),a.querySelector(".chkEnableLocalEasyPassword").checked=t.Configuration.EnableLocalPassword}),e("#txtCurrentPassword",a).val(""),e("#txtNewPassword",a).val(""),e("#txtNewPasswordConfirm",a).val("")}function o(a){var t=getParameterByName("userId"),r=e("#txtEasyPassword",a).val();r?ApiClient.updateEasyPassword(t,r).then(function(){s(a,t)}):s(a,t)}function s(e,a){ApiClient.getUser(a).then(function(a){a.Configuration.EnableLocalPassword=e.querySelector(".chkEnableLocalEasyPassword").checked,ApiClient.updateUserConfiguration(a.Id,a.Configuration).then(function(){Dashboard.hideLoadingMsg(),Dashboard.alert(Globalize.translate("MessageSettingsSaved")),r(e)})})}function n(a){var t=getParameterByName("userId"),o=e("#txtCurrentPassword",a).val(),s=e("#txtNewPassword",a).val();ApiClient.updateUserPassword(t,o,s).then(function(){Dashboard.hideLoadingMsg(),Dashboard.alert(Globalize.translate("PasswordSaved")),r(a)})}function i(){var a=this;a.onSubmit=function(){var a=e(e.mobile.activePage)[0];return e("#txtNewPassword",a).val()!=e("#txtNewPasswordConfirm",a).val()?Dashboard.alert(Globalize.translate("PasswordMatchError")):(Dashboard.showLoadingMsg(),n(a)),!1},a.onLocalAccessSubmit=function(){var a=e(e.mobile.activePage)[0];return Dashboard.showLoadingMsg(),o(a),!1},a.resetPassword=function(){var a=Globalize.translate("PasswordResetConfirmation"),t=e(e.mobile.activePage)[0];Dashboard.confirm(a,Globalize.translate("PasswordResetHeader"),function(e){if(e){var a=getParameterByName("userId");Dashboard.showLoadingMsg(),ApiClient.resetUserPassword(a).then(function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("PasswordResetComplete"),title:Globalize.translate("PasswordResetHeader")}),r(t)})}})},a.resetEasyPassword=function(){var a=Globalize.translate("PinCodeResetConfirmation"),t=e(e.mobile.activePage)[0];Dashboard.confirm(a,Globalize.translate("HeaderPinCodeReset"),function(e){if(e){var a=getParameterByName("userId");Dashboard.showLoadingMsg(),ApiClient.resetEasyPassword(a).then(function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("PinCodeResetComplete"),title:Globalize.translate("HeaderPinCodeReset")}),r(t)})}})}}t.UpdatePasswordPage=new i,e(a).on("pageinit",".userPasswordPage",function(){e(".updatePasswordForm").off("submit",UpdatePasswordPage.onSubmit).on("submit",UpdatePasswordPage.onSubmit),e(".localAccessForm").off("submit",UpdatePasswordPage.onLocalAccessSubmit).on("submit",UpdatePasswordPage.onLocalAccessSubmit)}).on("pageshow",".userPasswordPage",function(){var e=this;r(e)})}(jQuery,document,window);