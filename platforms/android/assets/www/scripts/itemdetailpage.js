define(["layoutManager","datetime","mediaInfo","backdrop","scrollStyles"],function(e,t,a,r){function i(e){var t=e.id;if(t)return ApiClient.getItem(Dashboard.getCurrentUserId(),t);var a=e.genre;if(a)return ApiClient.getGenre(a,Dashboard.getCurrentUserId());if(a=e.musicgenre)return ApiClient.getMusicGenre(a,Dashboard.getCurrentUserId());if(a=e.gamegenre)return ApiClient.getGameGenre(a,Dashboard.getCurrentUserId());if(a=e.musicartist)return ApiClient.getArtist(a,Dashboard.getCurrentUserId());throw new Error("Invalid request")}function s(e,t){Dashboard.showLoadingMsg(),i(t).then(function(a){l(e,t,a)})}function n(e,t,a){var r,i,s=e.querySelectorAll("."+t);for(r=0,i=s.length;i>r;r++)a?s[r].classList.remove("hide"):s[r].classList.add("hide")}function l(a,i,s){nt=s;var l=i.context;LibraryMenu.setBackButtonVisible(!0),LibraryMenu.setMenuButtonVisible(!1),LibraryBrowser.renderName(s,a.querySelector(".itemName"),!1,l),LibraryBrowser.renderParentName(s,a.querySelector(".parentName"),l),LibraryMenu.setTitle(s.SeriesName||s.Name),Dashboard.getCurrentUser().then(function(i){window.scrollTo(0,0),o(a,s,i),m(a,s,l,i),p(a,s,l);var d=!1;if("MusicArtist"!=s.Type&&"MusicAlbum"!=s.Type&&"Playlist"!=s.Type&&"BoxSet"!=s.Type&&"Audio"!=s.MediaType&&e.mobile)d=LibraryBrowser.renderDetailPageBackdrop(a,s),r.clear();else{var c=a.querySelector("#itemBackdrop");c.classList.add("noBackdrop"),c.style.backgroundImage="none",r.setBackdrops([s])}var u=d&&a.classList.contains("noSecondaryNavPage");LibraryMenu.setTransparentMenu(u);var h=!1;if("Program"==s.Type){var y=new Date;y>=t.parseISO8601Date(s.StartDate,!0)&&y<t.parseISO8601Date(s.EndDate,!0)?(n(a,"btnPlay",!0),h=!0):n(a,"btnPlay")}else MediaController.canPlay(s)?(n(a,"btnPlay",!0),h=!0):n(a,"btnPlay");s.LocalTrailerCount&&"Full"==s.PlayAccess?n(a,"btnPlayTrailer",!0):n(a,"btnPlayTrailer"),LibraryBrowser.enableSync(s,i)?n(a,"btnSync",!0):n(a,"btnSync"),"Program"==s.Type&&s.TimerId?n(a,"btnCancelRecording",!0):n(a,"btnCancelRecording"),"Program"!=s.Type||s.TimerId||s.SeriesTimerId?(n(a,"btnRecord"),n(a,"btnFloatingRecord")):h?(n(a,"btnRecord",!0),n(a,"btnFloatingRecord")):(n(a,"btnRecord"),n(a,"btnFloatingRecord",!0));for(var v=a.querySelectorAll(".btnPlayExternalTrailer"),g=0,b=v.length;b>g;g++)!s.LocalTrailerCount&&s.RemoteTrailers.length&&"Full"==s.PlayAccess?(v[g].classList.remove("hide"),v[g].href=s.RemoteTrailers[0].Url):(v[g].classList.add("hide"),v[g].href="#");var f=(s.MediaSources||[]).filter(function(e){return"Grouping"==e.Type});i.Policy.IsAdministrator&&f.length?a.querySelector(".splitVersionContainer").classList.remove("hide"):a.querySelector(".splitVersionContainer").classList.add("hide"),LibraryBrowser.getMoreCommands(s,i).length>0?n(a,"btnMoreCommands",!0):n(a,"btnMoreCommands"),i.Policy.IsAdministrator?a.querySelector(".chapterSettingsButton").classList.remove("hide"):a.querySelector(".chapterSettingsButton").classList.add("hide");var I=a.querySelector("#itemBirthday");if("Person"==s.Type&&s.PremiereDate)try{var S=t.parseISO8601Date(s.PremiereDate,!0).toDateString();I.classList.remove("hide"),I.innerHTML=Globalize.translate("BirthDateValue").replace("{0}",S)}catch(L){I.classList.add("hide")}else I.classList.add("hide");var T=a.querySelector("#itemBirthday");if("Person"==s.Type&&s.EndDate)try{var C=t.parseISO8601Date(s.EndDate,!0).toDateString();T.classList.remove("hide"),T.innerHTML=Globalize.translate("DeathDateValue").replace("{0}",C)}catch(L){T.classList.add("hide")}var M=a.querySelector("#itemBirthLocation");if("Person"==s.Type&&s.ProductionLocations&&s.ProductionLocations.length){var A='<a class="textlink" target="_blank" href="https://maps.google.com/maps?q='+s.ProductionLocations[0]+'">'+s.ProductionLocations[0]+"</a>";M.classList.remove("hide"),M.innerHTML=Globalize.translate("BirthPlaceValue").replace("{0}",A)}else M.classList.add("hide")});var d=!1;if("Virtual"==s.LocationType&&"Episode"==s.Type)try{s.PremiereDate&&(new Date).getTime()>=t.parseISO8601Date(s.PremiereDate,!0).getTime()&&(d=!0)}catch(u){}c(a,s),a.dispatchEvent(new CustomEvent("displayingitem",{detail:{item:s,context:l},bubbles:!0})),Dashboard.hideLoadingMsg()}function o(e,t,a){LibraryBrowser.renderDetailImage(e.querySelector(".detailImageContainer"),t,a.Policy.IsAdministrator&&"Photo"!=t.MediaType)}function d(e,t){LibraryBrowser.refreshDetailImageUserData(e.querySelector(".detailImageContainer"),t)}function c(e,t){e.querySelector("#peopleHeader").innerHTML=Globalize.translate("Audio"==t.MediaType||"MusicAlbum"==t.Type||"Book"==t.MediaType||"Photo"==t.MediaType?"HeaderPeople":"HeaderCastAndCrew")}function u(e,t,a){var r=e.querySelector(".nextUpSection");return"Series"!=t.Type?void r.classList.add("hide"):void ApiClient.getNextUpEpisodes({SeriesId:t.Id,UserId:a.Id}).then(function(e){e.Items.length?r.classList.remove("hide"):r.classList.add("hide");var a=LibraryBrowser.getPosterViewHtml({items:e.Items,shape:"detailPage169",showTitle:!0,displayAsSpecial:"Season"==t.Type&&t.IndexNumber,overlayText:!0,lazy:!0,overlayPlayButton:!0}),i=r.querySelector(".nextUpItems");i.innerHTML=a,ImageLoader.lazyChildren(i),LibraryBrowser.createCardMenus(i)})}function m(e,t,a,r){e.querySelector(".collectionItems").innerHTML="","TvChannel"==t.Type?(e.querySelector("#childrenCollapsible").classList.remove("hide"),D(e,t,r)):"Playlist"==t.Type?(e.querySelector("#childrenCollapsible").classList.remove("hide"),q(e,t,r)):"Studio"==t.Type||"Person"==t.Type||"Genre"==t.Type||"MusicGenre"==t.Type||"GameGenre"==t.Type||"MusicArtist"==t.Type?(e.querySelector("#childrenCollapsible").classList.remove("hide"),w(e,t,r)):t.IsFolder?("BoxSet"==t.Type?e.querySelector("#childrenCollapsible").classList.add("hide"):e.querySelector("#childrenCollapsible").classList.remove("hide"),P(e,t)):e.querySelector("#childrenCollapsible").classList.add("hide"),"Series"==t.Type?u(e,t,r):e.querySelector(".nextUpSection").classList.add("hide"),t.MediaSources&&t.MediaSources.length&&O(e,t);var i=t.Chapters||[];i.length&&AppInfo.enableDetailPageChapters?(e.querySelector("#scenesCollapsible").classList.remove("hide"),N(e,t,r,3)):e.querySelector("#scenesCollapsible").classList.add("hide"),t.SpecialFeatureCount&&0!=t.SpecialFeatureCount&&"Series"!=t.Type?(e.querySelector("#specialsCollapsible").classList.remove("hide"),Y(e,t,r,6)):e.querySelector("#specialsCollapsible").classList.add("hide"),t.People&&t.People.length?(e.querySelector("#castCollapsible").classList.remove("hide"),_(e,t,a,b()?null:6)):e.querySelector("#castCollapsible").classList.add("hide"),t.PartCount&&t.PartCount>1?(e.querySelector("#additionalPartsCollapsible").classList.remove("hide"),U(e,t,r)):e.querySelector("#additionalPartsCollapsible").classList.add("hide"),e.querySelector("#themeSongsCollapsible").classList.add("hide"),e.querySelector("#themeVideosCollapsible").classList.add("hide"),"MusicAlbum"==t.Type?E(e,t,r):e.querySelector("#musicVideosCollapsible").classList.add("hide"),H(e,t,r),b()?R(e,t):R(e,t,1)}function p(e,t,r,i){L(e,t,r),i||g(e,t,r);var s=e.querySelector(".tagline");t.Taglines&&t.Taglines.length?(s.classList.remove("hide"),s.innerHTML=t.Taglines[0]):s.classList.add("hide");var n=e.querySelector(".topOverview"),l=e.querySelector(".bottomOverview"),o=screen.availHeight<800||screen.availWidth<600;"MusicAlbum"==t.Type||"MusicArtist"==t.Type||"Season"==t.Type&&o?(LibraryBrowser.renderOverview([l],t),n.classList.add("hide"),l.classList.remove("hide")):(LibraryBrowser.renderOverview([n],t),n.classList.remove("hide"),l.classList.add("hide")),LibraryBrowser.renderAwardSummary(e.querySelector("#awardSummary"),t);var d,c,u=e.querySelectorAll(".itemMiscInfo");for(d=0,c=u.length;c>d;d++)a.fillPrimaryMediaInfo(u[d],t,{interactive:!0});var m=e.querySelectorAll(".itemGenres");for(d=0,c=m.length;c>d;d++)LibraryBrowser.renderGenres(m[d],t,null,i);LibraryBrowser.renderStudios(e.querySelector(".itemStudios"),t,i),x(e,t),LibraryBrowser.renderLinks(e.querySelector(".itemExternalLinks"),t),e.querySelector(".criticRatingScore").innerHTML=(t.CriticRating||"0")+"%",t.CriticRatingSummary?(e.querySelector("#criticRatingSummary").classList.remove("hide"),e.querySelector(".criticRatingSummaryText").innerHTML=t.CriticRatingSummary):e.querySelector("#criticRatingSummary").classList.add("hide"),C(e,t),T(e,t,i);var p=e.querySelector("#players");t.Players?(p.classList.remove("hide"),p.innerHTML=t.Players+" Player"):p.classList.add("hide");var b=e.querySelectorAll(".artist");for(d=0,c=b.length;c>d;d++)t.ArtistItems&&t.ArtistItems.length&&"MusicAlbum"!=t.Type?(b[d].classList.remove("hide"),b[d].innerHTML=v(t.ArtistItems,r)):b[d].classList.add("hide");t.MediaSources&&t.MediaSources.length&&t.Path?e.querySelector(".audioVideoMediaInfo").classList.remove("hide"):e.querySelector(".audioVideoMediaInfo").classList.add("hide"),"Photo"==t.MediaType?(e.querySelector(".photoInfo").classList.remove("hide"),h(e,t)):e.querySelector(".photoInfo").classList.add("hide"),y(e,t)}function h(e,t){var a="",r=[];if(t.CameraMake&&r.push(W(Globalize.translate("MediaInfoCameraMake"),t.CameraMake)),t.CameraModel&&r.push(W(Globalize.translate("MediaInfoCameraModel"),t.CameraModel)),t.Altitude&&r.push(W(Globalize.translate("MediaInfoAltitude"),t.Altitude.toFixed(1))),t.Aperture&&r.push(W(Globalize.translate("MediaInfoAperture"),"F"+t.Aperture.toFixed(1))),t.ExposureTime){var i=1/t.ExposureTime;r.push(W(Globalize.translate("MediaInfoExposureTime"),"1/"+i+" s"))}t.FocalLength&&r.push(W(Globalize.translate("MediaInfoFocalLength"),t.FocalLength.toFixed(1)+" mm")),t.ImageOrientation,t.IsoSpeedRating&&r.push(W(Globalize.translate("MediaInfoIsoSpeedRating"),t.IsoSpeedRating)),t.Latitude&&r.push(W(Globalize.translate("MediaInfoLatitude"),t.Latitude.toFixed(1))),t.Longitude&&r.push(W(Globalize.translate("MediaInfoLongitude"),t.Longitude.toFixed(1))),t.ShutterSpeed&&r.push(W(Globalize.translate("MediaInfoShutterSpeed"),t.ShutterSpeed)),t.Software&&r.push(W(Globalize.translate("MediaInfoSoftware"),t.Software)),a+=r.join("<br/>"),e.querySelector(".photoInfoContent").innerHTML=a}function y(e){var t=e.querySelector(".tabDetails"),a=t.textContent||t.innerText||"";a.trim()?e.querySelector(".detailsSection").classList.remove("hide"):e.querySelector(".detailsSection").classList.add("hide")}function v(e){for(var t=[],a=0,r=e.length;r>a;a++){var i=e[a];t.push('<a class="textlink" href="itemdetails.html?id='+i.Id+'">'+i.Name+"</a>")}return t=t.join(" / "),1==e.length?Globalize.translate("ValueArtist",t):e.length>1?Globalize.translate("ValueArtists",t):t}function g(e,t,a){var r=e.querySelector(".lnkPreviousItem"),i=e.querySelector(".lnkNextItem");if("Episode"!=t.Type&&"Season"!=t.Type&&"Audio"!=t.Type&&"Photo"!=t.Type)return i.classList.add("hide"),void r.classList.add("hide");var s;s="Season"==t.Type?ApiClient.getSeasons(t.SeriesId,{userId:Dashboard.getCurrentUserId(),AdjacentTo:t.Id}):"Episode"==t.Type&&t.SeasonId?ApiClient.getEpisodes(t.SeriesId,{seasonId:t.SeasonId,userId:Dashboard.getCurrentUserId(),AdjacentTo:t.Id}):ApiClient.getItems(Dashboard.getCurrentUserId(),{AdjacentTo:t.Id,ParentId:t.ParentId,SortBy:"SortName"}),a=a||"",s.then(function(e){for(var s=!1,n=0,l=e.Items.length;l>n;n++){var o=e.Items[n];o.Id==t.Id?s=!0:s?(i.classList.remove("hide"),i.href="itemdetails.html?id="+o.Id+"&context="+a):(r.classList.remove("hide"),r.href="itemdetails.html?id="+o.Id+"&context="+a)}})}function b(){return browserInfo.mobile&&AppInfo.enableAppLayouts&&screen.availWidth<=1e3}function f(){return b()?"overflowPortrait":"detailPagePortrait"}function I(){return b()?"overflowSquare":"detailPageSquare"}function S(){return b()?"overflowBackdrop":"detailPage169"}function L(e,t,a){var r=e.querySelector("#similarCollapsible");if(r){if("Movie"!=t.Type&&"Trailer"!=t.Type&&"Series"!=t.Type&&"Program"!=t.Type&&"Recording"!=t.Type&&"Game"!=t.Type&&"MusicAlbum"!=t.Type&&"MusicArtist"!=t.Type&&"ChannelVideoItem"!=t.Type)return void r.classList.add("hide");r.classList.remove("hide");var i="MusicAlbum"==t.Type||"MusicArtist"==t.Type?I():f(),s={userId:Dashboard.getCurrentUserId(),limit:8,fields:"PrimaryImageAspectRatio,UserData,SyncInfo,CanDelete"};b()&&(s.limit=12),ApiClient.getSimilarItems(t.Id,s).then(function(r){var s=e.querySelector("#similarCollapsible");if(!r.Items.length)return void s.classList.add("hide");s.classList.remove("hide"),s.querySelector(".similiarHeader").innerHTML=Globalize.translate("HeaderIfYouLikeCheckTheseOut",t.Name);var n="";n+=b()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">',n+=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:i,showParentTitle:"MusicAlbum"==t.Type,centerText:!0,showTitle:"MusicAlbum"==t.Type||"Game"==t.Type||"MusicArtist"==t.Type,borderless:"Game"==t.Type,context:a,lazy:!0,showDetailsMenu:!0,coverImage:"MusicAlbum"==t.Type||"MusicArtist"==t.Type,overlayPlayButton:!0}),n+="</div>";var l=e.querySelector("#similarContent");l.innerHTML=n,ImageLoader.lazyChildren(l),LibraryBrowser.createCardMenus(l)})}}function T(e,t,a){var r=e.querySelector("#seriesAirTime");if("Series"!=t.Type)return void r.classList.add("hide");var i="";t.AirDays&&t.AirDays.length&&(i+=7==t.AirDays.length?"daily":t.AirDays.map(function(e){return e+"s"}).join(",")),t.AirTime&&(i+=" at "+t.AirTime),t.Studios.length&&(i+=a?" on "+t.Studios[0].Name:' on <a class="textlink" href="itemdetails.html?id='+t.Studios[0].Id+'">'+t.Studios[0].Name+"</a>"),i?(i=("Ended"==t.Status?"Aired ":"Airs ")+i,r.innerHTML=i,r.classList.remove("hide")):r.classList.add("hide")}function C(e,t){var a=e.querySelector(".itemTags");if(t.Tags&&t.Tags.length){var r="";r+="<p>"+Globalize.translate("HeaderTags")+"</p>";for(var i=0,s=t.Tags.length;s>i;i++)r+='<div class="itemTag">'+t.Tags[i]+"</div>";a.innerHTML=r,a.classList.remove("hide")}else a.classList.add("hide")}function M(e,t){return t=Object.assign({},t),function(a,r,i){return t.StartIndex=a,t.Limit=r,t.Fields=i,ApiClient.getEpisodes(e,t)}}function A(e){return e=Object.assign({},e),function(t,a,r){return e.StartIndex=t,e.Limit=a,e.Fields=r,ApiClient.getItems(Dashboard.getCurrentUserId(),e)}}function P(e,t){lt=null;var a="ItemCounts,AudioInfo,PrimaryImageAspectRatio,SyncInfo,CanDelete",r={ParentId:t.Id,Fields:a};"BoxSet"!==t.Type&&(r.SortBy="SortName");var i,s=Dashboard.getCurrentUserId();"Series"==t.Type?i=ApiClient.getSeasons(t.Id,{userId:s,Fields:a}):"Season"==t.Type?(i=ApiClient.getEpisodes(t.SeriesId,{seasonId:t.Id,userId:s,Fields:a}),lt=M(t.SeriesId,{seasonId:t.Id,userId:s,Fields:a})):"MusicAlbum"==t.Type&&(lt=A(r)),i=i||ApiClient.getItems(Dashboard.getCurrentUserId(),r),i.then(function(a){var r="",i=!1;"MusicAlbum"==t.Type?r=LibraryBrowser.getListViewHtml({items:a.Items,smallIcon:!0,showIndex:!0,index:"disc",showIndexNumber:!0,playFromHere:!0,defaultAction:"playallfromhere",lazy:!0}):"Series"==t.Type?(i=b(),r=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:f(),showTitle:!0,centerText:!0,lazy:!0,overlayPlayButton:!0})):"Season"==t.Type?r=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"detailPage169",showTitle:!0,displayAsSpecial:"Season"==t.Type&&t.IndexNumber,playFromHere:!0,overlayText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:AppInfo.enableAppLayouts}):"GameSystem"==t.Type&&(r=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"auto",showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0}));var s=e.querySelector(".childrenItemsContainer");if(s.innerHTML=r,ImageLoader.lazyChildren(s),i?s.classList.add("hiddenScrollX"):s.classList.remove("hiddenScrollX"),LibraryBrowser.createCardMenus(s),"BoxSet"==t.Type){var n=[{name:Globalize.translate("HeaderMovies"),type:"Movie"},{name:Globalize.translate("HeaderSeries"),type:"Series"},{name:Globalize.translate("HeaderAlbums"),type:"MusicAlbum"},{name:Globalize.translate("HeaderGames"),type:"Game"},{name:Globalize.translate("HeaderBooks"),type:"Book"}];z(e,t,n,a.Items)}}),e.querySelector("#childrenTitle").innerHTML=Globalize.translate("Season"==t.Type?"HeaderEpisodes":"Series"==t.Type?"HeaderSeasons":"MusicAlbum"==t.Type?"HeaderTracks":"GameSystem"==t.Type?"HeaderGames":"HeaderItems"),"MusicAlbum"==t.Type?e.querySelector(".childrenSectionHeader",e).classList.add("hide"):e.querySelector(".childrenSectionHeader",e).classList.remove("hide")}function w(e,t){require("scripts/itembynamedetailpage".split(","),function(){window.ItemsByName.renderItems(e,t)})}function q(e,t){require("scripts/playlistedit".split(","),function(){PlaylistViewer.render(e,t)})}function D(e,t){require("scripts/livetvcomponents,scripts/livetvchannel,livetvcss".split(","),function(){LiveTvChannelPage.renderPrograms(e,t.Id)})}function z(e,t,a,r){e.querySelector(".collectionItems").innerHTML="";var i,s;for(i=0,s=a.length;s>i;i++){var n=a[i],l=r.filter(function(e){return e.Type==n.type});l.length&&G(e,t,n,l)}var o={name:Globalize.translate("HeaderOtherItems")},d=r.filter(function(e){return!a.filter(function(t){return t.type==e.Type}).length});d.length&&G(e,t,o,d),r.length||G(e,t,{name:Globalize.translate("HeaderItems")},r);var c=e.querySelectorAll(".collectionItems .itemsContainer");for(i=0,s=c.length;s>i;i++)LibraryBrowser.createCardMenus(c[i])}function G(e,t,a,r){var i="";i+='<div class="detailSection">',i+='<div style="display:flex;align-items:center;">',i+="<h1>",i+="<span>"+a.name+"</span>",i+="</h1>",i+='<button class="btnAddToCollection autoSize" type="button" is="paper-icon-button-light" style="margin-left:1em;"><i class="md-icon" icon="add">add</i></button>',i+="</div>",i+='<div class="detailSectionContent itemsContainer">';var s="MusicAlbum"==a.type?"detailPageSquare":"detailPagePortrait";i+=LibraryBrowser.getPosterViewHtml({items:r,shape:s,showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0,overlayMoreButton:!0,showAddToCollection:!1,showRemoveFromCollection:!0}),i+="</div>",i+="</div>";var n=e.querySelector(".collectionItems");n.insertAdjacentHTML("beforeend",i),ImageLoader.lazyChildren(n),n.querySelector(".btnAddToCollection").addEventListener("click",function(){require(["alert"],function(e){e({text:Globalize.translate("AddItemToCollectionHelp"),html:Globalize.translate("AddItemToCollectionHelp")+'<br/><br/><a target="_blank" href="https://github.com/MediaBrowser/Wiki/wiki/Collections">'+Globalize.translate("ButtonLearnMore")+"</a>"})})})}function B(e,t,a){Dashboard.showLoadingMsg();var r=ApiClient.getUrl("Collections/"+t.Id+"/Items",{Ids:a.join(",")});ApiClient.ajax({type:"DELETE",url:r}).then(function(){P(e,t),Dashboard.hideLoadingMsg()})}function x(e,t){for(var a=e.querySelectorAll(".userDataIcons"),r=LibraryBrowser.getUserDataIconsHtml(t,!0,"icon-button"),i=0,s=a.length;s>i;i++)a[i].innerHTML=r}function R(e,t,a){if("Movie"!=t.Type&&"Trailer"!=t.Type&&"MusicVideo"!=t.Type)return void e.querySelector("#criticReviewsCollapsible").classList.add("hide");var r={};a&&(r.limit=a),ApiClient.getCriticReviews(t.Id,r).then(function(r){r.TotalRecordCount||t.CriticRatingSummary||t.AwardSummary?(e.querySelector("#criticReviewsCollapsible").classList.remove("hide"),k(e,r,a)):e.querySelector("#criticReviewsCollapsible").classList.add("hide")})}function k(e,a,r){for(var i="",s=a.Items,n=0,l=s.length;l>n;n++){var o=s[n];i+='<div class="paperList criticReviewPaperList">',i+='<div class="listItem">',null!=o.Score||null!=o.Likes&&(i+=o.Likes?"<div style=\"background-color:transparent;background-image:url('css/images/fresh.png');background-repeat:no-repeat;background-position:center center;background-size: cover;width:40px;height:40px;\"></div>":"<div style=\"background-color:transparent;background-image:url('css/images/rotten.png');background-repeat:no-repeat;background-position:center center;background-size: cover;width:40px;height:40px;\"></div>"),i+='<div class="listItemBody two-line">',i+='<div style="white-space:normal;">'+o.Caption+"</div>";var d=[];if(o.ReviewerName&&d.push(o.ReviewerName),o.Publisher&&d.push(o.Publisher),i+='<div class="secondary">'+d.join(", ")+".",o.Date)try{var c=t.parseISO8601Date(o.Date,!0).toLocaleDateString();i+='<span class="reviewDate">'+c+"</span>"}catch(u){}i+="</div>",o.Url&&(i+='<div class="secondary"><a class="textlink" href="'+o.Url+'" target="_blank">'+Globalize.translate("ButtonFullReview")+"</a></div>"),i+="</div>",i+="</div>",i+="</div>"}r&&a.TotalRecordCount>r&&(i+='<p style="margin: 0;"><button is="emby-button" type="button" class="raised more moreCriticReviews">'+Globalize.translate("ButtonMore")+"</button></p>");var m=e.querySelector("#criticReviewsContent");m.innerHTML=i,b()?m.classList.add("hiddenScrollX"):m.classList.remove("hiddenScrollX")}function H(e,t){ApiClient.getThemeMedia(Dashboard.getCurrentUserId(),t.Id,!0).then(function(a){var r=a.ThemeSongsResult.OwnerId==t.Id?a.ThemeSongsResult.Items:[],i=a.ThemeVideosResult.OwnerId==t.Id?a.ThemeVideosResult.Items:[];F(e,r),V(e,i),e.dispatchEvent(new CustomEvent("thememediadownload",{detail:{themeMediaResult:a},bubbles:!0}))})}function F(e,t){if(t.length){e.querySelector("#themeSongsCollapsible").classList.remove("hide");var a=LibraryBrowser.getListViewHtml({items:t,smallIcon:!0});e.querySelector("#themeSongsContent").innerHTML=a}else e.querySelector("#themeSongsCollapsible").classList.add("hide")}function V(e,t,a){if(t.length){e.querySelector("#themeVideosCollapsible").classList.remove("hide");var r=e.querySelector("#themeVideosContent");r.innerHTML=X(t,a),ImageLoader.lazyChildren(r)}else e.querySelector("#themeVideosCollapsible").classList.add("hide")}function E(e,t,a){ApiClient.getItems(a.Id,{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",Recursive:!0,Fields:"DateCreated,SyncInfo,CanDelete",Albums:t.Name}).then(function(t){if(t.Items.length){e.querySelector("#musicVideosCollapsible").classList.remove("hide");var r=e.querySelector(".musicVideosContent");r.innerHTML=X(t.Items,a),ImageLoader.lazyChildren(r)}else e.querySelector("#musicVideosCollapsible").classList.add("hide")})}function U(e,t,a){ApiClient.getAdditionalVideoParts(a.Id,t.Id).then(function(t){if(t.Items.length){e.querySelector("#additionalPartsCollapsible").classList.remove("hide");var r=e.querySelector("#additionalPartsContent");r.innerHTML=X(t.Items,a),ImageLoader.lazyChildren(r)}else e.querySelector("#additionalPartsCollapsible").classList.add("hide")})}function N(e,a,r,i,s){var n="",l=a.Chapters||[],o=LibraryBrowser.getPosterViewInfo().backdropWidth;b()?(n+='<div class="hiddenScrollX itemsContainer">',i=null):n+='<div class="itemsContainer">';for(var d=0,c=l.length;c>d&&!(i&&d>=i);d++){var u=l[d],m=u.Name||"Chapter "+d,p="Full"!=a.PlayAccess||s?"":' onclick="ItemDetailPage.play('+u.StartPositionTicks+');"';n+='<a class="card '+S()+'Card" href="#"'+p+">",n+='<div class="cardBox">',n+='<div class="cardScalable">';var h;h=u.ImageTag?ApiClient.getScaledImageUrl(a.Id,{maxWidth:o,tag:u.ImageTag,type:"Chapter",index:d}):"css/images/items/list/chapter.png",n+='<div class="cardPadder"></div>',n+='<div class="cardContent">',n+='<div class="cardImage lazy" data-src="'+h+'"></div>',n+='<div class="cardFooter">',n+='<div class="cardText">'+m+"</div>",n+='<div class="cardText">',n+=t.getDisplayRunningTime(u.StartPositionTicks),n+="</div>",n+="</div>",n+="</div>",n+="</div>",n+="</div>",n+="</a>"}n+="</div>",i&&l.length>i&&(n+='<p style="margin: 0;"><button is="emby-button" type="button" class="raised more moreScenes">'+Globalize.translate("ButtonMore")+"</button></p>");var y=e.querySelector("#scenesContent");y.innerHTML=n,ImageLoader.lazyChildren(y)}function O(e,t){var a=t.MediaSources.map(function(e){return j(t,e)}).join('<div style="border-top:1px solid #444;margin: 1em 0;"></div>');t.MediaSources.length>1&&(a="<br/>"+a);var r=e.querySelector("#mediaInfoContent");r.innerHTML=a}function j(e,t){var a="";t.Name&&e.MediaSources.length>1&&(a+='<div><span class="mediaInfoAttribute">'+t.Name+"</span></div><br/>");for(var r=0,i=t.MediaStreams.length;i>r;r++){var s=t.MediaStreams[r];if("Data"!=s.Type){a+='<div class="mediaInfoStream">';var n=Globalize.translate("MediaInfoStreamType"+s.Type);a+='<div class="mediaInfoStreamType">'+n+"</div>";var l=[];s.Language&&"Video"!=s.Type&&l.push(W(Globalize.translate("MediaInfoLanguage"),s.Language)),s.Codec&&l.push(W(Globalize.translate("MediaInfoCodec"),s.Codec.toUpperCase())),s.CodecTag&&l.push(W(Globalize.translate("MediaInfoCodecTag"),s.CodecTag)),null!=s.IsAVC&&l.push(W("AVC",s.IsAVC?"Yes":"No")),s.Profile&&l.push(W(Globalize.translate("MediaInfoProfile"),s.Profile)),s.Level&&l.push(W(Globalize.translate("MediaInfoLevel"),s.Level)),(s.Width||s.Height)&&l.push(W(Globalize.translate("MediaInfoResolution"),s.Width+"x"+s.Height)),s.AspectRatio&&"mjpeg"!=s.Codec&&l.push(W(Globalize.translate("MediaInfoAspectRatio"),s.AspectRatio)),"Video"==s.Type&&(null!=s.IsAnamorphic&&l.push(W(Globalize.translate("MediaInfoAnamorphic"),s.IsAnamorphic?"Yes":"No")),l.push(W(Globalize.translate("MediaInfoInterlaced"),s.IsInterlaced?"Yes":"No"))),(s.AverageFrameRate||s.RealFrameRate)&&l.push(W(Globalize.translate("MediaInfoFramerate"),s.AverageFrameRate||s.RealFrameRate)),s.ChannelLayout&&l.push(W(Globalize.translate("MediaInfoLayout"),s.ChannelLayout)),s.Channels&&l.push(W(Globalize.translate("MediaInfoChannels"),s.Channels+" ch")),s.BitRate&&"mjpeg"!=s.Codec&&l.push(W(Globalize.translate("MediaInfoBitrate"),parseInt(s.BitRate/1024)+" kbps")),s.SampleRate&&l.push(W(Globalize.translate("MediaInfoSampleRate"),s.SampleRate+" khz")),s.BitDepth&&l.push(W(Globalize.translate("MediaInfoBitDepth"),s.BitDepth+" bit")),s.PixelFormat&&l.push(W(Globalize.translate("MediaInfoPixelFormat"),s.PixelFormat)),s.RefFrames&&l.push(W(Globalize.translate("MediaInfoRefFrames"),s.RefFrames)),s.NalLengthSize&&l.push(W("NAL",s.NalLengthSize)),"Video"!=s.Type&&l.push(W(Globalize.translate("MediaInfoDefault"),s.IsDefault?"Yes":"No")),"Subtitle"==s.Type&&(l.push(W(Globalize.translate("MediaInfoForced"),s.IsForced?"Yes":"No")),l.push(W(Globalize.translate("MediaInfoExternal"),s.IsExternal?"Yes":"No"))),"Video"==s.Type&&t.Timestamp&&l.push(W(Globalize.translate("MediaInfoTimestamp"),t.Timestamp)),s.DisplayTitle&&l.push(W("Title",s.DisplayTitle)),a+=l.join("<br/>"),a+="</div>"}}if(t.Container&&(a+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoContainer")+'</span><span class="mediaInfoAttribute">'+t.Container+"</span></div>"),t.Formats&&t.Formats.length,t.Path&&"Http"!=t.Protocol&&(a+='<div style="max-width:600px;overflow:hidden;"><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoPath")+'</span><span class="mediaInfoAttribute">'+t.Path+"</span></div>"),t.Size){var o=(t.Size/1048576).toFixed(0);a+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoSize")+'</span><span class="mediaInfoAttribute">'+o+" MB</span></div>"}return a}function W(e,t){return'<span class="mediaInfoLabel">'+e+'</span><span class="mediaInfoAttribute">'+t+"</span>"}function X(e,a,r,i){for(var s="",n=LibraryBrowser.getPosterViewInfo().backdropWidth,l=0,o=e.length;o>l&&!(r&&l>=r);l++){var d=e[l],c="card detailPage169Card",u="itemdetails.html?id="+d.Id,m="Full"==d.PlayAccess?" onclick=\"MediaController.play('"+d.Id+"'); return false;\"":"";s+='<a class="'+c+'" href="'+u+'"'+m+">",s+='<div class="cardBox">',s+='<div class="cardScalable">';var p,h=d.ImageTags||{};p=h.Primary?ApiClient.getScaledImageUrl(d.Id,{maxWidth:n,tag:h.Primary,type:"primary"}):"css/images/items/detail/video.png",s+='<div class="cardPadder"></div>',s+='<div class="cardContent">',s+='<div class="cardImage lazy" data-src="'+p+'"></div>',s+='<div class="cardFooter">',s+='<div class="cardText">'+d.Name+"</div>",s+='<div class="cardText">',s+=""!=d.RunTimeTicks?t.getDisplayRunningTime(d.RunTimeTicks):"&nbsp;",s+="</div>",s+="</div>",s+="</div>",s+="</div>",s+="</div>",s+="</a>"}return r&&e.length>r&&(s+='<p style="margin: 0;padding-left:5px;"><button is="emby-button" type="button" class="raised more '+i+'">'+Globalize.translate("ButtonMore")+"</button></p>"),s}function Y(e,t,a,r){ApiClient.getSpecialFeatures(a.Id,t.Id).then(function(t){var i=e.querySelector("#specialsContent");i.innerHTML=X(t,a,r,"moreSpecials"),ImageLoader.lazyChildren(i)})}function _(e,t,a,r,i){if(b())return void K(e,t,a,i);for(var s="",n=t.People||[],l=0,o=n.length;o>l&&!(r&&l>=r);l++){var d=n[l],c=i?"#":"itemdetails.html?id="+d.Id;s+='<a class="tileItem smallPosterTileItem" href="'+c+'">';var u,m=!0;d.PrimaryImageTag?u=ApiClient.getScaledImageUrl(d.Id,{maxWidth:100,tag:d.PrimaryImageTag,type:"primary",minScale:2}):(u="css/images/items/list/person.png",m=!1),s+=m?'<div class="tileImage lazy" data-src="'+u+'"></div>':'<div class="tileImage" style="background-image:url(\''+u+"');\"></div>",s+='<div class="tileContent">',s+="<p>"+d.Name+"</p>";var p=d.Role?Globalize.translate("ValueAsRole",d.Role):d.Type;"GuestStar"==p&&(p=Globalize.translate("ValueGuestStar")),p=p||"";var h=40;p.length>h&&(p=p.substring(0,h-3)+"..."),s+="<p>"+p+"</p>",s+="</div>",s+="</a>"}r&&n.length>r&&(s+='<p style="margin: 0;padding-left:5px;"><button is="emby-button" type="button" class="raised more morePeople">'+Globalize.translate("ButtonMore")+"</button></p>");var y=e.querySelector("#castContent");y.innerHTML=s,ImageLoader.lazyChildren(y)}function K(e,t,a,r){var i="";i+=b()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">';var s=t.People||[];s=s.filter(function(e){return e.PrimaryImageTag}),s.length||(s=t.People||[]);for(var n=0,l=s.length;l>n;n++){var o=s[n],d=r?"#":"itemdetails.html?id="+o.Id;i+='<div class="card '+f()+'Card">',i+='<div class="cardBox">',i+='<div class="cardScalable">';var c,u=!0;o.PrimaryImageTag?c=ApiClient.getScaledImageUrl(o.Id,{maxWidth:100,tag:o.PrimaryImageTag,type:"primary",minScale:2}):(c="css/images/items/list/person.png",u=!1),i+='<div class="cardPadder"></div>',i+='<a class="cardContent" href="'+d+'">',i+=u?'<div class="cardImage coveredCardImage lazy" data-src="'+c+'"></div>':'<div class="cardImage coveredCardImage" style="background-image:url(\''+c+"');\"></div>",i+="</div>",i+="</a>",i+="</div>",i+='<div class="cardFooter outerCardFooter">',i+='<div class="cardText">'+o.Name+"</div>",i+='<div class="cardText">';var m=o.Role?Globalize.translate("ValueAsRole",o.Role):o.Type;"GuestStar"==m&&(m=Globalize.translate("ValueGuestStar")),m=m||"";var p=40;m.length>p&&(m=m.substring(0,p-3)+"..."),i+=m,i+="</div>",i+="</div>",i+="</div>"}i+="</div>";var h=e.querySelector("#castContent");h.innerHTML=i,ImageLoader.lazyChildren(h)}function J(e){MediaController.play({items:[nt],startPositionTicks:e})}function Q(e,t){require(["confirm"],function(a){a("Are you sure you wish to split the media sources into separate items?","Split Media Apart").then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Videos/"+t.id+"/AlternateSources")}).then(function(){Dashboard.hideLoadingMsg(),s(e,t)})})})}function Z(){ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),nt.Id).then(function(e){MediaController.play({items:e})})}function $(e,t){nt&&nt.Id==t&&("Recording"==nt.Type?LibraryBrowser.showTab("livetv.html",3):Dashboard.navigate("home.html"))}function et(e){if("Program"==nt.Type)return void ApiClient.getLiveTvChannel(nt.ChannelId,Dashboard.getCurrentUserId()).then(function(e){LibraryBrowser.showPlayMenu(null,e.Id,e.Type,!1,e.MediaType,(e.UserData||{}).PlaybackPositionTicks)});var t=nt.UserData||{},a=nt.MediaType;("MusicArtist"==nt.Type||"MusicAlbum"==nt.Type)&&(a="Audio"),LibraryBrowser.showPlayMenu(e,nt.Id,nt.Type,nt.IsFolder,a,t.PlaybackPositionTicks)}function tt(e,t,a){require(["confirm"],function(r){r(Globalize.translate("MessageConfirmRecordingCancellation"),Globalize.translate("HeaderConfirmRecordingCancellation")).then(function(){Dashboard.showLoadingMsg(),ApiClient.cancelLiveTvTimer(a).then(function(){require(["toast"],function(e){e(Globalize.translate("MessageRecordingCancelled"))}),s(e,t)})})})}function at(){var e=this;e.play=J,e.setInitialCollapsibleState=m,e.renderDetails=p,e.renderCriticReviews=R,e.renderCast=_,e.renderScenes=N,e.renderMediaSources=O}function rt(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;
return e}function it(){et(this)}function st(){require(["syncDialog"],function(e){e.showMenu({items:[nt]})})}var nt,lt=null;return window.ItemDetailPage=new at,function(e,t){function a(){Z(e)}function r(){var a=t.id;Dashboard.showLoadingMsg(),require(["recordingCreator"],function(r){r.show(a,nt.ServerId).then(function(){s(e,t)})})}function i(){tt(e,t,nt.TimerId)}function n(){var a=this;Dashboard.getCurrentUser().then(function(r){LibraryBrowser.showMoreCommands(a,nt.Id,nt.Type,LibraryBrowser.getMoreCommands(nt,r)).then(function(){s(e,t)})})}function l(t,a){var r=a;if("UserDataChanged"===r.MessageType&&nt&&r.Data.UserId==Dashboard.getCurrentUserId()){var i=nt.UserData.Key,s=r.Data.UserDataList.filter(function(e){return e.Key==i})[0];s&&(nt.UserData=s,Dashboard.getCurrentUser().then(function(t){d(e,nt,t)}))}}var o,c,u=e.querySelectorAll(".btnPlay");for(o=0,c=u.length;c>o;o++)u[o].addEventListener("click",it);for(u=e.querySelectorAll(".btnPlayTrailer"),o=0,c=u.length;c>o;o++)u[o].addEventListener("click",a);for(e.querySelector(".btnSplitVersions").addEventListener("click",function(){Q(e,t)}),u=e.querySelectorAll(".btnSync"),o=0,c=u.length;c>o;o++)u[o].addEventListener("click",st);for(u=e.querySelectorAll(".btnRecord,.btnFloatingRecord"),o=0,c=u.length;c>o;o++)u[o].addEventListener("click",r);for(u=e.querySelectorAll(".btnCancelRecording"),o=0,c=u.length;c>o;o++)u[o].addEventListener("click",i);for(u=e.querySelectorAll(".btnMoreCommands"),o=0,c=u.length;c>o;o++)u[o].addEventListener("click",n);var m=e.querySelector(".childrenItemsContainer");m.addEventListener("playallfromhere",function(e){LibraryBrowser.playAllFromHere(lt,e.detail.index)}),m.addEventListener("queueallfromhere",function(e){LibraryBrowser.queueAllFromHere(lt,e.detail.index)}),e.addEventListener("click",function(a){rt(a.target,"moreScenes")?Dashboard.getCurrentUser().then(function(t){N(e,nt,t)}):rt(a.target,"morePeople")?_(e,nt,t.context):rt(a.target,"moreSpecials")?Dashboard.getCurrentUser().then(function(t){Y(e,nt,t)}):rt(a.target,"moreCriticReviews")&&R(e,nt)}),e.querySelector(".collectionItems").addEventListener("removefromcollection",function(t){var a=t.detail.itemId;B(e,nt,[a])}),e.querySelector(".detailImageContainer").addEventListener("click",function(a){var r=rt(a.target,"itemDetailGalleryLink");r&&LibraryBrowser.editImages(nt.Id).then(function(){s(e,t)})}),e.addEventListener("viewbeforeshow",function(){var e=this;s(e,t),Events.on(ApiClient,"websocketmessage",l),Events.on(LibraryBrowser,"itemdeleting",$)}),e.addEventListener("viewbeforehide",function(){Events.off(LibraryBrowser,"itemdeleting",$),nt=null,Events.off(ApiClient,"websocketmessage",l),LibraryMenu.setTransparentMenu(!1)})}});