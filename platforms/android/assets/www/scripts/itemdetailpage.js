define(["layoutManager","datetime","jQuery","mediaInfo","scrollStyles"],function(e,a,t,i){function r(){var e=getParameterByName("id");if(e)return ApiClient.getItem(Dashboard.getCurrentUserId(),e);var a=getParameterByName("genre");if(a)return ApiClient.getGenre(a,Dashboard.getCurrentUserId());if(a=getParameterByName("musicgenre"))return ApiClient.getMusicGenre(a,Dashboard.getCurrentUserId());if(a=getParameterByName("gamegenre"))return ApiClient.getGameGenre(a,Dashboard.getCurrentUserId());if(a=getParameterByName("musicartist"))return ApiClient.getArtist(a,Dashboard.getCurrentUserId());throw new Error("Invalid request")}function n(e){Dashboard.showLoadingMsg(),r().then(function(a){s(e,a)})}function s(i,r){ra=r;var n=m(r);LibraryMenu.setBackButtonVisible(!0),LibraryMenu.setMenuButtonVisible(!1),LibraryBrowser.renderName(r,t(".itemName",i),!1,n),LibraryBrowser.renderParentName(r,t(".parentName",i),n),LibraryMenu.setTitle(r.SeriesName||r.Name),Dashboard.getCurrentUser().then(function(s){l(i,r,s),p(i,r,n,s),h(i,r,n);var o=!1;"MusicArtist"!=r.Type&&"MusicAlbum"!=r.Type&&"Playlist"!=r.Type&&"BoxSet"!=r.Type&&"Audio"!=r.MediaType&&e.mobile?o=LibraryBrowser.renderDetailPageBackdrop(i,r):(t("#itemBackdrop",i).addClass("noBackdrop").css("background-image","none"),require(["backdrop"],function(e){e.setBackdrops([r])}));var d=o&&i.classList.contains("noSecondaryNavPage");LibraryMenu.setTransparentMenu(d);var c=!1;if("Program"==r.Type){var m=new Date;m>=a.parseISO8601Date(r.StartDate,!0)&&m<a.parseISO8601Date(r.EndDate,!0)?(t(".btnPlay",i).removeClass("hide"),c=!0):t(".btnPlay",i).addClass("hide")}else MediaController.canPlay(r)?(t(".btnPlay",i).removeClass("hide"),c=!0):t(".btnPlay",i).addClass("hide");r.LocalTrailerCount&&"Full"==r.PlayAccess?t(".btnPlayTrailer",i).removeClass("hide"):t(".btnPlayTrailer",i).addClass("hide"),LibraryBrowser.enableSync(r,s)?t(".btnSync",i).removeClass("hide"):t(".btnSync",i).addClass("hide"),"Program"==r.Type&&r.TimerId?t(".btnCancelRecording",i).removeClass("hide"):t(".btnCancelRecording",i).addClass("hide"),"Program"!=r.Type||r.TimerId||r.SeriesTimerId?(t(".btnRecord",i).addClass("hide"),t(".btnFloatingRecord",i).addClass("hide")):c?(t(".btnRecord",i).removeClass("hide"),t(".btnFloatingRecord",i).addClass("hide")):(t(".btnRecord",i).addClass("hide"),t(".btnFloatingRecord",i).removeClass("hide")),!r.LocalTrailerCount&&r.RemoteTrailers.length&&"Full"==r.PlayAccess?t(".btnPlayExternalTrailer",i).removeClass("hide").attr("href",r.RemoteTrailers[0].Url):t(".btnPlayExternalTrailer",i).addClass("hide").attr("href","#");var u=(r.MediaSources||[]).filter(function(e){return"Grouping"==e.Type});if(s.Policy.IsAdministrator&&u.length?t(".splitVersionContainer",i).show():t(".splitVersionContainer",i).hide(),LibraryBrowser.getMoreCommands(r,s).length>0?t(".btnMoreCommands",i).removeClass("hide"):t(".btnMoreCommands",i).addClass("hide"),s.Policy.IsAdministrator?t(".chapterSettingsButton",i).show():t(".chapterSettingsButton",i).hide(),"Person"==r.Type&&r.PremiereDate)try{var g=a.parseISO8601Date(r.PremiereDate,!0).toDateString();t("#itemBirthday",i).show().html(Globalize.translate("BirthDateValue").replace("{0}",g))}catch(y){t("#itemBirthday",i).hide()}else t("#itemBirthday",i).hide();if("Person"==r.Type&&r.EndDate)try{var v=a.parseISO8601Date(r.EndDate,!0).toDateString();t("#itemDeathDate",i).show().html(Globalize.translate("DeathDateValue").replace("{0}",v))}catch(y){t("#itemBirthday",i).hide()}if("Person"==r.Type&&r.ProductionLocations&&r.ProductionLocations.length){var b='<a class="textlink" target="_blank" href="https://maps.google.com/maps?q='+r.ProductionLocations[0]+'">'+r.ProductionLocations[0]+"</a>";t("#itemBirthLocation",i).show().html(Globalize.translate("BirthPlaceValue").replace("{0}",b))}else t("#itemBirthLocation",i).hide()}),"Offline"==r.LocationType?t(".offlineIndicator",i).show():t(".offlineIndicator",i).hide();var s=!1;if("Virtual"==r.LocationType&&"Episode"==r.Type)try{r.PremiereDate&&(new Date).getTime()>=a.parseISO8601Date(r.PremiereDate,!0).getTime()&&(s=!0)}catch(o){}s?t(".missingIndicator",i).show():t(".missingIndicator",i).hide(),c(i,r),i.dispatchEvent(new CustomEvent("displayingitem",{detail:{item:r,context:n},bubbles:!0})),Dashboard.hideLoadingMsg()}function l(e,a,t){LibraryBrowser.renderDetailImage(e.querySelector(".detailImageContainer"),a,t.Policy.IsAdministrator&&"Photo"!=a.MediaType)}function o(e,a){LibraryBrowser.refreshDetailImageUserData(e.querySelector(".detailImageContainer"),a)}function d(e,a){var i=a,r=t(t.mobile.activePage)[0];if("UserDataChanged"===i.MessageType&&ra&&i.Data.UserId==Dashboard.getCurrentUserId()){var n=ra.UserData.Key,s=i.Data.UserDataList.filter(function(e){return e.Key==n})[0];s&&(ra.UserData=s,Dashboard.getCurrentUser().then(function(e){o(r,ra,e)}))}}function c(e,a){t("#peopleHeader",e).html("Audio"==a.MediaType||"MusicAlbum"==a.Type||"Book"==a.MediaType||"Photo"==a.MediaType?Globalize.translate("HeaderPeople"):Globalize.translate("HeaderCastAndCrew"))}function m(){return getParameterByName("context")}function u(e,a,i){var r=e.querySelector(".nextUpSection"),n=a.UserData||{};return"Series"==a.Type&&n.PlayedPercentage?void ApiClient.getNextUpEpisodes({SeriesId:a.Id,UserId:i.Id}).then(function(e){e.Items.length?r.classList.remove("hide"):r.classList.add("hide");var i=LibraryBrowser.getPosterViewHtml({items:e.Items,shape:"detailPage169",showTitle:!0,displayAsSpecial:"Season"==a.Type&&a.IndexNumber,overlayText:!0,lazy:!0,overlayPlayButton:!0}),n=r.querySelector(".nextUpItems");n.innerHTML=i,ImageLoader.lazyChildren(n),t(n).createCardMenus()}):void r.classList.add("hide")}function p(e,a,i,r){t(".collectionItems",e).empty(),"TvChannel"==a.Type?(t("#childrenCollapsible",e).removeClass("hide"),B(e,a,r)):"Playlist"==a.Type?(t("#childrenCollapsible",e).removeClass("hide"),z(e,a,r)):"Studio"==a.Type||"Person"==a.Type||"Genre"==a.Type||"MusicGenre"==a.Type||"GameGenre"==a.Type||"MusicArtist"==a.Type?(t("#childrenCollapsible",e).removeClass("hide"),D(e,a,r)):a.IsFolder?("BoxSet"==a.Type?t("#childrenCollapsible",e).addClass("hide"):t("#childrenCollapsible",e).removeClass("hide"),L(e,a,r,i)):t("#childrenCollapsible",e).addClass("hide"),"Series"==a.Type?u(e,a,r):e.querySelector(".nextUpSection").classList.add("hide"),a.MediaSources&&a.MediaSources.length&&j(e,a);var n=a.Chapters||[];n.length&&AppInfo.enableDetailPageChapters?(t("#scenesCollapsible",e).show(),O(e,a,r,3)):t("#scenesCollapsible",e).hide(),a.SpecialFeatureCount&&0!=a.SpecialFeatureCount&&"Series"!=a.Type?(t("#specialsCollapsible",e).removeClass("hide"),K(e,a,r,6)):t("#specialsCollapsible",e).addClass("hide"),a.People&&a.People.length?(t("#castCollapsible",e).show(),_(e,a,i,f()?null:6)):t("#castCollapsible",e).hide(),a.PartCount&&a.PartCount>1?(t("#additionalPartsCollapsible",e).removeClass("hide"),E(e,a,r)):t("#additionalPartsCollapsible",e).addClass("hide"),t("#themeSongsCollapsible",e).hide(),t("#themeVideosCollapsible",e).hide(),"MusicAlbum"==a.Type?q(e,a,r):t("#musicVideosCollapsible",e).hide(),H(e,a,r),f()?F(e,a):F(e,a,1)}function h(e,a,r,n){S(e,a,r),n||b(e,a,r),a.Taglines&&a.Taglines.length?t(".tagline",e).html(a.Taglines[0]).show():t(".tagline",e).hide();var s=e.querySelector(".topOverview"),l=e.querySelector(".bottomOverview"),o=screen.availHeight<800||screen.availWidth<600;"MusicAlbum"==a.Type||"MusicArtist"==a.Type||"Season"==a.Type&&o?(LibraryBrowser.renderOverview([l],a),s.classList.add("hide"),l.classList.remove("hide")):(LibraryBrowser.renderOverview([s],a),s.classList.remove("hide"),l.classList.add("hide")),LibraryBrowser.renderAwardSummary(t("#awardSummary",e),a),t(".itemMiscInfo",e).each(function(){i.fillPrimaryMediaInfo(this,a,{interactive:!0})}),LibraryBrowser.renderGenres(t(".itemGenres",e),a,null,n),LibraryBrowser.renderStudios(t(".itemStudios",e),a,n),k(e,a),LibraryBrowser.renderLinks(e.querySelector(".itemExternalLinks"),a),t(".criticRatingScore",e).html((a.CriticRating||"0")+"%"),a.CriticRatingSummary?(t("#criticRatingSummary",e).show(),t(".criticRatingSummaryText",e).html(a.CriticRatingSummary)):t("#criticRatingSummary",e).hide(),P(e,a),M(e,a,n),a.Players?t("#players",e).show().html(a.Players+" Player"):t("#players",e).hide(),a.ArtistItems&&a.ArtistItems.length&&"MusicAlbum"!=a.Type?t(".artist",e).show().html(v(a.ArtistItems,r)):t(".artist",e).hide(),a.MediaSources&&a.MediaSources.length&&a.Path?t(".audioVideoMediaInfo",e).removeClass("hide"):t(".audioVideoMediaInfo",e).addClass("hide"),"Photo"==a.MediaType?(t(".photoInfo",e).removeClass("hide"),g(e,a)):t(".photoInfo",e).addClass("hide"),y(e,a)}function g(e,a){var i="",r=[];if(a.CameraMake&&r.push(X(Globalize.translate("MediaInfoCameraMake"),a.CameraMake)),a.CameraModel&&r.push(X(Globalize.translate("MediaInfoCameraModel"),a.CameraModel)),a.Altitude&&r.push(X(Globalize.translate("MediaInfoAltitude"),a.Altitude.toFixed(1))),a.Aperture&&r.push(X(Globalize.translate("MediaInfoAperture"),"F"+a.Aperture.toFixed(1))),a.ExposureTime){var n=1/a.ExposureTime;r.push(X(Globalize.translate("MediaInfoExposureTime"),"1/"+n+" s"))}a.FocalLength&&r.push(X(Globalize.translate("MediaInfoFocalLength"),a.FocalLength.toFixed(1)+" mm")),a.ImageOrientation,a.IsoSpeedRating&&r.push(X(Globalize.translate("MediaInfoIsoSpeedRating"),a.IsoSpeedRating)),a.Latitude&&r.push(X(Globalize.translate("MediaInfoLatitude"),a.Latitude.toFixed(1))),a.Longitude&&r.push(X(Globalize.translate("MediaInfoLongitude"),a.Longitude.toFixed(1))),a.ShutterSpeed&&r.push(X(Globalize.translate("MediaInfoShutterSpeed"),a.ShutterSpeed)),a.Software&&r.push(X(Globalize.translate("MediaInfoSoftware"),a.Software)),i+=r.join("<br/>"),t(".photoInfoContent",e).html(i)}function y(e){var a=t(".tabDetails",e)[0],i=a.textContent||a.innerText||"";i.trim()?t(".detailsSection",e).removeClass("hide"):t(".detailsSection",e).addClass("hide")}function v(e){for(var a=[],t=0,i=e.length;i>t;t++){var r=e[t];a.push('<a class="textlink" href="itemdetails.html?id='+r.Id+'">'+r.Name+"</a>")}return a=a.join(" / "),1==e.length?Globalize.translate("ValueArtist",a):e.length>1?Globalize.translate("ValueArtists",a):a}function b(e,a,i){if(t(".lnkSibling",e).addClass("hide"),"Episode"==a.Type||"Season"==a.Type||"Audio"==a.Type||"Photo"==a.Type){var r;r="Season"==a.Type?ApiClient.getSeasons(a.SeriesId,{userId:Dashboard.getCurrentUserId(),AdjacentTo:a.Id}):"Episode"==a.Type&&a.SeasonId?ApiClient.getEpisodes(a.SeriesId,{seasonId:a.SeasonId,userId:Dashboard.getCurrentUserId(),AdjacentTo:a.Id}):ApiClient.getItems(Dashboard.getCurrentUserId(),{AdjacentTo:a.Id,ParentId:a.ParentId,SortBy:"SortName"}),i=i||"",r.then(function(r){for(var n=!1,s=0,l=r.Items.length;l>s;s++){var o=r.Items[s];o.Id==a.Id?n=!0:n?t(".lnkNextItem",e).removeClass("hide").attr("href","itemdetails.html?id="+o.Id+"&context="+i):t(".lnkPreviousItem",e).removeClass("hide").attr("href","itemdetails.html?id="+o.Id+"&context="+i)}})}}function f(){return browserInfo.mobile&&AppInfo.enableAppLayouts&&screen.availWidth<=1e3}function I(){return f()?"overflowPortrait":"detailPagePortrait"}function C(){return f()?"overflowSquare":"detailPageSquare"}function T(){return f()?"overflowBackdrop":"detailPage169"}function S(e,a,i){if("Movie"!=a.Type&&"Trailer"!=a.Type&&"Series"!=a.Type&&"Program"!=a.Type&&"Recording"!=a.Type&&"Game"!=a.Type&&"MusicAlbum"!=a.Type&&"MusicArtist"!=a.Type&&"ChannelVideoItem"!=a.Type)return void t("#similarCollapsible",e).hide();t("#similarCollapsible",e).show();var r="MusicAlbum"==a.Type||"MusicArtist"==a.Type?C():I(),n=t(window).width(),s=t(window).height(),l={userId:Dashboard.getCurrentUserId(),limit:n>800&&"detailPagePortrait"==r?4:4,fields:"PrimaryImageAspectRatio,UserData,SyncInfo,CanDelete"};n>=800&&s>=1e3&&(l.limit*=2),f()&&(l.limit=12),ApiClient.getSimilarItems(a.Id,l).then(function(n){if(!n.Items.length)return void t("#similarCollapsible",e).hide();var s=t("#similarCollapsible",e).show();t(".similiarHeader",s).html(Globalize.translate("HeaderIfYouLikeCheckTheseOut",a.Name));var l="";l+=f()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">',l+=LibraryBrowser.getPosterViewHtml({items:n.Items,shape:r,showParentTitle:"MusicAlbum"==a.Type,centerText:!0,showTitle:"MusicAlbum"==a.Type||"Game"==a.Type||"MusicArtist"==a.Type,borderless:"Game"==a.Type,context:i,lazy:!0,showDetailsMenu:!0,coverImage:"MusicAlbum"==a.Type||"MusicArtist"==a.Type,overlayPlayButton:!0}),l+="</div>",t("#similarContent",e).html(l).lazyChildren().createCardMenus()})}function M(e,a,i){if("Series"!=a.Type)return void t("#seriesAirTime",e).hide();var r="";a.AirDays&&a.AirDays.length&&(r+=7==a.AirDays.length?"daily":a.AirDays.map(function(e){return e+"s"}).join(",")),a.AirTime&&(r+=" at "+a.AirTime),a.Studios.length&&(r+=i?" on "+a.Studios[0].Name:' on <a class="textlink" href="itemdetails.html?id='+a.Studios[0].Id+'">'+a.Studios[0].Name+"</a>"),r?(r=("Ended"==a.Status?"Aired ":"Airs ")+r,t("#seriesAirTime",e).show().html(r)):t("#seriesAirTime",e).hide()}function P(e,a){if(a.Tags&&a.Tags.length){var i="";i+="<p>"+Globalize.translate("HeaderTags")+"</p>";for(var r=0,n=a.Tags.length;n>r;r++)i+='<div class="itemTag">'+a.Tags[r]+"</div>";t(".itemTags",e).show().html(i)}else t(".itemTags",e).hide()}function w(e,a){return a=t.extend({},a),function(t,i,r){return a.StartIndex=t,a.Limit=i,a.Fields=r,ApiClient.getEpisodes(e,a)}}function A(e){return e=t.extend({},e),function(a,t,i){return e.StartIndex=a,e.Limit=t,e.Fields=i,ApiClient.getItems(Dashboard.getCurrentUserId(),e)}}function L(e,a,i,r){na=null;var n="ItemCounts,AudioInfo,PrimaryImageAspectRatio,SyncInfo,CanDelete",s={ParentId:a.Id,Fields:n};"BoxSet"!==a.Type&&(s.SortBy="SortName");var l;"Series"==a.Type?l=ApiClient.getSeasons(a.Id,{userId:i.Id,Fields:n}):"Season"==a.Type?(l=ApiClient.getEpisodes(a.SeriesId,{seasonId:a.Id,userId:i.Id,Fields:n}),na=w(a.SeriesId,{seasonId:a.Id,userId:i.Id,Fields:n})):"MusicAlbum"==a.Type&&(na=A(s)),l=l||ApiClient.getItems(Dashboard.getCurrentUserId(),s),l.then(function(n){var s="",l=!1;"MusicAlbum"==a.Type?s=LibraryBrowser.getListViewHtml({items:n.Items,smallIcon:!0,showIndex:!0,index:"disc",showIndexNumber:!0,playFromHere:!0,defaultAction:"playallfromhere",lazy:!0}):"Series"==a.Type?(l=f(),s=LibraryBrowser.getPosterViewHtml({items:n.Items,shape:I(),showTitle:!0,centerText:!0,lazy:!0,overlayPlayButton:!0})):"Season"==a.Type?s=LibraryBrowser.getPosterViewHtml({items:n.Items,shape:"detailPage169",showTitle:!0,displayAsSpecial:"Season"==a.Type&&a.IndexNumber,playFromHere:!0,overlayText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:AppInfo.enableAppLayouts}):"GameSystem"==a.Type&&(s=LibraryBrowser.getPosterViewHtml({items:n.Items,shape:"auto",showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0}));var o=e.querySelector(".childrenItemsContainer");if(o.innerHTML=s,ImageLoader.lazyChildren(o),l?o.classList.add("hiddenScrollX"):o.classList.remove("hiddenScrollX"),t(o).createCardMenus(),"BoxSet"==a.Type){var d=[{name:Globalize.translate("HeaderMovies"),type:"Movie"},{name:Globalize.translate("HeaderSeries"),type:"Series"},{name:Globalize.translate("HeaderAlbums"),type:"MusicAlbum"},{name:Globalize.translate("HeaderGames"),type:"Game"},{name:Globalize.translate("HeaderBooks"),type:"Book"}];G(e,a,d,n.Items,i,r)}}),e.querySelector("#childrenTitle").innerHTML=Globalize.translate("Season"==a.Type?"HeaderEpisodes":"Series"==a.Type?"HeaderSeasons":"MusicAlbum"==a.Type?"HeaderTracks":"GameSystem"==a.Type?"HeaderGames":"HeaderItems"),"MusicAlbum"==a.Type?t(".childrenSectionHeader",e).hide():t(".childrenSectionHeader",e).show()}function D(e,a){require("scripts/itembynamedetailpage".split(","),function(){window.ItemsByName.renderItems(e,a)})}function z(e,a){require("scripts/playlistedit".split(","),function(){PlaylistViewer.render(e,a)})}function B(e,a){require("scripts/livetvcomponents,scripts/livetvchannel,livetvcss".split(","),function(){LiveTvChannelPage.renderPrograms(e,a.Id)})}function G(e,a,i,r,n){e.querySelector(".collectionItems").innerHTML="";for(var s=0,l=i.length;l>s;s++){var o=i[s],d=r.filter(function(e){return e.Type==o.type});d.length&&R(e,a,o,d,n)}var c={name:Globalize.translate("HeaderOtherItems")},m=r.filter(function(e){return!i.filter(function(a){return a.type==e.Type}).length});m.length&&R(e,a,c,m,n),r.length||R(e,a,{name:Globalize.translate("HeaderItems")},r,n),t(".collectionItems .itemsContainer",e).createCardMenus()}function R(e,a,i,r,n,s){var l="";l+='<div class="detailSection">',l+="<h1>",l+="<span>"+i.name+"</span>",l+="</h1>",l+='<div class="detailSectionContent itemsContainer">';var o="MusicAlbum"==i.type?"detailPageSquare":"detailPagePortrait";l+=LibraryBrowser.getPosterViewHtml({items:r,shape:o,showTitle:!0,centerText:!0,context:s,lazy:!0,showDetailsMenu:!0,overlayMoreButton:!0,showAddToCollection:!1,showRemoveFromCollection:!0}),l+="</div>",l+="</div>";var d=e.querySelector(".collectionItems");t(d).append(l),ImageLoader.lazyChildren(d),t(d).off("removefromcollection").on("removefromcollection",function(t,i){x(e,a,[i],n,s)})}function x(e,a,t,i,r){Dashboard.showLoadingMsg();var n=ApiClient.getUrl("Collections/"+a.Id+"/Items",{Ids:t.join(",")});ApiClient.ajax({type:"DELETE",url:n}).then(function(){L(e,a,i,r),Dashboard.hideLoadingMsg()})}function k(e,a){t(".userDataIcons",e).html(LibraryBrowser.getUserDataIconsHtml(a,!0,"icon-button"))}function F(e,a,i){if("Movie"!=a.Type&&"Trailer"!=a.Type&&"MusicVideo"!=a.Type)return void t("#criticReviewsCollapsible",e).hide();var r={};i&&(r.limit=i),ApiClient.getCriticReviews(a.Id,r).then(function(r){r.TotalRecordCount||a.CriticRatingSummary||a.AwardSummary?(t("#criticReviewsCollapsible",e).show(),V(e,r,i)):t("#criticReviewsCollapsible",e).hide()})}function V(e,t,i){for(var r="",n=t.Items,s=0,l=n.length;l>s;s++){var o=n[s];r+='<div class="paperList criticReviewPaperList">',r+='<paper-icon-item style="padding-top:.5em;padding-bottom:.5em;">',null!=o.Score||null!=o.Likes&&(r+=o.Likes?"<paper-fab mini style=\"background-color:transparent;background-image:url('css/images/fresh.png');background-repeat:no-repeat;background-position:center center;background-size: cover;\" item-icon></paper-fab>":"<paper-fab mini style=\"background-color:transparent;background-image:url('css/images/rotten.png');background-repeat:no-repeat;background-position:center center;background-size: cover;\" item-icon></paper-fab>"),r+="<paper-item-body three-line>",r+='<div style="white-space:normal;">'+o.Caption+"</div>";var d=[];if(o.ReviewerName&&d.push(o.ReviewerName),o.Publisher&&d.push(o.Publisher),r+="<div secondary>"+d.join(", ")+".",o.Date)try{var c=a.parseISO8601Date(o.Date,!0).toLocaleDateString();r+='<span class="reviewDate">'+c+"</span>"}catch(m){}r+="</div>",o.Url&&(r+='<div secondary><a class="textlink" href="'+o.Url+'" target="_blank">'+Globalize.translate("ButtonFullReview")+"</a></div>"),r+="</paper-item-body>",r+="</paper-icon-item>",r+="</div>"}i&&t.TotalRecordCount>i&&(r+='<p style="margin: 0;"><paper-button raised class="more moreCriticReviews">'+Globalize.translate("ButtonMore")+"</paper-button></p>");var u=e.querySelector("#criticReviewsContent");u.innerHTML=r,f()?u.classList.add("hiddenScrollX"):u.classList.remove("hiddenScrollX")}function H(e,a){ApiClient.getThemeMedia(Dashboard.getCurrentUserId(),a.Id,!0).then(function(t){var i=t.ThemeSongsResult.OwnerId==a.Id?t.ThemeSongsResult.Items:[],r=t.ThemeVideosResult.OwnerId==a.Id?t.ThemeVideosResult.Items:[];N(e,i),U(e,r),e.dispatchEvent(new CustomEvent("thememediadownload",{detail:{themeMediaResult:t},bubbles:!0}))})}function N(e,a){if(a.length){t("#themeSongsCollapsible",e).show();var i=LibraryBrowser.getListViewHtml({items:a,smallIcon:!0});e.querySelector("#themeSongsContent").innerHTML=i}else t("#themeSongsCollapsible",e).hide()}function U(e,a,i){a.length?(t("#themeVideosCollapsible",e).show(),t("#themeVideosContent",e).html(Y(a,i)).lazyChildren()):t("#themeVideosCollapsible",e).hide()}function q(e,a,i){ApiClient.getItems(i.Id,{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",Recursive:!0,Fields:"DateCreated,SyncInfo,CanDelete",Albums:a.Name}).then(function(a){a.Items.length?(t("#musicVideosCollapsible",e).show(),t("#musicVideosContent",e).html(Y(a.Items,i)).lazyChildren()):t("#musicVideosCollapsible",e).hide()})}function E(e,a,i){ApiClient.getAdditionalVideoParts(i.Id,a.Id).then(function(a){a.Items.length?(t("#additionalPartsCollapsible",e).show(),t("#additionalPartsContent",e).html(Y(a.Items,i)).lazyChildren()):t("#additionalPartsCollapsible",e).hide()})}function O(e,t,i,r,n){var s="",l=t.Chapters||[],o=LibraryBrowser.getPosterViewInfo().backdropWidth;f()?(s+='<div class="hiddenScrollX itemsContainer">',r=null):s+='<div class="itemsContainer">';for(var d=0,c=l.length;c>d&&!(r&&d>=r);d++){var m=l[d],u=m.Name||"Chapter "+d,p="Full"!=t.PlayAccess||n?"":' onclick="ItemDetailPage.play('+m.StartPositionTicks+');"';s+='<a class="card '+T()+'Card" href="#"'+p+">",s+='<div class="cardBox">',s+='<div class="cardScalable">';var h;h=m.ImageTag?ApiClient.getScaledImageUrl(t.Id,{maxWidth:o,tag:m.ImageTag,type:"Chapter",index:d}):"css/images/items/list/chapter.png",s+='<div class="cardPadder"></div>',s+='<div class="cardContent">',s+='<div class="cardImage lazy" data-src="'+h+'"></div>',s+='<div class="cardFooter">',s+='<div class="cardText">'+u+"</div>",s+='<div class="cardText">',s+=a.getDisplayRunningTime(m.StartPositionTicks),s+="</div>",s+="</div>",s+="</div>",s+="</div>",s+="</div>",s+="</a>"}s+="</div>",r&&l.length>r&&(s+='<p style="margin: 0;"><paper-button raised class="more moreScenes">'+Globalize.translate("ButtonMore")+"</paper-button></p>");var g=e.querySelector("#scenesContent");g.innerHTML=s,ImageLoader.lazyChildren(g)}function j(e,a){var t=a.MediaSources.map(function(e){return W(a,e)}).join('<div style="border-top:1px solid #444;margin: 1em 0;"></div>');a.MediaSources.length>1&&(t="<br/>"+t);var i=e.querySelector("#mediaInfoContent");i.innerHTML=t}function W(e,a){var t="";a.Name&&e.MediaSources.length>1&&(t+='<div><span class="mediaInfoAttribute">'+a.Name+"</span></div><br/>");for(var i=0,r=a.MediaStreams.length;r>i;i++){var n=a.MediaStreams[i];if("Data"!=n.Type){t+='<div class="mediaInfoStream">';var s=Globalize.translate("MediaInfoStreamType"+n.Type);t+='<div class="mediaInfoStreamType">'+s+"</div>";var l=[];n.Language&&"Video"!=n.Type&&l.push(X(Globalize.translate("MediaInfoLanguage"),n.Language)),n.Codec&&l.push(X(Globalize.translate("MediaInfoCodec"),n.Codec.toUpperCase())),n.CodecTag&&l.push(X(Globalize.translate("MediaInfoCodecTag"),n.CodecTag)),null!=n.IsAVC&&l.push(X("AVC",n.IsAVC?"Yes":"No")),n.Profile&&l.push(X(Globalize.translate("MediaInfoProfile"),n.Profile)),n.Level&&l.push(X(Globalize.translate("MediaInfoLevel"),n.Level)),(n.Width||n.Height)&&l.push(X(Globalize.translate("MediaInfoResolution"),n.Width+"x"+n.Height)),n.AspectRatio&&"mjpeg"!=n.Codec&&l.push(X(Globalize.translate("MediaInfoAspectRatio"),n.AspectRatio)),"Video"==n.Type&&(null!=n.IsAnamorphic&&l.push(X(Globalize.translate("MediaInfoAnamorphic"),n.IsAnamorphic?"Yes":"No")),l.push(X(Globalize.translate("MediaInfoInterlaced"),n.IsInterlaced?"Yes":"No"))),(n.AverageFrameRate||n.RealFrameRate)&&l.push(X(Globalize.translate("MediaInfoFramerate"),n.AverageFrameRate||n.RealFrameRate)),n.ChannelLayout&&l.push(X(Globalize.translate("MediaInfoLayout"),n.ChannelLayout)),n.Channels&&l.push(X(Globalize.translate("MediaInfoChannels"),n.Channels+" ch")),n.BitRate&&"mjpeg"!=n.Codec&&l.push(X(Globalize.translate("MediaInfoBitrate"),parseInt(n.BitRate/1024)+" kbps")),n.SampleRate&&l.push(X(Globalize.translate("MediaInfoSampleRate"),n.SampleRate+" khz")),n.BitDepth&&l.push(X(Globalize.translate("MediaInfoBitDepth"),n.BitDepth+" bit")),n.PixelFormat&&l.push(X(Globalize.translate("MediaInfoPixelFormat"),n.PixelFormat)),n.RefFrames&&l.push(X(Globalize.translate("MediaInfoRefFrames"),n.RefFrames)),n.NalLengthSize&&l.push(X("NAL",n.NalLengthSize)),"Video"!=n.Type&&l.push(X(Globalize.translate("MediaInfoDefault"),n.IsDefault?"Yes":"No")),"Subtitle"==n.Type&&(l.push(X(Globalize.translate("MediaInfoForced"),n.IsForced?"Yes":"No")),l.push(X(Globalize.translate("MediaInfoExternal"),n.IsExternal?"Yes":"No"))),"Video"==n.Type&&a.Timestamp&&l.push(X(Globalize.translate("MediaInfoTimestamp"),a.Timestamp)),n.DisplayTitle&&l.push(X("Title",n.DisplayTitle)),t+=l.join("<br/>"),t+="</div>"}}if(a.Container&&(t+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoContainer")+'</span><span class="mediaInfoAttribute">'+a.Container+"</span></div>"),a.Formats&&a.Formats.length,a.Path&&"Http"!=a.Protocol&&(t+='<div style="max-width:600px;overflow:hidden;"><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoPath")+'</span><span class="mediaInfoAttribute">'+a.Path+"</span></div>"),a.Size){var o=(a.Size/1048576).toFixed(0);t+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoSize")+'</span><span class="mediaInfoAttribute">'+o+" MB</span></div>"}return t}function X(e,a){return'<span class="mediaInfoLabel">'+e+'</span><span class="mediaInfoAttribute">'+a+"</span>"}function Y(e,t,i,r){for(var n="",s=LibraryBrowser.getPosterViewInfo().backdropWidth,l=0,o=e.length;o>l&&!(i&&l>=i);l++){var d=e[l],c="card detailPage169Card",m="itemdetails.html?id="+d.Id,u="Full"==d.PlayAccess?" onclick=\"MediaController.play('"+d.Id+"'); return false;\"":"";n+='<a class="'+c+'" href="'+m+'"'+u+">",n+='<div class="cardBox">',n+='<div class="cardScalable">';var p,h=d.ImageTags||{};p=h.Primary?ApiClient.getScaledImageUrl(d.Id,{maxWidth:s,tag:h.Primary,type:"primary"}):"css/images/items/detail/video.png",n+='<div class="cardPadder"></div>',n+='<div class="cardContent">',n+='<div class="cardImage lazy" data-src="'+p+'"></div>',n+='<div class="cardFooter">',n+='<div class="cardText">'+d.Name+"</div>",n+='<div class="cardText">',n+=""!=d.RunTimeTicks?a.getDisplayRunningTime(d.RunTimeTicks):"&nbsp;",n+="</div>",n+="</div>",n+="</div>",n+="</div>",n+="</div>",n+="</a>"}return i&&e.length>i&&(n+='<p style="margin: 0;padding-left:5px;"><paper-button raised class="more '+r+'">'+Globalize.translate("ButtonMore")+"</paper-button></p>"),n}function K(e,a,t,i){ApiClient.getSpecialFeatures(t.Id,a.Id).then(function(a){var r=e.querySelector("#specialsContent");r.innerHTML=Y(a,t,i,"moreSpecials"),ImageLoader.lazyChildren(r)})}function _(e,a,t,i,r){if(f())return void Q(e,a,t,r);for(var n="",s=a.People||[],l=0,o=s.length;o>l&&!(i&&l>=i);l++){var d=s[l],c=r?"#":"itemdetails.html?id="+d.Id;n+='<a class="tileItem smallPosterTileItem" href="'+c+'">';var m,u=!0;d.PrimaryImageTag?m=ApiClient.getScaledImageUrl(d.Id,{maxWidth:100,tag:d.PrimaryImageTag,type:"primary",minScale:2}):(m="css/images/items/list/person.png",u=!1),n+=u?'<div class="tileImage lazy" data-src="'+m+'"></div>':'<div class="tileImage" style="background-image:url(\''+m+"');\"></div>",n+='<div class="tileContent">',n+="<p>"+d.Name+"</p>";var p=d.Role?Globalize.translate("ValueAsRole",d.Role):d.Type;"GuestStar"==p&&(p=Globalize.translate("ValueGuestStar")),p=p||"";var h=40;p.length>h&&(p=p.substring(0,h-3)+"..."),n+="<p>"+p+"</p>",n+="</div>",n+="</a>"}i&&s.length>i&&(n+='<p style="margin: 0;padding-left:5px;"><paper-button raised class="more morePeople">'+Globalize.translate("ButtonMore")+"</paper-button></p>");var g=e.querySelector("#castContent");g.innerHTML=n,ImageLoader.lazyChildren(g)}function Q(e,a,t,i){var r="";r+=f()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">';var n=a.People||[];n=n.filter(function(e){return e.PrimaryImageTag}),n.length||(n=a.People||[]);for(var s=0,l=n.length;l>s;s++){var o=n[s],d=i?"#":"itemdetails.html?id="+o.Id;r+='<div class="card '+I()+'Card">',r+='<div class="cardBox">',r+='<div class="cardScalable">';var c,m=!0;o.PrimaryImageTag?c=ApiClient.getScaledImageUrl(o.Id,{maxWidth:100,tag:o.PrimaryImageTag,type:"primary",minScale:2}):(c="css/images/items/list/person.png",m=!1),r+='<div class="cardPadder"></div>',r+='<a class="cardContent" href="'+d+'">',r+=m?'<div class="cardImage coveredCardImage lazy" data-src="'+c+'"></div>':'<div class="cardImage coveredCardImage" style="background-image:url(\''+c+"');\"></div>",r+="</div>",r+="</a>",r+="</div>",r+='<div class="cardFooter outerCardFooter">',r+='<div class="cardText">'+o.Name+"</div>",r+='<div class="cardText">';var u=o.Role?Globalize.translate("ValueAsRole",o.Role):o.Type;"GuestStar"==u&&(u=Globalize.translate("ValueGuestStar")),u=u||"";var p=40;u.length>p&&(u=u.substring(0,p-3)+"..."),r+=u,r+="</div>",r+="</div>",r+="</div>"}r+="</div>";var h=e.querySelector("#castContent");h.innerHTML=r,ImageLoader.lazyChildren(h)}function J(e){MediaController.play({items:[ra],startPositionTicks:e})}function Z(e){var a=getParameterByName("id");require(["confirm"],function(t){t("Are you sure you wish to split the media sources into separate items?","Split Media Apart").then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Videos/"+a+"/AlternateSources")}).then(function(){Dashboard.hideLoadingMsg(),n(e)})})})}function $(){ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),ra.Id).then(function(e){MediaController.play({items:e})})}function ea(e,a){ra&&ra.Id==a&&("Recording"==ra.Type?LibraryBrowser.showTab("livetv.html",3):Dashboard.navigate("home.html"))}function aa(e){if("Program"==ra.Type)return void ApiClient.getLiveTvChannel(ra.ChannelId,Dashboard.getCurrentUserId()).then(function(e){LibraryBrowser.showPlayMenu(null,e.Id,e.Type,!1,e.MediaType,(e.UserData||{}).PlaybackPositionTicks)});var a=ra.UserData||{},t=ra.MediaType;("MusicArtist"==ra.Type||"MusicAlbum"==ra.Type)&&(t="Audio"),LibraryBrowser.showPlayMenu(e,ra.Id,ra.Type,ra.IsFolder,t,a.PlaybackPositionTicks)}function ta(e,a){require(["confirm"],function(t){t(Globalize.translate("MessageConfirmRecordingCancellation"),Globalize.translate("HeaderConfirmRecordingCancellation")).then(function(){Dashboard.showLoadingMsg(),ApiClient.cancelLiveTvTimer(a).then(function(){require(["toast"],function(e){e(Globalize.translate("MessageRecordingCancelled"))}),n(e)})})})}function ia(){var e=this;e.play=J,e.setInitialCollapsibleState=p,e.renderDetails=h,e.renderCriticReviews=F,e.renderCast=_,e.renderScenes=O,e.renderMediaSources=j}var ra;t.fn.lazyChildren=function(){for(var e=0,a=this.length;a>e;e++)ImageLoader.lazyChildren(this[e]);return this};var na=null;pageIdOn("pageinit","itemDetailPage",function(){var e=this;t(".btnPlay",e).on("click",function(){aa(this)}),t(".btnPlayTrailer",e).on("click",function(){$(e)}),t(".btnSplitVersions",e).on("click",function(){Z(e)}),t(".btnSync",e).on("click",function(){require(["syncDialog"],function(e){e.showMenu({items:[ra]})})}),t(".btnRecord,.btnFloatingRecord",e).on("click",function(){var a=getParameterByName("id");Dashboard.showLoadingMsg(),require(["recordingCreator"],function(t){t.show(a,ra.ServerId).then(function(){n(e)})})}),t(".btnCancelRecording",e).on("click",function(){ta(e,ra.TimerId)}),t(".btnMoreCommands",e).on("click",function(){var e=this;Dashboard.getCurrentUser().then(function(a){LibraryBrowser.showMoreCommands(e,ra.Id,ra.Type,LibraryBrowser.getMoreCommands(ra,a))})}),t(".childrenItemsContainer",e).on("playallfromhere",function(e,a){LibraryBrowser.playAllFromHere(na,a)}).on("queueallfromhere",function(e,a){LibraryBrowser.queueAllFromHere(na,a)}),t(e).on("click",".moreScenes",function(){Dashboard.getCurrentUser().then(function(a){O(e,ra,a)})}).on("click",".morePeople",function(){_(e,ra,m(ra))}).on("click",".moreSpecials",function(){Dashboard.getCurrentUser().then(function(a){K(e,ra,a)})}).on("click",".moreCriticReviews",function(){F(e,ra)})}),pageIdOn("pagebeforeshow","itemDetailPage",function(){var e=this;n(e),Events.on(ApiClient,"websocketmessage",d),Events.on(LibraryBrowser,"itemdeleting",ea)}),pageIdOn("pagebeforehide","itemDetailPage",function(){Events.off(LibraryBrowser,"itemdeleting",ea),ra=null;Events.off(ApiClient,"websocketmessage",d),LibraryMenu.setTransparentMenu(!1)}),window.ItemDetailPage=new ia});