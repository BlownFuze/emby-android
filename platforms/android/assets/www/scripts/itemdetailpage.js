define(["layoutManager","datetime","jQuery","mediaInfo","backdrop","scrollStyles"],function(e,a,t,i,r){function s(e){var a=e.id;if(a)return ApiClient.getItem(Dashboard.getCurrentUserId(),a);var t=e.genre;if(t)return ApiClient.getGenre(t,Dashboard.getCurrentUserId());if(t=e.musicgenre)return ApiClient.getMusicGenre(t,Dashboard.getCurrentUserId());if(t=e.gamegenre)return ApiClient.getGameGenre(t,Dashboard.getCurrentUserId());if(t=e.musicartist)return ApiClient.getArtist(t,Dashboard.getCurrentUserId());throw new Error("Invalid request")}function n(e,a){Dashboard.showLoadingMsg(),s(a).then(function(t){l(e,a,t)})}function l(i,s,n){ia=n;var l=s.context;LibraryMenu.setBackButtonVisible(!0),LibraryMenu.setMenuButtonVisible(!1),LibraryBrowser.renderName(n,t(".itemName",i),!1,l),LibraryBrowser.renderParentName(n,t(".parentName",i),l),LibraryMenu.setTitle(n.SeriesName||n.Name),Dashboard.getCurrentUser().then(function(s){window.scrollTo(0,0),o(i,n,s),m(i,n,l,s),p(i,n,l);var d=!1;"MusicArtist"!=n.Type&&"MusicAlbum"!=n.Type&&"Playlist"!=n.Type&&"BoxSet"!=n.Type&&"Audio"!=n.MediaType&&e.mobile?(d=LibraryBrowser.renderDetailPageBackdrop(i,n),r.clear()):(t("#itemBackdrop",i).addClass("noBackdrop").css("background-image","none"),r.setBackdrops([n]));var c=d&&i.classList.contains("noSecondaryNavPage");LibraryMenu.setTransparentMenu(c);var u=!1;if("Program"==n.Type){var h=new Date;h>=a.parseISO8601Date(n.StartDate,!0)&&h<a.parseISO8601Date(n.EndDate,!0)?(t(".btnPlay",i).removeClass("hide"),u=!0):t(".btnPlay",i).addClass("hide")}else MediaController.canPlay(n)?(t(".btnPlay",i).removeClass("hide"),u=!0):t(".btnPlay",i).addClass("hide");n.LocalTrailerCount&&"Full"==n.PlayAccess?t(".btnPlayTrailer",i).removeClass("hide"):t(".btnPlayTrailer",i).addClass("hide"),LibraryBrowser.enableSync(n,s)?t(".btnSync",i).removeClass("hide"):t(".btnSync",i).addClass("hide"),"Program"==n.Type&&n.TimerId?t(".btnCancelRecording",i).removeClass("hide"):t(".btnCancelRecording",i).addClass("hide"),"Program"!=n.Type||n.TimerId||n.SeriesTimerId?(t(".btnRecord",i).addClass("hide"),t(".btnFloatingRecord",i).addClass("hide")):u?(t(".btnRecord",i).removeClass("hide"),t(".btnFloatingRecord",i).addClass("hide")):(t(".btnRecord",i).addClass("hide"),t(".btnFloatingRecord",i).removeClass("hide")),!n.LocalTrailerCount&&n.RemoteTrailers.length&&"Full"==n.PlayAccess?t(".btnPlayExternalTrailer",i).removeClass("hide").attr("href",n.RemoteTrailers[0].Url):t(".btnPlayExternalTrailer",i).addClass("hide").attr("href","#");var y=(n.MediaSources||[]).filter(function(e){return"Grouping"==e.Type});if(s.Policy.IsAdministrator&&y.length?t(".splitVersionContainer",i).show():t(".splitVersionContainer",i).hide(),LibraryBrowser.getMoreCommands(n,s).length>0?t(".btnMoreCommands",i).removeClass("hide"):t(".btnMoreCommands",i).addClass("hide"),s.Policy.IsAdministrator?t(".chapterSettingsButton",i).show():t(".chapterSettingsButton",i).hide(),"Person"==n.Type&&n.PremiereDate)try{var g=a.parseISO8601Date(n.PremiereDate,!0).toDateString();t("#itemBirthday",i).show().html(Globalize.translate("BirthDateValue").replace("{0}",g))}catch(b){t("#itemBirthday",i).hide()}else t("#itemBirthday",i).hide();if("Person"==n.Type&&n.EndDate)try{var v=a.parseISO8601Date(n.EndDate,!0).toDateString();t("#itemDeathDate",i).show().html(Globalize.translate("DeathDateValue").replace("{0}",v))}catch(b){t("#itemBirthday",i).hide()}if("Person"==n.Type&&n.ProductionLocations&&n.ProductionLocations.length){var f='<a class="textlink" target="_blank" href="https://maps.google.com/maps?q='+n.ProductionLocations[0]+'">'+n.ProductionLocations[0]+"</a>";t("#itemBirthLocation",i).show().html(Globalize.translate("BirthPlaceValue").replace("{0}",f))}else t("#itemBirthLocation",i).hide()}),"Offline"==n.LocationType?t(".offlineIndicator",i).show():t(".offlineIndicator",i).hide();var d=!1;if("Virtual"==n.LocationType&&"Episode"==n.Type)try{n.PremiereDate&&(new Date).getTime()>=a.parseISO8601Date(n.PremiereDate,!0).getTime()&&(d=!0)}catch(u){}d?t(".missingIndicator",i).show():t(".missingIndicator",i).hide(),c(i,n),i.dispatchEvent(new CustomEvent("displayingitem",{detail:{item:n,context:l},bubbles:!0})),Dashboard.hideLoadingMsg()}function o(e,a,t){LibraryBrowser.renderDetailImage(e.querySelector(".detailImageContainer"),a,t.Policy.IsAdministrator&&"Photo"!=a.MediaType)}function d(e,a){LibraryBrowser.refreshDetailImageUserData(e.querySelector(".detailImageContainer"),a)}function c(e,a){t("#peopleHeader",e).html("Audio"==a.MediaType||"MusicAlbum"==a.Type||"Book"==a.MediaType||"Photo"==a.MediaType?Globalize.translate("HeaderPeople"):Globalize.translate("HeaderCastAndCrew"))}function u(e,a,t){var i=e.querySelector(".nextUpSection"),r=a.UserData||{};return"Series"==a.Type&&r.PlayedPercentage?void ApiClient.getNextUpEpisodes({SeriesId:a.Id,UserId:t.Id}).then(function(e){e.Items.length?i.classList.remove("hide"):i.classList.add("hide");var t=LibraryBrowser.getPosterViewHtml({items:e.Items,shape:"detailPage169",showTitle:!0,displayAsSpecial:"Season"==a.Type&&a.IndexNumber,overlayText:!0,lazy:!0,overlayPlayButton:!0}),r=i.querySelector(".nextUpItems");r.innerHTML=t,ImageLoader.lazyChildren(r),LibraryBrowser.createCardMenus(r)}):void i.classList.add("hide")}function m(e,a,i,r){t(".collectionItems",e).empty(),"TvChannel"==a.Type?(t("#childrenCollapsible",e).removeClass("hide"),z(e,a,r)):"Playlist"==a.Type?(t("#childrenCollapsible",e).removeClass("hide"),D(e,a,r)):"Studio"==a.Type||"Person"==a.Type||"Genre"==a.Type||"MusicGenre"==a.Type||"GameGenre"==a.Type||"MusicArtist"==a.Type?(t("#childrenCollapsible",e).removeClass("hide"),P(e,a,r)):a.IsFolder?("BoxSet"==a.Type?t("#childrenCollapsible",e).addClass("hide"):t("#childrenCollapsible",e).removeClass("hide"),A(e,a)):t("#childrenCollapsible",e).addClass("hide"),"Series"==a.Type?u(e,a,r):e.querySelector(".nextUpSection").classList.add("hide"),a.MediaSources&&a.MediaSources.length&&O(e,a);var s=a.Chapters||[];s.length&&AppInfo.enableDetailPageChapters?(t("#scenesCollapsible",e).show(),N(e,a,r,3)):t("#scenesCollapsible",e).hide(),a.SpecialFeatureCount&&0!=a.SpecialFeatureCount&&"Series"!=a.Type?(t("#specialsCollapsible",e).removeClass("hide"),Y(e,a,r,6)):t("#specialsCollapsible",e).addClass("hide"),a.People&&a.People.length?(t("#castCollapsible",e).show(),_(e,a,i,v()?null:6)):t("#castCollapsible",e).hide(),a.PartCount&&a.PartCount>1?(t("#additionalPartsCollapsible",e).removeClass("hide"),E(e,a,r)):t("#additionalPartsCollapsible",e).addClass("hide"),e.querySelector("#themeSongsCollapsible").classList.add("hide"),e.querySelector("#themeVideosCollapsible").classList.add("hide"),"MusicAlbum"==a.Type?U(e,a,r):t("#musicVideosCollapsible",e).hide(),q(e,a,r),v()?k(e,a):k(e,a,1)}function p(e,a,r,s){T(e,a,r),s||b(e,a,r),a.Taglines&&a.Taglines.length?t(".tagline",e).html(a.Taglines[0]).show():t(".tagline",e).hide();var n=e.querySelector(".topOverview"),l=e.querySelector(".bottomOverview"),o=screen.availHeight<800||screen.availWidth<600;"MusicAlbum"==a.Type||"MusicArtist"==a.Type||"Season"==a.Type&&o?(LibraryBrowser.renderOverview([l],a),n.classList.add("hide"),l.classList.remove("hide")):(LibraryBrowser.renderOverview([n],a),n.classList.remove("hide"),l.classList.add("hide")),LibraryBrowser.renderAwardSummary(t("#awardSummary",e),a),t(".itemMiscInfo",e).each(function(){i.fillPrimaryMediaInfo(this,a,{interactive:!0})}),t(".itemGenres",e).each(function(){LibraryBrowser.renderGenres(this,a,null,s)}),LibraryBrowser.renderStudios(t(".itemStudios",e),a,s),x(e,a),LibraryBrowser.renderLinks(e.querySelector(".itemExternalLinks"),a),t(".criticRatingScore",e).html((a.CriticRating||"0")+"%"),a.CriticRatingSummary?(t("#criticRatingSummary",e).show(),t(".criticRatingSummaryText",e).html(a.CriticRatingSummary)):t("#criticRatingSummary",e).hide(),L(e,a),S(e,a,s),a.Players?t("#players",e).show().html(a.Players+" Player"):t("#players",e).hide(),a.ArtistItems&&a.ArtistItems.length&&"MusicAlbum"!=a.Type?t(".artist",e).show().html(g(a.ArtistItems,r)):t(".artist",e).hide(),a.MediaSources&&a.MediaSources.length&&a.Path?t(".audioVideoMediaInfo",e).removeClass("hide"):t(".audioVideoMediaInfo",e).addClass("hide"),"Photo"==a.MediaType?(t(".photoInfo",e).removeClass("hide"),h(e,a)):t(".photoInfo",e).addClass("hide"),y(e,a)}function h(e,a){var i="",r=[];if(a.CameraMake&&r.push(W(Globalize.translate("MediaInfoCameraMake"),a.CameraMake)),a.CameraModel&&r.push(W(Globalize.translate("MediaInfoCameraModel"),a.CameraModel)),a.Altitude&&r.push(W(Globalize.translate("MediaInfoAltitude"),a.Altitude.toFixed(1))),a.Aperture&&r.push(W(Globalize.translate("MediaInfoAperture"),"F"+a.Aperture.toFixed(1))),a.ExposureTime){var s=1/a.ExposureTime;r.push(W(Globalize.translate("MediaInfoExposureTime"),"1/"+s+" s"))}a.FocalLength&&r.push(W(Globalize.translate("MediaInfoFocalLength"),a.FocalLength.toFixed(1)+" mm")),a.ImageOrientation,a.IsoSpeedRating&&r.push(W(Globalize.translate("MediaInfoIsoSpeedRating"),a.IsoSpeedRating)),a.Latitude&&r.push(W(Globalize.translate("MediaInfoLatitude"),a.Latitude.toFixed(1))),a.Longitude&&r.push(W(Globalize.translate("MediaInfoLongitude"),a.Longitude.toFixed(1))),a.ShutterSpeed&&r.push(W(Globalize.translate("MediaInfoShutterSpeed"),a.ShutterSpeed)),a.Software&&r.push(W(Globalize.translate("MediaInfoSoftware"),a.Software)),i+=r.join("<br/>"),t(".photoInfoContent",e).html(i)}function y(e){var a=t(".tabDetails",e)[0],i=a.textContent||a.innerText||"";i.trim()?t(".detailsSection",e).removeClass("hide"):t(".detailsSection",e).addClass("hide")}function g(e){for(var a=[],t=0,i=e.length;i>t;t++){var r=e[t];a.push('<a class="textlink" href="itemdetails.html?id='+r.Id+'">'+r.Name+"</a>")}return a=a.join(" / "),1==e.length?Globalize.translate("ValueArtist",a):e.length>1?Globalize.translate("ValueArtists",a):a}function b(e,a,i){if(t(".lnkSibling",e).addClass("hide"),"Episode"==a.Type||"Season"==a.Type||"Audio"==a.Type||"Photo"==a.Type){var r;r="Season"==a.Type?ApiClient.getSeasons(a.SeriesId,{userId:Dashboard.getCurrentUserId(),AdjacentTo:a.Id}):"Episode"==a.Type&&a.SeasonId?ApiClient.getEpisodes(a.SeriesId,{seasonId:a.SeasonId,userId:Dashboard.getCurrentUserId(),AdjacentTo:a.Id}):ApiClient.getItems(Dashboard.getCurrentUserId(),{AdjacentTo:a.Id,ParentId:a.ParentId,SortBy:"SortName"}),i=i||"",r.then(function(r){for(var s=!1,n=0,l=r.Items.length;l>n;n++){var o=r.Items[n];o.Id==a.Id?s=!0:s?t(".lnkNextItem",e).removeClass("hide").attr("href","itemdetails.html?id="+o.Id+"&context="+i):t(".lnkPreviousItem",e).removeClass("hide").attr("href","itemdetails.html?id="+o.Id+"&context="+i)}})}}function v(){return browserInfo.mobile&&AppInfo.enableAppLayouts&&screen.availWidth<=1e3}function f(){return v()?"overflowPortrait":"detailPagePortrait"}function I(){return v()?"overflowSquare":"detailPageSquare"}function C(){return v()?"overflowBackdrop":"detailPage169"}function T(e,a,i){if("Movie"!=a.Type&&"Trailer"!=a.Type&&"Series"!=a.Type&&"Program"!=a.Type&&"Recording"!=a.Type&&"Game"!=a.Type&&"MusicAlbum"!=a.Type&&"MusicArtist"!=a.Type&&"ChannelVideoItem"!=a.Type)return void t("#similarCollapsible",e).hide();t("#similarCollapsible",e).show();var r="MusicAlbum"==a.Type||"MusicArtist"==a.Type?I():f(),s=window.innerWidth,n=window.innerHeight,l={userId:Dashboard.getCurrentUserId(),limit:s>800&&"detailPagePortrait"==r?4:4,fields:"PrimaryImageAspectRatio,UserData,SyncInfo,CanDelete"};s>=800&&n>=1e3&&(l.limit*=2),v()&&(l.limit=12),ApiClient.getSimilarItems(a.Id,l).then(function(s){if(!s.Items.length)return void t("#similarCollapsible",e).hide();var n=t("#similarCollapsible",e).show();t(".similiarHeader",n).html(Globalize.translate("HeaderIfYouLikeCheckTheseOut",a.Name));var l="";l+=v()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">',l+=LibraryBrowser.getPosterViewHtml({items:s.Items,shape:r,showParentTitle:"MusicAlbum"==a.Type,centerText:!0,showTitle:"MusicAlbum"==a.Type||"Game"==a.Type||"MusicArtist"==a.Type,borderless:"Game"==a.Type,context:i,lazy:!0,showDetailsMenu:!0,coverImage:"MusicAlbum"==a.Type||"MusicArtist"==a.Type,overlayPlayButton:!0}),l+="</div>";var o=e.querySelector("#similarContent");o.innerHTML=l,ImageLoader.lazyChildren(o),LibraryBrowser.createCardMenus(o)})}function S(e,a,t){var i=e.querySelector("#seriesAirTime");if("Series"!=a.Type)return void i.classList.add("hide");var r="";a.AirDays&&a.AirDays.length&&(r+=7==a.AirDays.length?"daily":a.AirDays.map(function(e){return e+"s"}).join(",")),a.AirTime&&(r+=" at "+a.AirTime),a.Studios.length&&(r+=t?" on "+a.Studios[0].Name:' on <a class="textlink" href="itemdetails.html?id='+a.Studios[0].Id+'">'+a.Studios[0].Name+"</a>"),r?(r=("Ended"==a.Status?"Aired ":"Airs ")+r,i.innerHTML=r,i.classList.remove("hide")):i.classList.add("hide")}function L(e,a){var t=e.querySelector(".itemTags");if(a.Tags&&a.Tags.length){var i="";i+="<p>"+Globalize.translate("HeaderTags")+"</p>";for(var r=0,s=a.Tags.length;s>r;r++)i+='<div class="itemTag">'+a.Tags[r]+"</div>";t.innerHTML=i,t.classList.remove("hide")}else t.classList.add("hide")}function M(e,a){return a=Object.assign({},a),function(t,i,r){return a.StartIndex=t,a.Limit=i,a.Fields=r,ApiClient.getEpisodes(e,a)}}function w(e){return e=Object.assign({},e),function(a,t,i){return e.StartIndex=a,e.Limit=t,e.Fields=i,ApiClient.getItems(Dashboard.getCurrentUserId(),e)}}function A(e,a){ra=null;var i="ItemCounts,AudioInfo,PrimaryImageAspectRatio,SyncInfo,CanDelete",r={ParentId:a.Id,Fields:i};"BoxSet"!==a.Type&&(r.SortBy="SortName");var s,n=Dashboard.getCurrentUserId();"Series"==a.Type?s=ApiClient.getSeasons(a.Id,{userId:n,Fields:i}):"Season"==a.Type?(s=ApiClient.getEpisodes(a.SeriesId,{seasonId:a.Id,userId:n,Fields:i}),ra=M(a.SeriesId,{seasonId:a.Id,userId:n,Fields:i})):"MusicAlbum"==a.Type&&(ra=w(r)),s=s||ApiClient.getItems(Dashboard.getCurrentUserId(),r),s.then(function(t){var i="",r=!1;"MusicAlbum"==a.Type?i=LibraryBrowser.getListViewHtml({items:t.Items,smallIcon:!0,showIndex:!0,index:"disc",showIndexNumber:!0,playFromHere:!0,defaultAction:"playallfromhere",lazy:!0}):"Series"==a.Type?(r=v(),i=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:f(),showTitle:!0,centerText:!0,lazy:!0,overlayPlayButton:!0})):"Season"==a.Type?i=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"detailPage169",showTitle:!0,displayAsSpecial:"Season"==a.Type&&a.IndexNumber,playFromHere:!0,overlayText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:AppInfo.enableAppLayouts}):"GameSystem"==a.Type&&(i=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"auto",showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0}));var s=e.querySelector(".childrenItemsContainer");if(s.innerHTML=i,ImageLoader.lazyChildren(s),r?s.classList.add("hiddenScrollX"):s.classList.remove("hiddenScrollX"),LibraryBrowser.createCardMenus(s),"BoxSet"==a.Type){var n=[{name:Globalize.translate("HeaderMovies"),type:"Movie"},{name:Globalize.translate("HeaderSeries"),type:"Series"},{name:Globalize.translate("HeaderAlbums"),type:"MusicAlbum"},{name:Globalize.translate("HeaderGames"),type:"Game"},{name:Globalize.translate("HeaderBooks"),type:"Book"}];G(e,a,n,t.Items)}}),e.querySelector("#childrenTitle").innerHTML=Globalize.translate("Season"==a.Type?"HeaderEpisodes":"Series"==a.Type?"HeaderSeasons":"MusicAlbum"==a.Type?"HeaderTracks":"GameSystem"==a.Type?"HeaderGames":"HeaderItems"),"MusicAlbum"==a.Type?t(".childrenSectionHeader",e).hide():t(".childrenSectionHeader",e).show()}function P(e,a){require("scripts/itembynamedetailpage".split(","),function(){window.ItemsByName.renderItems(e,a)})}function D(e,a){require("scripts/playlistedit".split(","),function(){PlaylistViewer.render(e,a)})}function z(e,a){require("scripts/livetvcomponents,scripts/livetvchannel,livetvcss".split(","),function(){LiveTvChannelPage.renderPrograms(e,a.Id)})}function G(e,a,t,i){e.querySelector(".collectionItems").innerHTML="";var r,s;for(r=0,s=t.length;s>r;r++){var n=t[r],l=i.filter(function(e){return e.Type==n.type});l.length&&B(e,a,n,l)}var o={name:Globalize.translate("HeaderOtherItems")},d=i.filter(function(e){return!t.filter(function(a){return a.type==e.Type}).length});d.length&&B(e,a,o,d),i.length||B(e,a,{name:Globalize.translate("HeaderItems")},i);var c=e.querySelectorAll(".collectionItems .itemsContainer");for(r=0,s=c.length;s>r;r++)LibraryBrowser.createCardMenus(c[r])}function B(e,a,t,i){var r="";r+='<div class="detailSection">',r+='<div style="display:flex;align-items:center;">',r+="<h1>",r+="<span>"+t.name+"</span>",r+="</h1>",r+='<button class="btnAddToCollection autoSize" type="button" is="paper-icon-button-light" style="margin-left:1em;"><i class="md-icon" icon="add">add</i></button>',r+="</div>",r+='<div class="detailSectionContent itemsContainer">';var s="MusicAlbum"==t.type?"detailPageSquare":"detailPagePortrait";r+=LibraryBrowser.getPosterViewHtml({items:i,shape:s,showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0,overlayMoreButton:!0,showAddToCollection:!1,showRemoveFromCollection:!0}),r+="</div>",r+="</div>";var n=e.querySelector(".collectionItems");n.insertAdjacentHTML("beforeend",r),ImageLoader.lazyChildren(n),n.querySelector(".btnAddToCollection").addEventListener("click",function(){require(["alert"],function(e){e({text:Globalize.translate("AddItemToCollectionHelp"),html:Globalize.translate("AddItemToCollectionHelp")+'<br/><br/><a target="_blank" href="https://github.com/MediaBrowser/Wiki/wiki/Collections">'+Globalize.translate("ButtonLearnMore")+"</a>"})})})}function R(e,a,t){Dashboard.showLoadingMsg();var i=ApiClient.getUrl("Collections/"+a.Id+"/Items",{Ids:t.join(",")});ApiClient.ajax({type:"DELETE",url:i}).then(function(){A(e,a),Dashboard.hideLoadingMsg()})}function x(e,a){t(".userDataIcons",e).html(LibraryBrowser.getUserDataIconsHtml(a,!0,"icon-button"))}function k(e,a,t){if("Movie"!=a.Type&&"Trailer"!=a.Type&&"MusicVideo"!=a.Type)return void e.querySelector("#criticReviewsCollapsible").classList.add("hide");var i={};t&&(i.limit=t),ApiClient.getCriticReviews(a.Id,i).then(function(i){i.TotalRecordCount||a.CriticRatingSummary||a.AwardSummary?(e.querySelector("#criticReviewsCollapsible").classList.remove("hide"),H(e,i,t)):e.querySelector("#criticReviewsCollapsible").classList.add("hide")})}function H(e,t,i){for(var r="",s=t.Items,n=0,l=s.length;l>n;n++){var o=s[n];r+='<div class="paperList criticReviewPaperList">',r+='<paper-icon-item style="padding-top:.5em;padding-bottom:.5em;">',null!=o.Score||null!=o.Likes&&(r+=o.Likes?"<paper-fab mini style=\"background-color:transparent;background-image:url('css/images/fresh.png');background-repeat:no-repeat;background-position:center center;background-size: cover;\" item-icon></paper-fab>":"<paper-fab mini style=\"background-color:transparent;background-image:url('css/images/rotten.png');background-repeat:no-repeat;background-position:center center;background-size: cover;\" item-icon></paper-fab>"),r+="<paper-item-body three-line>",r+='<div style="white-space:normal;">'+o.Caption+"</div>";var d=[];if(o.ReviewerName&&d.push(o.ReviewerName),o.Publisher&&d.push(o.Publisher),r+="<div secondary>"+d.join(", ")+".",o.Date)try{var c=a.parseISO8601Date(o.Date,!0).toLocaleDateString();r+='<span class="reviewDate">'+c+"</span>"}catch(u){}r+="</div>",o.Url&&(r+='<div secondary><a class="textlink" href="'+o.Url+'" target="_blank">'+Globalize.translate("ButtonFullReview")+"</a></div>"),r+="</paper-item-body>",r+="</paper-icon-item>",r+="</div>"}i&&t.TotalRecordCount>i&&(r+='<p style="margin: 0;"><button is="emby-button" type="button" class="raised more moreCriticReviews">'+Globalize.translate("ButtonMore")+"</button></p>");var m=e.querySelector("#criticReviewsContent");m.innerHTML=r,v()?m.classList.add("hiddenScrollX"):m.classList.remove("hiddenScrollX")}function q(e,a){ApiClient.getThemeMedia(Dashboard.getCurrentUserId(),a.Id,!0).then(function(t){var i=t.ThemeSongsResult.OwnerId==a.Id?t.ThemeSongsResult.Items:[],r=t.ThemeVideosResult.OwnerId==a.Id?t.ThemeVideosResult.Items:[];F(e,i),V(e,r),e.dispatchEvent(new CustomEvent("thememediadownload",{detail:{themeMediaResult:t},bubbles:!0}))})}function F(e,a){if(a.length){e.querySelector("#themeSongsCollapsible").classList.remove("hide");var t=LibraryBrowser.getListViewHtml({items:a,smallIcon:!0});e.querySelector("#themeSongsContent").innerHTML=t}else e.querySelector("#themeSongsCollapsible").classList.add("hide")}function V(e,a,t){if(a.length){e.querySelector("#themeVideosCollapsible").classList.remove("hide");var i=e.querySelector("#themeVideosContent");i.innerHTML=X(a,t),ImageLoader.lazyChildren(i)}else e.querySelector("#themeVideosCollapsible").classList.add("hide")}function U(e,a,t){ApiClient.getItems(t.Id,{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",Recursive:!0,Fields:"DateCreated,SyncInfo,CanDelete",Albums:a.Name}).then(function(a){if(a.Items.length){e.querySelector("#musicVideosCollapsible").classList.remove("hide");var i=e.querySelector(".musicVideosContent");i.innerHTML=X(a.Items,t),ImageLoader.lazyChildren(i)}else e.querySelector("#musicVideosCollapsible").classList.add("hide")})}function E(e,a,t){ApiClient.getAdditionalVideoParts(t.Id,a.Id).then(function(a){if(a.Items.length){e.querySelector("#additionalPartsCollapsible").classList.remove("hide");var i=e.querySelector("#additionalPartsContent");i.innerHTML=X(a.Items,t),ImageLoader.lazyChildren(i)}else e.querySelector("#additionalPartsCollapsible").classList.add("hide")})}function N(e,t,i,r,s){var n="",l=t.Chapters||[],o=LibraryBrowser.getPosterViewInfo().backdropWidth;v()?(n+='<div class="hiddenScrollX itemsContainer">',r=null):n+='<div class="itemsContainer">';for(var d=0,c=l.length;c>d&&!(r&&d>=r);d++){var u=l[d],m=u.Name||"Chapter "+d,p="Full"!=t.PlayAccess||s?"":' onclick="ItemDetailPage.play('+u.StartPositionTicks+');"';n+='<a class="card '+C()+'Card" href="#"'+p+">",n+='<div class="cardBox">',n+='<div class="cardScalable">';var h;h=u.ImageTag?ApiClient.getScaledImageUrl(t.Id,{maxWidth:o,tag:u.ImageTag,type:"Chapter",index:d}):"css/images/items/list/chapter.png",n+='<div class="cardPadder"></div>',n+='<div class="cardContent">',n+='<div class="cardImage lazy" data-src="'+h+'"></div>',n+='<div class="cardFooter">',n+='<div class="cardText">'+m+"</div>",n+='<div class="cardText">',n+=a.getDisplayRunningTime(u.StartPositionTicks),n+="</div>",n+="</div>",n+="</div>",n+="</div>",n+="</div>",n+="</a>"}n+="</div>",r&&l.length>r&&(n+='<p style="margin: 0;"><button is="emby-button" type="button" class="raised more moreScenes">'+Globalize.translate("ButtonMore")+"</button></p>");var y=e.querySelector("#scenesContent");y.innerHTML=n,ImageLoader.lazyChildren(y)}function O(e,a){var t=a.MediaSources.map(function(e){return j(a,e)}).join('<div style="border-top:1px solid #444;margin: 1em 0;"></div>');a.MediaSources.length>1&&(t="<br/>"+t);var i=e.querySelector("#mediaInfoContent");i.innerHTML=t}function j(e,a){var t="";a.Name&&e.MediaSources.length>1&&(t+='<div><span class="mediaInfoAttribute">'+a.Name+"</span></div><br/>");for(var i=0,r=a.MediaStreams.length;r>i;i++){var s=a.MediaStreams[i];if("Data"!=s.Type){t+='<div class="mediaInfoStream">';var n=Globalize.translate("MediaInfoStreamType"+s.Type);t+='<div class="mediaInfoStreamType">'+n+"</div>";var l=[];s.Language&&"Video"!=s.Type&&l.push(W(Globalize.translate("MediaInfoLanguage"),s.Language)),s.Codec&&l.push(W(Globalize.translate("MediaInfoCodec"),s.Codec.toUpperCase())),s.CodecTag&&l.push(W(Globalize.translate("MediaInfoCodecTag"),s.CodecTag)),null!=s.IsAVC&&l.push(W("AVC",s.IsAVC?"Yes":"No")),s.Profile&&l.push(W(Globalize.translate("MediaInfoProfile"),s.Profile)),s.Level&&l.push(W(Globalize.translate("MediaInfoLevel"),s.Level)),(s.Width||s.Height)&&l.push(W(Globalize.translate("MediaInfoResolution"),s.Width+"x"+s.Height)),s.AspectRatio&&"mjpeg"!=s.Codec&&l.push(W(Globalize.translate("MediaInfoAspectRatio"),s.AspectRatio)),"Video"==s.Type&&(null!=s.IsAnamorphic&&l.push(W(Globalize.translate("MediaInfoAnamorphic"),s.IsAnamorphic?"Yes":"No")),l.push(W(Globalize.translate("MediaInfoInterlaced"),s.IsInterlaced?"Yes":"No"))),(s.AverageFrameRate||s.RealFrameRate)&&l.push(W(Globalize.translate("MediaInfoFramerate"),s.AverageFrameRate||s.RealFrameRate)),s.ChannelLayout&&l.push(W(Globalize.translate("MediaInfoLayout"),s.ChannelLayout)),s.Channels&&l.push(W(Globalize.translate("MediaInfoChannels"),s.Channels+" ch")),s.BitRate&&"mjpeg"!=s.Codec&&l.push(W(Globalize.translate("MediaInfoBitrate"),parseInt(s.BitRate/1024)+" kbps")),s.SampleRate&&l.push(W(Globalize.translate("MediaInfoSampleRate"),s.SampleRate+" khz")),s.BitDepth&&l.push(W(Globalize.translate("MediaInfoBitDepth"),s.BitDepth+" bit")),s.PixelFormat&&l.push(W(Globalize.translate("MediaInfoPixelFormat"),s.PixelFormat)),s.RefFrames&&l.push(W(Globalize.translate("MediaInfoRefFrames"),s.RefFrames)),s.NalLengthSize&&l.push(W("NAL",s.NalLengthSize)),"Video"!=s.Type&&l.push(W(Globalize.translate("MediaInfoDefault"),s.IsDefault?"Yes":"No")),"Subtitle"==s.Type&&(l.push(W(Globalize.translate("MediaInfoForced"),s.IsForced?"Yes":"No")),l.push(W(Globalize.translate("MediaInfoExternal"),s.IsExternal?"Yes":"No"))),"Video"==s.Type&&a.Timestamp&&l.push(W(Globalize.translate("MediaInfoTimestamp"),a.Timestamp)),s.DisplayTitle&&l.push(W("Title",s.DisplayTitle)),t+=l.join("<br/>"),t+="</div>"}}if(a.Container&&(t+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoContainer")+'</span><span class="mediaInfoAttribute">'+a.Container+"</span></div>"),a.Formats&&a.Formats.length,a.Path&&"Http"!=a.Protocol&&(t+='<div style="max-width:600px;overflow:hidden;"><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoPath")+'</span><span class="mediaInfoAttribute">'+a.Path+"</span></div>"),a.Size){var o=(a.Size/1048576).toFixed(0);t+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoSize")+'</span><span class="mediaInfoAttribute">'+o+" MB</span></div>"}return t}function W(e,a){return'<span class="mediaInfoLabel">'+e+'</span><span class="mediaInfoAttribute">'+a+"</span>"}function X(e,t,i,r){for(var s="",n=LibraryBrowser.getPosterViewInfo().backdropWidth,l=0,o=e.length;o>l&&!(i&&l>=i);l++){var d=e[l],c="card detailPage169Card",u="itemdetails.html?id="+d.Id,m="Full"==d.PlayAccess?" onclick=\"MediaController.play('"+d.Id+"'); return false;\"":"";s+='<a class="'+c+'" href="'+u+'"'+m+">",s+='<div class="cardBox">',s+='<div class="cardScalable">';var p,h=d.ImageTags||{};p=h.Primary?ApiClient.getScaledImageUrl(d.Id,{maxWidth:n,tag:h.Primary,type:"primary"}):"css/images/items/detail/video.png",s+='<div class="cardPadder"></div>',s+='<div class="cardContent">',s+='<div class="cardImage lazy" data-src="'+p+'"></div>',s+='<div class="cardFooter">',s+='<div class="cardText">'+d.Name+"</div>",s+='<div class="cardText">',s+=""!=d.RunTimeTicks?a.getDisplayRunningTime(d.RunTimeTicks):"&nbsp;",s+="</div>",s+="</div>",s+="</div>",s+="</div>",s+="</div>",s+="</a>"}return i&&e.length>i&&(s+='<p style="margin: 0;padding-left:5px;"><button is="emby-button" type="button" class="raised more '+r+'">'+Globalize.translate("ButtonMore")+"</button></p>"),s}function Y(e,a,t,i){ApiClient.getSpecialFeatures(t.Id,a.Id).then(function(a){var r=e.querySelector("#specialsContent");r.innerHTML=X(a,t,i,"moreSpecials"),ImageLoader.lazyChildren(r)})}function _(e,a,t,i,r){if(v())return void K(e,a,t,r);for(var s="",n=a.People||[],l=0,o=n.length;o>l&&!(i&&l>=i);l++){var d=n[l],c=r?"#":"itemdetails.html?id="+d.Id;s+='<a class="tileItem smallPosterTileItem" href="'+c+'">';var u,m=!0;d.PrimaryImageTag?u=ApiClient.getScaledImageUrl(d.Id,{maxWidth:100,tag:d.PrimaryImageTag,type:"primary",minScale:2}):(u="css/images/items/list/person.png",m=!1),s+=m?'<div class="tileImage lazy" data-src="'+u+'"></div>':'<div class="tileImage" style="background-image:url(\''+u+"');\"></div>",s+='<div class="tileContent">',s+="<p>"+d.Name+"</p>";var p=d.Role?Globalize.translate("ValueAsRole",d.Role):d.Type;"GuestStar"==p&&(p=Globalize.translate("ValueGuestStar")),p=p||"";var h=40;p.length>h&&(p=p.substring(0,h-3)+"..."),s+="<p>"+p+"</p>",s+="</div>",s+="</a>"}i&&n.length>i&&(s+='<p style="margin: 0;padding-left:5px;"><button is="emby-button" type="button" class="raised more morePeople">'+Globalize.translate("ButtonMore")+"</button></p>");var y=e.querySelector("#castContent");y.innerHTML=s,ImageLoader.lazyChildren(y)}function K(e,a,t,i){var r="";r+=v()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">';var s=a.People||[];s=s.filter(function(e){return e.PrimaryImageTag}),s.length||(s=a.People||[]);for(var n=0,l=s.length;l>n;n++){var o=s[n],d=i?"#":"itemdetails.html?id="+o.Id;r+='<div class="card '+f()+'Card">',r+='<div class="cardBox">',r+='<div class="cardScalable">';var c,u=!0;o.PrimaryImageTag?c=ApiClient.getScaledImageUrl(o.Id,{maxWidth:100,tag:o.PrimaryImageTag,type:"primary",minScale:2}):(c="css/images/items/list/person.png",u=!1),r+='<div class="cardPadder"></div>',r+='<a class="cardContent" href="'+d+'">',r+=u?'<div class="cardImage coveredCardImage lazy" data-src="'+c+'"></div>':'<div class="cardImage coveredCardImage" style="background-image:url(\''+c+"');\"></div>",r+="</div>",r+="</a>",r+="</div>",r+='<div class="cardFooter outerCardFooter">',r+='<div class="cardText">'+o.Name+"</div>",r+='<div class="cardText">';var m=o.Role?Globalize.translate("ValueAsRole",o.Role):o.Type;"GuestStar"==m&&(m=Globalize.translate("ValueGuestStar")),m=m||"";var p=40;m.length>p&&(m=m.substring(0,p-3)+"..."),r+=m,r+="</div>",r+="</div>",r+="</div>"}r+="</div>";var h=e.querySelector("#castContent");h.innerHTML=r,ImageLoader.lazyChildren(h)}function Q(e){MediaController.play({items:[ia],startPositionTicks:e})}function J(e,a){require(["confirm"],function(t){t("Are you sure you wish to split the media sources into separate items?","Split Media Apart").then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Videos/"+a.id+"/AlternateSources")}).then(function(){Dashboard.hideLoadingMsg(),n(e,a)})})})}function Z(){ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),ia.Id).then(function(e){MediaController.play({items:e})})}function $(e,a){ia&&ia.Id==a&&("Recording"==ia.Type?LibraryBrowser.showTab("livetv.html",3):Dashboard.navigate("home.html"))}function ea(e){if("Program"==ia.Type)return void ApiClient.getLiveTvChannel(ia.ChannelId,Dashboard.getCurrentUserId()).then(function(e){LibraryBrowser.showPlayMenu(null,e.Id,e.Type,!1,e.MediaType,(e.UserData||{}).PlaybackPositionTicks)});var a=ia.UserData||{},t=ia.MediaType;("MusicArtist"==ia.Type||"MusicAlbum"==ia.Type)&&(t="Audio"),LibraryBrowser.showPlayMenu(e,ia.Id,ia.Type,ia.IsFolder,t,a.PlaybackPositionTicks)}function aa(e,a,t){require(["confirm"],function(i){i(Globalize.translate("MessageConfirmRecordingCancellation"),Globalize.translate("HeaderConfirmRecordingCancellation")).then(function(){Dashboard.showLoadingMsg(),ApiClient.cancelLiveTvTimer(t).then(function(){require(["toast"],function(e){e(Globalize.translate("MessageRecordingCancelled"))}),n(e,a)})})})}function ta(){var e=this;e.play=Q,e.setInitialCollapsibleState=m,e.renderDetails=p,e.renderCriticReviews=k,e.renderCast=_,e.renderScenes=N,e.renderMediaSources=O}var ia,ra=null;return window.ItemDetailPage=new ta,function(e,a){function i(a,t){var i=t;if("UserDataChanged"===i.MessageType&&ia&&i.Data.UserId==Dashboard.getCurrentUserId()){var r=ia.UserData.Key,s=i.Data.UserDataList.filter(function(e){return e.Key==r})[0];s&&(ia.UserData=s,Dashboard.getCurrentUser().then(function(a){d(e,ia,a)}))}}t(".btnPlay",e).on("click",function(){ea(this)}),t(".btnPlayTrailer",e).on("click",function(){Z(e)}),t(".btnSplitVersions",e).on("click",function(){J(e,a)}),t(".btnSync",e).on("click",function(){require(["syncDialog"],function(e){e.showMenu({items:[ia]})})}),t(".btnRecord,.btnFloatingRecord",e).on("click",function(){var t=a.id;Dashboard.showLoadingMsg(),require(["recordingCreator"],function(i){i.show(t,ia.ServerId).then(function(){n(e,a)})})}),t(".btnCancelRecording",e).on("click",function(){aa(e,a,ia.TimerId)}),t(".btnMoreCommands",e).on("click",function(){var e=this;
Dashboard.getCurrentUser().then(function(a){LibraryBrowser.showMoreCommands(e,ia.Id,ia.Type,LibraryBrowser.getMoreCommands(ia,a))})}),t(".childrenItemsContainer",e).on("playallfromhere",function(e,a){LibraryBrowser.playAllFromHere(ra,a)}).on("queueallfromhere",function(e,a){LibraryBrowser.queueAllFromHere(ra,a)}),t(e).on("click",".moreScenes",function(){Dashboard.getCurrentUser().then(function(a){N(e,ia,a)})}).on("click",".morePeople",function(){_(e,ia,a.context)}).on("click",".moreSpecials",function(){Dashboard.getCurrentUser().then(function(a){Y(e,ia,a)})}).on("click",".moreCriticReviews",function(){k(e,ia)}),e.querySelector(".collectionItems").addEventListener("removefromcollection",function(a){var t=a.detail.itemId;R(e,ia,[t])}),e.addEventListener("viewbeforeshow",function(){var e=this;n(e,a),Events.on(ApiClient,"websocketmessage",i),Events.on(LibraryBrowser,"itemdeleting",$)}),e.addEventListener("viewbeforehide",function(){Events.off(LibraryBrowser,"itemdeleting",$),ia=null,Events.off(ApiClient,"websocketmessage",i),LibraryMenu.setTransparentMenu(!1)})}});