define(["dialogHelper","loading","connectionManager","globalize","actionsheet","paper-checkbox","emby-input","paper-icon-button-light","emby-button","listViewStyle","material-icons"],function(e,n,t,i,r){return function(a){function o(e,n){for(;!e.classList||!e.classList.contains(n);)if(e=e.parentNode,!e)return null;return e}function d(e,i,r){n.show();var d=a.providerId,s=t.getApiClient(a.serverId);s.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/ChannelMappings"),data:{providerId:d,tunerChannelNumber:i,providerChannelNumber:r},dataType:"json"}).then(function(t){var i=o(e,"listItem");e.setAttribute("data-providernumber",t.ProviderChannelNumber),i.querySelector(".secondary").innerHTML=c(t,b.ProviderName),n.hide()})}function s(e){var n=o(e.target,"btnMap");if(n){var t=n.getAttribute("data-number"),i=n.getAttribute("data-providernumber"),a=b.ProviderChannels.map(function(e){return{name:e.Name,id:e.Id,selected:e.Id.toLowerCase()==i.toLowerCase()}});r.show({positionTo:n,items:a}).then(function(e){d(n,t,e)})}}function l(e,n){var i=t.getApiClient(e);return i.getJSON(i.getUrl("LiveTv/ChannelMappingOptions",{providerId:n}))}function c(e,n){return(e.ProviderChannelNumber||"")+" "+(e.ProviderChannelName||"")+" - "+n}function u(e,n){var t="";return t+='<div class="listItem">',t+='<button is="emby-button" type="button" class="fab autoSize mini" style="background:#52B54B;"><i class="md-icon listItemIcon">dvr</i></button>',t+='<div class="listItemBody">',t+="<h3>",t+=e.Name,t+="</h3>",(e.ProviderChannelNumber||e.ProviderChannelName)&&(t+='<div class="secondary">',t+=c(e,n),t+="</div>"),t+="</div>",t+='<button class="btnMap" is="paper-icon-button-light" type="button" data-number="'+e.Number+'" data-providernumber="'+e.ProviderChannelNumber+'"><iron-icon icon="mode-edit"></iron-icon></button>',t+="</div>"}function v(){var e="";return e+='<div class="dialogContent">',e+='<div class="dialogContentInner centeredContent">',e+='<form style="margin:auto;">',e+="<h1>"+i.translate("HeaderChannels")+"</h1>",e+='<div class="channels paperList">',e+="</div>",e+="</form>",e+="</div>",e+="</div>"}function m(e,n){l(n.serverId,n.providerId).then(function(n){b=n;var t=e.querySelector(".channels");t.innerHTML=n.TunerChannels.map(function(e){return u(e,n.ProviderName)}).join(""),t.addEventListener("click",s)})}var b,p=this;p.show=function(){var n={removeOnClose:!0};n.size="small";var t=e.createDialog(n);t.classList.add("formDialog"),t.classList.add("ui-body-a"),t.classList.add("background-theme-a");var r="",o=i.translate("MapChannels");return r+='<div class="dialogHeader" style="margin:0 0 2em;">',r+='<button is="paper-icon-button-light" class="btnCancel autoSize" tabindex="-1"><i class="md-icon">arrow_back</i></button>',r+='<div class="dialogHeaderTitle">',r+=o,r+="</div>",r+="</div>",r+=v(),t.innerHTML=r,document.body.appendChild(t),m(t,a),t.querySelector(".btnCancel").addEventListener("click",function(){e.close(t)}),new Promise(function(n){t.addEventListener("close",n),e.open(t)})}}});