!function(e,a,t){function o(){var e={};return e.itemId=u,e}function i(a){Dashboard.showLoadingMsg();var t=o();t.type=y,t.startIndex=I,t.limit=f,t.IncludeAllLanguages=e("#chkAllLanguages",a).checked();var i=h||"";i&&(t.ProviderName=i),ApiClient.getAvailableRemoteImages(t).then(function(o){n(a,o,y,t.startIndex,t.limit),e("#selectBrowsableImageType",a).val(y);var r=o.Providers.map(function(e){return'<option value="'+e+'">'+e+"</option>"});e("#selectImageProvider",a).html('<option value="">'+Globalize.translate("LabelAll")+"</option>"+r).val(i),Dashboard.hideLoadingMsg()})}function n(a,t,o,n,s){e(".availableImagesPaging",a).html(r(n,s,t.TotalRecordCount)).trigger("create");for(var d="",c=0,m=t.Images.length;m>c;c++)d+=g(t.Images[c],o);var u=a.querySelector(".availableImagesList");u.innerHTML=d,ImageLoader.lazyChildren(u),e(".btnNextPage",a).on("click",function(){I+=f,i(a)}),e(".btnPreviousPage",a).on("click",function(){I-=f,i(a)}),e(".btnDownloadRemoteImage",a).on("click",function(){l(a,this.getAttribute("data-imageurl"),this.getAttribute("data-imagetype"),this.getAttribute("data-imageprovider"))})}function r(e,a,t){var o="",i=Math.min(e+a,t),n=t>a;o+='<div class="listPaging">',o+='<span style="margin-right: 10px;">';var r=t?e+1:0;return o+=r+"-"+i+" of "+t,o+="</span>",n&&(o+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">',o+='<paper-icon-button icon="arrow-back" title="'+Globalize.translate("ButtonPreviousPage")+'" class="btnPreviousPage" '+(e?"":"disabled")+"></paper-icon-button>",o+='<paper-icon-button icon="arrow-forward" title="'+Globalize.translate("ButtonNextPage")+'" class="btnNextPage" '+(e+a>=t?"disabled":"")+"></paper-icon-button>",o+="</div>"),o+="</div>"}function l(a,t,i,n){var r=o();r.Type=i,r.ImageUrl=t,r.ProviderName=n,Dashboard.showLoadingMsg(),ApiClient.downloadRemoteImage(r).then(function(){b=!0;var t=e(a).parents("paper-dialog")[0];PaperDialogHelper.close(t)})}function s(e){return ApiClient.getUrl("Images/Remote",{imageUrl:e})}function g(e,a){var t="";t+='<div class="remoteImageContainer">';var o="remoteImage lazy";o+="Backdrop"==a||"Art"==a||"Thumb"==a||"Logo"==a?" remoteBackdropImage":"Banner"==a?" remoteBannerImage":"Disc"==a?" remoteDiscImage":"Episode"==p?" remoteBackdropImage":"MusicAlbum"==p||"MusicArtist"==p?" remoteDiscImage":" remotePosterImage";var i=s(e.ThumbnailUrl||e.Url);return t+='<a target="_blank" href="'+s(e.Url)+'" class="'+o+'" data-src="'+i+'">',t+="</a>",t+='<div class="remoteImageDetails">',t+='<div class="remoteImageDetailText">',t+=e.ProviderName,t+="</div>",(e.Width||e.Height||e.Language)&&(t+='<div class="remoteImageDetailText">',e.Width&&e.Height?(t+=e.Width+" x "+e.Height,e.Language&&(t+=" • "+e.Language)):e.Language&&(t+=e.Language),t+="</div>"),null!=e.CommunityRating&&(t+='<div class="remoteImageDetailText">',"Likes"==e.RatingType?t+=e.CommunityRating+(1==e.CommunityRating?" like":" likes"):e.CommunityRating?(t+=e.CommunityRating.toFixed(1),e.VoteCount&&(t+=" • "+e.VoteCount+(1==e.VoteCount?" vote":" votes"))):t+="Unrated",t+="</div>"),t+='<paper-icon-button icon="cloud-download" class="btnDownloadRemoteImage" raised data-imageprovider="'+e.ProviderName+'" data-imageurl="'+e.Url+'" data-imagetype="'+e.Type+'" title="'+Globalize.translate("ButtonDownload")+'"></paper-icon-button>',t+="</div>",t+="</div>"}function d(a){e("#selectBrowsableImageType",a).on("change",function(){y=this.value,I=0,h=null,i(a)}),e("#selectImageProvider",a).on("change",function(){I=0,h=this.value,i(a)}),e("#chkAllLanguages",a).on("change",function(){I=0,i(a)})}function c(a,o){Dashboard.showLoadingMsg();var n=new XMLHttpRequest;n.open("GET","components/imagedownloader/imagedownloader.template.html",!0),n.onload=function(){var n=this.response;u=a,p=o;var r=PaperDialogHelper.createDialog(),l="";l+='<h2 class="dialogHeader">',l+='<paper-fab icon="arrow-back" mini class="btnCloseDialog"></paper-fab>',l+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+Globalize.translate("HeaderSearch")+"</div>",l+="</h2>",l+='<div class="editorContent">',l+=Globalize.translateDocument(n),l+="</div>",r.innerHTML=l,t.body.appendChild(r),e(r).on("iron-overlay-closed",m),PaperDialogHelper.openWithHash(r,"imagedownloader");var s=r.querySelector(".editorContent");d(s),e(".btnCloseDialog",r).on("click",function(){PaperDialogHelper.close(r)}),i(s)},n.send()}function m(){e(this).remove(),Dashboard.hideLoadingMsg(),v.resolveWith(null,[b])}var u,p,v,h,b=!1,f=browserInfo.safari?6:10,I=0,y="Primary";a.ImageDownloader={show:function(e,a,t){var o=DeferredBuilder.Deferred();return v=o,b=!1,I=0,y=t||"Primary",h=null,require(["components/paperdialoghelper"],function(){c(e,a)}),o.promise()}}}(jQuery,window,document);