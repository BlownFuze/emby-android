define(["paperdialoghelper","paper-checkbox","paper-dialog","paper-fab"],function(e){function a(){var e={};return e.itemId=c,e}function t(e){Dashboard.showLoadingMsg();var t=a();t.type=f,t.startIndex=h,t.limit=b,t.IncludeAllLanguages=$("#chkAllLanguages",e).checked();var o=p||"";o&&(t.ProviderName=o),ApiClient.getAvailableRemoteImages(t).then(function(a){i(e,a,f,t.startIndex,t.limit),$("#selectBrowsableImageType",e).val(f);var n=a.Providers.map(function(e){return'<option value="'+e+'">'+e+"</option>"});$("#selectImageProvider",e).html('<option value="">'+Globalize.translate("LabelAll")+"</option>"+n).val(o),Dashboard.hideLoadingMsg()})}function i(e,a,i,r,s){$(".availableImagesPaging",e).html(o(r,s,a.TotalRecordCount)).trigger("create");for(var d="",g=0,c=a.Images.length;c>g;g++)d+=l(a.Images[g],i);var m=e.querySelector(".availableImagesList");m.innerHTML=d,ImageLoader.lazyChildren(m),$(".btnNextPage",e).on("click",function(){h+=b,t(e)}),$(".btnPreviousPage",e).on("click",function(){h-=b,t(e)}),$(".btnDownloadRemoteImage",e).on("click",function(){n(e,this.getAttribute("data-imageurl"),this.getAttribute("data-imagetype"),this.getAttribute("data-imageprovider"))})}function o(e,a,t){var i="",o=Math.min(e+a,t),n=t>a;i+='<div class="listPaging">',i+='<span style="margin-right: 10px;">';var r=t?e+1:0;return i+=r+"-"+o+" of "+t,i+="</span>",n&&(i+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">',i+='<paper-icon-button icon="arrow-back" title="'+Globalize.translate("ButtonPreviousPage")+'" class="btnPreviousPage" '+(e?"":"disabled")+"></paper-icon-button>",i+='<paper-icon-button icon="arrow-forward" title="'+Globalize.translate("ButtonNextPage")+'" class="btnNextPage" '+(e+a>=t?"disabled":"")+"></paper-icon-button>",i+="</div>"),i+="</div>"}function n(t,i,o,n){var r=a();r.Type=o,r.ImageUrl=i,r.ProviderName=n,Dashboard.showLoadingMsg(),ApiClient.downloadRemoteImage(r).then(function(){v=!0;var a=$(t).parents("paper-dialog")[0];e.close(a)})}function r(e){return ApiClient.getUrl("Images/Remote",{imageUrl:e})}function l(e,a){var t="";t+='<div class="remoteImageContainer">';var i="remoteImage lazy";i+="Backdrop"==a||"Art"==a||"Thumb"==a||"Logo"==a?" remoteBackdropImage":"Banner"==a?" remoteBannerImage":"Disc"==a?" remoteDiscImage":"Episode"==m?" remoteBackdropImage":"MusicAlbum"==m||"MusicArtist"==m?" remoteDiscImage":" remotePosterImage";var o=r(e.ThumbnailUrl||e.Url);return t+='<a target="_blank" href="'+r(e.Url)+'" class="'+i+'" data-src="'+o+'">',t+="</a>",t+='<div class="remoteImageDetails">',t+='<div class="remoteImageDetailText">',t+=e.ProviderName,t+="</div>",(e.Width||e.Height||e.Language)&&(t+='<div class="remoteImageDetailText">',e.Width&&e.Height?(t+=e.Width+" x "+e.Height,e.Language&&(t+=" • "+e.Language)):e.Language&&(t+=e.Language),t+="</div>"),null!=e.CommunityRating&&(t+='<div class="remoteImageDetailText">',"Likes"==e.RatingType?t+=e.CommunityRating+(1==e.CommunityRating?" like":" likes"):e.CommunityRating?(t+=e.CommunityRating.toFixed(1),e.VoteCount&&(t+=" • "+e.VoteCount+(1==e.VoteCount?" vote":" votes"))):t+="Unrated",t+="</div>"),t+='<paper-icon-button icon="cloud-download" class="btnDownloadRemoteImage" raised data-imageprovider="'+e.ProviderName+'" data-imageurl="'+e.Url+'" data-imagetype="'+e.Type+'" title="'+Globalize.translate("ButtonDownload")+'"></paper-icon-button>',t+="</div>",t+="</div>"}function s(e){$("#selectBrowsableImageType",e).on("change",function(){f=this.value,h=0,p=null,t(e)}),$("#selectImageProvider",e).on("change",function(){h=0,p=this.value,t(e)}),$("#chkAllLanguages",e).on("change",function(){h=0,t(e)})}function d(a,i){Dashboard.showLoadingMsg();var o=new XMLHttpRequest;o.open("GET","components/imagedownloader/imagedownloader.template.html",!0),o.onload=function(){var o=this.response;c=a,m=i;var n=e.createDialog({size:"fullscreen-border"}),r="b";n.classList.add("ui-body-"+r),n.classList.add("background-theme-"+r),n.classList.add("popupEditor");var l="";l+='<h2 class="dialogHeader">',l+='<paper-fab icon="arrow-back" mini class="btnCloseDialog" tabindex="-1"></paper-fab>',l+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+Globalize.translate("HeaderSearch")+"</div>",l+="</h2>",l+='<div class="editorContent">',l+=Globalize.translateDocument(o),l+="</div>",n.innerHTML=l,document.body.appendChild(n),$(n).on("iron-overlay-closed",g),e.open(n);var d=n.querySelector(".editorContent");s(d),$(".btnCloseDialog",n).on("click",function(){e.close(n)}),t(d)},o.send()}function g(){$(this).remove(),Dashboard.hideLoadingMsg(),u.resolveWith(null,[v])}var c,m,u,p,v=!1,b=browserInfo.safari?6:10,h=0,f="Primary";return{show:function(e,a,t){var i=DeferredBuilder.Deferred();return u=i,v=!1,h=0,f=t||"Primary",p=null,d(e,a),i.promise()}}});