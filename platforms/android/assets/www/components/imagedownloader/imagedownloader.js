define(["dialogHelper","jQuery","emby-checkbox","emby-button","paper-icon-button-light"],function(e,a){function t(){var e={};return e.itemId=u,e}function i(e){Dashboard.showLoadingMsg();var i=t();i.type=y,i.startIndex=f,i.limit=p,i.IncludeAllLanguages=a("#chkAllLanguages",e).checked();var n=v||"";n&&(i.ProviderName=n),ApiClient.getAvailableRemoteImages(i).then(function(t){o(e,t,y,i.startIndex,i.limit),a("#selectBrowsableImageType",e).val(y);var r=t.Providers.map(function(e){return'<option value="'+e+'">'+e+"</option>"});a("#selectImageProvider",e).html('<option value="">'+Globalize.translate("LabelAll")+"</option>"+r).val(n),Dashboard.hideLoadingMsg()})}function o(e,t,o,l,d){a(".availableImagesPaging",e).html(n(l,d,t.TotalRecordCount));for(var g="",c=0,u=t.Images.length;u>c;c++)g+=s(t.Images[c],o);var m=e.querySelector(".availableImagesList");m.innerHTML=g,ImageLoader.lazyChildren(m),a(".btnNextPage",e).on("click",function(){f+=p,i(e)}),a(".btnPreviousPage",e).on("click",function(){f-=p,i(e)}),a(".btnDownloadRemoteImage",e).on("click",function(){r(e,this.getAttribute("data-imageurl"),this.getAttribute("data-imagetype"),this.getAttribute("data-imageprovider"))})}function n(e,a,t){var i="",o=Math.min(e+a,t),n=t>a;i+='<div class="listPaging">',i+='<span style="margin-right: 10px;">';var r=t?e+1:0;return i+=r+"-"+o+" of "+t,i+="</span>",n&&(i+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">',i+='<button is="paper-icon-button-light" title="'+Globalize.translate("ButtonPreviousPage")+'" class="btnPreviousPage autoSize" '+(e?"":"disabled")+'><i class="md-icon">arrow_back</i></button>',i+='<button is="paper-icon-button-light" title="'+Globalize.translate("ButtonNextPage")+'" class="btnNextPage autoSize" '+(e+a>=t?"disabled":"")+'><i class="md-icon">arrow_forward</i></button>',i+="</div>"),i+="</div>"}function r(i,o,n,r){var l=t();l.Type=n,l.ImageUrl=o,l.ProviderName=r,Dashboard.showLoadingMsg(),ApiClient.downloadRemoteImage(l).then(function(){h=!0;var t=a(i).parents(".dialog")[0];e.close(t)})}function l(e){return ApiClient.getUrl("Images/Remote",{imageUrl:e})}function s(e,a){var t="";t+='<div class="remoteImageContainer">';var i="remoteImage lazy";i+="Backdrop"==a||"Art"==a||"Thumb"==a||"Logo"==a?" remoteBackdropImage":"Banner"==a?" remoteBannerImage":"Disc"==a?" remoteDiscImage":"Episode"==m?" remoteBackdropImage":"MusicAlbum"==m||"MusicArtist"==m?" remoteDiscImage":" remotePosterImage";var o=l(e.ThumbnailUrl||e.Url);return t+='<a target="_blank" href="'+l(e.Url)+'" class="'+i+'" data-src="'+o+'">',t+="</a>",t+='<div class="remoteImageDetails">',t+='<div class="remoteImageDetailText">',t+=e.ProviderName,t+="</div>",(e.Width||e.Height||e.Language)&&(t+='<div class="remoteImageDetailText">',e.Width&&e.Height?(t+=e.Width+" x "+e.Height,e.Language&&(t+=" • "+e.Language)):e.Language&&(t+=e.Language),t+="</div>"),null!=e.CommunityRating&&(t+='<div class="remoteImageDetailText">',"Likes"==e.RatingType?t+=e.CommunityRating+(1==e.CommunityRating?" like":" likes"):e.CommunityRating?(t+=e.CommunityRating.toFixed(1),e.VoteCount&&(t+=" • "+e.VoteCount+(1==e.VoteCount?" vote":" votes"))):t+="Unrated",t+="</div>"),t+='<button is="paper-icon-button-light" class="btnDownloadRemoteImage autoSize" raised data-imageprovider="'+e.ProviderName+'" data-imageurl="'+e.Url+'" data-imagetype="'+e.Type+'" title="'+Globalize.translate("ButtonDownload")+'"><i class="md-icon">cloud_download</i></button>',t+="</div>",t+="</div>"}function d(e){a("#selectBrowsableImageType",e).on("change",function(){y=this.value,f=0,v=null,i(e)}),a("#selectImageProvider",e).on("change",function(){f=0,v=this.value,i(e)}),a("#chkAllLanguages",e).on("change",function(){f=0,i(e)})}function g(t,o){Dashboard.showLoadingMsg();var n=new XMLHttpRequest;n.open("GET","components/imagedownloader/imagedownloader.template.html",!0),n.onload=function(){var n=this.response;u=t,m=o;var r=e.createDialog({size:"fullscreen-border",lockScroll:!0}),l="b";r.classList.add("ui-body-"+l),r.classList.add("background-theme-"+l),r.classList.add("popupEditor");var s="";s+='<h2 class="dialogHeader">',s+='<button type="button" is="emby-button" icon="arrow-back" class="fab mini btnCloseDialog autoSize" tabindex="-1"><i class="md-icon">arrow_back</i></button>',s+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+Globalize.translate("HeaderSearch")+"</div>",s+="</h2>",s+='<div class="editorContent">',s+=Globalize.translateDocument(n),s+="</div>",r.innerHTML=s,document.body.appendChild(r),a(r).on("close",c),e.open(r);var g=r.querySelector(".editorContent");d(g),a(".btnCloseDialog",r).on("click",function(){e.close(r)}),i(g)},n.send()}function c(){a(this).remove(),Dashboard.hideLoadingMsg(),b.resolveWith(null,[h])}var u,m,b,v,h=!1,p=browserInfo.safari?6:browserInfo.mobile?10:40,f=0,y="Primary";return{show:function(e,a,t){var i=jQuery.Deferred();return b=i,h=!1,f=0,y=t||"Primary",v=null,g(e,a),i.promise()}}});