define(["components/paperdialoghelper","paper-checkbox","paper-dialog"],function(){function e(){var e={};return e.itemId=d,e}function a(a){Dashboard.showLoadingMsg();var o=e();o.type=b,o.startIndex=h,o.limit=v,o.IncludeAllLanguages=$("#chkAllLanguages",a).checked();var i=u||"";i&&(o.ProviderName=i),ApiClient.getAvailableRemoteImages(o).then(function(e){t(a,e,b,o.startIndex,o.limit),$("#selectBrowsableImageType",a).val(b);var n=e.Providers.map(function(e){return'<option value="'+e+'">'+e+"</option>"});$("#selectImageProvider",a).html('<option value="">'+Globalize.translate("LabelAll")+"</option>"+n).val(i),Dashboard.hideLoadingMsg()})}function t(e,t,n,l,s){$(".availableImagesPaging",e).html(o(l,s,t.TotalRecordCount)).trigger("create");for(var g="",d=0,c=t.Images.length;c>d;d++)g+=r(t.Images[d],n);var m=e.querySelector(".availableImagesList");m.innerHTML=g,ImageLoader.lazyChildren(m),$(".btnNextPage",e).on("click",function(){h+=v,a(e)}),$(".btnPreviousPage",e).on("click",function(){h-=v,a(e)}),$(".btnDownloadRemoteImage",e).on("click",function(){i(e,this.getAttribute("data-imageurl"),this.getAttribute("data-imagetype"),this.getAttribute("data-imageprovider"))})}function o(e,a,t){var o="",i=Math.min(e+a,t),n=t>a;o+='<div class="listPaging">',o+='<span style="margin-right: 10px;">';var r=t?e+1:0;return o+=r+"-"+i+" of "+t,o+="</span>",n&&(o+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">',o+='<paper-icon-button icon="arrow-back" title="'+Globalize.translate("ButtonPreviousPage")+'" class="btnPreviousPage" '+(e?"":"disabled")+"></paper-icon-button>",o+='<paper-icon-button icon="arrow-forward" title="'+Globalize.translate("ButtonNextPage")+'" class="btnNextPage" '+(e+a>=t?"disabled":"")+"></paper-icon-button>",o+="</div>"),o+="</div>"}function i(a,t,o,i){var n=e();n.Type=o,n.ImageUrl=t,n.ProviderName=i,Dashboard.showLoadingMsg(),ApiClient.downloadRemoteImage(n).then(function(){p=!0;var e=$(a).parents("paper-dialog")[0];PaperDialogHelper.close(e)})}function n(e){return ApiClient.getUrl("Images/Remote",{imageUrl:e})}function r(e,a){var t="";t+='<div class="remoteImageContainer">';var o="remoteImage lazy";o+="Backdrop"==a||"Art"==a||"Thumb"==a||"Logo"==a?" remoteBackdropImage":"Banner"==a?" remoteBannerImage":"Disc"==a?" remoteDiscImage":"Episode"==c?" remoteBackdropImage":"MusicAlbum"==c||"MusicArtist"==c?" remoteDiscImage":" remotePosterImage";var i=n(e.ThumbnailUrl||e.Url);return t+='<a target="_blank" href="'+n(e.Url)+'" class="'+o+'" data-src="'+i+'">',t+="</a>",t+='<div class="remoteImageDetails">',t+='<div class="remoteImageDetailText">',t+=e.ProviderName,t+="</div>",(e.Width||e.Height||e.Language)&&(t+='<div class="remoteImageDetailText">',e.Width&&e.Height?(t+=e.Width+" x "+e.Height,e.Language&&(t+=" • "+e.Language)):e.Language&&(t+=e.Language),t+="</div>"),null!=e.CommunityRating&&(t+='<div class="remoteImageDetailText">',"Likes"==e.RatingType?t+=e.CommunityRating+(1==e.CommunityRating?" like":" likes"):e.CommunityRating?(t+=e.CommunityRating.toFixed(1),e.VoteCount&&(t+=" • "+e.VoteCount+(1==e.VoteCount?" vote":" votes"))):t+="Unrated",t+="</div>"),t+='<paper-icon-button icon="cloud-download" class="btnDownloadRemoteImage" raised data-imageprovider="'+e.ProviderName+'" data-imageurl="'+e.Url+'" data-imagetype="'+e.Type+'" title="'+Globalize.translate("ButtonDownload")+'"></paper-icon-button>',t+="</div>",t+="</div>"}function l(e){$("#selectBrowsableImageType",e).on("change",function(){b=this.value,h=0,u=null,a(e)}),$("#selectImageProvider",e).on("change",function(){h=0,u=this.value,a(e)}),$("#chkAllLanguages",e).on("change",function(){h=0,a(e)})}function s(e,t){Dashboard.showLoadingMsg();var o=new XMLHttpRequest;o.open("GET","components/imagedownloader/imagedownloader.template.html",!0),o.onload=function(){var o=this.response;d=e,c=t;var i=PaperDialogHelper.createDialog(),n="";n+='<h2 class="dialogHeader">',n+='<paper-fab icon="arrow-back" mini class="btnCloseDialog"></paper-fab>',n+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+Globalize.translate("HeaderSearch")+"</div>",n+="</h2>",n+='<div class="editorContent">',n+=Globalize.translateDocument(o),n+="</div>",i.innerHTML=n,document.body.appendChild(i),$(i).on("iron-overlay-closed",g),PaperDialogHelper.openWithHash(i,"imagedownloader");var r=i.querySelector(".editorContent");l(r),$(".btnCloseDialog",i).on("click",function(){PaperDialogHelper.close(i)}),a(r)},o.send()}function g(){$(this).remove(),Dashboard.hideLoadingMsg(),m.resolveWith(null,[p])}var d,c,m,u,p=!1,v=browserInfo.safari?6:10,h=0,b="Primary";return{show:function(e,a,t){var o=DeferredBuilder.Deferred();return m=o,p=!1,h=0,b=t||"Primary",u=null,s(e,a),o.promise()}}});