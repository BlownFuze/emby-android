define(["dialogHelper","jQuery","listViewStyle","emby-input","emby-button","paper-icon-button-light","css!./directorybrowser"],function(t,e){function i(){var t=jQuery.Deferred();return u?t.resolveWith(null,[u]):ApiClient.getPublicSystemInfo().then(function(e){u=e,t.resolveWith(null,[u])}),t.promise()}function r(){Dashboard.hideLoadingMsg()}function n(t,i,r){if(i&&"string"!=typeof i)throw new Error("invalid path");Dashboard.showLoadingMsg(),i?e(".networkHeadline").hide():e(".networkHeadline").show();var n=[];"Network"===i?n.push(ApiClient.getNetworkDevices()):i?(n.push(ApiClient.getDirectoryContents(i,r)),n.push(ApiClient.getParentPath(i))):n.push(ApiClient.getDrives()),Promise.all(n).then(function(r){var n=r[0],o=r[1]||"";e("#txtDirectoryPickerPath",t).val(i||"");var l="";i&&(l+=a("lnkPath lnkDirectory","",o,"..."));for(var s=0,c=n.length;c>s;s++){var u=n[s],d="File"==u.Type?"lnkPath lnkFile":"lnkPath lnkDirectory";l+=a(d,u.Type,u.Path,u.Name)}i||(l+=a("lnkPath lnkDirectory","","Network",Globalize.translate("ButtonNetwork"))),e(".results",t).html(l),Dashboard.hideLoadingMsg()},function(){e("#txtDirectoryPickerPath",t).val(""),e(".results",t).html(""),Dashboard.hideLoadingMsg()})}function a(t,e,i,r){var n="";return n+='<div class="listItem '+t+'" data-type="'+e+'" data-path="'+i+'" style="border-bottom:1px solid #e0e0e0;">',n+='<div class="listItemBody" style="min-height:2em;padding-left:0;">',n+='<div class="listItemBodyText">',n+=r,n+="</div>",n+="</div>",n+='<i class="md-icon" style="font-size:inherit;">arrow_forward</i>',n+="</div>"}function o(t,e){var i="",r=t.instruction?t.instruction+"<br/><br/>":"";return i+='<p class="directoryPickerHeadline">',i+=r,i+=Globalize.translate("MessageDirectoryPickerInstruction").replace("{0}","<b>\\\\server</b>").replace("{1}","<b>\\\\192.168.1.101</b>"),"bsd"==e.OperatingSystem.toLowerCase()?(i+="<br/>",i+="<br/>",i+=Globalize.translate("MessageDirectoryPickerBSDInstruction"),i+="<br/>",i+='<a href="http://doc.freenas.org/9.3/freenas_jails.html#add-storage" target="_blank">'+Globalize.translate("ButtonMoreInformation")+"</a>"):"linux"==e.OperatingSystem.toLowerCase()&&(i+="<br/>",i+="<br/>",i+=Globalize.translate("MessageDirectoryPickerLinuxInstruction"),i+="<br/>"),i+="</p>",i+='<form style="max-width:100%;">',i+='<div class="inputContainer" style="display: flex; align-items: center;">',i+='<div style="flex-grow:1;">',i+='<input is="emby-input" id="txtDirectoryPickerPath" type="text" required="required" label="'+Globalize.translate("LabelCurrentPath")+'"/>',i+="</div>",i+='<button type="button" is="paper-icon-button-light" class="btnRefreshDirectories" title="'+Globalize.translate("ButtonRefresh")+'"><i class="md-icon">search</i></button>',i+="</div>",i+='<div class="results paperList" style="height: 180px; overflow-y: auto;"></div>',i+="<div>",i+='<button is="emby-button" type="submit" class="raised submit block">'+Globalize.translate("ButtonOk")+"</button>",i+="</div>",i+="</form>",i+="</div>"}function l(t,i,r){e(t).on("click",".lnkPath",function(){var i=this.getAttribute("data-path");e(this).hasClass("lnkFile")?e("#txtDirectoryPickerPath",t).val(i):n(t,i,r)}).on("click",".btnRefreshDirectories",function(){var i=e("#txtDirectoryPickerPath",t).val();n(t,i,r)}).on("change","#txtDirectoryPickerPath",function(){n(t,this.value,r)}),e("form",t).on("submit",function(){return i.callback&&i.callback(this.querySelector("#txtDirectoryPickerPath").value),!1})}function s(t){return t.path?Promise.resolve(t.path):ApiClient.getJSON(ApiClient.getUrl("Environment/DefaultDirectoryBrowser")).then(function(t){return t.Path||""},function(){return""})}function c(){var a,c=this;c.show=function(c){c=c||{};var u={includeDirectories:!0};null!=c.includeDirectories&&(u.includeDirectories=c.includeDirectories),null!=c.includeFiles&&(u.includeFiles=c.includeFiles),Promise.all([i(),s(c)]).then(function(i){var s=i[0],d=i[1],h=t.createDialog({size:"medium",removeOnClose:!0});h.classList.add("ui-body-a"),h.classList.add("background-theme-a"),h.classList.add("popupEditor"),h.classList.add("directoryPicker");var b="";b+='<h2 class="dialogHeader">',b+='<button type="button" is="emby-button" icon="arrow-back" class="fab mini btnCloseDialog autoSize" tabindex="-1"><i class="md-icon">&#xE5C4;</i></button>',b+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+(c.header||Globalize.translate("HeaderSelectPath"))+"</div>",b+="</h2>",b+='<div class="editorContent" style="max-width:800px;margin:auto;">',b+=o(c,s),b+="</div>",h.innerHTML=b,document.body.appendChild(h);var y=h.querySelector(".editorContent");l(y,c,u),e(h).on("iron-overlay-opened",function(){this.querySelector("#txtDirectoryPickerPath input").focus()}),e(h).on("close",r),t.open(h),e(".btnCloseDialog",h).on("click",function(){t.close(h)}),a=h;var p=y.querySelector("#txtDirectoryPickerPath");p.value=d,n(y,p.value)})},c.close=function(){a&&t.close(a)}}var u;return c});