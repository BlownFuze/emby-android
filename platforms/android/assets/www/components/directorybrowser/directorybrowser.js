define(["dialogHelper","jQuery","paper-item","emby-input","emby-button","paper-item-body","paper-icon-button-light"],function(e,t){function i(){var e=jQuery.Deferred();return c?e.resolveWith(null,[c]):ApiClient.getPublicSystemInfo().then(function(t){c=t,e.resolveWith(null,[c])}),e.promise()}function r(){t(this).remove(),Dashboard.hideLoadingMsg()}function n(e,i,r){if(i&&"string"!=typeof i)throw new Error("invalid path");Dashboard.showLoadingMsg(),i?t(".networkHeadline").hide():t(".networkHeadline").show();var n=[];"Network"===i?n.push(ApiClient.getNetworkDevices()):i?(n.push(ApiClient.getDirectoryContents(i,r)),n.push(ApiClient.getParentPath(i))):n.push(ApiClient.getDrives()),Promise.all(n).then(function(r){var n=r[0],o=r[1]||"";t("#txtDirectoryPickerPath",e).val(i||"");var l="";i&&(l+=a("lnkPath lnkDirectory","",o,"..."));for(var s=0,c=n.length;c>s;s++){var u=n[s],d="File"==u.Type?"lnkPath lnkFile":"lnkPath lnkDirectory";l+=a(d,u.Type,u.Path,u.Name)}i||(l+=a("lnkPath lnkDirectory","","Network",Globalize.translate("ButtonNetwork"))),t(".results",e).html(l),Dashboard.hideLoadingMsg()},function(){t("#txtDirectoryPickerPath",e).val(""),t(".results",e).html(""),Dashboard.hideLoadingMsg()})}function a(e,t,i,r){var n="";return n+='<paper-item role="menuitem" class="'+e+'" data-type="'+t+'" data-path="'+i+'">',n+="<paper-item-body>",n+=r,n+="</paper-item-body>",n+='<iron-icon icon="arrow-forward"></iron-icon>',n+="</paper-item>"}function o(e,t){var i="",r=e.instruction?e.instruction+"<br/><br/>":"";return i+='<p class="directoryPickerHeadline">',i+=r,i+=Globalize.translate("MessageDirectoryPickerInstruction").replace("{0}","<b>\\\\server</b>").replace("{1}","<b>\\\\192.168.1.101</b>"),"bsd"==t.OperatingSystem.toLowerCase()?(i+="<br/>",i+="<br/>",i+=Globalize.translate("MessageDirectoryPickerBSDInstruction"),i+="<br/>",i+='<a href="http://doc.freenas.org/9.3/freenas_jails.html#add-storage" target="_blank">'+Globalize.translate("ButtonMoreInformation")+"</a>"):"linux"==t.OperatingSystem.toLowerCase()&&(i+="<br/>",i+="<br/>",i+=Globalize.translate("MessageDirectoryPickerLinuxInstruction"),i+="<br/>"),i+="</p>",i+='<form style="max-width:100%;">',i+='<div class="inputContainer" style="display: flex; align-items: center;">',i+='<div style="flex-grow:1;">',i+='<input is="emby-input" id="txtDirectoryPickerPath" type="text" required="required" label="'+Globalize.translate("LabelCurrentPath")+'"/>',i+="</div>",i+='<button type="button" is="paper-icon-button-light" class="btnRefreshDirectories" title="'+Globalize.translate("ButtonRefresh")+'"><iron-icon icon="refresh"></iron-icon></button>',i+="</div>",i+='<div class="results paperList" style="height: 180px; overflow-y: auto;"></div>',i+="<div>",i+='<button is="emby-button" type="submit" class="raised submit block">'+Globalize.translate("ButtonOk")+"</button>",i+="</div>",i+="</form>",i+="</div>"}function l(e,i,r){t(e).on("click",".lnkPath",function(){var i=this.getAttribute("data-path");t(this).hasClass("lnkFile")?t("#txtDirectoryPickerPath",e).val(i):n(e,i,r)}).on("click",".btnRefreshDirectories",function(){var i=t("#txtDirectoryPickerPath",e).val();n(e,i,r)}).on("change","#txtDirectoryPickerPath",function(){n(e,this.value,r)}),t("form",e).on("submit",function(){return i.callback&&i.callback(this.querySelector("#txtDirectoryPickerPath").value),!1})}function s(){var a,s=this;s.show=function(s){s=s||{};var c={includeDirectories:!0};null!=s.includeDirectories&&(c.includeDirectories=s.includeDirectories),null!=s.includeFiles&&(c.includeFiles=s.includeFiles),i().then(function(i){var u=e.createDialog({size:"medium"});u.classList.add("ui-body-a"),u.classList.add("background-theme-a"),u.classList.add("popupEditor"),u.classList.add("directoryPicker");var d="";d+='<h2 class="dialogHeader">',d+='<button type="button" is="emby-button" icon="arrow-back" class="fab mini btnCloseDialog" tabindex="-1"><iron-icon icon="arrow-back"></iron-icon></button>',d+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+(s.header||Globalize.translate("HeaderSelectPath"))+"</div>",d+="</h2>",d+='<div class="editorContent" style="max-width:800px;margin:auto;">',d+=o(s,i),d+="</div>",u.innerHTML=d,document.body.appendChild(u);var h=u.querySelector(".editorContent");l(h,s,c),t(u).on("iron-overlay-opened",function(){this.querySelector("#txtDirectoryPickerPath input").focus()}),t(u).on("close",r),e.open(u),t(".btnCloseDialog",u).on("click",function(){e.close(u)}),a=u;var b=t("#txtDirectoryPickerPath",h);s.path&&b.val(s.path),n(h,b.val())})},s.close=function(){a&&e.close(a)}}var c;return s});