define(["components/paperdialoghelper","paper-item","paper-input"],function(){function e(){var e=DeferredBuilder.Deferred();return l?e.resolveWith(null,[l]):ApiClient.getPublicSystemInfo().then(function(t){l=t,e.resolveWith(null,[l])}),e.promise()}function t(){$(this).remove(),Dashboard.hideLoadingMsg()}function r(e,t,r){Dashboard.showLoadingMsg(),t?$(".networkHeadline").hide():$(".networkHeadline").show();var a,n=null;"Network"===t?a=ApiClient.getNetworkDevices():t?(a=ApiClient.getDirectoryContents(t,r),n=ApiClient.getParentPath(t)):a=ApiClient.getDrives(),n||(n=new Promise(function(e){e()})),Promise.all([a,n]).then(function(r){var a=r[0],n=r[1]||"";$("#txtDirectoryPickerPath",e).val(t||"");var o="";t&&(o+=i("lnkPath lnkDirectory","",n,"..."));for(var l=0,c=a.length;c>l;l++){var s=a[l],u="File"==s.Type?"lnkPath lnkFile":"lnkPath lnkDirectory";o+=i(u,s.Type,s.Path,s.Name)}t||(o+=i("lnkPath lnkDirectory","","Network",Globalize.translate("ButtonNetwork"))),$(".results",e).html(o),Dashboard.hideLoadingMsg()},function(){$("#txtDirectoryPickerPath",e).val(""),$(".results",e).html(""),Dashboard.hideLoadingMsg()})}function i(e,t,r,i){var a="";return a+='<paper-item role="menuitem" class="'+e+'" data-type="'+t+'" data-path="'+r+'">',a+="<paper-item-body>",a+=i,a+="</paper-item-body>",a+='<iron-icon icon="arrow-forward"></iron-icon>',a+="</paper-item>"}function a(e,t){var r="",i=e.instruction?e.instruction+"<br/><br/>":"";return r+='<p class="directoryPickerHeadline">',r+=i,r+=Globalize.translate("MessageDirectoryPickerInstruction").replace("{0}","<b>\\\\server</b>").replace("{1}","<b>\\\\192.168.1.101</b>"),"bsd"==t.OperatingSystem.toLowerCase()?(r+="<br/>",r+="<br/>",r+=Globalize.translate("MessageDirectoryPickerBSDInstruction"),r+="<br/>",r+='<a href="http://doc.freenas.org/9.3/freenas_jails.html#add-storage" target="_blank">'+Globalize.translate("ButtonMoreInformation")+"</a>"):"linux"==t.OperatingSystem.toLowerCase()&&(r+="<br/>",r+="<br/>",r+=Globalize.translate("MessageDirectoryPickerLinuxInstruction"),r+="<br/>"),r+="</p>",r+='<form style="max-width:100%;">',r+="<div>",r+='<paper-input id="txtDirectoryPickerPath" type="text" required="required" style="width:82%;display:inline-block;" label="'+Globalize.translate("LabelCurrentPath")+'"></paper-input>',r+='<paper-icon-button icon="refresh" class="btnRefreshDirectories" title="'+Globalize.translate("ButtonRefresh")+'"></paper-icon-button>',r+="</div>",r+='<div class="results paperList" style="height: 180px; overflow-y: auto;"></div>',r+="<div>",r+='<button type="submit" class="clearButton" data-role="none"><paper-button raised class="submit block">'+Globalize.translate("ButtonOk")+"</paper-button></button>",r+="</div>",r+="</form>",r+="</div>"}function n(e,t,i){$(e).on("click",".lnkPath",function(){var t=this.getAttribute("data-path");$(this).hasClass("lnkFile")?$("#txtDirectoryPickerPath",e).val(t):r(e,t,i)}).on("click",".btnRefreshDirectories",function(){var t=$("#txtDirectoryPickerPath",e).val();r(e,t,i)}).on("change","#txtDirectoryPickerPath",function(){r(e,this.value,i)}),$("form",e).on("submit",function(){return t.callback&&t.callback(this.querySelector("#txtDirectoryPickerPath").value),!1})}function o(){var i,o=this;o.show=function(o){o=o||{};var l={includeDirectories:!0};null!=o.includeDirectories&&(l.includeDirectories=o.includeDirectories),null!=o.includeFiles&&(l.includeFiles=o.includeFiles),e().then(function(e){var c=PaperDialogHelper.createDialog({theme:"a",size:"medium"});c.classList.add("directoryPicker");var s="";s+='<h2 class="dialogHeader">',s+='<paper-fab icon="arrow-back" mini class="btnCloseDialog"></paper-fab>',s+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+(o.header||Globalize.translate("HeaderSelectPath"))+"</div>",s+="</h2>",s+='<div class="editorContent" style="max-width:800px;margin:auto;">',s+=a(o,e),s+="</div>",c.innerHTML=s,document.body.appendChild(c);var u=c.querySelector(".editorContent");n(u,o,l),$(c).on("iron-overlay-opened",function(){this.querySelector("#txtDirectoryPickerPath input").focus()}),$(c).on("iron-overlay-closed",t),PaperDialogHelper.openWithHash(c,"directorybrowser"),$(".btnCloseDialog",c).on("click",function(){PaperDialogHelper.close(c)}),i=c;var d=$("#txtDirectoryPickerPath",u);o.path&&d.val(o.path),r(u,d.val())})},o.close=function(){i&&PaperDialogHelper.close(i)}}var l;return o});