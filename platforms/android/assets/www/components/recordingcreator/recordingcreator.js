define(["paperdialoghelper","scripts/livetvcomponents","livetvcss","paper-checkbox","paper-input","paper-toggle-button"],function(e){function i(){return LiveTvHelpers.getDaysOfWeek().map(function(e){return e.value})}function n(e){for(var n=i(),t=[],r=0,o=n.length;o>r;r++){var s=n[r];$("#chk"+s,e).checked()&&t.push(s)}return t}function t(e){d(e.querySelector("#seriesFields")),e.querySelector(".btnSubmitContainer").classList.remove("hide"),e.querySelector(".supporterContainer").classList.add("hide")}function r(i){v=i,e.close(f)}function o(){Dashboard.showLoadingMsg();var e=this;return ApiClient.getNamedConfiguration("livetv").then(function(i){i.EnableRecordingEncoding=$("#chkConvertRecordings",e).checked(),ApiClient.updateNamedConfiguration("livetv",i).then(Dashboard.processServerConfigurationUpdateResult)}),ApiClient.getNewLiveTvTimerDefaults({programId:m}).then(function(i){i.PrePaddingSeconds=60*$("#txtPrePaddingMinutes",e).val(),i.PostPaddingSeconds=60*$("#txtPostPaddingMinutes",e).val(),i.RecordNewOnly=$("#chkNewOnly",e).checked(),i.RecordAnyChannel=$("#chkAllChannels",e).checked(),i.RecordAnyTime=$("#chkAnyTime",e).checked(),i.Days=n(e),$("#chkRecordSeries",e).checked()?ApiClient.createLiveTvSeriesTimer(i).then(function(){Dashboard.hideLoadingMsg(),r(!0)}):ApiClient.createLiveTvTimer(i).then(function(){Dashboard.hideLoadingMsg(),r(!0)})}),!1}function s(e){return Dashboard.showLoadingMsg(),ApiClient.getJSON(ApiClient.getUrl("LiveTv/Registration",{ProgramId:e,Feature:"seriesrecordings"})).then(function(e){return Dashboard.hideLoadingMsg(),e},function(){return Dashboard.hideLoadingMsg(),{TrialVersion:!0,IsValid:!0,IsRegistered:!1}})}function a(e){c(e.querySelector("#seriesFields")),e.querySelector(".btnSubmitContainer").classList.remove("hide"),s(m).then(function(i){i.IsValid?e.querySelector(".btnSubmitContainer").classList.remove("hide"):e.querySelector(".btnSubmitContainer").classList.add("hide"),i.IsRegistered?e.querySelector(".supporterContainer").classList.add("hide"):(e.querySelector(".supporterContainer").classList.remove("hide"),i.TrialVersion?e.querySelector(".supporterTrial").classList.remove("hide"):e.querySelector(".supporterTrial").classList.add("hide"))})}function c(e){e.classList.contains("hide")&&(e.classList.remove("hide"),e.style.overflow="hidden",requestAnimationFrame(function(){e.animate([{height:0},{height:e.offsetHeight+"px"}],{duration:400,easing:"ease"}).onfinish=function(){e.classList.remove("hide")}}))}function d(e){e.classList.contains("hide")||(e.style.overflow="hidden",requestAnimationFrame(function(){e.animate([{height:e.offsetHeight+"px"},{height:0}],{duration:400,easing:"ease"}).onfinish=function(){e.classList.add("hide")}}))}function l(e){$("#chkRecordSeries",e).on("change",function(){this.checked?a(e):t(e)}),$(".btnCancel",e).on("click",function(){r(!1)}),e.querySelector(".chkAdvanced").addEventListener("change",function(i){for(var n=e.querySelectorAll(".advancedToggle"),t=i.target.checked,r=0,o=n.length;o>r;r++)t?c(n[r]):d(n[r])}),$("form",e).off("submit",o).on("submit",o);for(var i=e.querySelectorAll(".btnSupporter"),n=0,s=i.length;s>n;n++)AppInfo.enableSupporterMembership?i[n].classList.remove("hide"):i[n].classList.add("hide");e.querySelector(".btnSupporterForConverting a").href=AppInfo.enableSupporterMembership?"https://emby.media/premiere":"#",ApiClient.getNamedConfiguration("livetv").then(function(i){$("#chkConvertRecordings",e).checked(i.EnableRecordingEncoding)})}function h(e,n){for(var t=i(),r=0,o=t.length;o>r;r++){var s=t[r];$("#chk"+s,e).checked(-1!=n.indexOf(s))}}function u(e,i,n){$(".itemName",e).html(n.Name),$(".itemEpisodeName",e).html(n.EpisodeTitle||""),$(".itemMiscInfo",e).html(LibraryBrowser.getMiscInfoHtml(n)),$(".itemMiscInfo a").each(function(){$(this).replaceWith(this.innerHTML)}),$("#chkNewOnly",e).checked(i.RecordNewOnly),$("#chkAllChannels",e).checked(i.RecordAnyChannel),$("#chkAnyTime",e).checked(i.RecordAnyTime),$("#txtPrePaddingMinutes",e).val(i.PrePaddingSeconds/60),$("#txtPostPaddingMinutes",e).val(i.PostPaddingSeconds/60),n.IsSeries?$("#eligibleForSeriesFields",e).show():$("#eligibleForSeriesFields",e).hide(),h(e,i.Days),"Emby"==n.ServiceName?e.querySelector(".convertRecordingsContainer").classList.remove("hide"):e.querySelector(".convertRecordingsContainer").classList.add("hide"),Dashboard.hideLoadingMsg()}function g(e,i){Dashboard.showLoadingMsg();var n=ApiClient.getNewLiveTvTimerDefaults({programId:i}),t=ApiClient.getLiveTvProgram(i,Dashboard.getCurrentUserId());Promise.all([n,t]).then(function(i){var n=i[0],t=i[1];u(e,n,t)})}function p(i){return new Promise(function(n,r){v=!1,m=i,Dashboard.showLoadingMsg();var o=new XMLHttpRequest;o.open("GET","components/recordingcreator/recordingcreator.template.html",!0),o.onload=function(){var o=this.response,s=e.createDialog({removeOnClose:!0,size:"small"});s.classList.add("ui-body-b"),s.classList.add("background-theme-b"),s.classList.add("formDialog");var a="";a+=Globalize.translateDocument(o),s.innerHTML=a,document.body.appendChild(s),e.open(s),f=s,s.addEventListener("iron-overlay-closed",function(){v?(Dashboard.alert(Globalize.translate("MessageRecordingScheduled")),n()):r()}),t(s),l(s),g(s,i)},o.send()})}var m,f,v=!1;return{show:p}});