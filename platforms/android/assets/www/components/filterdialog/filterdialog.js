define(["dialogHelper","events","browser","emby-checkbox","emby-collapse","css!components/filterdialog/style","paper-radio-button","paper-radio-group"],function(e,t,r){function i(e,t,r,i,n){var a=e.querySelector(t);i.length?a.classList.remove("hide"):a.classList.add("hide");var s="";s+='<div class="checkboxList">',s+=i.map(function(e){var t="",i=n(e)?" checked":"";return t+="<label>",t+='<input is="emby-checkbox" type="checkbox"'+i+' data-filter="'+e+'" class="'+r+'"/>',t+="<span>"+e+"</span>",t+="</label>"}).join(""),s+="</div>",a.querySelector(".filterOptions").innerHTML=s}function n(e,t,r){t.Tags&&(t.Tags.length=Math.min(t.Tags.length,50)),i(e,".genreFilters","chkGenreFilter",t.Genres,function(e){var t="|";return-1!=(t+(r.Genres||"")+t).indexOf(t+e+t)}),i(e,".officialRatingFilters","chkOfficialRatingFilter",t.OfficialRatings,function(e){var t="|";return-1!=(t+(r.OfficialRatings||"")+t).indexOf(t+e+t)}),i(e,".tagFilters","chkTagFilter",t.Tags,function(e){var t="|";return-1!=(t+(r.Tags||"")+t).indexOf(t+e+t)}),i(e,".yearFilters","chkYearFilter",t.Years,function(e){var t=",";return-1!=(t+(r.Years||"")+t).indexOf(t+e+t)})}function a(e,t,r){return ApiClient.getJSON(ApiClient.getUrl("Items/Filters",{UserId:t,ParentId:r.ParentId,IncludeItemTypes:r.IncludeItemTypes})).then(function(t){n(e,t,r)})}function s(e,t){var r,i,n,a=t.query;if("livetvchannels"==t.mode)e.querySelector(".chkFavorite").checked=1==a.IsFavorite,e.querySelector(".chkLikes").checked=1==a.IsLiked,e.querySelector(".chkDislikes").checked=1==a.IsDisliked;else for(r=e.querySelectorAll(".chkStandardFilter"),i=0,n=r.length;n>i;i++){var s=r[i],c=","+(a.Filters||""),l=s.getAttribute("data-filter");s.checked=-1!=c.indexOf(","+l)}for(r=e.querySelectorAll(".chkVideoTypeFilter"),i=0,n=r.length;n>i;i++){var d=r[i],c=","+(a.VideoTypes||""),l=d.getAttribute("data-filter");d.checked=-1!=c.indexOf(","+l)}for(e.querySelector(".chk3DFilter").checked=1==a.Is3D,e.querySelector(".chkHDFilter").checked=1==a.IsHD,e.querySelector(".chkSDFilter").checked=1==a.IsHD,e.querySelector("#chkSubtitle").checked=1==a.HasSubtitles,e.querySelector("#chkTrailer").checked=1==a.HasTrailer,e.querySelector("#chkThemeSong").checked=1==a.HasThemeSong,e.querySelector("#chkThemeVideo").checked=1==a.HasThemeVideo,e.querySelector("#chkSpecialFeature").checked=1==a.HasSpecialFeature,e.querySelector("#chkSpecialEpisode").checked=0==a.ParentIndexNumber,e.querySelector("#chkMissingEpisode").checked=1==a.IsMissing,e.querySelector("#chkFutureEpisode").checked=1==a.IsUnaired,e.querySelector(".playersRadioGroup").selected=null==a.MinPlayers?"all":a.MinPlayers,i=0,n=r.length;n>i;i++){var o=r[i],c=","+(a.SeriesStatus||""),l=o.getAttribute("data-filter");o.checked=-1!=c.indexOf(","+l)}for(r=e.querySelectorAll(".chkAirDays"),i=0,n=r.length;n>i;i++){var u=r[i],c=","+(a.AirDays||""),l=u.getAttribute("data-filter");u.checked=-1!=c.indexOf(","+l)}}function c(e){t.trigger(e,"filterchange")}function l(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function d(e,t){("livetvchannels"==t.mode||"albums"==t.mode||"artists"==t.mode||"albumartists"==t.mode||"songs"==t.mode)&&u(e,"videoStandard"),h(t.mode)&&(e.querySelector(".genreFilters").classList.remove("hide"),e.querySelector(".officialRatingFilters").classList.remove("hide"),e.querySelector(".tagFilters").classList.remove("hide"),e.querySelector(".yearFilters").classList.remove("hide")),("movies"==t.mode||"episodes"==t.mode)&&e.querySelector(".videoTypeFilters").classList.remove("hide"),"games"==t.mode&&e.querySelector(".players").classList.remove("hide"),("movies"==t.mode||"series"==t.mode||"games"==t.mode||"episodes"==t.mode)&&e.querySelector(".features").classList.remove("hide"),"series"==t.mode&&(e.querySelector(".airdays").classList.remove("hide"),e.querySelector(".seriesStatus").classList.remove("hide")),"episodes"==t.mode&&o(e,"episodeFilter")}function o(e,t){for(var r=e.querySelectorAll("."+t),i=0,n=r.length;n>i;i++)r[i].classList.remove("hide")}function u(e,t){for(var r=e.querySelectorAll("."+t),i=0,n=r.length;n>i;i++)r[i].classList.add("hide")}function h(e){return"movies"==e||"games"==e||"series"==e||"albums"==e||"albumartists"==e||"artists"==e||"songs"==e||"episodes"==e}return function(t){function i(){var e=t.query;e.StartIndex=0,e.IsFavorite=this.checked?!0:null,c(S)}function n(){var e=t.query,r=this.getAttribute("data-filter"),i=e.Filters||"";i=(","+i).replace(","+r,"").substring(1),this.checked&&(i=i?i+","+r:r),e.StartIndex=0,e.Filters=i,c(S)}function o(){var e=t.query,r=this.getAttribute("data-filter"),i=e.VideoTypes||"";i=(","+i).replace(","+r,"").substring(1),this.checked&&(i=i?i+","+r:r),e.StartIndex=0,e.VideoTypes=i,c(S)}function u(){var e=t.query,r=this.getAttribute("data-filter"),i=e.SeriesStatus||"";i=(","+i).replace(","+r,"").substring(1),this.checked&&(i=i?i+","+r:r),e.SeriesStatus=i,e.StartIndex=0,c(S)}function f(){var e=t.query,r=this.getAttribute("data-filter"),i=e.AirDays||"";i=(","+i).replace(","+r,"").substring(1),this.checked&&(i=i?i+","+r:r),e.AirDays=i,e.StartIndex=0,c(S)}function g(e){var r,a,s,d=t.query;if("livetvchannels"==t.mode){for(r=e.querySelectorAll(".chkFavorite"),a=0,s=r.length;s>a;a++)r[a].addEventListener("change",i);e.querySelector(".chkLikes").addEventListener("change",function(){d.StartIndex=0,d.IsLiked=this.checked?!0:null,c(S)}),e.querySelector(".chkDislikes").addEventListener("change",function(){d.StartIndex=0,d.IsDisliked=this.checked?!0:null,c(S)})}else for(r=e.querySelectorAll(".chkStandardFilter"),a=0,s=r.length;s>a;a++)r[a].addEventListener("change",n);for(r=e.querySelectorAll(".chkVideoTypeFilter"),a=0,s=r.length;s>a;a++)r[a].addEventListener("change",o);for(e.querySelector(".chk3DFilter").addEventListener("change",function(){d.StartIndex=0,d.Is3D=this.checked?!0:null,c(S)}),e.querySelector(".chkHDFilter").addEventListener("change",function(){d.StartIndex=0,d.IsHD=this.checked?!0:null,c(S)}),e.querySelector(".chkSDFilter").addEventListener("change",function(){d.StartIndex=0,d.IsHD=this.checked?!1:null,c(S)}),r=e.querySelectorAll(".chkStatus"),a=0,s=r.length;s>a;a++)r[a].addEventListener("change",u);for(r=e.querySelectorAll(".chkAirDays"),a=0,s=r.length;s>a;a++)r[a].addEventListener("change",f);e.querySelector("#chkTrailer").addEventListener("change",function(){d.StartIndex=0,d.HasTrailer=this.checked?!0:null,c(S)}),e.querySelector("#chkThemeSong").addEventListener("change",function(){d.StartIndex=0,d.HasThemeSong=this.checked?!0:null,c(S)}),e.querySelector("#chkSpecialFeature").addEventListener("change",function(){d.StartIndex=0,d.HasSpecialFeature=this.checked?!0:null,c(S)}),e.querySelector("#chkThemeVideo").addEventListener("change",function(){d.StartIndex=0,d.HasThemeVideo=this.checked?!0:null,c(S)}),e.querySelector("#chkMissingEpisode").addEventListener("change",function(){d.StartIndex=0,d.IsMissing=this.checked?!0:!1,c(S)}),e.querySelector("#chkSpecialEpisode").addEventListener("change",function(){d.StartIndex=0,d.ParentIndexNumber=this.checked?0:null,c(S)}),e.querySelector("#chkFutureEpisode").addEventListener("change",function(){d.StartIndex=0,this.checked?(d.IsUnaired=!0,d.IsVirtualUnaired=null):(d.IsUnaired=null,d.IsVirtualUnaired=!1),c(S)}),e.querySelector("#chkSubtitle").addEventListener("change",function(){d.StartIndex=0,d.HasSubtitles=this.checked?!0:null,c(S)}),e.querySelector(".playersRadioGroup").addEventListener("iron-select",function(e){d.StartIndex=0;var t=e.target.selected,r="all"==t?null:t,i=d.MinPlayers!=r;d.MinPlayers=r,i&&c(S)}),e.addEventListener("change",function(e){var t=l(e.target,"chkGenreFilter");if(t){var r=t.getAttribute("data-filter"),i=d.Genres||"",n="|";return i=(n+i).replace(n+r,"").substring(1),t.checked&&(i=i?i+n+r:r),d.StartIndex=0,d.Genres=i,void c(S)}var a=l(e.target,"chkTagFilter");if(a){var r=a.getAttribute("data-filter"),i=d.Tags||"",n="|";return i=(n+i).replace(n+r,"").substring(1),a.checked&&(i=i?i+n+r:r),d.StartIndex=0,d.Tags=i,void c(S)}var s=l(e.target,"chkYearFilter");if(s){var r=s.getAttribute("data-filter"),i=d.Years||"",n=",";return i=(n+i).replace(n+r,"").substring(1),s.checked&&(i=i?i+n+r:r),d.StartIndex=0,d.Years=i,void c(S)}var o=l(e.target,"chkOfficialRatingFilter");if(o){var r=o.getAttribute("data-filter"),i=d.OfficialRatings||"",n="|";return i=(n+i).replace(n+r,"").substring(1),o.checked&&(i=i?i+n+r:r),d.StartIndex=0,d.OfficialRatings=i,void c(S)}})}var S=this;S.show=function(){return new Promise(function(i){var n=new XMLHttpRequest;n.open("GET","components/filterdialog/filterdialog.template.html",!0),n.onload=function(){var n=this.response,c=e.createDialog({removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:200,autoFocus:!1});c.classList.add("ui-body-a"),c.classList.add("background-theme-a"),c.classList.add("formDialog"),c.classList.add("filterDialog"),c.innerHTML=Globalize.translateDocument(n),d(c,t),document.body.appendChild(c),e.open(c),c.addEventListener("close",i);var l=function(){s(c,t),g(c),h(t.mode)&&(c.classList.add("dynamicFilterDialog"),a(c,Dashboard.getCurrentUserId(),t.query))};r.animate?l():setTimeout(l,100)},n.send()})}}});