define(["paperdialoghelper","events","paper-checkbox","jqmcollapsible","css!components/filterdialog/style","paper-radio-button","paper-radio-group"],function(e,t){function i(e,t,i,r,a){var n=e.querySelector(t);r.length?n.classList.remove("hide"):n.classList.add("hide");var s="";s+='<div class="paperCheckboxList">',s+=r.map(function(e){var t="",r=a(e)?" checked":"";return t+="<paper-checkbox"+r+' data-filter="'+e+'" class="'+i+'">'+e+"</paper-checkbox>"}).join(""),s+="</div>",n.querySelector(".filterOptions").innerHTML=s}function r(e,t,r){t.Tags&&(t.Tags.length=Math.min(t.Tags.length,50)),i(e,".genreFilters","chkGenreFilter",t.Genres,function(e){var t="|";return-1!=(t+(r.Genres||"")+t).indexOf(t+e+t)}),i(e,".officialRatingFilters","chkOfficialRatingFilter",t.OfficialRatings,function(e){var t="|";return-1!=(t+(r.OfficialRatings||"")+t).indexOf(t+e+t)}),i(e,".tagFilters","chkTagFilter",t.Tags,function(e){var t="|";return-1!=(t+(r.Tags||"")+t).indexOf(t+e+t)}),i(e,".yearFilters","chkYearFilter",t.Years,function(e){var t=",";return-1!=(t+(r.Years||"")+t).indexOf(t+e+t)})}function a(e,t,i){return ApiClient.getJSON(ApiClient.getUrl("Items/Filters",{UserId:t,ParentId:i.ParentId,IncludeItemTypes:i.IncludeItemTypes})).then(function(t){r(e,t,i)})}function n(e,t){var i=t.query;"livetvchannels"==t.mode?($(".chkFavorite",e).checked(1==i.IsFavorite),$(".chkLikes",e).checked(1==i.IsLiked),$(".chkDislikes",e).checked(1==i.IsDisliked)):$(".chkStandardFilter",e).each(function(){var e=","+(i.Filters||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),$(".chkVideoTypeFilter",e).each(function(){var e=","+(i.VideoTypes||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),$(".chk3DFilter",e).checked(1==i.Is3D),$(".chkHDFilter",e).checked(1==i.IsHD),$(".chkSDFilter",e).checked(0==i.IsHD),$("#chkSubtitle",e).checked(1==i.HasSubtitles),$("#chkTrailer",e).checked(1==i.HasTrailer),$("#chkThemeSong",e).checked(1==i.HasThemeSong),$("#chkThemeVideo",e).checked(1==i.HasThemeVideo),$("#chkSpecialFeature",e).checked(1==i.HasSpecialFeature),$("#chkSpecialEpisode",e).checked(0==i.ParentIndexNumber),$("#chkMissingEpisode",e).checked(1==i.IsMissing),$("#chkFutureEpisode",e).checked(1==i.IsUnaired),e.querySelector(".playersRadioGroup").selected=null==i.MinPlayers?"all":i.MinPlayers,$(".chkStatus",e).each(function(){var e=","+(i.SeriesStatus||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),$(".chkAirDays",e).each(function(){var e=","+(i.AirDays||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)})}function s(e){t.trigger(e,"filterchange")}function c(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function l(e,t,i){var r=i.query;"livetvchannels"==i.mode?($(".chkFavorite",t).on("change",function(){r.StartIndex=0,r.IsFavorite=this.checked?!0:null,s(e)}),$(".chkLikes",t).on("change",function(){r.StartIndex=0,r.IsLiked=this.checked?!0:null,s(e)}),$(".chkDislikes",t).on("change",function(){r.StartIndex=0,r.IsDisliked=this.checked?!0:null,s(e)})):$(".chkStandardFilter",t).on("change",function(){var t=this.getAttribute("data-filter"),i=r.Filters||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),r.StartIndex=0,r.Filters=i,s(e)}),$(".chkVideoTypeFilter",t).on("change",function(){var t=this.getAttribute("data-filter"),i=r.VideoTypes||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),r.StartIndex=0,r.VideoTypes=i,s(e)}),$(".chk3DFilter",t).on("change",function(){r.StartIndex=0,r.Is3D=this.checked?!0:null,s(e)}),$(".chkHDFilter",t).on("change",function(){r.StartIndex=0,r.IsHD=this.checked?!0:null,s(e)}),$(".chkSDFilter",t).on("change",function(){r.StartIndex=0,r.IsHD=this.checked?!1:null,s(e)}),$(".chkStatus",t).on("change",function(){var t=this.getAttribute("data-filter"),i=r.SeriesStatus||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),r.SeriesStatus=i,r.StartIndex=0,s(e)}),$(".chkAirDays",t).on("change",function(){var t=this.getAttribute("data-filter"),i=r.AirDays||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),r.AirDays=i,r.StartIndex=0,s(e)}),$("#chkTrailer",t).on("change",function(){r.StartIndex=0,r.HasTrailer=this.checked?!0:null,s(e)}),$("#chkThemeSong",t).on("change",function(){r.StartIndex=0,r.HasThemeSong=this.checked?!0:null,s(e)}),$("#chkSpecialFeature",t).on("change",function(){r.StartIndex=0,r.HasSpecialFeature=this.checked?!0:null,s(e)}),$("#chkThemeVideo",t).on("change",function(){r.StartIndex=0,r.HasThemeVideo=this.checked?!0:null,s(e)}),$("#chkMissingEpisode",t).on("change",function(){r.StartIndex=0,r.IsMissing=this.checked?!0:!1,s(e)}),$("#chkSpecialEpisode",t).on("change",function(){r.StartIndex=0,r.ParentIndexNumber=this.checked?0:null,s(e)}),$("#chkFutureEpisode",t).on("change",function(){r.StartIndex=0,this.checked?(r.IsUnaired=!0,r.IsVirtualUnaired=null):(r.IsUnaired=null,r.IsVirtualUnaired=!1),s(e)}),$("#chkSubtitle",t).on("change",function(){r.StartIndex=0,r.HasSubtitles=this.checked?!0:null,s(e)}),t.querySelector(".playersRadioGroup").addEventListener("iron-select",function(t){r.StartIndex=0;var i=t.target.selected,a="all"==i?null:i,n=r.MinPlayers!=a;r.MinPlayers=a,n&&s(e)}),t.addEventListener("change",function(t){var i=c(t.target,"chkGenreFilter");if(i){var a=i.getAttribute("data-filter"),n=r.Genres||"",l="|";return n=(l+n).replace(l+a,"").substring(1),i.checked&&(n=n?n+l+a:a),r.StartIndex=0,r.Genres=n,void s(e)}var d=c(t.target,"chkTagFilter");if(d){var a=d.getAttribute("data-filter"),n=r.Tags||"",l="|";return n=(l+n).replace(l+a,"").substring(1),d.checked&&(n=n?n+l+a:a),r.StartIndex=0,r.Tags=n,void s(e)}var o=c(t.target,"chkYearFilter");if(o){var a=o.getAttribute("data-filter"),n=r.Years||"",l=",";return n=(l+n).replace(l+a,"").substring(1),o.checked&&(n=n?n+l+a:a),r.StartIndex=0,r.Years=n,void s(e)}var h=c(t.target,"chkOfficialRatingFilter");if(h){var a=h.getAttribute("data-filter"),n=r.OfficialRatings||"",l="|";return n=(l+n).replace(l+a,"").substring(1),h.checked&&(n=n?n+l+a:a),r.StartIndex=0,r.OfficialRatings=n,void s(e)}})}function d(e,t){("livetvchannels"==t.mode||"albums"==t.mode||"artists"==t.mode||"albumartists"==t.mode||"songs"==t.mode)&&h(e,"videoStandard"),u(t.mode)&&(e.querySelector(".genreFilters").classList.remove("hide"),e.querySelector(".officialRatingFilters").classList.remove("hide"),e.querySelector(".tagFilters").classList.remove("hide"),e.querySelector(".yearFilters").classList.remove("hide")),("movies"==t.mode||"episodes"==t.mode)&&e.querySelector(".videoTypeFilters").classList.remove("hide"),"games"==t.mode&&e.querySelector(".players").classList.remove("hide"),("movies"==t.mode||"series"==t.mode||"games"==t.mode||"episodes"==t.mode)&&e.querySelector(".features").classList.remove("hide"),"series"==t.mode&&(e.querySelector(".airdays").classList.remove("hide"),e.querySelector(".seriesStatus").classList.remove("hide")),"episodes"==t.mode&&o(e,"episodeFilter")}function o(e,t){for(var i=e.querySelectorAll("."+t),r=0,a=i.length;a>r;r++)i[r].classList.remove("hide")}function h(e,t){for(var i=e.querySelectorAll("."+t),r=0,a=i.length;a>r;r++)i[r].classList.add("hide")}function u(e){return"movies"==e||"games"==e||"series"==e||"albums"==e||"albumartists"==e||"artists"==e||"songs"==e||"episodes"==e}return function(t){var i=this;i.show=function(){return new Promise(function(r){var s=new XMLHttpRequest;s.open("GET","components/filterdialog/filterdialog.template.html",!0),s.onload=function(){var s=this.response,c=e.createDialog({removeOnClose:!0,modal:!1,enableHistory:!1,entryAnimationDuration:160,exitAnimationDuration:200});c.classList.add("ui-body-a"),c.classList.add("background-theme-a"),c.classList.add("formDialog"),c.classList.add("filterDialog");var o="";o+=Globalize.translateDocument(s),c.innerHTML=o,d(c,t),document.body.appendChild(c),$(c.querySelector(".filterDialogContent")).trigger("create"),e.open(c),c.addEventListener("iron-overlay-closed",r),n(c,t),l(i,c,t),u(t.mode)&&(c.classList.add("dynamicFilterDialog"),a(c,Dashboard.getCurrentUserId(),t.query))},s.send()})}}});