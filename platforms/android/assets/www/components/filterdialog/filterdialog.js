define(["dialogHelper","events","browser","emby-checkbox","emby-collapse","css!components/filterdialog/style"],function(e,t){function r(e,t,r,i,n){var a=e.querySelector(t);i.length?a.classList.remove("hide"):a.classList.add("hide");var c="";c+='<div class="checkboxList">',c+=i.map(function(e){var t="",i=n(e)?" checked":"";return t+="<label>",t+='<input is="emby-checkbox" type="checkbox"'+i+' data-filter="'+e+'" class="'+r+'"/>',t+="<span>"+e+"</span>",t+="</label>"}).join(""),c+="</div>",a.querySelector(".filterOptions").innerHTML=c}function i(e,t,i){t.Tags&&(t.Tags.length=Math.min(t.Tags.length,50)),r(e,".genreFilters","chkGenreFilter",t.Genres,function(e){var t="|";return-1!=(t+(i.Genres||"")+t).indexOf(t+e+t)}),r(e,".officialRatingFilters","chkOfficialRatingFilter",t.OfficialRatings,function(e){var t="|";return-1!=(t+(i.OfficialRatings||"")+t).indexOf(t+e+t)}),r(e,".tagFilters","chkTagFilter",t.Tags,function(e){var t="|";return-1!=(t+(i.Tags||"")+t).indexOf(t+e+t)}),r(e,".yearFilters","chkYearFilter",t.Years,function(e){var t=",";return-1!=(t+(i.Years||"")+t).indexOf(t+e+t)})}function n(e,t,r){return ApiClient.getJSON(ApiClient.getUrl("Items/Filters",{UserId:t,ParentId:r.ParentId,IncludeItemTypes:r.IncludeItemTypes})).then(function(t){i(e,t,r)})}function a(e,t){var r,i,n,a=t.query;if("livetvchannels"==t.mode)e.querySelector(".chkFavorite").checked=1==a.IsFavorite,e.querySelector(".chkLikes").checked=1==a.IsLiked,e.querySelector(".chkDislikes").checked=1==a.IsDisliked;else for(r=e.querySelectorAll(".chkStandardFilter"),i=0,n=r.length;n>i;i++){var c=r[i],s=","+(a.Filters||""),l=c.getAttribute("data-filter");c.checked=-1!=s.indexOf(","+l)}for(r=e.querySelectorAll(".chkVideoTypeFilter"),i=0,n=r.length;n>i;i++){var d=r[i],s=","+(a.VideoTypes||""),l=d.getAttribute("data-filter");d.checked=-1!=s.indexOf(","+l)}for(e.querySelector(".chk3DFilter").checked=1==a.Is3D,e.querySelector(".chkHDFilter").checked=1==a.IsHD,e.querySelector(".chkSDFilter").checked=1==a.IsHD,e.querySelector("#chkSubtitle").checked=1==a.HasSubtitles,e.querySelector("#chkTrailer").checked=1==a.HasTrailer,e.querySelector("#chkThemeSong").checked=1==a.HasThemeSong,e.querySelector("#chkThemeVideo").checked=1==a.HasThemeVideo,e.querySelector("#chkSpecialFeature").checked=1==a.HasSpecialFeature,e.querySelector("#chkSpecialEpisode").checked=0==a.ParentIndexNumber,e.querySelector("#chkMissingEpisode").checked=1==a.IsMissing,e.querySelector("#chkFutureEpisode").checked=1==a.IsUnaired,i=0,n=r.length;n>i;i++){var o=r[i],s=","+(a.SeriesStatus||""),l=o.getAttribute("data-filter");o.checked=-1!=s.indexOf(","+l)}for(r=e.querySelectorAll(".chkAirDays"),i=0,n=r.length;n>i;i++){var u=r[i],s=","+(a.AirDays||""),l=u.getAttribute("data-filter");u.checked=-1!=s.indexOf(","+l)}}function c(e){t.trigger(e,"filterchange")}function s(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function l(e,t){("livetvchannels"==t.mode||"albums"==t.mode||"artists"==t.mode||"albumartists"==t.mode||"songs"==t.mode)&&o(e,"videoStandard"),u(t.mode)&&(e.querySelector(".genreFilters").classList.remove("hide"),e.querySelector(".officialRatingFilters").classList.remove("hide"),e.querySelector(".tagFilters").classList.remove("hide"),e.querySelector(".yearFilters").classList.remove("hide")),("movies"==t.mode||"episodes"==t.mode)&&e.querySelector(".videoTypeFilters").classList.remove("hide"),"games"==t.mode,("movies"==t.mode||"series"==t.mode||"games"==t.mode||"episodes"==t.mode)&&e.querySelector(".features").classList.remove("hide"),"series"==t.mode&&(e.querySelector(".airdays").classList.remove("hide"),e.querySelector(".seriesStatus").classList.remove("hide")),"episodes"==t.mode&&d(e,"episodeFilter")}function d(e,t){for(var r=e.querySelectorAll("."+t),i=0,n=r.length;n>i;i++)r[i].classList.remove("hide")}function o(e,t){for(var r=e.querySelectorAll("."+t),i=0,n=r.length;n>i;i++)r[i].classList.add("hide")}function u(e){return"movies"==e||"games"==e||"series"==e||"albums"==e||"albumartists"==e||"artists"==e||"songs"==e||"episodes"==e}return function(t){function r(){var e=t.query;e.StartIndex=0,e.IsFavorite=this.checked?!0:null,c(g)}function i(){var e=t.query,r=this.getAttribute("data-filter"),i=e.Filters||"";i=(","+i).replace(","+r,"").substring(1),this.checked&&(i=i?i+","+r:r),e.StartIndex=0,e.Filters=i,c(g)}function d(){var e=t.query,r=this.getAttribute("data-filter"),i=e.VideoTypes||"";i=(","+i).replace(","+r,"").substring(1),this.checked&&(i=i?i+","+r:r),e.StartIndex=0,e.VideoTypes=i,c(g)}function o(){var e=t.query,r=this.getAttribute("data-filter"),i=e.SeriesStatus||"";i=(","+i).replace(","+r,"").substring(1),this.checked&&(i=i?i+","+r:r),e.SeriesStatus=i,e.StartIndex=0,c(g)}function h(){var e=t.query,r=this.getAttribute("data-filter"),i=e.AirDays||"";i=(","+i).replace(","+r,"").substring(1),this.checked&&(i=i?i+","+r:r),e.AirDays=i,e.StartIndex=0,c(g)}function f(e){var n,a,l,u=t.query;if("livetvchannels"==t.mode){for(n=e.querySelectorAll(".chkFavorite"),a=0,l=n.length;l>a;a++)n[a].addEventListener("change",r);e.querySelector(".chkLikes").addEventListener("change",function(){u.StartIndex=0,u.IsLiked=this.checked?!0:null,c(g)}),e.querySelector(".chkDislikes").addEventListener("change",function(){u.StartIndex=0,u.IsDisliked=this.checked?!0:null,c(g)})}else for(n=e.querySelectorAll(".chkStandardFilter"),a=0,l=n.length;l>a;a++)n[a].addEventListener("change",i);for(n=e.querySelectorAll(".chkVideoTypeFilter"),a=0,l=n.length;l>a;a++)n[a].addEventListener("change",d);for(e.querySelector(".chk3DFilter").addEventListener("change",function(){u.StartIndex=0,u.Is3D=this.checked?!0:null,c(g)}),e.querySelector(".chkHDFilter").addEventListener("change",function(){u.StartIndex=0,u.IsHD=this.checked?!0:null,c(g)}),e.querySelector(".chkSDFilter").addEventListener("change",function(){u.StartIndex=0,u.IsHD=this.checked?!1:null,c(g)}),n=e.querySelectorAll(".chkStatus"),a=0,l=n.length;l>a;a++)n[a].addEventListener("change",o);for(n=e.querySelectorAll(".chkAirDays"),a=0,l=n.length;l>a;a++)n[a].addEventListener("change",h);e.querySelector("#chkTrailer").addEventListener("change",function(){u.StartIndex=0,u.HasTrailer=this.checked?!0:null,c(g)}),e.querySelector("#chkThemeSong").addEventListener("change",function(){u.StartIndex=0,u.HasThemeSong=this.checked?!0:null,c(g)}),e.querySelector("#chkSpecialFeature").addEventListener("change",function(){u.StartIndex=0,u.HasSpecialFeature=this.checked?!0:null,c(g)}),e.querySelector("#chkThemeVideo").addEventListener("change",function(){u.StartIndex=0,u.HasThemeVideo=this.checked?!0:null,c(g)}),e.querySelector("#chkMissingEpisode").addEventListener("change",function(){u.StartIndex=0,u.IsMissing=this.checked?!0:!1,c(g)}),e.querySelector("#chkSpecialEpisode").addEventListener("change",function(){u.StartIndex=0,u.ParentIndexNumber=this.checked?0:null,c(g)}),e.querySelector("#chkFutureEpisode").addEventListener("change",function(){u.StartIndex=0,this.checked?(u.IsUnaired=!0,u.IsVirtualUnaired=null):(u.IsUnaired=null,u.IsVirtualUnaired=!1),c(g)}),e.querySelector("#chkSubtitle").addEventListener("change",function(){u.StartIndex=0,u.HasSubtitles=this.checked?!0:null,c(g)}),e.addEventListener("change",function(e){var t=s(e.target,"chkGenreFilter");if(t){var r=t.getAttribute("data-filter"),i=u.Genres||"",n="|";return i=(n+i).replace(n+r,"").substring(1),t.checked&&(i=i?i+n+r:r),u.StartIndex=0,u.Genres=i,void c(g)}var a=s(e.target,"chkTagFilter");if(a){var r=a.getAttribute("data-filter"),i=u.Tags||"",n="|";return i=(n+i).replace(n+r,"").substring(1),a.checked&&(i=i?i+n+r:r),u.StartIndex=0,u.Tags=i,void c(g)}var l=s(e.target,"chkYearFilter");if(l){var r=l.getAttribute("data-filter"),i=u.Years||"",n=",";return i=(n+i).replace(n+r,"").substring(1),l.checked&&(i=i?i+n+r:r),u.StartIndex=0,u.Years=i,void c(g)}var d=s(e.target,"chkOfficialRatingFilter");if(d){var r=d.getAttribute("data-filter"),i=u.OfficialRatings||"",n="|";return i=(n+i).replace(n+r,"").substring(1),d.checked&&(i=i?i+n+r:r),u.StartIndex=0,u.OfficialRatings=i,void c(g)}})}var g=this;g.show=function(){return new Promise(function(r){var i=new XMLHttpRequest;i.open("GET","components/filterdialog/filterdialog.template.html",!0),i.onload=function(){var i=this.response,c=e.createDialog({removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:200,autoFocus:!1});c.classList.add("ui-body-a"),c.classList.add("background-theme-a"),c.classList.add("formDialog"),c.classList.add("filterDialog"),c.innerHTML=Globalize.translateDocument(i),l(c,t),document.body.appendChild(c),e.open(c),c.addEventListener("close",r),a(c,t),f(c),u(t.mode)&&(c.classList.add("dynamicFilterDialog"),n(c,Dashboard.getCurrentUserId(),t.query))},i.send()})}}});