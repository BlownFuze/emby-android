!function(e,a,r){function o(e){switch(Dashboard.hideLoadingMsg(),e.target.error.code){case e.target.error.NOT_FOUND_ERR:Dashboard.alert(Globalize.translate("MessageFileNotFound"));break;case e.target.error.ABORT_ERR:break;default:Dashboard.alert(Globalize.translate("MessageFileReadError"))}}function t(a,r){var t=r[0];if(!t||!t.type.match("image.*"))return e("#imageOutput",a).html(""),e("#fldUpload",a).hide(),void(p=null);p=t;var n=new FileReader;n.onerror=o,n.onloadstart=function(){e("#fldUpload",a).hide()},n.onabort=function(){Dashboard.hideLoadingMsg(),Logger.log("File read cancelled")},n.onload=function(r){return function(o){var t=['<img style="max-width:300px;max-height:100px;" src="',o.target.result,'" title="',escape(r.name),'"/>'].join("");e("#imageOutput",a).html(t),e("#fldUpload",a).show()}}(t),n.readAsDataURL(t)}function n(){c=!0,history.back()}function i(){var a=p;if(!a)return!1;if("image/png"!=a.type&&"image/jpeg"!=a.type&&"image/jpeg"!=a.type)return!1;Dashboard.showLoadingMsg();var r=e(this).parents("paper-dialog"),o=e("#selectImageType",r).val();return ApiClient.uploadItemImage(g,o,a).then(function(){e("#uploadImage",r).val("").trigger("change"),Dashboard.hideLoadingMsg(),n(r)}),!1}function l(a){e("form",a).off("submit",i).on("submit",i),e("#uploadImage",a).on("change",function(){t(a,this.files)}),e("#imageDropZone",a).on("dragover",function(e){return e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="Copy",!1}).on("drop",function(e){return e.preventDefault(),t(a,e.originalEvent.dataTransfer.files),!1})}function d(a,o){o=o||{};var t=new XMLHttpRequest;t.open("GET","components/imageuploader/imageuploader.template.html",!0),t.onload=function(){var t=this.response;g=a;var n=PaperDialogHelper.createDialog({theme:o.theme}),i="";i+='<h2 class="dialogHeader">',i+='<paper-fab icon="arrow-back" mini class="btnCloseDialog"></paper-fab>',i+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+Globalize.translate("HeaderUploadImage")+"</div>",i+="</h2>",i+='<div class="editorContent">',i+=Globalize.translateDocument(t),i+="</div>",n.innerHTML=i,r.body.appendChild(n),e(n).on("iron-overlay-closed",s),PaperDialogHelper.openWithHash(n,"imageuploader");var d=n.querySelector(".editorContent");l(d),e(".btnCloseDialog",n).on("click",function(){PaperDialogHelper.close(n)})},t.send()}function s(){e(this).remove(),Dashboard.hideLoadingMsg(),u.resolveWith(null,[c])}var g,p,u,c=!1;a.ImageUploader={show:function(e,a){var r=DeferredBuilder.Deferred();return u=r,c=!1,require(["components/paperdialoghelper"],function(){d(e,a)}),r.promise()}}}(jQuery,window,document);