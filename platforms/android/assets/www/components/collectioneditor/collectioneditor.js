define(["paperdialoghelper","jQuery","paper-checkbox","paper-dialog","paper-input"],function(e,t){function o(){Dashboard.showLoadingMsg();var e=t(this).parents("paper-dialog")[0],o=t("#selectCollectionToAddTo",e).val();return o?n(e,o):a(e),!1}function a(o){var a=ApiClient.getUrl("Collections",{Name:t("#txtNewCollectionName",o).val(),IsLocked:!t("#chkEnableInternetMetadata",o).checked(),Ids:t(".fldSelectedItemIds",o).val()||""});ApiClient.ajax({type:"POST",url:a,dataType:"json"}).then(function(t){Dashboard.hideLoadingMsg();var a=t.Id;e.close(o),l(a)})}function l(e){var t=getParameterByName("context");ApiClient.getItem(Dashboard.getCurrentUserId(),e).then(function(e){Dashboard.navigate(LibraryBrowser.getHref(e,t))})}function n(o,a){var l=ApiClient.getUrl("Collections/"+a+"/Items",{Ids:t(".fldSelectedItemIds",o).val()||""});ApiClient.ajax({type:"POST",url:l}).then(function(){Dashboard.hideLoadingMsg(),e.close(o),require(["toast"],function(e){e(Globalize.translate("MessageItemsAdded"))})})}function i(){t(this).remove(),Dashboard.hideLoadingMsg()}function r(e){Dashboard.showLoadingMsg();var o=t("#selectCollectionToAddTo",e);t(".newCollectionInfo",e).hide();var a={Recursive:!0,IncludeItemTypes:"BoxSet",SortBy:"SortName"};ApiClient.getItems(Dashboard.getCurrentUserId(),a).then(function(e){var t="";t+='<option value="">'+Globalize.translate("OptionNewCollection")+"</option>",t+=e.Items.map(function(e){return'<option value="'+e.Id+'">'+e.Name+"</option>"}),o.html(t).val("").trigger("change"),Dashboard.hideLoadingMsg()})}function d(){var e="";return e+='<form class="newCollectionForm" style="margin:auto;">',e+='<div class="fldSelectCollection">',e+='<label for="selectCollectionToAddTo" class="selectLabel">'+Globalize.translate("LabelSelectCollection")+"</label>",e+='<select id="selectCollectionToAddTo" data-mini="true"></select>',e+="</div>",e+='<div class="newCollectionInfo">',e+="<div>",e+='<paper-input type="text" id="txtNewCollectionName" required="required" label="'+Globalize.translate("LabelName")+'"></paper-input>',e+='<div class="fieldDescription">'+Globalize.translate("NewCollectionNameExample")+"</div>",e+="</div>",e+="<br />",e+="<br />",e+="<div>",e+='<paper-checkbox id="chkEnableInternetMetadata">'+Globalize.translate("OptionSearchForInternetMetadata")+"</paper-checkbox>",e+="</div>",e+="</div>",e+="<br />",e+="<div>",e+='<button type="submit" class="clearButton" data-role="none"><paper-button raised class="submit block">'+Globalize.translate("ButtonOk")+"</paper-button></button>",e+="</div>",e+='<input type="hidden" class="fldSelectedItemIds" />',e+="</form>"}function c(e,a){t("#selectCollectionToAddTo",e).on("change",function(){this.value?(t(".newCollectionInfo",e).hide(),t("#txtNewCollectionName",e).removeAttr("required")):(t(".newCollectionInfo",e).show(),t("#txtNewCollectionName",e).attr("required","required"))}),t(".newCollectionForm",e).off("submit",o).on("submit",o),t(".fldSelectedItemIds",e).val(a.join(",")),a.length?(t(".fldSelectCollection",e).show(),r(e)):(t(".fldSelectCollection",e).hide(),t("#selectCollectionToAddTo",e).html("").val("").trigger("change"))}function s(){var o=this;o.show=function(o){o=o||[];var a=e.createDialog({size:"small"});a.classList.add("ui-body-b"),a.classList.add("background-theme-b");var l="",n=Globalize.translate(o.length?"HeaderAddToCollection":"HeaderNewCollection");l+='<div class="dialogHeader">',l+='<paper-icon-button icon="arrow-back" class="btnCancel" tabindex="-1"></paper-icon-button>',l+='<div class="dialogHeaderTitle">',l+=n,l+="</div>",l+="</div>",l+=d(),a.innerHTML=l,document.body.appendChild(a),c(a,o),t(a).on("iron-overlay-closed",i),e.open(a),t(".btnCancel",a).on("click",function(){e.close(a)})}}return s});