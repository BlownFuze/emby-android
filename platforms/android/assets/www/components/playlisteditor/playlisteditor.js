define(["dialogHelper","jQuery","paper-input","paper-icon-button-light"],function(e,t){function a(e){var t=getParameterByName("context");ApiClient.getItem(Dashboard.getCurrentUserId(),e).then(function(e){Dashboard.navigate(LibraryBrowser.getHref(e,t))})}function l(){Dashboard.showLoadingMsg();var e=t(this).parents(".dialog")[0],a=t("#selectPlaylistToAddTo",e).val();return a?(u=a,n(e,a)):i(e),!1}function i(l){var i=ApiClient.getUrl("Playlists",{Name:t("#txtNewPlaylistName",l).val(),Ids:t(".fldSelectedItemIds",l).val()||"",userId:Dashboard.getCurrentUserId()});ApiClient.ajax({type:"POST",url:i,dataType:"json"}).then(function(t){Dashboard.hideLoadingMsg();var i=t.Id;e.close(l),a(i)})}function n(a,l){var i=ApiClient.getUrl("Playlists/"+l+"/Items",{Ids:t(".fldSelectedItemIds",a).val()||"",userId:Dashboard.getCurrentUserId()});ApiClient.ajax({type:"POST",url:i}).then(function(){Dashboard.hideLoadingMsg(),e.close(a),require(["toast"],function(e){e(Globalize.translate("MessageAddedToPlaylistSuccess"))})})}function o(){t(this).remove(),Dashboard.hideLoadingMsg()}function s(e){var a=t("#selectPlaylistToAddTo",e);if(!a.length)return void t("#txtNewPlaylistName",e).val("").focus();Dashboard.showLoadingMsg(),t(".newPlaylistInfo",e).hide();var l={Recursive:!0,IncludeItemTypes:"Playlist",SortBy:"SortName"};ApiClient.getItems(Dashboard.getCurrentUserId(),l).then(function(e){var t="";t+='<option value="">'+Globalize.translate("OptionNewPlaylist")+"</option>",t+=e.Items.map(function(e){return'<option value="'+e.Id+'">'+e.Name+"</option>"}),a.html(t).val(u||"").trigger("change"),Dashboard.hideLoadingMsg()})}function r(){var e="";return e+='<form style="margin:auto;">',e+='<div class="fldSelectPlaylist">',e+='<label for="selectPlaylistToAddTo" class="selectLabel">'+Globalize.translate("LabelSelectPlaylist")+"</label>",e+='<select id="selectPlaylistToAddTo" data-mini="true"></select>',e+="</div>",e+='<div class="newPlaylistInfo">',e+="<div>",e+='<paper-input type="text" id="txtNewPlaylistName" required="required" label="'+Globalize.translate("LabelName")+'"></paper-input>',e+="</div>",e+="<br />",e+="</div>",e+="<br />",e+="<div>",e+='<button type="submit" class="clearButton" data-role="none"><paper-button raised class="submit block">'+Globalize.translate("ButtonOk")+"</paper-button></button>",e+="</div>",e+='<input type="hidden" class="fldSelectedItemIds" />',e+="</form>"}function d(e,a){t("#selectPlaylistToAddTo",e).on("change",function(){this.value?(t(".newPlaylistInfo",e).hide(),t("input",e).removeAttr("required")):(t(".newPlaylistInfo",e).show(),t("input",e).attr("required","required"))}).trigger("change"),s(e),t("form",e).on("submit",l),t(".fldSelectedItemIds",e).val(a.join(",")),a.length?(t(".fldSelectPlaylist",e).show(),s(e)):(t(".fldSelectPlaylist",e).hide(),t("#selectPlaylistToAddTo",e).html("").val("").trigger("change"))}function c(){var a=this;a.show=function(a){a=a||[];var l=e.createDialog({size:"small"});l.classList.add("ui-body-b"),l.classList.add("background-theme-b");var i="",n=Globalize.translate("HeaderAddToPlaylist");i+='<div class="dialogHeader">',i+='<button is="paper-icon-button-light" class="btnCancel" tabindex="-1"><iron-icon icon="arrow-back"></iron-icon></button>',i+='<div class="dialogHeaderTitle">',i+=n,i+="</div>",i+="</div>",i+=r(),l.innerHTML=i,document.body.appendChild(l),d(l,a),t(l).on("close",o),e.open(l),t(".btnCancel",l).on("click",function(){e.close(l)})}}var u="";return c});