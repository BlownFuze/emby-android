!function(e,t,n){function a(){var e={};return e.itemId=u.Id,e}function i(e,t){Dashboard.showLoadingMsg(),t?o(e,t):ApiClient.getItem(Dashboard.getCurrentUserId(),u.Id).then(function(t){o(e,t)})}function o(t,n){u=n,ApiClient.getRemoteImageProviders(a()).then(function(a){a.length?e(".btnBrowseAllImages",t).removeClass("hide"):e(".btnBrowseAllImages",t).addClass("hide"),ApiClient.getItemImageInfos(u.Id).then(function(e){l(t,n,e,a),d(t,n,e,a),s(t,n,e,a),Dashboard.hideLoadingMsg()})})}function r(t,n,a,o,r){for(var l="",d=0,s=a.length;s>d;d++){var g=a[d];l+='<div class="editorTile imageEditorTile">',l+='<div class="editorTileInner">';var p=150;l+='<div style="height:'+p+'px;vertical-align:top;background-repeat:no-repeat;background-position:center bottom;background-size:contain;" class="lazy" data-src="'+LibraryBrowser.getImageUrl(u,g.ImageType,g.ImageIndex,{height:p})+'"></div>',l+='<div class="editorTileFooter">',"Backdrop"!==g.ImageType&&"Screenshot"!==g.ImageType&&(l+="<h3>"+g.ImageType+"</h3>"),l+=g.Width&&g.Height?"<p>"+g.Width+" X "+g.Height+"</p>":"<p>&nbsp;</p>",l+="<div>","Backdrop"==g.ImageType||"Screenshot"==g.ImageType?(l+=d>0?'<paper-icon-button class="btnMoveImage" icon="chevron-left" data-imagetype="'+g.ImageType+'" data-index="'+g.ImageIndex+'" data-newindex="'+(g.ImageIndex-1)+'" title="'+Globalize.translate("ButtonMoveLeft")+'"></paper-icon-button>':'<paper-icon-button icon="chevron-left" disabled title="'+Globalize.translate("ButtonMoveLeft")+'"></paper-icon-button>',l+=s-1>d?'<paper-icon-button class="btnMoveImage" icon="chevron-right" data-imagetype="'+g.ImageType+'" data-index="'+g.ImageIndex+'" data-newindex="'+(g.ImageIndex+1)+'" title="'+Globalize.translate("ButtonMoveRight")+'"></paper-icon-button>':'<paper-icon-button icon="chevron-right" disabled title="'+Globalize.translate("ButtonMoveRight")+'"></paper-icon-button>'):o.length&&(l+='<paper-icon-button icon="search" data-imagetype="'+g.ImageType+'" class="btnSearchImages" title="'+Globalize.translate("ButtonBrowseOnlineImages")+'"></paper-icon-button>'),l+='<paper-icon-button icon="delete" data-imagetype="'+g.ImageType+'" data-index="'+(null!=g.ImageIndex?g.ImageIndex:"null")+'" class="btnDeleteImage" title="'+Globalize.translate("Delete")+'"></paper-icon-button>',l+="</div>",l+="</div>",l+="</div>",l+="</div>"}r.innerHTML=l,ImageLoader.lazyChildren(r),e(".btnSearchImages",r).on("click",function(){c(t,this.getAttribute("data-imagetype"))}),e(".btnDeleteImage",r).on("click",function(){var e=this.getAttribute("data-imagetype"),n=this.getAttribute("data-index");n="null"==n?null:parseInt(n),Dashboard.confirm(Globalize.translate("DeleteImageConfirmation"),Globalize.translate("HeaderDeleteImage"),function(a){a&&ApiClient.deleteItemImage(u.Id,e,n).then(function(){I=!0,i(t)})})}),e(".btnMoveImage",r).on("click",function(){var e=this.getAttribute("data-imagetype"),n=parseInt(this.getAttribute("data-index")),a=parseInt(this.getAttribute("data-newindex"));ApiClient.updateItemImageIndex(u.Id,e,n,a).then(function(){I=!0,i(t)})})}function l(e,t,n,a){var i=n.filter(function(e){return"Screenshot"!=e.ImageType&&"Backdrop"!=e.ImageType&&"Chapter"!=e.ImageType});r(e,t,i,a,e.querySelector("#images"))}function d(t,n,a,i){var o=a.filter(function(e){return"Backdrop"==e.ImageType}).sort(function(e,t){return e.ImageIndex-t.ImageIndex});o.length?(e("#backdropsContainer",t).show(),r(t,n,o,i,t.querySelector("#backdrops"))):e("#backdropsContainer",t).hide()}function s(t,n,a,i){var o=a.filter(function(e){return"Screenshot"==e.ImageType}).sort(function(e,t){return e.ImageIndex-t.ImageIndex});o.length?(e("#screenshotsContainer",t).show(),r(t,n,o,i,e("#screenshots",t))):e("#screenshotsContainer",t).hide()}function c(e,t){require(["components/imagedownloader/imagedownloader"],function(){ImageDownloader.show(u.Id,u.Type,t).then(function(t){t&&(I=!0,i(e))})})}function g(t,n){e(".btnOpenUploadMenu",t).on("click",function(){require(["components/imageuploader/imageuploader"],function(){ImageUploader.show(u.Id,{theme:n.theme}).then(function(e){e&&(I=!0,i(t))})})}),e(".btnBrowseAllImages",t).on("click",function(){c(t,this.getAttribute("data-imagetype")||"Primary")})}function p(n,a){a=a||{},Dashboard.showLoadingMsg();var o=new XMLHttpRequest;o.open("GET","components/imageeditor/imageeditor.template.html",!0),o.onload=function(){var o=this.response;ApiClient.getItem(Dashboard.getCurrentUserId(),n).then(function(n){var r=PaperDialogHelper.createDialog({theme:a.theme}),l="";l+='<h2 class="dialogHeader">',l+='<paper-fab icon="arrow-back" mini class="btnCloseDialog"></paper-fab>',l+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+n.Name+"</div>",l+="</h2>",l+='<div class="editorContent">',l+=Globalize.translateDocument(o),l+="</div>",r.innerHTML=l,t.body.appendChild(r),g(r,a),e(r).on("iron-overlay-closed",m),PaperDialogHelper.openWithHash(r,"imageeditor");var d=r.querySelector(".editorContent");i(d,n),e(".btnCloseDialog",r).on("click",function(){PaperDialogHelper.close(r)})})},o.send()}function m(){e(this).remove(),Dashboard.hideLoadingMsg(),h.resolveWith(null,[I])}var u,h,I=!1;n.ImageEditor={show:function(e,t){var n=DeferredBuilder.Deferred();return h=n,I=!1,require(["components/paperdialoghelper"],function(){Dashboard.importCss("css/metadataeditor.css"),p(e,t)}),n.promise()}}}(jQuery,document,window,window.FileReader,escape);