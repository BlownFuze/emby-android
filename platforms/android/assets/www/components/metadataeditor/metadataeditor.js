define(["itemHelper","dialogHelper","datetime","loading","focusManager","connectionManager","globalize","emby-checkbox","emby-input","emby-select","listViewStyle","emby-textarea","emby-button","paper-icon-button-light"],function(e,t,r,a,n,i,l){function o(){return z.classList.contains("dialog")}function u(){o()&&t.close(z)}function s(e,t){function r(){require(["toast"],function(e){e(l.translate("MessageItemSaved"))}),a.hide(),u(!0)}var n=C();n.updateItem(t).then(function(){var a=e.querySelector("#selectContentType").value||"";(j.ContentType||"")!=a?n.ajax({url:n.getUrl("Items/"+t.Id+"/ContentType",{ContentType:a}),type:"POST"}).then(function(){r()}):r()})}function c(e){var t=e.querySelectorAll(".chkAirDay:checked")||[];return Array.prototype.map.call(t,function(){return this.getAttribute("data-day")})}function d(e){return e.querySelector("#txtAlbumArtist").value.trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function y(e){return e.querySelector("#txtArtist").value.trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function p(e,t,a){var n=e.querySelector(t).value;if(!n)return null;if(_[a]){var i=r.parseISO8601Date(_[a],!0),l=i.toISOString().split("T");if(0==l[0].indexOf(n)){var o=l[1];n+="T"+o}}return n}function v(e){a.show();var t=this;try{var r={Id:_.Id,Name:t.querySelector("#txtName").value,OriginalTitle:t.querySelector("#txtOriginalName").value,ForcedSortName:t.querySelector("#txtSortName").value,DisplayMediaType:t.querySelector("#txtDisplayMediaType").value,CommunityRating:t.querySelector("#txtCommunityRating").value,VoteCount:t.querySelector("#txtCommunityVoteCount").value,HomePageUrl:t.querySelector("#txtHomePageUrl").value,Budget:t.querySelector("#txtBudget").value,Revenue:t.querySelector("#txtRevenue").value,CriticRating:t.querySelector("#txtCriticRating").value,CriticRatingSummary:t.querySelector("#txtCriticRatingSummary").value,IndexNumber:t.querySelector("#txtIndexNumber").value||null,AbsoluteEpisodeNumber:t.querySelector("#txtAbsoluteEpisodeNumber").value,DvdEpisodeNumber:t.querySelector("#txtDvdEpisodeNumber").value,DvdSeasonNumber:t.querySelector("#txtDvdSeasonNumber").value,AirsBeforeSeasonNumber:t.querySelector("#txtAirsBeforeSeason").value,AirsAfterSeasonNumber:t.querySelector("#txtAirsAfterSeason").value,AirsBeforeEpisodeNumber:t.querySelector("#txtAirsBeforeEpisode").value,ParentIndexNumber:t.querySelector("#txtParentIndexNumber").value||null,DisplayOrder:t.querySelector("#selectDisplayOrder").value,Players:t.querySelector("#txtPlayers").value,Album:t.querySelector("#txtAlbum").value,AlbumArtist:d(t),ArtistItems:y(t),Metascore:t.querySelector("#txtMetascore").value,AwardSummary:t.querySelector("#txtAwardSummary").value,Overview:t.querySelector("#txtOverview").value,ShortOverview:t.querySelector("#txtShortOverview").value,Status:t.querySelector("#selectStatus").value,AirDays:c(t),AirTime:t.querySelector("#txtAirTime").value,Genres:S(t.querySelector("#listGenres")),ProductionLocations:S(t.querySelector("#listCountries")),Tags:S(t.querySelector("#listTags")),Keywords:S(t.querySelector("#listKeywords")),Studios:S(t.querySelector("#listStudios")).map(function(e){return{Name:e}}),PremiereDate:p(t,"#txtPremiereDate","PremiereDate"),DateCreated:p(t,"#txtDateAdded","DateCreated"),EndDate:p(t,"#txtEndDate","EndDate"),ProductionYear:t.querySelector("#txtProductionYear").value,AspectRatio:t.querySelector("#txtOriginalAspectRatio").value,Video3DFormat:t.querySelector("#select3dFormat").value,OfficialRating:t.querySelector("#selectOfficialRating").value,CustomRating:t.querySelector("#selectCustomRating").value,People:_.People,LockData:t.querySelector("#chkLockData").checked,LockedFields:Array.prototype.filter.call(t.querySelectorAll(".selectLockedField"),function(e){return!e.checked}).map(function(e){return e.getAttribute("data-value")})};r.ProviderIds=Object.assign({},_.ProviderIds);var n=t.querySelectorAll(".txtExternalId");if(Array.prototype.map.call(n,function(e){var t=e.getAttribute("data-providerkey");r.ProviderIds[t]=e.value}),r.PreferredMetadataLanguage=t.querySelector("#selectLanguage").value,r.PreferredMetadataCountryCode=t.querySelector("#selectCountry").value,"Person"==_.Type){var i=t.querySelector("#txtPlaceOfBirth").value;r.ProductionLocations=i?[i]:[]}if("Series"==_.Type){var l=t.querySelector("#txtSeriesRuntime").value;r.RunTimeTicks=l?6e8*l:null}var o=t.querySelector("#txtTagline").value;r.Taglines=o?[o]:[],s(t,r)}catch(u){alert(u)}return e.preventDefault(),e.stopPropagation(),!1}function m(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function S(e){return Array.prototype.map.call(e.querySelectorAll(".textValue"),function(e){return e.textContent})}function f(e,t){require(["prompt"],function(r){r({label:"Value:"}).then(function(r){var a=m(e,"editableListviewContainer").querySelector(".paperList"),n=S(a);n.push(r),F(a,n,t)})})}function b(e){var t=m(e,"listItem");t.parentNode.removeChild(t)}function g(e,t,r){require(["components/metadataeditor/personeditor"],function(a){a.show(t).then(function(t){var a=-1==r;a&&_.People.push(t),G(e,_.People)})})}function q(e,t){require(["itemContextMenu"],function(r){r.show({item:_,positionTo:t,edit:!1,editImages:!0,editSubtitles:!0,sync:!1,share:!1}).then(function(t){t.deleted?Emby.Page.goHome():t.updated&&Y(e,_.Id,_.ServerId)})})}function T(e,t){var r=t;"LibraryChanged"===r.MessageType&&-1!=r.Data.ItemsUpdated.indexOf(_.Id)&&Y(z,_.Id,_.ServerId)}function x(e,t){Events.on(t,"websocketmessage",T)}function h(e,t){Events.off(t,"websocketmessage",T)}function A(e){var t=m(e.target,"btnRemoveFromEditorList");if(t)return void b(t);var r=m(e.target,"btnAddTextItem");r&&f(r)}function C(){return i.getApiClient(_.ServerId)}function D(e,t){e.querySelector(".btnCancel").addEventListener("click",function(){u(!1)}),e.querySelector(".btnMore").addEventListener("click",function(t){C().getCurrentUser().then(function(r){q(e,t.target,r)})}),e.querySelector(".btnHeaderSave").addEventListener("click",function(){e.querySelector(".btnSave").click()}),e.querySelector("#chkLockData").addEventListener("click",function(e){e.target.checked?M(".providerSettingsContainer"):k(".providerSettingsContainer")}),e.removeEventListener("click",A),e.addEventListener("click",A);var r=e.querySelector("form");r.removeEventListener("submit",v),r.addEventListener("submit",v),e.querySelector("#btnAddPerson").addEventListener("click",function(){g(e,{},-1)}),o()&&x(e,t)}function P(e,t){var r=i.getApiClient(t);return e?r.getItem(r.getCurrentUserId(),e):r.getRootFolder(r.getCurrentUserId())}function L(e,t){var r=i.getApiClient(t);return e?r.getJSON(r.getUrl("Items/"+e+"/MetadataEditor")):Promise.resolve({})}function N(e,t){var r="";r+="<option value=''></option>";for(var a=0,n=t.length;n>a;a++){var i=t[a];r+="<option value='"+i.TwoLetterISORegionName+"'>"+i.DisplayName+"</option>"}e.innerHTML=r}function O(e,t){var r="";r+="<option value=''></option>";for(var a=0,n=t.length;n>a;a++){var i=t[a];r+="<option value='"+i.TwoLetterISOLanguageName+"'>"+i.DisplayName+"</option>"}e.innerHTML=r}function E(e,t){t.ContentTypeOptions.length?k("#fldContentType",e):M("#fldContentType",e);var r=t.ContentTypeOptions.map(function(e){return'<option value="'+e.Value+'">'+e.Name+"</option>"}).join(""),a=e.querySelector("#selectContentType");a.innerHTML=r,a.value=t.ContentType||""}function I(){var e=this.getAttribute("data-formatstring"),t=this.getAttribute("data-buttonclass");this.value?document.querySelector("."+t).setAttribute("href",e.replace("{0}",this.value)):document.querySelector("."+t).setAttribute("href","#")}function R(e,t,r){for(var a="",n=t.ProviderIds||{},i=0,o=r.length;o>i;i++){var u=r[i],s="txt1"+u.Key,c="btnOpen1"+u.Key,d=u.UrlFormatString||"",y=l.translate("LabelDynamicExternalId").replace("{0}",u.Name);a+='<div class="inputContainer">',a+='<div style="display: flex; align-items: center;">';var p=n[u.Key]||"";a+='<div style="flex-grow:1;">',a+='<input is="emby-input" class="txtExternalId" value="'+p+'" data-providerkey="'+u.Key+'" data-formatstring="'+d+'" data-buttonclass="'+c+'" id="'+s+'" label="'+y+'"/>',a+="</div>",d&&(a+='<a class="clearLink '+c+'" href="#" target="_blank" data-role="none" style="float: none; width: 1.75em"><button type="button" is="paper-icon-button-light" class="autoSize"><i class="md-icon">open_in_browser</i></button></a>'),a+="</div>",a+="</div>"}var v=e.querySelector(".externalIds",e);v.innerHTML=a;var m=v.querySelector(".txtExternalId")||[];Array.prototype.forEach.call(m,function(e){e.addEventListener("change",I.bind(e)),e.dispatchEvent(new Event("change"))})}function M(e,t,r){if(t=t||document,"string"==typeof e){var a=r?t.querySelectorAll(e):[t.querySelector(e)];Array.prototype.forEach.call(a,function(e){e&&e.classList.add("hide")})}else e.classList.add("hide")}function k(e,t,r){if(t=t||document,"string"==typeof e){var a=r?t.querySelectorAll(e):[t.querySelector(e)];Array.prototype.forEach.call(a,function(e){e&&e.classList.remove("hide")})}else e.classList.remove("hide")}function w(e,t){t.Path&&"Remote"!=t.LocationType?k("#fldPath",e):M("#fldPath",e),"Series"==t.Type||"Movie"==t.Type||"Trailer"==t.Type?k("#fldOriginalName",e):M("#fldOriginalName",e),"Series"==t.Type?k("#fldSeriesRuntime",e):M("#fldSeriesRuntime",e),"Series"==t.Type||"Person"==t.Type?k("#fldEndDate",e):M("#fldEndDate",e),"Movie"==t.Type||"Game"==t.MediaType||"Trailer"==t.MediaType||"MusicVideo"==t.Type?(k("#fldBudget",e),k("#fldRevenue",e)):(M("#fldBudget",e),M("#fldRevenue",e)),"MusicAlbum"==t.Type?k("#albumAssociationMessage",e):M("#albumAssociationMessage",e),"Game"==t.MediaType?k("#fldPlayers",e):M("#fldPlayers",e),"Movie"==t.Type||"Trailer"==t.Type?(k("#fldCriticRating",e),k("#fldCriticRatingSummary",e)):(M("#fldCriticRating",e),M("#fldCriticRatingSummary",e)),"Movie"==t.Type?k("#fldAwardSummary",e):M("#fldAwardSummary",e),"Movie"==t.Type||"Trailer"==t.Type?k("#fldMetascore",e):M("#fldMetascore",e),"Series"==t.Type?(k("#fldStatus",e),k("#fldAirDays",e),k("#fldAirTime",e)):(M("#fldStatus",e),M("#fldAirDays",e),M("#fldAirTime",e)),"Video"==t.MediaType&&"TvChannel"!=t.Type?k("#fld3dFormat",e):M("#fld3dFormat",e),"Audio"==t.Type?k("#fldAlbumArtist",e):M("#fldAlbumArtist",e),"Audio"==t.Type||"MusicVideo"==t.Type?(k("#fldArtist",e),k("#fldAlbum",e)):(M("#fldArtist",e),M("#fldAlbum",e)),"Episode"==t.Type?k("#collapsibleDvdEpisodeInfo",e):M("#collapsibleDvdEpisodeInfo",e),"Episode"==t.Type&&0==t.ParentIndexNumber?k("#collapsibleSpecialEpisodeInfo",e):M("#collapsibleSpecialEpisodeInfo",e),"Person"==t.Type||"Genre"==t.Type||"Studio"==t.Type||"GameGenre"==t.Type||"MusicGenre"==t.Type||"TvChannel"==t.Type?(M("#fldCommunityRating",e),M("#fldCommunityVoteCount",e),M("#genresCollapsible",e),M("#peopleCollapsible",e),M("#studiosCollapsible",e),"TvChannel"==t.Type?k("#fldOfficialRating",e):M("#fldOfficialRating",e),M("#fldCustomRating",e)):(k("#fldCommunityRating",e),k("#fldCommunityVoteCount",e),k("#genresCollapsible",e),k("#peopleCollapsible",e),k("#studiosCollapsible",e),k("#fldOfficialRating",e),k("#fldCustomRating",e)),"Movie"==t.Type||"Trailer"==t.Type||"MusicArtist"==t.Type?k("#countriesCollapsible",e):M("#countriesCollapsible",e),"TvChannel"==t.Type?(M("#tagsCollapsible",e),M("#metadataSettingsCollapsible",e),M("#fldPremiereDate",e),M("#fldDateAdded",e),M("#fldYear",e)):(k("#tagsCollapsible",e),k("#metadataSettingsCollapsible",e),k("#fldPremiereDate",e),k("#fldDateAdded",e),k("#fldYear",e)),"Movie"==t.Type||"Trailer"==t.Type||"BoxSet"==t.Type?k("#keywordsCollapsible",e):M("#keywordsCollapsible",e),"Video"==t.MediaType&&"TvChannel"!=t.Type?k("#fldSourceType",e):M("#fldSourceType",e),"Person"==t.Type?(e.querySelector("#txtProductionYear").label(l.translate("LabelBirthYear")),e.querySelector("#txtPremiereDate").label(l.translate("LabelBirthDate")),e.querySelector("#txtEndDate").label(l.translate("LabelDeathDate")),k("#fldPlaceOfBirth")):(e.querySelector("#txtProductionYear").label(l.translate("LabelYear")),e.querySelector("#txtPremiereDate").label(l.translate("LabelReleaseDate")),e.querySelector("#txtEndDate").label(l.translate("LabelEndDate")),M("#fldPlaceOfBirth")),"Video"==t.MediaType&&"TvChannel"!=t.Type?k("#fldOriginalAspectRatio"):M("#fldOriginalAspectRatio"),"Audio"==t.Type||"Episode"==t.Type||"Season"==t.Type?(k("#fldIndexNumber"),e.querySelector("#txtIndexNumber").label("Episode"==t.Type?l.translate("LabelEpisodeNumber"):"Season"==t.Type?l.translate("LabelSeasonNumber"):"Audio"==t.Type?l.translate("LabelTrackNumber"):l.translate("LabelNumber"))):M("#fldIndexNumber"),"Audio"==t.Type||"Episode"==t.Type?(k("#fldParentIndexNumber"),e.querySelector("#txtParentIndexNumber").label("Episode"==t.Type?l.translate("LabelSeasonNumber"):"Audio"==t.Type?l.translate("LabelDiscNumber"):l.translate("LabelParentNumber"))):M("#fldParentIndexNumber",e),"BoxSet"==t.Type?(k("#fldDisplayOrder",e),e.querySelector("#selectDisplayOrder").innerHTML='<option value="SortName">'+l.translate("OptionSortName")+'</option><option value="PremiereDate">'+l.translate("OptionReleaseDate")+"</option>"):(e.querySelector("#selectDisplayOrder").innerHTML="",M("#fldDisplayOrder",e));var r=e.querySelectorAll(".fldDisplaySetting"),a=Array.prototype.filter.call(r,function(e){return"none"!=e.style.display});a.length?k("#collapsibleDisplaySettings",e):M("#collapsibleDisplaySettings",e)}function B(e,t,a){var n=e.querySelector("#selectOfficialRating");H(a,n,t.OfficialRating),n.value=t.OfficialRating||"",n=e.querySelector("#selectCustomRating"),H(a,n,t.CustomRating),n.value=t.CustomRating||"";var i=e.querySelector("#selectStatus");V(i),i.value=t.Status||"",e.querySelector("#select3dFormat",e).value=t.Video3DFormat||"",Array.prototype.forEach.call(e.querySelectorAll(".chkAirDay",e),function(e){e.checked=-1!=(t.AirDays||[]).indexOf(e.getAttribute("data-day"))}),F(e.querySelector("#listCountries"),t.ProductionLocations||[]),F(e.querySelector("#listGenres"),t.Genres),G(e,t.People||[]),F(e.querySelector("#listStudios"),(t.Studios||[]).map(function(e){return e.Name||""})),F(e.querySelector("#listTags"),t.Tags),F(e.querySelector("#listKeywords"),t.Keywords);var l=t.LockData||!1,o=e.querySelector("#chkLockData");o.checked=l,o.checked?M(".providerSettingsContainer",e):k(".providerSettingsContainer",e),K(e,t,t.LockedFields),e.querySelector("#txtPath").value=t.Path||"",e.querySelector("#txtName").value=t.Name||"",e.querySelector("#txtOriginalName").value=t.OriginalTitle||"",e.querySelector("#txtOverview").value=t.Overview||"",e.querySelector("#txtShortOverview").value=t.ShortOverview||"",e.querySelector("#txtTagline").value=t.Taglines&&t.Taglines.length?t.Taglines[0]:"",e.querySelector("#txtSortName").value=t.ForcedSortName||"",e.querySelector("#txtDisplayMediaType").value=t.DisplayMediaType||"",e.querySelector("#txtCommunityRating").value=t.CommunityRating||"",e.querySelector("#txtCommunityVoteCount").value=t.VoteCount||"",e.querySelector("#txtHomePageUrl").value=t.HomePageUrl||"",e.querySelector("#txtAwardSummary").value=t.AwardSummary||"",e.querySelector("#txtMetascore").value=t.Metascore||"",e.querySelector("#txtBudget").value=t.Budget||"",e.querySelector("#txtRevenue").value=t.Revenue||"",e.querySelector("#txtCriticRating").value=t.CriticRating||"",e.querySelector("#txtCriticRatingSummary").value=t.CriticRatingSummary||"",e.querySelector("#txtIndexNumber").value="IndexNumber"in t?t.IndexNumber:"",e.querySelector("#txtParentIndexNumber").value="ParentIndexNumber"in t?t.ParentIndexNumber:"",e.querySelector("#txtPlayers").value=t.Players||"",e.querySelector("#txtAbsoluteEpisodeNumber").value="AbsoluteEpisodeNumber"in t?t.AbsoluteEpisodeNumber:"",e.querySelector("#txtDvdEpisodeNumber").value="DvdEpisodeNumber"in t?t.DvdEpisodeNumber:"",e.querySelector("#txtDvdSeasonNumber").value="DvdSeasonNumber"in t?t.DvdSeasonNumber:"",e.querySelector("#txtAirsBeforeSeason").value="AirsBeforeSeasonNumber"in t?t.AirsBeforeSeasonNumber:"",e.querySelector("#txtAirsAfterSeason").value="AirsAfterSeasonNumber"in t?t.AirsAfterSeasonNumber:"",e.querySelector("#txtAirsBeforeEpisode").value="AirsBeforeEpisodeNumber"in t?t.AirsBeforeEpisodeNumber:"",e.querySelector("#txtAlbum").value=t.Album||"",e.querySelector("#txtAlbumArtist").value=(t.AlbumArtists||[]).map(function(e){return e.Name}).join(";"),e.querySelector("#selectDisplayOrder").value=t.DisplayOrder,e.querySelector("#txtArtist").value=(t.ArtistItems||[]).map(function(e){return e.Name}).join(";");var u;if(t.DateCreated)try{u=r.parseISO8601Date(t.DateCreated,!0),e.querySelector("#txtDateAdded").value=u.toISOString().slice(0,10)}catch(s){e.querySelector("#txtDateAdded").value=""}else e.querySelector("#txtDateAdded").value="";if(t.PremiereDate)try{u=r.parseISO8601Date(t.PremiereDate,!0),e.querySelector("#txtPremiereDate").value=u.toISOString().slice(0,10)}catch(s){e.querySelector("#txtPremiereDate").value=""}else e.querySelector("#txtPremiereDate").value="";if(t.EndDate)try{u=r.parseISO8601Date(t.EndDate,!0),e.querySelector("#txtEndDate").value=u.toISOString().slice(0,10)}catch(s){e.querySelector("#txtEndDate").value=""}else e.querySelector("#txtEndDate").value="";e.querySelector("#txtProductionYear").value=t.ProductionYear||"",e.querySelector("#txtAirTime").value=t.AirTime||"";var c=t.ProductionLocations&&t.ProductionLocations.length?t.ProductionLocations[0]:"";if(e.querySelector("#txtPlaceOfBirth").value=c,e.querySelector("#txtOriginalAspectRatio").value=t.AspectRatio||"",e.querySelector("#selectLanguage").value=t.PreferredMetadataLanguage||"",e.querySelector("#selectCountry").value=t.PreferredMetadataCountryCode||"",t.RunTimeTicks){var d=t.RunTimeTicks/6e8;e.querySelector("#txtSeriesRuntime").value=Math.round(d)}else e.querySelector("#txtSeriesRuntime",e).value=""}function H(e,t,r){var a="";a+="<option value=''></option>";var n,i,l,o=[],u=!1;for(n=0,i=e.length;i>n;n++)l=e[n],o.push({Name:l.Name,Value:l.Name}),l.Name==r&&(u=!0);for(r&&!u&&o.push({Name:r,Value:r}),n=0,i=o.length;i>n;n++)l=o[n],a+="<option value='"+l.Value+"'>"+l.Name+"</option>";t.innerHTML=a}function V(e){var t="";t+="<option value=''></option>",t+="<option value='Continuing'>"+l.translate("OptionContinuing")+"</option>",t+="<option value='Ended'>"+l.translate("OptionEnded")+"</option>",e.innerHTML=t}function F(e,t,r){t=t||[],"undefined"==typeof r?t.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}):t=r(t);for(var a="",n=0;n<t.length;n++)a+='<div class="listItem">',a+='<button type="button" is="emby-button" data-index="'+n+'" class="fab autoSize mini"><i class="md-icon">live_tv</i></button>',a+='<div class="listItemBody">',a+='<div class="textValue">',a+=t[n],a+="</div>",a+="</div>",a+='<button type="button" is="paper-icon-button-light" data-index="'+n+'" class="btnRemoveFromEditorList autoSize"><i class="md-icon">delete</i></button>',a+="</div>";e.innerHTML=a}function G(e,t){for(var r="",a="",n=e.querySelector("#peopleList"),i=0,l=t.length;l>i;i++){var o=t[i];a+='<div class="listItem">',a+='<button type="button" is="emby-button" data-index="'+i+'" class="btnEditPerson fab autoSize mini"><i class="md-icon">person</i></button>',a+='<div class="listItemBody">',a+='<a class="btnEditPerson clearLink" href="#" data-index="'+i+'">',a+='<div class="textValue">',a+=o.Name||"",a+="</div>",o.Role&&o.Role!=r&&(a+='<div class="secondary">'+o.Role+"</div>"),a+="</a>",a+="</div>",a+='<button type="button" is="paper-icon-button-light" data-index="'+i+'" class="btnDeletePerson autoSize"><i class="md-icon">delete</i></button>',a+="</div>"}n.innerHTML=a;var u=n.querySelector(".btnDeletePerson");u&&u.addEventListener("click",function(){var t=parseInt(this.getAttribute("data-index"));_.People.splice(t,1),G(e,_.People)}.bind(u));var s=n.querySelector(".btnEditPerson");s&&s.addEventListener("click",function(){var t=parseInt(this.getAttribute("data-index"));g(e,_.People[t],t)}.bind(s))}function U(e,t){for(var r="",a=0;a<e.length;a++){var n=e[a],i=n.name,l=n.value||n.name,o=-1==t.indexOf(l)?" checked":"";r+="<label>",r+='<input type="checkbox" is="emby-checkbox" class="selectLockedField" data-value="'+l+'"'+o+"/>",r+="<span>"+i+"</span>",r+="</label>"}return r}function K(e,t,r){var a=e.querySelector(".providerSettingsContainer");r=r||new Array;var n=[{name:l.translate("OptionName"),value:"Name"},{name:l.translate("OptionOverview"),value:"Overview"},{name:l.translate("OptionGenres"),value:"Genres"},{name:l.translate("OptionParentalRating"),value:"OfficialRating"},{name:l.translate("OptionPeople"),value:"Cast"}];n.push("Person"==t.Type?{name:l.translate("OptionBirthLocation"),value:"ProductionLocations"}:{name:l.translate("OptionProductionLocations"),value:"ProductionLocations"}),"Series"==t.Type&&n.push({name:l.translate("OptionRuntime"),value:"Runtime"}),n.push({name:l.translate("OptionStudios"),value:"Studios"}),n.push({name:l.translate("OptionTags"),value:"Tags"}),n.push({name:l.translate("OptionKeywords"),value:"Keywords"}),n.push({name:l.translate("OptionImages"),value:"Images"}),n.push({name:l.translate("OptionBackdrops"),value:"Backdrops"}),"Game"==t.Type&&n.push({name:l.translate("OptionScreenshots"),value:"Screenshots"});var i="";i+="<h1>"+l.translate("HeaderEnabledFields")+"</h1>",i+="<p>"+l.translate("HeaderEnabledFieldsHelp")+"</p>",i+=U(n,r),a.innerHTML=i}function Y(e,t,r){a.show(),Promise.all([P(t,r),L(t,r)]).then(function(t){var r=t[0];j=t[1],_=r;var n=j.Cultures,i=j.Countries;E(e,j),R(e,r,j.ExternalIdInfos),O(e.querySelector("#selectLanguage"),n),N(e.querySelector("#selectCountry"),i),w(e,r),B(e,r,j.ParentalRatingOptions),"Video"==r.MediaType&&"Episode"!=r.Type?k("#fldShortOverview",e):M("#fldShortOverview",e),"Video"==r.MediaType&&"Episode"!=r.Type?k("#fldTagline",e):M("#fldTagline",e),a.hide()})}var z,j,_;return{show:function(e,r){return new Promise(function(n){a.show();var o=new XMLHttpRequest;o.open("GET","components/metadataeditor/metadataeditor.template.html",!0),o.onload=function(){var a=this.response,o=t.createDialog({removeOnClose:!0,size:"medium"});o.classList.add("ui-body-b"),o.classList.add("background-theme-b"),o.classList.add("formDialog");var u="";u+=l.translateDocument(a),o.innerHTML=u,document.body.appendChild(o),t.open(o),o.addEventListener("close",function(){h(o,i.getApiClient(r)),n()}),z=o,D(o,i.getApiClient(r)),Y(o,e,r)},o.send()})},embed:function(e,t,r){return new Promise(function(){a.show();var o=new XMLHttpRequest;o.open("GET","components/metadataeditor/metadataeditor.template.html",!0),o.onload=function(){var a=this.response;e.innerHTML=l.translateDocument(a),e.querySelector(".btnCancel").classList.add("hide"),z=e,D(e,i.getApiClient(r)),Y(e,t,r),n.autoFocus(e)},o.send()})}}});