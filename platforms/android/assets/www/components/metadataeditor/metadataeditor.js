define(["itemHelper","dialogHelper","datetime","jQuery","emby-checkbox","emby-input","emby-select","listViewStyle","emby-textarea","emby-button","paper-icon-button-light"],function(e,t,a,i){function n(){return q.classList.contains("dialog")}function o(){n()&&t.close(q)}function r(e,t){function a(){require(["toast"],function(e){e(Globalize.translate("MessageItemSaved"))}),Dashboard.hideLoadingMsg(),o(!0)}ApiClient.updateItem(t).then(function(){var n=i("#selectContentType",e).val()||"";(V.ContentType||"")!=n?ApiClient.ajax({url:ApiClient.getUrl("Items/"+t.Id+"/ContentType",{ContentType:n}),type:"POST"}).then(function(){a()}):a()})}function l(e){return i(".chkAirDay:checked",e).map(function(){return this.getAttribute("data-day")}).get()}function s(e){return i("#txtAlbumArtist",e).val().trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function d(e){return i("#txtArtist",e).val().trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function u(e,t,n){var o=i(t,e).val();if(!o)return null;if(H[n]){var r=a.parseISO8601Date(H[n],!0),l=r.toISOString().split("T");if(0==l[0].indexOf(o)){var s=l[1];o+="T"+s}}return o}function c(){Dashboard.showLoadingMsg();var e=this;try{var t={Id:H.Id,Name:i("#txtName",e).val(),OriginalTitle:i("#txtOriginalName",e).val(),ForcedSortName:i("#txtSortName",e).val(),DisplayMediaType:i("#txtDisplayMediaType",e).val(),CommunityRating:i("#txtCommunityRating",e).val(),VoteCount:i("#txtCommunityVoteCount",e).val(),HomePageUrl:i("#txtHomePageUrl",e).val(),Budget:i("#txtBudget",e).val(),Revenue:i("#txtRevenue",e).val(),CriticRating:i("#txtCriticRating",e).val(),CriticRatingSummary:i("#txtCriticRatingSummary",e).val(),IndexNumber:i("#txtIndexNumber",e).val()||null,AbsoluteEpisodeNumber:i("#txtAbsoluteEpisodeNumber",e).val(),DvdEpisodeNumber:i("#txtDvdEpisodeNumber",e).val(),DvdSeasonNumber:i("#txtDvdSeasonNumber",e).val(),AirsBeforeSeasonNumber:i("#txtAirsBeforeSeason",e).val(),AirsAfterSeasonNumber:i("#txtAirsAfterSeason",e).val(),AirsBeforeEpisodeNumber:i("#txtAirsBeforeEpisode",e).val(),ParentIndexNumber:i("#txtParentIndexNumber",e).val()||null,DisplayOrder:i("#selectDisplayOrder",e).val(),Players:i("#txtPlayers",e).val(),Album:i("#txtAlbum",e).val(),AlbumArtist:s(e),ArtistItems:d(e),Metascore:i("#txtMetascore",e).val(),AwardSummary:i("#txtAwardSummary",e).val(),Overview:i("#txtOverview",e).val(),ShortOverview:i("#txtShortOverview",e).val(),Status:i("#selectStatus",e).val(),AirDays:l(e),AirTime:i("#txtAirTime",e).val(),Genres:m(i("#listGenres",e)),ProductionLocations:m(i("#listCountries",e)),Tags:m(i("#listTags",e)),Keywords:m(i("#listKeywords",e)),Studios:m(i("#listStudios",e)).map(function(e){return{Name:e}}),PremiereDate:u(e,"#txtPremiereDate","PremiereDate"),DateCreated:u(e,"#txtDateAdded","DateCreated"),EndDate:u(e,"#txtEndDate","EndDate"),ProductionYear:i("#txtProductionYear",e).val(),AspectRatio:i("#txtOriginalAspectRatio",e).val(),Video3DFormat:i("#select3dFormat",e).val(),OfficialRating:i("#selectOfficialRating",e).val(),CustomRating:i("#selectCustomRating",e).val(),People:H.People,LockData:e.querySelector("#chkLockData").checked,LockedFields:i(".selectLockedField",e).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-value")})};if(t.ProviderIds=i.extend({},H.ProviderIds||{}),i(".txtExternalId",e).each(function(){var e=this.getAttribute("data-providerkey");t.ProviderIds[e]=this.value}),t.PreferredMetadataLanguage=i("#selectLanguage",e).val(),t.PreferredMetadataCountryCode=i("#selectCountry",e).val(),"Person"==H.Type){var a=i("#txtPlaceOfBirth",e).val();t.ProductionLocations=a?[a]:[]}if("Series"==H.Type){var n=i("#txtSeriesRuntime",e).val();t.RunTimeTicks=n?6e8*n:null}var o=i("#txtTagline",e).val();t.Taglines=o?[o]:[],r(e,t)}catch(c){alert(c)}return!1}function p(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function m(e){return e.find(".textValue").map(function(){return i(this).text()}).get()}function v(e,t){require(["prompt"],function(a){a({label:"Value:"}).then(function(a){var n=i(e).parents(".editableListviewContainer").find(".paperList"),o=m(n);o.push(a),M(n[0],o,t)})})}function f(e){i(e).parents(".listItem").remove()}function b(e,t,a){require(["components/metadataeditor/personeditor"],function(i){i.show(t).then(function(t){var i=-1==a;i&&H.People.push(t),G(e,H.People)})})}function h(e,t){require(["itemContextMenu"],function(a){a.show({item:H,positionTo:t,edit:!1,editImages:!0,editSubtitles:!0,sync:!1,share:!1}).then(function(t){t.deleted?Emby.Page.goHome():t.updated&&B(e,H.Id)})})}function y(e,t){var a=t;"LibraryChanged"===a.MessageType&&-1!=a.Data.ItemsUpdated.indexOf(H.Id)&&B(q,H.Id)}function g(){Events.on(ApiClient,"websocketmessage",y)}function x(){Events.off(ApiClient,"websocketmessage",y)}function T(e){var t=p(e.target,"btnRemoveFromEditorList");if(t)return void f(t);var a=p(e.target,"btnAddTextItem");a&&v(a)}function S(e){i(".btnCancel",e).on("click",function(){o(!1)}),e.querySelector(".btnMore").addEventListener("click",function(t){Dashboard.getCurrentUser().then(function(a){h(e,t.target,a)})}),e.querySelector(".btnHeaderSave").addEventListener("click",function(){e.querySelector(".btnSave").click()}),e.querySelector("#chkLockData").addEventListener("click",function(e){e.target.checked?i(".providerSettingsContainer").hide():i(".providerSettingsContainer").show()}),e.removeEventListener("click",T),e.addEventListener("click",T),i("form",e).off("submit",c).on("submit",c),i("#btnAddPerson",e).on("click",function(){b(e,{},-1)}),n()&&g(e)}function C(e){return e?ApiClient.getItem(Dashboard.getCurrentUserId(),e):ApiClient.getRootFolder(Dashboard.getCurrentUserId())}function A(e){return e?ApiClient.getJSON(ApiClient.getUrl("Items/"+e+"/MetadataEditor")):Promise.resolve({})}function D(e,t){var a="";a+="<option value=''></option>";for(var i=0,n=t.length;n>i;i++){var o=t[i];a+="<option value='"+o.TwoLetterISORegionName+"'>"+o.DisplayName+"</option>"}e.innerHTML=a}function w(e,t){var a="";a+="<option value=''></option>";for(var i=0,n=t.length;n>i;i++){var o=t[i];a+="<option value='"+o.TwoLetterISOLanguageName+"'>"+o.DisplayName+"</option>"}e.innerHTML=a}function P(e,t){t.ContentTypeOptions.length?i("#fldContentType",e).show():i("#fldContentType",e).hide();var a=t.ContentTypeOptions.map(function(e){return'<option value="'+e.Value+'">'+e.Name+"</option>"}).join("");i("#selectContentType",e).html(a).val(t.ContentType||"")}function N(){var e=this.getAttribute("data-formatstring"),t=this.getAttribute("data-buttonclass");this.value?i("."+t).attr("href",e.replace("{0}",this.value)):i("."+t).attr("href","#")}function O(e,t,a){for(var n="",o=t.ProviderIds||{},r=0,l=a.length;l>r;r++){var s=a[r],d="txt1"+s.Key,u="btnOpen1"+s.Key,c=s.UrlFormatString||"",p=Globalize.translate("LabelDynamicExternalId").replace("{0}",s.Name);n+='<div class="inputContainer">',n+='<div style="display: flex; align-items: center;">';var m=o[s.Key]||"";n+='<div style="flex-grow:1;">',n+='<input is="emby-input" class="txtExternalId" value="'+m+'" data-providerkey="'+s.Key+'" data-formatstring="'+c+'" data-buttonclass="'+u+'" id="'+d+'" label="'+p+'"/>',n+="</div>",c&&(n+='<a class="clearLink '+u+'" href="#" target="_blank" data-role="none" style="float: none; width: 1.75em"><button type="button" is="paper-icon-button-light" class="autoSize"><i class="md-icon">open_in_browser</i></button></a>'),n+="</div>",n+="</div>"}var v=i(".externalIds",e).html(n);i(".txtExternalId",v).on("change",N).trigger("change")}function L(e,t){t.Path&&"Remote"!=t.LocationType?i("#fldPath",e).show():i("#fldPath",e).hide(),"Series"==t.Type||"Movie"==t.Type||"Trailer"==t.Type?i("#fldOriginalName",e).show():i("#fldOriginalName",e).hide(),"Series"==t.Type?i("#fldSeriesRuntime",e).show():i("#fldSeriesRuntime",e).hide(),"Series"==t.Type||"Person"==t.Type?i("#fldEndDate",e).show():i("#fldEndDate",e).hide(),"Movie"==t.Type||"Game"==t.MediaType||"Trailer"==t.MediaType||"MusicVideo"==t.Type?(i("#fldBudget",e).show(),i("#fldRevenue",e).show()):(i("#fldBudget",e).hide(),i("#fldRevenue",e).hide()),"MusicAlbum"==t.Type?i("#albumAssociationMessage",e).show():i("#albumAssociationMessage",e).hide(),"Game"==t.MediaType?i("#fldPlayers",e).show():i("#fldPlayers",e).hide(),"Movie"==t.Type||"Trailer"==t.Type?(i("#fldCriticRating",e).show(),i("#fldCriticRatingSummary",e).show()):(i("#fldCriticRating",e).hide(),i("#fldCriticRatingSummary",e).hide()),"Movie"==t.Type?i("#fldAwardSummary",e).show():i("#fldAwardSummary",e).hide(),"Movie"==t.Type||"Trailer"==t.Type?i("#fldMetascore",e).show():i("#fldMetascore",e).hide(),"Series"==t.Type?(i("#fldStatus",e).show(),i("#fldAirDays",e).show(),i("#fldAirTime",e).show()):(i("#fldStatus",e).hide(),i("#fldAirDays",e).hide(),i("#fldAirTime",e).hide()),"Video"==t.MediaType&&"TvChannel"!=t.Type?i("#fld3dFormat",e).show():i("#fld3dFormat",e).hide(),"Audio"==t.Type?i("#fldAlbumArtist",e).show():i("#fldAlbumArtist",e).hide(),"Audio"==t.Type||"MusicVideo"==t.Type?(i("#fldArtist",e).show(),i("#fldAlbum",e).show()):(i("#fldArtist",e).hide(),i("#fldAlbum",e).hide()),"Episode"==t.Type?i("#collapsibleDvdEpisodeInfo",e).show():i("#collapsibleDvdEpisodeInfo",e).hide(),"Episode"==t.Type&&0==t.ParentIndexNumber?i("#collapsibleSpecialEpisodeInfo",e).show():i("#collapsibleSpecialEpisodeInfo",e).hide(),"Person"==t.Type||"Genre"==t.Type||"Studio"==t.Type||"GameGenre"==t.Type||"MusicGenre"==t.Type||"TvChannel"==t.Type?(i("#fldCommunityRating",e).hide(),i("#fldCommunityVoteCount",e).hide(),i("#genresCollapsible",e).hide(),i("#peopleCollapsible",e).hide(),i("#studiosCollapsible",e).hide(),"TvChannel"==t.Type?i("#fldOfficialRating",e).show():i("#fldOfficialRating",e).hide(),i("#fldCustomRating",e).hide()):(i("#fldCommunityRating",e).show(),i("#fldCommunityVoteCount",e).show(),i("#genresCollapsible",e).show(),i("#peopleCollapsible",e).show(),i("#studiosCollapsible",e).show(),i("#fldOfficialRating",e).show(),i("#fldCustomRating",e).show()),"Movie"==t.Type||"Trailer"==t.Type||"MusicArtist"==t.Type?i("#countriesCollapsible",e).show():i("#countriesCollapsible",e).hide(),"TvChannel"==t.Type?(i("#tagsCollapsible",e).hide(),i("#metadataSettingsCollapsible",e).hide(),i("#fldPremiereDate",e).hide(),i("#fldDateAdded",e).hide(),i("#fldYear",e).hide()):(i("#tagsCollapsible",e).show(),i("#metadataSettingsCollapsible",e).show(),i("#fldPremiereDate",e).show(),i("#fldDateAdded",e).show(),i("#fldYear",e).show()),"Movie"==t.Type||"Trailer"==t.Type||"BoxSet"==t.Type?i("#keywordsCollapsible",e).show():i("#keywordsCollapsible",e).hide(),"Video"==t.MediaType&&"TvChannel"!=t.Type?i("#fldSourceType",e).show():i("#fldSourceType",e).hide(),"Person"==t.Type?(e.querySelector("#txtProductionYear").label(Globalize.translate("LabelBirthYear")),e.querySelector("#txtPremiereDate").label(Globalize.translate("LabelBirthDate")),e.querySelector("#txtEndDate").label(Globalize.translate("LabelDeathDate")),i("#fldPlaceOfBirth",e).show()):(e.querySelector("#txtProductionYear").label(Globalize.translate("LabelYear")),e.querySelector("#txtPremiereDate").label(Globalize.translate("LabelReleaseDate")),e.querySelector("#txtEndDate").label(Globalize.translate("LabelEndDate")),i("#fldPlaceOfBirth",e).hide()),"Video"==t.MediaType&&"TvChannel"!=t.Type?i("#fldOriginalAspectRatio",e).show():i("#fldOriginalAspectRatio",e).hide(),"Audio"==t.Type||"Episode"==t.Type||"Season"==t.Type?(i("#fldIndexNumber",e).show(),e.querySelector("#txtIndexNumber").label("Episode"==t.Type?Globalize.translate("LabelEpisodeNumber"):"Season"==t.Type?Globalize.translate("LabelSeasonNumber"):"Audio"==t.Type?Globalize.translate("LabelTrackNumber"):Globalize.translate("LabelNumber"))):i("#fldIndexNumber",e).hide(),"Audio"==t.Type||"Episode"==t.Type?(i("#fldParentIndexNumber",e).show(),e.querySelector("#txtParentIndexNumber").label("Episode"==t.Type?Globalize.translate("LabelSeasonNumber"):"Audio"==t.Type?Globalize.translate("LabelDiscNumber"):Globalize.translate("LabelParentNumber"))):i("#fldParentIndexNumber",e).hide(),"BoxSet"==t.Type?(i("#fldDisplayOrder",e).show(),i("#selectDisplayOrder",e).html('<option value="SortName">'+Globalize.translate("OptionSortName")+'</option><option value="PremiereDate">'+Globalize.translate("OptionReleaseDate")+"</option>")):(i("#selectDisplayOrder",e).html(""),i("#fldDisplayOrder",e).hide());var a=i(".fldDisplaySetting",e);a.filter(function(e){return"none"!=a[e].style.display}).length?i("#collapsibleDisplaySettings",e).show():i("#collapsibleDisplaySettings",e).hide()}function I(e,t,n){var o=i("#selectOfficialRating",e);R(n,o,t.OfficialRating),o.val(t.OfficialRating||""),o=i("#selectCustomRating",e),R(n,o,t.CustomRating),o.val(t.CustomRating||"");var r=i("#selectStatus",e);E(r),r.val(t.Status||""),i("#select3dFormat",e).val(t.Video3DFormat||""),i(".chkAirDay",e).each(function(){this.checked=-1!=(t.AirDays||[]).indexOf(this.getAttribute("data-day"))}),M(i("#listCountries",e)[0],t.ProductionLocations||[]),M(i("#listGenres",e)[0],t.Genres),G(e,t.People||[]),M(i("#listStudios",e)[0],(t.Studios||[]).map(function(e){return e.Name||""})),M(i("#listTags",e)[0],t.Tags),M(i("#listKeywords",e)[0],t.Keywords);var l=t.LockData||!1,s=e.querySelector("#chkLockData");s.checked=l,s.checked?i(".providerSettingsContainer",e).hide():i(".providerSettingsContainer",e).show(),z(e,t,t.LockedFields),i("#txtPath",e).val(t.Path||""),i("#txtName",e).val(t.Name||""),i("#txtOriginalName",e).val(t.OriginalTitle||""),e.querySelector("#txtOverview").value=t.Overview||"",i("#txtShortOverview",e).val(t.ShortOverview||""),i("#txtTagline",e).val(t.Taglines&&t.Taglines.length?t.Taglines[0]:""),i("#txtSortName",e).val(t.ForcedSortName||""),i("#txtDisplayMediaType",e).val(t.DisplayMediaType||""),i("#txtCommunityRating",e).val(t.CommunityRating||""),i("#txtCommunityVoteCount",e).val(t.VoteCount||""),i("#txtHomePageUrl",e).val(t.HomePageUrl||""),i("#txtAwardSummary",e).val(t.AwardSummary||""),i("#txtMetascore",e).val(t.Metascore||""),i("#txtBudget",e).val(t.Budget||""),i("#txtRevenue",e).val(t.Revenue||""),i("#txtCriticRating",e).val(t.CriticRating||""),i("#txtCriticRatingSummary",e).val(t.CriticRatingSummary||""),i("#txtIndexNumber",e).val("IndexNumber"in t?t.IndexNumber:""),i("#txtParentIndexNumber",e).val("ParentIndexNumber"in t?t.ParentIndexNumber:""),i("#txtPlayers",e).val(t.Players||""),i("#txtAbsoluteEpisodeNumber",e).val("AbsoluteEpisodeNumber"in t?t.AbsoluteEpisodeNumber:""),i("#txtDvdEpisodeNumber",e).val("DvdEpisodeNumber"in t?t.DvdEpisodeNumber:""),i("#txtDvdSeasonNumber",e).val("DvdSeasonNumber"in t?t.DvdSeasonNumber:""),i("#txtAirsBeforeSeason",e).val("AirsBeforeSeasonNumber"in t?t.AirsBeforeSeasonNumber:""),i("#txtAirsAfterSeason",e).val("AirsAfterSeasonNumber"in t?t.AirsAfterSeasonNumber:""),i("#txtAirsBeforeEpisode",e).val("AirsBeforeEpisodeNumber"in t?t.AirsBeforeEpisodeNumber:""),i("#txtAlbum",e).val(t.Album||""),i("#txtAlbumArtist",e).val((t.AlbumArtists||[]).map(function(e){return e.Name}).join(";")),i("#selectDisplayOrder",e).val(t.DisplayOrder),i("#txtArtist",e).val((t.ArtistItems||[]).map(function(e){return e.Name}).join(";"));var d;if(t.DateCreated)try{d=a.parseISO8601Date(t.DateCreated,!0),i("#txtDateAdded",e).val(d.toISOString().slice(0,10))}catch(u){i("#txtDateAdded",e).val("")}else i("#txtDateAdded",e).val("");if(t.PremiereDate)try{d=a.parseISO8601Date(t.PremiereDate,!0),i("#txtPremiereDate",e).val(d.toISOString().slice(0,10))}catch(u){i("#txtPremiereDate",e).val("")}else i("#txtPremiereDate",e).val("");if(t.EndDate)try{d=a.parseISO8601Date(t.EndDate,!0),i("#txtEndDate",e).val(d.toISOString().slice(0,10))}catch(u){i("#txtEndDate",e).val("")}else i("#txtEndDate",e).val("");i("#txtProductionYear",e).val(t.ProductionYear||""),i("#txtAirTime",e).val(t.AirTime||"");var c=t.ProductionLocations&&t.ProductionLocations.length?t.ProductionLocations[0]:"";if(i("#txtPlaceOfBirth",e).val(c),i("#txtOriginalAspectRatio",e).val(t.AspectRatio||""),i("#selectLanguage",e).val(t.PreferredMetadataLanguage||""),i("#selectCountry",e).val(t.PreferredMetadataCountryCode||""),t.RunTimeTicks){var p=t.RunTimeTicks/6e8;i("#txtSeriesRuntime",e).val(Math.round(p))}else i("#txtSeriesRuntime",e).val("")}function R(e,t,a){var i="";i+="<option value=''></option>";var n,o,r,l=[],s=!1;for(n=0,o=e.length;o>n;n++)r=e[n],l.push({Name:r.Name,Value:r.Name}),r.Name==a&&(s=!0);for(a&&!s&&l.push({Name:a,Value:a}),n=0,o=l.length;o>n;n++)r=l[n],i+="<option value='"+r.Value+"'>"+r.Name+"</option>";t.html(i)}function E(e){var t="";t+="<option value=''></option>",t+="<option value='Continuing'>"+Globalize.translate("OptionContinuing")+"</option>",t+="<option value='Ended'>"+Globalize.translate("OptionEnded")+"</option>",e.html(t)}function M(e,t,a){t=t||[],"undefined"==typeof a?t.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}):t=a(t);for(var i="",n=0;n<t.length;n++)i+='<div class="listItem">',i+='<button type="button" is="emby-button" data-index="'+n+'" class="fab autoSize mini"><i class="md-icon">live_tv</i></button>',i+='<div class="listItemBody">',i+='<div class="textValue">',i+=t[n],i+="</div>",i+="</div>",i+='<button type="button" is="paper-icon-button-light" data-index="'+n+'" class="btnRemoveFromEditorList autoSize"><i class="md-icon">delete</i></button>',i+="</div>";e.innerHTML=i}function G(e,t){for(var a="",n="",o=e.querySelector("#peopleList"),r=0,l=t.length;l>r;r++){var s=t[r];n+='<div class="listItem">',n+='<button type="button" is="emby-button" data-index="'+r+'" class="btnEditPerson fab autoSize mini"><i class="md-icon">person</i></button>',n+='<div class="listItemBody">',n+='<a class="btnEditPerson clearLink" href="#" data-index="'+r+'">',n+='<div class="textValue">',n+=s.Name||"",n+="</div>",s.Role&&s.Role!=a&&(n+='<div class="secondary">'+s.Role+"</div>"),n+="</a>",n+="</div>",n+='<button type="button" is="paper-icon-button-light" data-index="'+r+'" class="btnDeletePerson autoSize"><i class="md-icon">delete</i></button>',n+="</div>"}o.innerHTML=n,i(".btnDeletePerson",o).on("click",function(){var t=parseInt(this.getAttribute("data-index"));H.People.splice(t,1),G(e,H.People)}),i(".btnEditPerson",o).on("click",function(){var t=parseInt(this.getAttribute("data-index"));b(e,H.People[t],t)})}function k(e,t){for(var a="",i=0;i<e.length;i++){var n=e[i],o=n.name,r=n.value||n.name,l=-1==t.indexOf(r)?" checked":"";a+="<label>",a+='<input type="checkbox" is="emby-checkbox" class="selectLockedField" data-value="'+r+'"'+l+"/>",a+="<span>"+o+"</span>",a+="</label>"}return a}function z(e,t,a){var n=i(".providerSettingsContainer",e);a=a||new Array;var o=[{name:Globalize.translate("OptionName"),value:"Name"},{name:Globalize.translate("OptionOverview"),value:"Overview"},{name:Globalize.translate("OptionGenres"),value:"Genres"},{name:Globalize.translate("OptionParentalRating"),value:"OfficialRating"},{name:Globalize.translate("OptionPeople"),value:"Cast"}];o.push("Person"==t.Type?{name:Globalize.translate("OptionBirthLocation"),value:"ProductionLocations"}:{name:Globalize.translate("OptionProductionLocations"),value:"ProductionLocations"}),"Series"==t.Type&&o.push({name:Globalize.translate("OptionRuntime"),value:"Runtime"}),o.push({name:Globalize.translate("OptionStudios"),value:"Studios"}),o.push({name:Globalize.translate("OptionTags"),value:"Tags"}),o.push({name:Globalize.translate("OptionKeywords"),value:"Keywords"}),o.push({name:Globalize.translate("OptionImages"),value:"Images"}),o.push({name:Globalize.translate("OptionBackdrops"),value:"Backdrops"}),"Game"==t.Type&&o.push({name:Globalize.translate("OptionScreenshots"),value:"Screenshots"});var r="";r+="<h1>"+Globalize.translate("HeaderEnabledFields")+"</h1>",r+="<p>"+Globalize.translate("HeaderEnabledFieldsHelp")+"</p>",r+=k(o,a),n.html(r)}function B(e,t){Dashboard.showLoadingMsg(),Promise.all([C(t),A(t)]).then(function(t){var a=t[0];V=t[1],H=a;var n=V.Cultures,o=V.Countries;P(e,V),O(e,a,V.ExternalIdInfos),w(e.querySelector("#selectLanguage"),n),D(e.querySelector("#selectCountry"),o),LibraryBrowser.renderName(a,i(".itemName",e),!0),L(e,a),I(e,a,V.ParentalRatingOptions),"Photo"==a.MediaType?i("#btnEditImages",e).hide():i("#btnEditImages",e).show(),"Video"==a.MediaType&&"Episode"!=a.Type?i("#fldShortOverview",e).show():i("#fldShortOverview",e).hide(),"Video"==a.MediaType&&"Episode"!=a.Type?i("#fldTagline",e).show():i("#fldTagline",e).hide(),Dashboard.hideLoadingMsg()})}var q,V,H;return{show:function(e){return new Promise(function(a){Dashboard.showLoadingMsg();var i=new XMLHttpRequest;i.open("GET","components/metadataeditor/metadataeditor.template.html",!0),i.onload=function(){var i=this.response,n=t.createDialog({removeOnClose:!0,size:"medium"});n.classList.add("ui-body-b"),n.classList.add("background-theme-b"),n.classList.add("formDialog");var o="";o+=Globalize.translateDocument(i),n.innerHTML=o,document.body.appendChild(n),t.open(n),n.addEventListener("close",function(){x(n),a()}),q=n,S(n),B(n,e)},i.send()})},embed:function(e,t){return new Promise(function(){Dashboard.showLoadingMsg();var a=new XMLHttpRequest;a.open("GET","components/metadataeditor/metadataeditor.template.html",!0),a.onload=function(){var a=this.response;e.innerHTML=Globalize.translateDocument(a),e.querySelector(".btnCancel").classList.add("hide"),q=e,S(e),B(e,t)},a.send()})}}});