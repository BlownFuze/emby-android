define(["paperdialoghelper","paper-checkbox","paper-dialog","paper-input","paper-item-body","paper-icon-item","paper-textarea","paper-fab"],function(e){function t(){"PAPER-DIALOG"==G.tagName&&e.close(G)}function a(e,a){function i(){require(["toast"],function(e){e(Globalize.translate("MessageItemSaved"))}),Dashboard.hideLoadingMsg(),t(!0)}ApiClient.updateItem(a).then(function(){var t=$("#selectContentType",e).val()||"";(z.ContentType||"")!=t?ApiClient.ajax({url:ApiClient.getUrl("Items/"+a.Id+"/ContentType",{ContentType:t}),type:"POST"}).then(function(){i()}):i()})}function i(e){return $(".chkAirDay:checked",e).map(function(){return this.getAttribute("data-day")}).get()}function n(e){return $("#txtAlbumArtist",e).val().trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function r(e){return $("#txtArtist",e).val().trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function o(e,t,a){var i=$(t,e).val();if(!i)return null;if(B[a]){var n=parseISO8601Date(B[a],{toLocal:!0}),r=n.toISOString().split("T");if(0==r[0].indexOf(i)){var o=r[1];i+="T"+o}}return i}function l(){Dashboard.showLoadingMsg();var e=this;try{var t={Id:B.Id,Name:$("#txtName",e).val(),ForcedSortName:$("#txtSortName",e).val(),DisplayMediaType:$("#txtDisplayMediaType",e).val(),CommunityRating:$("#txtCommunityRating",e).val(),VoteCount:$("#txtCommunityVoteCount",e).val(),HomePageUrl:$("#txtHomePageUrl",e).val(),Budget:$("#txtBudget",e).val(),Revenue:$("#txtRevenue",e).val(),CriticRating:$("#txtCriticRating",e).val(),CriticRatingSummary:$("#txtCriticRatingSummary",e).val(),IndexNumber:$("#txtIndexNumber",e).val()||null,DisplaySpecialsWithSeasons:e.querySelector("#chkDisplaySpecialsInline").checked,AbsoluteEpisodeNumber:$("#txtAbsoluteEpisodeNumber",e).val(),DvdEpisodeNumber:$("#txtDvdEpisodeNumber",e).val(),DvdSeasonNumber:$("#txtDvdSeasonNumber",e).val(),AirsBeforeSeasonNumber:$("#txtAirsBeforeSeason",e).val(),AirsAfterSeasonNumber:$("#txtAirsAfterSeason",e).val(),AirsBeforeEpisodeNumber:$("#txtAirsBeforeEpisode",e).val(),ParentIndexNumber:$("#txtParentIndexNumber",e).val()||null,DisplayOrder:$("#selectDisplayOrder",e).val(),Players:$("#txtPlayers",e).val(),Album:$("#txtAlbum",e).val(),AlbumArtist:n(e),ArtistItems:r(e),Metascore:$("#txtMetascore",e).val(),AwardSummary:$("#txtAwardSummary",e).val(),Overview:$("#txtOverview",e).val(),ShortOverview:$("#txtShortOverview",e).val(),Status:$("#selectStatus",e).val(),AirDays:i(e),AirTime:$("#txtAirTime",e).val(),Genres:d($("#listGenres",e)),ProductionLocations:d($("#listCountries",e)),Tags:d($("#listTags",e)),Keywords:d($("#listKeywords",e)),Studios:d($("#listStudios",e)).map(function(e){return{Name:e}}),PremiereDate:o(e,"#txtPremiereDate","PremiereDate"),DateCreated:o(e,"#txtDateAdded","DateCreated"),EndDate:o(e,"#txtEndDate","EndDate"),ProductionYear:$("#txtProductionYear",e).val(),AspectRatio:$("#txtOriginalAspectRatio",e).val(),Video3DFormat:$("#select3dFormat",e).val(),OfficialRating:$("#selectOfficialRating",e).val(),CustomRating:$("#selectCustomRating",e).val(),People:B.People,LockData:e.querySelector("#chkLockData").checked,LockedFields:$(".selectLockedField",e).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-value")})};if(t.ProviderIds=$.extend({},B.ProviderIds||{}),$(".txtExternalId",e).each(function(){var e=this.getAttribute("data-providerkey");t.ProviderIds[e]=this.value}),t.PreferredMetadataLanguage=$("#selectLanguage",e).val(),t.PreferredMetadataCountryCode=$("#selectCountry",e).val(),"Person"==B.Type){var l=$("#txtPlaceOfBirth",e).val();t.ProductionLocations=l?[l]:[]}if("Series"==B.Type){var s=$("#txtSeriesRuntime",e).val();t.RunTimeTicks=s?6e8*s:null}var u=$("#txtTagline",e).val();t.Taglines=u?[u]:[],a(e,t)}catch(c){alert(c)}return!1}function s(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function d(e){return e.find(".textValue").map(function(){return $(this).text()}).get()}function u(e,t){require(["prompt"],function(a){a({label:"Value:"}).then(function(a){var i=$(e).parents(".editableListviewContainer").find(".paperList"),n=d(i);n.push(a),N(i[0],n,t)})})}function c(e){$(e).parents("paper-icon-item").remove()}function p(e,t,a){require(["components/metadataeditor/personeditor"],function(i){i.show(t).then(function(t){var i=-1==a;i&&B.People.push(t),O(e,B.People)})})}function m(e,t){var a=[];a.push({name:Globalize.translate("ButtonLocalRefresh"),id:"local",ironIcon:"refresh"}),a.push({name:Globalize.translate("ButtonAddMissingData"),id:"missing",ironIcon:"refresh"}),a.push({name:Globalize.translate("ButtonFullRefresh"),id:"full",ironIcon:"refresh"}),require(["actionsheet"],function(e){e.show({items:a,positionTo:t,callback:function(e){switch(e&&(Dashboard.showLoadingMsg(),setTimeout(function(){Dashboard.hideLoadingMsg()},5e3)),e){case"local":ApiClient.refreshItem(B.Id,{Recursive:!0,ImageRefreshMode:"None",MetadataRefreshMode:"ValidationOnly",ReplaceAllImages:!1,ReplaceAllMetadata:!1});break;case"missing":ApiClient.refreshItem(B.Id,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!1});break;case"full":ApiClient.refreshItem(B.Id,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!0})}}})})}function h(e,t){var a=[];a.push({name:Globalize.translate("ButtonEditImages"),id:"images",ironIcon:"photo"}),a.push({name:Globalize.translate("ButtonIdentify"),id:"identify",ironIcon:"info"}),a.push({name:Globalize.translate("ButtonRefresh"),id:"refresh",ironIcon:"refresh"}),require(["actionsheet"],function(i){i.show({items:a,positionTo:t,callback:function(a){switch(a){case"identify":LibraryBrowser.identifyItem(B.Id);break;case"refresh":m(e,t);break;case"images":LibraryBrowser.editImages(B.Id)}}})})}function f(e,t){var a=t;"LibraryChanged"===a.MessageType&&-1!=a.Data.ItemsUpdated.indexOf(B.Id)&&k(G,B.Id)}function v(){Events.on(ApiClient,"websocketmessage",f)}function b(){Events.off(ApiClient,"websocketmessage",f)}function y(e){var t=s(e.target,"btnRemoveFromEditorList");t&&c(t);var a=s(e.target,"btnAddTextItem");a&&u(a)}function g(e){$(".btnCancel",e).on("click",function(){t(!1)}),e.querySelector(".btnMore").addEventListener("click",function(t){h(e,t.target)}),e.querySelector(".btnHeaderSave").addEventListener("click",function(){e.querySelector(".btnSave").click()}),e.querySelector("#chkLockData").addEventListener("click",function(e){e.target.checked?$(".providerSettingsContainer").hide():$(".providerSettingsContainer").show()}),e.removeEventListener("click",y),e.addEventListener("click",y),$("form",e).off("submit",l).on("submit",l),$("#btnAddPerson",e).on("click",function(){p(e,{},-1)}),"PAPER-DIALOG"==G.tagName&&v(e)}function x(e){return e?ApiClient.getItem(Dashboard.getCurrentUserId(),e):ApiClient.getRootFolder(Dashboard.getCurrentUserId())}function T(e){return e?ApiClient.getJSON(ApiClient.getUrl("Items/"+e+"/MetadataEditor")):Promise.resolve({})}function S(e,t){var a="";a+="<option value=''></option>";for(var i=0,n=t.length;n>i;i++){var r=t[i];a+="<option value='"+r.TwoLetterISORegionName+"'>"+r.DisplayName+"</option>"}e.innerHTML=a}function A(e,t){var a="";a+="<option value=''></option>";for(var i=0,n=t.length;n>i;i++){var r=t[i];a+="<option value='"+r.TwoLetterISOLanguageName+"'>"+r.DisplayName+"</option>"}e.innerHTML=a}function D(e,t){t.ContentTypeOptions.length?$("#fldContentType",e).show():$("#fldContentType",e).hide();var a=t.ContentTypeOptions.map(function(e){return'<option value="'+e.Value+'">'+e.Name+"</option>"}).join("");$("#selectContentType",e).html(a).val(t.ContentType||"")}function C(){var e=this.getAttribute("data-formatstring"),t=this.getAttribute("data-buttonclass");this.value?$("."+t).attr("href",e.replace("{0}",this.value)):$("."+t).attr("href","#")}function w(e,t,a){for(var i="",n=t.ProviderIds||{},r=0,o=a.length;o>r;r++){var l=a[r],s="txt1"+l.Key,d="btnOpen1"+l.Key,u=l.UrlFormatString||"",c=Globalize.translate("LabelDynamicExternalId").replace("{0}",l.Name);i+="<div>";var p=n[l.Key]||"";i+='<paper-input style="display:inline-block;width:80%;" class="txtExternalId" value="'+p+'" data-providerkey="'+l.Key+'" data-formatstring="'+u+'" data-buttonclass="'+d+'" id="'+s+'" label="'+c+'"></paper-input>',u&&(i+='<a class="clearLink '+d+'" href="#" target="_blank" data-role="none" style="float: none; width: 1.75em"><paper-icon-button icon="open-in-browser"></paper-icon-button></a>'),i+="</div>"}var m=$(".externalIds",e).html(i).trigger("create");$(".txtExternalId",m).on("change",C).trigger("change")}function P(e,t){t.Path&&"Remote"!=t.LocationType?$("#fldPath",e).show():$("#fldPath",e).hide(),"Series"==t.Type?$("#fldSeriesRuntime",e).show():$("#fldSeriesRuntime",e).hide(),"Series"==t.Type||"Person"==t.Type?$("#fldEndDate",e).show():$("#fldEndDate",e).hide(),"Movie"==t.Type||"Game"==t.MediaType||"Trailer"==t.MediaType||"MusicVideo"==t.Type?($("#fldBudget",e).show(),$("#fldRevenue",e).show()):($("#fldBudget",e).hide(),$("#fldRevenue",e).hide()),"MusicAlbum"==t.Type?$("#albumAssociationMessage",e).show():$("#albumAssociationMessage",e).hide(),"Game"==t.MediaType?$("#fldPlayers",e).show():$("#fldPlayers",e).hide(),"Movie"==t.Type||"Trailer"==t.Type?($("#fldCriticRating",e).show(),$("#fldCriticRatingSummary",e).show()):($("#fldCriticRating",e).hide(),$("#fldCriticRatingSummary",e).hide()),"Movie"==t.Type?$("#fldAwardSummary",e).show():$("#fldAwardSummary",e).hide(),"Movie"==t.Type||"Trailer"==t.Type?$("#fldMetascore",e).show():$("#fldMetascore",e).hide(),"Series"==t.Type?($("#fldStatus",e).show(),$("#fldAirDays",e).show(),$("#fldAirTime",e).show()):($("#fldStatus",e).hide(),$("#fldAirDays",e).hide(),$("#fldAirTime",e).hide()),"Video"==t.MediaType&&"TvChannel"!=t.Type?$("#fld3dFormat",e).show():$("#fld3dFormat",e).hide(),"Audio"==t.Type?$("#fldAlbumArtist",e).show():$("#fldAlbumArtist",e).hide(),"Audio"==t.Type||"MusicVideo"==t.Type?($("#fldArtist",e).show(),$("#fldAlbum",e).show()):($("#fldArtist",e).hide(),$("#fldAlbum",e).hide()),"Episode"==t.Type?$("#collapsibleDvdEpisodeInfo",e).show():$("#collapsibleDvdEpisodeInfo",e).hide(),"Episode"==t.Type&&0==t.ParentIndexNumber?$("#collapsibleSpecialEpisodeInfo",e).show():$("#collapsibleSpecialEpisodeInfo",e).hide(),"Person"==t.Type||"Genre"==t.Type||"Studio"==t.Type||"GameGenre"==t.Type||"MusicGenre"==t.Type||"TvChannel"==t.Type?($("#fldCommunityRating",e).hide(),$("#fldCommunityVoteCount",e).hide(),$("#genresCollapsible",e).hide(),$("#peopleCollapsible",e).hide(),$("#studiosCollapsible",e).hide(),"TvChannel"==t.Type?$("#fldOfficialRating",e).show():$("#fldOfficialRating",e).hide(),$("#fldCustomRating",e).hide()):($("#fldCommunityRating",e).show(),$("#fldCommunityVoteCount",e).show(),$("#genresCollapsible",e).show(),$("#peopleCollapsible",e).show(),$("#studiosCollapsible",e).show(),$("#fldOfficialRating",e).show(),$("#fldCustomRating",e).show()),"Movie"==t.Type||"Trailer"==t.Type||"MusicArtist"==t.Type?$("#countriesCollapsible",e).show():$("#countriesCollapsible",e).hide(),"TvChannel"==t.Type?($("#tagsCollapsible",e).hide(),$("#metadataSettingsCollapsible",e).hide(),$("#fldPremiereDate",e).hide(),$("#fldSortName",e).hide(),$("#fldDateAdded",e).hide(),$("#fldYear",e).hide()):($("#tagsCollapsible",e).show(),$("#metadataSettingsCollapsible",e).show(),$("#fldPremiereDate",e).show(),$("#fldSortName",e).show(),$("#fldDateAdded",e).show(),$("#fldYear",e).show()),Dashboard.getCurrentUser().then(function(a){-1!=LibraryBrowser.getMoreCommands(t,a).indexOf("identify")?$("#btnIdentify",e).show():$("#btnIdentify",e).hide()}),"Movie"==t.Type||"Trailer"==t.Type||"BoxSet"==t.Type?$("#keywordsCollapsible",e).show():$("#keywordsCollapsible",e).hide(),"Video"==t.MediaType&&"TvChannel"!=t.Type?$("#fldSourceType",e).show():$("#fldSourceType",e).hide(),"Person"==t.Type?(e.querySelector("#txtProductionYear").label=Globalize.translate("LabelBirthYear"),e.querySelector("#txtPremiereDate").label=Globalize.translate("LabelBirthDate"),e.querySelector("#txtEndDate").label=Globalize.translate("LabelDeathDate"),$("#fldPlaceOfBirth",e).show()):(e.querySelector("#txtProductionYear").label=Globalize.translate("LabelYear"),e.querySelector("#txtPremiereDate").label=Globalize.translate("LabelReleaseDate"),e.querySelector("#txtEndDate").label=Globalize.translate("LabelEndDate"),$("#fldPlaceOfBirth",e).hide()),"Video"==t.MediaType&&"TvChannel"!=t.Type?$("#fldOriginalAspectRatio",e).show():$("#fldOriginalAspectRatio",e).hide(),"Audio"==t.Type||"Episode"==t.Type||"Season"==t.Type?($("#fldIndexNumber",e).show(),e.querySelector("#txtIndexNumber").label=Globalize.translate("Episode"==t.Type?"LabelEpisodeNumber":"Season"==t.Type?"LabelSeasonNumber":"Audio"==t.Type?"LabelTrackNumber":"LabelNumber")):$("#fldIndexNumber",e).hide(),"Audio"==t.Type||"Episode"==t.Type?($("#fldParentIndexNumber",e).show(),e.querySelector("#txtParentIndexNumber").label=Globalize.translate("Episode"==t.Type?"LabelSeasonNumber":"Audio"==t.Type?"LabelDiscNumber":"LabelParentNumber")):$("#fldParentIndexNumber",e).hide(),"Series"==t.Type?$("#fldDisplaySpecialsInline",e).show():$("#fldDisplaySpecialsInline",e).hide(),"BoxSet"==t.Type?($("#fldDisplayOrder",e).show(),$("#labelDisplayOrder",e).html(Globalize.translate("LabelTitleDisplayOrder")),$("#selectDisplayOrder",e).html('<option value="SortName">'+Globalize.translate("OptionSortName")+'</option><option value="PremiereDate">'+Globalize.translate("OptionReleaseDate")+"</option>")):($("#selectDisplayOrder",e).html(""),$("#fldDisplayOrder",e).hide());var a=$(".fldDisplaySetting",e);a.filter(function(e){return"none"!=a[e].style.display}).length?$("#collapsibleDisplaySettings",e).show():$("#collapsibleDisplaySettings",e).hide()}function I(e,t,a){var i=$("#selectOfficialRating",e);R(a,i,t.OfficialRating),i.val(t.OfficialRating||""),i=$("#selectCustomRating",e),R(a,i,t.CustomRating),i.val(t.CustomRating||"");var n=$("#selectStatus",e);L(n),n.val(t.Status||""),$("#select3dFormat",e).val(t.Video3DFormat||""),$(".chkAirDay",e).each(function(){this.checked=-1!=(t.AirDays||[]).indexOf(this.getAttribute("data-day"))}),N($("#listCountries",e)[0],t.ProductionLocations||[]),N($("#listGenres",e)[0],t.Genres),O(e,t.People||[]),N($("#listStudios",e)[0],(t.Studios||[]).map(function(e){return e.Name||""})),N($("#listTags",e)[0],t.Tags),N($("#listKeywords",e)[0],t.Keywords);var r=t.LockData||!1,o=e.querySelector("#chkLockData");o.checked=r,o.checked?$(".providerSettingsContainer",e).hide():$(".providerSettingsContainer",e).show(),M(e,t,t.LockedFields),e.querySelector("#chkDisplaySpecialsInline").checked=t.DisplaySpecialsWithSeasons||!1,$("#txtPath",e).val(t.Path||""),$("#txtName",e).val(t.Name||""),e.querySelector("#txtOverview").value=t.Overview||"",$("#txtShortOverview",e).val(t.ShortOverview||""),$("#txtTagline",e).val(t.Taglines&&t.Taglines.length?t.Taglines[0]:""),$("#txtSortName",e).val(t.ForcedSortName||""),$("#txtDisplayMediaType",e).val(t.DisplayMediaType||""),$("#txtCommunityRating",e).val(t.CommunityRating||""),$("#txtCommunityVoteCount",e).val(t.VoteCount||""),$("#txtHomePageUrl",e).val(t.HomePageUrl||""),$("#txtAwardSummary",e).val(t.AwardSummary||""),$("#txtMetascore",e).val(t.Metascore||""),$("#txtBudget",e).val(t.Budget||""),$("#txtRevenue",e).val(t.Revenue||""),$("#txtCriticRating",e).val(t.CriticRating||""),$("#txtCriticRatingSummary",e).val(t.CriticRatingSummary||""),$("#txtIndexNumber",e).val("IndexNumber"in t?t.IndexNumber:""),$("#txtParentIndexNumber",e).val("ParentIndexNumber"in t?t.ParentIndexNumber:""),$("#txtPlayers",e).val(t.Players||""),$("#txtAbsoluteEpisodeNumber",e).val("AbsoluteEpisodeNumber"in t?t.AbsoluteEpisodeNumber:""),$("#txtDvdEpisodeNumber",e).val("DvdEpisodeNumber"in t?t.DvdEpisodeNumber:""),$("#txtDvdSeasonNumber",e).val("DvdSeasonNumber"in t?t.DvdSeasonNumber:""),$("#txtAirsBeforeSeason",e).val("AirsBeforeSeasonNumber"in t?t.AirsBeforeSeasonNumber:""),$("#txtAirsAfterSeason",e).val("AirsAfterSeasonNumber"in t?t.AirsAfterSeasonNumber:""),$("#txtAirsBeforeEpisode",e).val("AirsBeforeEpisodeNumber"in t?t.AirsBeforeEpisodeNumber:""),$("#txtAlbum",e).val(t.Album||""),$("#txtAlbumArtist",e).val((t.AlbumArtists||[]).map(function(e){return e.Name}).join(";")),$("#selectDisplayOrder",e).val(t.DisplayOrder),$("#txtArtist",e).val((t.ArtistItems||[]).map(function(e){return e.Name}).join(";"));var l;if(t.DateCreated)try{l=parseISO8601Date(t.DateCreated,{toLocal:!0}),$("#txtDateAdded",e).val(l.toISOString().slice(0,10))}catch(s){$("#txtDateAdded",e).val("")}else $("#txtDateAdded",e).val("");if(t.PremiereDate)try{l=parseISO8601Date(t.PremiereDate,{toLocal:!0}),$("#txtPremiereDate",e).val(l.toISOString().slice(0,10))}catch(s){$("#txtPremiereDate",e).val("")}else $("#txtPremiereDate",e).val("");if(t.EndDate)try{l=parseISO8601Date(t.EndDate,{toLocal:!0}),$("#txtEndDate",e).val(l.toISOString().slice(0,10))}catch(s){$("#txtEndDate",e).val("")}else $("#txtEndDate",e).val("");$("#txtProductionYear",e).val(t.ProductionYear||""),$("#txtAirTime",e).val(t.AirTime||"");var d=t.ProductionLocations&&t.ProductionLocations.length?t.ProductionLocations[0]:"";if($("#txtPlaceOfBirth",e).val(d),$("#txtOriginalAspectRatio",e).val(t.AspectRatio||""),$("#selectLanguage",e).val(t.PreferredMetadataLanguage||""),$("#selectCountry",e).val(t.PreferredMetadataCountryCode||""),t.RunTimeTicks){var u=t.RunTimeTicks/6e8;$("#txtSeriesRuntime",e).val(Math.round(u))}else $("#txtSeriesRuntime",e).val("")}function R(e,t,a){var i="";i+="<option value=''></option>";var n,r,o,l=[],s=!1;for(n=0,r=e.length;r>n;n++)o=e[n],l.push({Name:o.Name,Value:o.Name}),o.Name==a&&(s=!0);for(a&&!s&&l.push({Name:a,Value:a}),n=0,r=l.length;r>n;n++)o=l[n],i+="<option value='"+o.Value+"'>"+o.Name+"</option>";t.html(i)}function L(e){var t="";t+="<option value=''></option>",t+="<option value='Continuing'>"+Globalize.translate("OptionContinuing")+"</option>",t+="<option value='Ended'>"+Globalize.translate("OptionEnded")+"</option>",e.html(t)}function N(e,t,a){t=t||[],"undefined"==typeof a?t.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}):t=a(t);for(var i="",n=0;n<t.length;n++)i+="<paper-icon-item>",i+='<paper-fab mini style="background-color:#444;" icon="live-tv" item-icon></paper-fab>',i+="<paper-item-body>",i+='<div class="textValue">',i+=t[n],i+="</div>",i+="</paper-item-body>",i+='<paper-icon-button icon="delete" data-index="'+n+'" class="btnRemoveFromEditorList"></paper-icon-button>',i+="</paper-icon-item>";e.innerHTML=i}function O(e,t){for(var a="",i="",n=e.querySelector("#peopleList"),r=0,o=t.length;o>r;r++){var l=t[r];i+="<paper-icon-item>",i+='<paper-fab class="btnEditPerson" data-index="'+r+'" mini style="background-color:#444;" icon="person" item-icon></paper-fab>',i+="<paper-item-body>",i+='<a class="btnEditPerson clearLink" href="#" data-index="'+r+'">',i+='<div class="textValue">',i+=l.Name||"",i+="</div>",l.Role&&l.Role!=a&&(i+="<div secondary>"+l.Role+"</div>"),i+="</a>",i+="</paper-item-body>",i+='<paper-icon-button icon="delete" data-index="'+r+'" class="btnDeletePerson"></paper-icon-button>',i+="</paper-icon-item>"}n.innerHTML=i,$(".btnDeletePerson",n).on("click",function(){var t=parseInt(this.getAttribute("data-index"));B.People.splice(t,1),O(e,B.People)}),$(".btnEditPerson",n).on("click",function(){var t=parseInt(this.getAttribute("data-index"));p(e,B.People[t],t)})}function E(e,t){for(var a="",i=0;i<e.length;i++){var n=e[i],r=n.name,o=n.value||n.name,l=-1==t.indexOf(o)?" checked":"";a+='<paper-checkbox class="selectLockedField" data-value="'+o+'" style="display:block;margin:1em 0;"'+l+">"+r+"</paper-checkbox>"}return a}function M(e,t,a){var i=$(".providerSettingsContainer",e);a=a||new Array;var n=[{name:Globalize.translate("OptionName"),value:"Name"},{name:Globalize.translate("OptionOverview"),value:"Overview"},{name:Globalize.translate("OptionGenres"),value:"Genres"},{name:Globalize.translate("OptionParentalRating"),value:"OfficialRating"},{name:Globalize.translate("OptionPeople"),value:"Cast"}];n.push("Person"==t.Type?{name:Globalize.translate("OptionBirthLocation"),value:"ProductionLocations"}:{name:Globalize.translate("OptionProductionLocations"),value:"ProductionLocations"}),"Series"==t.Type&&n.push({name:Globalize.translate("OptionRuntime"),value:"Runtime"}),n.push({name:Globalize.translate("OptionStudios"),value:"Studios"}),n.push({name:Globalize.translate("OptionTags"),value:"Tags"}),n.push({name:Globalize.translate("OptionKeywords"),value:"Keywords"}),n.push({name:Globalize.translate("OptionImages"),value:"Images"}),n.push({name:Globalize.translate("OptionBackdrops"),value:"Backdrops"}),"Game"==t.Type&&n.push({name:Globalize.translate("OptionScreenshots"),value:"Screenshots"});var r="";r+="<h1>"+Globalize.translate("HeaderEnabledFields")+"</h1>",r+="<p>"+Globalize.translate("HeaderEnabledFieldsHelp")+"</p>",r+=E(n,a),i.html(r)}function k(e,t){Dashboard.showLoadingMsg(),Promise.all([x(t),T(t)]).then(function(t){var a=t[0];z=t[1],B=a;var i=z.Cultures,n=z.Countries;D(e,z),w(e,a,z.ExternalIdInfos),A(e.querySelector("#selectLanguage"),i),S(e.querySelector("#selectCountry"),n),LibraryBrowser.renderName(a,$(".itemName",e),!0),P(e,a),I(e,a,z.ParentalRatingOptions),"Photo"==a.MediaType?$("#btnEditImages",e).hide():$("#btnEditImages",e).show(),"Video"==a.MediaType&&"Episode"!=a.Type?$("#fldShortOverview",e).show():$("#fldShortOverview",e).hide(),"Video"==a.MediaType&&"Episode"!=a.Type?$("#fldTagline",e).show():$("#fldTagline",e).hide(),Dashboard.hideLoadingMsg()})}var G,z,B;return{show:function(t){return new Promise(function(a){Dashboard.showLoadingMsg();var i=new XMLHttpRequest;i.open("GET","components/metadataeditor/metadataeditor.template.html",!0),i.onload=function(){var i=this.response,n=e.createDialog({removeOnClose:!0,size:"medium"});n.classList.add("ui-body-b"),n.classList.add("background-theme-b"),n.classList.add("formDialog");var r="";r+=Globalize.translateDocument(i),n.innerHTML=r,document.body.appendChild(n),e.open(n),n.addEventListener("iron-overlay-closed",function(){b(n),a()}),G=n,g(n),k(n,t)},i.send()})},embed:function(e,t){return new Promise(function(){Dashboard.showLoadingMsg();var a=new XMLHttpRequest;a.open("GET","components/metadataeditor/metadataeditor.template.html",!0),a.onload=function(){var a=this.response;e.innerHTML=Globalize.translateDocument(a),e.querySelector(".btnCancel").classList.add("hide"),G=e,g(e),k(e,t)},a.send()})}}});