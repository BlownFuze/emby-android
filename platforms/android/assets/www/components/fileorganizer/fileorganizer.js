define(["paperdialoghelper","paper-checkbox","paper-input","paper-button"],function(e){function t(e){Dashboard.hideLoadingMsg(),Dashboard.alert({title:Globalize.translate("AutoOrganizeError"),message:Globalize.translate("ErrorOrganizingFileWithErrorCode",e.getResponseHeader("X-Application-Error-Code"))})}function r(e,r){!r.ExtractedName||r.ExtractedName.length<4?e.querySelector(".fldRemember").classList.add("hide"):e.querySelector(".fldRemember").classList.remove("hide"),e.querySelector(".inputFile").innerHTML=r.OriginalFileName,e.querySelector("#txtSeason").value=r.ExtractedSeasonNumber,e.querySelector("#txtEpisode").value=r.ExtractedEpisodeNumber,e.querySelector("#txtEndingEpisode").value=r.ExtractedEndingEpisodeNumber,i=r.ExtractedName,a=r.ExtractedYear,e.querySelector("#chkRememberCorrection").checked=!1,e.querySelector("#hfResultId").value=r.Id,ApiClient.getItems(null,{recursive:!0,includeItemTypes:"Series",sortBy:"SortName"}).then(function(t){s=t.Items.map(function(e){return'<option value="'+e.Id+'">'+e.Name+"</option>"}).join(""),s='<option value=""></option>'+s,e.querySelector("#selectSeries").innerHTML=s},t)}function n(r){Dashboard.showLoadingMsg();var n=r.querySelector("#hfResultId").value,o={SeriesId:r.querySelector("#selectSeries").value,SeasonNumber:r.querySelector("#txtSeason").value,EpisodeNumber:r.querySelector("#txtEpisode").value,EndingEpisodeNumber:r.querySelector("#txtEndingEpisode").value,RememberCorrection:r.querySelector("#chkRememberCorrection").checked};ApiClient.performEpisodeOrganization(n,o).then(function(){Dashboard.hideLoadingMsg(),r.submitted=!0,e.close(r)},t)}function o(e){require(["components/itemidentifier/itemidentifier"],function(t){t.showFindNew(i,a,"Series").then(function(t){if(null!=t){l=t;var r=s;r=r+'<option selected value="##NEW##">'+l.Name+"</option>",e.querySelector("#selectSeries").innerHTML=r}})})}var i,a,l,s;return{show:function(t){return new Promise(function(u,c){i=null,a=null,l=null,s=null;var d=new XMLHttpRequest;d.open("GET","components/fileorganizer/fileorganizer.template.html",!0),d.onload=function(){var i=this.response,a=e.createDialog({removeOnClose:!0,size:"small"});a.classList.add("ui-body-a"),a.classList.add("background-theme-a"),a.classList.add("formDialog");var l="";l+=Globalize.translateDocument(i),a.innerHTML=l,document.body.appendChild(a),a.querySelector(".dialogHeaderTitle").innerHTML=Globalize.translate("FileOrganizeManually"),e.open(a),a.addEventListener("iron-overlay-closed",function(){a.submitted?u():c()}),a.querySelector(".btnCancel").addEventListener("click",function(){e.close(a)}),a.querySelector("form").addEventListener("submit",function(e){return n(a),e.preventDefault(),!1}),a.querySelector("#btnNewSeries").addEventListener("click",function(){o(a)}),r(a,t)},d.send()})}}});