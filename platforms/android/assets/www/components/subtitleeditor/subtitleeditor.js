!function(e,t,i){function n(t,i){Dashboard.showLoadingMsg();var n=e(".popupSubtitleViewer",t).popup("open");e(".subtitleContent",t).html("");var a="Videos/"+g.Id+"/Subtitles/"+i;ApiClient.ajax({type:"GET",url:a}).then(function(i){e(".subtitleContent",t).html(i),Dashboard.hideLoadingMsg(),n.popup("reposition",{})})}function a(t,i){Dashboard.showLoadingMsg();var n=e(".popupSubtitleViewer",t).popup("open");e(".subtitleContent",t).html("");var a="Providers/Subtitles/Subtitles/"+i;ApiClient.get(ApiClient.getUrl(a)).then(function(i){e(".subtitleContent",t).html(i),Dashboard.hideLoadingMsg(),n.popup("reposition",{})})}function o(e,t){var i="Items/"+g.Id+"/RemoteSearch/Subtitles/"+t;ApiClient.ajax({type:"POST",url:ApiClient.getUrl(i)}).then(function(){Dashboard.alert(Globalize.translate("MessageDownloadQueued"))})}function r(e,t){var i=Globalize.translate("MessageAreYouSureDeleteSubtitles");Dashboard.confirm(i,Globalize.translate("HeaderConfirmDeletion"),function(i){if(i){Dashboard.showLoadingMsg();var n=g.Id,a="Videos/"+n+"/Subtitles/"+t;ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl(a)}).then(function(){p(e,n)})}})}function l(t,i){var a=i.MediaStreams||[],o=a.filter(function(e){return"Subtitle"==e.Type}),l="";o.length&&(l+='<h1 style="margin-top:1.5em;">'+Globalize.translate("HeaderCurrentSubtitles")+"</h1>",l+='<div class="paperList">',l+=o.map(function(e){var t="";t+="<paper-icon-item>",t+='<paper-fab mini class="blue" icon="closed-caption" item-icon></paper-fab>';var i=[];return i.push(e.Codec),e.IsDefault&&i.push("Default"),e.IsForced&&i.push("Forced"),t+=3==i.length?"<paper-item-body three-line>":"<paper-item-body two-line>",t+="<div>",t+=e.Language||Globalize.translate("LabelUnknownLanaguage"),t+="</div>",t+="<div secondary>"+i.join(" - ")+"</div>",e.Path&&(t+="<div secondary>"+e.Path+"</div>"),l+="</a>",t+="</paper-item-body>",e.Path&&(t+='<paper-icon-button icon="delete" data-index="'+e.Index+'" title="'+Globalize.translate("Delete")+'" class="btnDelete"></paper-icon-button>'),t+="</paper-icon-item>"}).join(""),l+="</div>");var s=e(".subtitleList",t).html(l).trigger("create");e(".btnViewSubtitles",s).on("click",function(){var e=this.getAttribute("data-index");n(t,e)}),e(".btnDelete",s).on("click",function(){var e=this.getAttribute("data-index");r(t,e)})}function s(t,i){e("#selectLanguage",t).html(i.map(function(e){return'<option value="'+e.ThreeLetterISOLanguageName+'">'+e.DisplayName+"</option>"}));var n=appStorage.getItem("subtitleeditor-language");n?e("#selectLanguage",t).val(n):Dashboard.getCurrentUser().then(function(i){var n=i.Configuration.SubtitleLanguagePreference;n&&e("#selectLanguage",t).val(n)})}function d(t,i){var n="",r="";if(!i.length)return e(".noSearchResults",t).show(),e(".subtitleResults",t).html(""),void Dashboard.hideLoadingMsg();e(".noSearchResults",t).hide();for(var l=0,s=i.length;s>l;l++){var d=i[l],u=d.ProviderName;u!=n&&(l>0&&(r+="</div>"),r+="<h1>"+u+"</h1>",r+='<div class="paperList">',n=u),r+="<paper-icon-item>",r+='<paper-fab mini class="blue" icon="closed-caption" item-icon></paper-fab>',r+=d.Comment?"<paper-item-body three-line>":"<paper-item-body two-line>",r+="<div>"+d.Name+"</div>",r+="<div secondary>"+d.Format+"</div>",d.Comment&&(r+="<div secondary>"+d.Comment+"</div>"),r+="</paper-item-body>",r+='<div style="font-size:86%;opacity:.7;">'+(d.DownloadCount||0)+"</div>",r+='<paper-icon-button icon="cloud-download" data-subid="'+d.Id+'" title="'+Globalize.translate("ButtonDownload")+'" class="btnDownload"></paper-icon-button>',r+="</paper-icon-item>"}i.length&&(r+="</div>");var p=e(".subtitleResults",t).html(r).trigger("create");e(".btnViewSubtitle",p).on("click",function(){var e=this.getAttribute("data-subid");a(t,e)}),e(".btnDownload",p).on("click",function(){var e=this.getAttribute("data-subid");o(t,e)}),Dashboard.hideLoadingMsg()}function u(e,t){appStorage.setItem("subtitleeditor-language",t),Dashboard.showLoadingMsg();var i=ApiClient.getUrl("Items/"+g.Id+"/RemoteSearch/Subtitles/"+t);ApiClient.getJSON(i).then(function(t){d(e,t)})}function p(t,i){function n(e){g=e,l(t,e),Dashboard.hideLoadingMsg()}e(".noSearchResults",t).hide(),"string"==typeof i?ApiClient.getItem(Dashboard.getCurrentUserId(),i).then(n):n(i)}function c(){var t=this,i=e("#selectLanguage",t).val();return u(e(t).parents(".editorContent"),i),!1}function b(t){Dashboard.showLoadingMsg();var n=new XMLHttpRequest;n.open("GET","components/subtitleeditor/subtitleeditor.template.html",!0),n.onload=function(){var n=this.response;ApiClient.getItem(Dashboard.getCurrentUserId(),t).then(function(t){var a=PaperDialogHelper.createDialog(),o="";o+='<h2 class="dialogHeader">',o+='<paper-fab icon="arrow-back" mini class="btnCloseDialog"></paper-fab>',o+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+t.Name+"</div>",o+="</h2>",o+='<div class="editorContent">',o+=Globalize.translateDocument(n),o+="</div>",a.innerHTML=o,i.body.appendChild(a),e(".subtitleSearchForm",a).off("submit",c).on("submit",c),e(a).on("iron-overlay-closed",h),PaperDialogHelper.openWithHash(a,"subtitleeditor");var r=a.querySelector(".editorContent");p(r,t),ApiClient.getCultures().then(function(e){s(r,e)}),e(".btnCloseDialog",a).on("click",function(){PaperDialogHelper.close(a)})})},n.send()}function h(){e(this).remove(),Dashboard.hideLoadingMsg()}var g;t.SubtitleEditor={show:function(e){require(["components/paperdialoghelper"],function(){b(e)})}}}(jQuery,window,document);