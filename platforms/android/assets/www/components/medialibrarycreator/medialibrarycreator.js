define(["paperdialoghelper","paper-dialog","paper-input","paper-fab","paper-item-body","paper-icon-item"],function(e){function t(){if(0==m.length)return require(["alert"],function(e){e({text:Globalize.translate("PleaseAddAtLeastOneFolder"),type:"error"})}),!1;var t=this,n=$(t).parents("paper-dialog")[0],r=$("#txtValue",t).val(),i=$("#selectCollectionType",t).val();return"mixed"==i&&(i=null),ApiClient.addVirtualFolder(r,i,f.refresh,m).then(function(){d=!0,e.close(n)},function(){require(["toast"],function(e){e(Globalize.translate("ErrorAddingMediaPathToVirtualFolder"))})}),!1}function n(e){return e.filter(function(e){return e.isSelectable!==!1}).map(function(e){return'<option value="'+e.value+'">'+e.name+"</option>"}).join("")}function r(e,r){$("#selectCollectionType",e).html(n(r)).val("").on("change",function(){if("mixed"!=this.value){var e=$(this).parents("paper-dialog")[0],t=this.selectedIndex;if(-1!=t){var n=this.options[t].innerHTML.replace("*","").replace("&amp;","&"),i=this.value;$("#txtValue",e).val(n);var o=r.filter(function(e){return e.value==i})[0];$(".collectionTypeFieldDescription",e).html(o.message||"")}}}),$(".btnAddFolder",e).on("click",i),$("form",e).off("submit",t).on("submit",t)}function i(){var e=$(this).parents(".popupEditor")[0];require(["directorybrowser"],function(t){var n=new t;n.show({callback:function(t){t&&l(e,t),n.close()}})})}function o(e,t){var n="";return n+='<paper-icon-item role="menuitem" class="lnkPath">',n+='<paper-fab mini style="background:#52B54B;" icon="folder" item-icon></paper-fab>',n+="<paper-item-body>",n+=e,n+="</paper-item-body>",n+='<paper-icon-button icon="remove-circle" class="btnRemovePath" data-index="'+t+'"></paper-icon-button>',n+="</paper-icon-item>"}function a(e){var t=m.map(o).join(""),n=e.querySelector(".folderList");n.innerHTML=t,t?n.classList.remove("hide"):n.classList.add("hide"),$(e.querySelectorAll(".btnRemovePath")).on("click",c)}function l(e,t){0==m.filter(function(e){return e.toLowerCase()==t.toLowerCase()}).length&&(m.push(t),a(e))}function c(){var e=this,t=parseInt(e.getAttribute("data-index")),n=m[t];m=m.filter(function(e){return e.toLowerCase()!=n.toLowerCase()});var r=$(this).parents(".popupEditor")[0];a(r)}function s(){Dashboard.hideLoadingMsg(),u.resolveWith(null,[d])}function p(){var t=this;t.show=function(t){var n=jQuery.Deferred();f=t,u=n,d=!1;var i=new XMLHttpRequest;return i.open("GET","components/medialibrarycreator/medialibrarycreator.template.html",!0),i.onload=function(){var n=this.response,i=e.createDialog({size:"small",modal:!1,removeOnClose:!0});i.classList.add("ui-body-a"),i.classList.add("background-theme-a"),i.classList.add("popupEditor"),i.innerHTML=Globalize.translateDocument(n),document.body.appendChild(i),r(i,t.collectionTypeOptions),i.addEventListener("iron-overlay-closed",s),e.open(i),i.querySelector(".btnCancel").addEventListener("click",function(){e.close(i)}),m=[],a(i)},i.send(),n.promise()}}var u,d,f,m=[];return p});