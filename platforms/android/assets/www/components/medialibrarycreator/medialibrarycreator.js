define(["dialogHelper","jQuery","paper-input","paper-fab","paper-item-body","paper-icon-item"],function(e,t){function n(){if(0==h.length)return require(["alert"],function(e){e({text:Globalize.translate("PleaseAddAtLeastOneFolder"),type:"error"})}),!1;var n=this,r=t(n).parents(".dialog")[0],i=t("#txtValue",n).val(),o=t("#selectCollectionType",n).val();return"mixed"==o&&(o=null),ApiClient.addVirtualFolder(i,o,m.refresh,h).then(function(){f=!0,e.close(r)},function(){require(["toast"],function(e){e(Globalize.translate("ErrorAddingMediaPathToVirtualFolder"))})}),!1}function r(e){return e.filter(function(e){return e.isSelectable!==!1}).map(function(e){return'<option value="'+e.value+'">'+e.name+"</option>"}).join("")}function i(e,i){t("#selectCollectionType",e).html(r(i)).val("").on("change",function(){if("mixed"!=this.value){var e=t(this).parents(".dialog")[0],n=this.selectedIndex;if(-1!=n){var r=this.options[n].innerHTML.replace("*","").replace("&amp;","&"),o=this.value;t("#txtValue",e).val(r);var a=i.filter(function(e){return e.value==o})[0];t(".collectionTypeFieldDescription",e).html(a.message||"")}}}),t(".btnAddFolder",e).on("click",o),t("form",e).off("submit",n).on("submit",n)}function o(){var e=t(this).parents(".popupEditor")[0];require(["directorybrowser"],function(t){var n=new t;n.show({callback:function(t){t&&c(e,t),n.close()}})})}function a(e,t){var n="";return n+='<paper-icon-item role="menuitem" class="lnkPath">',n+='<paper-fab mini style="background:#52B54B;" icon="folder" item-icon></paper-fab>',n+="<paper-item-body>",n+=e,n+="</paper-item-body>",n+='<paper-icon-button icon="remove-circle" class="btnRemovePath" data-index="'+t+'"></paper-icon-button>',n+="</paper-icon-item>"}function l(e){var n=h.map(a).join(""),r=e.querySelector(".folderList");r.innerHTML=n,n?r.classList.remove("hide"):r.classList.add("hide"),t(e.querySelectorAll(".btnRemovePath")).on("click",s)}function c(e,t){0==h.filter(function(e){return e.toLowerCase()==t.toLowerCase()}).length&&(h.push(t),l(e))}function s(){var e=this,n=parseInt(e.getAttribute("data-index")),r=h[n];h=h.filter(function(e){return e.toLowerCase()!=r.toLowerCase()});var i=t(this).parents(".popupEditor")[0];l(i)}function u(){Dashboard.hideLoadingMsg(),d.resolveWith(null,[f])}function p(){var t=this;t.show=function(t){var n=jQuery.Deferred();m=t,d=n,f=!1;var r=new XMLHttpRequest;return r.open("GET","components/medialibrarycreator/medialibrarycreator.template.html",!0),r.onload=function(){var n=this.response,r=e.createDialog({size:"small",modal:!1,removeOnClose:!0});r.classList.add("ui-body-a"),r.classList.add("background-theme-a"),r.classList.add("popupEditor"),r.innerHTML=Globalize.translateDocument(n),document.body.appendChild(r),i(r,t.collectionTypeOptions),r.addEventListener("close",u),e.open(r),r.querySelector(".btnCancel").addEventListener("click",function(){e.close(r)}),h=[],l(r)},r.send(),n.promise()}}var d,f,m,h=[];return p});