define(["paper-checkbox","paper-input","paper-item-body","paper-icon-item"],function(){return function(e,t,n){function i(){Dashboard.showLoadingMsg(),ApiClient.getNamedConfiguration("livetv").then(function(n){var i=n.ListingProviders.filter(function(e){return e.Id==t})[0]||{};u=i.ListingsId,$("#selectListing",e).val(i.ListingsId||""),e.querySelector(".txtUser").value=i.Username||"",e.querySelector(".txtPass").value="",e.querySelector(".txtZipCode").value=i.ZipCode||"",i.Username&&i.Password?e.querySelector(".listingsSection").classList.remove("hide"):e.querySelector(".listingsSection").classList.add("hide"),e.querySelector(".chkAllTuners").checked=i.EnableAllTuners,e.querySelector(".chkAllTuners").checked?e.querySelector(".selectTunersSection").classList.add("hide"):e.querySelector(".selectTunersSection").classList.remove("hide"),r(i),c(e,i,n.TunerHosts)})}function r(t){ApiClient.getJSON(ApiClient.getUrl("LiveTv/ListingProviders/SchedulesDirect/Countries")).then(function(n){var i,r,a=[];for(var o in n){var s=n[o];if(s.length&&"ZZZ"!==o)for(i=0,r=s.length;r>i;i++)a.push({name:s[i].fullName,value:s[i].shortName})}a.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),$("#selectCountry",e).html(a.map(function(e){return'<option value="'+e.value+'">'+e.name+"</option>"}).join("")).val(t.Country||""),$(e.querySelector(".txtZipCode")).trigger("change")},function(){Dashboard.alert({message:Globalize.translate("ErrorGettingTvLineups")})}),Dashboard.hideLoadingMsg()}function a(){Dashboard.showLoadingMsg(),require(["cryptojs-sha1"],function(){var n={Type:"SchedulesDirect",Username:e.querySelector(".txtUser").value,EnableAllTuners:!0,Password:CryptoJS.SHA1(e.querySelector(".txtPass").value).toString()},r=t;r&&(n.Id=r),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/ListingProviders",{ValidateLogin:!0}),data:JSON.stringify(n),contentType:"application/json",dataType:"json"}).then(function(e){Dashboard.processServerConfigurationUpdateResult(),t=e.Id,i()},function(){Dashboard.alert({message:Globalize.translate("ErrorSavingTvProvider")})})})}function o(){var i=$("#selectListing",e).val();if(!i)return void Dashboard.alert({message:Globalize.translate("ErrorPleaseSelectLineup")});Dashboard.showLoadingMsg();var r=t;ApiClient.getNamedConfiguration("livetv").then(function(t){var a=t.ListingProviders.filter(function(e){return e.Id==r})[0];a.ZipCode=e.querySelector(".txtZipCode").value,a.Country=$("#selectCountry",e).val(),a.ListingsId=i,a.EnableAllTuners=e.querySelector(".chkAllTuners").checked,a.EnabledTuners=a.EnableAllTuners?[]:$(".chkTuner",e).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-id")}),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/ListingProviders",{ValidateListings:!0}),data:JSON.stringify(a),contentType:"application/json"}).then(function(){Dashboard.hideLoadingMsg(),n.showConfirmation!==!1&&Dashboard.processServerConfigurationUpdateResult(),Events.trigger(d,"submitted")},function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("ErrorAddingListingsToSchedulesDirect")})})})}function s(n){return n?(Dashboard.showModalLoadingMsg(),void ApiClient.ajax({type:"GET",url:ApiClient.getUrl("LiveTv/ListingProviders/Lineups",{Id:t,Location:n,Country:$("#selectCountry",e).val()}),dataType:"json"}).then(function(t){$("#selectListing",e).html(t.map(function(e){return'<option value="'+e.Id+'">'+e.Name+"</option>"})),u&&$("#selectListing",e).val(u),Dashboard.hideModalLoadingMsg()},function(){Dashboard.alert({message:Globalize.translate("ErrorGettingTvLineups")}),s(""),Dashboard.hideModalLoadingMsg()})):void $("#selectListing",e).html("")}function l(e){switch(e=e.toLowerCase()){case"m3u":return"M3U Playlist";case"hdhomerun":return"HDHomerun";case"satip":return"DVB";default:return"Unknown"}}function c(e,t,n){for(var i="",r=0,a=n.length;a>r;r++){var o=n[r];i+="<paper-icon-item>";var s=t.EnableAllTuners||-1!=t.EnabledTuners.indexOf(o.Id),c=s?" checked":"";i+='<paper-checkbox data-id="'+o.Id+'" class="chkTuner" item-icon '+c+"></paper-checkbox>",i+="<paper-item-body two-line>",i+="<div>",i+=o.FriendlyName||l(o.Type),i+="</div>",i+="<div secondary>",i+=o.Url,i+="</div>",i+="</paper-item-body>",i+="</paper-icon-item>"}e.querySelector(".tunerList").innerHTML=i}var u,d=this;d.submit=function(){e.querySelector(".btnSubmitListingsContainer").click()},d.init=function(){n=n||{},n.showCancelButton!==!1?e.querySelector(".btnCancel").classList.remove("hide"):e.querySelector(".btnCancel").classList.add("hide"),n.showSubmitButton!==!1?e.querySelector(".btnSubmitListings").classList.remove("hide"):e.querySelector(".btnSubmitListings").classList.add("hide"),$(".formLogin",e).on("submit",function(){return a(),!1}),$(".formListings",e).on("submit",function(){return o(),!1}),$(".txtZipCode",e).on("change",function(){s(this.value)}),e.querySelector(".chkAllTuners").addEventListener("change",function(t){t.target.checked?e.querySelector(".selectTunersSection").classList.add("hide"):e.querySelector(".selectTunersSection").classList.remove("hide")}),$(".createAccountHelp",e).html(Globalize.translate("MessageCreateAccountAt",'<a href="http://www.schedulesdirect.org" target="_blank">http://www.schedulesdirect.org</a>')),i()}}});