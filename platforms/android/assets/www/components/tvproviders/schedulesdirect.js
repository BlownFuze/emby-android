define([],function(){return function(e,t,i){function n(){Dashboard.showLoadingMsg(),ApiClient.getNamedConfiguration("livetv").then(function(i){var n=i.ListingProviders.filter(function(e){return e.Id==t})[0]||{};l=n.ListingsId,$("#selectListing",e).val(n.ListingsId||""),e.querySelector(".txtUser").value=n.Username||"",e.querySelector(".txtPass").value="",e.querySelector(".txtZipCode").value=n.ZipCode||"",n.Username&&n.Password?e.querySelector(".listingsSection").classList.remove("hide"):e.querySelector(".listingsSection").classList.add("hide"),r(n)})}function r(t){ApiClient.getJSON(ApiClient.getUrl("LiveTv/ListingProviders/SchedulesDirect/Countries")).then(function(i){var n,r,a=[];for(var o in i){var s=i[o];if(s.length&&"ZZZ"!==o)for(n=0,r=s.length;r>n;n++)a.push({name:s[n].fullName,value:s[n].shortName})}a.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),$("#selectCountry",e).html(a.map(function(e){return'<option value="'+e.value+'">'+e.name+"</option>"}).join("")).val(t.Country||""),$(e.querySelector(".txtZipCode")).trigger("change")},function(){Dashboard.alert({message:Globalize.translate("ErrorGettingTvLineups")})}),Dashboard.hideLoadingMsg()}function a(){Dashboard.showLoadingMsg(),require(["cryptojs-sha1"],function(){var i={Type:"SchedulesDirect",Username:e.querySelector(".txtUser").value,Password:CryptoJS.SHA1(e.querySelector(".txtPass").value).toString()},r=t;r&&(i.Id=r),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/ListingProviders",{ValidateLogin:!0}),data:JSON.stringify(i),contentType:"application/json"}).then(function(e){Dashboard.processServerConfigurationUpdateResult(),t=e.Id,n()},function(){Dashboard.alert({message:Globalize.translate("ErrorSavingTvProvider")})})})}function o(){var n=$("#selectListing",e).val();if(!n)return void Dashboard.alert({message:Globalize.translate("ErrorPleaseSelectLineup")});Dashboard.showLoadingMsg();var r=t;ApiClient.getNamedConfiguration("livetv").then(function(t){var a=t.ListingProviders.filter(function(e){return e.Id==r})[0];a.ZipCode=e.querySelector(".txtZipCode").value,a.Country=$("#selectCountry",e).val(),a.ListingsId=n,ApiClient.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/ListingProviders",{ValidateListings:!0}),data:JSON.stringify(a),contentType:"application/json"}).then(function(){Dashboard.hideLoadingMsg(),i.showConfirmation!==!1&&Dashboard.processServerConfigurationUpdateResult(),$(u).trigger("submitted")},function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("ErrorAddingListingsToSchedulesDirect")})})})}function s(i){return i?(Dashboard.showModalLoadingMsg(),void ApiClient.ajax({type:"GET",url:ApiClient.getUrl("LiveTv/ListingProviders/Lineups",{Id:t,Location:i,Country:$("#selectCountry",e).val()}),dataType:"json"}).then(function(t){$("#selectListing",e).html(t.map(function(e){return'<option value="'+e.Id+'">'+e.Name+"</option>"})),l&&$("#selectListing",e).val(l),Dashboard.hideModalLoadingMsg()},function(){Dashboard.alert({message:Globalize.translate("ErrorGettingTvLineups")}),s(""),Dashboard.hideModalLoadingMsg()})):void $("#selectListing",e).html("")}var l,u=this;u.submit=function(){e.querySelector(".btnSubmitListingsContainer").click()},u.init=function(){i=i||{},i.showCancelButton!==!1?e.querySelector(".btnCancel").classList.remove("hide"):e.querySelector(".btnCancel").classList.add("hide"),i.showSubmitButton!==!1?e.querySelector(".btnSubmitListings").classList.remove("hide"):e.querySelector(".btnSubmitListings").classList.add("hide"),$(".formLogin",e).on("submit",function(){return a(),!1}),$(".formListings",e).on("submit",function(){return o(),!1}),$(".txtZipCode",e).on("change",function(){s(this.value)}),$(".createAccountHelp",e).html(Globalize.translate("MessageCreateAccountAt",'<a href="http://www.schedulesdirect.org" target="_blank">http://www.schedulesdirect.org</a>')),n()}}});