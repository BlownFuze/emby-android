define(["jQuery","paper-checkbox","paper-button","emby-input","paper-item-body","paper-icon-item","paper-icon-button-light"],function(e){return function(t,r,n){function i(e,t){return e&&t?e.ListingProviders.filter(function(e){return e.Id==t})[0]||i():ApiClient.getJSON(ApiClient.getUrl("LiveTv/ListingProviders/Default"))}function o(){Dashboard.showLoadingMsg(),ApiClient.getNamedConfiguration("livetv").then(function(e){i(e,r).then(function(r){t.querySelector(".txtPath").value=r.Path||"",t.querySelector(".txtKids").value=(r.KidsGenres||[]).join("|"),t.querySelector(".txtNews").value=(r.NewsGenres||[]).join("|"),t.querySelector(".txtSports").value=(r.SportsGenres||[]).join("|"),t.querySelector(".chkAllTuners").checked=r.EnableAllTuners,t.querySelector(".chkAllTuners").checked?t.querySelector(".selectTunersSection").classList.add("hide"):t.querySelector(".selectTunersSection").classList.remove("hide"),l(t,r,e.TunerHosts),Dashboard.hideLoadingMsg()})})}function s(e){var t=e.value;return t?t.split("|"):[]}function a(){Dashboard.showLoadingMsg();var i=r;ApiClient.getNamedConfiguration("livetv").then(function(r){var o=r.ListingProviders.filter(function(e){return e.Id==i})[0]||{};o.Type="xmltv",o.Path=t.querySelector(".txtPath").value,o.KidsGenres=s(t.querySelector(".txtKids")),o.NewsGenres=s(t.querySelector(".txtNews")),o.SportsGenres=s(t.querySelector(".txtSports")),o.EnableAllTuners=t.querySelector(".chkAllTuners").checked,o.EnabledTuners=o.EnableAllTuners?[]:e(".chkTuner",t).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-id")}),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/ListingProviders",{ValidateListings:!0}),data:JSON.stringify(o),contentType:"application/json"}).then(function(){Dashboard.hideLoadingMsg(),n.showConfirmation!==!1&&Dashboard.processServerConfigurationUpdateResult(),Events.trigger(d,"submitted")},function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("ErrorAddingListingsToSchedulesDirect")})})})}function c(e){switch(e=e.toLowerCase()){case"m3u":return"M3U Playlist";case"hdhomerun":return"HDHomerun";case"satip":return"DVB";default:return"Unknown"}}function l(e,t,r){for(var n="",i=0,o=r.length;o>i;i++){var s=r[i];n+="<paper-icon-item>";var a=t.EnableAllTuners||[],l=t.EnableAllTuners||-1!=a.indexOf(s.Id),u=l?" checked":"";n+='<paper-checkbox data-id="'+s.Id+'" class="chkTuner" item-icon '+u+"></paper-checkbox>",n+="<paper-item-body two-line>",n+="<div>",n+=s.FriendlyName||c(s.Type),n+="</div>",n+="<div secondary>",n+=s.Url,n+="</div>",n+="</paper-item-body>",n+="</paper-icon-item>"}e.querySelector(".tunerList").innerHTML=n}function u(t){var r=e(t.target).parents(".xmltvForm")[0];require(["directorybrowser"],function(e){var t=new e;t.show({includeFiles:!0,callback:function(e){if(e){var n=r.querySelector(".txtPath");n.value=e,n.focus()}t.close()}})})}var d=this;d.submit=function(){t.querySelector(".btnSubmitListingsContainer").click()},d.init=function(){n=n||{},n.showCancelButton!==!1?t.querySelector(".btnCancel").classList.remove("hide"):t.querySelector(".btnCancel").classList.add("hide"),n.showSubmitButton!==!1?t.querySelector(".btnSubmitListings").classList.remove("hide"):t.querySelector(".btnSubmitListings").classList.add("hide"),e("form",t).on("submit",function(){return a(),!1}),t.querySelector("#btnSelectPath").addEventListener("click",u),t.querySelector(".chkAllTuners").addEventListener("change",function(e){e.target.checked?t.querySelector(".selectTunersSection").classList.add("hide"):t.querySelector(".selectTunersSection").classList.remove("hide")}),o()}}});