function shouldBundleCommandJson(){if(bridgeMode===jsToNativeModes.XHR_WITH_PAYLOAD)return!0;if(bridgeMode===jsToNativeModes.XHR_OPTIONAL_PAYLOAD){for(var e=0,a=0;a<commandQueue.length;++a)e+=commandQueue[a].length;return 4500>e}return!1}function massageArgsJsToNative(e){if(!e||"Array"!=utils.typeName(e))return e;var a=[];return e.forEach(function(e){a.push("ArrayBuffer"==utils.typeName(e)?{CDVType:"ArrayBuffer",data:base64.fromArrayBuffer(e)}:e)}),a}function massageMessageNativeToJs(e){if("ArrayBuffer"==e.CDVType){var a=function(e){for(var a=new Uint8Array(e.length),r=0;r<e.length;r++)a[r]=e.charCodeAt(r);return a.buffer},r=function(e){return a(atob(e))};e=r(e.data)}return e}function convertMessageToArgsNativeToJs(e){var a=[];return e&&e.hasOwnProperty("CDVType")?"MultiPart"==e.CDVType?e.messages.forEach(function(e){a.push(massageMessageNativeToJs(e))}):a.push(massageMessageNativeToJs(e)):a.push(e),a}function iOSExec(){void 0===bridgeMode&&(bridgeMode=jsToNativeModes.IFRAME_NAV),window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.cordova&&window.webkit.messageHandlers.cordova.postMessage&&(bridgeMode=jsToNativeModes.WK_WEBVIEW_BINDING);var e,a,r,t,o,s,n=null;if("string"!=typeof arguments[0])e=arguments[0],a=arguments[1],r=arguments[2],t=arguments[3],o=arguments[4],n="INVALID";else try{return s=arguments[0].split("."),t=s.pop(),r=s.join("."),void(o=Array.prototype.splice.call(arguments,1))}catch(i){}o=o||[],(e||a)&&(n=r+cordova.callbackId++,cordova.callbacks[n]={success:e,fail:a}),o=massageArgsJsToNative(o);var c=[n,r,t,o];commandQueue.push(JSON.stringify(c)),bridgeMode===jsToNativeModes.WK_WEBVIEW_BINDING?window.webkit.messageHandlers.cordova.postMessage(c):isInContextOfEvalJs||1!=commandQueue.length||pokeNative()}function pokeNative(){switch(bridgeMode){case jsToNativeModes.XHR_NO_PAYLOAD:case jsToNativeModes.XHR_WITH_PAYLOAD:case jsToNativeModes.XHR_OPTIONAL_PAYLOAD:pokeNativeViaXhr();break;default:pokeNativeViaIframe()}}function pokeNativeViaXhr(){execXhr&&4!=execXhr.readyState&&(execXhr=null),execXhr=execXhr||new XMLHttpRequest,execXhr.open("HEAD","/!gap_exec?"+ +new Date,!0),vcHeaderValue||(vcHeaderValue=/.*\((.*)\)$/.exec(navigator.userAgent)[1]),execXhr.setRequestHeader("vc",vcHeaderValue),execXhr.setRequestHeader("rc",++requestCount),shouldBundleCommandJson()&&execXhr.setRequestHeader("cmds",iOSExec.nativeFetchMessages()),execXhr.send(null)}function pokeNativeViaIframe(){if(!document.body)return void setTimeout(pokeNativeViaIframe);if(bridgeMode===jsToNativeModes.IFRAME_HASH_NO_PAYLOAD||bridgeMode===jsToNativeModes.IFRAME_HASH_WITH_PAYLOAD){execHashIframe||(execHashIframe=document.createElement("iframe"),execHashIframe.style.display="none",document.body.appendChild(execHashIframe),execHashIframe.contentWindow.history.replaceState(null,null,"file:///#")),hashToggle=3^hashToggle;var e="%0"+hashToggle;bridgeMode===jsToNativeModes.IFRAME_HASH_WITH_PAYLOAD&&(e+=iOSExec.nativeFetchMessages()),execHashIframe.contentWindow.location.hash=e}else execIframe&&execIframe.contentWindow?execIframe.contentWindow.location="gap://ready":(execIframe=document.createElement("iframe"),execIframe.style.display="none",execIframe.src="gap://ready",document.body.appendChild(execIframe)),failSafeTimerId=setTimeout(function(){commandQueue.length&&pokeNative()},50)}var cordova=require("cordova"),channel=require("cordova/channel"),utils=require("cordova/utils"),base64=require("cordova/base64"),jsToNativeModes={IFRAME_NAV:0,XHR_NO_PAYLOAD:1,XHR_WITH_PAYLOAD:2,XHR_OPTIONAL_PAYLOAD:3,IFRAME_HASH_NO_PAYLOAD:4,IFRAME_HASH_WITH_PAYLOAD:5,WK_WEBVIEW_BINDING:6},bridgeMode,execIframe,execHashIframe,hashToggle=1,execXhr,requestCount=0,vcHeaderValue=null,commandQueue=[],isInContextOfEvalJs=0,failSafeTimerId=0;iOSExec.jsToNativeModes=jsToNativeModes,iOSExec.setJsToNativeBridgeMode=function(e){execIframe&&(execIframe.parentNode&&execIframe.parentNode.removeChild(execIframe),execIframe=null),bridgeMode=e},iOSExec.nativeFetchMessages=function(){if(failSafeTimerId&&(clearTimeout(failSafeTimerId),failSafeTimerId=0),!commandQueue.length)return"";var e="["+commandQueue.join(",")+"]";return commandQueue.length=0,e},iOSExec.nativeCallback=function(e,a,r,t){return iOSExec.nativeEvalAndFetch(function(){var o=0===a||1===a,s=convertMessageToArgsNativeToJs(r);cordova.callbackFromNative(e,o,a,s,t)})},iOSExec.nativeEvalAndFetch=function(e){isInContextOfEvalJs++;try{return e(),iOSExec.nativeFetchMessages()}finally{isInContextOfEvalJs--}},module.exports=iOSExec;