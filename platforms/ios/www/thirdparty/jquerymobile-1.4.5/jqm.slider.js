define(["jqmwidget"],function(){function e(){return t||(t=$("<div></div>",{"class":"ui-slider-popup ui-shadow ui-corner-all"})),t.clone()}var i=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;$.extend($.mobile,{getAttribute:function(e,t){var s;e=e.jquery?e[0]:e,e&&e.getAttribute&&(s=e.getAttribute("data-"+t));try{s="true"===s?!0:"false"===s?!1:"null"===s?null:+s+""===s?+s:i.test(s)?JSON.parse(s):s}catch(r){}return s}}),function(e){e.ui=e.ui||{},e.extend(e.ui,{version:"c0ab71056b936627e8a7821f03c044aec6280a40",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())}(jQuery),$.widget("mobile.slider",$.extend({initSelector:"input[type='range']:not([data-role='none'])",widgetEventPrefix:"slide",options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!1},_create:function(){var e,i,t,s,r,n,a,l,h,o,d=this,u=this.element,p=this.options.trackTheme||$.mobile.getAttribute(u[0],"theme"),g=p?" ui-bar-"+p:" ui-bar-inherit",c=this.options.corners||u.data("corners")?" ui-corner-all":"",_=this.options.mini||u.data("mini")?" ui-mini":"",m=u[0].nodeName.toLowerCase(),f="select"===m,b=u.parent().is("[data-role='rangeslider']"),v=f?"ui-slider-switch":"",C=u.attr("id"),w=$("[for='"+C+"']"),T=w.attr("id")||C+"-label",y=f?0:parseFloat(u.attr("min")),k=f?u.find("option").length-1:parseFloat(u.attr("max")),F=window.parseFloat(u.attr("step")||1),x=document.createElement("a"),E=$(x),M=document.createElement("div"),S=$(M),A=this.options.highlight&&!f?function(){var e=document.createElement("div");return e.className="ui-slider-bg "+$.mobile.activeBtnClass,$(e).prependTo(S)}():!1;if(w.attr("id",T),this.isToggleSwitch=f,x.setAttribute("href","#"),M.setAttribute("role","application"),M.className=[this.isToggleSwitch?"ui-slider ui-slider-track ui-shadow-inset ":"ui-slider-track ui-shadow-inset ",v,g,c,_].join(""),x.className="ui-slider-handle",M.appendChild(x),E.attr({role:"slider","aria-valuemin":y,"aria-valuemax":k,"aria-valuenow":this._value(),"aria-valuetext":this._value(),title:this._value(),"aria-labelledby":T}),$.extend(this,{slider:S,handle:E,control:u,type:m,step:F,max:k,min:y,valuebg:A,isRangeslider:b,dragging:!1,beforeStart:null,userModified:!1,mouseMoved:!1}),f){for(a=u.attr("tabindex"),a&&E.attr("tabindex",a),u.attr("tabindex","-1").focus(function(){$(this).blur(),E.focus()}),i=document.createElement("div"),i.className="ui-slider-inneroffset",t=0,s=M.childNodes.length;s>t;t++)i.appendChild(M.childNodes[t]);for(M.appendChild(i),E.addClass("ui-slider-handle-snapping"),e=u.find("option"),r=0,n=e.length;n>r;r++)l=r?"a":"b",h=r?" "+$.mobile.activeBtnClass:"",o=document.createElement("span"),o.className=["ui-slider-label ui-slider-label-",l,h].join(""),o.setAttribute("role","img"),o.appendChild(document.createTextNode(e[r].innerHTML)),$(o).prependTo(S);d._labels=$(".ui-slider-label",S)}u.addClass(f?"ui-slider-switch":"ui-slider-input"),this._on(u,{change:"_controlChange",keyup:"_controlKeyup",blur:"_controlBlur",mouseup:"_controlVMouseUp"}),S.bind("mousedown",$.proxy(this._sliderVMouseDown,this)).bind("click",!1),this._on(document,{mousemove:"_preventDocumentDrag"}),this._on(S.add(document),{mouseup:"_sliderVMouseUp"}),S.insertAfter(u),f||b||(i=this.options.mini?"<div class='ui-slider ui-mini'>":"<div class='ui-slider'>",u.add(S).wrapAll(i)),this._on(this.handle,{mousedown:"_handleVMouseDown",keydown:"_handleKeydown",keyup:"_handleKeyup"}),this.handle.bind("click",!1),this.refresh(void 0,void 0,!0)},_setOptions:function(e){void 0!==e.theme&&this._setTheme(e.theme),void 0!==e.trackTheme&&this._setTrackTheme(e.trackTheme),void 0!==e.corners&&this._setCorners(e.corners),void 0!==e.mini&&this._setMini(e.mini),void 0!==e.highlight&&this._setHighlight(e.highlight),void 0!==e.disabled&&this._setDisabled(e.disabled),this._super(e)},_controlChange:function(e){return this._trigger("controlchange",e)===!1?!1:void(this.mouseMoved||this.refresh(this._value(),!0))},_controlKeyup:function(){this.refresh(this._value(),!0,!0)},_controlBlur:function(){this.refresh(this._value(),!0)},_controlVMouseUp:function(){this._checkedRefresh()},_handleVMouseDown:function(){this.handle.focus()},_handleKeydown:function(e){var i=this._value();if(!this.options.disabled){switch(e.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:e.preventDefault(),this._keySliding||(this._keySliding=!0,this.handle.addClass("ui-state-active"))}switch(e.keyCode){case $.ui.keyCode.HOME:this.refresh(this.min);break;case $.ui.keyCode.END:this.refresh(this.max);break;case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:this.refresh(i+this.step);break;case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:this.refresh(i-this.step)}}},_handleKeyup:function(){this._keySliding&&(this._keySliding=!1,this.handle.removeClass("ui-state-active"))},_sliderVMouseDown:function(e){return this.options.disabled||1!==e.which&&0!==e.which&&void 0!==e.which?!1:this._trigger("beforestart",e)===!1?!1:(this.dragging=!0,this.userModified=!1,this.mouseMoved=!1,this.isToggleSwitch&&(this.beforeStart=this.element[0].selectedIndex),this.refresh(e),this._trigger("start"),!1)},_sliderVMouseUp:function(){return this.dragging?(this.dragging=!1,this.isToggleSwitch&&(this.handle.addClass("ui-slider-handle-snapping"),this.refresh(this.mouseMoved?this.userModified?0===this.beforeStart?1:0:this.beforeStart:0===this.beforeStart?1:0)),this.mouseMoved=!1,this._trigger("stop"),!1):void 0},_preventDocumentDrag:function(e){return this._trigger("drag",e)===!1?!1:this.dragging&&!this.options.disabled?(this.mouseMoved=!0,this.isToggleSwitch&&this.handle.removeClass("ui-slider-handle-snapping"),this.refresh(e),this.userModified=this.beforeStart!==this.element[0].selectedIndex,!1):void 0},_checkedRefresh:function(){this.value!==this._value()&&this.refresh(this._value())},_value:function(){return this.isToggleSwitch?this.element[0].selectedIndex:parseFloat(this.element.val())},_reset:function(){this.refresh(void 0,!1,!0)},refresh:function(e,i,t){var s,r,n,a,l,h,o,d,u,p,g,c,_,m,f,b,v,C,w,T,y=this,k=$.mobile.getAttribute(this.element[0],"theme"),F=this.options.theme||k,x=F?" ui-btn-"+F:"",E=this.options.trackTheme||k,M=E?" ui-bar-"+E:" ui-bar-inherit",S=this.options.corners?" ui-corner-all":"",A=this.options.mini?" ui-mini":"";if(y.slider[0].className=[this.isToggleSwitch?"ui-slider ui-slider-switch ui-slider-track ui-shadow-inset":"ui-slider-track ui-shadow-inset",M,S,A].join(""),(this.options.disabled||this.element.prop("disabled"))&&this.disable(),this.value=this._value(),this.options.highlight&&!this.isToggleSwitch&&0===this.slider.find(".ui-slider-bg").length&&(this.valuebg=function(){var e=document.createElement("div");return e.className="ui-slider-bg "+$.mobile.activeBtnClass,$(e).prependTo(y.slider)}()),this.handle.addClass("ui-btn"+x+" ui-shadow"),o=this.element,d=!this.isToggleSwitch,u=d?[]:o.find("option"),p=d?parseFloat(o.attr("min")):0,g=d?parseFloat(o.attr("max")):u.length-1,c=d&&parseFloat(o.attr("step"))>0?parseFloat(o.attr("step")):1,"object"==typeof e){if(n=e,a=8,s=this.slider.offset().left,r=this.slider.width(),l=r/((g-p)/c),!this.dragging||n.pageX<s-a||n.pageX>s+r+a)return;h=l>1?(n.pageX-s)/r*100:Math.round((n.pageX-s)/r*100)}else null==e&&(e=d?parseFloat(o.val()||0):o[0].selectedIndex),h=(parseFloat(e)-p)/(g-p)*100;if(!isNaN(h)&&(_=h/100*(g-p)+p,m=(_-p)%c,f=_-m,2*Math.abs(m)>=c&&(f+=m>0?c:-c),b=100/((g-p)/c),_=parseFloat(f.toFixed(5)),"undefined"==typeof l&&(l=r/((g-p)/c)),l>1&&d&&(h=(_-p)*b*(1/c)),0>h&&(h=0),h>100&&(h=100),p>_&&(_=p),_>g&&(_=g),this.handle.css("left",h+"%"),this.handle[0].setAttribute("aria-valuenow",d?_:u.eq(_).attr("value")),this.handle[0].setAttribute("aria-valuetext",d?_:u.eq(_).text()),this.handle[0].setAttribute("title",d?_:u.eq(_).text()),this.valuebg&&this.valuebg.css("width",h+"%"),this._labels&&(v=this.handle.width()/this.slider.width()*100,C=h&&v+(100-v)*h/100,w=100===h?0:Math.min(v+100-C,100),this._labels.each(function(){var e=$(this).hasClass("ui-slider-label-a");$(this).width((e?C:w)+"%")})),!t)){if(T=!1,d?(T=parseFloat(o.val())!==_,o.val(_)):(T=o[0].selectedIndex!==_,o[0].selectedIndex=_),this._trigger("beforechange",e)===!1)return!1;!i&&T&&o.trigger("change")}},_setHighlight:function(e){e=!!e,e?(this.options.highlight=!!e,this.refresh()):this.valuebg&&(this.valuebg.remove(),this.valuebg=!1)},_setTheme:function(e){this.handle.removeClass("ui-btn-"+this.options.theme).addClass("ui-btn-"+e);var i=this.options.theme?this.options.theme:"inherit",t=e?e:"inherit";this.control.removeClass("ui-body-"+i).addClass("ui-body-"+t)},_setTrackTheme:function(e){var i=this.options.trackTheme?this.options.trackTheme:"inherit",t=e?e:"inherit";this.slider.removeClass("ui-body-"+i).addClass("ui-body-"+t)},_setMini:function(e){e=!!e,this.isToggleSwitch||this.isRangeslider||(this.slider.parent().toggleClass("ui-mini",e),this.element.toggleClass("ui-mini",e)),this.slider.toggleClass("ui-mini",e)},_setCorners:function(e){this.slider.toggleClass("ui-corner-all",e),this.isToggleSwitch||this.control.toggleClass("ui-corner-all",e)},_setDisabled:function(e){e=!!e,this.element.prop("disabled",e),this.slider.toggleClass("ui-state-disabled",e).attr("aria-disabled",e),this.element.toggleClass("ui-state-disabled",e)}},$.mobile.behaviors.formReset)),$.widget("mobile.rangeslider",$.extend({options:{theme:null,trackTheme:null,corners:!0,mini:!1,highlight:!0},_create:function(){var e=this.element,i=this.options.mini?"ui-rangeslider ui-mini":"ui-rangeslider",t=e.find("input").first(),s=e.find("input").last(),r=e.find("label").first(),n=$.data(t.get(0),"mobile-slider")||$.data(t.slider().get(0),"mobile-slider"),a=$.data(s.get(0),"mobile-slider")||$.data(s.slider().get(0),"mobile-slider"),l=n.slider,h=a.slider,o=n.handle,d=$("<div class='ui-rangeslider-sliders' />").appendTo(e);t.addClass("ui-rangeslider-first"),s.addClass("ui-rangeslider-last"),e.addClass(i),l.appendTo(d),h.appendTo(d),r.insertBefore(e),o.prependTo(h),$.extend(this,{_inputFirst:t,_inputLast:s,_sliderFirst:l,_sliderLast:h,_label:r,_targetVal:null,_sliderTarget:!1,_sliders:d,_proxy:!1}),this.refresh(),this._on(this.element.find("input.ui-slider-input"),{slidebeforestart:"_slidebeforestart",slidestop:"_slidestop",slidedrag:"_slidedrag",slidebeforechange:"_change",blur:"_change",keyup:"_change"}),this._on({mousedown:"_change"}),this._on(this.element.closest("form"),{reset:"_handleReset"}),this._on(o,{mousedown:"_dragFirstHandle"})},_handleReset:function(){var e=this;setTimeout(function(){e._updateHighlight()},0)},_dragFirstHandle:function(e){return $.data(this._inputFirst.get(0),"mobile-slider").dragging=!0,$.data(this._inputFirst.get(0),"mobile-slider").refresh(e),$.data(this._inputFirst.get(0),"mobile-slider")._trigger("start"),!1},_slidedrag:function(e){var i=$(e.target).is(this._inputFirst),t=i?this._inputLast:this._inputFirst;return this._sliderTarget=!1,"first"===this._proxy&&i||"last"===this._proxy&&!i?($.data(t.get(0),"mobile-slider").dragging=!0,$.data(t.get(0),"mobile-slider").refresh(e),!1):void 0},_slidestop:function(e){var i=$(e.target).is(this._inputFirst);this._proxy=!1,this.element.find("input").trigger("mouseup"),this._sliderFirst.css("z-index",i?1:"")},_slidebeforestart:function(e){this._sliderTarget=!1,$(e.originalEvent.target).hasClass("ui-slider-track")&&(this._sliderTarget=!0,this._targetVal=$(e.target).val())},_setOptions:function(e){void 0!==e.theme&&this._setTheme(e.theme),void 0!==e.trackTheme&&this._setTrackTheme(e.trackTheme),void 0!==e.mini&&this._setMini(e.mini),void 0!==e.highlight&&this._setHighlight(e.highlight),void 0!==e.disabled&&this._setDisabled(e.disabled),this._super(e),this.refresh()},refresh:function(){var e=this.element,i=this.options;(this._inputFirst.is(":disabled")||this._inputLast.is(":disabled"))&&(this.options.disabled=!0),e.find("input").slider({theme:i.theme,trackTheme:i.trackTheme,disabled:i.disabled,corners:i.corners,mini:i.mini,highlight:i.highlight}).slider("refresh"),this._updateHighlight()},_change:function(e){if("keyup"===e.type)return this._updateHighlight(),!1;var i=this,t=parseFloat(this._inputFirst.val(),10),s=parseFloat(this._inputLast.val(),10),r=$(e.target).hasClass("ui-rangeslider-first"),n=r?this._inputFirst:this._inputLast,a=r?this._inputLast:this._inputFirst;if(this._inputFirst.val()>this._inputLast.val()&&"mousedown"===e.type&&!$(e.target).hasClass("ui-slider-handle"))n.blur();else if("mousedown"===e.type)return;return t>s&&!this._sliderTarget?(n.val(r?s:t).slider("refresh"),this._trigger("normalize")):t>s&&(n.val(this._targetVal).slider("refresh"),setTimeout(function(){a.val(r?t:s).slider("refresh"),$.data(a.get(0),"mobile-slider").handle.focus(),i._sliderFirst.css("z-index",r?"":1),i._trigger("normalize")},0),this._proxy=r?"first":"last"),t===s?($.data(n.get(0),"mobile-slider").handle.css("z-index",1),$.data(a.get(0),"mobile-slider").handle.css("z-index",0)):($.data(a.get(0),"mobile-slider").handle.css("z-index",""),$.data(n.get(0),"mobile-slider").handle.css("z-index","")),this._updateHighlight(),t>=s?!1:void 0},_updateHighlight:function(){var e=parseInt($.data(this._inputFirst.get(0),"mobile-slider").handle.get(0).style.left,10),i=parseInt($.data(this._inputLast.get(0),"mobile-slider").handle.get(0).style.left,10),t=i-e;this.element.find(".ui-slider-bg").css({"margin-left":e+"%",width:t+"%"})},_setTheme:function(e){this._inputFirst.slider("option","theme",e),this._inputLast.slider("option","theme",e)},_setTrackTheme:function(e){this._inputFirst.slider("option","trackTheme",e),this._inputLast.slider("option","trackTheme",e)},_setMini:function(e){this._inputFirst.slider("option","mini",e),this._inputLast.slider("option","mini",e),this.element.toggleClass("ui-mini",!!e)},_setHighlight:function(e){this._inputFirst.slider("option","highlight",e),this._inputLast.slider("option","highlight",e)},_setDisabled:function(e){this._inputFirst.prop("disabled",e),this._inputLast.prop("disabled",e)},_destroy:function(){this._label.prependTo(this.element),this.element.removeClass("ui-rangeslider ui-mini"),this._inputFirst.after(this._sliderFirst),this._inputLast.after(this._sliderLast),this._sliders.remove(),this.element.find("input").removeClass("ui-rangeslider-first ui-rangeslider-last").slider("destroy")}},$.mobile.behaviors.formReset));var t;$.widget("mobile.slider",$.mobile.slider,{options:{popupEnabled:!1,showValue:!1},_create:function(){this._super(),$.extend(this,{_currentValue:null,_popup:null,_popupVisible:!1}),this._setOption("popupEnabled",this.options.popupEnabled),this._on(this.handle,{mousedown:"_showPopup"}),this._on(this.slider.add(this.document),{mouseup:"_hidePopup"}),this._refresh()},_positionPopup:function(){var e=this.handle.offset();this._popup.offset({left:e.left+(this.handle.width()-this._popup.width())/2,top:e.top-this._popup.outerHeight()-5})},_setOption:function(i,t){this._super(i,t),"showValue"===i?this.handle.html(t&&!this.options.mini?this._value():""):"popupEnabled"===i&&t&&!this._popup&&(this._popup=e().addClass("ui-body-"+(this.options.theme||"a")).hide().insertBefore(this.element))},refresh:function(){this._super.apply(this,arguments),this._refresh()},_refresh:function(){var e,i=this.options;i.popupEnabled&&this.handle.removeAttr("title"),e=this._value(),e!==this._currentValue&&(this._currentValue=e,i.popupEnabled&&this._popup&&(this._positionPopup(),this._popup.html(e)),i.showValue&&!this.options.mini&&this.handle.html(e))},_showPopup:function(){this.options.popupEnabled&&!this._popupVisible&&(this.handle.html(""),this._popup.show(),this._positionPopup(),this._popupVisible=!0)},_hidePopup:function(){var e=this.options;e.popupEnabled&&this._popupVisible&&(e.showValue&&!e.mini&&this.handle.html(this._value()),this._popup.hide(),this._popupVisible=!1)}})});