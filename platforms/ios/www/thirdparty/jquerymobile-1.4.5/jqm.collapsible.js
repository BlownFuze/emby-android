define(["jqmwidget"],function(){!function(e){var n=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/;e.extend(e.mobile,{getAttribute:function(e,i){var l;e=e.jquery?e[0]:e,e&&e.getAttribute&&(l=e.getAttribute("data-"+i));try{l="true"===l?!0:"false"===l?!1:"null"===l?null:+l+""===l?+l:n.test(l)?JSON.parse(l):l}catch(t){}return l}})}(jQuery,this),function(e,n){var i=/([A-Z])/g,l=function(e){return"ui-btn-icon-"+(null===e?"left":e)};e.widget("mobile.collapsible",{options:{enhanced:!1,expandCueText:null,collapseCueText:null,collapsed:!0,heading:"h1,h2,h3,h4,h5,h6,legend",collapsedIcon:null,expandedIcon:null,iconpos:null,theme:null,contentTheme:null,inset:null,corners:null,mini:null},_create:function(){var n=this.element,i={accordion:n.closest("[data-role='collapsible-set'],[data-role='collapsibleset']"+(e.mobile.collapsibleset?", :mobile-collapsibleset":"")).addClass("ui-collapsible-set")};this._ui=i,this._renderedOptions=this._getOptions(this.options),this.options.enhanced?(i.heading=this.element.children(".ui-collapsible-heading"),i.content=i.heading.next(),i.anchor=i.heading.children(),i.status=i.anchor.children(".ui-collapsible-heading-status")):this._enhance(n,i),this._on(i.heading,{tap:function(){i.heading.find("a").first().addClass(e.mobile.activeBtnClass)},click:function(e){this._handleExpandCollapse(!i.heading.hasClass("ui-collapsible-heading-collapsed")),e.preventDefault(),e.stopPropagation()}})},_getOptions:function(n){var l,t=this._ui.accordion,o=this._ui.accordionWidget;n=e.extend({},n),t.length&&!o&&(this._ui.accordionWidget=o=t.data("mobile-collapsibleset"));for(l in n)n[l]=null!=n[l]?n[l]:o?o.options[l]:t.length?e.mobile.getAttribute(t[0],l.replace(i,"-$1").toLowerCase()):null,null==n[l]&&(n[l]=e.mobile.collapsible.defaults[l]);return n},_themeClassFromOption:function(e,n){return n?"none"===n?"":e+n:""},_enhance:function(n,i){var t,o=this._renderedOptions,s=this._themeClassFromOption("ui-body-",o.contentTheme);return n.addClass("ui-collapsible "+(o.inset?"ui-collapsible-inset ":"")+(o.inset&&o.corners?"ui-corner-all ":"")+(s?"ui-collapsible-themed-content ":"")),i.originalHeading=n.children(this.options.heading).first(),i.content=n.wrapInner("<div class='ui-collapsible-content "+s+"'></div>").children(".ui-collapsible-content"),i.heading=i.originalHeading,i.heading.is("legend")&&(i.heading=e("<div role='heading'>"+i.heading.html()+"</div>"),i.placeholder=e("<div><!-- placeholder for legend --></div>").insertBefore(i.originalHeading),i.originalHeading.remove()),t=o.collapsed?o.collapsedIcon?"ui-icon-"+o.collapsedIcon:"":o.expandedIcon?"ui-icon-"+o.expandedIcon:"",i.status=e("<span class='ui-collapsible-heading-status'></span>"),i.anchor=i.heading.detach().addClass("ui-collapsible-heading").append(i.status).wrapInner("<a href='#' class='ui-collapsible-heading-toggle'></a>").find("a").first().addClass("ui-btn "+(t?t+" ":"")+(t?l(o.iconpos)+" ":"")+this._themeClassFromOption("ui-btn-",o.theme)+" "+(o.mini?"ui-mini ":"")),i.heading.insertBefore(i.content),this._handleExpandCollapse(this.options.collapsed),i},refresh:function(){this._applyOptions(this.options),this._renderedOptions=this._getOptions(this.options)},_applyOptions:function(e){var i,t,o,s,a,c=this.element,d=this._renderedOptions,p=this._ui,r=p.anchor,h=p.status,u=this._getOptions(e);e.collapsed!==n&&this._handleExpandCollapse(e.collapsed),i=c.hasClass("ui-collapsible-collapsed"),i?u.expandCueText!==n&&h.text(u.expandCueText):u.collapseCueText!==n&&h.text(u.collapseCueText),a=u.collapsedIcon!==n?u.collapsedIcon!==!1:d.collapsedIcon!==!1,(u.iconpos!==n||u.collapsedIcon!==n||u.expandedIcon!==n)&&(r.removeClass([l(d.iconpos)].concat(d.expandedIcon?["ui-icon-"+d.expandedIcon]:[]).concat(d.collapsedIcon?["ui-icon-"+d.collapsedIcon]:[]).join(" ")),a&&r.addClass([l(u.iconpos!==n?u.iconpos:d.iconpos)].concat(i?["ui-icon-"+(u.collapsedIcon!==n?u.collapsedIcon:d.collapsedIcon)]:["ui-icon-"+(u.expandedIcon!==n?u.expandedIcon:d.expandedIcon)]).join(" "))),u.theme!==n&&(o=this._themeClassFromOption("ui-btn-",d.theme),t=this._themeClassFromOption("ui-btn-",u.theme),r.removeClass(o).addClass(t)),u.contentTheme!==n&&(o=this._themeClassFromOption("ui-body-",d.contentTheme),t=this._themeClassFromOption("ui-body-",u.contentTheme),p.content.removeClass(o).addClass(t)),u.inset!==n&&(c.toggleClass("ui-collapsible-inset",u.inset),s=!(!u.inset||!u.corners&&!d.corners)),u.corners!==n&&(s=!(!u.corners||!u.inset&&!d.inset)),s!==n&&c.toggleClass("ui-corner-all",s),u.mini!==n&&r.toggleClass("ui-mini",u.mini)},_setOptions:function(e){this._applyOptions(e),this._super(e),this._renderedOptions=this._getOptions(this.options)},_handleExpandCollapse:function(n){var i=this._renderedOptions,l=this._ui;l.status.text(n?i.expandCueText:i.collapseCueText),l.heading.toggleClass("ui-collapsible-heading-collapsed",n).find("a").first().toggleClass("ui-icon-"+i.expandedIcon,!n).toggleClass("ui-icon-"+i.collapsedIcon,n||i.expandedIcon===i.collapsedIcon).removeClass(e.mobile.activeBtnClass),this.element.toggleClass("ui-collapsible-collapsed",n),l.content.toggleClass("ui-collapsible-content-collapsed",n).attr("aria-hidden",n).trigger("updatelayout"),this.options.collapsed=n,this._trigger(n?"collapse":"expand")},expand:function(){this._handleExpandCollapse(!1)},collapse:function(){this._handleExpandCollapse(!0)},_destroy:function(){var e=this._ui,n=this.options;n.enhanced||(e.placeholder?(e.originalHeading.insertBefore(e.placeholder),e.placeholder.remove(),e.heading.remove()):(e.status.remove(),e.heading.removeClass("ui-collapsible-heading ui-collapsible-heading-collapsed").children().contents().unwrap()),e.anchor.contents().unwrap(),e.content.contents().unwrap(),this.element.removeClass("ui-collapsible ui-collapsible-collapsed ui-collapsible-themed-content ui-collapsible-inset ui-corner-all"))}}),e.mobile.collapsible.defaults={expandCueText:" click to expand contents",collapseCueText:" click to collapse contents",collapsedIcon:"plus",contentTheme:"inherit",expandedIcon:"minus",iconpos:"left",inset:!0,corners:!0,theme:"inherit",mini:!1}}(jQuery)});