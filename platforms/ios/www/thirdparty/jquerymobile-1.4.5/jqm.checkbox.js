define(["jqmwidget"],function(){!function(e,t){var i=e.mobile.path.hashToSelector;e.widget("mobile.checkboxradio",e.extend({initSelector:"input[type='checkbox']:not([data-role='none']),input[type='radio']:not([data-role='none'])",options:{theme:"inherit",mini:!1,wrapperClass:null,enhanced:!1,iconpos:"left"},_create:function(){var t=this.element,i=this.options,s=function(e,t){return e.data(t)||e.closest("form, fieldset").data(t)},n=this.options.enhanced?{element:this.element.siblings("label"),isParent:!1}:this._findLabel(),a=t[0].type,o="ui-"+a+"-on",l="ui-"+a+"-off";("checkbox"===a||"radio"===a)&&(this.element[0].disabled&&(this.options.disabled=!0),i.iconpos=s(t,"iconpos")||n.element.attr("data-iconpos")||i.iconpos,i.mini=s(t,"mini")||i.mini,e.extend(this,{input:t,label:n.element,labelIsParent:n.isParent,inputtype:a,checkedClass:o,uncheckedClass:l}),this.options.enhanced||this._enhance(),this._on(n.element,{mouseover:"_handleLabelVMouseOver",click:"_handleLabelVClick"}),this._on(t,{mousedown:"_cacheVals",click:"_handleInputVClick",focus:"_handleInputFocus",blur:"_handleInputBlur"}),this.refresh())},_findLabel:function(){var t,s,n,a=this.element,o=a[0].labels;return o&&o.length>0?(s=e(o[0]),n=e.contains(s[0],a[0])):(t=a.closest("label"),n=t.length>0,s=n?t:e(this.document[0].getElementsByTagName("label")).filter("[for='"+i(a[0].id)+"']").first()),{element:s,isParent:n}},_enhance:function(){this.label.addClass("ui-btn ui-corner-all"),this.labelIsParent?this.input.add(this.label).wrapAll(this._wrapper()):(this.element.wrap(this._wrapper()),this.element.parent().prepend(this.label)),this._setOptions({theme:this.options.theme,iconpos:this.options.iconpos,mini:this.options.mini})},_wrapper:function(){return e("<div class='"+(this.options.wrapperClass?this.options.wrapperClass:"")+" ui-"+this.inputtype+(this.options.disabled?" ui-state-disabled":"")+"' ></div>")},_handleInputFocus:function(){this.label.addClass(e.mobile.focusClass)},_handleInputBlur:function(){this.label.removeClass(e.mobile.focusClass)},_handleInputVClick:function(){this.element.prop("checked",this.element.is(":checked")),this._getInputSet().not(this.element).prop("checked",!1),this._updateAll(!0)},_handleLabelVMouseOver:function(e){this.label.parent().hasClass("ui-state-disabled")&&e.stopPropagation()},_handleLabelVClick:function(e){var t=this.element;return t.is(":disabled")?void e.preventDefault():(this._cacheVals(),t.prop("checked","radio"===this.inputtype&&!0||!t.prop("checked")),t.triggerHandler("click"),this._getInputSet().not(t).prop("checked",!1),this._updateAll(),!1)},_cacheVals:function(){this._getInputSet().each(function(){e(this).attr("data-cacheVal",this.checked)})},_getInputSet:function(){var t,s,n=this.element[0],a=n.name,o=n.form,l=this.element.parents().last().get(0),h=this.element;return a&&"radio"===this.inputtype&&l&&(t="input[type='radio'][name='"+i(a)+"']",o?(s=o.getAttribute("id"),s&&(h=e(t+"[form='"+i(s)+"']",l)),h=e(o).find(t).filter(function(){return this.form===o}).add(h)):h=e(t,l).filter(function(){return!this.form})),h},_updateAll:function(t){var i=this;this._getInputSet().each(function(){var s=e(this);!this.checked&&"checkbox"!==i.inputtype||t||s.trigger("change")}).checkboxradio("refresh")},_reset:function(){this.refresh()},_hasIcon:function(){var t,i,s=e.mobile.controlgroup;return s&&(t=this.element.closest(":mobile-controlgroup,"+s.prototype.initSelector),t.length>0)?(i=e.data(t[0],"mobile-controlgroup"),"horizontal"!==(i?i.options.type:t.attr("data-type"))):!0},refresh:function(){var t=this.element[0].checked,i=e.mobile.activeBtnClass,s="ui-btn-icon-"+this.options.iconpos,n=[],a=[];this._hasIcon()?(a.push(i),n.push(s)):(a.push(s),(t?n:a).push(i)),t?(n.push(this.checkedClass),a.push(this.uncheckedClass)):(n.push(this.uncheckedClass),a.push(this.checkedClass)),this.widget().toggleClass("ui-state-disabled",this.element.prop("disabled")),this.label.addClass(n.join(" ")).removeClass(a.join(" "))},widget:function(){return this.label.parent()},_setOptions:function(e){var i=this.label,s=this.options,n=this.widget(),a=this._hasIcon();e.disabled!==t&&(this.input.prop("disabled",!!e.disabled),n.toggleClass("ui-state-disabled",!!e.disabled)),e.mini!==t&&n.toggleClass("ui-mini",!!e.mini),e.theme!==t&&i.removeClass("ui-btn-"+s.theme).addClass("ui-btn-"+e.theme),e.wrapperClass!==t&&n.removeClass(s.wrapperClass).addClass(e.wrapperClass),e.iconpos!==t&&a?i.removeClass("ui-btn-icon-"+s.iconpos).addClass("ui-btn-icon-"+e.iconpos):a||i.removeClass("ui-btn-icon-"+s.iconpos),this._super(e)}},e.mobile.behaviors.formReset))}(jQuery)});