(function(){var initComplete=false;var ignoreNextSelection=false;function onTabSelected(name){if(ignoreNextSelection){ignoreNextSelection=false;return;}
switch(name){case'Favorites':Dashboard.navigate('favorites.html');break;case'Library':Dashboard.navigate('index.html');break;case'Search':Dashboard.navigate('search.html');break;case'NowPlaying':Dashboard.navigate('nowplaying.html');break;case'Sync':Dashboard.navigate('mysync.html');break;case'LiveTv':Dashboard.navigate('livetv.html');break;case'Settings':Dashboard.navigate('mypreferencesmenu.html?userId='+Dashboard.getCurrentUserId());break;default:break;}}
function init(){var items=[{name:'Library',label:Globalize.translate('ButtonLibrary'),image:'tabbar/tab-library.png',options:{}},{name:'LiveTv',label:Globalize.translate('HeaderLiveTV'),image:'tabbar/tab-livetv.png',options:{}},{name:'Favorites',label:Globalize.translate('ButtonFavorites'),image:'tabButton:Favorites',options:{}},{name:'Search',label:Globalize.translate('ButtonSearch'),image:'tabButton:Search',options:{}},{name:'NowPlaying',label:Globalize.translate('ButtonNowPlaying'),image:'tabbar/tab-nowplaying.png',options:{}},{name:'Sync',label:Globalize.translate('ButtonSync'),image:'tabbar/tab-sync.png',options:{}},{name:'Settings',label:Globalize.translate('ButtonSettings'),image:'tabbar/tab-settings.png',options:{}}];for(var i=0;i<items.length;i++){var item=items[i];TabBar.createItem(item.name,item.label,item.image,onTabSelected,item.options);};TabBar.showItems();initComplete=true;ignoreNextSelection=true;TabBar.selectItem('Library');}
function showTabs(){if(!initComplete){return;}
TabBar.show();}
function showUserTabs(user){if(!window.ApiClient){onUserViewResponse(user,[]);return;}
ApiClient.getUserViews({},user.Id).then(function(result){onUserViewResponse(user,result.Items);},function(result){onUserViewResponse(user,[]);});}
function onUserViewResponse(user,views){var tabs=['Library'];if(views.filter(function(v){return v.CollectionType=='livetv';}).length){tabs.push('LiveTv');}
tabs.push('Favorites');tabs.push('Search');tabs.push('NowPlaying');if(user.Policy.EnableSync&&Dashboard.capabilities().SupportsSync){tabs.push('Sync');}
tabs.push('Settings');TabBar.showNamedItems(tabs);setTimeout(showTabs,500);}
function showCurrentUserTabs(){if(!Dashboard.getCurrentUserId()){return;}
Dashboard.getCurrentUser().then(showUserTabs);}
var isFirstHide=true;function hideTabs(){if(!initComplete){return;}
var hide=function(){TabBar.hide();};if(isFirstHide){isFirstHide=false;setTimeout(hide,1000);}else{hide();}}
Dashboard.ready(function(){init();Events.on(ConnectionManager,'localusersignedin',function(e,user){showUserTabs(user);});Events.on(ConnectionManager,'localusersignedout',hideTabs);Events.on(MediaController,'beforeplaybackstart',onPlaybackStart);Events.on(MediaController,'playbackstop',onPlaybackStop);showCurrentUserTabs();});function onPlaybackStart(e,state,player){if(state.NowPlayingItem&&state.NowPlayingItem.MediaType=='Video'&&player.isLocalPlayer){hideTabs();}}
function onPlaybackStop(e,state,player){if(state.NowPlayingItem&&state.NowPlayingItem.MediaType=='Video'&&player.isLocalPlayer){showTabs();}}})();