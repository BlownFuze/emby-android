!function(){function e(e){return ConnectionManager.getRegistrationInfo(e,ApiClient)}function a(a,t,r){if(n())return void t();var i=IapManager.getProductInfo(a),o=i?{enableAppUnlock:!0,id:i.id,price:i.price,feature:a}:null;if(i&&i.owned)return void t();var l=browserInfo.android?"android":"ios";IapManager.isUnlockedOverride(a).then(function(n){function i(e){return e.IsRegistered?void t():void IapManager.getSubscriptionOptions().then(function(e){if(e.filter(function(e){return e.owned}).length>0)return void t();var n={title:Globalize.translate("HeaderUnlockApp"),enablePlayMinute:"playback"==a,feature:a};s(e,o,n,t,r)})}return n?void t():void e(l+"appunlock").then(i,function(){i({})})})}function n(){if(ConnectionManager.isLoggedIntoConnect()){var e=ConnectionManager.connectUser();if(e&&e.IsSupporter)return!0}return!1}function t(){var e=document.querySelector(".inAppPurchaseOverlay");e&&PaperDialogHelper.close(e)}function r(){h=[],v=null,m=null}function i(e,a,n,r,i){t(),h=e.slice(0),a&&h.push(a);var s=PaperDialogHelper.createDialog(),p="";p+='<h2 class="dialogHeader">',p+='<paper-fab icon="arrow-back" mini class="btnCloseDialog"></paper-fab>',p+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+n.title+"</div>",p+="</h2>",p+='<div class="editorContent">',p+='<form style="max-width: 800px;margin:auto;">',p+='<p style="margin:2em 0;">',p+=Globalize.translate(a?"MessageUnlockAppWithPurchaseOrSupporter":"MessageUnlockAppWithSupporter"),p+="</p>",p+='<p style="margin:2em 0;">',p+=Globalize.translate("MessageToValidateSupporter"),p+="</p>";for(var u=!1,d=0,b=e.length;b>d;d++)u=!0,p+="<p>",p+='<paper-button raised class="submit block btnPurchase" data-email="true" data-feature="'+e[d].feature+'"><iron-icon icon="check"></iron-icon><span>',p+=e[d].buttonText,p+="</span></paper-button>",p+="</p>";if(a){u=!0;var f=Globalize.translate("ButtonUnlockWithPurchase");a.price&&(f=Globalize.translate("ButtonUnlockPrice",a.price)),p+="<p>",p+='<paper-button raised class="secondary block btnPurchase" data-feature="'+a.feature+'"><iron-icon icon="check"></iron-icon><span>'+f+"</span></paper-button>",p+="</p>"}u&&IapManager.enableRestore(n.feature,e,a)&&(p+="<p>",p+=browserInfo.safari?'<paper-button raised class="secondary block btnRestorePurchase subdued"><iron-icon icon="check"></iron-icon><span>'+Globalize.translate("ButtonRestorePreviousPurchase")+"</span></paper-button>":'<paper-button raised class="secondary block btnRestorePurchase subdued"><span>'+Globalize.translate("AlreadyPaid")+"</span></paper-button>",p+="</p>"),e.length&&(p+="<br/>",p+="<h1>"+Globalize.translate("HeaderBenefitsEmbyPremiere")+"</h1>",p+='<div class="paperList" style="margin-bottom:1em;">',p+=o().map(l).join(""),p+="</div>"),n.enablePlayMinute&&(p+="<p>",p+='<paper-button raised class="secondary block btnCloseDialog subdued"><iron-icon icon="play-arrow"></iron-icon><span>'+Globalize.translate("ButtonPlayOneMinute")+"</span></paper-button>",p+="</p>"),p+="</form>",p+="</div>",s.innerHTML=p,document.body.appendChild(s),c(s,n.feature,r,i),PaperDialogHelper.open(s),$(".btnCloseDialog",s).on("click",function(){PaperDialogHelper.close(s)}),$(s).on("iron-overlay-closed",function(){window.TabBar&&TabBar.show()}),s.classList.add("inAppPurchaseOverlay")}function o(){var e=[];return e.push({name:Globalize.translate("CoverArt"),icon:"photo",text:Globalize.translate("CoverArtFeatureDescription")}),e.push({name:Globalize.translate("HeaderFreeApps"),icon:"check",text:Globalize.translate("FreeAppsFeatureDescription")}),e.push(Dashboard.capabilities().SupportsSync?{name:Globalize.translate("HeaderMobileSync"),icon:"sync",text:Globalize.translate("MobileSyncFeatureDescription")}:AppInfo.isNativeApp?{name:Globalize.translate("HeaderCloudSync"),icon:"sync",text:Globalize.translate("CloudSyncFeatureDescription")}:{name:Globalize.translate("HeaderCinemaMode"),icon:"movie",text:Globalize.translate("CinemaModeFeatureDescription")}),e}function l(e){var a="";return a+="<paper-icon-item>",a+='<paper-fab mini style="background-color:#52B54B;" icon="'+e.icon+'" item-icon></paper-fab>',a+="<paper-item-body three-line>",a+='<a class="clearLink" href="https://emby.media/premiere" target="_blank">',a+="<div>",a+=e.name,a+="</div>",a+='<div secondary style="white-space:normal;">',a+=e.text,a+="</div>",a+="</a>",a+="</paper-item-body>",a+="</paper-icon-item>"}function c(e,a,n,t){g=!0,$(".btnPurchase",e).on("click",function(){g=!1,"true"==this.getAttribute("data-email")?p(this.getAttribute("data-feature")):IapManager.beginPurchase(this.getAttribute("data-feature"))}),$(".btnRestorePurchase",e).on("click",function(){g=!1,IapManager.restorePurchase()}),$(e).on("iron-overlay-closed",function(){r();var e=this;g?"playback"==a?Dashboard.alert({message:Globalize.translate("ThankYouForTryingEnjoyOneMinute"),title:Globalize.translate("HeaderTryPlayback"),callback:function(){t(),$(e).remove()}}):(t(),$(e).remove()):$(this).remove()})}function s(e,a,n,t,r){require(["components/paperdialoghelper","paper-fab","paper-icon-item","paper-item-body"],function(){window.TabBar&&TabBar.hide(),i(e,a,n,t,r),v=t,m=r})}function p(e){if(ConnectionManager.isLoggedIntoConnect()){var a=ConnectionManager.connectUser();if(a&&a.Email)return void IapManager.beginPurchase(e,a.Email)}u(e)}function u(e){require(["prompt"],function(a){a({text:Globalize.translate("TextPleaseEnterYourEmailAddressForSubscription"),title:Globalize.translate("HeaderEmailAddress"),callback:function(a){a&&IapManager.beginPurchase(e,a)}})})}function d(e,a){if(a.owned){var n=v;n&&h.filter(function(e){return a.id==e.id}).length&&(g=!1,t(),n.resolve())}}function b(a,n){Dashboard.getPluginSecurityInfo().then(function(t){function r(e){return e.IsRegistered?void a():void IapManager.getSubscriptionOptions().then(function(e){var t={title:Globalize.translate("HeaderUnlockSync"),feature:"sync"};s(e,null,t,a,n)})}return t.IsMBSupporter?void a():void e("Sync").then(r,function(){r({})})})}function f(){Events.on(IapManager,"productupdated",d)}var g=!0,h=[],v=null,m=null;window.RegistrationServices={renderPluginInfo:function(){},validateFeature:function(e){return new Promise(function(n,t){"playback"==e?a(e,n,t):"livetv"==e?a(e,n,t):"sync"==e?b(n,t):n()})}},browserInfo.android?requirejs(["cordova/android/iap"],f):requirejs(["cordova/iap"],f)}();