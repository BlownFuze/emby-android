define([],function(){function e(e){for(var r=new ArrayBuffer(2*e.length),o=new Uint16Array(r),t=0,n=e.length;n>t;t++)o[t]=e.charCodeAt(t);return r}function r(e){return String.fromCharCode.apply(null,new Uint16Array(e))}function o(e){return null!=e&&null!=e.resultCode?e.resultCode:e}function t(e){try{chrome.sockets.udp.close(e)}catch(r){}}function n(n){function i(){d.resolveWith(null,[u]),f&&(l.sockets.udp.onReceive.removeListener(c),t(f))}function s(){Logger.log("starting udp receive timer with timeout ms: "+n),g=setTimeout(i,n)}function c(e){try{if(Logger.log("ServerDiscovery message received"),Logger.log(e),null!=e&&e.socketId==f){var o=r(e.data);Logger.log("Server discovery json: "+o);var t=JSON.parse(o);t.RemoteAddress=e.remoteAddress,e.remotePort&&(t.RemoteAddress+=":"+e.remotePort),u.push(t)}}catch(n){Logger.log("Error receiving server info: "+n)}}var d=DeferredBuilder.Deferred(),u=[],l=window.chrome;if(!l)return d.resolveWith(null,[u]),d.promise();var g,f,v=7359;return Logger.log("chrome.sockets.udp.create"),s(),l.sockets.udp.create(function(r){return r&&r.socketId?(f=r.socketId,Logger.log("chrome.sockets.udp.bind"),void l.sockets.udp.bind(r.socketId,"0.0.0.0",0,function(t){if(0!=o(t))return void Logger.log("bind fail: "+t);var n=e("who is EmbyServer?");Logger.log("chrome.sockets.udp.send"),l.sockets.udp.send(r.socketId,n,"255.255.255.255",v,function(e){0!=o(e)?Logger.log("send fail: "+e):(l.sockets.udp.onReceive.addListener(c),Logger.log("sendTo: success "+v))})})):void Logger.log("create fail")}),d.promise()}var i=DeferredBuilder.Deferred(),s=i.promise();return document.addEventListener("deviceready",function(){i.resolve()},!1),{findServers:function(e){var r=DeferredBuilder.Deferred();return s.then(function(){try{n(e).then(function(e){r.resolveWith(null,[e])},function(){r.resolveWith(null,[[]])})}catch(o){r.resolveWith(null,[[]])}}),r.promise()}}});