!function(e){function r(e){for(var r=new ArrayBuffer(2*e.length),o=new Uint16Array(r),t=0,n=e.length;n>t;t++)o[t]=e.charCodeAt(t);return r}function o(e){return String.fromCharCode.apply(null,new Uint16Array(e))}function t(e){return null!=e&&null!=e.resultCode?e.resultCode:e}function n(e){try{chrome.sockets.udp.close(e)}catch(r){}}function i(i){function s(){u.resolveWith(null,[l]),v&&(g.sockets.udp.onReceive.removeListener(d),n(v))}function c(){Logger.log("starting udp receive timer with timeout ms: "+i),f=setTimeout(s,i)}function d(e){try{if(Logger.log("ServerDiscovery message received"),Logger.log(e),null!=e&&e.socketId==v){var r=o(e.data);Logger.log("Server discovery json: "+r);var t=JSON.parse(r);t.RemoteAddress=e.remoteAddress,e.remotePort&&(t.RemoteAddress+=":"+e.remotePort),l.push(t)}}catch(n){Logger.log("Error receiving server info: "+n)}}var u=DeferredBuilder.Deferred(),l=[],g=e.chrome;if(!g)return u.resolveWith(null,[l]),u.promise();var f,v,a=7359;return Logger.log("chrome.sockets.udp.create"),c(),g.sockets.udp.create(function(e){return e&&e.socketId?(v=e.socketId,Logger.log("chrome.sockets.udp.bind"),void g.sockets.udp.bind(e.socketId,"0.0.0.0",0,function(o){if(0!=t(o))return void Logger.log("bind fail: "+o);var n=r("who is EmbyServer?");Logger.log("chrome.sockets.udp.send"),g.sockets.udp.send(e.socketId,n,"255.255.255.255",a,function(e){0!=t(e)?Logger.log("send fail: "+e):(g.sockets.udp.onReceive.addListener(d),Logger.log("sendTo: success "+a))})})):void Logger.log("create fail")}),u.promise()}e.ServerDiscovery={findServers:function(e){var r=DeferredBuilder.Deferred();return c.then(function(){try{i(e).then(function(e){r.resolveWith(null,[e])},function(){r.resolveWith(null,[[]])})}catch(o){r.resolveWith(null,[[]])}}),r.promise()}};var s=DeferredBuilder.Deferred(),c=s.promise();document.addEventListener("deviceready",function(){s.resolve()},!1)}(window);