define(["cryptojs-md5"],function(){function n(n,e){"IMG"!==n.tagName?n.style.backgroundImage="url('"+e+"')":n.setAttribute("src",e)}function e(){return i?Promise.resolve(i):new Promise(function(n){requestFileSystem(PERSISTENT,0,function(e){i=e,n(i)})})}function r(n){var e=n.indexOf("://");return-1!=e&&(n=n.substring(e+3),e=n.indexOf("/"),-1!=e&&(n=n.substring(e+1))),CryptoJS.MD5(n).toString()}function t(n){if(browserInfo.safari){var e=n.indexOf("/Documents");return-1!=e?n.substring(e):n.replace("file://","")}return n}function o(n){return browserInfo.android&&-1!=n.indexOf("tag=")&&(n+="&accept=webp"),new Promise(function(o){var i=r(n);e().then(function(e){var r=e.root.toURL()+"/emby/cache/"+i;resolveLocalFileSystemURL(r,function(n){var e=t(n.toURL());o(e)},function(){var e=new FileTransfer;e.download(n,r,function(n){var e=t(n.toURL());o(e)})})})})}var i;return{loadImage:function(e,r){return o(r).then(function(r){n(e,r)},function(){n(e,r)})}}});