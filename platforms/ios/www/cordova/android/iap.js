!function(){function e(e,t,n){s=s.filter(function(t){return t.id!=e});var r={id:e,owned:t,price:n};s.push(r),Events.trigger(IapManager,"productupdated",[r])}function t(e){var t;t="embypremieremonthly"==e?NativeIapManager.getPremiereMonthlySku():NativeIapManager.getUnlockProductSku();var n=s.filter(function(e){return e.id==t});return n.length?n[0]:null}function n(){d=!0,u()}function r(){return d}function i(e,t){return"embypremieremonthly"==e?MainActivity.purchasePremiereMonthly(t):MainActivity.purchaseUnlock()}function a(e){e===!0?u():e&&ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Appstore/Register"),data:{Parameters:JSON.stringify(e)}}).then(function(){u()},function(){u()})}function u(){NativeIapManager.getPurchaseInfos("window.IapManager.updateProduct")}function o(){var e=DeferredBuilder.Deferred(),n=[];return n.push({feature:"embypremieremonthly",buttonText:"EmbyPremiereMonthly"}),n=n.filter(function(e){return null!=t(e.feature)}).map(function(e){var n=t(e.feature);return e.buttonText=Globalize.translate(e.buttonText,n.price),e.owned=n.owned,e}),e.resolveWith(null,[n]),e.promise()}function c(e){return"playback"==e?p():new Promise(function(e){e(!1)})}function p(){return f(ConnectionManager.deviceId()).then(function(e){return e?!0:f(device.uuid).then(function(e){if(e)return!0;var t=MainActivity.getLegacyDeviceId();return t?f(t):!1})})}function f(e){var t="oldapp-"+e,n=appStorage.getItem(t);return n?new Promise(function(e){e("true"==n)}):fetch("https://mb3admin.com/admin/service/statistics/appAccess?application=AndroidV1&deviceId="+e,{method:"GET"}).then(function(e){if(404==e.status)appStorage.setItem(t,"false");else if(e.status<400)return appStorage.setItem(t,"true"),!0;return!1},function(){return!1})}var s=[],d=!1;window.IapManager={isPurchaseAvailable:r,getProductInfo:t,updateProduct:e,beginPurchase:i,onPurchaseComplete:a,getSubscriptionOptions:o,onStoreReady:n,isUnlockedOverride:c},NativeIapManager.initStore()}();