define(["dialogHelper","jQuery","paper-checkbox","paper-input","paper-item-body","paper-icon-item","paper-textarea","paper-fab"],function(e,t){function a(){return B.classList.contains("dialog")}function i(){a()&&e.close(B)}function n(e,a){function n(){require(["toast"],function(e){e(Globalize.translate("MessageItemSaved"))}),Dashboard.hideLoadingMsg(),i(!0)}ApiClient.updateItem(a).then(function(){var i=t("#selectContentType",e).val()||"";(q.ContentType||"")!=i?ApiClient.ajax({url:ApiClient.getUrl("Items/"+a.Id+"/ContentType",{ContentType:i}),type:"POST"}).then(function(){n()}):n()})}function r(e){return t(".chkAirDay:checked",e).map(function(){return this.getAttribute("data-day")}).get()}function o(e){return t("#txtAlbumArtist",e).val().trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function l(e){return t("#txtArtist",e).val().trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function s(e,a,i){var n=t(a,e).val();if(!n)return null;if(V[i]){var r=parseISO8601Date(V[i],{toLocal:!0}),o=r.toISOString().split("T");if(0==o[0].indexOf(n)){var l=o[1];n+="T"+l}}return n}function d(){Dashboard.showLoadingMsg();var e=this;try{var a={Id:V.Id,Name:t("#txtName",e).val(),OriginalTitle:t("#txtOriginalName",e).val(),ForcedSortName:t("#txtSortName",e).val(),DisplayMediaType:t("#txtDisplayMediaType",e).val(),CommunityRating:t("#txtCommunityRating",e).val(),VoteCount:t("#txtCommunityVoteCount",e).val(),HomePageUrl:t("#txtHomePageUrl",e).val(),Budget:t("#txtBudget",e).val(),Revenue:t("#txtRevenue",e).val(),CriticRating:t("#txtCriticRating",e).val(),CriticRatingSummary:t("#txtCriticRatingSummary",e).val(),IndexNumber:t("#txtIndexNumber",e).val()||null,DisplaySpecialsWithSeasons:e.querySelector("#chkDisplaySpecialsInline").checked,AbsoluteEpisodeNumber:t("#txtAbsoluteEpisodeNumber",e).val(),DvdEpisodeNumber:t("#txtDvdEpisodeNumber",e).val(),DvdSeasonNumber:t("#txtDvdSeasonNumber",e).val(),AirsBeforeSeasonNumber:t("#txtAirsBeforeSeason",e).val(),AirsAfterSeasonNumber:t("#txtAirsAfterSeason",e).val(),AirsBeforeEpisodeNumber:t("#txtAirsBeforeEpisode",e).val(),ParentIndexNumber:t("#txtParentIndexNumber",e).val()||null,DisplayOrder:t("#selectDisplayOrder",e).val(),Players:t("#txtPlayers",e).val(),Album:t("#txtAlbum",e).val(),AlbumArtist:o(e),ArtistItems:l(e),Metascore:t("#txtMetascore",e).val(),AwardSummary:t("#txtAwardSummary",e).val(),Overview:t("#txtOverview",e).val(),ShortOverview:t("#txtShortOverview",e).val(),Status:t("#selectStatus",e).val(),AirDays:r(e),AirTime:t("#txtAirTime",e).val(),Genres:c(t("#listGenres",e)),ProductionLocations:c(t("#listCountries",e)),Tags:c(t("#listTags",e)),Keywords:c(t("#listKeywords",e)),Studios:c(t("#listStudios",e)).map(function(e){return{Name:e}}),PremiereDate:s(e,"#txtPremiereDate","PremiereDate"),DateCreated:s(e,"#txtDateAdded","DateCreated"),EndDate:s(e,"#txtEndDate","EndDate"),ProductionYear:t("#txtProductionYear",e).val(),AspectRatio:t("#txtOriginalAspectRatio",e).val(),Video3DFormat:t("#select3dFormat",e).val(),OfficialRating:t("#selectOfficialRating",e).val(),CustomRating:t("#selectCustomRating",e).val(),People:V.People,LockData:e.querySelector("#chkLockData").checked,LockedFields:t(".selectLockedField",e).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-value")})};if(a.ProviderIds=t.extend({},V.ProviderIds||{}),t(".txtExternalId",e).each(function(){var e=this.getAttribute("data-providerkey");a.ProviderIds[e]=this.value}),a.PreferredMetadataLanguage=t("#selectLanguage",e).val(),a.PreferredMetadataCountryCode=t("#selectCountry",e).val(),"Person"==V.Type){var i=t("#txtPlaceOfBirth",e).val();a.ProductionLocations=i?[i]:[]}if("Series"==V.Type){var d=t("#txtSeriesRuntime",e).val();a.RunTimeTicks=d?6e8*d:null}var u=t("#txtTagline",e).val();a.Taglines=u?[u]:[],n(e,a)}catch(p){alert(p)}return!1}function u(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function c(e){return e.find(".textValue").map(function(){return t(this).text()}).get()}function p(e,a){require(["prompt"],function(i){i({label:"Value:"}).then(function(i){var n=t(e).parents(".editableListviewContainer").find(".paperList"),r=c(n);r.push(i),M(n[0],r,a)})})}function m(e){t(e).parents("paper-icon-item").remove()}function h(e,t,a){require(["components/metadataeditor/personeditor"],function(i){i.show(t).then(function(t){var i=-1==a;i&&V.People.push(t),E(e,V.People)})})}function f(e,t){var a=[];a.push({name:Globalize.translate("ButtonLocalRefresh"),id:"local",ironIcon:"refresh"}),a.push({name:Globalize.translate("ButtonAddMissingData"),id:"missing",ironIcon:"refresh"}),a.push({name:Globalize.translate("ButtonFullRefresh"),id:"full",ironIcon:"refresh"}),require(["actionsheet"],function(e){e.show({items:a,positionTo:t,callback:function(e){switch(e&&(Dashboard.showLoadingMsg(),setTimeout(function(){Dashboard.hideLoadingMsg()},5e3)),e){case"local":ApiClient.refreshItem(V.Id,{Recursive:!0,ImageRefreshMode:"None",MetadataRefreshMode:"ValidationOnly",ReplaceAllImages:!1,ReplaceAllMetadata:!1});break;case"missing":ApiClient.refreshItem(V.Id,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!1});break;case"full":ApiClient.refreshItem(V.Id,{Recursive:!0,ImageRefreshMode:"FullRefresh",MetadataRefreshMode:"FullRefresh",ReplaceAllImages:!1,ReplaceAllMetadata:!0})}}})})}function v(e,t){var a=[];a.push({name:Globalize.translate("ButtonEditImages"),id:"images",ironIcon:"photo"}),a.push({name:Globalize.translate("ButtonIdentify"),id:"identify",ironIcon:"info"}),a.push({name:Globalize.translate("ButtonRefresh"),id:"refresh",ironIcon:"refresh"}),require(["actionsheet"],function(i){i.show({items:a,positionTo:t,callback:function(a){switch(a){case"identify":LibraryBrowser.identifyItem(V.Id);break;case"refresh":f(e,t);break;case"images":LibraryBrowser.editImages(V.Id)}}})})}function b(e,t){var a=t;"LibraryChanged"===a.MessageType&&-1!=a.Data.ItemsUpdated.indexOf(V.Id)&&z(B,V.Id)}function y(){Events.on(ApiClient,"websocketmessage",b)}function g(){Events.off(ApiClient,"websocketmessage",b)}function T(e){var t=u(e.target,"btnRemoveFromEditorList");t&&m(t);var a=u(e.target,"btnAddTextItem");a&&p(a)}function x(e){t(".btnCancel",e).on("click",function(){i(!1)}),e.querySelector(".btnMore").addEventListener("click",function(t){v(e,t.target)}),e.querySelector(".btnHeaderSave").addEventListener("click",function(){e.querySelector(".btnSave").click()}),e.querySelector("#chkLockData").addEventListener("click",function(e){e.target.checked?t(".providerSettingsContainer").hide():t(".providerSettingsContainer").show()}),e.removeEventListener("click",T),e.addEventListener("click",T),t("form",e).off("submit",d).on("submit",d),t("#btnAddPerson",e).on("click",function(){h(e,{},-1)}),a()&&y(e)}function S(e){return e?ApiClient.getItem(Dashboard.getCurrentUserId(),e):ApiClient.getRootFolder(Dashboard.getCurrentUserId())}function A(e){return e?ApiClient.getJSON(ApiClient.getUrl("Items/"+e+"/MetadataEditor")):Promise.resolve({})}function D(e,t){var a="";a+="<option value=''></option>";for(var i=0,n=t.length;n>i;i++){var r=t[i];a+="<option value='"+r.TwoLetterISORegionName+"'>"+r.DisplayName+"</option>"}e.innerHTML=a}function C(e,t){var a="";a+="<option value=''></option>";for(var i=0,n=t.length;n>i;i++){var r=t[i];a+="<option value='"+r.TwoLetterISOLanguageName+"'>"+r.DisplayName+"</option>"}e.innerHTML=a}function w(e,a){a.ContentTypeOptions.length?t("#fldContentType",e).show():t("#fldContentType",e).hide();var i=a.ContentTypeOptions.map(function(e){return'<option value="'+e.Value+'">'+e.Name+"</option>"}).join("");t("#selectContentType",e).html(i).val(a.ContentType||"")}function I(){var e=this.getAttribute("data-formatstring"),a=this.getAttribute("data-buttonclass");this.value?t("."+a).attr("href",e.replace("{0}",this.value)):t("."+a).attr("href","#")}function P(e,a,i){for(var n="",r=a.ProviderIds||{},o=0,l=i.length;l>o;o++){var s=i[o],d="txt1"+s.Key,u="btnOpen1"+s.Key,c=s.UrlFormatString||"",p=Globalize.translate("LabelDynamicExternalId").replace("{0}",s.Name);n+="<div>";var m=r[s.Key]||"";n+='<paper-input style="display:inline-block;width:80%;" class="txtExternalId" value="'+m+'" data-providerkey="'+s.Key+'" data-formatstring="'+c+'" data-buttonclass="'+u+'" id="'+d+'" label="'+p+'"></paper-input>',c&&(n+='<a class="clearLink '+u+'" href="#" target="_blank" data-role="none" style="float: none; width: 1.75em"><paper-icon-button icon="open-in-browser"></paper-icon-button></a>'),n+="</div>"}var h=t(".externalIds",e).html(n);t(".txtExternalId",h).on("change",I).trigger("change")}function R(e,a){a.Path&&"Remote"!=a.LocationType?t("#fldPath",e).show():t("#fldPath",e).hide(),"Series"==a.Type||"Movie"==a.Type||"Trailer"==a.Type?t("#fldOriginalName",e).show():t("#fldOriginalName",e).hide(),"Series"==a.Type?t("#fldSeriesRuntime",e).show():t("#fldSeriesRuntime",e).hide(),"Series"==a.Type||"Person"==a.Type?t("#fldEndDate",e).show():t("#fldEndDate",e).hide(),"Movie"==a.Type||"Game"==a.MediaType||"Trailer"==a.MediaType||"MusicVideo"==a.Type?(t("#fldBudget",e).show(),t("#fldRevenue",e).show()):(t("#fldBudget",e).hide(),t("#fldRevenue",e).hide()),"MusicAlbum"==a.Type?t("#albumAssociationMessage",e).show():t("#albumAssociationMessage",e).hide(),"Game"==a.MediaType?t("#fldPlayers",e).show():t("#fldPlayers",e).hide(),"Movie"==a.Type||"Trailer"==a.Type?(t("#fldCriticRating",e).show(),t("#fldCriticRatingSummary",e).show()):(t("#fldCriticRating",e).hide(),t("#fldCriticRatingSummary",e).hide()),"Movie"==a.Type?t("#fldAwardSummary",e).show():t("#fldAwardSummary",e).hide(),"Movie"==a.Type||"Trailer"==a.Type?t("#fldMetascore",e).show():t("#fldMetascore",e).hide(),"Series"==a.Type?(t("#fldStatus",e).show(),t("#fldAirDays",e).show(),t("#fldAirTime",e).show()):(t("#fldStatus",e).hide(),t("#fldAirDays",e).hide(),t("#fldAirTime",e).hide()),"Video"==a.MediaType&&"TvChannel"!=a.Type?t("#fld3dFormat",e).show():t("#fld3dFormat",e).hide(),"Audio"==a.Type?t("#fldAlbumArtist",e).show():t("#fldAlbumArtist",e).hide(),"Audio"==a.Type||"MusicVideo"==a.Type?(t("#fldArtist",e).show(),t("#fldAlbum",e).show()):(t("#fldArtist",e).hide(),t("#fldAlbum",e).hide()),"Episode"==a.Type?t("#collapsibleDvdEpisodeInfo",e).show():t("#collapsibleDvdEpisodeInfo",e).hide(),"Episode"==a.Type&&0==a.ParentIndexNumber?t("#collapsibleSpecialEpisodeInfo",e).show():t("#collapsibleSpecialEpisodeInfo",e).hide(),"Person"==a.Type||"Genre"==a.Type||"Studio"==a.Type||"GameGenre"==a.Type||"MusicGenre"==a.Type||"TvChannel"==a.Type?(t("#fldCommunityRating",e).hide(),t("#fldCommunityVoteCount",e).hide(),t("#genresCollapsible",e).hide(),t("#peopleCollapsible",e).hide(),t("#studiosCollapsible",e).hide(),"TvChannel"==a.Type?t("#fldOfficialRating",e).show():t("#fldOfficialRating",e).hide(),t("#fldCustomRating",e).hide()):(t("#fldCommunityRating",e).show(),t("#fldCommunityVoteCount",e).show(),t("#genresCollapsible",e).show(),t("#peopleCollapsible",e).show(),t("#studiosCollapsible",e).show(),t("#fldOfficialRating",e).show(),t("#fldCustomRating",e).show()),"Movie"==a.Type||"Trailer"==a.Type||"MusicArtist"==a.Type?t("#countriesCollapsible",e).show():t("#countriesCollapsible",e).hide(),"TvChannel"==a.Type?(t("#tagsCollapsible",e).hide(),t("#metadataSettingsCollapsible",e).hide(),t("#fldPremiereDate",e).hide(),t("#fldSortName",e).hide(),t("#fldDateAdded",e).hide(),t("#fldYear",e).hide()):(t("#tagsCollapsible",e).show(),t("#metadataSettingsCollapsible",e).show(),t("#fldPremiereDate",e).show(),t("#fldSortName",e).show(),t("#fldDateAdded",e).show(),t("#fldYear",e).show()),Dashboard.getCurrentUser().then(function(i){-1!=LibraryBrowser.getMoreCommands(a,i).indexOf("identify")?t("#btnIdentify",e).show():t("#btnIdentify",e).hide()}),"Movie"==a.Type||"Trailer"==a.Type||"BoxSet"==a.Type?t("#keywordsCollapsible",e).show():t("#keywordsCollapsible",e).hide(),"Video"==a.MediaType&&"TvChannel"!=a.Type?t("#fldSourceType",e).show():t("#fldSourceType",e).hide(),"Person"==a.Type?(e.querySelector("#txtProductionYear").label=Globalize.translate("LabelBirthYear"),e.querySelector("#txtPremiereDate").label=Globalize.translate("LabelBirthDate"),e.querySelector("#txtEndDate").label=Globalize.translate("LabelDeathDate"),t("#fldPlaceOfBirth",e).show()):(e.querySelector("#txtProductionYear").label=Globalize.translate("LabelYear"),e.querySelector("#txtPremiereDate").label=Globalize.translate("LabelReleaseDate"),e.querySelector("#txtEndDate").label=Globalize.translate("LabelEndDate"),t("#fldPlaceOfBirth",e).hide()),"Video"==a.MediaType&&"TvChannel"!=a.Type?t("#fldOriginalAspectRatio",e).show():t("#fldOriginalAspectRatio",e).hide(),"Audio"==a.Type||"Episode"==a.Type||"Season"==a.Type?(t("#fldIndexNumber",e).show(),e.querySelector("#txtIndexNumber").label=Globalize.translate("Episode"==a.Type?"LabelEpisodeNumber":"Season"==a.Type?"LabelSeasonNumber":"Audio"==a.Type?"LabelTrackNumber":"LabelNumber")):t("#fldIndexNumber",e).hide(),"Audio"==a.Type||"Episode"==a.Type?(t("#fldParentIndexNumber",e).show(),e.querySelector("#txtParentIndexNumber").label=Globalize.translate("Episode"==a.Type?"LabelSeasonNumber":"Audio"==a.Type?"LabelDiscNumber":"LabelParentNumber")):t("#fldParentIndexNumber",e).hide(),"Series"==a.Type?t("#fldDisplaySpecialsInline",e).show():t("#fldDisplaySpecialsInline",e).hide(),"BoxSet"==a.Type?(t("#fldDisplayOrder",e).show(),t("#labelDisplayOrder",e).html(Globalize.translate("LabelTitleDisplayOrder")),t("#selectDisplayOrder",e).html('<option value="SortName">'+Globalize.translate("OptionSortName")+'</option><option value="PremiereDate">'+Globalize.translate("OptionReleaseDate")+"</option>")):(t("#selectDisplayOrder",e).html(""),t("#fldDisplayOrder",e).hide());var i=t(".fldDisplaySetting",e);i.filter(function(e){return"none"!=i[e].style.display}).length?t("#collapsibleDisplaySettings",e).show():t("#collapsibleDisplaySettings",e).hide()}function L(e,a,i){var n=t("#selectOfficialRating",e);N(i,n,a.OfficialRating),n.val(a.OfficialRating||""),n=t("#selectCustomRating",e),N(i,n,a.CustomRating),n.val(a.CustomRating||"");var r=t("#selectStatus",e);O(r),r.val(a.Status||""),t("#select3dFormat",e).val(a.Video3DFormat||""),t(".chkAirDay",e).each(function(){this.checked=-1!=(a.AirDays||[]).indexOf(this.getAttribute("data-day"))}),M(t("#listCountries",e)[0],a.ProductionLocations||[]),M(t("#listGenres",e)[0],a.Genres),E(e,a.People||[]),M(t("#listStudios",e)[0],(a.Studios||[]).map(function(e){return e.Name||""})),M(t("#listTags",e)[0],a.Tags),M(t("#listKeywords",e)[0],a.Keywords);var o=a.LockData||!1,l=e.querySelector("#chkLockData");l.checked=o,l.checked?t(".providerSettingsContainer",e).hide():t(".providerSettingsContainer",e).show(),G(e,a,a.LockedFields),e.querySelector("#chkDisplaySpecialsInline").checked=a.DisplaySpecialsWithSeasons||!1,t("#txtPath",e).val(a.Path||""),t("#txtName",e).val(a.Name||""),t("#txtOriginalName",e).val(a.OriginalTitle||""),e.querySelector("#txtOverview").value=a.Overview||"",t("#txtShortOverview",e).val(a.ShortOverview||""),t("#txtTagline",e).val(a.Taglines&&a.Taglines.length?a.Taglines[0]:""),t("#txtSortName",e).val(a.ForcedSortName||""),t("#txtDisplayMediaType",e).val(a.DisplayMediaType||""),t("#txtCommunityRating",e).val(a.CommunityRating||""),t("#txtCommunityVoteCount",e).val(a.VoteCount||""),t("#txtHomePageUrl",e).val(a.HomePageUrl||""),t("#txtAwardSummary",e).val(a.AwardSummary||""),t("#txtMetascore",e).val(a.Metascore||""),t("#txtBudget",e).val(a.Budget||""),t("#txtRevenue",e).val(a.Revenue||""),t("#txtCriticRating",e).val(a.CriticRating||""),t("#txtCriticRatingSummary",e).val(a.CriticRatingSummary||""),t("#txtIndexNumber",e).val("IndexNumber"in a?a.IndexNumber:""),t("#txtParentIndexNumber",e).val("ParentIndexNumber"in a?a.ParentIndexNumber:""),t("#txtPlayers",e).val(a.Players||""),t("#txtAbsoluteEpisodeNumber",e).val("AbsoluteEpisodeNumber"in a?a.AbsoluteEpisodeNumber:""),t("#txtDvdEpisodeNumber",e).val("DvdEpisodeNumber"in a?a.DvdEpisodeNumber:""),t("#txtDvdSeasonNumber",e).val("DvdSeasonNumber"in a?a.DvdSeasonNumber:""),t("#txtAirsBeforeSeason",e).val("AirsBeforeSeasonNumber"in a?a.AirsBeforeSeasonNumber:""),t("#txtAirsAfterSeason",e).val("AirsAfterSeasonNumber"in a?a.AirsAfterSeasonNumber:""),t("#txtAirsBeforeEpisode",e).val("AirsBeforeEpisodeNumber"in a?a.AirsBeforeEpisodeNumber:""),t("#txtAlbum",e).val(a.Album||""),t("#txtAlbumArtist",e).val((a.AlbumArtists||[]).map(function(e){return e.Name}).join(";")),t("#selectDisplayOrder",e).val(a.DisplayOrder),t("#txtArtist",e).val((a.ArtistItems||[]).map(function(e){return e.Name}).join(";"));var s;if(a.DateCreated)try{s=parseISO8601Date(a.DateCreated,{toLocal:!0}),t("#txtDateAdded",e).val(s.toISOString().slice(0,10))}catch(d){t("#txtDateAdded",e).val("")}else t("#txtDateAdded",e).val("");if(a.PremiereDate)try{s=parseISO8601Date(a.PremiereDate,{toLocal:!0}),t("#txtPremiereDate",e).val(s.toISOString().slice(0,10))}catch(d){t("#txtPremiereDate",e).val("")}else t("#txtPremiereDate",e).val("");if(a.EndDate)try{s=parseISO8601Date(a.EndDate,{toLocal:!0}),t("#txtEndDate",e).val(s.toISOString().slice(0,10))}catch(d){t("#txtEndDate",e).val("")}else t("#txtEndDate",e).val("");t("#txtProductionYear",e).val(a.ProductionYear||""),t("#txtAirTime",e).val(a.AirTime||"");var u=a.ProductionLocations&&a.ProductionLocations.length?a.ProductionLocations[0]:"";if(t("#txtPlaceOfBirth",e).val(u),t("#txtOriginalAspectRatio",e).val(a.AspectRatio||""),t("#selectLanguage",e).val(a.PreferredMetadataLanguage||""),t("#selectCountry",e).val(a.PreferredMetadataCountryCode||""),a.RunTimeTicks){var c=a.RunTimeTicks/6e8;t("#txtSeriesRuntime",e).val(Math.round(c))}else t("#txtSeriesRuntime",e).val("")}function N(e,t,a){var i="";i+="<option value=''></option>";var n,r,o,l=[],s=!1;for(n=0,r=e.length;r>n;n++)o=e[n],l.push({Name:o.Name,Value:o.Name}),o.Name==a&&(s=!0);for(a&&!s&&l.push({Name:a,Value:a}),n=0,r=l.length;r>n;n++)o=l[n],i+="<option value='"+o.Value+"'>"+o.Name+"</option>";t.html(i)}function O(e){var t="";t+="<option value=''></option>",t+="<option value='Continuing'>"+Globalize.translate("OptionContinuing")+"</option>",t+="<option value='Ended'>"+Globalize.translate("OptionEnded")+"</option>",e.html(t)}function M(e,t,a){t=t||[],"undefined"==typeof a?t.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}):t=a(t);for(var i="",n=0;n<t.length;n++)i+="<paper-icon-item>",i+='<paper-fab mini style="background-color:#444;" icon="live-tv" item-icon></paper-fab>',i+="<paper-item-body>",i+='<div class="textValue">',i+=t[n],i+="</div>",i+="</paper-item-body>",i+='<paper-icon-button icon="delete" data-index="'+n+'" class="btnRemoveFromEditorList"></paper-icon-button>',i+="</paper-icon-item>";e.innerHTML=i}function E(e,a){for(var i="",n="",r=e.querySelector("#peopleList"),o=0,l=a.length;l>o;o++){var s=a[o];n+="<paper-icon-item>",n+='<paper-fab class="btnEditPerson" data-index="'+o+'" mini style="background-color:#444;" icon="person" item-icon></paper-fab>',n+="<paper-item-body>",n+='<a class="btnEditPerson clearLink" href="#" data-index="'+o+'">',n+='<div class="textValue">',n+=s.Name||"",n+="</div>",s.Role&&s.Role!=i&&(n+="<div secondary>"+s.Role+"</div>"),n+="</a>",n+="</paper-item-body>",n+='<paper-icon-button icon="delete" data-index="'+o+'" class="btnDeletePerson"></paper-icon-button>',n+="</paper-icon-item>"}r.innerHTML=n,t(".btnDeletePerson",r).on("click",function(){var t=parseInt(this.getAttribute("data-index"));V.People.splice(t,1),E(e,V.People)}),t(".btnEditPerson",r).on("click",function(){var t=parseInt(this.getAttribute("data-index"));h(e,V.People[t],t)})}function k(e,t){for(var a="",i=0;i<e.length;i++){var n=e[i],r=n.name,o=n.value||n.name,l=-1==t.indexOf(o)?" checked":"";a+='<paper-checkbox class="selectLockedField" data-value="'+o+'" style="display:block;margin:1em 0;"'+l+">"+r+"</paper-checkbox>"}return a}function G(e,a,i){var n=t(".providerSettingsContainer",e);i=i||new Array;var r=[{name:Globalize.translate("OptionName"),value:"Name"},{name:Globalize.translate("OptionOverview"),value:"Overview"},{name:Globalize.translate("OptionGenres"),value:"Genres"},{name:Globalize.translate("OptionParentalRating"),value:"OfficialRating"},{name:Globalize.translate("OptionPeople"),value:"Cast"}];r.push("Person"==a.Type?{name:Globalize.translate("OptionBirthLocation"),value:"ProductionLocations"}:{name:Globalize.translate("OptionProductionLocations"),value:"ProductionLocations"}),"Series"==a.Type&&r.push({name:Globalize.translate("OptionRuntime"),value:"Runtime"}),r.push({name:Globalize.translate("OptionStudios"),value:"Studios"}),r.push({name:Globalize.translate("OptionTags"),value:"Tags"}),r.push({name:Globalize.translate("OptionKeywords"),value:"Keywords"}),r.push({name:Globalize.translate("OptionImages"),value:"Images"}),r.push({name:Globalize.translate("OptionBackdrops"),value:"Backdrops"}),"Game"==a.Type&&r.push({name:Globalize.translate("OptionScreenshots"),value:"Screenshots"});var o="";o+="<h1>"+Globalize.translate("HeaderEnabledFields")+"</h1>",o+="<p>"+Globalize.translate("HeaderEnabledFieldsHelp")+"</p>",o+=k(r,i),n.html(o)}function z(e,a){Dashboard.showLoadingMsg(),Promise.all([S(a),A(a)]).then(function(a){var i=a[0];q=a[1],V=i;var n=q.Cultures,r=q.Countries;w(e,q),P(e,i,q.ExternalIdInfos),C(e.querySelector("#selectLanguage"),n),D(e.querySelector("#selectCountry"),r),LibraryBrowser.renderName(i,t(".itemName",e),!0),R(e,i),L(e,i,q.ParentalRatingOptions),"Photo"==i.MediaType?t("#btnEditImages",e).hide():t("#btnEditImages",e).show(),"Video"==i.MediaType&&"Episode"!=i.Type?t("#fldShortOverview",e).show():t("#fldShortOverview",e).hide(),"Video"==i.MediaType&&"Episode"!=i.Type?t("#fldTagline",e).show():t("#fldTagline",e).hide(),Dashboard.hideLoadingMsg()})}var B,q,V;return{show:function(t){return new Promise(function(a){Dashboard.showLoadingMsg();var i=new XMLHttpRequest;i.open("GET","components/metadataeditor/metadataeditor.template.html",!0),i.onload=function(){var i=this.response,n=e.createDialog({removeOnClose:!0,size:"medium"});n.classList.add("ui-body-b"),n.classList.add("background-theme-b"),n.classList.add("formDialog");var r="";r+=Globalize.translateDocument(i),n.innerHTML=r,document.body.appendChild(n),e.open(n),n.addEventListener("close",function(){g(n),a()}),B=n,x(n),z(n,t)},i.send()})},embed:function(e,t){return new Promise(function(){Dashboard.showLoadingMsg();var a=new XMLHttpRequest;a.open("GET","components/metadataeditor/metadataeditor.template.html",!0),a.onload=function(){var a=this.response;e.innerHTML=Globalize.translateDocument(a),e.querySelector(".btnCancel").classList.add("hide"),B=e,x(e),z(e,t)},a.send()})}}});