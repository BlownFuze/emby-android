define(["paperdialoghelper","paper-checkbox","paper-input","paper-button"],function(e){function t(e){Dashboard.hideLoadingMsg(),Dashboard.alert({title:Globalize.translate("AutoOrganizeError"),message:Globalize.translate("ErrorOrganizingFileWithErrorCode",e.getResponseHeader("X-Application-Error-Code"))})}function n(e,n){$(".inputFile",e).html(n.OriginalFileName),$("#txtSeason",e).val(n.ExtractedSeasonNumber),$("#txtEpisode",e).val(n.ExtractedEpisodeNumber),$("#txtEndingEpisode",e).val(n.ExtractedEndingEpisodeNumber),$("#chkRememberCorrection",e).val(!1),$("#hfResultId",e).val(n.Id),ApiClient.getItems(null,{recursive:!0,includeItemTypes:"Series",sortBy:"SortName"}).then(function(t){var n=t.Items.map(function(e){return'<option value="'+e.Id+'">'+e.Name+"</option>"}).join("");n='<option value=""></option>'+n,$("#selectSeries",e).html(n)},t)}function o(n){Dashboard.showLoadingMsg();var o=$("#hfResultId",n).val(),i={SeriesId:$("#selectSeries",n).val(),SeasonNumber:$("#txtSeason",n).val(),EpisodeNumber:$("#txtEpisode",n).val(),EndingEpisodeNumber:$("#txtEndingEpisode",n).val(),RememberCorrection:$("#chkRememberCorrection",n).checked()};ApiClient.performEpisodeOrganization(o,i).then(function(){Dashboard.hideLoadingMsg(),n.submitted=!0,e.close(n)},t)}return{show:function(t){return new Promise(function(i,r){var a=new XMLHttpRequest;a.open("GET","components/fileorganizer/fileorganizer.template.html",!0),a.onload=function(){var a=this.response,l=e.createDialog({removeOnClose:!0,size:"small"});l.classList.add("ui-body-a"),l.classList.add("background-theme-a"),l.classList.add("formDialog");var s="";s+=Globalize.translateDocument(a),l.innerHTML=s,document.body.appendChild(l),l.querySelector(".dialogHeaderTitle").innerHTML=Globalize.translate("FileOrganizeManually"),e.open(l),l.addEventListener("iron-overlay-closed",function(){l.submitted?i():r()}),l.querySelector(".btnCancel").addEventListener("click",function(){e.close(l)}),l.querySelector("form").addEventListener("submit",function(e){return o(l),e.preventDefault(),!1}),n(l,t)},a.send()})}}});