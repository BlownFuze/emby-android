define(["jQuery","registrationservices","paper-checkbox","emby-input","listViewStyle","paper-icon-button-light"],function(e,t){return function(r,i,n){function s(e,t){if(e&&t){var r=e.ListingProviders.filter(function(e){return e.Id==t})[0];return r?Promise.resolve(r):s()}return ApiClient.getJSON(ApiClient.getUrl("LiveTv/ListingProviders/Default"))}function o(){Dashboard.showLoadingMsg(),ApiClient.getNamedConfiguration("livetv").then(function(e){s(e,i).then(function(t){r.querySelector(".txtPath").value=t.Path||"",r.querySelector(".txtKids").value=(t.KidsCategories||[]).join("|"),r.querySelector(".txtNews").value=(t.NewsCategories||[]).join("|"),r.querySelector(".txtSports").value=(t.SportsCategories||[]).join("|"),r.querySelector(".txtMovies").value=(t.MovieCategories||[]).join("|"),r.querySelector(".chkAllTuners").checked=t.EnableAllTuners,r.querySelector(".chkAllTuners").checked?r.querySelector(".selectTunersSection").classList.add("hide"):r.querySelector(".selectTunersSection").classList.remove("hide"),u(r,t,e.TunerHosts),Dashboard.hideLoadingMsg()})})}function l(e){var t=e.value;return t?t.split("|"):[]}function a(){Dashboard.showLoadingMsg();var t=i;ApiClient.getNamedConfiguration("livetv").then(function(i){var s=i.ListingProviders.filter(function(e){return e.Id==t})[0]||{};s.Type="xmltv",s.Path=r.querySelector(".txtPath").value,s.MovieCategories=l(r.querySelector(".txtMovies")),s.KidsCategories=l(r.querySelector(".txtKids")),s.NewsCategories=l(r.querySelector(".txtNews")),s.SportsCategories=l(r.querySelector(".txtSports")),s.EnableAllTuners=r.querySelector(".chkAllTuners").checked,s.EnabledTuners=s.EnableAllTuners?[]:e(".chkTuner",r).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-id")}),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("LiveTv/ListingProviders",{ValidateListings:!0}),data:JSON.stringify(s),contentType:"application/json"}).then(function(){Dashboard.hideLoadingMsg(),n.showConfirmation!==!1&&Dashboard.processServerConfigurationUpdateResult(),Events.trigger(h,"submitted")},function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("ErrorAddingListingsToSchedulesDirect")})})})}function c(e){switch(e=e.toLowerCase()){case"m3u":return"M3U Playlist";case"hdhomerun":return"HDHomerun";case"satip":return"DVB";default:return"Unknown"}}function u(e,t,r){for(var i="",n=0,s=r.length;s>n;n++){var o=r[n];i+='<div class="listItem">';var l=t.EnableAllTuners||[],a=t.EnableAllTuners||-1!=l.indexOf(o.Id),u=a?" checked":"";i+='<paper-checkbox data-id="'+o.Id+'" class="chkTuner" item-icon '+u+"></paper-checkbox>",i+='<div class="listItemBody two-line">',i+='<div class="listItemBodyText">',i+=o.FriendlyName||c(o.Type),i+="</div>",i+='<div class="listItemBodyText secondary">',i+=o.Url,i+="</div>",i+="</div>",i+="</div>"}e.querySelector(".tunerList").innerHTML=i}function d(t){var r=e(t.target).parents(".xmltvForm")[0];require(["directorybrowser"],function(e){var t=new e;t.show({includeFiles:!0,callback:function(e){if(e){var i=r.querySelector(".txtPath");i.value=e,i.focus()}t.close()}})})}var h=this;h.submit=function(){r.querySelector(".btnSubmitListings").click()},h.init=function(){n=n||{},n.showCancelButton!==!1?r.querySelector(".btnCancel").classList.remove("hide"):r.querySelector(".btnCancel").classList.add("hide"),n.showSubmitButton!==!1?r.querySelector(".btnSubmitListings").classList.remove("hide"):r.querySelector(".btnSubmitListings").classList.add("hide"),r.querySelector(".premiereHelp").innerHTML=Globalize.translate("XmlTvPremiere",24),e("form",r).on("submit",function(){return a(),!1}),r.querySelector("#btnSelectPath").addEventListener("click",d),r.querySelector(".lnkPremiere").addEventListener("click",function(e){t.showPremiereInfo(),e.preventDefault()}),r.querySelector(".chkAllTuners").addEventListener("change",function(e){e.target.checked?r.querySelector(".selectTunersSection").classList.add("hide"):r.querySelector(".selectTunersSection").classList.remove("hide")}),o()}}});