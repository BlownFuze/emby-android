define(["dialogHelper","jQuery","components/libraryoptionseditor/libraryoptionseditor","emby-input","emby-select","paper-icon-button-light","listViewStyle","formDialogStyle"],function(e,t,r){function i(){if(0==h.length)return require(["alert"],function(e){e({text:Globalize.translate("PleaseAddAtLeastOneFolder"),type:"error"})}),!1;var i=this,n=t(i).parents(".dialog")[0],o=t("#txtValue",i).val(),l=t("#selectCollectionType",i).val();"mixed"==l&&(l=null);var a=r.getLibraryOptions(n.querySelector(".libraryOptions"));return ApiClient.addVirtualFolder(o,l,y.refresh,h,a).then(function(){v=!0,e.close(n)},function(){require(["toast"],function(e){e(Globalize.translate("ErrorAddingMediaPathToVirtualFolder"))})}),!1}function n(e){return e.filter(function(e){return e.isSelectable!==!1}).map(function(e){return'<option value="'+e.value+'">'+e.name+"</option>"}).join("")}function o(e,o){t("#selectCollectionType",e).html(n(o)).val("").on("change",function(){var e=this.value,i=t(this).parents(".dialog")[0];if(r.setContentType(i.querySelector(".libraryOptions"),"mixed"==e?"":e),e?i.querySelector(".libraryOptions").classList.remove("hide"):i.querySelector(".libraryOptions").classList.add("hide"),"mixed"!=e){var n=this.selectedIndex;if(-1!=n){var l=this.options[n].innerHTML.replace("*","").replace("&amp;","&");t("#txtValue",i).val(l);var a=o.filter(function(t){return t.value==e})[0];t(".collectionTypeFieldDescription",i).html(a.message||"")}}}),t(".btnAddFolder",e).on("click",l),t("form",e).off("submit",i).on("submit",i)}function l(){var e=t(this).parents(".dlg-librarycreator")[0];require(["directorybrowser"],function(t){var r=new t;r.show({callback:function(t){t&&c(e,t),r.close()}})})}function a(e,t){var r="";return r+='<div class="listItem lnkPath">',r+='<i class="listItemIcon md-icon">folder</i>',r+='<div class="listItemBody">',r+='<div class="listItemBodyText">'+e+"</div>",r+="</div>",r+='<button is="paper-icon-button-light"" class="listItemButton btnRemovePath" data-index="'+t+'"><i class="md-icon">remove_circle</i></button>',r+="</div>"}function s(e){var r=h.map(a).join(""),i=e.querySelector(".folderList");i.innerHTML=r,r?i.classList.remove("hide"):i.classList.add("hide"),t(e.querySelectorAll(".btnRemovePath")).on("click",d)}function c(e,t){0==h.filter(function(e){return e.toLowerCase()==t.toLowerCase()}).length&&(h.push(t),s(e))}function d(){var e=this,r=parseInt(e.getAttribute("data-index")),i=h[r];h=h.filter(function(e){return e.toLowerCase()!=i.toLowerCase()});var n=t(this).parents(".dlg-librarycreator")[0];s(n)}function u(){Dashboard.hideLoadingMsg(),m.resolveWith(null,[v])}function p(e){r.embed(e.querySelector(".libraryOptions")).then(function(){t("#selectCollectionType",e).trigger("change")})}function f(){var t=this;t.show=function(t){var r=jQuery.Deferred();y=t,m=r,v=!1;var i=new XMLHttpRequest;return i.open("GET","components/medialibrarycreator/medialibrarycreator.template.html",!0),i.onload=function(){var r=this.response,i=e.createDialog({size:"small",modal:!1,removeOnClose:!0});i.classList.add("ui-body-a"),i.classList.add("background-theme-a"),i.classList.add("dlg-librarycreator"),i.innerHTML=Globalize.translateDocument(r),document.body.appendChild(i),o(i,t.collectionTypeOptions),i.addEventListener("close",u),e.open(i),i.querySelector(".btnCancel").addEventListener("click",function(){e.close(i)}),h=[],s(i),p(i)},i.send(),r.promise()}}var m,v,y,h=[];return f});