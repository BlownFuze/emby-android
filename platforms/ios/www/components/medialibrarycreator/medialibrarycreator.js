define(["paperdialoghelper","paper-dialog","paper-input","paper-fab","paper-item-body","paper-icon-item"],function(e){function t(){if(0==m.length)return Dashboard.alert({message:Globalize.translate("PleaseAddAtLeastOneFolder")}),!1;var t=this,a=$(t).parents("paper-dialog")[0],n=$("#txtValue",t).val(),i=$("#selectCollectionType",t).val();return"mixed"==i&&(i=null),ApiClient.addVirtualFolder(n,i,f.refresh,m).then(function(){u=!0,e.close(a)},function(){Dashboard.alert(Globalize.translate("ErrorAddingMediaPathToVirtualFolder"))}),!1}function a(e){return e.filter(function(e){return e.isSelectable!==!1}).map(function(e){return'<option value="'+e.value+'">'+e.name+"</option>"}).join("")}function n(e,n){$("#selectCollectionType",e).html(a(n)).val("").on("change",function(){if("mixed"!=this.value){var e=$(this).parents("paper-dialog")[0],t=this.selectedIndex;if(-1!=t){var a=this.options[t].innerHTML.replace("*","").replace("&amp;","&"),i=this.value;$("#txtValue",e).val(a);var r=n.filter(function(e){return e.value==i})[0];$(".collectionTypeFieldDescription",e).html(r.message||"")}}}),$(".btnAddFolder",e).on("click",i),$("form",e).off("submit",t).on("submit",t)}function i(){var e=$(this).parents(".editorContent")[0];require(["directorybrowser"],function(t){var a=new t;a.show({callback:function(t){t&&l(e,t),a.close()}})})}function r(e,t){var a="";return a+='<paper-icon-item role="menuitem" class="lnkPath">',a+='<paper-fab mini style="background:#52B54B;" icon="folder" item-icon></paper-fab>',a+="<paper-item-body>",a+=e,a+="</paper-item-body>",a+='<paper-icon-button icon="remove-circle" class="btnRemovePath" data-index="'+t+'"></paper-icon-button>',a+="</paper-icon-item>"}function o(e){var t=m.map(r).join(""),a=e.querySelector(".folderList");a.innerHTML=t,t?a.classList.remove("hide"):a.classList.add("hide"),$(e.querySelectorAll(".btnRemovePath")).on("click",s)}function l(e,t){0==m.filter(function(e){return e.toLowerCase()==t.toLowerCase()}).length&&(m.push(t),o(e))}function s(){var e=this,t=parseInt(e.getAttribute("data-index")),a=m[t];m=m.filter(function(e){return e.toLowerCase()!=a.toLowerCase()});var n=$(this).parents(".editorContent")[0];o(n)}function c(){$(this).remove(),Dashboard.hideLoadingMsg(),p.resolveWith(null,[u])}function d(){var t=this;t.show=function(t){var a=jQuery.Deferred();f=t,p=a,u=!1;var i=new XMLHttpRequest;return i.open("GET","components/medialibrarycreator/medialibrarycreator.template.html",!0),i.onload=function(){var a=this.response,i=e.createDialog({size:"small",modal:!1});i.classList.add("ui-body-a"),i.classList.add("background-theme-a"),i.classList.add("popupEditor");var r="";r+='<h2 class="dialogHeader">',r+='<paper-fab icon="arrow-back" mini class="btnCloseDialog" tabindex="-1"></paper-fab>';var l=Globalize.translate("ButtonAddMediaLibrary");r+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+l+"</div>",r+="</h2>",r+='<div class="editorContent" style="max-width:800px;margin:auto;">',r+=Globalize.translateDocument(a),r+="</div>",i.innerHTML=r,document.body.appendChild(i);var s=i.querySelector(".editorContent");n(s,t.collectionTypeOptions),$(i).on("iron-overlay-closed",c),e.open(i),$(".btnCloseDialog",i).on("click",function(){e.close(i)}),m=[],o(s)},i.send(),a.promise()}}var p,u,f,m=[];return d});