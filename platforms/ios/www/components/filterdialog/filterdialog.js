define(["paperdialoghelper","events","browser","paper-checkbox","emby-collapsible","css!components/filterdialog/style","paper-radio-button","paper-radio-group"],function(e,t,i){function r(e,t,i,r,a){var n=e.querySelector(t);r.length?n.classList.remove("hide"):n.classList.add("hide");var s="";s+='<div class="paperCheckboxList">',s+=r.map(function(e){var t="",r=a(e)?" checked":"";return t+="<paper-checkbox"+r+' data-filter="'+e+'" class="'+i+'">'+e+"</paper-checkbox>"}).join(""),s+="</div>",n.querySelector(".filterOptions").innerHTML=s}function a(e,t,i){t.Tags&&(t.Tags.length=Math.min(t.Tags.length,50)),r(e,".genreFilters","chkGenreFilter",t.Genres,function(e){var t="|";return-1!=(t+(i.Genres||"")+t).indexOf(t+e+t)}),r(e,".officialRatingFilters","chkOfficialRatingFilter",t.OfficialRatings,function(e){var t="|";return-1!=(t+(i.OfficialRatings||"")+t).indexOf(t+e+t)}),r(e,".tagFilters","chkTagFilter",t.Tags,function(e){var t="|";return-1!=(t+(i.Tags||"")+t).indexOf(t+e+t)}),r(e,".yearFilters","chkYearFilter",t.Years,function(e){var t=",";return-1!=(t+(i.Years||"")+t).indexOf(t+e+t)})}function n(e,t,i){return ApiClient.getJSON(ApiClient.getUrl("Items/Filters",{UserId:t,ParentId:i.ParentId,IncludeItemTypes:i.IncludeItemTypes})).then(function(t){a(e,t,i)})}function s(e,t){var i=t.query;"livetvchannels"==t.mode?(e.querySelector(".chkFavorite").checked=1==i.IsFavorite,e.querySelector(".chkLikes").checked=1==i.IsLiked,e.querySelector(".chkDislikes").checked=1==i.IsDisliked):$(".chkStandardFilter",e).each(function(){var e=","+(i.Filters||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),$(".chkVideoTypeFilter",e).each(function(){var e=","+(i.VideoTypes||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),e.querySelector(".chk3DFilter").checked=1==i.Is3D,e.querySelector(".chkHDFilter").checked=1==i.IsHD,e.querySelector(".chkSDFilter").checked=1==i.IsHD,e.querySelector("#chkSubtitle").checked=1==i.HasSubtitles,e.querySelector("#chkTrailer").checked=1==i.HasTrailer,e.querySelector("#chkThemeSong").checked=1==i.HasThemeSong,e.querySelector("#chkThemeVideo").checked=1==i.HasThemeVideo,e.querySelector("#chkSpecialFeature").checked=1==i.HasSpecialFeature,$("#chkSpecialEpisode",e).checked(0==i.ParentIndexNumber),$("#chkMissingEpisode",e).checked(1==i.IsMissing),$("#chkFutureEpisode",e).checked(1==i.IsUnaired),e.querySelector(".playersRadioGroup").selected=null==i.MinPlayers?"all":i.MinPlayers,$(".chkStatus",e).each(function(){var e=","+(i.SeriesStatus||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),$(".chkAirDays",e).each(function(){var e=","+(i.AirDays||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)})}function c(e){t.trigger(e,"filterchange")}function l(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function o(e,t,i){var r=i.query;"livetvchannels"==i.mode?($(".chkFavorite",t).on("change",function(){r.StartIndex=0,r.IsFavorite=this.checked?!0:null,c(e)}),$(".chkLikes",t).on("change",function(){r.StartIndex=0,r.IsLiked=this.checked?!0:null,c(e)}),$(".chkDislikes",t).on("change",function(){r.StartIndex=0,r.IsDisliked=this.checked?!0:null,c(e)})):$(".chkStandardFilter",t).on("change",function(){var t=this.getAttribute("data-filter"),i=r.Filters||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),r.StartIndex=0,r.Filters=i,c(e)}),$(".chkVideoTypeFilter",t).on("change",function(){var t=this.getAttribute("data-filter"),i=r.VideoTypes||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),r.StartIndex=0,r.VideoTypes=i,c(e)}),$(".chk3DFilter",t).on("change",function(){r.StartIndex=0,r.Is3D=this.checked?!0:null,c(e)}),$(".chkHDFilter",t).on("change",function(){r.StartIndex=0,r.IsHD=this.checked?!0:null,c(e)}),$(".chkSDFilter",t).on("change",function(){r.StartIndex=0,r.IsHD=this.checked?!1:null,c(e)}),$(".chkStatus",t).on("change",function(){var t=this.getAttribute("data-filter"),i=r.SeriesStatus||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),r.SeriesStatus=i,r.StartIndex=0,c(e)}),$(".chkAirDays",t).on("change",function(){var t=this.getAttribute("data-filter"),i=r.AirDays||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),r.AirDays=i,r.StartIndex=0,c(e)}),$("#chkTrailer",t).on("change",function(){r.StartIndex=0,r.HasTrailer=this.checked?!0:null,c(e)}),$("#chkThemeSong",t).on("change",function(){r.StartIndex=0,r.HasThemeSong=this.checked?!0:null,c(e)}),$("#chkSpecialFeature",t).on("change",function(){r.StartIndex=0,r.HasSpecialFeature=this.checked?!0:null,c(e)}),$("#chkThemeVideo",t).on("change",function(){r.StartIndex=0,r.HasThemeVideo=this.checked?!0:null,c(e)}),$("#chkMissingEpisode",t).on("change",function(){r.StartIndex=0,r.IsMissing=this.checked?!0:!1,c(e)}),$("#chkSpecialEpisode",t).on("change",function(){r.StartIndex=0,r.ParentIndexNumber=this.checked?0:null,c(e)}),$("#chkFutureEpisode",t).on("change",function(){r.StartIndex=0,this.checked?(r.IsUnaired=!0,r.IsVirtualUnaired=null):(r.IsUnaired=null,r.IsVirtualUnaired=!1),c(e)}),$("#chkSubtitle",t).on("change",function(){r.StartIndex=0,r.HasSubtitles=this.checked?!0:null,c(e)}),t.querySelector(".playersRadioGroup").addEventListener("iron-select",function(t){r.StartIndex=0;var i=t.target.selected,a="all"==i?null:i,n=r.MinPlayers!=a;r.MinPlayers=a,n&&c(e)}),t.addEventListener("change",function(t){var i=l(t.target,"chkGenreFilter");if(i){var a=i.getAttribute("data-filter"),n=r.Genres||"",s="|";return n=(s+n).replace(s+a,"").substring(1),i.checked&&(n=n?n+s+a:a),r.StartIndex=0,r.Genres=n,void c(e)}var o=l(t.target,"chkTagFilter");if(o){var a=o.getAttribute("data-filter"),n=r.Tags||"",s="|";return n=(s+n).replace(s+a,"").substring(1),o.checked&&(n=n?n+s+a:a),r.StartIndex=0,r.Tags=n,void c(e)}var d=l(t.target,"chkYearFilter");if(d){var a=d.getAttribute("data-filter"),n=r.Years||"",s=",";return n=(s+n).replace(s+a,"").substring(1),d.checked&&(n=n?n+s+a:a),r.StartIndex=0,r.Years=n,void c(e)}var h=l(t.target,"chkOfficialRatingFilter");if(h){var a=h.getAttribute("data-filter"),n=r.OfficialRatings||"",s="|";return n=(s+n).replace(s+a,"").substring(1),h.checked&&(n=n?n+s+a:a),r.StartIndex=0,r.OfficialRatings=n,void c(e)}})}function d(e,t){("livetvchannels"==t.mode||"albums"==t.mode||"artists"==t.mode||"albumartists"==t.mode||"songs"==t.mode)&&u(e,"videoStandard"),f(t.mode)&&(e.querySelector(".genreFilters").classList.remove("hide"),e.querySelector(".officialRatingFilters").classList.remove("hide"),e.querySelector(".tagFilters").classList.remove("hide"),e.querySelector(".yearFilters").classList.remove("hide")),("movies"==t.mode||"episodes"==t.mode)&&e.querySelector(".videoTypeFilters").classList.remove("hide"),"games"==t.mode&&e.querySelector(".players").classList.remove("hide"),("movies"==t.mode||"series"==t.mode||"games"==t.mode||"episodes"==t.mode)&&e.querySelector(".features").classList.remove("hide"),"series"==t.mode&&(e.querySelector(".airdays").classList.remove("hide"),e.querySelector(".seriesStatus").classList.remove("hide")),"episodes"==t.mode&&h(e,"episodeFilter")}function h(e,t){for(var i=e.querySelectorAll("."+t),r=0,a=i.length;a>r;r++)i[r].classList.remove("hide")}function u(e,t){for(var i=e.querySelectorAll("."+t),r=0,a=i.length;a>r;r++)i[r].classList.add("hide")}function f(e){return"movies"==e||"games"==e||"series"==e||"albums"==e||"albumartists"==e||"artists"==e||"songs"==e||"episodes"==e}return function(t){var r=this;r.show=function(){return new Promise(function(a){var c=new XMLHttpRequest;c.open("GET","components/filterdialog/filterdialog.template.html",!0),c.onload=function(){var c=this.response,l=e.createDialog({removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:200,autoFocus:!1});l.classList.add("ui-body-a"),l.classList.add("background-theme-a"),l.classList.add("formDialog"),l.classList.add("filterDialog"),l.innerHTML=Globalize.translateDocument(c),d(l,t),document.body.appendChild(l),e.open(l),l.addEventListener("iron-overlay-closed",a);var h=function(){s(l,t),o(r,l,t),f(t.mode)&&(l.classList.add("dynamicFilterDialog"),n(l,Dashboard.getCurrentUserId(),t.query))};i.animate?h():setTimeout(h,100)},c.send()})}}});