define(["dialogHelper","events","browser","jQuery","emby-checkbox","emby-collapsible","css!components/filterdialog/style","paper-radio-button","paper-radio-group"],function(e,t,i,r){function n(e,t,i,r,n){var a=e.querySelector(t);r.length?a.classList.remove("hide"):a.classList.add("hide");var s="";s+='<div class="checkboxList">',s+=r.map(function(e){var t="",r=n(e)?" checked":"";return t+="<label>",t+='<input is="emby-checkbox" type="checkbox"'+r+' data-filter="'+e+'" class="'+i+'"/>',t+="<span>"+e+"</span>",t+="</label>"}).join(""),s+="</div>",a.querySelector(".filterOptions").innerHTML=s}function a(e,t,i){t.Tags&&(t.Tags.length=Math.min(t.Tags.length,50)),n(e,".genreFilters","chkGenreFilter",t.Genres,function(e){var t="|";return-1!=(t+(i.Genres||"")+t).indexOf(t+e+t)}),n(e,".officialRatingFilters","chkOfficialRatingFilter",t.OfficialRatings,function(e){var t="|";return-1!=(t+(i.OfficialRatings||"")+t).indexOf(t+e+t)}),n(e,".tagFilters","chkTagFilter",t.Tags,function(e){var t="|";return-1!=(t+(i.Tags||"")+t).indexOf(t+e+t)}),n(e,".yearFilters","chkYearFilter",t.Years,function(e){var t=",";return-1!=(t+(i.Years||"")+t).indexOf(t+e+t)})}function s(e,t,i){return ApiClient.getJSON(ApiClient.getUrl("Items/Filters",{UserId:t,ParentId:i.ParentId,IncludeItemTypes:i.IncludeItemTypes})).then(function(t){a(e,t,i)})}function c(e,t){var i=t.query;"livetvchannels"==t.mode?(e.querySelector(".chkFavorite").checked=1==i.IsFavorite,e.querySelector(".chkLikes").checked=1==i.IsLiked,e.querySelector(".chkDislikes").checked=1==i.IsDisliked):r(".chkStandardFilter",e).each(function(){var e=","+(i.Filters||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),r(".chkVideoTypeFilter",e).each(function(){var e=","+(i.VideoTypes||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),e.querySelector(".chk3DFilter").checked=1==i.Is3D,e.querySelector(".chkHDFilter").checked=1==i.IsHD,e.querySelector(".chkSDFilter").checked=1==i.IsHD,e.querySelector("#chkSubtitle").checked=1==i.HasSubtitles,e.querySelector("#chkTrailer").checked=1==i.HasTrailer,e.querySelector("#chkThemeSong").checked=1==i.HasThemeSong,e.querySelector("#chkThemeVideo").checked=1==i.HasThemeVideo,e.querySelector("#chkSpecialFeature").checked=1==i.HasSpecialFeature,r("#chkSpecialEpisode",e).checked(0==i.ParentIndexNumber),r("#chkMissingEpisode",e).checked(1==i.IsMissing),r("#chkFutureEpisode",e).checked(1==i.IsUnaired),e.querySelector(".playersRadioGroup").selected=null==i.MinPlayers?"all":i.MinPlayers,r(".chkStatus",e).each(function(){var e=","+(i.SeriesStatus||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)}),r(".chkAirDays",e).each(function(){var e=","+(i.AirDays||""),t=this.getAttribute("data-filter");this.checked=-1!=e.indexOf(","+t)})}function l(e){t.trigger(e,"filterchange")}function o(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function d(e,t,i){var n=i.query;"livetvchannels"==i.mode?(r(".chkFavorite",t).on("change",function(){n.StartIndex=0,n.IsFavorite=this.checked?!0:null,l(e)}),r(".chkLikes",t).on("change",function(){n.StartIndex=0,n.IsLiked=this.checked?!0:null,l(e)}),r(".chkDislikes",t).on("change",function(){n.StartIndex=0,n.IsDisliked=this.checked?!0:null,l(e)})):r(".chkStandardFilter",t).on("change",function(){var t=this.getAttribute("data-filter"),i=n.Filters||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),n.StartIndex=0,n.Filters=i,l(e)}),r(".chkVideoTypeFilter",t).on("change",function(){var t=this.getAttribute("data-filter"),i=n.VideoTypes||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),n.StartIndex=0,n.VideoTypes=i,l(e)}),r(".chk3DFilter",t).on("change",function(){n.StartIndex=0,n.Is3D=this.checked?!0:null,l(e)}),r(".chkHDFilter",t).on("change",function(){n.StartIndex=0,n.IsHD=this.checked?!0:null,l(e)}),r(".chkSDFilter",t).on("change",function(){n.StartIndex=0,n.IsHD=this.checked?!1:null,l(e)}),r(".chkStatus",t).on("change",function(){var t=this.getAttribute("data-filter"),i=n.SeriesStatus||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),n.SeriesStatus=i,n.StartIndex=0,l(e)}),r(".chkAirDays",t).on("change",function(){var t=this.getAttribute("data-filter"),i=n.AirDays||"";i=(","+i).replace(","+t,"").substring(1),this.checked&&(i=i?i+","+t:t),n.AirDays=i,n.StartIndex=0,l(e)}),r("#chkTrailer",t).on("change",function(){n.StartIndex=0,n.HasTrailer=this.checked?!0:null,l(e)}),r("#chkThemeSong",t).on("change",function(){n.StartIndex=0,n.HasThemeSong=this.checked?!0:null,l(e)}),r("#chkSpecialFeature",t).on("change",function(){n.StartIndex=0,n.HasSpecialFeature=this.checked?!0:null,l(e)}),r("#chkThemeVideo",t).on("change",function(){n.StartIndex=0,n.HasThemeVideo=this.checked?!0:null,l(e)}),r("#chkMissingEpisode",t).on("change",function(){n.StartIndex=0,n.IsMissing=this.checked?!0:!1,l(e)}),r("#chkSpecialEpisode",t).on("change",function(){n.StartIndex=0,n.ParentIndexNumber=this.checked?0:null,l(e)}),r("#chkFutureEpisode",t).on("change",function(){n.StartIndex=0,this.checked?(n.IsUnaired=!0,n.IsVirtualUnaired=null):(n.IsUnaired=null,n.IsVirtualUnaired=!1),l(e)}),r("#chkSubtitle",t).on("change",function(){n.StartIndex=0,n.HasSubtitles=this.checked?!0:null,l(e)}),t.querySelector(".playersRadioGroup").addEventListener("iron-select",function(t){n.StartIndex=0;var i=t.target.selected,r="all"==i?null:i,a=n.MinPlayers!=r;n.MinPlayers=r,a&&l(e)}),t.addEventListener("change",function(t){var i=o(t.target,"chkGenreFilter");if(i){var r=i.getAttribute("data-filter"),a=n.Genres||"",s="|";return a=(s+a).replace(s+r,"").substring(1),i.checked&&(a=a?a+s+r:r),n.StartIndex=0,n.Genres=a,void l(e)}var c=o(t.target,"chkTagFilter");if(c){var r=c.getAttribute("data-filter"),a=n.Tags||"",s="|";return a=(s+a).replace(s+r,"").substring(1),c.checked&&(a=a?a+s+r:r),n.StartIndex=0,n.Tags=a,void l(e)}var d=o(t.target,"chkYearFilter");if(d){var r=d.getAttribute("data-filter"),a=n.Years||"",s=",";return a=(s+a).replace(s+r,"").substring(1),d.checked&&(a=a?a+s+r:r),n.StartIndex=0,n.Years=a,void l(e)}var h=o(t.target,"chkOfficialRatingFilter");if(h){var r=h.getAttribute("data-filter"),a=n.OfficialRatings||"",s="|";return a=(s+a).replace(s+r,"").substring(1),h.checked&&(a=a?a+s+r:r),n.StartIndex=0,n.OfficialRatings=a,void l(e)}})}function h(e,t){("livetvchannels"==t.mode||"albums"==t.mode||"artists"==t.mode||"albumartists"==t.mode||"songs"==t.mode)&&f(e,"videoStandard"),g(t.mode)&&(e.querySelector(".genreFilters").classList.remove("hide"),e.querySelector(".officialRatingFilters").classList.remove("hide"),e.querySelector(".tagFilters").classList.remove("hide"),e.querySelector(".yearFilters").classList.remove("hide")),("movies"==t.mode||"episodes"==t.mode)&&e.querySelector(".videoTypeFilters").classList.remove("hide"),"games"==t.mode&&e.querySelector(".players").classList.remove("hide"),("movies"==t.mode||"series"==t.mode||"games"==t.mode||"episodes"==t.mode)&&e.querySelector(".features").classList.remove("hide"),"series"==t.mode&&(e.querySelector(".airdays").classList.remove("hide"),e.querySelector(".seriesStatus").classList.remove("hide")),"episodes"==t.mode&&u(e,"episodeFilter")}function u(e,t){for(var i=e.querySelectorAll("."+t),r=0,n=i.length;n>r;r++)i[r].classList.remove("hide")}function f(e,t){for(var i=e.querySelectorAll("."+t),r=0,n=i.length;n>r;r++)i[r].classList.add("hide")}function g(e){return"movies"==e||"games"==e||"series"==e||"albums"==e||"albumartists"==e||"artists"==e||"songs"==e||"episodes"==e}return function(t){var r=this;r.show=function(){return new Promise(function(n){var a=new XMLHttpRequest;a.open("GET","components/filterdialog/filterdialog.template.html",!0),a.onload=function(){var a=this.response,l=e.createDialog({removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:200,autoFocus:!1});l.classList.add("ui-body-a"),l.classList.add("background-theme-a"),l.classList.add("formDialog"),l.classList.add("filterDialog"),l.innerHTML=Globalize.translateDocument(a),h(l,t),document.body.appendChild(l),e.open(l),l.addEventListener("close",n);var o=function(){c(l,t),d(r,l,t),g(t.mode)&&(l.classList.add("dynamicFilterDialog"),s(l,Dashboard.getCurrentUserId(),t.query))};i.animate?o():setTimeout(o,100)},a.send()})}}});