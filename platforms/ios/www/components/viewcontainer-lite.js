define(["browser"],function(e){function t(){return e.tv?!1:e.safari?!1:!0}function n(e){if(!e.cancel){d();var t=E,n=-1==t?null:b[t],r=t+1;r>=L&&(r=0);var a=o(e),f=a.elem,l="string"==typeof f?null:f.getAttribute("data-require");l=l?l.split(","):[];var p=-1!=e.url.toLowerCase().indexOf("/configurationpage?");return p&&(l.push("jqmpopup"),l.push("jqmcollapsible"),l.push("jqmcheckbox"),l.push("legacy/dashboard"),l.push("legacy/selectmenu"),l.push("jqmcontrolgroup")),(p||f.classList&&f.classList.contains("type-interior"))&&(l.push("jqmlistview"),l.push("scripts/notifications"),l.push("dashboardcss"),l.push("emby-icons")),new Promise(function(o){require(l,function(){var d=b[r];d&&v(d);var p=f;"string"==typeof p&&(p=document.createElement("div"),p.innerHTML=f),p.classList.add("mainAnimatedPage"),d?a.hasScript&&window.$?(p=$(p).appendTo(y)[0],y.removeChild(d)):y.replaceChild(p,d):a.hasScript&&window.$?p=$(p).appendTo(y)[0]:y.appendChild(p),"string"!=typeof f&&i(l,p),e.type&&p.setAttribute("data-type",e.type);var m=p;b[r]=p,g&&g(p,!1,e),s(b,r,t),u(m,n,e.transition,e.isBack).then(function(){E=r,q[r]=e.url,!e.cancel&&n&&c(b,r),document.dispatchEvent(new CustomEvent("scroll",{})),window.$&&($.mobile=$.mobile||{},$.mobile.activePage=p),o(p)})})})}}function i(e,t){for(var n=!1,i=0,r=e.length;r>i;i++)if(0==e[i].indexOf("jqm")){n=!0;break}n&&window.$&&$(t).trigger("create")}function r(e,t,n){return e.split(t).join(n)}function a(e,t){t&&(e=r(e,"<!--<script","<script"),e=r(e,"</script>-->","</script>"));var n=document.createElement("div");return n.innerHTML=e,n.querySelector('div[data-role="page"]')}function o(e){if(-1==e.view.indexOf('data-role="page"'))return e.view;var t=-1!=e.view.indexOf("<script"),n=a(e.view,t);return t&&(t=null!=n.querySelector("script")),{elem:n,hasScript:t}}function s(e,t,n){for(var i=0,r=e.length;r>i;i++)t==i||n==i||e[i].classList.add("hide")}function c(e,t){for(var n=0,i=e.length;i>n;n++)t==n||e[n].classList.add("hide")}function u(e,n,i,r){if(i=i||"fade",t()&&n&&e.animate){if("slide"==i)return f(e,n,i,r);if("fade"==i)return l(e,n,i,r)}return Promise.resolve()}function f(t,n,i,r){return new Promise(function(i){var a={duration:450,iterations:1,easing:"ease-out"};e.chrome||(a.fill="both");var o=[];if(n){var s=r?"100%":"-100%";o.push(n.animate([{transform:"none",offset:0},{transform:"translate3d("+s+", 0, 0)",offset:1}],a))}var c=r?"-100%":"100%";o.push(t.animate([{transform:"translate3d("+c+", 0, 0)",offset:0},{transform:"none",offset:1}],a)),P=o,o[o.length-1].onfinish=i})}function l(t,n){return new Promise(function(i){var r={duration:140,iterations:1,easing:"ease-out"};e.chrome||(r.fill="both");var a=[];n&&a.push(n.animate([{opacity:1,offset:0},{opacity:0,offset:1}],r)),a.push(t.animate([{opacity:0,offset:0},{opacity:1,offset:1}],r)),P=a,a[a.length-1].onfinish=i})}function d(){for(var e=P,t=0,n=e.length;n>t;t++)p(e[t])}function p(e){try{e.cancel()}catch(t){}}function m(e){g=e}function h(e){var t=e.url,n=q.indexOf(t);if(-1!=n){var i=b[n],r=i;if(r){if(e.cancel)return;d();var a=E,o=-1==a?null:b[a];return g&&g(r,!0,e),s(b,n,a),i.classList.remove("hide"),u(i,o,e.transition,e.isBack).then(function(){return E=n,!e.cancel&&o&&c(b,n),document.dispatchEvent(new CustomEvent("scroll",{})),window.$&&($.mobile=$.mobile||{},$.mobile.activePage=r),r})}}return Promise.reject()}function v(e){e.dispatchEvent(new CustomEvent("viewdestroy",{}))}function w(){b=[],q=[],y.innerHTML="",E=-1}var g,y=document.querySelector(".mainAnimatedPages"),b=[],q=[],L=3,E=-1,P=[];return t()&&!document.documentElement.animate&&require(["webAnimations"]),w(),y.classList.remove("hide"),{loadView:n,tryRestoreView:h,reset:w,setOnBeforeChange:m}});