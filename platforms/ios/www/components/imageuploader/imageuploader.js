define(["paperdialoghelper","paper-dialog","paper-fab"],function(e){function a(e){switch(Dashboard.hideLoadingMsg(),e.target.error.code){case e.target.error.NOT_FOUND_ERR:require(["toast"],function(e){e(Globalize.translate("MessageFileNotFound"))});break;case e.target.error.ABORT_ERR:break;default:require(["toast"],function(e){e(Globalize.translate("MessageFileReadError"))})}}function t(e,t){var r=t[0];if(!r||!r.type.match("image.*"))return $("#imageOutput",e).html(""),$("#fldUpload",e).hide(),void(s=null);s=r;var o=new FileReader;o.onerror=a,o.onloadstart=function(){$("#fldUpload",e).hide()},o.onabort=function(){Dashboard.hideLoadingMsg()},o.onload=function(a){return function(t){var r=['<img style="max-width:300px;max-height:100px;" src="',t.target.result,'" title="',escape(a.name),'"/>'].join("");$("#imageOutput",e).html(r),$("#fldUpload",e).show()}}(r),o.readAsDataURL(r)}function r(){p=!0,history.back()}function o(){var e=s;if(!e)return!1;if("image/png"!=e.type&&"image/jpeg"!=e.type&&"image/jpeg"!=e.type)return!1;Dashboard.showLoadingMsg();var a=$(this).parents("paper-dialog"),t=$("#selectImageType",a).val();return ApiClient.uploadItemImage(d,t,e).then(function(){$("#uploadImage",a).val("").trigger("change"),Dashboard.hideLoadingMsg(),r(a)}),!1}function n(e){$("form",e).off("submit",o).on("submit",o),$("#uploadImage",e).on("change",function(){t(e,this.files)}),$("#imageDropZone",e).on("dragover",function(e){return e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="Copy",!1}).on("drop",function(a){return a.preventDefault(),t(e,a.originalEvent.dataTransfer.files),!1})}function i(a,t){t=t||{};var r=new XMLHttpRequest;r.open("GET","components/imageuploader/imageuploader.template.html",!0),r.onload=function(){var r=this.response;d=a;var o=e.createDialog({size:"fullscreen-border"}),i=t.theme||"b";o.classList.add("ui-body-"+i),o.classList.add("background-theme-"+i),o.classList.add("popupEditor");var s="";s+='<h2 class="dialogHeader">',s+='<paper-fab icon="arrow-back" mini class="btnCloseDialog" tabindex="-1"></paper-fab>',s+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+Globalize.translate("HeaderUploadImage")+"</div>",s+="</h2>",s+='<div class="editorContent">',s+=Globalize.translateDocument(r),s+="</div>",o.innerHTML=s,document.body.appendChild(o),$(o).on("iron-overlay-closed",l),e.open(o);var u=o.querySelector(".editorContent");n(u),$("#selectImageType",o).val(t.imageType||"Primary"),$(".btnCloseDialog",o).on("click",function(){e.close(o)})},r.send()}function l(){$(this).remove(),Dashboard.hideLoadingMsg(),u.resolveWith(null,[p])}var d,s,u,p=!1;return{show:function(e,a){var t=jQuery.Deferred();return u=t,p=!1,i(e,a),t.promise()}}});