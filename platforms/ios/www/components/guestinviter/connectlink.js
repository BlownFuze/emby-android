define(["dialogHelper","jQuery","emby-input","emby-button","emby-collapse","paper-checkbox","paper-icon-button-light","formDialogStyle"],function(e){function n(e,n,a,o){var r=e.ConnectUserName||"",l=n,c=ApiClient.getUrl("Users/"+e.Id+"/Connect/Link");r&&!l?ApiClient.ajax({type:"DELETE",url:c}).then(function(){Dashboard.alert({message:Globalize.translate("MessageEmbyAccontRemoved"),title:Globalize.translate("HeaderEmbyAccountRemoved"),callback:a})},function(){Dashboard.alert({message:Globalize.translate("ErrorRemovingEmbyConnectAccount")})}):r!=l?ApiClient.ajax({type:"POST",url:c,data:{ConnectUsername:l},dataType:"json"}).then(function(e){var n=e.IsPending?"MessagePendingEmbyAccountAdded":"MessageEmbyAccountAdded";Dashboard.alert({message:Globalize.translate(n),title:Globalize.translate("HeaderEmbyAccountAdded"),callback:a})},function(){t(".")}):o&&o()}function t(e){var n,t;e?(n=Globalize.translate("ErrorAddingEmbyConnectAccount1",'<a href="https://emby.media/connect" target="_blank">https://emby.media/connect</a>'),n+="<br/><br/>"+Globalize.translate("ErrorAddingEmbyConnectAccount2","apps@emby.media"),t=Globalize.translate("ErrorAddingEmbyConnectAccount1","https://emby.media/connect"),t+="\n\n"+Globalize.translate("ErrorAddingEmbyConnectAccount2","apps@emby.media")):n=t=Globalize.translate("DefaultErrorMessage"),require(["alert"],function(e){e({text:t,html:n})})}return{show:function(){return new Promise(function(t,a){var o=new XMLHttpRequest;o.open("GET","components/guestinviter/connectlink.template.html",!0),o.onload=function(){var o=this.response,r=e.createDialog({removeOnClose:!0,size:"small"});r.classList.add("ui-body-a"),r.classList.add("background-theme-a"),r.classList.add("formDialog");var l="";l+=Globalize.translateDocument(o),r.innerHTML=l,document.body.appendChild(r),e.open(r),r.addEventListener("close",function(){r.submitted?t():a()}),r.querySelector(".btnCancel").addEventListener("click",function(){e.close(r)}),r.querySelector("form").addEventListener("submit",function(t){return ApiClient.getCurrentUser().then(function(t){n(t,r.querySelector("#txtConnectUsername").value,function(){e.close(r)},function(){e.close(r)})}),t.preventDefault(),!1})},o.send()})}}});