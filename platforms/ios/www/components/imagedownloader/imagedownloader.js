define(["dialogHelper","emby-checkbox","emby-button","paper-icon-button-light"],function(e){function t(){var e={};return e.itemId=g,e}function a(e){Dashboard.showLoadingMsg();var a=t();a.type=L,a.startIndex=f,a.limit=y,a.IncludeAllLanguages=e.querySelector("#chkAllLanguages").checked;var n=p||"";n&&(a.ProviderName=n),ApiClient.getAvailableRemoteImages(a).then(function(t){i(e,t,L,a.startIndex,a.limit),e.querySelector("#selectBrowsableImageType").value=L;var o=t.Providers.map(function(e){return'<option value="'+e+'">'+e+"</option>"}),r=e.querySelector("#selectImageProvider");r.innerHTML='<option value="">'+Globalize.translate("LabelAll")+"</option>"+o,r.value=n,Dashboard.hideLoadingMsg()})}function i(e,t,i,o,r){e.querySelector(".availableImagesPaging").innerHTML=n(o,r,t.TotalRecordCount);for(var l="",d=0,c=t.Images.length;c>d;d++)l+=s(t.Images[d],i);var u=e.querySelector(".availableImagesList");u.innerHTML=l,ImageLoader.lazyChildren(u);var g=e.querySelector(".btnNextPage"),m=e.querySelector(".btnPreviousPage");g&&g.addEventListener("click",function(){f+=y,a(e)}),m&&m.addEventListener("click",function(){f-=y,a(e)})}function n(e,t,a){var i="",n=Math.min(e+t,a),o=a>t;i+='<div class="listPaging">',i+='<span style="margin-right: 10px;">';var r=a?e+1:0;return i+=r+"-"+n+" of "+a,i+="</span>",o&&(i+='<div data-role="controlgroup" data-type="horizontal" style="display:inline-block;">',i+='<button is="paper-icon-button-light" title="'+Globalize.translate("ButtonPreviousPage")+'" class="btnPreviousPage autoSize" '+(e?"":"disabled")+'><i class="md-icon">&#xE5C4;</i></button>',i+='<button is="paper-icon-button-light" title="'+Globalize.translate("ButtonNextPage")+'" class="btnNextPage autoSize" '+(e+t>=a?"disabled":"")+'><i class="md-icon">arrow_forward</i></button>',i+="</div>"),i+="</div>"}function o(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function r(a,i,n,r){var l=t();l.Type=n,l.ImageUrl=i,l.ProviderName=r,Dashboard.showLoadingMsg(),ApiClient.downloadRemoteImage(l).then(function(){h=!0;var t=o(a,"dialog");e.close(t)})}function l(e){return ApiClient.getUrl("Images/Remote",{imageUrl:e})}function s(e,t){var a="";a+='<div class="remoteImageContainer">';var i="remoteImage lazy";i+="Backdrop"==t||"Art"==t||"Thumb"==t||"Logo"==t?" remoteBackdropImage":"Banner"==t?" remoteBannerImage":"Disc"==t?" remoteDiscImage":"Episode"==m?" remoteBackdropImage":"MusicAlbum"==m||"MusicArtist"==m?" remoteDiscImage":" remotePosterImage";var n=l(e.ThumbnailUrl||e.Url);return a+='<a target="_blank" href="'+l(e.Url)+'" class="'+i+'" data-src="'+n+'">',a+="</a>",a+='<div class="remoteImageDetails">',a+='<div class="remoteImageDetailText">',a+=e.ProviderName,a+="</div>",(e.Width||e.Height||e.Language)&&(a+='<div class="remoteImageDetailText">',e.Width&&e.Height?(a+=e.Width+" x "+e.Height,e.Language&&(a+=" • "+e.Language)):e.Language&&(a+=e.Language),a+="</div>"),null!=e.CommunityRating&&(a+='<div class="remoteImageDetailText">',"Likes"==e.RatingType?a+=e.CommunityRating+(1==e.CommunityRating?" like":" likes"):e.CommunityRating?(a+=e.CommunityRating.toFixed(1),e.VoteCount&&(a+=" • "+e.VoteCount+(1==e.VoteCount?" vote":" votes"))):a+="Unrated",a+="</div>"),a+='<button is="paper-icon-button-light" class="btnDownloadRemoteImage autoSize" raised data-imageprovider="'+e.ProviderName+'" data-imageurl="'+e.Url+'" data-imagetype="'+e.Type+'" title="'+Globalize.translate("ButtonDownload")+'"><i class="md-icon">cloud_download</i></button>',a+="</div>",a+="</div>"}function d(e){e.querySelector("#selectBrowsableImageType").addEventListener("change",function(){L=this.value,f=0,p=null,a(e)}),e.querySelector("#selectImageProvider").addEventListener("change",function(){f=0,p=this.value,a(e)}),e.querySelector("#chkAllLanguages").addEventListener("change",function(){f=0,a(e)}),e.addEventListener("click",function(t){var a=o(t.target,"btnDownloadRemoteImage");a&&r(e,a.getAttribute("data-imageurl"),a.getAttribute("data-imagetype"),a.getAttribute("data-imageprovider"))})}function c(t,i){Dashboard.showLoadingMsg();var n=new XMLHttpRequest;n.open("GET","components/imagedownloader/imagedownloader.template.html",!0),n.onload=function(){var n=this.response;g=t,m=i;var o=e.createDialog({size:"fullscreen-border",lockScroll:!0,removeOnClose:!0}),r="b";o.classList.add("ui-body-"+r),o.classList.add("background-theme-"+r);var l="";l+='<h2 class="dialogHeader">',l+='<button type="button" is="emby-button" icon="arrow-back" class="fab mini btnCloseDialog autoSize" tabindex="-1"><i class="md-icon">&#xE5C4;</i></button>',l+='<div style="display:inline-block;margin-left:.6em;vertical-align:middle;">'+Globalize.translate("HeaderSearch")+"</div>",l+="</h2>",l+='<div class="editorContent">',l+=Globalize.translateDocument(n),l+="</div>",o.innerHTML=l,document.body.appendChild(o),o.addEventListener("close",u),e.open(o);var s=o.querySelector(".editorContent");d(s),o.querySelector(".btnCloseDialog").addEventListener("click",function(){e.close(o)}),a(s)},n.send()}function u(){Dashboard.hideLoadingMsg(),h?v():b()}var g,m,v,b,p,h=!1,y=browserInfo.slow?6:30,f=0,L="Primary";return{show:function(e,t,a){return new Promise(function(i,n){v=i,b=n,h=!1,f=0,L=a||"Primary",p=null,c(e,t)})}}});