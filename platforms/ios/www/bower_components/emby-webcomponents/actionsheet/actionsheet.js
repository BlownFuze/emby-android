define(["dialogHelper","layoutManager","globalize","browser","dom","emby-button","css!./actionsheet","material-icons","scrollStyles"],function(t,e,n,o,i){function l(t){var e=document,n=[];if(!e)return n;for(var o,i,l=0,a=t.length;a>l;l++)i=t[l],o=i.getBoundingClientRect?i.getBoundingClientRect():{top:0,left:0},n[l]={top:o.top,left:o.left};return n}function a(t,e){var n=window.innerHeight,o=window.innerWidth;if(540>n)return null;var i=l([t.positionTo])[0];i.top+=t.positionTo.offsetHeight/2,i.left+=t.positionTo.offsetWidth/2;var a=e.offsetHeight||300,c=e.offsetWidth||160;i.top-=a/2,i.left-=c/2;var s=i.left+c-o,r=i.top+a-n;return s>0&&(i.left-=s+20),r>0&&(i.top-=r+20),i.top=Math.max(i.top,10),i.left=Math.max(i.left,10),i}function c(t){require(["scrollHelper"],function(e){e.centerFocus.on(t.querySelector(".actionSheetScroller"),!1)})}function s(l){var s={removeOnClose:!0,enableHistory:l.enableHistory,scrollY:!1},r=!1;e.tv?(s.size="fullscreen",r=!0,s.autoFocus=!0):(s.modal=!1,s.entryAnimationDuration=140,s.exitAnimationDuration=180,s.autoFocus=!1);var u=t.createDialog(s);e.tv||u.classList.add("extraSpacing"),u.classList.add("actionSheet");var d="";d+='<div class="actionSheetContent">',l.title&&(e.tv?(d+='<h1 class="actionSheetTitle">',d+=l.title,d+="</h1>"):(d+='<h2 class="actionSheetTitle">',d+=l.title,d+="</h2>")),l.text&&(d+='<p class="actionSheetText">',d+=l.text,d+="</p>");var h=e.desktop?"smoothScrollY":"hiddenScrollY",f=o.noFlex||o.firefox?"max-height:400px;":"";if(l.items.length>20){var m=window.innerWidth>=300?240:200;f+="min-width:"+m+"px;"}d+='<div class="actionSheetScroller '+h+'" style="'+f+'">';var v,p,b,g=!1;for(v=0,p=l.items.length;p>v;v++)b=l.items[v],b.icon=b.selected?"check":null,b.icon&&(g=!0);var y=l.title&&!g;y&&u.classList.add("centered");var S="button";for(v=0,p=l.items.length;p>v;v++){b=l.items[v];var x=b.selected?" autoFocus":"";d+="<"+S+x+' is="emby-button" type="button" class="actionSheetMenuItem" data-id="'+(b.id||b.value)+'">',b.icon?d+='<i class="actionSheetItemIcon md-icon">'+b.icon+"</i>":g&&!y&&(d+='<i class="actionSheetItemIcon md-icon" style="visibility:hidden;">check</i>'),d+='<div class="actionSheetItemText">'+(b.name||b.textContent||b.innerText)+"</div>",d+="</"+S+">"}l.showCancel&&(d+='<div class="buttons">',d+='<button is="emby-button" type="button" class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</button>",d+="</div>"),d+="</div>",u.innerHTML=d,e.tv&&c(u),l.showCancel&&u.querySelector(".btnCancel").addEventListener("click",function(){t.close(u)}),document.body.appendChild(u);var w;u.addEventListener("click",function(e){var n=i.parentWithClass(e.target,"actionSheetMenuItem");n&&(w=n.getAttribute("data-id"),t.close(u))});var C;return l.timeout&&(C=setTimeout(function(){t.close(u)},l.timeout)),new Promise(function(e,n){u.addEventListener("close",function(){C&&(clearTimeout(C),C=null),null!=w?(l.callback&&l.callback(w),e(w)):n()}),t.open(u);var o=l.positionTo?a(l,u):null;o&&(u.style.position="fixed",u.style.margin=0,u.style.left=o.left+"px",u.style.top=o.top+"px")})}return{show:s}});