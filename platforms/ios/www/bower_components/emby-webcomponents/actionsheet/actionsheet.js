define(["dialogHelper","layoutManager","globalize","browser","dom","emby-button","css!./actionsheet","material-icons","scrollStyles"],function(t,e,n,o,i){function a(t){var e=document,n=[];if(!e)return n;for(var o,i,a=0,l=t.length;l>a;a++)i=t[a],o=i.getBoundingClientRect?i.getBoundingClientRect():{top:0,left:0},n[a]={top:o.top,left:o.left};return n}function l(t,e){var n=i.getWindowSize(),o=n.innerHeight,l=n.innerWidth;if(540>o)return null;var s=a([t.positionTo])[0];"top"!=t.positionY&&(s.top+=t.positionTo.offsetHeight/2),s.left+=t.positionTo.offsetWidth/2;var c=e.offsetHeight||300,r=e.offsetWidth||160;s.top-=c/2,s.left-=r/2;var u=s.left+r-l,d=s.top+c-o;return u>0&&(s.left-=u+20),d>0&&(s.top-=d+20),s.top+=t.offsetTop||0,s.left+=t.offsetLeft||0,s.top=Math.max(s.top,10),s.left=Math.max(s.left,10),s}function s(t,e,n){require(["scrollHelper"],function(o){var i=n?"on":"off";o.centerFocus[i](t,e)})}function c(a){var c,r={removeOnClose:!0,enableHistory:a.enableHistory,scrollY:!1,entryAnimation:a.entryAnimation,exitAnimation:a.exitAnimation},u=!1;e.tv?(r.size="fullscreen",c=!0,u=!0,r.autoFocus=!0):(r.modal=!1,r.entryAnimationDuration=a.entryAnimationDuration||140,r.exitAnimationDuration=a.exitAnimationDuration||180,r.autoFocus=!1);var d=t.createDialog(r);c&&d.classList.add("actionsheet-fullscreen"),e.tv||d.classList.add("actionsheet-extraSpacing"),d.classList.add("actionSheet"),a.dialogClass&&d.classList.add(a.dialogClass);var f="",h=e.desktop?"smoothScrollY":"hiddenScrollY",m=o.noFlex||o.firefox?"max-height:400px;":"";if(a.items.length>20){var v=i.getWindowSize().innerWidth>=300?240:200;m+="min-width:"+v+"px;"}var p,S,b,g=!1;for(p=0,S=a.items.length;S>p;p++)b=a.items[p],b.icon=b.selected?"check":null,b.icon&&(g=!0);var x=a.title&&!g;f+=x?'<div class="actionSheetContent actionSheetContent-centered">':'<div class="actionSheetContent">',a.title&&(e.tv?(f+='<h1 class="actionSheetTitle">',f+=a.title,f+="</h1>"):(f+='<h2 class="actionSheetTitle">',f+=a.title,f+="</h2>")),a.text&&(f+='<p class="actionSheetText">',f+=a.text,f+="</p>"),f+='<div class="actionSheetScroller '+h+'" style="'+m+'">';var y=o.noFlex||o.firefox?"actionSheetMenuItem actionSheetMenuItem-noflex":"actionSheetMenuItem";for(a.menuItemClass&&(y+=" "+a.menuItemClass),p=0,S=a.items.length;S>p;p++){b=a.items[p];var C=b.selected?" autoFocus":"";f+="<button"+C+' is="emby-button" type="button" class="'+y+'" data-id="'+(b.id||b.value)+'">',b.icon?f+='<i class="actionSheetItemIcon md-icon">'+b.icon+"</i>":g&&!x&&(f+='<i class="actionSheetItemIcon md-icon" style="visibility:hidden;">check</i>'),f+='<div class="actionSheetItemText">'+(b.name||b.textContent||b.innerText)+"</div>",f+="</button>"}a.showCancel&&(f+='<div class="buttons">',f+='<button is="emby-button" type="button" class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</button>",f+="</div>"),f+="</div>",d.innerHTML=f,e.tv&&s(d.querySelector(".actionSheetScroller"),!1,!0),a.showCancel&&d.querySelector(".btnCancel").addEventListener("click",function(){t.close(d)}),document.body.appendChild(d);var T;d.addEventListener("click",function(e){var n=i.parentWithClass(e.target,"actionSheetMenuItem");n&&(T=n.getAttribute("data-id"),t.close(d))});var I;return a.timeout&&(I=setTimeout(function(){t.close(d)},a.timeout)),new Promise(function(n,o){d.addEventListener("close",function(){e.tv&&s(d.querySelector(".actionSheetScroller"),!1,!1),I&&(clearTimeout(I),I=null),null!=T?(a.callback&&a.callback(T),n(T)):o()}),t.open(d);var i=a.positionTo?l(a,d):null;i&&(d.style.position="fixed",d.style.margin=0,d.style.left=i.left+"px",d.style.top=i.top+"px")})}return{show:c}});