define(["dialogHelper","layoutManager","globalize","emby-button","css!./actionsheet","material-icons","scrollStyles"],function(t,e,n){function o(t,e){for(;!t.classList||!t.classList.contains(e);)if(t=t.parentNode,!t)return null;return t}function i(t){var e=document,n=[];if(!e)return n;for(var o,i,l=0,a=t.length;a>l;l++)i=t[l],o=i.getBoundingClientRect?i.getBoundingClientRect():{top:0,left:0},n[l]={top:o.top,left:o.left};return n}function l(t,e){var n=window.innerHeight,o=window.innerWidth;if(540>n)return null;var l=i([t.positionTo])[0];l.top+=t.positionTo.offsetHeight/2,l.left+=t.positionTo.offsetWidth/2;var a=e.offsetHeight||300,c=e.offsetWidth||160;l.top-=a/2,l.left-=c/2;var s=l.left+c-o,r=l.top+a-n;return s>0&&(l.left-=s+20),r>0&&(l.top-=r+20),l.top=Math.max(l.top,10),l.left=Math.max(l.left,10),l}function a(t){require(["scrollHelper"],function(e){e.centerFocus.on(t.querySelector(".actionSheetScroller"),!1)})}function c(i){var c={removeOnClose:!0,enableHistory:i.enableHistory,scrollY:!1},s=!1;e.tv?(c.size="fullscreen",s=!0,c.autoFocus=!0):(c.modal=!1,c.entryAnimationDuration=160,c.exitAnimationDuration=200,c.autoFocus=!1);var r=t.createDialog(c);e.tv||r.classList.add("extraSpacing"),r.classList.add("actionSheet");var u="";u+='<div class="actionSheetContent">',i.title&&(e.tv?(u+='<h1 class="actionSheetTitle">',u+=i.title,u+="</h1>"):(u+='<h2 class="actionSheetTitle">',u+=i.title,u+="</h2>"));var d=e.desktop?"smoothScrollY":"hiddenScrollY";u+='<div class="actionSheetScroller '+d+'">';var f,h,v,p=!1;for(f=0,h=i.items.length;h>f;f++)v=i.items[f],v.icon=v.selected?"check":null,v.icon&&(p=!0);var m=i.title&&!p;m&&r.classList.add("centered");var b="button";for(f=0,h=i.items.length;h>f;f++){v=i.items[f];var y=v.selected?" autoFocus":"";u+="<"+b+y+' is="emby-button" type="button" class="actionSheetMenuItem" data-id="'+(v.id||v.value)+'">',v.icon?u+='<i class="actionSheetItemIcon md-icon">'+v.icon+"</i>":p&&!m&&(u+='<i class="actionSheetItemIcon md-icon" style="visibility:hidden;">check</i>'),u+='<div class="actionSheetItemText">'+(v.name||v.textContent||v.innerText)+"</div>",u+="</"+b+">"}i.showCancel&&(u+='<div class="buttons">',u+='<button is="emby-button" type="button" class="btnCancel">'+n.translate("sharedcomponents#ButtonCancel")+"</button>",u+="</div>"),u+="</div>",r.innerHTML=u,e.tv&&a(r),i.showCancel&&r.querySelector(".btnCancel").addEventListener("click",function(){t.close(r)}),document.body.appendChild(r);var S;return r.addEventListener("click",function(e){var n=o(e.target,"actionSheetMenuItem");n&&(S=n.getAttribute("data-id"),t.close(r))}),new Promise(function(e){r.addEventListener("close",function(){null!=S&&(i.callback&&i.callback(S),e(S))}),t.open(r);var n=i.positionTo?l(i,r):null;n&&(r.style.position="fixed",r.style.margin=0,r.style.left=n.left+"px",r.style.top=n.top+"px")})}return{show:c}});