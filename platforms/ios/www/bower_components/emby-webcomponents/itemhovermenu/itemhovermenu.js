define(["connectionManager","itemHelper","mediaInfo","userdataButtons","playbackManager","globalize","dom","apphost","css!./itemhovermenu","emby-button"],function(t,e,a,i,r,n,s,o){function d(t){var e=t.target;p&&(clearTimeout(p),p=null),e=e.classList.contains("cardOverlayTarget")?e:e.querySelector(".cardOverlayTarget"),e&&c(e)}function c(t){return t.classList.contains("hide")?void 0:t.animate?void requestAnimationFrame(function(){var e=[{transform:"none",offset:0},{transform:"translateY(100%)",offset:1}],a={duration:140,iterations:1,fill:"forwards",easing:"ease-out"};t.animate(e,a).onfinish=function(){t.classList.add("hide")}}):void t.classList.add("hide")}function l(t){t.classList.contains("hide")&&(t.classList.remove("hide"),t.animate&&requestAnimationFrame(function(){var e=[{transform:"translateY(100%)",offset:0},{transform:"none",offset:1}],a={duration:200,iterations:1,fill:"forwards",easing:"ease-out"};t.animate(e,a)}))}function m(t,s,d,c){var l="";l+='<div class="cardOverlayInner">';var m=c.className.toLowerCase(),u=-1!=m.indexOf("mini"),v=u||-1!=m.indexOf("small"),f=-1!=m.indexOf("portrait"),g=v||u||f?null:s.SeriesName,y=e.getDisplayName(s);l+="<div>";var p,b=26;g&&s.ParentLogoItemId?(p=t.getScaledImageUrl(s.ParentLogoItemId,{maxHeight:b,type:"logo",tag:s.ParentLogoImageTag}),l+='<img src="'+p+'" style="max-height:'+b+'px;max-width:100%;" />'):s.ImageTags.Logo?(p=t.getScaledImageUrl(s.Id,{maxHeight:b,type:"logo",tag:s.ImageTags.Logo}),l+='<img src="'+p+'" style="max-height:'+b+'px;max-width:100%;" />'):l+=g||y,l+="</div>",g?(l+="<p>",l+=y,l+="</p>"):v||u||(l+='<div class="cardOverlayMediaInfo">',l+=a.getPrimaryMediaInfoHtml(s,{endsAt:!1}),l+="</div>"),l+='<div class="cardOverlayButtons">';var h=0;r.canPlay(s)&&(l+='<button is="emby-button" class="itemAction autoSize fab cardOverlayFab mini" data-action="playmenu"><i class="md-icon cardOverlayFab-md-icon">&#xE037;</i></button>',h++),s.LocalTrailerCount&&(l+='<button title="'+n.translate("sharedcomponents#Trailer")+'" is="emby-button" class="itemAction autoSize fab cardOverlayFab mini" data-action="playtrailer"><i class="md-icon cardOverlayFab-md-icon">&#xE04B;</i></button>',h++);var L="dots-horiz"==o.moreIcon?"&#xE5D3;":"&#xE5D4;";return l+='<button is="emby-button" class="itemAction autoSize fab cardOverlayFab mini" data-action="menu" data-playoptions="false"><i class="md-icon cardOverlayFab-md-icon">'+L+"</i></button>",h++,l+=i.getIconsHtml({item:s,style:"fab-mini",cssClass:"cardOverlayFab",iconCssClass:"cardOverlayFab-md-icon"}),l+="</div>",l+="</div>"}function u(t){var e=s.parentWithClass(t.target,"btnUserData");e&&t.stopPropagation()}function v(e){var a=e.querySelector(".cardOverlayTarget");if(!a){a=document.createElement("div"),a.classList.add("hide"),a.classList.add("cardOverlayTarget"),a.classList.add("itemAction"),a.setAttribute("data-action","link");var i=e.querySelector("div.cardContent")||e.querySelector(".cardScalable")||e.querySelector(".cardBox");i||(i=e),i.classList.add("withHoverMenu"),i.appendChild(a)}var r=s.parentWithAttribute(e,"data-id");if(r){var n=r.getAttribute("data-id"),o=r.getAttribute("data-type");if("Timer"!=o){var d=r.getAttribute("data-serverid"),c=t.getApiClient(d),v=c.getItem(c.getCurrentUserId(),n),f=c.getCurrentUser();Promise.all([v,f]).then(function(t){var e=t[0],i=t[1];a.innerHTML=m(c,e,i,r),a.querySelector(".cardOverlayButtons").addEventListener("click",u)}),l(a)}}}function f(t){var e=t.target,a=s.parentWithClass(e,"cardBox");if(a){if(b===!0)return void(b=!1);p&&(clearTimeout(p),p=null),p=setTimeout(function(){v(a)},1e3)}}function g(){b=!0}function y(t){this.parent=t,this.parent.addEventListener("mouseenter",f,!0),this.parent.addEventListener("mouseleave",d,!0),s.addEventListener(this.parent,"touchstart",g,{passive:!0})}var p,b=!1;return y.prototype={constructor:y,destroy:function(){this.parent.removeEventListener("mouseenter",f,!0),this.parent.removeEventListener("mouseleave",d,!0),s.removeEventListener(this.parent,"touchstart",g,{passive:!0})}},y});