define(["visibleinviewport","imageloader"],function(e,t){function n(t){return e(t,!0,s,l)}function r(e){var n=e.getAttribute("data-src");n&&(t.loadImage(e,n),e.setAttribute("data-src",""))}function a(e){for(var t=0,n=e.length;n>t;t++)e[t]=!0}function i(e){function t(t){for(var a=[],u=!1,s=!1,l=0,c=e.length;c>l;l++){if(o[t])return;var d=e[l];!s&&n(d)?(u=!0,r(d)):(u&&(s=!0),a.push(d))}e=a,e.length||(document.removeEventListener("focus",i,!0),document.removeEventListener("scroll",i,!0),document.removeEventListener(v,i,!0),window.removeEventListener("resize",i,!0))}function i(){a(o);var e=o.length;o.length++,setTimeout(function(){t(e)},1)}if(e.length){var o=[];document.addEventListener("scroll",i,!0),document.addEventListener("focus",i,!0),document.addEventListener(v,i,!0),window.addEventListener("resize",i,!0),i()}}function o(e){i(e.getElementsByClassName("lazy"))}function u(e){for(var t=[],n=0,r=e.length;r>n;n++){var a=e[n].PrimaryImageAspectRatio||0;a&&(t[t.length]=a)}if(!t.length)return null;t.sort(function(e,t){return e-t});var i,o=Math.floor(t.length/2);i=t.length%2?t[o]:(t[o-1]+t[o])/2;var u=2/3;if(Math.abs(u-i)<=.15)return u;var s=16/9;if(Math.abs(s-i)<=.2)return s;if(Math.abs(1-i)<=.15)return 1;var l=4/3;return Math.abs(l-i)<=.15?l:i}var s=screen.availWidth,l=screen.availHeight,v=document.implementation.hasFeature("Event.wheel","3.0")?"wheel":"mousewheel";return{lazyChildren:o,getPrimaryImageAspectRatio:u}});