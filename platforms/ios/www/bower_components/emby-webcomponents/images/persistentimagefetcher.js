define(["cryptojs-md5"],function(){function e(e,n){return"IMG"!==e.tagName?new Promise(function(t){var r=new Image;r.onload=function(){e.style.backgroundImage="url('"+n+"')",t(e)},r.src=n}):(e.setAttribute("src",n),Promise.resolve(e))}function n(e,t,r,i){("."==t[0]||""==t[0])&&(t=t.slice(1)),e.getDirectory(t[0],{create:!0},function(e){t.length>1?n(e,t.slice(1),r,i):r(e)},i)}function t(e){var n=e.indexOf("://");return-1!=n&&(e=e.substring(n+3),n=e.indexOf("/"),-1!=n&&(e=e.substring(n+1))),CryptoJS.MD5(e).toString()}function r(e,n,t,r,o){var u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="arraybuffer",u.onload=function(){200==this.status?i(n,t,this.getResponseHeader("Content-Type"),this.response,r,o):o()},u.send()}function i(e,n,t,r,i,o){e.getFile(n,{create:!0},function(e){e.createWriter(function(n){n.onwriteend=function(){i(e)},n.onerror=o;var u=new Blob([r],{type:t});n.write(u)},o)},o)}function o(e){return new Promise(function(n,i){-1!=e.indexOf("tag=")&&(e+="&accept=webp");var o=t(e),c=function(e){n(e.toURL())},f=function(e){i()};if(!a||!u)return void f("");var g="/"+s+"/"+o;a.root.getFile(g,{create:!1},c,function(){r(e,u,o,c,f)})})}var u,c=1572864e3,s="images";navigator.webkitPersistentStorage.requestQuota(c,function(e){var t=window.webkitRequestFileSystem||window.requestFileSystem;t(PERSISTENT,e,function(e){a=e,n(a.root,s.split("/"),function(e){u=e})})});var a;return{loadImage:function(n,t){return o(t).then(function(t){return e(n,t)},function(){return e(n,t)})}}});