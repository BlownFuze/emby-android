define(["historyManager","focusManager","browser","layoutManager","inputManager","scrollHelper","dom","css!./dialoghelper.css","scrollStyles"],function(t,e,n,o,i,a,s){function r(){return n.animate?!0:n.edge?!0:!1}function c(e,n,o){function a(){var t=c.originalUrl==window.location.href;(t||!v(e))&&window.removeEventListener("popstate",a),t&&(c.closedByBack=!0,k(e))}function s(t){"back"==t.detail.command&&(c.closedByBack=!0,k(e),t.preventDefault())}function r(){if(m(e)||i.off(e,s),window.removeEventListener("popstate",a),x(e),e.classList.remove("opened"),g&&document.body.classList.remove("noScroll"),!c.closedByBack&&m(e)){var t=history.state||{};t.dialogId==n&&history.back()}d.focus(),"true"==e.getAttribute("data-removeonclose")&&e.parentNode.removeChild(e),setTimeout(function(){o({element:e,closedByBack:c.closedByBack})},1)}var c=this;c.originalUrl=window.location.href;var d=document.activeElement,g=!1;e.addEventListener("close",r);var p=!e.classList.contains("fixedSize");p&&e.classList.add("centeredDialog"),e.classList.remove("hide"),e.showModal?(e.getAttribute("modal")?e.showModal():(l(e),e.showModal()),f(document.activeElement)):u(e),e.classList.add("opened"),p&&B(e),"true"!=e.getAttribute("data-lockscroll")||document.body.classList.contains("noScroll")||(document.body.classList.add("noScroll"),g=!0),E(e),m(e)?(t.pushState({dialogId:n},"Dialog",n),window.addEventListener("popstate",a)):i.on(e,s)}function l(t){t.addEventListener("click",function(e){var n=t.getBoundingClientRect(),o=n.top<=e.clientY&&e.clientY<=n.top+n.height&&n.left<=e.clientX&&e.clientX<=n.left+n.width;o||s.parentWithTag(e.target,"SELECT")&&(o=!0),o||p(t)})}function d(t){e.autoFocus(t)}function f(t){t&&t.blur&&t!=document.body&&t.blur()}function u(t){var e=document.createElement("div");e.classList.add("dialogBackdrop"),t.parentNode.insertBefore(e,t),t.backdrop=e,setTimeout(function(){e.classList.add("opened")},0),e.addEventListener("click",function(){p(t)})}function m(t){return"true"==t.getAttribute("data-history")}function g(t){return M&&M(t),new Promise(function(e){new c(t,"dlg"+(new Date).getTime(),e)})}function v(t){return!t.classList.contains("hide")}function p(t){v(t)&&(m(t)?history.back():k(t))}function y(t,e){var n=[{transform:"scale(0)",offset:0},{transform:"none",offset:1}],o=t.animationConfig.entry.timing;return t.animate(n,o).onfinish=e}function h(t,e){var n=[{transform:"translate3d(0,30%,0)",opacity:0,offset:0},{transform:"none",opacity:1,offset:1}],o=t.animationConfig.entry.timing;return t.animate(n,o).onfinish=e}function b(t,e){var n=[{opacity:"0",offset:0},{opacity:"1",offset:1}],o=t.animationConfig.entry.timing;return t.animate(n,o).onfinish=e}function L(t){var e=[{transform:"none",opacity:1,offset:0},{transform:"scale(0)",opacity:0,offset:1}],n=t.animationConfig.exit.timing;return t.animate(e,n)}function w(t){var e=[{opacity:"1",offset:0},{opacity:"0",offset:1}],n=t.animationConfig.exit.timing;return t.animate(e,n)}function C(t){var e=[{transform:"none",opacity:1,offset:0},{transform:"translate3d(0,30%,0)",opacity:0,offset:1}],n=t.animationConfig.entry.timing;return t.animate(e,n)}function k(t){if(!t.classList.contains("hide")){var e=function(){t.classList.add("hide"),t.close?t.close():t.dispatchEvent(new CustomEvent("close",{bubbles:!1,cancelable:!1}))};if(!t.animationConfig||!t.animate)return void e();var n;if("fadeout"==t.animationConfig.exit.name)n=w(t);else if("scaledown"==t.animationConfig.exit.name)n=L(t);else{if("slidedown"!=t.animationConfig.exit.name)return void e();n=C(t)}n.onfinish=e}}function E(t){var e=function(){"true"==t.getAttribute("data-autofocus")&&d(t)};return t.animationConfig&&t.animate?void("fadein"==t.animationConfig.entry.name?b(t,e):"scaleup"==t.animationConfig.entry.name?y(t,e):"slideup"==t.animationConfig.entry.name&&h(t,e)):void e()}function A(t){return null!=t.lockScroll?t.lockScroll:"fullscreen"==t.size?!0:n.mobile}function B(t){t.style.marginLeft=-(t.offsetWidth/2)+"px",t.style.marginTop=-(t.offsetHeight/2)+"px"}function x(t){var e=t.backdrop;e&&(t.backdrop=null,e.classList.remove("opened"),setTimeout(function(){e.parentNode.removeChild(e)},300))}function S(e){e=e||{};var i=document.createElement("dialog");i=document.createElement(!i.showModal||n.tv?"div":"div"),i.classList.add("focuscontainer"),i.classList.add("hide"),A(e)&&i.setAttribute("data-lockscroll","true"),e.enableHistory!==!1&&t.enableNativeHistory()&&i.setAttribute("data-history","true"),e.modal!==!1&&i.setAttribute("modal","modal"),e.autoFocus!==!1&&i.setAttribute("data-autofocus","true");var s="scaleup",c=e.entryAnimation||s,l="scaledown",d=e.exitAnimation||l,f=e.entryAnimationDuration||(e.size?200:300),u=e.exitAnimationDuration||(e.size?200:300);return i.animationConfig={entry:{name:c,node:i,timing:{duration:f,easing:"ease-out"}},exit:{name:d,node:i,timing:{duration:u,easing:"ease-out",fill:"both"}}},r()||(i.animationConfig=null),i.classList.add("dialog"),e.scrollX?(i.classList.add("smoothScrollX"),o.tv&&a.centerFocus.on(i,!0)):e.scrollY!==!1&&(i.classList.add("smoothScrollY"),o.tv&&a.centerFocus.on(i,!1)),e.removeOnClose&&i.setAttribute("data-removeonclose","true"),e.size&&(i.classList.add("fixedSize"),i.classList.add(e.size)),i}var M;return{open:g,close:p,createDialog:S,setOnOpen:function(t){M=t}}});