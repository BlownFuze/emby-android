define(["itemHelper","mediaInfo","indicators","connectionManager","layoutManager","globalize","userdataButtons","apphost","css!./listview"],function(e,t,a,i,s,r,n,l){function d(e,t){if("disc"==t.index)return null==e.ParentIndexNumber?"":r.translate("sharedcomponents#ValueDiscNumber",e.ParentIndexNumber);var a,i,s=(t.sortBy||"").toLowerCase();return 0==s.indexOf("sortname")?"Episode"==e.Type?"":(i=(e.SortName||e.Name||"?")[0].toUpperCase(),a=i.charCodeAt(0),65>a||a>90?"#":i.toUpperCase()):0==s.indexOf("officialrating")?e.OfficialRating||r.translate("sharedcomponents#Unrated"):0==s.indexOf("communityrating")?null==e.CommunityRating?r.translate("sharedcomponents#Unrated"):Math.floor(e.CommunityRating):0==s.indexOf("criticrating")?null==e.CriticRating?r.translate("sharedcomponents#Unrated"):Math.floor(e.CriticRating):0==s.indexOf("metascore")?null==e.Metascore?r.translate("sharedcomponents#Unrated"):Math.floor(e.Metascore):0==s.indexOf("albumartist")&&e.AlbumArtist?(i=e.AlbumArtist[0].toUpperCase(),a=i.charCodeAt(0),65>a||a>90?"#":i.toUpperCase()):""}function o(e,t){var a=i.getApiClient(e.ServerId),s={width:t,type:"Primary"};return e.ImageTags&&e.ImageTags.Primary?(s.tag=e.ImageTags.Primary,a.getScaledImageUrl(e.Id,s)):e.AlbumId&&e.AlbumPrimaryImageTag?(s.tag=e.AlbumPrimaryImageTag,a.getScaledImageUrl(e.AlbumId,s)):e.SeriesId&&e.SeriesPrimaryImageTag?(s.tag=e.SeriesPrimaryImageTag,a.getScaledImageUrl(e.SeriesId,s)):e.ParentPrimaryImageTag?(s.tag=e.ParentPrimaryImageTag,a.getScaledImageUrl(e.ParentPrimaryImageItemId,s)):null}function m(e,t){for(var a="",i=0,s=e.length;s>i;i++)a+=0===i?t?'<h2 class="listItemBodyText">':'<div class="listItemBodyText">':'<div class="secondary listItemBodyText">',a+=e[i]||"&nbsp;",a+=0===i&&t?"</h2>":"</div>";return a}function c(i){for(var r=i.items,c="",I=i.action||"link",u="large"==i.imageSize,g=i.enableOverview,p=s.tv?!0:!1,y=p?"button":"div",v=null!=i.enableSideMediaInfo?i.enableSideMediaInfo:p,b="",f=0,h=r.length;h>f;f++){var P=r[f],T="";if(i.showIndex){var x=d(P,i);x!=c&&(T&&(T+="</div>"),T+=0==f?'<h1 class="listGroupHeader listGroupHeader-first">':'<h1 class="listGroupHeader">',T+=x,T+="</h1>",T+="<div>",c=x)}var A="listItem listItem-nosidepadding listItem-border";p&&(A+=" itemAction listItem-button"),s.tv&&(A+=" listItem-focusscale");var C=80;u&&(A+=" listItem-largeImage",C=500);var M=P.PlaylistItemId?' data-playlistitemid="'+P.PlaylistItemId+'"':"",S=P.UserData&&P.UserData.PlaybackPositionTicks?' data-positionticks="'+P.UserData.PlaybackPositionTicks+'"':"",U=i.collectionId?' data-collectionid="'+i.collectionId+'"':"",B=i.playlistId?' data-playlistid="'+i.playlistId+'"':"",w=P.MediaType?' data-mediatype="'+P.MediaType+'"':"",H=P.CollectionType?' data-collectiontype="'+P.CollectionType+'"':"",N=P.ChannelId?' data-channelid="'+P.ChannelId+'"':"";T+="<"+y+' class="'+A+'" data-index="'+f+'"'+M+' data-action="'+I+'" data-isfolder="'+P.IsFolder+'" data-id="'+P.Id+'" data-serverid="'+P.ServerId+'" data-type="'+P.Type+'"'+w+H+N+S+U+B+">",!p&&i.dragHandle&&(T+='<button is="paper-icon-button-light" class="listViewDragHandle autoSize listItemButton"><i class="md-icon">&#xE25D;</i></button>');var D=o(P,C),O=u?"listItemImage listItemImage-large":"listItemImage";T+=D?'<div class="'+O+' lazy" data-src="'+D+'" item-icon>':'<div class="'+O+'">';var k="";k+=a.getPlayedIndicatorHtml(P),k&&(T+='<div class="indicators listItemIndicators">'+k+"</div>");var z=a.getProgressBarHtml(P,{containerClass:"listItemProgressBar"});z&&(T+=z),T+="</div>";var E=[];i.showParentTitle&&"Episode"==P.Type&&E.push(P.SeriesName||"&nbsp;");var G=e.getDisplayName(P);i.showIndexNumber&&null!=P.IndexNumber&&(G=P.IndexNumber+". "+G),E.push(G),P.ArtistItems&&"MusicAlbum"!=P.Type&&E.push(P.ArtistItems.map(function(e){return e.Name}).join(", ")||"&nbsp;"),P.AlbumArtist&&"MusicAlbum"==P.Type&&E.push(P.AlbumArtist||"&nbsp;"),"Game"==P.Type&&E.push(P.GameSystem||"&nbsp;"),"TvChannel"==P.Type&&P.CurrentProgram&&E.push(e.getDisplayName(P.CurrentProgram)),A="listItemBody",p||(A+=" itemAction"),T+='<div class="'+A+'">';var R="dots-horiz"==l.moreIcon?"&#xE5D3;":"&#xE5D4;";if(T+=m(E,u),!v){var V="secondary listItemMediaInfo listItemBodyText";s.tv&&(V+=" listItemMediaInfo-padded"),T+='<div class="'+V+'">'+t.getPrimaryMediaInfoHtml(P)+"</div>"}g&&P.Overview&&(T+='<div class="secondary overview listItemBodyText">',T+=P.Overview,T+="</div>"),T+="</div>",v&&(T+='<div class="secondary listItemMediaInfo">'+t.getPrimaryMediaInfoHtml(P,{year:!1,container:!1})+"</div>"),p||(T+='<button is="paper-icon-button-light" class="listItemButton itemAction autoSize" data-action="menu"><i class="md-icon">'+R+"</i></button>",T+='<span class="listViewUserDataButtons">',T+=n.getIconsHtml({item:P,includePlayed:!1,cssClass:"listItemButton"}),T+="</span>"),T+="</"+y+">",b+=T}return b}return{getListViewHtml:c}});