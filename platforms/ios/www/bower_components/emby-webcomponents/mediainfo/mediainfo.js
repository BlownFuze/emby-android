define(["datetime","globalize","embyRouter","material-icons","css!./mediainfo.css"],function(e,t,i){function a(t,i){var a,n,r="",o=[];if(t.ChannelName&&o.push(i.interactive&&t.ChannelId?'<a class="lnkChannel" data-id="'+t.ChannelId+'" data-serverid="'+t.ServerId+'" href="#">'+t.ChannelName+"</a>":t.ChannelName),t.StartDate)try{n=e.parseISO8601Date(t.StartDate),a=n.toLocaleDateString(),a+=", "+e.getDisplayTime(n),t.EndDate&&(n=e.parseISO8601Date(t.EndDate),a+=" - "+e.getDisplayTime(n)),o.push(a)}catch(d){}return t.ChannelNumber&&o.push("CH "+t.ChannelNumber),t.SeriesTimerId?o.push({html:'<i class="md-icon mediaInfoItem mediaInfoTimerIcon mediaInfoIconItem">&#xE062;</i>'}):t.TimerId&&o.push({html:'<i class="md-icon mediaInfoItem mediaInfoTimerIcon mediaInfoIconItem">&#xE061;</i>'}),r+=o.map(function(e){return s(e)}).join("")}function n(i,a){var n="",o=[];a=a||{};var m,u,c,l="MusicAlbum"==i.Type||"MusicArtist"==i.MediaType||"Playlist"==i.MediaType||"MusicGenre"==i.MediaType;if(l){var p=i.SongCount||i.ChildCount;p&&o.push(t.translate("sharedcomponents#TrackCount",p)),i.RunTimeTicks&&o.push(e.getDisplayRunningTime(i.RunTimeTicks))}else if("PhotoAlbum"==i.Type||"BoxSet"==i.Type){var p=i.ChildCount;p&&o.push(t.translate("sharedcomponents#ItemCount",p))}if(("Episode"==i.Type||"Photo"==i.MediaType)&&i.PremiereDate)try{u=e.parseISO8601Date(i.PremiereDate),m=u.toLocaleDateString(),o.push(m)}catch(f){}if(i.StartDate&&"Program"!=i.Type)try{u=e.parseISO8601Date(i.StartDate),m=u.toLocaleDateString(),o.push(m),"Recording"!=i.Type&&(m=e.getDisplayTime(u),o.push(m))}catch(f){}if(a.year!==!1&&i.ProductionYear&&"Series"==i.Type)if("Continuing"==i.Status)o.push(t.translate("sharedcomponents#ValueSeriesYearToPresent",i.ProductionYear));else if(i.ProductionYear){if(m=i.ProductionYear,i.EndDate)try{var h=e.parseISO8601Date(i.EndDate).getFullYear();h!=i.ProductionYear&&(m+="-"+e.parseISO8601Date(i.EndDate).getFullYear())}catch(f){}o.push(m)}if("Program"==i.Type)if(i.IsLive?o.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem">'+t.translate("sharedcomponents#AttributeLive")+"</div>"}):i.IsPremiere?o.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem">'+t.translate("sharedcomponents#AttributePremiere")+"</div>"}):i.IsSeries&&!i.IsRepeat&&o.push({html:'<div class="mediaInfoProgramAttribute mediaInfoItem">'+t.translate("sharedcomponents#AttributeNew")+"</div>"}),i.PremiereDate)try{u=e.parseISO8601Date(i.PremiereDate),m=t.translate("sharedcomponents#OriginalAirDateValue",u.toLocaleDateString()),o.push(m)}catch(f){}else i.ProductionYear&&(m=t.translate("sharedcomponents#ReleaseYearValue",i.ProductionYear),o.push(m));if("Series"!=i.Type&&"Episode"!=i.Type&&"Person"!=i.Type&&"Photo"!=i.MediaType&&"Program"!=i.Type)if(i.ProductionYear)o.push(i.ProductionYear);else if(i.PremiereDate)try{m=e.parseISO8601Date(i.PremiereDate).getFullYear(),o.push(m)}catch(f){}if(i.RunTimeTicks&&"Series"!=i.Type&&"Program"!=i.Type&&!l&&a.runtime!==!1&&("Audio"==i.Type?o.push(e.getDisplayRunningTime(i.RunTimeTicks)):(c=i.RunTimeTicks/6e8,c=c||1,o.push(Math.round(c)+" mins"))),i.OfficialRating&&"Season"!==i.Type&&"Episode"!==i.Type&&o.push({text:i.OfficialRating,cssClass:"mediaInfoOfficialRating"}),i.Video3DFormat&&o.push("3D"),"Photo"==i.MediaType&&i.Width&&i.Height&&o.push(i.Width+"x"+i.Height),a.container!==!1&&"Audio"==i.Type&&i.Container&&o.push(i.Container),n+=o.map(function(e){return s(e)}).join(""),n+=d(i),i.HasSubtitles&&a.subtitles!==!1&&(n+='<i class="md-icon mediaInfoItem closedCaptionIcon mediaInfoIconItem">&#xE01C;</i>'),i.CriticRating&&a.criticRating!==!1&&(n+=i.CriticRating>=60?'<div class="mediaInfoItem mediaInfoCriticRating mediaInfoCriticRatingFresh">'+i.CriticRating+"</div>":'<div class="mediaInfoItem mediaInfoCriticRating mediaInfoCriticRatingRotten">'+i.CriticRating+"</div>"),a.endsAt!==!1){var I=r(i);I&&(n+=s(I,"endsAt"))}return n}function r(i){if("Video"==i.MediaType&&i.RunTimeTicks&&!i.StartDate){var a=(new Date).getTime()+i.RunTimeTicks/1e4;a=new Date(a);var n=e.getDisplayTime(a);return t.translate("sharedcomponents#EndsAtValue",n)}return null}function o(i,a,n){var r=(new Date).getTime()+(i-(a||0))/1e4;r=new Date(r);var o=e.getDisplayTime(r);return n===!1?o:t.translate("sharedcomponents#EndsAtValue",o)}function s(e,t){t=t?t+" mediaInfoItem":"mediaInfoItem";var i=e;if("string"!=typeof e&&"number"!=typeof e){if(e.html)return e.html;i=e.text,t+=" "+e.cssClass}return'<div class="'+t+'">'+i+"</div>"}function d(e){var t="",i=e.CommunityRating;return i&&(t+='<div class="starRatingContainer mediaInfoItem">',t+='<i class="md-icon starIcon">&#xE838;</i>',t+=i,t+="</div>"),t}function m(e,t){var i=setInterval(function(){return document.body.contains(e)?void(e.innerHTML=r(t)):void clearInterval(i)},6e4)}function u(e,t,i){var a=f(t,i);e.innerHTML=a,l(e,t,i)}function c(e,t,i){var a=h(t,i);e.innerHTML=a,l(e,t,i)}function l(e,t,i){if(i.endsAt!==!1){var a=e.querySelector(".endsAt");a&&m(a,t)}var n=e.querySelector(".lnkChannel");n&&n.addEventListener("click",p)}function p(e){var t=this.getAttribute("data-id"),a=this.getAttribute("data-serverid");return i.showItem(t,a),e.preventDefault(),!1}function f(e,t){return t=t||{},null==t.interactive&&(t.interactive=!1),"Program"==e.Type?a(e,t):n(e,t)}function h(e,t){return t=t||{},null==t.interactive&&(t.interactive=!1),"Program"==e.Type?n(e,t):""}return{getMediaInfoHtml:f,fill:u,getEndsAt:r,getEndsAtFromPosition:o,getPrimaryMediaInfoHtml:f,getSecondaryMediaInfoHtml:h,fillPrimaryMediaInfo:u,fillSecondaryMediaInfo:c}});