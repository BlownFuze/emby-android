define(["browser","layoutManager","dom","scrollStyles"],function(e,t,n){function o(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?Object.prototype.toString.call(e).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof e}function r(e,t){e.preventDefault(),t&&e.stopPropagation()}function i(e){r(e,1),this.removeEventListener(e.type,i)}function a(e,t,n){return t>e?t:e>n?n:e}var s=["mousemove","mouseup"],l=["touchmove","touchend"],d=document.implementation.hasFeature("Event.wheel","3.0")?"wheel":"mousewheel",c=["INPUT","SELECT","TEXTAREA"],u=Math.abs,h=Math.sqrt,f=Math.pow,v=Math.round,p=Math.max,m=(Math.min,function(m,g){function E(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}function w(e){F=z(A,R.horizontal?"width":"height");var t=R.scrollWidth||Math.max(q[R.horizontal?"offsetWidth":"offsetHeight"],q[R.horizontal?"scrollWidth":"scrollHeight"]);I.start=0,I.end=p(t-F,0),e||S(a(I.dest,I.start,I.end))}function z(e,t,n){var o=!0,r="width"===t?e.offsetWidth:e.offsetHeight,i=getComputedStyle(e,null),a="border-box"===i.getPropertyValue("box-sizing");if(0>=r||null==r){if((0>r||null==r)&&(r=e.style[t]),_.test(r))return r;o=a&&(support.boxSizingReliable()||r===e.style[t]),r=parseFloat(r)||0}return r+y(e,t,n||(a?"border":"content"),o,i)}function y(e,t,n,o){for(var r=n===(o?"border":"content")?4:"width"===t?1:0,i=0;4>r;r+=2);return i}function L(e,t,n){!n&&e.scrollTo?R.horizontal?e.scrollTo(t,0):e.scrollTo(0,t):R.horizontal?e.scrollLeft=Math.round(t):e.scrollTop=Math.round(t)}function S(e,t){return e=a(e,I.start,I.end),V?(J.from=I.cur,J.to=e,J.tweesing=K.tweese||K.init&&!K.slidee,J.immediate=!J.tweesing&&(t||K.init&&K.slidee||!R.speed),K.tweese=0,void(e!==I.dest&&(I.dest=e,T(J)))):void L(q,e,t)}function T(){var t=getComputedStyle(q,null).getPropertyValue("transform").match(/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/);t&&(I.cur=-1*parseInt(R.horizontal?t[1]:t[2]));var n;J.to=v(J.to),n=R.horizontal?[{transform:"translate3d("+-v(I.cur||J.from)+"px, 0, 0)",offset:0},{transform:"translate3d("+-v(J.to)+"px, 0, 0)",offset:1}]:[{transform:"translate3d(0, "+-v(I.cur||J.from)+"px, 0)",offset:0},{transform:"translate3d(0, "+-v(J.to)+"px, 0)",offset:1}];var o=R.speed;J.immediate&&(o=R.immediateSpeed||50,e.animate||(R.immediateSpeed=0));var r={duration:o,iterations:1,fill:"both"};e.animate&&(r.easing="ease-out");var i=q.animate(n,r);i.onfinish=function(){I.cur=J.to,document.dispatchEvent(et)}}function b(e){return e.getBoundingClientRect?e.getBoundingClientRect():{top:0,left:0}}function C(e,t,n){if("boolean"===o(t)&&(n=t,t=void 0),void 0===t)S(I[e],n);else{var r=O.getPos(t);r&&S(r[e],n,!0)}}function x(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}function P(e){K.released=0,K.source=e,K.slidee="slidee"===e}function X(e){Y(e,"slidee")}function Y(e,t){var o="touchstart"===e.type,i="slidee"===t;if(!(K.init||!o&&M(e.target)||i&&!(o?R.touchDragging:R.mouseDragging&&e.which<2))){o||r(e),P(t),K.init=0,K.source=e.target,K.touch=o;var a=o?e.touches[0]:e;K.initX=a.pageX,K.initY=a.pageY,K.initPos=i?I.cur:U.cur,K.start=+new Date,K.time=0,K.path=0,K.delta=0,K.locked=0,K.pathToLock=i?o?30:10:0,o?l.forEach(function(e){n.addEventListener(document,e,D,{passive:!0})}):s.forEach(function(e){n.addEventListener(document,e,D,{passive:!0})}),i&&q.classList.add(R.draggedClass)}}function D(e){K.released="mouseup"===e.type||"touchend"===e.type;var t=K.touch?e[K.released?"changedTouches":"touches"][0]:e;if(K.pathX=t.pageX-K.initX,K.pathY=t.pageY-K.initY,K.path=h(f(K.pathX,2)+f(K.pathY,2)),K.delta=R.horizontal?K.pathX:K.pathY,K.released||!(K.path<1)){if(!K.init){if(K.path<R.dragThreshold)return K.released?k():void 0;if(!(R.horizontal?u(K.pathX)>u(K.pathY):u(K.pathX)<u(K.pathY)))return k();K.init=1}r(e),!K.locked&&K.path>K.pathToLock&&K.slidee&&(K.locked=1,K.source.addEventListener("click",i)),K.released&&k(),S(K.slidee?v(K.initPos-K.delta):handleToSlidee(K.initPos+K.delta))}}function k(){K.released=!0,K.touch?l.forEach(function(e){n.removeEventListener(document,e,D,{passive:!0})}):s.forEach(function(e){n.removeEventListener(document,e,D,{passive:!0})}),K.slidee&&q.classList.remove(R.draggedClass),setTimeout(function(){K.source.removeEventListener("click",i)}),K.init=0}function M(e){for(;e;){if(-1!=c.indexOf(e.tagName))return!0;e=e.parentNode}return!1}function B(e){return Q.curDelta=(R.horizontal?e.deltaY||e.deltaX:e.deltaY)||-e.wheelDelta,V&&(Q.curDelta/=1===e.deltaMode?3:100),Q.curDelta}function N(e){if(R.scrollBy&&I.start!==I.end){var t=B(e);V?(t>0&&I.dest<I.end||0>t&&I.dest>I.start,O.slideBy(R.scrollBy*t)):(j&&(t*=12),R.horizontal?q.scrollLeft+=t:q.scrollTop+=t)}}function W(){w(!1)}function H(){R.horizontal?this.scrollLeft=0:this.scrollTop=0}var R=x({},{slidee:null,horizontal:!1,scrollSource:null,scrollBy:0,scrollHijack:300,dragSource:null,mouseDragging:1,touchDragging:1,swingSpeed:.2,dragThreshold:3,intervactive:null,speed:0,draggedClass:"dragged",activeClass:"active",disabledClass:"disabled"},g),j="scrollBehavior"in document.documentElement.style;j&&e.firefox?g.enableNativeScroll=!0:g.requireAnimation?g.enableNativeScroll=!1:(t.desktop||!e.animate)&&(g.enableNativeScroll=!0);var O=this;O.options=R;var A=m,q=R.slidee?R.slidee:E(A.firstChild)[0],F=0,I={start:0,center:0,end:0,cur:0,dest:0},V=!g.enableNativeScroll,U={start:0,end:0,cur:0},$=R.scrollSource?R.scrollSource:A,G=R.dragSource?R.dragSource:A,J={},K={released:1},Q={last:0,delta:0,resetTime:200};m=A,O.initialized=0,O.frame=m,O.slidee=q,O.options=R,O.dragging=K;var Z=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,_=new RegExp("^("+Z+")(?!px)[a-z%]+$","i");O.reload=function(){w()};var et=new CustomEvent("scroll");O.getPos=function(e){var t=b(q),n=b(e),o=R.horizontal?n.left-t.left:n.top-t.top,r=R.horizontal?n.width:n.height;r||0===r||(r=e[R.horizontal?"offsetWidth":"offsetHeight"]);var i=R.centerOffset||0;return V||(i=0,o+=R.horizontal?q.scrollLeft:q.scrollTop),{start:o,center:o+i-F/2+r/2,end:o-F+r,size:r}},O.getCenterPosition=function(e){var t=O.getPos(e);return a(t.center,t.start,t.end)},O.slideBy=function(e,t){e&&S(I.dest+e,t)},O.slideTo=function(e,t){S(e,t)},O.toStart=function(e,t){C("start",e,t)},O.toEnd=function(e,t){C("end",e,t)},O.toCenter=function(e,t){C("center",e,t)},O.destroy=function(){return n.removeEventListener(window,"resize",W,{passive:!0}),n.removeEventListener(A,"scroll",H,{passive:!0}),n.removeEventListener($,d,N,{passive:!0}),n.removeEventListener(G,"touchstart",X,{passive:!0}),G.removeEventListener("mousedown",X),O.initialized=0,O},O.init=function(){if(!O.initialized){if(m.sly)throw new Error("There is already a Sly instance on this element");m.sly=!0;var e=[];return q&&e.push(q),V?q.style["will-change"]="transform":q.classList.add(R.horizontal?t.desktop?"smoothScrollX":"hiddenScrollX":t.desktop?"smoothScrollY":"hiddenScrollY"),V?(n.addEventListener(G,"touchstart",X,{passive:!0}),G.addEventListener("mousedown",X),R.scrollWidth||n.addEventListener(window,"resize",W,{passive:!0}),R.horizontal||n.addEventListener(A,"scroll",H,{passive:!0}),n.addEventListener($,d,N,{passive:!0})):R.horizontal&&n.addEventListener($,d,N,{passive:!0}),O.initialized=1,w(!0),O}}});return m.create=function(e,t){var n=new m(e,t);return Promise.resolve(n)},m});