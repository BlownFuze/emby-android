define(["dialogHelper","inputManager","connectionManager","layoutManager","focusManager","apphost","css!./style","html!./icons","iron-icon-set","paper-icon-button","paper-spinner"],function(e,t,i,a,n,o){function s(e,t,i){return t=t||{},t.type=t.type||"Primary","string"==typeof e?i.getScaledImageUrl(e,t):e.ImageTags&&e.ImageTags[t.type]?(t.tag=e.ImageTags[t.type],i.getScaledImageUrl(e.Id,t)):"Primary"==t.type&&e.AlbumId&&e.AlbumPrimaryImageTag?(t.tag=e.AlbumPrimaryImageTag,i.getScaledImageUrl(e.AlbumId,t)):null}function r(e,t,i){return t=t||{},t.type=t.type||"Backdrop",t.width=null,delete t.width,t.maxWidth=null,delete t.maxWidth,t.maxHeight=null,delete t.maxHeight,t.height=null,delete t.height,t.maxWidth||t.width||t.maxHeight||t.height||(t.quality=100),e.BackdropImageTags&&e.BackdropImageTags.length?(t.tag=e.BackdropImageTags[0],i.getScaledImageUrl(e.Id,t)):null}function l(e,t){var a=i.getApiClient(e.ServerId),n={};return t||(n.maxWidth=screen.availWidth),e.BackdropImageTags&&e.BackdropImageTags.length?r(e,n,a):"Photo"==e.MediaType&&t?a.getUrl("Items/"+e.Id+"/Download",{api_key:a.accessToken()}):(n.type="Primary",s(e,n,a))}return function(i){function s(i){z=e.createDialog({exitAnimationDuration:i.interactive?400:800,size:"fullscreen",autoFocus:!1}),z.classList.add("slideshowDialog");var n="";if(i.interactive){var s=a.mobile;n+="<div>",n+='<div class="slideshowSwiperContainer"><div class="swiper-wrapper"></div></div>',n+='<paper-icon-button icon="slideshow:keyboard-arrow-left" class="btnSlideshowPrevious slideshowButton" tabindex="-1"></paper-icon-button>',n+='<paper-icon-button icon="slideshow:keyboard-arrow-right" class="btnSlideshowNext slideshowButton" tabindex="-1"></paper-icon-button>',n+='<div class="topActionButtons">',s&&(o.supports("filedownload")&&(n+='<paper-icon-button icon="slideshow:file-download" class="btnDownload slideshowButton"></paper-icon-button>'),o.supports("sharing")&&(n+='<paper-icon-button icon="slideshow:share" class="btnShare slideshowButton"></paper-icon-button>')),n+='<paper-icon-button icon="slideshow:close" class="btnSlideshowExit" tabindex="-1"></paper-icon-button>',n+="</div>",s||(n+='<div class="slideshowBottomBar hide">',n+='<paper-icon-button icon="slideshow:pause" class="btnSlideshowPause slideshowButton" autoFocus></paper-icon-button>',o.supports("filedownload")&&(n+='<paper-icon-button icon="slideshow:file-download" class="btnDownload slideshowButton"></paper-icon-button>'),o.supports("sharing")&&(n+='<paper-icon-button icon="slideshow:share" class="btnShare slideshowButton"></paper-icon-button>'),n+="</div>"),n+="</div>"}else n+='<div class="slideshowImage"></div><h1 class="slideshowImageText"></h1>';if(z.innerHTML=n,i.interactive){z.querySelector(".btnSlideshowExit").addEventListener("click",function(){e.close(z)}),z.querySelector(".btnSlideshowNext").addEventListener("click",m),z.querySelector(".btnSlideshowPrevious").addEventListener("click",h);var l=z.querySelector(".btnSlideshowPause");l&&l.addEventListener("click",b);var d=z.querySelector(".btnDownload");d&&d.addEventListener("click",v);var c=z.querySelector(".btnShare");c&&c.addEventListener("click",g)}document.body.appendChild(z),e.open(z).then(function(){N(),z.parentNode.removeChild(z)}),t.on(window,M),document.addEventListener("mousemove",E),z.addEventListener("close",I),i.interactive&&r(z)}function r(e){e.querySelector(".swiper-wrapper").innerHTML=W.slides?W.slides.map(p).join(""):W.items.map(d).join(""),require(["swiper"],function(){H=new Swiper(e.querySelector(".slideshowSwiperContainer"),{direction:"horizontal",loop:i.loop!==!1,autoplay:i.interval||8e3,preloadImages:!1,lazyLoading:!0,autoplayDisableOnInteraction:!1,initialSlide:i.startIndex||0}),H.on("onLazyImageLoad",c),H.on("onLazyImageReady",u),a.mobile?y():w()})}function d(e){return p({imageUrl:l(e),originalImage:l(e,!0),Id:e.Id,ServerId:e.ServerId})}function c(e,t){var i=t.querySelector("paper-spinner");i&&(i.active=!0)}function u(e,t){var i=t.querySelector("paper-spinner");i&&(i.active=!1,i.parentNode.removeChild(i))}function p(e){var t="";return t+='<div class="swiper-slide" data-original="'+e.originalImage+'" data-itemid="'+e.Id+'" data-serverid="'+e.ServerId+'">',t+='<img data-src="'+e.imageUrl+'" class="swiper-lazy">',t+="<paper-spinner></paper-spinner>",(e.title||e.subtitle)&&(t+='<div class="slideText">',t+='<div class="slideTextInner">',e.title&&(t+='<div class="slideTitle">',t+=e.title,t+="</div>"),e.description&&(t+='<div class="slideSubtitle">',t+=e.description,t+="</div>"),t+="</div>",t+="</div>"),t+="</div>"}function h(){H?H.slidePrev():(N(),D(F-1))}function m(){if(H){if(i.loop===!1&&H.activeIndex>=H.slides.length-1)return void e.close(z);H.slideNext()}else N(),D(F+1)}function f(){if(H){var e=document.querySelector(".swiper-slide-active");return e?{url:e.getAttribute("data-original"),itemId:e.getAttribute("data-itemid"),serverId:e.getAttribute("data-serverid")}:null}return null}function v(){var e=f();require(["fileDownloader"],function(t){t.download([e])})}function g(){var e=f();require(["sharingmanager"],function(t){t.showMenu(e)})}function w(){var e=z.querySelector(".btnSlideshowPause");e&&(e.icon="slideshow:pause"),H.startAutoplay()}function y(){var e=z.querySelector(".btnSlideshowPause");e&&(e.icon="slideshow:play-arrow"),H.stopAutoplay()}function b(){var e="slideshow:pause"!=z.querySelector(".btnSlideshowPause").icon;e?w():y()}function I(){var e=H;e&&(e.off("onLazyImageLoad"),e.off("onLazyImageReady"),e.destroy(!0,!0),H=null),t.off(window,M),document.removeEventListener("mousemove",E)}function S(e){W=e,N(),s(e),e.interactive||(U=e.interval||8e3,D(e.startIndex||0,!0))}function x(){return X}function L(){return z.querySelector(".slideshowBottomBar")}function T(){var e=L();e&&(P(e),k())}function q(){var e=L();e&&A(e)}function k(){B(),j=setTimeout(q,4e3)}function B(){j&&(clearTimeout(j),j=null)}function P(e){e.classList.contains("hide")&&(X=!0,e.classList.remove("hide"),requestAnimationFrame(function(){var t=[{transform:"translate3d(0,"+e.offsetHeight+"px,0)",opacity:".3",offset:0},{transform:"translate3d(0,0,0)",opacity:"1",offset:1}],i={duration:300,iterations:1,easing:"ease-out"};e.animate(t,i).onfinish=function(){n.focus(e.querySelector(".btnSlideshowPause"))}}))}function A(e){e.classList.contains("hide")||requestAnimationFrame(function(){var t=[{transform:"translate3d(0,0,0)",opacity:"1",offset:0},{transform:"translate3d(0,"+e.offsetHeight+"px,0)",opacity:".3",offset:1}],i={duration:300,iterations:1,easing:"ease-out"};e.animate(t,i).onfinish=function(){e.classList.add("hide"),X=!1}})}function E(e){var t=e.screenX||0,i=e.screenY||0,a=R;return a?void(Math.abs(t-a.x)<10&&Math.abs(i-a.y)<10||(a.x=t,a.y=i,T())):void(R={x:t,y:i})}function M(e){switch(e.detail.command){case"left":x()||(e.preventDefault(),h());break;case"right":x()||(e.preventDefault(),m());break;case"up":case"down":case"select":case"menu":case"info":case"play":case"playpause":case"pause":case"fastforward":case"rewind":case"next":case"previous":T()}}function D(e,t){e=Math.max(0,e),e>=W.items.length&&(e=0),F=e;var i=W,a=i.items,n=a[e],o=l(n),s=function(){var t=z.querySelector(".slideshowImage"),a=document.createElement("div");a.className=t.className,i.cover&&a.classList.add("cover"),a.style.backgroundImage="url('"+o+"')",a.classList.add("hide"),t.parentNode.appendChild(a),z.querySelector(".slideshowImageText").innerHTML=i.showTitle?n.Name:"",a.classList.remove("hide");var s=function(){var e=t.parentNode;e&&e.removeChild(t)};if(a.animate){var r=[{opacity:"0",offset:0},{opacity:"1",offset:1}],l={duration:1200,iterations:1};a.animate(r,l).onfinish=s}else s();N(),C=setTimeout(function(){D(e+1,!0)},U)};if(t)s();else{var r=new Image;r.onload=s,r.src=o}}function N(){C&&(clearTimeout(C),C=null)}var H,z,C,U,W,F,j,R,O=this,X=!1;O.show=function(){S(i)},O.hide=function(){var t=z;t&&e.close(t)}}});