define(["dialogHelper","inputManager","connectionManager","layoutManager","focusManager","apphost","loading","css!./style","material-icons","paper-icon-button-light"],function(e,t,i,a,n,o){function r(e,t,i){return t=t||{},t.type=t.type||"Primary","string"==typeof e?i.getScaledImageUrl(e,t):e.ImageTags&&e.ImageTags[t.type]?(t.tag=e.ImageTags[t.type],i.getScaledImageUrl(e.Id,t)):"Primary"==t.type&&e.AlbumId&&e.AlbumPrimaryImageTag?(t.tag=e.AlbumPrimaryImageTag,i.getScaledImageUrl(e.AlbumId,t)):null}function s(e,t,i){return t=t||{},t.type=t.type||"Backdrop",t.maxWidth||t.width||t.maxHeight||t.height||(t.quality=100),e.BackdropImageTags&&e.BackdropImageTags.length?(t.tag=e.BackdropImageTags[0],i.getScaledImageUrl(e.Id,t)):null}function l(e,t){var a=i.getApiClient(e.ServerId),n={};return t||(n.maxWidth=screen.availWidth),e.BackdropImageTags&&e.BackdropImageTags.length?s(e,n,a):"Photo"==e.MediaType&&t?a.getUrl("Items/"+e.Id+"/Download",{api_key:a.accessToken()}):(n.type="Primary",r(e,n,a))}function d(e,t,i,a){var n=i?"":' tabindex="-1"';return a=a?" autofocus":"",'<button is="paper-icon-button-light" class="autoSize '+t+'"'+n+a+'><i class="md-icon slideshowButtonIcon">'+e+"</i></button>"}return function(i){function r(i){_=e.createDialog({exitAnimationDuration:i.interactive?400:800,size:"fullscreen",autoFocus:!1,scrollY:!1,exitAnimation:"fadeout"}),_.classList.add("slideshowDialog");var n="";if(i.interactive){var r=a.mobile;n+="<div>",n+='<div class="slideshowSwiperContainer"><div class="swiper-wrapper"></div></div>',n+=d("keyboard_arrow_left","btnSlideshowPrevious slideshowButton",!1),n+=d("keyboard_arrow_right","btnSlideshowNext slideshowButton",!1),n+='<div class="topActionButtons">',r&&(o.supports("filedownload")&&(n+=d("file_download","btnDownload slideshowButton",!0)),o.supports("sharing")&&(n+=d("share","btnShare slideshowButton",!0))),n+=d("close","slideshowButton btnSlideshowExit",!1),n+="</div>",r||(n+='<div class="slideshowBottomBar hide">',n+=d("pause","btnSlideshowPause slideshowButton",!0,!0),o.supports("filedownload")&&(n+=d("file_download","btnDownload slideshowButton",!0)),o.supports("sharing")&&(n+=d("share","btnShare slideshowButton",!0)),n+="</div>"),n+="</div>"}else n+='<div class="slideshowImage"></div><h1 class="slideshowImageText"></h1>';if(_.innerHTML=n,i.interactive){_.querySelector(".btnSlideshowExit").addEventListener("click",function(){e.close(_)}),_.querySelector(".btnSlideshowNext").addEventListener("click",p),_.querySelector(".btnSlideshowPrevious").addEventListener("click",v);var l=_.querySelector(".btnSlideshowPause");l&&l.addEventListener("click",S);var c=_.querySelector(".btnDownload");c&&c.addEventListener("click",h);var u=_.querySelector(".btnShare");u&&u.addEventListener("click",w)}document.body.appendChild(_),e.open(_).then(function(){H(),_.parentNode.removeChild(_)}),t.on(window,D),document.addEventListener("mousemove",E),_.addEventListener("close",b),i.interactive&&s(_)}function s(e){e.querySelector(".swiper-wrapper").innerHTML=F.slides?F.slides.map(m).join(""):F.items.map(c).join(""),require(["swiper"],function(){N=new Swiper(e.querySelector(".slideshowSwiperContainer"),{direction:"horizontal",loop:i.loop!==!1,autoplay:i.interval||8e3,preloadImages:!1,lazyLoading:!0,lazyLoadingInPrevNext:!0,autoplayDisableOnInteraction:!1,initialSlide:i.startIndex||0,speed:240}),N.on("onLazyImageLoad",u),N.on("onLazyImageReady",f),a.mobile?I():y()})}function c(e){return m({imageUrl:l(e),originalImage:l(e,!0),Id:e.Id,ServerId:e.ServerId})}function u(){}function f(){}function m(e){var t="";return t+='<div class="swiper-slide" data-original="'+e.originalImage+'" data-itemid="'+e.Id+'" data-serverid="'+e.ServerId+'">',t+='<img data-src="'+e.imageUrl+'" class="swiper-lazy swiper-slide-img">',(e.title||e.subtitle)&&(t+='<div class="slideText">',t+='<div class="slideTextInner">',e.title&&(t+='<div class="slideTitle">',t+=e.title,t+="</div>"),e.description&&(t+='<div class="slideSubtitle">',t+=e.description,t+="</div>"),t+="</div>",t+="</div>"),t+="</div>"}function v(){N?N.slidePrev():(H(),z(W-1))}function p(){if(N){if(i.loop===!1&&N.activeIndex>=N.slides.length-1)return void e.close(_);N.slideNext()}else H(),z(W+1)}function g(){if(N){var e=document.querySelector(".swiper-slide-active");return e?{url:e.getAttribute("data-original"),itemId:e.getAttribute("data-itemid"),serverId:e.getAttribute("data-serverid")}:null}return null}function h(){var e=g();require(["fileDownloader"],function(t){t.download([e])})}function w(){var e=g();require(["sharingmanager"],function(t){t.showMenu(e)})}function y(){var e=_.querySelector(".btnSlideshowPause i");e&&(e.innerHTML="pause"),N.startAutoplay()}function I(){var e=_.querySelector(".btnSlideshowPause i");e&&(e.innerHTML="play_arrow"),N.stopAutoplay()}function S(){var e="pause"!=_.querySelector(".btnSlideshowPause i").innerHTML;e?y():I()}function b(){var e=N;e&&(e.off("onLazyImageLoad"),e.off("onLazyImageReady"),e.destroy(!0,!0),N=null),t.off(window,D),document.removeEventListener("mousemove",E)}function L(e){F=e,H(),r(e),e.interactive||(U=e.interval||8e3,z(e.startIndex||0,!0))}function T(){return O}function x(){return _.querySelector(".slideshowBottomBar")}function q(){var e=x();e&&(A(e),k())}function B(){var e=x();e&&M(e)}function k(){P(),j=setTimeout(B,4e3)}function P(){j&&(clearTimeout(j),j=null)}function A(e){e.classList.contains("hide")&&(O=!0,e.classList.remove("hide"),requestAnimationFrame(function(){var t=[{transform:"translate3d(0,"+e.offsetHeight+"px,0)",opacity:".3",offset:0},{transform:"translate3d(0,0,0)",opacity:"1",offset:1}],i={duration:300,iterations:1,easing:"ease-out"};e.animate(t,i).onfinish=function(){n.focus(e.querySelector(".btnSlideshowPause"))}}))}function M(e){e.classList.contains("hide")||requestAnimationFrame(function(){var t=[{transform:"translate3d(0,0,0)",opacity:"1",offset:0},{transform:"translate3d(0,"+e.offsetHeight+"px,0)",opacity:".3",offset:1}],i={duration:300,iterations:1,easing:"ease-out"};e.animate(t,i).onfinish=function(){e.classList.add("hide"),O=!1}})}function E(e){var t=e.screenX||0,i=e.screenY||0,a=R;return a?void(Math.abs(t-a.x)<10&&Math.abs(i-a.y)<10||(a.x=t,a.y=i,q())):void(R={x:t,y:i})}function D(e){switch(e.detail.command){case"left":T()||(e.preventDefault(),v());break;case"right":T()||(e.preventDefault(),p());break;case"up":case"down":case"select":case"menu":case"info":case"play":case"playpause":case"pause":case"fastforward":case"rewind":case"next":case"previous":q()}}function z(e,t){e=Math.max(0,e),e>=F.items.length&&(e=0),W=e;var i=F,a=i.items,n=a[e],o=l(n),r=function(){var t=_.querySelector(".slideshowImage"),a=document.createElement("div");a.className=t.className,i.cover&&a.classList.add("slideshowImage-cover"),a.style.backgroundImage="url('"+o+"')",a.classList.add("hide"),t.parentNode.appendChild(a),_.querySelector(".slideshowImageText").innerHTML=i.showTitle?n.Name:"",a.classList.remove("hide");var r=function(){var e=t.parentNode;e&&e.removeChild(t)};if(a.animate){var s=[{opacity:"0",offset:0},{opacity:"1",offset:1}],l={duration:1200,iterations:1};a.animate(s,l).onfinish=r}else r();H(),C=setTimeout(function(){z(e+1,!0)},U)};if(t)r();else{var s=new Image;s.onload=r,s.src=o}}function H(){C&&(clearTimeout(C),C=null)}var N,_,C,U,F,W,j,R,Y=this,O=!1;Y.show=function(){L(i)},Y.hide=function(){var t=_;t&&e.close(t)}}});