define(["browser","css!./style"],function(e){function t(t){return e.mobile?!1:t.animate}function a(){function e(e,t){var a=[{opacity:"0",offset:0},{opacity:"1",offset:1}],r={duration:800,iterations:t,easing:"ease-in"};return e.animate(a,r)}function a(){var e=o;e&&(e.cancel(),o=null)}var r,n=this;n.load=function(a,n,d){var c=new Image;c.onload=function(){if(!r){var c=document.createElement("div");if(c.classList.add("backdropImage"),c.classList.add("displayingBackdropImage"),c.style.backgroundImage="url('"+a+"')",c.setAttribute("data-url",a),n.appendChild(c),!t(c))return d&&d.parentNode&&d.parentNode.removeChild(d),void i(!0);var u=e(c,1);o=u,u.onfinish=function(){u==o&&(o=null),d&&d.parentNode&&d.parentNode.removeChild(d)},i(!0)}},c.src=a};var o;n.destroy=function(){r=!0,a()}}function r(){return g||(g=document.querySelector(".backdropContainer")),g||(g=document.createElement("div"),g.classList.add("backdropContainer"),document.body.insertBefore(g,document.body.firstChild)),g}function n(e){v&&(v.destroy(),v=null);var t=r();t.innerHTML="",e&&(m=!1),i(!1)}function o(){f||(f=document.querySelector(".skinContainer")),p||m?f.classList.add("withBackdrop"):f.classList.remove("withBackdrop")}function i(e){p=e,o()}function d(e){m=e,o()}function c(e,t){return Math.floor(Math.random()*(t-e)+e)}function u(e){v&&(v.destroy(),v=null);var t=r(),n=t.querySelector(".displayingBackdropImage");if(n&&n.getAttribute("data-url")==e){if(n.getAttribute("data-url")==e)return;n.classList.remove("displayingBackdropImage")}var o=new a;o.load(e,t,n),v=o}function l(e){var t=e.map(function(e){return e.BackdropImageTags&&e.BackdropImageTags.length>0?{id:e.Id,tag:e.BackdropImageTags[0],serverId:e.ServerId}:e.ParentBackdropItemId&&e.ParentBackdropImageTags&&e.ParentBackdropImageTags.length?{id:e.ParentBackdropItemId,tag:e.ParentBackdropImageTags[0],serverId:e.ServerId}:null}).filter(function(e){return null!=e});if(t.length){var a=c(0,t.length-1),r=t[a];require(["connectionManager"],function(e){var t=e.getApiClient(r.serverId),a=t.getScaledImageUrl(r.id,{type:"Backdrop",tag:r.tag,quality:100});s(a)})}else n()}function s(e){e?u(e):n()}var g,f,p,m,v;return{setBackdrops:l,setBackdrop:s,clear:n,externalBackdrop:d}});