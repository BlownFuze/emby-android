define(["events"],function(e){return function(r,t,n,a,i,o){function u(r,t){e.trigger(h,"requestfail",[{url:r,status:t.status,errorCode:t.headers?t.headers.get("X-Application-Error-Code"):null}])}function s(e){var r=e.headers||{};"json"==e.dataType&&(r.accept="application/json");var t={headers:r,method:e.type,credentials:"same-origin"},n=e.contentType;return e.data&&("string"==typeof e.data?t.body=e.data:(t.body=g(e.data),n=n||"application/x-www-form-urlencoded; charset=UTF-8")),n&&(r["Content-Type"]=n),e.timeout?l(e.url,t,e.timeout):fetch(e.url,t)}function l(e,r,t){return new Promise(function(n,a){var i=setTimeout(a,t);r=r||{},r.credentials="same-origin",fetch(e,r).then(function(e){clearTimeout(i),n(e)},function(){clearTimeout(i),a()})})}function g(e){var r=[];for(var t in e){var n=e[t];null!==n&&void 0!==n&&""!==n&&r.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}return r.join("&")}function c(e){var r=h.serverInfo(),t=e;return t--,0>t&&(t=MediaBrowser.ConnectionMode.Manual),MediaBrowser.ServerInfo.getServerAddress(r,t)?t:(t--,0>t&&(t=MediaBrowser.ConnectionMode.Manual),MediaBrowser.ServerInfo.getServerAddress(r,t)?t:e)}function d(e,r,t,n){t=c(t);var a=MediaBrowser.ServerInfo.getServerAddress(h.serverInfo(),t),i=t==MediaBrowser.ConnectionMode.Local?7e3:15e3;l(a+"/system/info/public",{method:"GET",accept:"application/json"},i).then(function(){h.serverInfo().LastConnectionMode=t,h.serverAddress(a),e()},function(){if(5>n){var a=c(t);setTimeout(function(){d(e,r,a,n+1)},300)}else r()})}function f(){return new Promise(function(e,r){setTimeout(function(){d(e,r,h.serverInfo().LastConnectionMode,0)},300)})}function v(e,r,t){var n=new RegExp(r,"ig");return e.replace(n,t)}function p(r){if("UserDeleted"===r.MessageType)U=null;else if("UserUpdated"===r.MessageType||"UserConfigurationUpdated"===r.MessageType){var t=r.Data;t.Id==h.getCurrentUserId()&&(U=null)}e.trigger(h,"websocketmessage",[r])}function m(e){var r;return e.artist?(r="Artists/"+h.encodeName(e.artist),delete e.artist):e.person?(r="Persons/"+h.encodeName(e.person),delete e.person):e.genre?(r="Genres/"+h.encodeName(e.genre),delete e.genre):e.musicGenre?(r="MusicGenres/"+h.encodeName(e.musicGenre),delete e.musicGenre):e.gameGenre?(r="GameGenres/"+h.encodeName(e.gameGenre),delete e.gameGenre):e.studio?(r="Studios/"+h.encodeName(e.studio),delete e.studio):(r="Items/"+e.itemId,delete e.itemId),r}function w(e){var r=o||1;r&&(e.minScale&&(r=Math.max(e.minScale,r)),e.width&&(e.width=Math.round(e.width*r)),e.height&&(e.height=Math.round(e.height*r)),e.maxWidth&&(e.maxWidth=Math.round(e.maxWidth*r)),e.maxHeight&&(e.maxHeight=Math.round(e.maxHeight*r))),e.quality=e.quality||h.getDefaultImageQuality(e.type),h.normalizeImageOptions&&h.normalizeImageOptions(e)}function y(e){return h.ajax({type:"POST",url:h.getUrl("Auth/Pin/Exchange"),data:{deviceId:e.DeviceId,pin:e.Pin},dataType:"json"})}if(!r)throw new Error("Must supply a serverAddress");var S,h=this,T={};h.serverAddress=function(t){if(null!=t){if(0!=t.toLowerCase().indexOf("http"))throw new Error("Invalid url: "+t);var n=t!=r;r=t,n&&e.trigger(this,"serveraddresschanged")}return r},h.serverInfo=function(e){return T=e||T};var U;h.getCurrentUser=function(){if(U)return Promise.resolve(U);var e=h.getCurrentUserId();return e?h.getUser(e).then(function(e){return U=e,e}):Promise.reject()},h.isLoggedIn=function(){var e=h.serverInfo();return e&&e.UserId&&e.AccessToken?!0:!1},h.getCurrentUserId=function(){return T.UserId},h.accessToken=function(){return T.AccessToken},h.deviceName=function(){return a},h.deviceId=function(){return i},h.appName=function(){return t},h.appVersion=function(){return n},h.clearAuthenticationInfo=function(){h.setAuthenticationInfo(null,null)},h.setAuthenticationInfo=function(e,r){U=null,T.AccessToken=e,T.UserId=r},h.encodeName=function(e){e=e.split("/").join("-"),e=e.split("&").join("-"),e=e.split("?").join("-");var r=g({name:e});return r.substring(r.indexOf("=")+1).replace("'","%27")},h.setRequestHeaders=function(e){var r=h.serverInfo();if(t){var o='MediaBrowser Client="'+t+'", Device="'+a+'", DeviceId="'+i+'", Version="'+n+'"',u=r.UserId;u&&(o+=', UserId="'+u+'"'),e["X-Emby-Authorization"]=o}var s=r.AccessToken;s&&(e["X-MediaBrowser-Token"]=s)},h.ajax=function(e,r){if(!e)throw new Error("Request cannot be null");return h.fetch(e,r)},h.fetch=function(e,r){if(!e)throw new Error("Request cannot be null");return e.headers=e.headers||{},r!==!1&&h.setRequestHeaders(e.headers),h.enableAutomaticNetworking===!1||"GET"!=e.type?s(e).then(function(r){return r.status<400?"json"==e.dataType||"application/json"==e.headers.accept?r.json():"text"==e.dataType||0==(r.headers.get("Content-Type")||"").toLowerCase().indexOf("text/")?r.text():r:(u(e.url,r),Promise.reject(r))},function(r){throw u(e.url,{}),r}):h.fetchWithFailover(e,!0)},h.getJSON=function(e,r){return h.fetch({url:e,type:"GET",dataType:"json",headers:{accept:"application/json"}},r)},h.fetchWithFailover=function(e,r){return e.timeout=3e4,s(e).then(function(r){return r.status<400?"json"==e.dataType||"application/json"==e.headers.accept?r.json():"text"==e.dataType||0==(r.headers.get("Content-Type")||"").toLowerCase().indexOf("text/")?r.text():r:(u(e.url,r),Promise.reject(r))},function(t){if(r){var n=h.serverAddress();return f().then(function(){return e.url=e.url.replace(n,h.serverAddress()),h.fetchWithFailover(e,!1)},function(r){throw u(e.url,{}),r})}throw u(e.url,{}),t})},h.get=function(e){return h.ajax({type:"GET",url:e})},h.getUrl=function(e,t){if(!e)throw new Error("Url name cannot be empty");var n=r;if(!n)throw new Error("serverAddress is yet not set");var a=n.toLowerCase();return-1==a.indexOf("/emby")&&-1==a.indexOf("/mediabrowser")&&(n+="/emby"),"/"!=e.charAt(0)&&(n+="/"),n+=e,t&&(t=g(t),t&&(n+="?"+t)),n},h.updateServerInfo=function(e,r){if(null==e)throw new Error("server cannot be null");if(null==r)throw new Error("connectionMode cannot be null");h.serverInfo(e);var t=MediaBrowser.ServerInfo.getServerAddress(e,r);if(!t)throw new Error("serverUrl cannot be null. serverInfo: "+JSON.stringify(e));h.serverAddress(t)},h.isWebSocketSupported=function(){try{return null!=WebSocket}catch(e){return!1}},h.ensureWebSocket=function(){!h.isWebSocketOpenOrConnecting()&&h.isWebSocketSupported()&&h.openWebSocket()},h.openWebSocket=function(){var r=h.accessToken();if(!r)throw new Error("Cannot open web socket without access token.");var t=h.getUrl("socket");t=v(t,"emby/socket","embywebsocket"),t=v(t,"http","ws"),t+="?api_key="+r,t+="&deviceId="+i,S=new WebSocket(t),S.onmessage=function(e){e=JSON.parse(e.data),p(e)},S.onopen=function(){setTimeout(function(){e.trigger(h,"websocketopen")},0)},S.onerror=function(){e.trigger(h,"websocketerror")},S.onclose=function(){setTimeout(function(){e.trigger(h,"websocketclose")},0)}},h.closeWebSocket=function(){S&&S.readyState===WebSocket.OPEN&&S.close()},h.sendWebSocketMessage=function(e,r){var t={MessageType:e};r&&(t.Data=r),t=JSON.stringify(t),S.send(t)},h.isWebSocketOpen=function(){return S&&S.readyState===WebSocket.OPEN},h.isWebSocketOpenOrConnecting=function(){return S&&(S.readyState===WebSocket.OPEN||S.readyState===WebSocket.CONNECTING)},h.getProductNews=function(e){e=e||{};var r=h.getUrl("News/Product",e);return h.getJSON(r)},h.getDownloadSpeed=function(e){var r=h.getUrl("Playback/BitrateTest",{Size:e}),t=(new Date).getTime();return h.ajax({type:"GET",url:r,timeout:5e3}).then(function(){var r=((new Date).getTime()-t)/1e3,n=e/r,a=Math.round(8*n);return a})},h.detectBitrate=function(){return h.getDownloadSpeed(1e6).then(function(e){return 1e6>e?Math.round(.8*e):h.getDownloadSpeed(24e5).then(function(e){return Math.round(.8*e)})})},h.getItem=function(e,r){if(!r)throw new Error("null itemId");var t=h.getUrl(e?"Users/"+e+"/Items/"+r:"Items/"+r);return h.getJSON(t)},h.getRootFolder=function(e){if(!e)throw new Error("null userId");var r=h.getUrl("Users/"+e+"/Items/Root");return h.getJSON(r)},h.getNotificationSummary=function(e){if(!e)throw new Error("null userId");var r=h.getUrl("Notifications/"+e+"/Summary");return h.getJSON(r)},h.getNotifications=function(e,r){if(!e)throw new Error("null userId");var t=h.getUrl("Notifications/"+e,r||{});return h.getJSON(t)},h.markNotificationsRead=function(e,r,t){if(!e)throw new Error("null userId");if(!r)throw new Error("null idList");var n=t?"Read":"Unread",a={UserId:e,Ids:r.join(",")},i=h.getUrl("Notifications/"+e+"/"+n,a);return h.ajax({type:"POST",url:i})},h.logout=function(){h.closeWebSocket();var e=function(){h.setAuthenticationInfo(null,null)};if(h.accessToken()){var r=h.getUrl("Sessions/Logout");return h.ajax({type:"POST",url:r}).then(e,e)}return new Promise(function(r){e(),r()})},h.getRemoteImageProviders=function(e){if(!e)throw new Error("null options");var r=m(e),t=h.getUrl(r+"/RemoteImages/Providers",e);return h.getJSON(t)},h.getAvailableRemoteImages=function(e){if(!e)throw new Error("null options");var r=m(e),t=h.getUrl(r+"/RemoteImages",e);return h.getJSON(t)},h.downloadRemoteImage=function(e){if(!e)throw new Error("null options");var r=m(e),t=h.getUrl(r+"/RemoteImages/Download",e);return h.ajax({type:"POST",url:t})},h.getLiveTvInfo=function(e){var r=h.getUrl("LiveTv/Info",e||{});return h.getJSON(r)},h.getLiveTvGuideInfo=function(e){var r=h.getUrl("LiveTv/GuideInfo",e||{});return h.getJSON(r)},h.getLiveTvChannel=function(e,r){if(!e)throw new Error("null id");var t={};r&&(t.userId=r);var n=h.getUrl("LiveTv/Channels/"+e,t);return h.getJSON(n)},h.getLiveTvChannels=function(e){var r=h.getUrl("LiveTv/Channels",e||{});return h.getJSON(r)},h.getLiveTvPrograms=function(e){return e=e||{},h.ajax(e.channelIds&&e.channelIds.length>1800?{type:"POST",url:h.getUrl("LiveTv/Programs"),data:JSON.stringify(e),contentType:"application/json",dataType:"json"}:{type:"GET",url:h.getUrl("LiveTv/Programs",e),dataType:"json"})},h.getLiveTvRecommendedPrograms=function(e){return e=e||{},h.ajax({type:"GET",url:h.getUrl("LiveTv/Programs/Recommended",e),dataType:"json"})},h.getLiveTvRecordings=function(e){var r=h.getUrl("LiveTv/Recordings",e||{});return h.getJSON(r)},h.getLiveTvRecordingGroups=function(e){var r=h.getUrl("LiveTv/Recordings/Groups",e||{});return h.getJSON(r)},h.getLiveTvRecordingGroup=function(e){if(!e)throw new Error("null id");var r=h.getUrl("LiveTv/Recordings/Groups/"+e);return h.getJSON(r)},h.getLiveTvRecording=function(e,r){if(!e)throw new Error("null id");var t={};r&&(t.userId=r);var n=h.getUrl("LiveTv/Recordings/"+e,t);return h.getJSON(n)},h.getLiveTvProgram=function(e,r){if(!e)throw new Error("null id");var t={};r&&(t.userId=r);var n=h.getUrl("LiveTv/Programs/"+e,t);return h.getJSON(n)},h.deleteLiveTvRecording=function(e){if(!e)throw new Error("null id");var r=h.getUrl("LiveTv/Recordings/"+e);return h.ajax({type:"DELETE",url:r})},h.cancelLiveTvTimer=function(e){if(!e)throw new Error("null id");var r=h.getUrl("LiveTv/Timers/"+e);return h.ajax({type:"DELETE",url:r})},h.getLiveTvTimers=function(e){var r=h.getUrl("LiveTv/Timers",e||{});return h.getJSON(r)},h.getLiveTvTimer=function(e){if(!e)throw new Error("null id");var r=h.getUrl("LiveTv/Timers/"+e);return h.getJSON(r)},h.getNewLiveTvTimerDefaults=function(e){e=e||{};var r=h.getUrl("LiveTv/Timers/Defaults",e);return h.getJSON(r)},h.createLiveTvTimer=function(e){if(!e)throw new Error("null item");var r=h.getUrl("LiveTv/Timers");return h.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json"})},h.updateLiveTvTimer=function(e){if(!e)throw new Error("null item");var r=h.getUrl("LiveTv/Timers/"+e.Id);return h.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json"})},h.resetLiveTvTuner=function(e){if(!e)throw new Error("null id");var r=h.getUrl("LiveTv/Tuners/"+e+"/Reset");return h.ajax({type:"POST",url:r})},h.getLiveTvSeriesTimers=function(e){var r=h.getUrl("LiveTv/SeriesTimers",e||{});return h.getJSON(r)},h.getFileOrganizationResults=function(e){var r=h.getUrl("Library/FileOrganization",e||{});return h.getJSON(r)},h.deleteOriginalFileFromOrganizationResult=function(e){var r=h.getUrl("Library/FileOrganizations/"+e+"/File");return h.ajax({type:"DELETE",url:r})},h.clearOrganizationLog=function(){var e=h.getUrl("Library/FileOrganizations");return h.ajax({type:"DELETE",url:e})},h.performOrganization=function(e){var r=h.getUrl("Library/FileOrganizations/"+e+"/Organize");return h.ajax({type:"POST",url:r})},h.performEpisodeOrganization=function(e,r){var t=h.getUrl("Library/FileOrganizations/"+e+"/Episode/Organize");return h.ajax({type:"POST",url:t,data:JSON.stringify(r),contentType:"application/json"})},h.getLiveTvSeriesTimer=function(e){if(!e)throw new Error("null id");var r=h.getUrl("LiveTv/SeriesTimers/"+e);return h.getJSON(r)},h.cancelLiveTvSeriesTimer=function(e){if(!e)throw new Error("null id");var r=h.getUrl("LiveTv/SeriesTimers/"+e);return h.ajax({type:"DELETE",url:r})},h.createLiveTvSeriesTimer=function(e){if(!e)throw new Error("null item");var r=h.getUrl("LiveTv/SeriesTimers");return h.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json"})},h.updateLiveTvSeriesTimer=function(e){if(!e)throw new Error("null item");var r=h.getUrl("LiveTv/SeriesTimers/"+e.Id);return h.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json"})},h.getRegistrationInfo=function(e){var r=h.getUrl("Registrations/"+e);return h.getJSON(r)},h.getSystemInfo=function(){var e=h.getUrl("System/Info");return h.getJSON(e)},h.getPublicSystemInfo=function(){var e=h.getUrl("System/Info/Public");return h.getJSON(e,!1)},h.getInstantMixFromItem=function(e,r){var t=h.getUrl("Items/"+e+"/InstantMix",r);return h.getJSON(t)},h.getEpisodes=function(e,r){var t=h.getUrl("Shows/"+e+"/Episodes",r);return h.getJSON(t)},h.getDisplayPreferences=function(e,r,t){var n=h.getUrl("DisplayPreferences/"+e,{userId:r,client:t});return h.getJSON(n)},h.updateDisplayPreferences=function(e,r,t,n){var a=h.getUrl("DisplayPreferences/"+e,{userId:t,client:n});return h.ajax({type:"POST",url:a,data:JSON.stringify(r),contentType:"application/json"})},h.getSeasons=function(e,r){var t=h.getUrl("Shows/"+e+"/Seasons",r);return h.getJSON(t)},h.getSimilarItems=function(e,r){var t=h.getUrl("Items/"+e+"/Similar",r);return h.getJSON(t)},h.getCultures=function(){var e=h.getUrl("Localization/cultures");return h.getJSON(e)},h.getCountries=function(){var e=h.getUrl("Localization/countries");return h.getJSON(e)},h.getPluginSecurityInfo=function(){var e=h.getUrl("Plugins/SecurityInfo");return h.getJSON(e)},h.getDirectoryContents=function(e,r){if(!e)throw new Error("null path");if("string"!=typeof e)throw new Error("invalid path");r=r||{},r.path=e;var t=h.getUrl("Environment/DirectoryContents",r);return h.getJSON(t)},h.getNetworkShares=function(e){if(!e)throw new Error("null path");var r={};r.path=e;var t=h.getUrl("Environment/NetworkShares",r);return h.getJSON(t)},h.getParentPath=function(e){if(!e)throw new Error("null path");var r={};r.path=e;var t=h.getUrl("Environment/ParentPath",r);return h.ajax({type:"GET",url:t,dataType:"text"})},h.getDrives=function(){var e=h.getUrl("Environment/Drives");return h.getJSON(e)},h.getNetworkDevices=function(){var e=h.getUrl("Environment/NetworkDevices");return h.getJSON(e)},h.cancelPackageInstallation=function(e){if(!e)throw new Error("null installationId");var r=h.getUrl("Packages/Installing/"+e);return h.ajax({type:"DELETE",url:r})},h.refreshItem=function(e,r){if(!e)throw new Error("null itemId");var t=h.getUrl("Items/"+e+"/Refresh",r||{});return h.ajax({type:"POST",url:t})},h.installPlugin=function(e,r,t,n){if(!e)throw new Error("null name");if(!t)throw new Error("null updateClass");var a={updateClass:t,AssemblyGuid:r};n&&(a.version=n);var i=h.getUrl("Packages/Installed/"+e,a);return h.ajax({type:"POST",url:i})},h.restartServer=function(){var e=h.getUrl("System/Restart");return h.ajax({type:"POST",url:e})},h.shutdownServer=function(){var e=h.getUrl("System/Shutdown");return h.ajax({type:"POST",url:e})},h.getPackageInfo=function(e,r){if(!e)throw new Error("null name");var t={AssemblyGuid:r},n=h.getUrl("Packages/"+e,t);return h.getJSON(n)},h.getAvailableApplicationUpdate=function(){var e=h.getUrl("Packages/Updates",{PackageType:"System"});return h.getJSON(e)},h.getAvailablePluginUpdates=function(){var e=h.getUrl("Packages/Updates",{PackageType:"UserInstalled"});return h.getJSON(e)},h.getVirtualFolders=function(){var e="Library/VirtualFolders";return e=h.getUrl(e),h.getJSON(e)},h.getPhysicalPaths=function(){var e=h.getUrl("Library/PhysicalPaths");return h.getJSON(e)},h.getServerConfiguration=function(){var e=h.getUrl("System/Configuration");return h.getJSON(e)},h.getDevicesOptions=function(){var e=h.getUrl("System/Configuration/devices");return h.getJSON(e)},h.getContentUploadHistory=function(){var e=h.getUrl("Devices/CameraUploads",{DeviceId:h.deviceId()});return h.getJSON(e)},h.getNamedConfiguration=function(e){var r=h.getUrl("System/Configuration/"+e);return h.getJSON(r)},h.getScheduledTasks=function(e){e=e||{};var r=h.getUrl("ScheduledTasks",e);return h.getJSON(r)},h.startScheduledTask=function(e){if(!e)throw new Error("null id");var r=h.getUrl("ScheduledTasks/Running/"+e);return h.ajax({type:"POST",url:r})},h.getScheduledTask=function(e){if(!e)throw new Error("null id");var r=h.getUrl("ScheduledTasks/"+e);return h.getJSON(r)},h.getNextUpEpisodes=function(e){var r=h.getUrl("Shows/NextUp",e);return h.getJSON(r)},h.stopScheduledTask=function(e){if(!e)throw new Error("null id");var r=h.getUrl("ScheduledTasks/Running/"+e);return h.ajax({type:"DELETE",url:r})},h.getPluginConfiguration=function(e){if(!e)throw new Error("null Id");var r=h.getUrl("Plugins/"+e+"/Configuration");return h.getJSON(r)},h.getAvailablePlugins=function(e){e=e||{},e.PackageType="UserInstalled";var r=h.getUrl("Packages",e);return h.getJSON(r)},h.uninstallPlugin=function(e){if(!e)throw new Error("null Id");var r=h.getUrl("Plugins/"+e);return h.ajax({type:"DELETE",url:r})},h.removeVirtualFolder=function(e,r){if(!e)throw new Error("null name");var t="Library/VirtualFolders";return t=h.getUrl(t,{refreshLibrary:r?!0:!1,name:e}),h.ajax({type:"DELETE",url:t})},h.addVirtualFolder=function(e,r,t,n){if(!e)throw new Error("null name");var a={};r&&(a.collectionType=r),a.refreshLibrary=t?!0:!1,a.name=e;var i="Library/VirtualFolders";return i=h.getUrl(i,a),h.ajax({type:"POST",url:i,data:JSON.stringify({Paths:n}),contentType:"application/json"})},h.renameVirtualFolder=function(e,r,t){if(!e)throw new Error("null name");var n="Library/VirtualFolders/Name";return n=h.getUrl(n,{refreshLibrary:t?!0:!1,newName:r,name:e}),h.ajax({type:"POST",url:n})},h.addMediaPath=function(e,r,t){if(!e)throw new Error("null virtualFolderName");if(!r)throw new Error("null mediaPath");var n="Library/VirtualFolders/Paths";return n=h.getUrl(n,{refreshLibrary:t?!0:!1,path:r,name:e}),h.ajax({type:"POST",url:n})},h.removeMediaPath=function(e,r,t){if(!e)throw new Error("null virtualFolderName");if(!r)throw new Error("null mediaPath");var n="Library/VirtualFolders/Paths";return n=h.getUrl(n,{refreshLibrary:t?!0:!1,path:r,name:e}),h.ajax({type:"DELETE",url:n})},h.deleteUser=function(e){if(!e)throw new Error("null id");var r=h.getUrl("Users/"+e);return h.ajax({type:"DELETE",url:r})},h.deleteUserImage=function(e,r,t){if(!e)throw new Error("null userId");if(!r)throw new Error("null imageType");var n=h.getUrl("Users/"+e+"/Images/"+r);return null!=t&&(n+="/"+t),h.ajax({type:"DELETE",url:n})},h.deleteItemImage=function(e,r,t){if(!r)throw new Error("null imageType");var n=h.getUrl("Items/"+e+"/Images");return n+="/"+r,null!=t&&(n+="/"+t),h.ajax({type:"DELETE",url:n})},h.deleteItem=function(e){if(!e)throw new Error("null itemId");var r=h.getUrl("Items/"+e);return h.ajax({type:"DELETE",url:r})},h.stopActiveEncodings=function(e){var r={deviceId:i};e&&(r.PlaySessionId=e);var t=h.getUrl("Videos/ActiveEncodings",r);return h.ajax({type:"DELETE",url:t})},h.reportCapabilities=function(e){var r=h.getUrl("Sessions/Capabilities/Full");return h.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json"})},h.updateItemImageIndex=function(e,r,t,n){if(!r)throw new Error("null imageType");var a={newIndex:n},i=h.getUrl("Items/"+e+"/Images/"+r+"/"+t+"/Index",a);return h.ajax({type:"POST",url:i})},h.getItemImageInfos=function(e){var r=h.getUrl("Items/"+e+"/Images");return h.getJSON(r)},h.getCriticReviews=function(e,r){if(!e)throw new Error("null itemId");var t=h.getUrl("Items/"+e+"/CriticReviews",r);return h.getJSON(t)},h.getSessions=function(e){var r=h.getUrl("Sessions",e);return h.getJSON(r)},h.uploadUserImage=function(e,r,t){if(!e)throw new Error("null userId");if(!r)throw new Error("null imageType");if(!t)throw new Error("File must be an image.");if("image/png"!=t.type&&"image/jpeg"!=t.type&&"image/jpeg"!=t.type)throw new Error("File must be an image.");return new Promise(function(n,a){var i=new FileReader;i.onerror=function(){a()},i.onabort=function(){a()},i.onload=function(i){var o=i.target.result.split(",")[1],u=h.getUrl("Users/"+e+"/Images/"+r);h.ajax({type:"POST",url:u,data:o,contentType:"image/"+t.name.substring(t.name.lastIndexOf(".")+1)}).then(function(e){n(e)},function(){a()})},i.readAsDataURL(t)})},h.uploadItemImage=function(e,r,t){if(!e)throw new Error("null itemId");if(!r)throw new Error("null imageType");if(!t)throw new Error("File must be an image.");if("image/png"!=t.type&&"image/jpeg"!=t.type&&"image/jpeg"!=t.type)throw new Error("File must be an image.");var n=h.getUrl("Items/"+e+"/Images");return n+="/"+r,new Promise(function(e,r){var a=new FileReader;a.onerror=function(){r()},a.onabort=function(){r()},a.onload=function(a){var i=a.target.result.split(",")[1];h.ajax({type:"POST",url:n,data:i,contentType:"image/"+t.name.substring(t.name.lastIndexOf(".")+1)}).then(function(r){e(r)},function(){r()})},a.readAsDataURL(t)})},h.getInstalledPlugins=function(){var e={},r=h.getUrl("Plugins",e);return h.getJSON(r)},h.getUser=function(e){if(!e)throw new Error("Must supply a userId");var r=h.getUrl("Users/"+e);return h.getJSON(r)},h.getOfflineUser=function(e){if(!e)throw new Error("Must supply a userId");var r=h.getUrl("Users/"+e+"/Offline");return h.getJSON(r)},h.getStudio=function(e,r){if(!e)throw new Error("null name");var t={};r&&(t.userId=r);var n=h.getUrl("Studios/"+h.encodeName(e),t);return h.getJSON(n)},h.getGenre=function(e,r){if(!e)throw new Error("null name");var t={};r&&(t.userId=r);var n=h.getUrl("Genres/"+h.encodeName(e),t);return h.getJSON(n)},h.getMusicGenre=function(e,r){if(!e)throw new Error("null name");var t={};r&&(t.userId=r);var n=h.getUrl("MusicGenres/"+h.encodeName(e),t);return h.getJSON(n)},h.getGameGenre=function(e,r){if(!e)throw new Error("null name");var t={};r&&(t.userId=r);var n=h.getUrl("GameGenres/"+h.encodeName(e),t);return h.getJSON(n)},h.getArtist=function(e,r){if(!e)throw new Error("null name");var t={};r&&(t.userId=r);var n=h.getUrl("Artists/"+h.encodeName(e),t);return h.getJSON(n)},h.getPerson=function(e,r){if(!e)throw new Error("null name");var t={};r&&(t.userId=r);var n=h.getUrl("Persons/"+h.encodeName(e),t);return h.getJSON(n)},h.getPublicUsers=function(){var e=h.getUrl("users/public");return h.ajax({type:"GET",url:e,dataType:"json"},!1)},h.getUsers=function(e){var r=h.getUrl("users",e||{});return h.getJSON(r)},h.getParentalRatings=function(){var e=h.getUrl("Localization/ParentalRatings");return h.getJSON(e)},h.getDefaultImageQuality=function(e){return"backdrop"==e.toLowerCase()?80:90},h.getUserImageUrl=function(e,r){if(!e)throw new Error("null userId");r=r||{};var t="Users/"+e+"/Images/"+r.type;return null!=r.index&&(t+="/"+r.index),w(r),delete r.type,delete r.index,h.getUrl(t,r)},h.getImageUrl=function(e,r){if(!e)throw new Error("itemId cannot be empty");r=r||{};var t="Items/"+e+"/Images/"+r.type;return null!=r.index&&(t+="/"+r.index),r.quality=r.quality||h.getDefaultImageQuality(r.type),h.normalizeImageOptions&&h.normalizeImageOptions(r),delete r.type,delete r.index,h.getUrl(t,r)},h.getScaledImageUrl=function(e,r){if(!e)throw new Error("itemId cannot be empty");r=r||{};var t="Items/"+e+"/Images/"+r.type;return null!=r.index&&(t+="/"+r.index),w(r),delete r.type,delete r.index,delete r.minScale,h.getUrl(t,r)},h.getThumbImageUrl=function(e,r){if(!e)throw new Error("null item");return r=r||{},r.imageType="thumb",e.ImageTags&&e.ImageTags.Thumb?(r.tag=e.ImageTags.Thumb,h.getImageUrl(e.Id,r)):e.ParentThumbItemId?(r.tag=e.ImageTags.ParentThumbImageTag,h.getImageUrl(e.ParentThumbItemId,r)):null},h.authenticateUserByName=function(e,r){return new Promise(function(t,n){if(!e)return void n();var a=h.getUrl("Users/authenticatebyname");require(["cryptojs-sha1"],function(){var i={password:CryptoJS.SHA1(r||"").toString(),Username:e};h.ajax({type:"POST",url:a,data:JSON.stringify(i),dataType:"json",contentType:"application/json"}).then(function(e){h.onAuthenticated&&h.onAuthenticated(h,e),t(e)},n)})})},h.updateUserPassword=function(e,r,t){return new Promise(function(n,a){if(!e)return void a();var i=h.getUrl("Users/"+e+"/Password");require(["cryptojs-sha1"],function(){h.ajax({type:"POST",url:i,data:{currentPassword:CryptoJS.SHA1(r).toString(),newPassword:CryptoJS.SHA1(t).toString()}}).then(n,a)})})},h.updateEasyPassword=function(e,r){return new Promise(function(t,n){if(!e)return void n();var a=h.getUrl("Users/"+e+"/EasyPassword");require(["cryptojs-sha1"],function(){h.ajax({type:"POST",url:a,data:{newPassword:CryptoJS.SHA1(r).toString()}}).then(t,n)})})},h.resetUserPassword=function(e){if(!e)throw new Error("null userId");var r=h.getUrl("Users/"+e+"/Password"),t={};return t.resetPassword=!0,h.ajax({type:"POST",url:r,data:t})},h.resetEasyPassword=function(e){if(!e)throw new Error("null userId");var r=h.getUrl("Users/"+e+"/EasyPassword"),t={};return t.resetPassword=!0,h.ajax({type:"POST",url:r,data:t})},h.updateServerConfiguration=function(e){if(!e)throw new Error("null configuration");var r=h.getUrl("System/Configuration");return h.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json"})},h.updateNamedConfiguration=function(e,r){if(!r)throw new Error("null configuration");var t=h.getUrl("System/Configuration/"+e);return h.ajax({type:"POST",url:t,data:JSON.stringify(r),contentType:"application/json"})},h.updateItem=function(e){if(!e)throw new Error("null item");var r=h.getUrl("Items/"+e.Id);return h.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json"})},h.updatePluginSecurityInfo=function(e){var r=h.getUrl("Plugins/SecurityInfo");return h.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json"})},h.createUser=function(e){var r=h.getUrl("Users/New");return h.ajax({type:"POST",url:r,data:{Name:e},dataType:"json"})},h.updateUser=function(e){if(!e)throw new Error("null user");var r=h.getUrl("Users/"+e.Id);return h.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json"})},h.updateUserPolicy=function(e,r){if(!e)throw new Error("null userId");if(!r)throw new Error("null policy");var t=h.getUrl("Users/"+e+"/Policy");return h.ajax({type:"POST",url:t,data:JSON.stringify(r),contentType:"application/json"})},h.updateUserConfiguration=function(e,r){if(!e)throw new Error("null userId");if(!r)throw new Error("null configuration");var t=h.getUrl("Users/"+e+"/Configuration");return h.ajax({type:"POST",url:t,data:JSON.stringify(r),contentType:"application/json"})},h.updateScheduledTaskTriggers=function(e,r){if(!e)throw new Error("null id");if(!r)throw new Error("null triggers");var t=h.getUrl("ScheduledTasks/"+e+"/Triggers");return h.ajax({type:"POST",url:t,data:JSON.stringify(r),contentType:"application/json"})},h.updatePluginConfiguration=function(e,r){if(!e)throw new Error("null Id");if(!r)throw new Error("null configuration");var t=h.getUrl("Plugins/"+e+"/Configuration");return h.ajax({type:"POST",url:t,data:JSON.stringify(r),contentType:"application/json"})},h.getAncestorItems=function(e,r){if(!e)throw new Error("null itemId");var t={};r&&(t.userId=r);var n=h.getUrl("Items/"+e+"/Ancestors",t);return h.getJSON(n)},h.getItems=function(e,r){var t;return t="string"==(typeof e).toString().toLowerCase()?h.getUrl("Users/"+e+"/Items",r):h.getUrl("Items",r),h.getJSON(t)},h.getChannels=function(e){return h.getJSON(h.getUrl("Channels",e||{}))},h.getUserViews=function(e,r){e=e||{};var t=h.getUrl("Users/"+(r||h.getCurrentUserId())+"/Views",e);return h.getJSON(t)},h.getArtists=function(e,r){if(!e)throw new Error("null userId");r=r||{},r.userId=e;var t=h.getUrl("Artists",r);return h.getJSON(t)},h.getAlbumArtists=function(e,r){if(!e)throw new Error("null userId");r=r||{},r.userId=e;var t=h.getUrl("Artists/AlbumArtists",r);return h.getJSON(t)},h.getGenres=function(e,r){if(!e)throw new Error("null userId");r=r||{},r.userId=e;var t=h.getUrl("Genres",r);return h.getJSON(t)},h.getMusicGenres=function(e,r){if(!e)throw new Error("null userId");r=r||{},r.userId=e;var t=h.getUrl("MusicGenres",r);return h.getJSON(t)},h.getGameGenres=function(e,r){if(!e)throw new Error("null userId");r=r||{},r.userId=e;var t=h.getUrl("GameGenres",r);return h.getJSON(t)},h.getPeople=function(e,r){if(!e)throw new Error("null userId");r=r||{},r.userId=e;var t=h.getUrl("Persons",r);return h.getJSON(t)},h.getStudios=function(e,r){if(!e)throw new Error("null userId");r=r||{},r.userId=e;var t=h.getUrl("Studios",r);return h.getJSON(t)},h.getLocalTrailers=function(e,r){if(!e)throw new Error("null userId");if(!r)throw new Error("null itemId");var t=h.getUrl("Users/"+e+"/Items/"+r+"/LocalTrailers");return h.getJSON(t)},h.getGameSystems=function(){var e={},r=h.getCurrentUserId();r&&(e.userId=r);var t=h.getUrl("Games/SystemSummaries",e);return h.getJSON(t)},h.getAdditionalVideoParts=function(e,r){if(!r)throw new Error("null itemId");var t={};e&&(t.userId=e);var n=h.getUrl("Videos/"+r+"/AdditionalParts",t);return h.getJSON(n)},h.getThemeMedia=function(e,r,t){if(!r)throw new Error("null itemId");var n={};e&&(n.userId=e),n.InheritFromParent=t||!1;var a=h.getUrl("Items/"+r+"/ThemeMedia",n);return h.getJSON(a)},h.getSearchHints=function(e){var r=h.getUrl("Search/Hints",e);return h.getJSON(r)},h.getSpecialFeatures=function(e,r){if(!e)throw new Error("null userId");if(!r)throw new Error("null itemId");var t=h.getUrl("Users/"+e+"/Items/"+r+"/SpecialFeatures");return h.getJSON(t)},h.getDateParamValue=function(e){function r(e){return 10>e?"0"+e:e}var t=e;return""+t.getFullYear()+r(t.getMonth()+1)+r(t.getDate())+r(t.getHours())+r(t.getMinutes())+r(t.getSeconds())},h.markPlayed=function(e,r,t){if(!e)throw new Error("null userId");if(!r)throw new Error("null itemId");var n={};t&&(n.DatePlayed=h.getDateParamValue(t));var a=h.getUrl("Users/"+e+"/PlayedItems/"+r,n);return h.ajax({type:"POST",url:a,dataType:"json"})},h.markUnplayed=function(e,r){if(!e)throw new Error("null userId");if(!r)throw new Error("null itemId");var t=h.getUrl("Users/"+e+"/PlayedItems/"+r);return h.ajax({type:"DELETE",url:t,dataType:"json"})},h.updateFavoriteStatus=function(e,r,t){if(!e)throw new Error("null userId");if(!r)throw new Error("null itemId");var n=h.getUrl("Users/"+e+"/FavoriteItems/"+r),a=t?"POST":"DELETE";return h.ajax({type:a,url:n,dataType:"json"})},h.updateUserItemRating=function(e,r,t){if(!e)throw new Error("null userId");if(!r)throw new Error("null itemId");var n=h.getUrl("Users/"+e+"/Items/"+r+"/Rating",{likes:t});return h.ajax({type:"POST",url:n,dataType:"json"})},h.getItemCounts=function(e){var r={};e&&(r.userId=e);var t=h.getUrl("Items/Counts",r);return h.getJSON(t)},h.clearUserItemRating=function(e,r){if(!e)throw new Error("null userId");if(!r)throw new Error("null itemId");var t=h.getUrl("Users/"+e+"/Items/"+r+"/Rating");return h.ajax({type:"DELETE",url:t,dataType:"json"})},h.reportPlaybackStart=function(e){if(!e)throw new Error("null options");var r=h.getUrl("Sessions/Playing");return h.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:r})},h.reportPlaybackProgress=function(e){if(!e)throw new Error("null options");if(h.isWebSocketOpen())return new Promise(function(r){var t=JSON.stringify(e);h.sendWebSocketMessage("ReportPlaybackProgress",t),r()
});var r=h.getUrl("Sessions/Playing/Progress");return h.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:r})},h.reportOfflineActions=function(e){if(!e)throw new Error("null actions");var r=h.getUrl("Sync/OfflineActions");return h.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:r})},h.syncData=function(e){if(!e)throw new Error("null data");var r=h.getUrl("Sync/Data");return h.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:r,dataType:"json"})},h.getReadySyncItems=function(e){if(!e)throw new Error("null deviceId");var r=h.getUrl("Sync/Items/Ready",{TargetId:e});return h.getJSON(r)},h.reportSyncJobItemTransferred=function(e){if(!e)throw new Error("null syncJobItemId");var r=h.getUrl("Sync/JobItems/"+e+"/Transferred");return h.ajax({type:"POST",url:r})},h.reportPlaybackStopped=function(e){if(!e)throw new Error("null options");var r=h.getUrl("Sessions/Playing/Stopped");return h.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:r})},h.sendPlayCommand=function(e,r){if(!e)throw new Error("null sessionId");if(!r)throw new Error("null options");var t=h.getUrl("Sessions/"+e+"/Playing",r);return h.ajax({type:"POST",url:t})},h.sendCommand=function(e,r){if(!e)throw new Error("null sessionId");if(!r)throw new Error("null command");var t=h.getUrl("Sessions/"+e+"/Command"),n={type:"POST",url:t};return n.data=JSON.stringify(r),n.contentType="application/json",h.ajax(n)},h.sendMessageCommand=function(e,r){if(!e)throw new Error("null sessionId");if(!r)throw new Error("null options");var t=h.getUrl("Sessions/"+e+"/Message",r);return h.ajax({type:"POST",url:t})},h.sendPlayStateCommand=function(e,r,t){if(!e)throw new Error("null sessionId");if(!r)throw new Error("null command");var n=h.getUrl("Sessions/"+e+"/Playing/"+r,t||{});return h.ajax({type:"POST",url:n})},h.createPackageReview=function(e){var r=h.getUrl("Packages/Reviews/"+e.id,e);return h.ajax({type:"POST",url:r})},h.getPackageReviews=function(e,r,t,n){if(!e)throw new Error("null packageId");var a={};r&&(a.MinRating=r),t&&(a.MaxRating=t),n&&(a.Limit=n);var i=h.getUrl("Packages/"+e+"/Reviews",a);return h.getJSON(i)},h.getSmartMatchInfos=function(e){e=e||{};var r=h.getUrl("Library/FileOrganizations/SmartMatches",e);return h.ajax({type:"GET",url:r,dataType:"json"})},h.deleteSmartMatchEntries=function(e){var r=h.getUrl("Library/FileOrganizations/SmartMatches/Delete"),t={Entries:e};return h.ajax({type:"POST",url:r,data:JSON.stringify(t),contentType:"application/json"})},h.createPin=function(){return h.ajax({type:"POST",url:h.getUrl("Auth/Pin"),data:{deviceId:h.deviceId(),appName:h.appName()},dataType:"json"})},h.getPinStatus=function(e){var r={deviceId:e.DeviceId,pin:e.Pin};return h.ajax({type:"GET",url:h.getUrl("Auth/Pin",r),dataType:"json"})},h.exchangePin=function(e){return y(e).then(function(e){return h.onAuthenticated&&h.onAuthenticated(h,e),e})}}});