define([],function(){return function(e){function n(n,r){r=r||{};var i=r.uploadPhotos!==!1;return r.cameraUploadServers&&-1==r.cameraUploadServers.indexOf(n.Id)&&(i=!1),i?new Promise(function(i,o){require(["contentuploader"],function(c){new c(e).uploadImages(n).then(function(){t(n,r).then(i,o)},function(){t(n,r).then(i,o)})})}):t(n,r)}function t(n,t){return t.syncOfflineUsers===!1?r(n,t):new Promise(function(i,o){require(["offlineusersync"],function(c){var u=e.getApiClient(n.Id);(new c).sync(u,n).then(function(){r(n,t).then(i,o)},o)})})}function r(n,t){return new Promise(function(r,i){require(["mediasync"],function(o){var c=e.getApiClient(n.Id);(new o).sync(c,n,t).then(r,i)})})}var i=this;i.sync=function(t,r){if(!t.AccessToken&&!t.ExchangeToken)return Promise.resolve();var i={updateDateLastAccessed:!1,enableWebSocket:!1,reportCapabilities:!1};return e.connectToServer(t,i).then(function(e){return e.State==MediaBrowser.ConnectionState.SignedIn?n(t,r):Promise.reject()},function(e){throw e})}}});