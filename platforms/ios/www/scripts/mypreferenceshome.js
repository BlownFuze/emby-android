define([],function(){function e(e,t,n){var o="";o+='<div class="checkboxList">',o+=n.map(function(e){var n="",o="chkGroupFolder"+e.Id,i=null!=t.Configuration.ExcludeFoldersFromGrouping&&-1==t.Configuration.ExcludeFoldersFromGrouping.indexOf(e.Id)||-1!=t.Configuration.GroupedFolders.indexOf(e.Id),r=i?' checked="checked"':"";return n+="<label>",n+='<input type="checkbox" is="emby-checkbox" class="chkGroupFolder" data-folderid="'+e.Id+'" id="'+o+'"'+r+"/>",n+="<span>"+e.Name+"</span>",n+="</label>"}).join(""),o+="</div>",e.querySelector(".folderGroupList").innerHTML=o}function t(e,t,n){var o="";o+='<div class="checkboxList">',o+=n.Items.map(function(e){var n="",o="chkIncludeInLatest"+e.Id,i=-1==t.Configuration.LatestItemsExcludes.indexOf(e.Id),r=i?' checked="checked"':"";return n+="<label>",n+='<input type="checkbox" is="emby-checkbox" class="chkIncludeInLatest" data-folderid="'+e.Id+'" id="'+o+'"'+r+"/>",n+="<span>"+e.Name+"</span>",n+="</label>"}).join(""),o+="</div>",e.querySelector(".latestItemsList").innerHTML=o}function n(e,t,n){var o="",i=0;o+=n.Items.map(function(e){var t="";return t+='<paper-icon-item class="viewItem" data-viewid="'+e.Id+'">',t+='<paper-fab mini style="background-color:#444;" icon="folder-open" item-icon></paper-fab>',t+="<paper-item-body>",t+="<div>",t+=e.Name,t+="</div>",t+="</paper-item-body>",i>0?t+='<button type="button" is="paper-icon-button-light" class="btnViewItemUp btnViewItemMove autoSize" title="'+Globalize.translate("ButtonUp")+'"><i class="md-icon">keyboard_arrow_up</i></button>':n.Items.length>1&&(t+='<button type="button" is="paper-icon-button-light" class="btnViewItemDown btnViewItemMove autoSize" title="'+Globalize.translate("ButtonDown")+'"><i class="md-icon">keyboard_arrow_down</i></button>'),t+="</paper-icon-item>",i++,t}).join(""),e.querySelector(".viewOrderList").innerHTML=o}function o(o,i,r){o.querySelector(".chkHidePlayedFromLatest").checked=i.Configuration.HidePlayedInLatest||!1,o.querySelector(".chkDisplayChannelsInline").checked=!i.Configuration.EnableChannelView,o.querySelector("#selectHomeSection1").value=r.CustomPrefs.home0||"",o.querySelector("#selectHomeSection2").value=r.CustomPrefs.home1||"",o.querySelector("#selectHomeSection3").value=r.CustomPrefs.home2||"",o.querySelector("#selectHomeSection4").value=r.CustomPrefs.home3||"";var a=ApiClient.getItems(i.Id,{sortBy:"SortName"}),s=ApiClient.getUserViews({},i.Id),l=ApiClient.getJSON(ApiClient.getUrl("Users/"+i.Id+"/GroupingOptions"));Promise.all([a,s,l]).then(function(r){e(o,i,r[2]),t(o,i,r[0]),n(o,i,r[1]),Dashboard.hideLoadingMsg()})}function i(){return AppInfo.isNativeApp?"Emby Mobile":"webclient"}function r(e,t,n){for(var o=t.querySelectorAll(e),i=[],r=0,a=o.length;a>r;r++)o[r].checked==n&&i.push(o[r]);return i}function a(e,t,n){t.Configuration.HidePlayedInLatest=e.querySelector(".chkHidePlayedFromLatest").checked,t.Configuration.EnableChannelView=!e.querySelector(".chkDisplayChannelsInline").checked,t.Configuration.LatestItemsExcludes=r(".chkIncludeInLatest",e,!1).map(function(e){return e.getAttribute("data-folderid")}),t.Configuration.ExcludeFoldersFromGrouping=null,t.Configuration.GroupedFolders=r(".chkGroupFolder",e,!0).map(function(e){return e.getAttribute("data-folderid")});for(var o=e.querySelectorAll(".viewItem"),a=[],s=0,l=o.length;l>s;s++)a.push(o[s].getAttribute("data-viewid"));return t.Configuration.OrderedViews=a,n.CustomPrefs.home0=e.querySelector("#selectHomeSection1").value,n.CustomPrefs.home1=e.querySelector("#selectHomeSection2").value,n.CustomPrefs.home2=e.querySelector("#selectHomeSection3").value,n.CustomPrefs.home3=e.querySelector("#selectHomeSection4").value,ApiClient.updateDisplayPreferences("home",n,t.Id,i()).then(function(){return ApiClient.updateUserConfiguration(t.Id,t.Configuration)})}function s(e){Dashboard.showLoadingMsg();var t=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(t).then(function(t){ApiClient.getDisplayPreferences("home",t.Id,i()).then(function(n){a(e,t,n).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})})}function l(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function c(e,t,n){for(var o=e[t];null!=o&&!o.classList.contains(n););return null!=o&&(o.classList.contains(n)||(o=null)),o}return function(e){function t(t){return s(e),t.preventDefault(),!1}e.querySelector(".viewOrderList").addEventListener("click",function(e){var t=l(e.target,"btnViewItemMove"),n=l(t,"viewItem"),o=l(n,"paperList");if(t.classList.contains("btnViewItemDown")){var i=n.nextSibling;n.parentNode.removeChild(n),i.parentNode.insertBefore(n,i.nextSibling)}else{var r=n.previousSibling;n.parentNode.removeChild(n),r.parentNode.insertBefore(n,r)}for(var a=o.querySelectorAll(".viewItem"),s=0,u=a.length;u>s;s++){var d=a[s],p=d.querySelector(".btnViewItemMove"),m=c(d,"previousSibling","viewItem");m?(p.classList.add("btnViewItemUp"),p.classList.remove("btnViewItemDown"),p.icon="keyboard-arrow-up"):(p.classList.remove("btnViewItemUp"),p.classList.add("btnViewItemDown"),p.icon="keyboard-arrow-down")}}),e.querySelector(".homeScreenPreferencesForm").addEventListener("submit",t),AppInfo.enableAutoSave?e.querySelector(".btnSave").classList.add("hide"):e.querySelector(".btnSave").classList.remove("hide"),e.addEventListener("viewshow",function(){var e=this;Dashboard.showLoadingMsg();var t=getParameterByName("userId")||Dashboard.getCurrentUserId();ApiClient.getUser(t).then(function(t){ApiClient.getDisplayPreferences("home",t.Id,i()).then(function(n){o(e,t,n)})})}),e.addEventListener("viewbeforehide",function(){var e=this;AppInfo.enableAutoSave&&s(e)})}});