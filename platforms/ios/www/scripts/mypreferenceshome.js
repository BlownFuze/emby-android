define(["listViewStyle"],function(){function e(e,t,n){var i="";i+='<div class="checkboxList">',i+=n.map(function(e){var n="",i="chkGroupFolder"+e.Id,o=null!=t.Configuration.ExcludeFoldersFromGrouping&&-1==t.Configuration.ExcludeFoldersFromGrouping.indexOf(e.Id)||-1!=t.Configuration.GroupedFolders.indexOf(e.Id),r=o?' checked="checked"':"";return n+="<label>",n+='<input type="checkbox" is="emby-checkbox" class="chkGroupFolder" data-folderid="'+e.Id+'" id="'+i+'"'+r+"/>",n+="<span>"+e.Name+"</span>",n+="</label>"}).join(""),i+="</div>",e.querySelector(".folderGroupList").innerHTML=i}function t(e,t,n){var i="";i+='<div class="checkboxList">',i+=n.Items.map(function(e){var n="",i="chkIncludeInLatest"+e.Id,o=-1==t.Configuration.LatestItemsExcludes.indexOf(e.Id),r=o?' checked="checked"':"";return n+="<label>",n+='<input type="checkbox" is="emby-checkbox" class="chkIncludeInLatest" data-folderid="'+e.Id+'" id="'+i+'"'+r+"/>",n+="<span>"+e.Name+"</span>",n+="</label>"}).join(""),i+="</div>",e.querySelector(".latestItemsList").innerHTML=i}function n(e,t,n){var i="",o=0;i+=n.Items.map(function(e){var t="";return t+='<div class="listItem viewItem" data-viewid="'+e.Id+'">',t+='<button type="button" is="emby-button" class="fab mini autoSize" item-icon><i class="md-icon">folder_open</i></button>',t+='<div class="listItemBody">',t+="<div>",t+=e.Name,t+="</div>",t+="</div>",o>0?t+='<button type="button" is="paper-icon-button-light" class="btnViewItemUp btnViewItemMove autoSize" title="'+Globalize.translate("ButtonUp")+'"><i class="md-icon">keyboard_arrow_up</i></button>':n.Items.length>1&&(t+='<button type="button" is="paper-icon-button-light" class="btnViewItemDown btnViewItemMove autoSize" title="'+Globalize.translate("ButtonDown")+'"><i class="md-icon">keyboard_arrow_down</i></button>'),t+="</div>",o++,t}).join(""),e.querySelector(".viewOrderList").innerHTML=i}function i(i,o,r){i.querySelector(".chkHidePlayedFromLatest").checked=o.Configuration.HidePlayedInLatest||!1,i.querySelector(".chkDisplayChannelsInline").checked=!o.Configuration.EnableChannelView,i.querySelector("#selectHomeSection1").value=r.CustomPrefs.home0||"",i.querySelector("#selectHomeSection2").value=r.CustomPrefs.home1||"",i.querySelector("#selectHomeSection3").value=r.CustomPrefs.home2||"",i.querySelector("#selectHomeSection4").value=r.CustomPrefs.home3||"";var a=ApiClient.getItems(o.Id,{sortBy:"SortName"}),s=ApiClient.getUserViews({},o.Id),l=ApiClient.getJSON(ApiClient.getUrl("Users/"+o.Id+"/GroupingOptions"));Promise.all([a,s,l]).then(function(r){e(i,o,r[2]),t(i,o,r[0]),n(i,o,r[1]),Dashboard.hideLoadingMsg()})}function o(){return AppInfo.isNativeApp?"Emby Mobile":"webclient"}function r(e,t,n){for(var i=t.querySelectorAll(e),o=[],r=0,a=i.length;a>r;r++)i[r].checked==n&&o.push(i[r]);return o}function a(e,t,n){t.Configuration.HidePlayedInLatest=e.querySelector(".chkHidePlayedFromLatest").checked,t.Configuration.EnableChannelView=!e.querySelector(".chkDisplayChannelsInline").checked,t.Configuration.LatestItemsExcludes=r(".chkIncludeInLatest",e,!1).map(function(e){return e.getAttribute("data-folderid")}),t.Configuration.ExcludeFoldersFromGrouping=null,t.Configuration.GroupedFolders=r(".chkGroupFolder",e,!0).map(function(e){return e.getAttribute("data-folderid")});for(var i=e.querySelectorAll(".viewItem"),a=[],s=0,l=i.length;l>s;s++)a.push(i[s].getAttribute("data-viewid"));return t.Configuration.OrderedViews=a,n.CustomPrefs.home0=e.querySelector("#selectHomeSection1").value,n.CustomPrefs.home1=e.querySelector("#selectHomeSection2").value,n.CustomPrefs.home2=e.querySelector("#selectHomeSection3").value,n.CustomPrefs.home3=e.querySelector("#selectHomeSection4").value,ApiClient.updateDisplayPreferences("home",n,t.Id,o()).then(function(){return ApiClient.updateUserConfiguration(t.Id,t.Configuration)})}function s(e,t){Dashboard.showLoadingMsg(),AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(t).then(function(t){ApiClient.getDisplayPreferences("home",t.Id,o()).then(function(n){a(e,t,n).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})})}function l(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function u(e,t,n){for(var i=e[t];null!=i&&!i.classList.contains(n););return null!=i&&(i.classList.contains(n)||(i=null)),i}return function(e,t){function n(t){return s(e,r),t.preventDefault(),!1}var r=getParameterByName("userId")||Dashboard.getCurrentUserId();e.querySelector(".viewOrderList").addEventListener("click",function(e){var t=l(e.target,"btnViewItemMove"),n=l(t,"viewItem"),i=l(n,"paperList");if(t.classList.contains("btnViewItemDown")){var o=n.nextSibling;n.parentNode.removeChild(n),o.parentNode.insertBefore(n,o.nextSibling)}else{var r=n.previousSibling;n.parentNode.removeChild(n),r.parentNode.insertBefore(n,r)}for(var a=i.querySelectorAll(".viewItem"),s=0,c=a.length;c>s;s++){var d=a[s],m=d.querySelector(".btnViewItemMove"),f=u(d,"previousSibling","viewItem");f?(m.classList.add("btnViewItemUp"),m.classList.remove("btnViewItemDown"),m.icon="keyboard-arrow-up"):(m.classList.remove("btnViewItemUp"),m.classList.add("btnViewItemDown"),m.icon="keyboard-arrow-down")}}),e.querySelector(".homeScreenPreferencesForm").addEventListener("submit",n),AppInfo.enableAutoSave?e.querySelector(".btnSave").classList.add("hide"):e.querySelector(".btnSave").classList.remove("hide"),e.addEventListener("viewshow",function(){var e=this;Dashboard.showLoadingMsg();var n=t.userId||Dashboard.getCurrentUserId();ApiClient.getUser(n).then(function(t){ApiClient.getDisplayPreferences("home",t.Id,o()).then(function(n){i(e,t,n)})})}),e.addEventListener("viewbeforehide",function(){var e=this;AppInfo.enableAutoSave&&s(e,r)})}});