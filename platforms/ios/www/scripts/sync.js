define([],function(){function e(e,i,n,a,l){if(!i)throw new Error("userId cannot be null");if(!n)throw new Error("syncOptions cannot be null");if(!a)throw new Error("form cannot be null");var r=$("#selectSyncTarget",a).val();if(!r)return void require(["toast"],function(e){e(Globalize.translate("MessagePleaseSelectDeviceToSyncTo"))});var o={userId:i,TargetId:r,ParentId:n.ParentId,Category:n.Category};t(o,a),n.items&&n.items.length&&(o.ItemIds=(n.items||[]).map(function(e){return e.Id||e}).join(",")),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Sync/Jobs"),data:JSON.stringify(o),contentType:"application/json",dataType:"json"}).then(function(){l.close(e),require(["toast"],function(e){e(Globalize.translate("MessageSyncJobCreated"))})})}function t(e,t){var i=$("#txtBitrate",t).val()||null;i&&(i=1e6*parseFloat(i)),e.Name=$("#txtSyncJobName",t).val(),e.Quality=$("#selectQuality",t).val()||null,e.Profile=$("#selectProfile",t).val()||null,e.Bitrate=i,e.ItemLimit=$("#txtItemLimit",t).val()||null,e.SyncNewContent=$("#chkSyncNewContent",t).checked(),e.UnwatchedOnly=$("#chkUnwatchedOnly",t).checked()}function i(e){return new Promise(function(t){require(["paper-checkbox","paper-input","emby-collapsible"],function(){n(e),t()})})}function n(e){var t=e.elem,i=e.dialogOptions,n=i.Targets,a="";(e.showName||-1!=i.Options.indexOf("Name"))&&(a+="<div>",a+='<paper-input type="text" id="txtSyncJobName" class="txtSyncJobName" required="required" label="'+Globalize.translate("LabelSyncJobName")+'"></paper-input>',a+="</div>",a+="<br/>"),a+="<div>",e.readOnlySyncTarget?a+='<paper-input type="text" id="selectSyncTarget" readonly label="'+Globalize.translate("LabelSyncTo")+'"></paper-input>':(a+='<label for="selectSyncTarget" class="selectLabel">'+Globalize.translate("LabelSyncTo")+"</label>",a+='<select id="selectSyncTarget" required="required" data-mini="true">',a+=n.map(function(e){var t=e.Id==AppInfo.deviceId,i=t?' selected="selected"':"";return"<option"+i+' value="'+e.Id+'">'+e.Name+"</option>"}).join(""),a+="</select>",n.length||(a+='<div class="fieldDescription">'+Globalize.translate("LabelSyncNoTargetsHelp")+"</div>",a+='<div class="fieldDescription"><a href="https://github.com/MediaBrowser/Wiki/wiki/Sync" target="_blank">'+Globalize.translate("ButtonLearnMore")+"</a></div>")),a+="</div>",a+='<div class="fldProfile" style="display:none;">',a+="<br/>",a+='<label for="selectProfile" class="selectLabel">'+Globalize.translate("LabelProfile")+"</label>",a+='<select id="selectProfile" data-mini="true">',a+="</select>",a+='<div class="fieldDescription profileDescription"></div>',a+="</div>",a+='<div class="fldQuality" style="display:none;">',a+="<br/>",a+='<label for="selectQuality" class="selectLabel">'+Globalize.translate("LabelQuality")+"</label>",a+='<select id="selectQuality" data-mini="true" required="required">',a+="</select>",a+='<div class="fieldDescription qualityDescription"></div>',a+="</div>",a+='<div class="fldBitrate" style="display:none;">',a+="<br/>",a+="<div>",a+='<paper-input type="number" step=".1" min=".1" id="txtBitrate" label="'+Globalize.translate("LabelBitrateMbps")+'"></paper-input>',a+="</div>",a+="</div>",-1!=i.Options.indexOf("UnwatchedOnly")&&(a+="<br/>",a+="<div>",a+='<paper-checkbox id="chkUnwatchedOnly">'+Globalize.translate("OptionSyncUnwatchedVideosOnly")+"</paper-checkbox>",a+='<div class="fieldDescription paperCheckboxFieldDescription">'+Globalize.translate("OptionSyncUnwatchedVideosOnlyHelp")+"</div>",a+="</div>"),(-1!=i.Options.indexOf("SyncNewContent")||-1!=i.Options.indexOf("ItemLimit"))&&(a+="<br/>",a+='<emby-collapsible title="'+Globalize.translate("HeaderAdvanced")+'">',a+='<div style="padding:0 0 1em;">',-1!=i.Options.indexOf("SyncNewContent")&&(a+="<br/>",a+="<div>",a+='<paper-checkbox id="chkSyncNewContent" checked>'+Globalize.translate("OptionAutomaticallySyncNewContent")+"</paper-checkbox>",a+='<div class="fieldDescription paperCheckboxFieldDescription">'+Globalize.translate("OptionAutomaticallySyncNewContentHelp")+"</div>",a+="</div>"),-1!=i.Options.indexOf("ItemLimit")&&(a+="<div>",a+='<paper-input type="number" step="1" min="1" id="txtItemLimit" label="'+Globalize.translate("LabelItemLimit")+'"></paper-input>',a+='<div class="fieldDescription">'+Globalize.translate("LabelItemLimitHelp")+"</div>",a+="</div>"),a+="</emby-collapsible>",a+="</div>"),$(t).html(a),$("#selectSyncTarget",t).on("change",function(){p(t,this.value,e.dialogOptionsFn)}).trigger("change"),$("#selectProfile",t).on("change",function(){s(t,this.value)}).trigger("change"),$("#selectQuality",t).on("change",function(){c(t,this.value)}).trigger("change")}function a(e){requirejs(["registrationservices"],function(){RegistrationServices.validateFeature("sync").then(function(){l(e)})})}function l(t){require(["paperdialoghelper","paper-fab"],function(n){var a=Dashboard.getCurrentUserId(),l={UserId:a,ItemIds:(t.items||[]).map(function(e){return e.Id||e}).join(","),ParentId:t.ParentId,Category:t.Category};ApiClient.getJSON(ApiClient.getUrl("Sync/Options",l)).then(function(o){u=o;var s=n.createDialog({size:"small",removeOnClose:!0,autoFocus:!1});s.classList.add("ui-body-a"),s.classList.add("background-theme-a"),s.classList.add("popupEditor");var c="";c+='<div class="dialogHeader">',c+='<paper-icon-button icon="arrow-back" class="btnCancel" tabindex="-1"></paper-icon-button>',c+='<div class="dialogHeaderTitle">',c+=Globalize.translate("SyncMedia"),c+="</div>",c+='<a href="https://github.com/MediaBrowser/Wiki/wiki/Sync" target="_blank" class="clearLink" style="margin-top:0;display:inline-block;vertical-align:middle;margin-left:auto;"><paper-button class="mini"><iron-icon icon="info"></iron-icon><span>'+Globalize.translate("ButtonHelp")+"</span></paper-button></a>",c+="</div>",c+='<form class="formSubmitSyncRequest" style="margin: auto;">',c+='<div class="formFields"></div>',c+="<p>",c+='<button type="submit" data-role="none" class="clearButton"><paper-button raised class="submit block"><iron-icon icon="sync"></iron-icon><span>'+Globalize.translate("ButtonSync")+"</span></paper-button></button>",c+="</p>",c+="</form>",s.innerHTML=c,document.body.appendChild(s),n.open(s),$("form",s).on("submit",function(){return e(s,a,t,this,n),!1}),$(".btnCancel",s).on("click",function(){n.close(s)}),i({elem:$(".formFields",s),dialogOptions:o,dialogOptionsFn:r(l)})})})}function r(e){return function(t){return e.TargetId=t,ApiClient.getJSON(ApiClient.getUrl("Sync/Options",e))}}function o(e,t){t?($(".fldQuality",e).show(),$("#selectQuality",e).attr("required","required")):($(".fldQuality",e).hide(),$("#selectQuality",e).removeAttr("required"))}function s(e,t){var i=u||{},n=(i.ProfileOptions||[]).filter(function(e){return e.Id==t})[0];n?($(".profileDescription",e).html(n.Description||""),o(e,i.QualityOptions.length>0&&n.EnableQualityOptions&&-1!=i.Options.indexOf("Quality"))):($(".profileDescription",e).html(""),o(e,i.QualityOptions.length>0&&-1!=i.Options.indexOf("Quality")))}function c(e,t){var i=u||{},n=(i.QualityOptions||[]).filter(function(e){return e.Id==t})[0];$(".qualityDescription",e).html(n?n.Description||"":""),"custom"==t?($(".fldBitrate",e).show(),$("#txtBitrate",e).attr("required","required")):($(".fldBitrate",e).hide(),$("#txtBitrate",e).removeAttr("required").val(""))}function d(e,t){u=t,t.ProfileOptions.length&&-1!=t.Options.indexOf("Profile")?($(".fldProfile",e).show(),$("#selectProfile",e).attr("required","required")):($(".fldProfile",e).hide(),$("#selectProfile",e).removeAttr("required")),o(t.QualityOptions.length>0),$("#selectProfile",e).html(t.ProfileOptions.map(function(e){var t=e.IsDefault?' selected="selected"':"";return'<option value="'+e.Id+'"'+t+">"+e.Name+"</option>"}).join("")).trigger("change"),$("#selectQuality",e).html(t.QualityOptions.map(function(e){var t=e.IsDefault?' selected="selected"':"";return'<option value="'+e.Id+'"'+t+">"+e.Name+"</option>"}).join("")).trigger("change")}function p(e,t,i){i(t).then(function(t){d(e,t)})}var u;return{showMenu:a,renderForm:i,setJobValues:t}});