!function(e,t){function i(i,a,r,l){if(!a)throw new Error("userId cannot be null");if(!r)throw new Error("syncOptions cannot be null");if(!l)throw new Error("form cannot be null");var o=t("#selectSyncTarget",l).val();if(!o)return void Dashboard.alert(Globalize.translate("MessagePleaseSelectDeviceToSyncTo"));var s={userId:a,TargetId:o,ParentId:r.ParentId,Category:r.Category};n(s,l),r.items&&r.items.length&&(s.ItemIds=(r.items||[]).map(function(e){return e.Id||e}).join(",")),ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Sync/Jobs"),data:JSON.stringify(s),contentType:"application/json",dataType:"json"}).then(function(){PaperDialogHelper.close(i),t(e.SyncManager).trigger("jobsubmit"),Dashboard.alert(Globalize.translate("MessageSyncJobCreated"))})}function n(e,i){var n=t("#txtBitrate",i).val()||null;n&&(n=1e6*parseFloat(n)),e.Name=t("#txtSyncJobName",i).val(),e.Quality=t("#selectQuality",i).val()||null,e.Profile=t("#selectProfile",i).val()||null,e.Bitrate=n,e.ItemLimit=t("#txtItemLimit",i).val()||null,e.SyncNewContent=t("#chkSyncNewContent",i).checked(),e.UnwatchedOnly=t("#chkUnwatchedOnly",i).checked()}function a(e){require(["paper-checkbox","paper-input"],function(){r(e)})}function r(e){var i=e.elem,n=e.dialogOptions,a=n.Targets,r="";(e.showName||-1!=n.Options.indexOf("Name"))&&(r+="<div>",r+='<paper-input type="text" id="txtSyncJobName" class="txtSyncJobName" required="required" label="'+Globalize.translate("LabelSyncJobName")+'"></paper-input>',r+="</div>",r+="<br/>"),r+="<div>",e.readOnlySyncTarget?r+='<paper-input type="text" id="selectSyncTarget" readonly label="'+Globalize.translate("LabelSyncTo")+'"></paper-input>':(r+='<label for="selectSyncTarget">'+Globalize.translate("LabelSyncTo")+"</label>",r+='<select id="selectSyncTarget" required="required" data-mini="true">',r+=a.map(function(e){var t=e.Id==AppInfo.deviceId,i=t?' selected="selected"':"";return"<option"+i+' value="'+e.Id+'">'+e.Name+"</option>"}).join(""),r+="</select>",a.length||(r+='<div class="fieldDescription">'+Globalize.translate("LabelSyncNoTargetsHelp")+"</div>",r+='<div class="fieldDescription"><a href="https://github.com/MediaBrowser/Wiki/wiki/Sync" target="_blank">'+Globalize.translate("ButtonLearnMore")+"</a></div>")),r+="</div>",r+='<div class="fldProfile" style="display:none;">',r+="<br/>",r+='<label for="selectProfile">'+Globalize.translate("LabelProfile")+"</label>",r+='<select id="selectProfile" data-mini="true">',r+="</select>",r+='<div class="fieldDescription profileDescription"></div>',r+="</div>",r+='<div class="fldQuality" style="display:none;">',r+="<br/>",r+='<label for="selectQuality">'+Globalize.translate("LabelQuality")+"</label>",r+='<select id="selectQuality" data-mini="true" required="required">',r+="</select>",r+='<div class="fieldDescription qualityDescription"></div>',r+="</div>",r+='<div class="fldBitrate" style="display:none;">',r+="<br/>",r+="<div>",r+='<paper-input type="number" step=".1" min=".1" id="txtBitrate" label="'+Globalize.translate("LabelBitrateMbps")+'"></paper-input>',r+="</div>",r+="</div>",-1!=n.Options.indexOf("UnwatchedOnly")&&(r+="<br/>",r+="<div>",r+='<paper-checkbox id="chkUnwatchedOnly">'+Globalize.translate("OptionSyncUnwatchedVideosOnly")+"</paper-checkbox>",r+='<div class="fieldDescription paperCheckboxFieldDescription">'+Globalize.translate("OptionSyncUnwatchedVideosOnlyHelp")+"</div>",r+="</div>"),(-1!=n.Options.indexOf("SyncNewContent")||-1!=n.Options.indexOf("ItemLimit"))&&(r+="<br/>",r+='<div data-role="collapsible" data-mini="true">',r+="<h2>"+Globalize.translate("HeaderAdvanced")+"</h2>",r+='<div style="padding:0 0 1em;">',-1!=n.Options.indexOf("SyncNewContent")&&(r+="<br/>",r+="<div>",r+='<paper-checkbox id="chkSyncNewContent" checked>'+Globalize.translate("OptionAutomaticallySyncNewContent")+"</paper-checkbox>",r+='<div class="fieldDescription paperCheckboxFieldDescription">'+Globalize.translate("OptionAutomaticallySyncNewContentHelp")+"</div>",r+="</div>"),-1!=n.Options.indexOf("ItemLimit")&&(r+="<div>",r+='<paper-input type="number" step="1" min="1" id="txtItemLimit" label="'+Globalize.translate("LabelItemLimit")+'"></paper-input>',r+='<div class="fieldDescription">'+Globalize.translate("LabelItemLimitHelp")+"</div>",r+="</div>"),r+="</div>",r+="</div>"),t(i).html(r).trigger("create"),t("#selectSyncTarget",i).on("change",function(){p(i,this.value,e.dialogOptionsFn)}).trigger("change"),t("#selectProfile",i).on("change",function(){c(i,this.value)}).trigger("change"),t("#selectQuality",i).on("change",function(){d(i,this.value)}).trigger("change")}function l(e){requirejs(["scripts/registrationservices"],function(){RegistrationServices.validateFeature("sync").then(function(){o(e)})})}function o(e){require(["components/paperdialoghelper","paper-fab"],function(){var n=Dashboard.getCurrentUserId(),r={UserId:n,ItemIds:(e.items||[]).map(function(e){return e.Id||e}).join(","),ParentId:e.ParentId,Category:e.Category};ApiClient.getJSON(ApiClient.getUrl("Sync/Options",r)).then(function(l){m=l;var o=PaperDialogHelper.createDialog({size:"small",theme:"a"}),c="";c+='<h2 class="dialogHeader">',c+='<paper-fab icon="arrow-back" mini class="btnCancel"></paper-fab>',c+="</h2>",c+="<div>",c+='<form class="formSubmitSyncRequest" style="margin: auto;">',c+='<div style="margin:1em 0 1.5em;">',c+='<h1 style="margin: 0;display:inline-block;vertical-align:middle;">'+Globalize.translate("SyncMedia")+"</h1>",c+='<a href="https://github.com/MediaBrowser/Wiki/wiki/Sync" target="_blank" class="clearLink" style="margin-top:0;display:inline-block;vertical-align:middle;margin-left:1em;"><paper-button raised class="secondary mini"><iron-icon icon="info"></iron-icon><span>'+Globalize.translate("ButtonHelp")+"</span></paper-button></a>",c+="</div>",c+='<div class="formFields"></div>',c+="<p>",c+='<button type="submit" data-role="none" class="clearButton"><paper-button raised class="submit block"><iron-icon icon="sync"></iron-icon><span>'+Globalize.translate("ButtonSync")+"</span></paper-button></button>",c+="</p>",c+="</form>",c+="</div>",o.innerHTML=c,document.body.appendChild(o),o.addEventListener("iron-overlay-closed",function(){o.parentNode.removeChild(o)}),PaperDialogHelper.openWithHash(o,"syncjob"),t("form",o).on("submit",function(){return i(o,n,e,this),!1}),t(".btnCancel").on("click",function(){PaperDialogHelper.close(o)}),a({elem:t(".formFields",o),dialogOptions:l,dialogOptionsFn:s(r)})})})}function s(e){return function(t){return e.TargetId=t,ApiClient.getJSON(ApiClient.getUrl("Sync/Options",e))}}function c(e,i){var n=m||{},a=(n.ProfileOptions||[]).filter(function(e){return e.Id==i})[0];a?(t(".profileDescription",e).html(a.Description||""),u(e,n.QualityOptions.length>0&&a.EnableQualityOptions&&-1!=n.Options.indexOf("Quality"))):(t(".profileDescription",e).html(""),u(e,n.QualityOptions.length>0&&-1!=n.Options.indexOf("Quality")))}function d(e,i){var n=m||{},a=(n.QualityOptions||[]).filter(function(e){return e.Id==i})[0];t(".qualityDescription",e).html(a?a.Description||"":""),"custom"==i?(t(".fldBitrate",e).show(),t("#txtBitrate",e).attr("required","required")):(t(".fldBitrate",e).hide(),t("#txtBitrate",e).removeAttr("required").val(""))}function p(e,t,i){i(t).then(function(t){y(e,t)})}function u(e,i){i?(t(".fldQuality",e).show(),t("#selectQuality",e).attr("required","required")):(t(".fldQuality",e).hide(),t("#selectQuality",e).removeAttr("required"))}function y(e,i){m=i,i.ProfileOptions.length&&-1!=i.Options.indexOf("Profile")?(t(".fldProfile",e).show(),t("#selectProfile",e).attr("required","required")):(t(".fldProfile",e).hide(),t("#selectProfile",e).removeAttr("required")),u(i.QualityOptions.length>0),t("#selectProfile",e).html(i.ProfileOptions.map(function(e){var t=e.IsDefault?' selected="selected"':"";return'<option value="'+e.Id+'"'+t+">"+e.Name+"</option>"}).join("")).trigger("change"),t("#selectQuality",e).html(i.QualityOptions.map(function(e){var t=e.IsDefault?' selected="selected"':"";return'<option value="'+e.Id+'"'+t+">"+e.Name+"</option>"}).join("")).trigger("change")}function f(e){return AppInfo.isNativeApp&&!Dashboard.capabilities().SupportsSync?!1:e.SupportsSync}function b(i){var n=e.ApiClient;n&&n.getCurrentUserId()&&Dashboard.getCurrentUser().then(function(){var e={SupportsSync:!0};f(e)?t(".categorySyncButton",i).removeClass("hide"):t(".categorySyncButton",i).addClass("hide")})}function g(e,t){var i=t.getAttribute("data-category"),n=LibraryMenu.getTopParentId();SyncManager.showMenu({ParentId:n,Category:i})}var m;e.SyncManager={showMenu:l,isAvailable:f,renderForm:a,setJobValues:n},t(document).on("pageinit",".libraryPage",function(){var e=this;t(".categorySyncButton",e).on("click",function(){g(e,this)})}).on("pageshow",".libraryPage",function(){var e=this;Dashboard.isServerlessPage()||b(e)})}(window,jQuery);