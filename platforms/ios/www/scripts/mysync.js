define(["apphost","globalize","syncJobList","events","localsync","emby-button","paper-icon-button-light"],function(e,t,n,r,o){function i(e){e.querySelector(".btnSyncSupporter").addEventListener("click",function(){requirejs(["registrationservices"],function(e){e.validateFeature("sync")})}),e.querySelector(".supporterPromotion .mainText").innerHTML=t.translate("HeaderSyncRequiresSupporterMembership");var n=ApiClient;n.getPluginSecurityInfo().then(function(t){t.IsMBSupporter?e.querySelector(".supporterPromotionContainer").classList.add("hide"):e.querySelector(".supporterPromotionContainer").classList.remove("hide")},function(){e.querySelector(".supporterPromotionContainer").classList.remove("hide")})}return function(t,s){function c(){return e.supports("sync")&&"offline"==s.mode}function u(e){if(c()){var t=o.getSyncStatus();"Active"==t?e.querySelector(".btnSyncNow").classList.add("hide"):e.querySelector(".btnSyncNow").classList.remove("hide")}}function a(e){o.sync(),require(["toast"],function(e){e(Globalize.translate("MessageSyncStarted"))}),u(e)}var l;t.querySelector(".btnSyncNow").addEventListener("click",function(){a(t)}),c()?t.querySelector(".localSyncStatus").classList.remove("hide"):t.querySelector(".localSyncStatus").classList.add("hide"),i(t,s);var d=new n({isLocalSync:"offline"===s.mode,serverId:ApiClient.serverId(),userId:"offline"===s.mode?null:ApiClient.getCurrentUserId(),element:t.querySelector(".syncActivity")});r.on(d,"jobedit",function(e,t){Dashboard.navigate("mysyncjob.html?id="+t)}),t.addEventListener("viewbeforeshow",function(){u(t),e.supports("sync")&&(l=setInterval(function(){u(t)},5e3))}),t.addEventListener("viewbeforehide",function(){l&&(clearInterval(l),l=null)}),t.addEventListener("viewdestroy",function(){d.destroy()})}});