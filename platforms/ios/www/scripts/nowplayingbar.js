!function(e,t,n,a){function i(){var e="";return e+='<div class="nowPlayingBar hide">',e+='<div class="nowPlayingBarPositionContainer">',e+='<paper-slider pin step=".1" min="0" max="100" value="0" class="nowPlayingBarPositionSlider"></paper-slider>',e+="</div>",e+='<div class="nowPlayingBarInfoContainer">',e+='<div class="nowPlayingImage"></div>',e+='<div class="nowPlayingBarText"></div>',e+="</div>",e+='<div class="nowPlayingBarCenter">',e+='<paper-icon-button icon="skip-previous" class="previousTrackButton mediaButton"></paper-icon-button>',e+='<paper-icon-button icon="play-arrow" class="mediaButton unpauseButton"></paper-icon-button>',e+='<paper-icon-button icon="pause" class="mediaButton pauseButton"></paper-icon-button>',e+='<paper-icon-button icon="stop" class="stopButton mediaButton"></paper-icon-button>',e+='<paper-icon-button icon="skip-next" class="nextTrackButton mediaButton"></paper-icon-button>',e+='<div class="nowPlayingBarCurrentTime"></div>',e+="</div>",e+='<div class="nowPlayingBarRight">',e+='<paper-icon-button icon="volume-up" class="muteButton mediaButton"></paper-icon-button>',e+='<paper-icon-button icon="volume-off" class="unmuteButton mediaButton"></paper-icon-button>',e+='<paper-slider pin step="1" min="0" max="100" value="0" class="nowPlayingBarVolumeSlider" style="width:100px;vertical-align:middle;display:inline-block;"></paper-slider>',e+='<paper-icon-button icon="repeat" class="mediaButton toggleRepeatButton"></paper-icon-button>',e+='<div class="nowPlayingBarUserDataButtons">',e+="</div>",e+='<paper-icon-button icon="play-arrow" class="mediaButton unpauseButton"></paper-icon-button>',e+='<paper-icon-button icon="pause" class="mediaButton pauseButton"></paper-icon-button>',e+='<paper-icon-button icon="tablet-android" onclick="Dashboard.navigate(\'nowplaying.html\', false);" class="mediaButton remoteControlButton"></paper-icon-button>',e+='<paper-icon-button icon="queue-music" class="mediaButton playlistButton"></paper-icon-button>',e+="</div>",e+="</div>"}function o(e){return O||(O=e.offsetHeight),O+"px"}function s(e){if(!e.classList.contains("hide")){var t=function(){e.classList.add("hide")};return!browserInfo.animate||browserInfo.mobile?void t():void requestAnimationFrame(function(){var n=[{height:o(e),offset:0},{height:"0",display:"none",offset:1}],a={duration:200,iterations:1,fill:"both",easing:"ease-out"};e.animate(n,a).onfinish=t})}}function r(e){e.classList.contains("hide")&&(e.classList.remove("hide"),browserInfo.animate&&!browserInfo.mobile&&requestAnimationFrame(function(){var t=[{height:"0",offset:0},{height:o(e),offset:1}],n={duration:200,iterations:1,fill:"both",easing:"ease-out"};e.animate(t,n)}))}function l(e){k=n(".nowPlayingBarCurrentTime",e),C=n(".nowPlayingImage",e),R=n(".nowPlayingBarText",e),M=n(".nowPlayingBarUserDataButtons",e),N=n(".unmuteButton",e).on("click",function(){T&&T.unMute()}),x=n(".muteButton",e).on("click",function(){T&&T.mute()}),n(".stopButton",e).on("click",function(){T&&T.stop()}),D=n(".pauseButton",e).on("click",function(){T&&T.pause()}),A=n(".unpauseButton",e).on("click",function(){T&&T.unpause()}),n(".nextTrackButton",e).on("click",function(){T&&T.nextTrack()}),n(".previousTrackButton",e).on("click",function(){T&&T.previousTrack()}),n(".playlistButton",e).on("click",function(){n.mobile.changePage("nowplaying.html",{dataUrl:"nowplaying.html#playlist"})}),U=n(".toggleRepeatButton",e).on("click",function(){if(T){var e=V||{};switch((e.PlayState||{}).RepeatMode){case"RepeatAll":T.setRepeatMode("RepeatOne");break;case"RepeatOne":T.setRepeatMode("RepeatNone");break;default:T.setRepeatMode("RepeatAll")}}})[0],a(function(){L=n(".nowPlayingBarVolumeSlider",e).on("change",function(){T&&T.setVolume(this.value)})[0],S=n(".nowPlayingBarPositionSlider",e).on("change",function(){if(T&&V){var e=parseFloat(this.value),t=e/100*V.NowPlayingItem.RunTimeTicks;T.seek(Math.floor(t))}})[0],S._setPinValue=function(e){var t=V;if(!t||!t.NowPlayingItem||!t.NowPlayingItem.RunTimeTicks)return void(this.pinValue="--:--");var n=t.NowPlayingItem.RunTimeTicks;n/=100,n*=e,this.pinValue=Dashboard.getDisplayTime(n)}},300)}function u(){return new Promise(function(e){return q?void e(q):void require(["css!css/nowplayingbar.css","paper-slider"],function(){return(q=t.querySelector(".nowPlayingBar"))?void e(q):(q=n(i()).appendTo(t.body)[0],!browserInfo.safari&&AppInfo.isNativeApp||!browserInfo.mobile||q.classList.add("noMediaProgress"),l(q),void e(q))})})}function c(e){e.removeClass("hide")}function p(e){e.addClass("hide")}function d(e,t){return t.NowPlayingItem?q?void g(e,t):void u().then(function(){g(e,t)}):void h()}function g(e,t){if(v(),"positionchange"==e.type){var n=(new Date).getTime();if(700>n-F)return;F=n}V=t;var a=MediaController.getPlayerInfo(),i=t.PlayState||{};i.IsPaused?(p(D),c(A)):(c(D),p(A)),m(t,a);var o=t.NowPlayingItem||{};if(S&&!S.dragging){if(o.RunTimeTicks){var s=i.PositionTicks/o.RunTimeTicks;s*=100,S.value=s}else S.value=0;S.disabled=!i.CanSeek}var r=Dashboard.getDisplayTime(i.PositionTicks);o.RunTimeTicks&&(r+=" / "+Dashboard.getDisplayTime(o.RunTimeTicks)),k.html(r),f(t)}function m(e,t){t=t||MediaController.getPlayerInfo();var n=e.PlayState||{},a=t.supportedCommands,i=!0,o=!0,s=!0;-1==a.indexOf("Mute")&&(i=!1),-1==a.indexOf("Unmute")&&(o=!1),n.IsMuted?i=!1:o=!1,-1==a.indexOf("SetRepeatMode")?U.classList.add("hide"):U.classList.remove("hide"),"RepeatAll"==n.RepeatMode?(U.icon="repeat",U.classList.add("repeatActive")):"RepeatOne"==n.RepeatMode?(U.icon="repeat-one",U.classList.add("repeatActive")):(U.icon="repeat",U.classList.remove("repeatActive")),-1==a.indexOf("SetVolume")&&(s=!1),t.isLocalPlayer&&AppInfo.hasPhysicalVolumeButtons&&(i=!1,o=!1,s=!1),i?c(x):p(x),o?c(N):p(N),L&&(s?L.classList.remove("hide"):L.classList.add("hide"),L.dragging||(L.value=n.VolumeLevel||0))}function f(e){var t=MediaController.getNowPlayingNameHtml(e.NowPlayingItem)||"";-1!=t.indexOf("<br/>")?R.addClass("nowPlayingDoubleText"):R.removeClass("nowPlayingDoubleText"),e.NowPlayingItem.Id&&(t='<a style="color:inherit;text-decoration:none;" href="'+LibraryBrowser.getHref(e.NowPlayingItem)+'">'+t+"</a>"),R.html(t);var n,a=80,i=e.NowPlayingItem;if(n=i.PrimaryImageTag?ApiClient.getScaledImageUrl(i.PrimaryImageItemId,{type:"Primary",height:a,tag:i.PrimaryImageTag}):i.BackdropImageTag?ApiClient.getScaledImageUrl(i.BackdropItemId,{type:"Backdrop",height:a,tag:i.BackdropImageTag,index:0}):i.ThumbImageTag?ApiClient.getScaledImageUrl(i.ThumbImageItemId,{type:"Thumb",height:a,tag:i.ThumbImageTag}):"TvChannel"==i.Type||"Recording"==i.Type?"css/images/items/detail/tv.png":"Audio"==i.MediaType?"css/images/items/detail/audio.png":"css/images/items/detail/video.png",n!=H){H=n;var o='<img src="'+n+'" />';C.html(o),i.Id?ApiClient.getItem(Dashboard.getCurrentUserId(),i.Id).then(function(e){M.html(LibraryBrowser.getUserDataIconsHtml(e,!1))}):M.html("")}}function y(e,t){Logger.log("nowplaying event: "+e.type);var n=this;n.beginPlayerUpdates(),b.call(n,e,t)}function v(){u().then(r)}function h(){var e=t.getElementsByClassName("nowPlayingBar")[0];e&&s(e)}function P(e){Logger.log("nowplaying event: "+e.type);var t=this;t.endPlayerUpdates(),h()}function b(e,t){var n=this;n.isDefaultPlayer&&t.NowPlayingItem&&"Video"==t.NowPlayingItem.MediaType||d(e,t)}function B(){T&&(n(T).off("playbackstart",y).off("playbackstop",P).off("volumechange",w).off("playstatechange",b).off("positionchange",b),T.endPlayerUpdates(),T=null,h())}function w(){var e=this;Promise.all([e.getPlayerState(),u()]).then(function(t){var n=t[0];e.isDefaultPlayer&&n.NowPlayingItem&&"Video"==n.NowPlayingItem.MediaType||m(n)})}function I(e){B(),T=e,e.getPlayerState().then(function(t){t.NowPlayingItem&&e.beginPlayerUpdates(),b.call(e,{type:"init"},t)}),n(e).on("playbackstart",y).on("playbackstop",P).on("volumechange",w).on("playstatechange",b).on("positionchange",b)}var T,k,C,R,M,N,x,L,A,D,S,U,V,O,q,H,F=0;Events.on(MediaController,"playerchange",function(){I(MediaController.getCurrentPlayer())}),I(MediaController.getCurrentPlayer())}(window,document,jQuery,setTimeout,clearTimeout);