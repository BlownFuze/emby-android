define(["userSettings","appStorage","jQuery"],function(e,a,n){function s(s,o){s.querySelector(".chkDisplayMissingEpisodes").checked=o.Configuration.DisplayMissingEpisodes||!1,s.querySelector(".chkDisplayUnairedEpisodes").checked=o.Configuration.DisplayUnairedEpisodes||!1,s.querySelector(".chkGroupMoviesIntoCollections").checked=o.Configuration.GroupMoviesIntoBoxSets||!1,n("#selectThemeSong",s).val(a.getItem("enableThemeSongs-"+o.Id)||""),n("#selectBackdrop",s).val(a.getItem("enableBackdrops-"+o.Id)||""),n("#selectLanguage",s).val(e.language()||""),Dashboard.hideLoadingMsg()}function o(s,o){return o.Configuration.DisplayMissingEpisodes=s.querySelector(".chkDisplayMissingEpisodes").checked,o.Configuration.DisplayUnairedEpisodes=s.querySelector(".chkDisplayUnairedEpisodes").checked,o.Configuration.GroupMoviesIntoBoxSets=s.querySelector(".chkGroupMoviesIntoCollections").checked,e.language(s.querySelector("#selectLanguage").value),a.setItem("enableThemeSongs-"+o.Id,n("#selectThemeSong",s).val()),a.setItem("enableBackdrops-"+o.Id,n("#selectBackdrop",s).val()),ApiClient.updateUserConfiguration(o.Id,o.Configuration)}function i(e){var a=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(a).then(function(a){o(e,a).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})}function r(){var e=n(this).parents(".page")[0];return i(e),!1}pageIdOn("pageinit","displayPreferencesPage",function(){var e=this;n(".displayPreferencesForm").off("submit",r).on("submit",r),AppInfo.enableAutoSave?e.querySelector(".btnSave").classList.add("hide"):e.querySelector(".btnSave").classList.remove("hide")}),pageIdOn("pageshow","displayPreferencesPage",function(){var e=this;Dashboard.showLoadingMsg();var a=getParameterByName("userId")||Dashboard.getCurrentUserId();ApiClient.getUser(a).then(function(a){s(e,a),a.Policy.EnableUserPreferenceAccess?n(".requiresUserPreferences",e).show():n(".requiresUserPreferences",e).hide()}),n(".fldEnableBackdrops",e).show(),AppInfo.supportsUserDisplayLanguageSetting?n(".languageSection",e).show():n(".languageSection",e).hide()}),pageIdOn("pagebeforehide","displayPreferencesPage",function(){var e=this;AppInfo.enableAutoSave&&i(e)})});