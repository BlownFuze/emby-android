define(["userSettings","appStorage"],function(e,a){function n(n,s){n.querySelector(".chkDisplayMissingEpisodes").checked=s.Configuration.DisplayMissingEpisodes||!1,n.querySelector(".chkDisplayUnairedEpisodes").checked=s.Configuration.DisplayUnairedEpisodes||!1,n.querySelector(".chkGroupMoviesIntoCollections").checked=s.Configuration.GroupMoviesIntoBoxSets||!1,$("#selectThemeSong",n).val(a.getItem("enableThemeSongs-"+s.Id)||""),$("#selectBackdrop",n).val(a.getItem("enableBackdrops-"+s.Id)||""),$("#selectLanguage",n).val(e.language()||""),Dashboard.hideLoadingMsg()}function s(n,s){return s.Configuration.DisplayMissingEpisodes=n.querySelector(".chkDisplayMissingEpisodes").checked,s.Configuration.DisplayUnairedEpisodes=n.querySelector(".chkDisplayUnairedEpisodes").checked,s.Configuration.GroupMoviesIntoBoxSets=n.querySelector(".chkGroupMoviesIntoCollections").checked,e.language(n.querySelector("#selectLanguage").value),a.setItem("enableThemeSongs-"+s.Id,$("#selectThemeSong",n).val()),a.setItem("enableBackdrops-"+s.Id,$("#selectBackdrop",n).val()),ApiClient.updateUserConfiguration(s.Id,s.Configuration)}function o(e){var a=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(a).then(function(a){s(e,a).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})}function i(){var e=$(this).parents(".page")[0];return o(e),!1}pageIdOn("pageinit","displayPreferencesPage",function(){var e=this;$(".displayPreferencesForm").off("submit",i).on("submit",i),AppInfo.enableAutoSave?e.querySelector(".btnSave").classList.add("hide"):e.querySelector(".btnSave").classList.remove("hide")}),pageIdOn("pageshow","displayPreferencesPage",function(){var e=this;Dashboard.showLoadingMsg();var a=getParameterByName("userId")||Dashboard.getCurrentUserId();ApiClient.getUser(a).then(function(a){n(e,a),a.Policy.EnableUserPreferenceAccess?$(".requiresUserPreferences",e).show():$(".requiresUserPreferences",e).hide()}),$(".fldEnableBackdrops",e).show(),AppInfo.supportsUserDisplayLanguageSetting?$(".languageSection",e).show():$(".languageSection",e).hide()}),pageIdOn("pagebeforehide","displayPreferencesPage",function(){var e=this;AppInfo.enableAutoSave&&o(e)})});