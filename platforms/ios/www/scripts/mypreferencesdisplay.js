define(["userSettings","appStorage","jQuery"],function(e,a,s){function n(n,i){n.querySelector(".chkDisplayMissingEpisodes").checked=i.Configuration.DisplayMissingEpisodes||!1,n.querySelector(".chkDisplayUnairedEpisodes").checked=i.Configuration.DisplayUnairedEpisodes||!1,s("#selectThemeSong",n).val(a.getItem("enableThemeSongs-"+i.Id)||""),s("#selectBackdrop",n).val(a.getItem("enableBackdrops-"+i.Id)||""),s("#selectLanguage",n).val(e.language()||""),Dashboard.hideLoadingMsg()}function i(n,i){return i.Configuration.DisplayMissingEpisodes=n.querySelector(".chkDisplayMissingEpisodes").checked,i.Configuration.DisplayUnairedEpisodes=n.querySelector(".chkDisplayUnairedEpisodes").checked,e.language(n.querySelector("#selectLanguage").value),a.setItem("enableThemeSongs-"+i.Id,s("#selectThemeSong",n).val()),a.setItem("enableBackdrops-"+i.Id,s("#selectBackdrop",n).val()),ApiClient.updateUserConfiguration(i.Id,i.Configuration)}function r(e){var a=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(a).then(function(a){i(e,a).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})}function t(){var e=s(this).parents(".page")[0];return r(e),!1}pageIdOn("pageinit","displayPreferencesPage",function(){var e=this;s(".displayPreferencesForm").off("submit",t).on("submit",t),AppInfo.enableAutoSave?e.querySelector(".btnSave").classList.add("hide"):e.querySelector(".btnSave").classList.remove("hide")}),pageIdOn("pageshow","displayPreferencesPage",function(){var e=this;Dashboard.showLoadingMsg();var a=getParameterByName("userId")||Dashboard.getCurrentUserId();ApiClient.getUser(a).then(function(a){n(e,a),a.Policy.EnableUserPreferenceAccess?s(".requiresUserPreferences",e).show():s(".requiresUserPreferences",e).hide()}),s(".fldEnableBackdrops",e).show(),AppInfo.supportsUserDisplayLanguageSetting?e.querySelector(".languageSection").classList.remove("hide"):e.querySelector(".languageSection").classList.add("hide")}),pageIdOn("pagebeforehide","displayPreferencesPage",function(){var e=this;AppInfo.enableAutoSave&&r(e)})});