define(["layoutManager"],function(e){function a(){var e=getParameterByName("id");if(e)return ApiClient.getItem(Dashboard.getCurrentUserId(),e);var a=getParameterByName("genre");if(a)return ApiClient.getGenre(a,Dashboard.getCurrentUserId());if(a=getParameterByName("musicgenre"))return ApiClient.getMusicGenre(a,Dashboard.getCurrentUserId());if(a=getParameterByName("gamegenre"))return ApiClient.getGameGenre(a,Dashboard.getCurrentUserId());if(a=getParameterByName("musicartist"))return ApiClient.getArtist(a,Dashboard.getCurrentUserId());throw new Error("Invalid request")}function t(e){Dashboard.showLoadingMsg(),a().then(function(a){i(e,a),window.scrollTo(0,0)})}function i(a,t){ia=t;var i=l(t);d(a,t,i),LibraryBrowser.renderName(t,$(".itemName",a),!1,i),LibraryBrowser.renderParentName(t,$(".parentName",a),i),LibraryMenu.setTitle(t.SeriesName||t.Name),Dashboard.getCurrentUser().then(function(n){r(a,t,n),m(a,t,i,n),u(a,t,i);var s=!1;"MusicArtist"!=t.Type&&"MusicAlbum"!=t.Type&&"Playlist"!=t.Type&&"BoxSet"!=t.Type&&"Audio"!=t.Type&&e.mobile?s=LibraryBrowser.renderDetailPageBackdrop(a,t):($("#itemBackdrop",a).addClass("noBackdrop").css("background-image","none"),require(["backdrop"],function(e){e.setBackdrops([t])}));var o=s&&a.classList.contains("noSecondaryNavPage");LibraryMenu.setTransparentMenu(o);var l=!1;if("Program"==t.Type){var d=new Date;d>=parseISO8601Date(t.StartDate,{toLocal:!0})&&d<parseISO8601Date(t.EndDate,{toLocal:!0})?($(".btnPlay",a).removeClass("hide"),l=!0):$(".btnPlay",a).addClass("hide")}else MediaController.canPlay(t)?($(".btnPlay",a).removeClass("hide"),l=!0):$(".btnPlay",a).addClass("hide");t.LocalTrailerCount&&"Full"==t.PlayAccess?$(".btnPlayTrailer",a).removeClass("hide"):$(".btnPlayTrailer",a).addClass("hide"),LibraryBrowser.enableSync(t,n)?$(".btnSync",a).removeClass("hide"):$(".btnSync",a).addClass("hide"),"Program"==t.Type&&t.TimerId?$(".btnCancelRecording",a).removeClass("hide"):$(".btnCancelRecording",a).addClass("hide"),"Program"!=t.Type||t.TimerId||t.SeriesTimerId?($(".btnRecord",a).addClass("hide"),$(".btnFloatingRecord",a).addClass("hide")):l?($(".btnRecord",a).removeClass("hide"),$(".btnFloatingRecord",a).addClass("hide")):($(".btnRecord",a).addClass("hide"),$(".btnFloatingRecord",a).removeClass("hide")),!t.LocalTrailerCount&&t.RemoteTrailers.length&&"Full"==t.PlayAccess?$(".btnPlayExternalTrailer",a).removeClass("hide").attr("href",t.RemoteTrailers[0].Url):$(".btnPlayExternalTrailer",a).addClass("hide").attr("href","#");var c=(t.MediaSources||[]).filter(function(e){return"Grouping"==e.Type});if(n.Policy.IsAdministrator&&c.length?$(".splitVersionContainer",a).show():$(".splitVersionContainer",a).hide(),LibraryBrowser.getMoreCommands(t,n).length>0?$(".btnMoreCommands",a).removeClass("hide"):$(".btnMoreCommands",a).addClass("hide"),n.Policy.IsAdministrator?$(".chapterSettingsButton",a).show():$(".chapterSettingsButton",a).hide(),LiveTvHelpers.renderOriginalAirDate($(".airDate",a),t),"Person"==t.Type&&t.PremiereDate)try{var p=parseISO8601Date(t.PremiereDate,{toLocal:!0}).toDateString();$("#itemBirthday",a).show().html(Globalize.translate("BirthDateValue").replace("{0}",p))}catch(h){$("#itemBirthday",a).hide()}else $("#itemBirthday",a).hide();if("Person"==t.Type&&t.EndDate)try{var g=parseISO8601Date(t.EndDate,{toLocal:!0}).toDateString();$("#itemDeathDate",a).show().html(Globalize.translate("DeathDateValue").replace("{0}",g))}catch(h){$("#itemBirthday",a).hide()}if("Person"==t.Type&&t.ProductionLocations&&t.ProductionLocations.length){var y='<a class="textlink" target="_blank" href="https://maps.google.com/maps?q='+t.ProductionLocations[0]+'">'+t.ProductionLocations[0]+"</a>";$("#itemBirthLocation",a).show().html(Globalize.translate("BirthPlaceValue").replace("{0}",y))}else $("#itemBirthLocation",a).hide()}),"Offline"==t.LocationType?$(".offlineIndicator",a).show():$(".offlineIndicator",a).hide();var n=!1;if("Virtual"==t.LocationType&&"Episode"==t.Type)try{t.PremiereDate&&(new Date).getTime()>=parseISO8601Date(t.PremiereDate,{toLocal:!0}).getTime()&&(n=!0)}catch(s){}n?$(".missingIndicator",a).show():$(".missingIndicator",a).hide(),o(a,t),a.dispatchEvent(new CustomEvent("displayingitem",{detail:{item:t,context:i},bubbles:!0})),Dashboard.hideLoadingMsg()}function r(e,a,t){LibraryBrowser.renderDetailImage(e.querySelector(".detailImageContainer"),a,t.Policy.IsAdministrator&&"Photo"!=a.MediaType)}function n(e,a){LibraryBrowser.refreshDetailImageUserData(e.querySelector(".detailImageContainer"),a)}function s(e,a){var t=a,i=$($.mobile.activePage)[0];if("UserDataChanged"===t.MessageType&&ia&&t.Data.UserId==Dashboard.getCurrentUserId()){var r=ia.UserData.Key,s=t.Data.UserDataList.filter(function(e){return e.Key==r})[0];s&&(ia.UserData=s,Dashboard.getCurrentUser().then(function(e){n(i,ia,e)}))}}function o(e,a){$("#peopleHeader",e).html("Audio"==a.Type||"MusicAlbum"==a.Type||"Book"==a.MediaType||"Photo"==a.MediaType?Globalize.translate("HeaderPeople"):Globalize.translate("HeaderCastAndCrew"))}function l(){return getParameterByName("context")}function d(e,a,t){$(".itemTabs",e).hide(),"tv"==t?($(e).removeClass("noSecondaryNavPage"),$("#tvShowsTabs",e).show(),LibraryMenu.setMenuButtonVisible(!0)):($(e).addClass("noSecondaryNavPage"),LibraryMenu.setBackButtonVisible(!0),LibraryMenu.setMenuButtonVisible(!1))}function c(e,a,t){var i=e.querySelector(".nextUpSection"),r=a.UserData||{};return"Series"==a.Type&&r.PlayedPercentage?void ApiClient.getNextUpEpisodes({SeriesId:a.Id,UserId:t.Id}).then(function(e){e.Items.length?i.classList.remove("hide"):i.classList.add("hide");var t=LibraryBrowser.getPosterViewHtml({items:e.Items,shape:"detailPage169",showTitle:!0,displayAsSpecial:"Season"==a.Type&&a.IndexNumber,overlayText:!0,lazy:!0,overlayPlayButton:!0}),r=i.querySelector(".nextUpItems");r.innerHTML=t,ImageLoader.lazyChildren(r),$(r).createCardMenus()}):void i.classList.add("hide")}function m(e,a,t,i){$(".collectionItems",e).empty(),"TvChannel"==a.Type?($("#childrenCollapsible",e).removeClass("hide"),D(e,a,i)):"Playlist"==a.Type?($("#childrenCollapsible",e).removeClass("hide"),A(e,a,i)):"Studio"==a.Type||"Person"==a.Type||"Genre"==a.Type||"MusicGenre"==a.Type||"GameGenre"==a.Type||"MusicArtist"==a.Type?($("#childrenCollapsible",e).removeClass("hide"),L(e,a,i)):a.IsFolder?("BoxSet"==a.Type?$("#childrenCollapsible",e).addClass("hide"):$("#childrenCollapsible",e).removeClass("hide"),P(e,a,i,t)):$("#childrenCollapsible",e).addClass("hide"),"Series"==a.Type?c(e,a,i):e.querySelector(".nextUpSection").classList.add("hide"),a.MediaSources&&a.MediaSources.length&&E(e,a);var r=a.Chapters||[];r.length&&AppInfo.enableDetailPageChapters?($("#scenesCollapsible",e).show(),q(e,a,i,3)):$("#scenesCollapsible",e).hide(),a.SpecialFeatureCount&&0!=a.SpecialFeatureCount&&"Series"!=a.Type?($("#specialsCollapsible",e).removeClass("hide"),X(e,a,i,6)):$("#specialsCollapsible",e).addClass("hide"),a.People&&a.People.length?($("#castCollapsible",e).show(),Y(e,a,t,b()?null:6)):$("#castCollapsible",e).hide(),a.PartCount&&a.PartCount>1?($("#additionalPartsCollapsible",e).removeClass("hide"),N(e,a,i)):$("#additionalPartsCollapsible",e).addClass("hide"),$("#themeSongsCollapsible",e).hide(),$("#themeVideosCollapsible",e).hide(),"MusicAlbum"==a.Type?U(e,a,i):$("#musicVideosCollapsible",e).hide(),F(e,a,i),b()?x(e,a):x(e,a,1)}function u(e,a,t,i){C(e,a,t),i||y(e,a,t),a.Taglines&&a.Taglines.length?$(".tagline",e).html(a.Taglines[0]).show():$(".tagline",e).hide();var r=e.querySelector(".topOverview"),n=e.querySelector(".bottomOverview"),s=screen.availHeight<800||screen.availWidth<600;"MusicAlbum"==a.Type||"MusicArtist"==a.Type||"Season"==a.Type&&s?(LibraryBrowser.renderOverview([n],a),r.classList.add("hide"),n.classList.remove("hide")):(LibraryBrowser.renderOverview([r],a),r.classList.remove("hide"),n.classList.add("hide")),$(".itemCommunityRating",e).html(LibraryBrowser.getRatingHtml(a)),LibraryBrowser.renderAwardSummary($("#awardSummary",e),a),$(".itemMiscInfo",e).html(LibraryBrowser.getMiscInfoHtml(a)),LibraryBrowser.renderGenres($(".itemGenres",e),a,null,i),LibraryBrowser.renderStudios($(".itemStudios",e),a,i),R(e,a),LibraryBrowser.renderLinks(e.querySelector(".itemExternalLinks"),a),$(".criticRatingScore",e).html((a.CriticRating||"0")+"%"),a.CriticRatingSummary?($("#criticRatingSummary",e).show(),$(".criticRatingSummaryText",e).html(a.CriticRatingSummary)):$("#criticRatingSummary",e).hide(),S(e,a),T(e,a,i),a.Players?$("#players",e).show().html(a.Players+" Player"):$("#players",e).hide(),a.ArtistItems&&a.ArtistItems.length&&"MusicAlbum"!=a.Type?$(".artist",e).show().html(g(a.ArtistItems,t)):$(".artist",e).hide(),a.MediaSources&&a.MediaSources.length&&a.Path?$(".audioVideoMediaInfo",e).removeClass("hide"):$(".audioVideoMediaInfo",e).addClass("hide"),"Photo"==a.MediaType?($(".photoInfo",e).removeClass("hide"),p(e,a)):$(".photoInfo",e).addClass("hide"),h(e,a)}function p(e,a){var t="",i=[];if(a.CameraMake&&i.push(j(Globalize.translate("MediaInfoCameraMake"),a.CameraMake)),a.CameraModel&&i.push(j(Globalize.translate("MediaInfoCameraModel"),a.CameraModel)),a.Altitude&&i.push(j(Globalize.translate("MediaInfoAltitude"),a.Altitude.toFixed(1))),a.Aperture&&i.push(j(Globalize.translate("MediaInfoAperture"),"F"+a.Aperture.toFixed(1))),a.ExposureTime){var r=1/a.ExposureTime;i.push(j(Globalize.translate("MediaInfoExposureTime"),"1/"+r+" s"))}a.FocalLength&&i.push(j(Globalize.translate("MediaInfoFocalLength"),a.FocalLength.toFixed(1)+" mm")),a.ImageOrientation,a.IsoSpeedRating&&i.push(j(Globalize.translate("MediaInfoIsoSpeedRating"),a.IsoSpeedRating)),a.Latitude&&i.push(j(Globalize.translate("MediaInfoLatitude"),a.Latitude.toFixed(1))),a.Longitude&&i.push(j(Globalize.translate("MediaInfoLongitude"),a.Longitude.toFixed(1))),a.ShutterSpeed&&i.push(j(Globalize.translate("MediaInfoShutterSpeed"),a.ShutterSpeed)),a.Software&&i.push(j(Globalize.translate("MediaInfoSoftware"),a.Software)),t+=i.join("<br/>"),$(".photoInfoContent",e).html(t)}function h(e){var a=$(".tabDetails",e)[0],t=a.textContent||a.innerText||"";t.trim()?$(".detailsSection",e).removeClass("hide"):$(".detailsSection",e).addClass("hide")}function g(e){for(var a=[],t=0,i=e.length;i>t;t++){var r=e[t];a.push('<a class="textlink" href="itemdetails.html?id='+r.Id+'">'+r.Name+"</a>")}return a=a.join(" / "),1==e.length?Globalize.translate("ValueArtist",a):e.length>1?Globalize.translate("ValueArtists",a):a}function y(e,a,t){if($(".lnkSibling",e).addClass("hide"),"Episode"==a.Type||"Season"==a.Type||"Audio"==a.Type||"Photo"==a.Type){var i;i="Season"==a.Type?ApiClient.getSeasons(a.SeriesId,{userId:Dashboard.getCurrentUserId(),AdjacentTo:a.Id}):"Episode"==a.Type&&a.SeasonId?ApiClient.getEpisodes(a.SeriesId,{seasonId:a.SeasonId,userId:Dashboard.getCurrentUserId(),AdjacentTo:a.Id}):ApiClient.getItems(Dashboard.getCurrentUserId(),{AdjacentTo:a.Id,ParentId:a.ParentId,SortBy:"SortName"}),t=t||"",i.then(function(i){for(var r=!1,n=0,s=i.Items.length;s>n;n++){var o=i.Items[n];o.Id==a.Id?r=!0:r?$(".lnkNextItem",e).removeClass("hide").attr("href","itemdetails.html?id="+o.Id+"&context="+t):$(".lnkPreviousItem",e).removeClass("hide").attr("href","itemdetails.html?id="+o.Id+"&context="+t)}})}}function b(){return browserInfo.mobile&&AppInfo.enableAppLayouts&&screen.availWidth<=1e3}function v(){return b()?"overflowPortrait":"detailPagePortrait"}function f(){return b()?"overflowSquare":"detailPageSquare"}function I(){return b()?"overflowBackdrop":"detailPage169"}function C(e,a,t){if("Movie"!=a.Type&&"Trailer"!=a.Type&&"Series"!=a.Type&&"Program"!=a.Type&&"Recording"!=a.Type&&"Game"!=a.Type&&"MusicAlbum"!=a.Type&&"MusicArtist"!=a.Type&&"ChannelVideoItem"!=a.Type)return void $("#similarCollapsible",e).hide();$("#similarCollapsible",e).show();var i="MusicAlbum"==a.Type||"MusicArtist"==a.Type?f():v(),r=$(window).width(),n=$(window).height(),s={userId:Dashboard.getCurrentUserId(),limit:r>800&&"detailPagePortrait"==i?4:4,fields:"PrimaryImageAspectRatio,UserData,SyncInfo"};r>=800&&n>=1e3&&(s.limit*=2),b()&&(s.limit=12),ApiClient.getSimilarItems(a.Id,s).then(function(r){if(!r.Items.length)return void $("#similarCollapsible",e).hide();var n=$("#similarCollapsible",e).show();$(".similiarHeader",n).html(Globalize.translate("HeaderIfYouLikeCheckTheseOut",a.Name));var s="";s+=b()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">',s+=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:i,showParentTitle:"MusicAlbum"==a.Type,centerText:!0,showTitle:"MusicAlbum"==a.Type||"Game"==a.Type||"MusicArtist"==a.Type,borderless:"Game"==a.Type,context:t,lazy:!0,showDetailsMenu:!0,coverImage:"MusicAlbum"==a.Type||"MusicArtist"==a.Type,overlayPlayButton:!0}),s+="</div>",$("#similarContent",e).html(s).lazyChildren().createCardMenus()})}function T(e,a,t){if("Series"!=a.Type)return void $("#seriesAirTime",e).hide();var i="";a.AirDays&&a.AirDays.length&&(i+=7==a.AirDays.length?"daily":a.AirDays.map(function(e){return e+"s"}).join(",")),a.AirTime&&(i+=" at "+a.AirTime),a.Studios.length&&(i+=t?" on "+a.Studios[0].Name:' on <a class="textlink" href="itemdetails.html?id='+a.Studios[0].Id+'">'+a.Studios[0].Name+"</a>"),i?(i=("Ended"==a.Status?"Aired ":"Airs ")+i,$("#seriesAirTime",e).show().html(i)):$("#seriesAirTime",e).hide()}function S(e,a){if(a.Tags&&a.Tags.length){var t="";t+="<p>"+Globalize.translate("HeaderTags")+"</p>";for(var i=0,r=a.Tags.length;r>i;i++)t+='<div class="itemTag">'+a.Tags[i]+"</div>";$(".itemTags",e).show().html(t)}else $(".itemTags",e).hide()}function M(e,a){return a=$.extend({},a),function(t,i,r){return a.StartIndex=t,a.Limit=i,a.Fields=r,ApiClient.getEpisodes(e,a)}}function w(e){return e=$.extend({},e),function(a,t,i){return e.StartIndex=a,e.Limit=t,e.Fields=i,ApiClient.getItems(Dashboard.getCurrentUserId(),e)}}function P(e,a,t,i){ra=null;var r="ItemCounts,AudioInfo,PrimaryImageAspectRatio,SyncInfo",n={ParentId:a.Id,Fields:r};"BoxSet"!==a.Type&&(n.SortBy="SortName");var s;"Series"==a.Type?s=ApiClient.getSeasons(a.Id,{userId:t.Id,Fields:r}):"Season"==a.Type?(s=ApiClient.getEpisodes(a.SeriesId,{seasonId:a.Id,userId:t.Id,Fields:r}),ra=M(a.SeriesId,{seasonId:a.Id,userId:t.Id})):"MusicAlbum"==a.Type&&(ra=w(n)),s=s||ApiClient.getItems(Dashboard.getCurrentUserId(),n),s.then(function(r){var n="",s=!1;"MusicAlbum"==a.Type?n=LibraryBrowser.getListViewHtml({items:r.Items,smallIcon:!0,showIndex:!0,index:"disc",showIndexNumber:!0,playFromHere:!0,defaultAction:"playallfromhere",lazy:!0}):"Series"==a.Type?(s=b(),n=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:v(),showTitle:!0,centerText:!0,lazy:!0,overlayPlayButton:!0})):"Season"==a.Type?n=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:"detailPage169",showTitle:!0,displayAsSpecial:"Season"==a.Type&&a.IndexNumber,playFromHere:!0,overlayText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:AppInfo.enableAppLayouts}):"GameSystem"==a.Type&&(n=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:"auto",showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0}));var o=e.querySelector(".childrenItemsContainer");if(o.innerHTML=n,ImageLoader.lazyChildren(o),s?o.classList.add("hiddenScrollX"):o.classList.remove("hiddenScrollX"),$(o).createCardMenus(),"BoxSet"==a.Type){var l=[{name:Globalize.translate("HeaderMovies"),type:"Movie"},{name:Globalize.translate("HeaderSeries"),type:"Series"},{name:Globalize.translate("HeaderAlbums"),type:"MusicAlbum"},{name:Globalize.translate("HeaderGames"),type:"Game"},{name:Globalize.translate("HeaderBooks"),type:"Book"}];z(e,a,l,r.Items,t,i)}}),e.querySelector("#childrenTitle").innerHTML=Globalize.translate("Season"==a.Type?"HeaderEpisodes":"Series"==a.Type?"HeaderSeasons":"MusicAlbum"==a.Type?"HeaderTracks":"GameSystem"==a.Type?"HeaderGames":"HeaderItems"),"MusicAlbum"==a.Type?$(".childrenSectionHeader",e).hide():$(".childrenSectionHeader",e).show()}function L(e,a){require("scripts/itembynamedetailpage".split(","),function(){window.ItemsByName.renderItems(e,a)})}function A(e,a){require("scripts/playlistedit".split(","),function(){PlaylistViewer.render(e,a)})}function D(e,a){require("scripts/livetvcomponents,scripts/livetvchannel,livetvcss".split(","),function(){LiveTvChannelPage.renderPrograms(e,a.Id)})}function z(e,a,t,i,r){e.querySelector(".collectionItems").innerHTML="";for(var n=0,s=t.length;s>n;n++){var o=t[n],l=i.filter(function(e){return e.Type==o.type});l.length&&B(e,a,o,l,r)}var d={name:Globalize.translate("HeaderOtherItems")},c=i.filter(function(e){return!t.filter(function(a){return a.type==e.Type}).length});c.length&&B(e,a,d,c,r),i.length||B(e,a,{name:Globalize.translate("HeaderItems")},i,r),$(".collectionItems .itemsContainer",e).createCardMenus()}function B(e,a,t,i,r,n){var s="";s+='<div class="detailSection">',s+="<h1>",s+="<span>"+t.name+"</span>",s+="</h1>",s+='<div class="detailSectionContent itemsContainer">';var o="MusicAlbum"==t.type?"detailPageSquare":"detailPagePortrait";s+=LibraryBrowser.getPosterViewHtml({items:i,shape:o,showTitle:!0,centerText:!0,context:n,lazy:!0,showDetailsMenu:!0,overlayMoreButton:!0,showAddToCollection:!1,showRemoveFromCollection:!0}),s+="</div>",s+="</div>";var l=e.querySelector(".collectionItems");$(l).append(s),ImageLoader.lazyChildren(l),$(l).off("removefromcollection").on("removefromcollection",function(t,i){G(e,a,[i],r,n)})}function G(e,a,t,i,r){Dashboard.showLoadingMsg();var n=ApiClient.getUrl("Collections/"+a.Id+"/Items",{Ids:t.join(",")});ApiClient.ajax({type:"DELETE",url:n}).then(function(){P(e,a,i,r),Dashboard.hideLoadingMsg()})}function R(e,a){$(".userDataIcons",e).html(LibraryBrowser.getUserDataIconsHtml(a,!0,"icon-button"))}function x(e,a,t){if("Movie"!=a.Type&&"Trailer"!=a.Type&&"MusicVideo"!=a.Type)return void $("#criticReviewsCollapsible",e).hide();var i={};t&&(i.limit=t),ApiClient.getCriticReviews(a.Id,i).then(function(i){i.TotalRecordCount||a.CriticRatingSummary||a.AwardSummary?($("#criticReviewsCollapsible",e).show(),k(e,i,t)):$("#criticReviewsCollapsible",e).hide()})}function k(e,a,t){for(var i="",r=a.Items,n=0,s=r.length;s>n;n++){var o=r[n];i+='<div class="paperList criticReviewPaperList">',i+='<paper-icon-item style="padding-top:.5em;padding-bottom:.5em;">',null!=o.Score||null!=o.Likes&&(i+=o.Likes?"<paper-fab mini style=\"background-color:transparent;background-image:url('css/images/fresh.png');background-repeat:no-repeat;background-position:center center;background-size: cover;\" item-icon></paper-fab>":"<paper-fab mini style=\"background-color:transparent;background-image:url('css/images/rotten.png');background-repeat:no-repeat;background-position:center center;background-size: cover;\" item-icon></paper-fab>"),i+="<paper-item-body three-line>",i+='<div style="white-space:normal;">'+o.Caption+"</div>";var l=[];if(o.ReviewerName&&l.push(o.ReviewerName),o.Publisher&&l.push(o.Publisher),i+="<div secondary>"+l.join(", ")+".",o.Date)try{var d=parseISO8601Date(o.Date,{toLocal:!0}).toLocaleDateString();i+='<span class="reviewDate">'+d+"</span>"}catch(c){}i+="</div>",o.Url&&(i+='<div secondary><a class="textlink" href="'+o.Url+'" target="_blank">'+Globalize.translate("ButtonFullReview")+"</a></div>"),i+="</paper-item-body>",i+="</paper-icon-item>",i+="</div>"}t&&a.TotalRecordCount>t&&(i+='<p style="margin: 0;"><paper-button raised class="more moreCriticReviews">'+Globalize.translate("ButtonMore")+"</paper-button></p>");var m=e.querySelector("#criticReviewsContent");m.innerHTML=i,b()?m.classList.add("hiddenScrollX"):m.classList.remove("hiddenScrollX")}function F(e,a){ApiClient.getThemeMedia(Dashboard.getCurrentUserId(),a.Id,!0).then(function(t){var i=t.ThemeSongsResult.OwnerId==a.Id?t.ThemeSongsResult.Items:[],r=t.ThemeVideosResult.OwnerId==a.Id?t.ThemeVideosResult.Items:[];H(e,i),V(e,r),e.dispatchEvent(new CustomEvent("thememediadownload",{detail:{themeMediaResult:t},bubbles:!0}))})}function H(e,a){if(a.length){$("#themeSongsCollapsible",e).show();var t=LibraryBrowser.getListViewHtml({items:a,smallIcon:!0});e.querySelector("#themeSongsContent").innerHTML=t}else $("#themeSongsCollapsible",e).hide()}function V(e,a,t){a.length?($("#themeVideosCollapsible",e).show(),$("#themeVideosContent",e).html(W(a,t)).lazyChildren()):$("#themeVideosCollapsible",e).hide()}function U(e,a,t){ApiClient.getItems(t.Id,{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",Recursive:!0,Fields:"DateCreated,SyncInfo",Albums:a.Name}).then(function(a){a.Items.length?($("#musicVideosCollapsible",e).show(),$("#musicVideosContent",e).html(W(a.Items,t)).lazyChildren()):$("#musicVideosCollapsible",e).hide()})}function N(e,a,t){ApiClient.getAdditionalVideoParts(t.Id,a.Id).then(function(a){a.Items.length?($("#additionalPartsCollapsible",e).show(),$("#additionalPartsContent",e).html(W(a.Items,t)).lazyChildren()):$("#additionalPartsCollapsible",e).hide()})}function q(e,a,t,i,r){var n="",s=a.Chapters||[],o=LibraryBrowser.getPosterViewInfo().backdropWidth;b()?(n+='<div class="hiddenScrollX itemsContainer">',i=null):n+='<div class="itemsContainer">';for(var l=0,d=s.length;d>l&&!(i&&l>=i);l++){var c=s[l],m=c.Name||"Chapter "+l,u="Full"!=a.PlayAccess||r?"":' onclick="ItemDetailPage.play('+c.StartPositionTicks+');"';n+='<a class="card '+I()+'Card" href="#play-Chapter-'+l+'"'+u+">",n+='<div class="cardBox">',n+='<div class="cardScalable">';var p;p=c.ImageTag?ApiClient.getScaledImageUrl(a.Id,{maxWidth:o,tag:c.ImageTag,type:"Chapter",index:l}):"css/images/items/list/chapter.png",n+='<div class="cardPadder"></div>',n+='<div class="cardContent">',n+='<div class="cardImage lazy" data-src="'+p+'"></div>',n+='<div class="cardFooter">',n+='<div class="cardText">'+m+"</div>",n+='<div class="cardText">',n+=Dashboard.getDisplayTime(c.StartPositionTicks),n+="</div>",n+="</div>",n+="</div>",n+="</div>",n+="</div>",n+="</a>"}n+="</div>",i&&s.length>i&&(n+='<p style="margin: 0;"><paper-button raised class="more moreScenes">'+Globalize.translate("ButtonMore")+"</paper-button></p>");var h=e.querySelector("#scenesContent");h.innerHTML=n,ImageLoader.lazyChildren(h)}function E(e,a){var t=a.MediaSources.map(function(e){return O(a,e)}).join('<div style="border-top:1px solid #444;margin: 1em 0;"></div>');a.MediaSources.length>1&&(t="<br/>"+t);var i=e.querySelector("#mediaInfoContent");i.innerHTML=t}function O(e,a){var t="";a.Name&&e.MediaSources.length>1&&(t+='<div><span class="mediaInfoAttribute">'+a.Name+"</span></div><br/>");for(var i=0,r=a.MediaStreams.length;r>i;i++){var n=a.MediaStreams[i];if("Data"!=n.Type){t+='<div class="mediaInfoStream">';var s=Globalize.translate("MediaInfoStreamType"+n.Type);t+='<div class="mediaInfoStreamType">'+s+"</div>";var o=[];n.Language&&"Video"!=n.Type&&o.push(j(Globalize.translate("MediaInfoLanguage"),n.Language)),n.Codec&&o.push(j(Globalize.translate("MediaInfoCodec"),n.Codec.toUpperCase())),n.CodecTag&&o.push(j(Globalize.translate("MediaInfoCodecTag"),n.CodecTag)),n.Profile&&o.push(j(Globalize.translate("MediaInfoProfile"),n.Profile)),n.Level&&o.push(j(Globalize.translate("MediaInfoLevel"),n.Level)),(n.Width||n.Height)&&o.push(j(Globalize.translate("MediaInfoResolution"),n.Width+"x"+n.Height)),n.AspectRatio&&"mjpeg"!=n.Codec&&o.push(j(Globalize.translate("MediaInfoAspectRatio"),n.AspectRatio)),"Video"==n.Type&&(null!=n.IsAnamorphic&&o.push(j(Globalize.translate("MediaInfoAnamorphic"),n.IsAnamorphic?"Yes":"No")),o.push(j(Globalize.translate("MediaInfoInterlaced"),n.IsInterlaced?"Yes":"No"))),(n.AverageFrameRate||n.RealFrameRate)&&o.push(j(Globalize.translate("MediaInfoFramerate"),n.AverageFrameRate||n.RealFrameRate)),n.ChannelLayout&&o.push(j(Globalize.translate("MediaInfoLayout"),n.ChannelLayout)),n.Channels&&o.push(j(Globalize.translate("MediaInfoChannels"),n.Channels+" ch")),n.BitRate&&"mjpeg"!=n.Codec&&o.push(j(Globalize.translate("MediaInfoBitrate"),parseInt(n.BitRate/1024)+" kbps")),n.SampleRate&&o.push(j(Globalize.translate("MediaInfoSampleRate"),n.SampleRate+" khz")),n.BitDepth&&o.push(j(Globalize.translate("MediaInfoBitDepth"),n.BitDepth+" bit")),n.PixelFormat&&o.push(j(Globalize.translate("MediaInfoPixelFormat"),n.PixelFormat)),n.RefFrames&&o.push(j(Globalize.translate("MediaInfoRefFrames"),n.RefFrames)),n.KeyFrames,"Video"!=n.Type&&o.push(j(Globalize.translate("MediaInfoDefault"),n.IsDefault?"Yes":"No")),"Subtitle"==n.Type&&(o.push(j(Globalize.translate("MediaInfoForced"),n.IsForced?"Yes":"No")),o.push(j(Globalize.translate("MediaInfoExternal"),n.IsExternal?"Yes":"No"))),"Video"==n.Type&&a.Timestamp&&o.push(j(Globalize.translate("MediaInfoTimestamp"),a.Timestamp)),null!=n.IsCabac&&o.push(j(Globalize.translate("CABAC"),n.IsCabac?"Yes":"No")),t+=o.join("<br/>"),t+="</div>"}}if(a.Container&&(t+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoContainer")+'</span><span class="mediaInfoAttribute">'+a.Container+"</span></div>"),a.Formats&&a.Formats.length,a.Path&&"Http"!=a.Protocol&&(t+='<div style="max-width:600px;overflow:hidden;"><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoPath")+'</span><span class="mediaInfoAttribute">'+a.Path+"</span></div>"),a.Size){var l=(a.Size/1048576).toFixed(0);t+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoSize")+'</span><span class="mediaInfoAttribute">'+l+" MB</span></div>"}return t}function j(e,a){return'<span class="mediaInfoLabel">'+e+'</span><span class="mediaInfoAttribute">'+a+"</span>"}function W(e,a,t,i){for(var r="",n=LibraryBrowser.getPosterViewInfo().backdropWidth,s=0,o=e.length;o>s&&!(t&&s>=t);s++){var l=e[s],d="card detailPage169Card",c="itemdetails.html?id="+l.Id,m="Full"==l.PlayAccess?" onclick=\"MediaController.play('"+l.Id+"'); return false;\"":"";r+='<a class="'+d+'" href="'+c+'"'+m+">",r+='<div class="cardBox">',r+='<div class="cardScalable">';var u,p=l.ImageTags||{};u=p.Primary?ApiClient.getScaledImageUrl(l.Id,{maxWidth:n,tag:p.Primary,type:"primary"}):"css/images/items/detail/video.png",r+='<div class="cardPadder"></div>',r+='<div class="cardContent">',r+='<div class="cardImage lazy" data-src="'+u+'"></div>',r+='<div class="cardFooter">',r+='<div class="cardText">'+l.Name+"</div>",r+='<div class="cardText">',r+=""!=l.RunTimeTicks?Dashboard.getDisplayTime(l.RunTimeTicks):"&nbsp;",r+="</div>",r+="</div>",r+="</div>",r+="</div>",r+="</div>",r+="</a>"}return t&&e.length>t&&(r+='<p style="margin: 0;padding-left:5px;"><paper-button raised class="more '+i+'">'+Globalize.translate("ButtonMore")+"</paper-button></p>"),r}function X(e,a,t,i){ApiClient.getSpecialFeatures(t.Id,a.Id).then(function(a){var r=e.querySelector("#specialsContent");r.innerHTML=W(a,t,i,"moreSpecials"),ImageLoader.lazyChildren(r)})}function Y(e,a,t,i,r){if(b())return void K(e,a,t,r);for(var n="",s=a.People||[],o=0,l=s.length;l>o&&!(i&&o>=i);o++){var d=s[o],c=r?"#":"itemdetails.html?id="+d.Id;n+='<a class="tileItem smallPosterTileItem" href="'+c+'">';var m,u=!0;d.PrimaryImageTag?m=ApiClient.getScaledImageUrl(d.Id,{maxWidth:100,tag:d.PrimaryImageTag,type:"primary",minScale:2}):(m="css/images/items/list/person.png",u=!1),n+=u?'<div class="tileImage lazy" data-src="'+m+'"></div>':'<div class="tileImage" style="background-image:url(\''+m+"');\"></div>",n+='<div class="tileContent">',n+="<p>"+d.Name+"</p>";var p=d.Role?Globalize.translate("ValueAsRole",d.Role):d.Type;"GuestStar"==p&&(p=Globalize.translate("ValueGuestStar")),p=p||"";var h=40;p.length>h&&(p=p.substring(0,h-3)+"..."),n+="<p>"+p+"</p>",n+="</div>",n+="</a>"}i&&s.length>i&&(n+='<p style="margin: 0;padding-left:5px;"><paper-button raised class="more morePeople">'+Globalize.translate("ButtonMore")+"</paper-button></p>");var g=e.querySelector("#castContent");g.innerHTML=n,ImageLoader.lazyChildren(g)}function K(e,a,t,i){var r="";r+=b()?'<div class="hiddenScrollX itemsContainer">':'<div class="itemsContainer">';var n=a.People||[];n=n.filter(function(e){return e.PrimaryImageTag}),n.length||(n=a.People||[]);for(var s=0,o=n.length;o>s;s++){var l=n[s],d=i?"#":"itemdetails.html?id="+l.Id;r+='<div class="card '+v()+'Card">',r+='<div class="cardBox">',r+='<div class="cardScalable">';var c,m=!0;l.PrimaryImageTag?c=ApiClient.getScaledImageUrl(l.Id,{maxWidth:100,tag:l.PrimaryImageTag,type:"primary",minScale:2}):(c="css/images/items/list/person.png",m=!1),r+='<div class="cardPadder"></div>',r+='<a class="cardContent" href="'+d+'">',r+=m?'<div class="cardImage coveredCardImage lazy" data-src="'+c+'"></div>':'<div class="cardImage coveredCardImage" style="background-image:url(\''+c+"');\"></div>",r+="</div>",r+="</a>",r+="</div>",r+='<div class="cardFooter outerCardFooter">',r+='<div class="cardText">'+l.Name+"</div>",r+='<div class="cardText">';var u=l.Role?Globalize.translate("ValueAsRole",l.Role):l.Type;"GuestStar"==u&&(u=Globalize.translate("ValueGuestStar")),u=u||"";var p=40;u.length>p&&(u=u.substring(0,p-3)+"..."),r+=u,r+="</div>",r+="</div>",r+="</div>"}r+="</div>";var h=e.querySelector("#castContent");h.innerHTML=r,ImageLoader.lazyChildren(h)}function _(e){MediaController.play({items:[ia],startPositionTicks:e})}function J(e){var a=getParameterByName("id");require(["confirm"],function(i){i("Are you sure you wish to split the media sources into separate items?","Split Media Apart").then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Videos/"+a+"/AlternateSources")}).then(function(){Dashboard.hideLoadingMsg(),t(e)})})})}function Q(){ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),ia.Id).then(function(e){MediaController.play({items:e})})}function Z(e,a){ia&&ia.Id==a&&("Recording"==ia.Type?LibraryBrowser.showTab("livetv.html",3):Dashboard.navigate("index.html"))}function ea(e){if("Program"==ia.Type)return void ApiClient.getLiveTvChannel(ia.ChannelId,Dashboard.getCurrentUserId()).then(function(e){LibraryBrowser.showPlayMenu(null,e.Id,e.Type,!1,e.MediaType,(e.UserData||{}).PlaybackPositionTicks)});var a=ia.UserData||{},t=ia.MediaType;("MusicArtist"==ia.Type||"MusicAlbum"==ia.Type)&&(t="Audio"),LibraryBrowser.showPlayMenu(e,ia.Id,ia.Type,ia.IsFolder,t,a.PlaybackPositionTicks)}function aa(e,a){require(["confirm"],function(i){i(Globalize.translate("MessageConfirmRecordingCancellation"),Globalize.translate("HeaderConfirmRecordingCancellation")).then(function(){Dashboard.showLoadingMsg(),ApiClient.cancelLiveTvTimer(a).then(function(){require(["toast"],function(e){e(Globalize.translate("MessageRecordingCancelled"))}),t(e)})})})}function ta(){var e=this;e.play=_,e.setInitialCollapsibleState=m,e.renderDetails=u,e.renderCriticReviews=x,e.renderCast=Y,e.renderScenes=q,e.renderMediaSources=E}var ia;$.fn.lazyChildren=function(){for(var e=0,a=this.length;a>e;e++)ImageLoader.lazyChildren(this[e]);return this};var ra=null;pageIdOn("pageinit","itemDetailPage",function(){var e=this;$(".btnPlay",e).on("click",function(){ea(this)}),$(".btnPlayTrailer",e).on("click",function(){Q(e)}),$(".btnSplitVersions",e).on("click",function(){J(e)}),$(".btnSync",e).on("click",function(){require(["syncDialog"],function(e){e.showMenu({items:[ia]})})}),$(".btnRecord,.btnFloatingRecord",e).on("click",function(){var a=getParameterByName("id");require(["components/recordingcreator/recordingcreator"],function(i){i.show(a).then(function(){t(e)})})}),$(".btnCancelRecording",e).on("click",function(){aa(e,ia.TimerId)}),$(".btnMoreCommands",e).on("click",function(){var e=this;Dashboard.getCurrentUser().then(function(a){LibraryBrowser.showMoreCommands(e,ia.Id,LibraryBrowser.getMoreCommands(ia,a))})}),$(".childrenItemsContainer",e).on("playallfromhere",function(e,a){LibraryBrowser.playAllFromHere(ra,a)}).on("queueallfromhere",function(e,a){LibraryBrowser.queueAllFromHere(ra,a)}),$(e).on("click",".moreScenes",function(){Dashboard.getCurrentUser().then(function(a){q(e,ia,a)})}).on("click",".morePeople",function(){Y(e,ia,l(ia))}).on("click",".moreSpecials",function(){Dashboard.getCurrentUser().then(function(a){X(e,ia,a)})}).on("click",".moreCriticReviews",function(){x(e,ia)})}),pageIdOn("pagebeforeshow","itemDetailPage",function(){var e=this;t(e),Events.on(ApiClient,"websocketmessage",s),Events.on(LibraryBrowser,"itemdeleting",Z)}),pageIdOn("pagebeforehide","itemDetailPage",function(){Events.off(LibraryBrowser,"itemdeleting",Z),ia=null;
Events.off(ApiClient,"websocketmessage",s),LibraryMenu.setTransparentMenu(!1)}),window.ItemDetailPage=new ta});