define(["layoutManager","cardBuilder","datetime","mediaInfo","backdrop","listView","itemContextMenu","itemHelper","userdataButtons","dom","indicators","apphost","scrollStyles","emby-itemscontainer","emby-checkbox"],function(e,t,a,i,r,s,n,l,o,d,c,u){function m(e){var t=e.id;if(t)return ApiClient.getItem(Dashboard.getCurrentUserId(),t);var a=e.genre;if(a)return ApiClient.getGenre(a,Dashboard.getCurrentUserId());if(a=e.musicgenre)return ApiClient.getMusicGenre(a,Dashboard.getCurrentUserId());if(a=e.gamegenre)return ApiClient.getGameGenre(a,Dashboard.getCurrentUserId());if(a=e.musicartist)return ApiClient.getArtist(a,Dashboard.getCurrentUserId());throw new Error("Invalid request")}function p(e,t){Dashboard.showLoadingMsg(),m(t).then(function(a){g(e,t,a)})}function h(e,t,a){var i,r,s=e.querySelectorAll("."+t);for(i=0,r=s.length;r>i;i++)a?s[i].classList.remove("hide"):s[i].classList.add("hide")}function y(e,t){var a={item:e,open:!1,play:!1,queue:!1,playAllFromHere:!1,queueAllFromHere:!1,positionTo:t};return u.supports("sync")?a.syncLocal=!1:a.sync=!1,a}function v(e,t){var a,i,r=e.querySelectorAll(".chkOffline");for(a=0,i=r.length;i>a;a++)r[a].checked=null!=t.SyncPercent}function g(t,i,s){St=s;var o=i.context;LibraryBrowser.renderName(s,t.querySelector(".itemName"),!1,o),LibraryBrowser.renderParentName(s,t.querySelector(".parentName"),o),LibraryMenu.setTitle(s.SeriesName||s.Name),Dashboard.getCurrentUser().then(function(i){window.scrollTo(0,0),b(t,s,i),C(t,s,o,i),A(t,s,o);var d=!1;if("MusicArtist"!=s.Type&&"MusicAlbum"!=s.Type&&"Playlist"!=s.Type&&"BoxSet"!=s.Type&&"Audio"!=s.MediaType&&e.mobile)d=LibraryBrowser.renderDetailPageBackdrop(t,s),r.clear();else{var c=t.querySelector("#itemBackdrop");c.classList.add("noBackdrop"),c.style.backgroundImage="none",r.setBackdrops([s])}var m=d&&t.classList.contains("noSecondaryNavPage");LibraryMenu.setTransparentMenu(m);var p=!1;if("Program"==s.Type){var g=new Date;g>=a.parseISO8601Date(s.StartDate,!0)&&g<a.parseISO8601Date(s.EndDate,!0)?(h(t,"btnPlay",!0),p=!0):h(t,"btnPlay")}else MediaController.canPlay(s)?(h(t,"btnPlay",!0),p=!0):h(t,"btnPlay");s.LocalTrailerCount&&"Full"==s.PlayAccess?h(t,"btnPlayTrailer",!0):h(t,"btnPlayTrailer"),l.canSync(i,s)?(u.supports("sync")?(h(t,"syncLocalContainer",!0),h(t,"btnSync")):(h(t,"syncLocalContainer"),h(t,"btnSync",!0)),v(t,s)):(h(t,"btnSync"),h(t,"syncLocalContainer")),"Program"==s.Type&&s.TimerId?h(t,"btnCancelRecording",!0):h(t,"btnCancelRecording"),"Program"!=s.Type||s.TimerId||s.SeriesTimerId?(h(t,"btnRecord"),h(t,"btnFloatingRecord")):p?(h(t,"btnRecord",!0),h(t,"btnFloatingRecord")):(h(t,"btnRecord"),h(t,"btnFloatingRecord",!0));for(var f=t.querySelectorAll(".btnPlayExternalTrailer"),S=0,I=f.length;I>S;S++)!s.LocalTrailerCount&&s.RemoteTrailers.length&&"Full"==s.PlayAccess?(f[S].classList.remove("hide"),f[S].href=s.RemoteTrailers[0].Url):(f[S].classList.add("hide"),f[S].href="#");var T=(s.MediaSources||[]).filter(function(e){return"Grouping"==e.Type});i.Policy.IsAdministrator&&T.length?t.querySelector(".splitVersionContainer").classList.remove("hide"):t.querySelector(".splitVersionContainer").classList.add("hide"),n.getCommands(y(s)).then(function(e){e.length?h(t,"btnMoreCommands",!0):h(t,"btnMoreCommands")}),i.Policy.IsAdministrator?t.querySelector(".chapterSettingsButton").classList.remove("hide"):t.querySelector(".chapterSettingsButton").classList.add("hide");var L=t.querySelector("#itemBirthday");if("Person"==s.Type&&s.PremiereDate)try{var M=a.parseISO8601Date(s.PremiereDate,!0).toDateString();L.classList.remove("hide"),L.innerHTML=Globalize.translate("BirthDateValue").replace("{0}",M)}catch(q){L.classList.add("hide")}else L.classList.add("hide");var P=t.querySelector("#itemBirthday");if("Person"==s.Type&&s.EndDate)try{var w=a.parseISO8601Date(s.EndDate,!0).toDateString();P.classList.remove("hide"),P.innerHTML=Globalize.translate("DeathDateValue").replace("{0}",w)}catch(q){P.classList.add("hide")}var z=t.querySelector("#itemBirthLocation");if("Person"==s.Type&&s.ProductionLocations&&s.ProductionLocations.length){var D='<a class="textlink" target="_blank" href="https://maps.google.com/maps?q='+s.ProductionLocations[0]+'">'+s.ProductionLocations[0]+"</a>";z.classList.remove("hide"),z.innerHTML=Globalize.translate("BirthPlaceValue").replace("{0}",D)}else z.classList.add("hide")});var d=!1;if("Virtual"==s.LocationType&&"Episode"==s.Type)try{s.PremiereDate&&(new Date).getTime()>=a.parseISO8601Date(s.PremiereDate,!0).getTime()&&(d=!0)}catch(c){}T(t,s),t.dispatchEvent(new CustomEvent("displayingitem",{detail:{item:s,context:o},bubbles:!0})),Dashboard.hideLoadingMsg()}function f(e,t){var a=[];if(t.HomePageUrl&&a.push('<a class="textlink" href="'+t.HomePageUrl+'" target="_blank">'+Globalize.translate("ButtonWebsite")+"</a>"),t.ExternalUrls)for(var i=0,r=t.ExternalUrls.length;r>i;i++){var s=t.ExternalUrls[i];a.push('<a class="textlink" href="'+s.Url+'" target="_blank">'+s.Name+"</a>")}if(a.length){var n=a.join("&nbsp;&nbsp;/&nbsp;&nbsp;");n=Globalize.translate("ValueLinks",n),e.innerHTML=n,e.classList.remove("hide")}else e.classList.add("hide")}function b(e,t,a){LibraryBrowser.renderDetailImage(e.querySelector(".detailImageContainer"),t,a.Policy.IsAdministrator&&"Photo"!=t.MediaType)}function S(e,t){var a=e.querySelector(".detailImageProgressContainer");a.innerHTML=c.getProgressBarHtml(t)}function I(e,t){S(e.querySelector(".detailImageContainer"),t)}function T(e,t){e.querySelector("#peopleHeader").innerHTML=Globalize.translate("Audio"==t.MediaType||"MusicAlbum"==t.Type||"Book"==t.MediaType||"Photo"==t.MediaType?"HeaderPeople":"HeaderCastAndCrew")}function L(e,a,i){var r=e.querySelector(".nextUpSection");return"Series"!=a.Type?void r.classList.add("hide"):void ApiClient.getNextUpEpisodes({SeriesId:a.Id,UserId:i.Id}).then(function(e){e.Items.length?r.classList.remove("hide"):r.classList.add("hide");var i=t.getCardsHtml({items:e.Items,shape:x(!1),showTitle:!0,displayAsSpecial:"Season"==a.Type&&a.IndexNumber,overlayText:!0,lazy:!0,overlayPlayButton:!0}),s=r.querySelector(".nextUpItems");s.innerHTML=i,ImageLoader.lazyChildren(s)})}function C(e,t,a,i){e.querySelector(".collectionItems").innerHTML="","TvChannel"==t.Type?(e.querySelector("#childrenCollapsible").classList.remove("hide"),j(e,t,i)):"Playlist"==t.Type?(e.querySelector("#childrenCollapsible").classList.remove("hide"),O(e,t,i)):"Studio"==t.Type||"Person"==t.Type||"Genre"==t.Type||"MusicGenre"==t.Type||"GameGenre"==t.Type||"MusicArtist"==t.Type?(e.querySelector("#childrenCollapsible").classList.remove("hide"),N(e,t,i)):t.IsFolder?("BoxSet"==t.Type?e.querySelector("#childrenCollapsible").classList.add("hide"):e.querySelector("#childrenCollapsible").classList.remove("hide"),V(e,t)):e.querySelector("#childrenCollapsible").classList.add("hide"),"Series"==t.Type?L(e,t,i):e.querySelector(".nextUpSection").classList.add("hide"),t.MediaSources&&t.MediaSources.length&&st(e,t);var r=t.Chapters||[];r.length?(e.querySelector("#scenesCollapsible").classList.remove("hide"),rt(e,t,i,3)):e.querySelector("#scenesCollapsible").classList.add("hide"),t.SpecialFeatureCount&&0!=t.SpecialFeatureCount&&"Series"!=t.Type?(e.querySelector("#specialsCollapsible").classList.remove("hide"),dt(e,t,i,6)):e.querySelector("#specialsCollapsible").classList.add("hide"),t.People&&t.People.length?(e.querySelector("#castCollapsible").classList.remove("hide"),ct(e,t,a,D()?null:12)):e.querySelector("#castCollapsible").classList.add("hide"),t.PartCount&&t.PartCount>1?(e.querySelector("#additionalPartsCollapsible").classList.remove("hide"),it(e,t,i)):e.querySelector("#additionalPartsCollapsible").classList.add("hide"),e.querySelector("#themeSongsCollapsible").classList.add("hide"),e.querySelector("#themeVideosCollapsible").classList.add("hide"),"MusicAlbum"==t.Type?at(e,t,i):e.querySelector("#musicVideosCollapsible").classList.add("hide"),$(e,t,i),D()?Q(e,t):Q(e,t,1)}function M(e,t){for(var a=0,i=e.length;i>a;a++){var r=e[a],s=t.Overview||"";if(s){r.innerHTML=s,r.classList.remove("empty");for(var n=r.querySelectorAll("a"),l=0,o=n.length;o>l;l++)n[l].setAttribute("target","_blank")}else r.innerHTML="",r.classList.add("empty")}}function A(e,t,a,r){R(e,t,a),k(e,t),r||z(e,t,a);var s=e.querySelector(".tagline");t.Taglines&&t.Taglines.length?(s.classList.remove("hide"),s.innerHTML=t.Taglines[0]):s.classList.add("hide");var n=e.querySelector(".topOverview"),l=e.querySelector(".bottomOverview"),o=screen.availHeight<800||screen.availWidth<600;"MusicAlbum"==t.Type||"MusicArtist"==t.Type||"Season"==t.Type&&o?(M([l],t),n.classList.add("hide"),l.classList.remove("hide")):(M([n],t),n.classList.remove("hide"),l.classList.add("hide")),Y(e.querySelector("#awardSummary"),t);var d,c,u=e.querySelectorAll(".itemMiscInfo");for(d=0,c=u.length;c>d;d++)i.fillPrimaryMediaInfo(u[d],t,{interactive:!0});var m=e.querySelectorAll(".itemGenres");for(d=0,c=m.length;c>d;d++)X(m[d],t,null,r);W(e.querySelector(".itemStudios"),t,r),J(e,t),f(e.querySelector(".itemExternalLinks"),t),e.querySelector(".criticRatingScore").innerHTML=(t.CriticRating||"0")+"%",t.CriticRatingSummary?(e.querySelector("#criticRatingSummary").classList.remove("hide"),e.querySelector(".criticRatingSummaryText").innerHTML=t.CriticRatingSummary):e.querySelector("#criticRatingSummary").classList.add("hide"),F(e,t),B(e,t,r);var p=e.querySelector("#players");t.Players?(p.classList.remove("hide"),p.innerHTML=t.Players+" Player"):p.classList.add("hide");var h=e.querySelectorAll(".artist");for(d=0,c=h.length;c>d;d++)t.ArtistItems&&t.ArtistItems.length&&"MusicAlbum"!=t.Type?(h[d].classList.remove("hide"),h[d].innerHTML=w(t.ArtistItems,a)):h[d].classList.add("hide");t.MediaSources&&t.MediaSources.length&&t.Path?e.querySelector(".audioVideoMediaInfo").classList.remove("hide"):e.querySelector(".audioVideoMediaInfo").classList.add("hide"),"Photo"==t.MediaType?(e.querySelector(".photoInfo").classList.remove("hide"),q(e,t)):e.querySelector(".photoInfo").classList.add("hide"),P(e,t)}function q(e,t){var a="",i=[];if(t.CameraMake&&i.push(lt(Globalize.translate("MediaInfoCameraMake"),t.CameraMake)),t.CameraModel&&i.push(lt(Globalize.translate("MediaInfoCameraModel"),t.CameraModel)),t.Altitude&&i.push(lt(Globalize.translate("MediaInfoAltitude"),t.Altitude.toFixed(1))),t.Aperture&&i.push(lt(Globalize.translate("MediaInfoAperture"),"F"+t.Aperture.toFixed(1))),t.ExposureTime){var r=1/t.ExposureTime;i.push(lt(Globalize.translate("MediaInfoExposureTime"),"1/"+r+" s"))}t.FocalLength&&i.push(lt(Globalize.translate("MediaInfoFocalLength"),t.FocalLength.toFixed(1)+" mm")),t.ImageOrientation,t.IsoSpeedRating&&i.push(lt(Globalize.translate("MediaInfoIsoSpeedRating"),t.IsoSpeedRating)),t.Latitude&&i.push(lt(Globalize.translate("MediaInfoLatitude"),t.Latitude.toFixed(1))),t.Longitude&&i.push(lt(Globalize.translate("MediaInfoLongitude"),t.Longitude.toFixed(1))),t.ShutterSpeed&&i.push(lt(Globalize.translate("MediaInfoShutterSpeed"),t.ShutterSpeed)),t.Software&&i.push(lt(Globalize.translate("MediaInfoSoftware"),t.Software)),a+=i.join("<br/>"),e.querySelector(".photoInfoContent").innerHTML=a}function P(e){var t=e.querySelector(".tabDetails"),a=t.textContent||t.innerText||"";a.trim()?e.querySelector(".detailsSection").classList.remove("hide"):e.querySelector(".detailsSection").classList.add("hide")}function w(e){for(var t=[],a=0,i=e.length;i>a;a++){var r=e[a];t.push('<a class="textlink" href="itemdetails.html?id='+r.Id+'">'+r.Name+"</a>")}return t=t.join(" / "),1==e.length?Globalize.translate("ValueArtist",t):e.length>1?Globalize.translate("ValueArtists",t):t}function z(e,t,a){var i=e.querySelector(".lnkPreviousItem"),r=e.querySelector(".lnkNextItem");if("Episode"!=t.Type&&"Season"!=t.Type&&"Audio"!=t.Type&&"Photo"!=t.Type)return r.classList.add("hide"),void i.classList.add("hide");var s;s="Season"==t.Type?ApiClient.getSeasons(t.SeriesId,{userId:Dashboard.getCurrentUserId(),AdjacentTo:t.Id}):"Episode"==t.Type&&t.SeasonId?ApiClient.getEpisodes(t.SeriesId,{seasonId:t.SeasonId,userId:Dashboard.getCurrentUserId(),AdjacentTo:t.Id}):ApiClient.getItems(Dashboard.getCurrentUserId(),{AdjacentTo:t.Id,ParentId:t.ParentId,SortBy:"SortName"}),a=a||"",s.then(function(e){for(var s=!1,n=0,l=e.Items.length;l>n;n++){var o=e.Items[n];o.Id==t.Id?s=!0:s?(r.classList.remove("hide"),r.href="itemdetails.html?id="+o.Id+"&context="+a):(i.classList.remove("hide"),i.href="itemdetails.html?id="+o.Id+"&context="+a)}})}function D(){return browserInfo.mobile&&AppInfo.enableAppLayouts&&screen.availWidth<=1e3}function G(e){return null==e&&(e=D()),e?"overflowPortrait":"portrait"}function H(e){return null==e&&(e=D()),e?"overflowSquare":"square"}function x(e){return null==e&&(e=D()),e?"overflowBackdrop":"backdrop"}function k(e,a){var i=e.querySelector("#moreFromSection");if(i)return"MusicAlbum"==a.Type&&a.AlbumArtists&&a.AlbumArtists.length?void ApiClient.getItems(Dashboard.getCurrentUserId(),{IncludeItemTypes:"MusicAlbum",ArtistIds:a.AlbumArtists[0].Id,Recursive:!0,ExcludeItemIds:a.Id}).then(function(r){if(!r.Items.length)return void i.classList.add("hide");i.classList.remove("hide"),i.querySelector(".moreFromHeader").innerHTML=Globalize.translate("MoreFromValue",a.AlbumArtists[0].Name);var s="";s+=D()?'<div is="emby-itemscontainer" class="hiddenScrollX itemsContainer">':'<div is="emby-itemscontainer" class="itemsContainer vertical-wrap">';var n="MusicAlbum"==a.Type||"MusicArtist"==a.Type?H():G();s+=t.getCardsHtml({items:r.Items,shape:n,showParentTitle:"MusicAlbum"==a.Type,centerText:!0,showTitle:"MusicAlbum"==a.Type||"Game"==a.Type||"MusicArtist"==a.Type,coverImage:"MusicAlbum"==a.Type||"MusicArtist"==a.Type,overlayPlayButton:!0}),s+="</div>";var l=e.querySelector("#moreFromItems");l.innerHTML=s,ImageLoader.lazyChildren(l)}):void i.classList.add("hide")}function R(e,a,i){var r=e.querySelector("#similarCollapsible");if(r){if("Movie"!=a.Type&&"Trailer"!=a.Type&&"Series"!=a.Type&&"Program"!=a.Type&&"Recording"!=a.Type&&"Game"!=a.Type&&"MusicAlbum"!=a.Type&&"MusicArtist"!=a.Type&&"ChannelVideoItem"!=a.Type)return void r.classList.add("hide");r.classList.remove("hide");var s="MusicAlbum"==a.Type||"MusicArtist"==a.Type?H():G(),n={userId:Dashboard.getCurrentUserId(),limit:8,fields:"PrimaryImageAspectRatio,UserData,CanDelete"};"MusicAlbum"==a.Type&&a.AlbumArtists&&a.AlbumArtists.length&&(n.ExcludeArtistIds=a.AlbumArtists[0].Id),D()&&(n.limit=12),ApiClient.getSimilarItems(a.Id,n).then(function(n){if(!n.Items.length)return void r.classList.add("hide");r.classList.remove("hide"),r.querySelector(".similiarHeader").innerHTML=Globalize.translate("HeaderIfYouLikeCheckTheseOut",a.Name);var l="";l+=D()?'<div is="emby-itemscontainer" class="hiddenScrollX itemsContainer">':'<div is="emby-itemscontainer" class="itemsContainer vertical-wrap">',l+=t.getCardsHtml({items:n.Items,shape:s,showParentTitle:"MusicAlbum"==a.Type,centerText:!0,showTitle:"MusicAlbum"==a.Type||"Game"==a.Type||"MusicArtist"==a.Type,context:i,lazy:!0,showDetailsMenu:!0,coverImage:"MusicAlbum"==a.Type||"MusicArtist"==a.Type,overlayPlayButton:!0}),l+="</div>";var o=e.querySelector("#similarContent");o.innerHTML=l,ImageLoader.lazyChildren(o)})}}function B(e,t,a){var i=e.querySelector("#seriesAirTime");if("Series"!=t.Type)return void i.classList.add("hide");var r="";t.AirDays&&t.AirDays.length&&(r+=7==t.AirDays.length?"daily":t.AirDays.map(function(e){return e+"s"}).join(",")),t.AirTime&&(r+=" at "+t.AirTime),t.Studios.length&&(r+=a?" on "+t.Studios[0].Name:' on <a class="textlink" href="itemdetails.html?id='+t.Studios[0].Id+'">'+t.Studios[0].Name+"</a>"),r?(r=("Ended"==t.Status?"Aired ":"Airs ")+r,i.innerHTML=r,i.classList.remove("hide")):i.classList.add("hide")}function F(e,t){var a=e.querySelector(".itemTags");if(t.Tags&&t.Tags.length){var i="";i+="<p>"+Globalize.translate("HeaderTags")+"</p>";for(var r=0,s=t.Tags.length;s>r;r++)i+='<div class="itemTag">'+t.Tags[r]+"</div>";a.innerHTML=i,a.classList.remove("hide")}else a.classList.add("hide")}function E(e,t){return t=Object.assign({},t),function(a,i,r){return t.StartIndex=a,t.Limit=i,t.Fields=r,ApiClient.getEpisodes(e,t)}}function U(e){return e=Object.assign({},e),function(t,a,i){return e.StartIndex=t,e.Limit=a,e.Fields=i,ApiClient.getItems(Dashboard.getCurrentUserId(),e)}}function V(e,a){It=null;var i="ItemCounts,AudioInfo,PrimaryImageAspectRatio,BasicSyncInfo,CanDelete",r={ParentId:a.Id,Fields:i};"BoxSet"!==a.Type&&(r.SortBy="SortName");var n,l=Dashboard.getCurrentUserId();"Series"==a.Type?n=ApiClient.getSeasons(a.Id,{userId:l,Fields:i}):"Season"==a.Type?(n=ApiClient.getEpisodes(a.SeriesId,{seasonId:a.Id,userId:l,Fields:i}),It=E(a.SeriesId,{seasonId:a.Id,userId:l,Fields:i})):"MusicAlbum"==a.Type&&(It=U(r)),n=n||ApiClient.getItems(Dashboard.getCurrentUserId(),r),n.then(function(i){var r="",n=!1,l=!1;"MusicAlbum"==a.Type?(r=s.getListViewHtml({items:i.Items,smallIcon:!0,showIndex:!0,index:"disc",showIndexNumber:!0,playFromHere:!0,action:"playallfromhere",lazy:!0}),l=!0):"Series"==a.Type?(n=D(),r=t.getCardsHtml({items:i.Items,shape:G(),showTitle:!0,centerText:!0,lazy:!0,overlayPlayButton:!0,allowBottomPadding:!n})):"Season"==a.Type?r=t.getCardsHtml({items:i.Items,shape:x(!1),showTitle:!0,displayAsSpecial:"Season"==a.Type&&a.IndexNumber,playFromHere:!0,overlayText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:AppInfo.enableAppLayouts}):"GameSystem"==a.Type&&(r=t.getCardsHtml({items:i.Items,shape:"auto",showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0}));var o=e.querySelector(".childrenItemsContainer");if(n?(o.classList.add("hiddenScrollX"),o.classList.remove("vertical-wrap"),o.classList.remove("vertical-list")):(o.classList.remove("hiddenScrollX"),l?(o.classList.add("vertical-list"),o.classList.remove("vertical-wrap")):(o.classList.add("vertical-wrap"),o.classList.remove("vertical-list"))),o.innerHTML=r,ImageLoader.lazyChildren(o),"BoxSet"==a.Type){var d=[{name:Globalize.translate("HeaderMovies"),type:"Movie"},{name:Globalize.translate("HeaderSeries"),type:"Series"},{name:Globalize.translate("HeaderAlbums"),type:"MusicAlbum"},{name:Globalize.translate("HeaderGames"),type:"Game"},{name:Globalize.translate("HeaderBooks"),type:"Book"}];_(e,a,d,i.Items)}}),e.querySelector("#childrenTitle").innerHTML=Globalize.translate("Season"==a.Type?"HeaderEpisodes":"Series"==a.Type?"HeaderSeasons":"MusicAlbum"==a.Type?"HeaderTracks":"GameSystem"==a.Type?"HeaderGames":"HeaderItems"),"MusicAlbum"==a.Type?e.querySelector(".childrenSectionHeader",e).classList.add("hide"):e.querySelector(".childrenSectionHeader",e).classList.remove("hide")}function N(e,t){require("scripts/itembynamedetailpage".split(","),function(){window.ItemsByName.renderItems(e,t)})}function O(e,t){require("scripts/playlistedit".split(","),function(){PlaylistViewer.render(e,t)})}function j(e,t){require("scripts/livetvcomponents,scripts/livetvchannel,livetvcss".split(","),function(){LiveTvChannelPage.renderPrograms(e,t.Id)})}function W(e,t,a){if(t.Studios&&t.Studios.length&&"Series"!=t.Type){for(var i="",r=0,s=t.Studios.length;s>r;r++)r>0&&(i+="&nbsp;&nbsp;/&nbsp;&nbsp;"),i+=a?t.Studios[r].Name:'<a class="textlink" href="itemdetails.html?id='+t.Studios[r].Id+'">'+t.Studios[r].Name+"</a>";var n=t.Studios.length>1?"ValueStudios":"ValueStudio";i=Globalize.translate(n,i),e.innerHTML=i,e.classList.remove("hide")}else e.classList.add("hide")}function X(e,t,a,i){for(var r="",s=t.Genres||[],n=0,l=s.length;l>n&&!(a&&n>=a);n++){n>0&&(r+="<span>&nbsp;&nbsp;/&nbsp;&nbsp;</span>");var o="Audio"==t.Type||"MusicArtist"==t.Type||"MusicAlbum"==t.Type?"musicgenre":"genre";"Game"==t.MediaType&&(o="gamegenre"),r+=i?s[n]:'<a class="textlink" href="itemdetails.html?'+o+"="+ApiClient.encodeName(s[n])+'">'+s[n]+"</a>"}e.innerHTML=r}function Y(e,t){t.AwardSummary?(e.classList.remove("hide"),e.innerHTML=Globalize.translate("ValueAwards",t.AwardSummary)):e.classList.add("hide")}function _(e,t,a,i){e.querySelector(".collectionItems").innerHTML="";var r,s;for(r=0,s=a.length;s>r;r++){var n=a[r],l=i.filter(function(e){return e.Type==n.type});l.length&&K(e,t,n,l)}var o={name:Globalize.translate("HeaderOtherItems")},d=i.filter(function(e){return!a.filter(function(t){return t.type==e.Type}).length});d.length&&K(e,t,o,d),i.length||K(e,t,{name:Globalize.translate("HeaderItems")},i)}function K(e,a,i,r){var s="";s+='<div class="detailSection">',s+='<div style="display:flex;align-items:center;">',s+="<h1>",s+="<span>"+i.name+"</span>",s+="</h1>",s+='<button class="btnAddToCollection autoSize" type="button" is="paper-icon-button-light" style="margin-left:1em;"><i class="md-icon" icon="add">add</i></button>',s+="</div>",s+='<div is="emby-itemscontainer" class="detailSectionContent itemsContainer vertical-wrap">';var n="MusicAlbum"==i.type?H(!1):G(!1);s+=t.getCardsHtml({items:r,shape:n,showTitle:!0,centerText:!0,lazy:!0,showDetailsMenu:!0,overlayMoreButton:!0,showAddToCollection:!1,showRemoveFromCollection:!0,collectionId:a.Id}),s+="</div>",s+="</div>";var l=e.querySelector(".collectionItems");l.insertAdjacentHTML("beforeend",s),ImageLoader.lazyChildren(l),l.querySelector(".btnAddToCollection").addEventListener("click",function(){require(["alert"],function(e){e({text:Globalize.translate("AddItemToCollectionHelp"),html:Globalize.translate("AddItemToCollectionHelp")+'<br/><br/><a target="_blank" href="https://github.com/MediaBrowser/Wiki/wiki/Collections">'+Globalize.translate("ButtonLearnMore")+"</a>"})})})}function J(e,t){for(var a=e.querySelectorAll(".userDataIcons"),i=o.getIconsHtml({item:t,style:"fab-mini"}),r=0,s=a.length;s>r;r++)a[r].innerHTML=i}function Q(e,t,a){if("Movie"!=t.Type&&"Trailer"!=t.Type&&"MusicVideo"!=t.Type)return void e.querySelector("#criticReviewsCollapsible").classList.add("hide");var i={};a&&(i.limit=a),ApiClient.getCriticReviews(t.Id,i).then(function(i){i.TotalRecordCount||t.CriticRatingSummary||t.AwardSummary?(e.querySelector("#criticReviewsCollapsible").classList.remove("hide"),Z(e,i,a)):e.querySelector("#criticReviewsCollapsible").classList.add("hide")})}function Z(e,t,i){for(var r="",s=t.Items,n=0,l=s.length;l>n;n++){var o=s[n];r+='<div class="paperList criticReviewPaperList">',r+='<div class="listItem">',null!=o.Score||null!=o.Likes&&(r+=o.Likes?"<div style=\"background-color:transparent;background-image:url('css/images/fresh.png');background-repeat:no-repeat;background-position:center center;background-size: cover;width:40px;height:40px;\"></div>":"<div style=\"background-color:transparent;background-image:url('css/images/rotten.png');background-repeat:no-repeat;background-position:center center;background-size: cover;width:40px;height:40px;\"></div>"),r+='<div class="listItemBody two-line">',r+='<div style="white-space:normal;">'+o.Caption+"</div>";var d=[];if(o.ReviewerName&&d.push(o.ReviewerName),o.Publisher&&d.push(o.Publisher),r+='<div class="secondary">'+d.join(", ")+".",o.Date)try{var c=a.parseISO8601Date(o.Date,!0).toLocaleDateString();r+='<span class="reviewDate">'+c+"</span>"}catch(u){}r+="</div>",o.Url&&(r+='<div class="secondary"><a class="textlink" href="'+o.Url+'" target="_blank">'+Globalize.translate("ButtonFullReview")+"</a></div>"),r+="</div>",r+="</div>",r+="</div>"}i&&t.TotalRecordCount>i&&(r+='<p style="margin: 0;"><button is="emby-button" type="button" class="raised more moreCriticReviews">'+Globalize.translate("ButtonMore")+"</button></p>");var m=e.querySelector("#criticReviewsContent");m.innerHTML=r,D()?m.classList.add("hiddenScrollX"):m.classList.remove("hiddenScrollX")}function $(e,t){ApiClient.getThemeMedia(Dashboard.getCurrentUserId(),t.Id,!0).then(function(a){var i=a.ThemeSongsResult.OwnerId==t.Id?a.ThemeSongsResult.Items:[],r=a.ThemeVideosResult.OwnerId==t.Id?a.ThemeVideosResult.Items:[];et(e,i),tt(e,r)})}function et(e,t){if(t.length){e.querySelector("#themeSongsCollapsible").classList.remove("hide");var a=s.getListViewHtml({items:t});e.querySelector("#themeSongsContent").innerHTML=a}else e.querySelector("#themeSongsCollapsible").classList.add("hide")}function tt(e,t,a){if(t.length){e.querySelector("#themeVideosCollapsible").classList.remove("hide");var i=e.querySelector("#themeVideosContent");i.innerHTML=ot(t,a),ImageLoader.lazyChildren(i)}else e.querySelector("#themeVideosCollapsible").classList.add("hide")}function at(e,t,a){ApiClient.getItems(a.Id,{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",Recursive:!0,Fields:"DateCreated,CanDelete",Albums:t.Name}).then(function(t){if(t.Items.length){e.querySelector("#musicVideosCollapsible").classList.remove("hide");var i=e.querySelector(".musicVideosContent");i.innerHTML=ot(t.Items,a),ImageLoader.lazyChildren(i)}else e.querySelector("#musicVideosCollapsible").classList.add("hide")})}function it(e,t,a){ApiClient.getAdditionalVideoParts(a.Id,t.Id).then(function(t){if(t.Items.length){e.querySelector("#additionalPartsCollapsible").classList.remove("hide");var i=e.querySelector("#additionalPartsContent");i.innerHTML=ot(t.Items,a),ImageLoader.lazyChildren(i)}else e.querySelector("#additionalPartsCollapsible").classList.add("hide")})}function rt(e,t,a,i){var r=t.Chapters||[],s=e.querySelector("#scenesContent");D()?(s.classList.add("smoothScrollX"),i=null):s.classList.add("vertical-wrap");var n=i&&r.length>i;n&&(r=r.slice(0),r.length=Math.min(i,r.length)),require(["chaptercardbuilder"],function(e){e.buildChapterCards(t,r,{itemsContainer:s,coverImage:!0,width:400,backdropShape:x(),squareShape:H()})}),n?e.querySelector(".moreScenes").classList.remove("hide"):e.querySelector(".moreScenes").classList.add("hide")}function st(e,t){var a=t.MediaSources.map(function(e){return nt(t,e)}).join('<div style="border-top:1px solid #444;margin: 1em 0;"></div>');t.MediaSources.length>1&&(a="<br/>"+a);var i=e.querySelector("#mediaInfoContent");i.innerHTML=a}function nt(e,t){var a="";t.Name&&e.MediaSources.length>1&&(a+='<div><span class="mediaInfoAttribute">'+t.Name+"</span></div><br/>");for(var i=0,r=t.MediaStreams.length;r>i;i++){var s=t.MediaStreams[i];if("Data"!=s.Type){a+='<div class="mediaInfoStream">';var n=Globalize.translate("MediaInfoStreamType"+s.Type);a+='<h3 class="mediaInfoStreamType">'+n+"</h3>";var l=[];s.Language&&"Video"!=s.Type&&l.push(lt(Globalize.translate("MediaInfoLanguage"),s.Language)),s.Codec&&l.push(lt(Globalize.translate("MediaInfoCodec"),s.Codec.toUpperCase())),s.CodecTag&&l.push(lt(Globalize.translate("MediaInfoCodecTag"),s.CodecTag)),null!=s.IsAVC&&l.push(lt("AVC",s.IsAVC?"Yes":"No")),s.Profile&&l.push(lt(Globalize.translate("MediaInfoProfile"),s.Profile)),s.Level&&l.push(lt(Globalize.translate("MediaInfoLevel"),s.Level)),(s.Width||s.Height)&&l.push(lt(Globalize.translate("MediaInfoResolution"),s.Width+"x"+s.Height)),s.AspectRatio&&"mjpeg"!=s.Codec&&l.push(lt(Globalize.translate("MediaInfoAspectRatio"),s.AspectRatio)),"Video"==s.Type&&(null!=s.IsAnamorphic&&l.push(lt(Globalize.translate("MediaInfoAnamorphic"),s.IsAnamorphic?"Yes":"No")),l.push(lt(Globalize.translate("MediaInfoInterlaced"),s.IsInterlaced?"Yes":"No"))),(s.AverageFrameRate||s.RealFrameRate)&&l.push(lt(Globalize.translate("MediaInfoFramerate"),s.AverageFrameRate||s.RealFrameRate)),s.ChannelLayout&&l.push(lt(Globalize.translate("MediaInfoLayout"),s.ChannelLayout)),s.Channels&&l.push(lt(Globalize.translate("MediaInfoChannels"),s.Channels+" ch")),s.BitRate&&"mjpeg"!=s.Codec&&l.push(lt(Globalize.translate("MediaInfoBitrate"),parseInt(s.BitRate/1e3)+" kbps")),s.SampleRate&&l.push(lt(Globalize.translate("MediaInfoSampleRate"),s.SampleRate+" Hz")),s.BitDepth&&l.push(lt(Globalize.translate("MediaInfoBitDepth"),s.BitDepth+" bit")),s.PixelFormat&&l.push(lt(Globalize.translate("MediaInfoPixelFormat"),s.PixelFormat)),s.RefFrames&&l.push(lt(Globalize.translate("MediaInfoRefFrames"),s.RefFrames)),s.NalLengthSize&&l.push(lt("NAL",s.NalLengthSize)),"Video"!=s.Type&&l.push(lt(Globalize.translate("MediaInfoDefault"),s.IsDefault?"Yes":"No")),"Subtitle"==s.Type&&(l.push(lt(Globalize.translate("MediaInfoForced"),s.IsForced?"Yes":"No")),l.push(lt(Globalize.translate("MediaInfoExternal"),s.IsExternal?"Yes":"No"))),"Video"==s.Type&&t.Timestamp&&l.push(lt(Globalize.translate("MediaInfoTimestamp"),t.Timestamp)),s.DisplayTitle&&l.push(lt("Title",s.DisplayTitle)),a+=l.join("<br/>"),a+="</div>"}}if(t.Container&&(a+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoContainer")+'</span><span class="mediaInfoAttribute">'+t.Container+"</span></div>"),t.Formats&&t.Formats.length,t.Path&&"Http"!=t.Protocol&&(a+='<div style="max-width:600px;overflow:hidden;"><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoPath")+'</span><span class="mediaInfoAttribute">'+t.Path+"</span></div>"),t.Size){var o=(t.Size/1048576).toFixed(0);a+='<div><span class="mediaInfoLabel">'+Globalize.translate("MediaInfoSize")+'</span><span class="mediaInfoAttribute">'+o+" MB</span></div>"}return a}function lt(e,t){return'<span class="mediaInfoLabel">'+e+'</span><span class="mediaInfoAttribute">'+t+"</span>"}function ot(e,t,i,r){for(var s="",n=0,l=e.length;l>n&&!(i&&n>=i);n++){var o=e[n],d="card backdropCard scalableCard backdropCard-scalable",c="itemdetails.html?id="+o.Id,u="Full"==o.PlayAccess?" onclick=\"MediaController.play('"+o.Id+"'); return false;\"":"";s+='<a class="'+d+'" href="'+c+'"'+u+">",s+='<div class="cardBox">',s+='<div class="cardScalable">';var m,p=o.ImageTags||{};m=p.Primary?ApiClient.getScaledImageUrl(o.Id,{maxWidth:400,tag:p.Primary,type:"primary"}):"css/images/items/detail/video.png",s+='<div class="cardPadder cardPadder-backdrop"></div>',s+='<div class="cardContent">',s+='<div class="cardImage lazy" data-src="'+m+'"></div>',s+='<div class="innerCardFooter">',s+='<div class="cardText">'+o.Name+"</div>",s+='<div class="cardText">',s+=""!=o.RunTimeTicks?a.getDisplayRunningTime(o.RunTimeTicks):"&nbsp;",s+="</div>",s+="</div>",s+="</div>",s+="</div>",s+="</div>",s+="</a>"}return i&&e.length>i&&(s+='<p style="margin: 0;padding-left:5px;"><button is="emby-button" type="button" class="raised more '+r+'">'+Globalize.translate("ButtonMore")+"</button></p>"),s}function dt(e,t,a,i){ApiClient.getSpecialFeatures(a.Id,t.Id).then(function(t){var r=e.querySelector("#specialsContent");r.innerHTML=ot(t,a,i,"moreSpecials"),ImageLoader.lazyChildren(r)})}function ct(e,t,a,i){var r=t.People||[],s=e.querySelector("#castContent");D()?(s.classList.add("smoothScrollX"),i=32):s.classList.add("vertical-wrap");var n=i&&r.length>i;n&&(r=r.slice(0),r.length=Math.min(i,r.length)),require(["peoplecardbuilder"],function(e){e.buildPeopleCards(r,{itemsContainer:s,coverImage:!0,serverId:t.ServerId,width:160,shape:G()})}),n&&!D()?e.querySelector(".morePeople").classList.remove("hide"):e.querySelector(".morePeople").classList.add("hide")}function ut(e){MediaController.play({items:[St],startPositionTicks:e})}function mt(e,t){require(["confirm"],function(a){a("Are you sure you wish to split the media sources into separate items?","Split Media Apart").then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Videos/"+t.id+"/AlternateSources")}).then(function(){Dashboard.hideLoadingMsg(),p(e,t)})})})}function pt(){ApiClient.getLocalTrailers(Dashboard.getCurrentUserId(),St.Id).then(function(e){MediaController.play({items:e})})}function ht(e,t){require(["playMenu"],function(a){a.show({item:e,positionTo:t})})}function yt(e){return"Program"==St.Type?void ApiClient.getLiveTvChannel(St.ChannelId,Dashboard.getCurrentUserId()).then(function(t){ht(t,e)}):void ht(St,e)}function vt(e,t,a){require(["confirm"],function(i){i(Globalize.translate("MessageConfirmRecordingCancellation"),Globalize.translate("HeaderConfirmRecordingCancellation")).then(function(){Dashboard.showLoadingMsg(),ApiClient.cancelLiveTvTimer(a).then(function(){require(["toast"],function(e){e(Globalize.translate("MessageRecordingCancelled"))}),p(e,t)})})})}function gt(){var e=this;e.play=ut,e.setInitialCollapsibleState=C,e.renderDetails=A,e.renderCriticReviews=Q,e.renderCast=ct,e.renderScenes=rt,e.renderMediaSources=st}function ft(){yt(this)}function bt(){require(["syncDialog"],function(e){e.showMenu({items:[St],serverId:ApiClient.serverId()})
})}var St,It=null;return window.ItemDetailPage=new gt,function(e,t){function a(){v(e,St)}function i(){this.checked?require(["syncDialog"],function(i){i.showMenu({items:[St],isLocalSync:!0,serverId:ApiClient.serverId()}).then(function(){p(e,t)},a)}):require(["confirm"],function(e){e(Globalize.translate("ConfirmRemoveDownload")).then(function(){ApiClient.cancelSyncItems([St.Id])},a)})}function r(){pt(e)}function s(){var a=t.id;Dashboard.showLoadingMsg(),require(["recordingCreator"],function(i){i.show(a,St.ServerId).then(function(){p(e,t)})})}function l(){vt(e,t,St.TimerId)}function o(){var a=this;n.show(y(St,a)).then(function(a){a.deleted?Emby.Page.goHome():a.updated&&p(e,t)})}function c(){return new Promise(function(e,t){require(["imageEditor"],function(a){a.show({itemId:St.Id,serverId:St.ServerId}).then(e,t)})})}function u(t,a){var i=a;if("UserDataChanged"===i.MessageType&&St&&i.Data.UserId==Dashboard.getCurrentUserId()){var r=St.UserData.Key,s=i.Data.UserDataList.filter(function(e){return e.Key==r})[0];s&&(St.UserData=s,Dashboard.getCurrentUser().then(function(t){I(e,St,t)}))}}var m,h,g=e.querySelectorAll(".btnPlay");for(m=0,h=g.length;h>m;m++)g[m].addEventListener("click",ft);for(g=e.querySelectorAll(".btnPlayTrailer"),m=0,h=g.length;h>m;m++)g[m].addEventListener("click",r);for(e.querySelector(".btnSplitVersions").addEventListener("click",function(){mt(e,t)}),g=e.querySelectorAll(".btnSync"),m=0,h=g.length;h>m;m++)g[m].addEventListener("click",bt);for(g=e.querySelectorAll(".chkOffline"),m=0,h=g.length;h>m;m++)g[m].addEventListener("change",i);for(g=e.querySelectorAll(".btnRecord,.btnFloatingRecord"),m=0,h=g.length;h>m;m++)g[m].addEventListener("click",s);for(g=e.querySelectorAll(".btnCancelRecording"),m=0,h=g.length;h>m;m++)g[m].addEventListener("click",l);for(g=e.querySelectorAll(".btnMoreCommands"),m=0,h=g.length;h>m;m++)g[m].addEventListener("click",o);e.addEventListener("click",function(a){d.parentWithClass(a.target,"moreScenes")?Dashboard.getCurrentUser().then(function(t){rt(e,St,t)}):d.parentWithClass(a.target,"morePeople")?ct(e,St,t.context):d.parentWithClass(a.target,"moreSpecials")?Dashboard.getCurrentUser().then(function(t){dt(e,St,t)}):d.parentWithClass(a.target,"moreCriticReviews")&&Q(e,St)}),e.querySelector(".collectionItems").addEventListener("needsrefresh",function(){V(e,St)}),e.querySelector(".detailImageContainer").addEventListener("click",function(a){var i=d.parentWithClass(a.target,"itemDetailGalleryLink");i&&c().then(function(){p(e,t)})}),e.querySelector(".chapterSettingsButton").addEventListener("click",function(){Dashboard.navigate("librarysettings.html")}),e.addEventListener("viewbeforeshow",function(){var e=this;p(e,t),Events.on(ApiClient,"websocketmessage",u)}),e.addEventListener("viewbeforehide",function(){St=null,Events.off(ApiClient,"websocketmessage",u),LibraryMenu.setTransparentMenu(!1)})}});