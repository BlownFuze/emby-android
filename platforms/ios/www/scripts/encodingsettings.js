define(["jQuery"],function(e){function t(t,n,a){t.querySelector("#chkEnableThrottle").checked=n.EnableThrottling,e("#selectVideoDecoder",t).val(n.HardwareAccelerationType),e("#selectThreadCount",t).val(n.EncodingThreadCount),e("#txtDownMixAudioBoost",t).val(n.DownMixAudioBoost),t.querySelector(".txtEncoderPath").value=n.EncoderAppPath||"",e("#txtTranscodingTempPath",t).val(n.TranscodingTempPath||""),e("#txtVaapiDevice",t).val(n.VaapiDevice||"");var r=t.querySelector("#selectEncoderPath");r.value=a.EncoderLocationType,i.call(r),t.querySelector("#selectVideoDecoder").dispatchEvent(new CustomEvent("change",{bubbles:!0})),Dashboard.hideLoadingMsg()}function n(){Dashboard.hideLoadingMsg();var e="";e=Globalize.translate("FFmpegSavePathNotFound"),require(["alert"],function(t){t(e)})}function a(e){return ApiClient.getSystemInfo().then(function(t){return"External"!=t.EncoderLocationType?ApiClient.ajax({url:ApiClient.getUrl("System/MediaEncoder/Path"),type:"POST",data:{Path:e.querySelector(".txtEncoderPath").value,PathType:e.querySelector("#selectEncoderPath").value}}).then(Dashboard.processServerConfigurationUpdateResult,n):void 0})}function r(){var t=this,n=function(){Dashboard.showLoadingMsg(),ApiClient.getNamedConfiguration("encoding").then(function(n){n.DownMixAudioBoost=e("#txtDownMixAudioBoost",t).val(),n.TranscodingTempPath=e("#txtTranscodingTempPath",t).val(),n.EncodingThreadCount=e("#selectThreadCount",t).val(),n.HardwareAccelerationType=e("#selectVideoDecoder",t).val(),n.VaapiDevice=e("#txtVaapiDevice",t).val(),n.EnableThrottling=t.querySelector("#chkEnableThrottle").checked,ApiClient.updateNamedConfiguration("encoding",n).then(function(){a(t)})})};return e("#selectVideoDecoder",t).val()?require(["alert"],function(e){e({title:Globalize.translate("TitleHardwareAcceleration"),text:Globalize.translate("HardwareAccelerationWarning")}).then(n)}):n(),!1}function o(){return[{href:"cinemamodeconfiguration.html",name:Globalize.translate("TabCinemaMode")},{href:"playbackconfiguration.html",name:Globalize.translate("TabResumeSettings")},{href:"streamingsettings.html",name:Globalize.translate("TabStreaming")},{href:"encodingsettings.html",name:Globalize.translate("TabTranscoding")}]}function i(){var t=e(this).parents(".page")[0];"Custom"==this.value?(t.querySelector(".fldEncoderPath").classList.remove("hide"),t.querySelector(".txtEncoderPath").setAttribute("required","required")):(t.querySelector(".fldEncoderPath").classList.add("hide"),t.querySelector(".txtEncoderPath").removeAttribute("required"))}e(document).on("pageinit","#encodingSettingsPage",function(){var t=this;t.querySelector("#selectVideoDecoder").addEventListener("change",function(){"vaapi"==this.value?(t.querySelector(".fldVaapiDevice").classList.remove("hide"),t.querySelector("#txtVaapiDevice").setAttribute("required","required")):(t.querySelector(".fldVaapiDevice").classList.add("hide"),t.querySelector("#txtVaapiDevice").removeAttribute("required"))}),e("#btnSelectEncoderPath",t).on("click.selectDirectory",function(){require(["directorybrowser"],function(n){var a=new n;a.show({includeFiles:!0,callback:function(n){n&&e(".txtEncoderPath",t).val(n),a.close()}})})}),e("#btnSelectTranscodingTempPath",t).on("click.selectDirectory",function(){require(["directorybrowser"],function(n){var a=new n;a.show({callback:function(n){n&&e("#txtTranscodingTempPath",t).val(n),a.close()},header:Globalize.translate("HeaderSelectTranscodingPath"),instruction:Globalize.translate("HeaderSelectTranscodingPathHelp")})})}),e(".encodingSettingsForm").off("submit",r).on("submit",r),t.querySelector("#selectEncoderPath").addEventListener("change",i)}).on("pageshow","#encodingSettingsPage",function(){Dashboard.showLoadingMsg(),LibraryMenu.setTabs("playback",3,o);var e=this;ApiClient.getNamedConfiguration("encoding").then(function(n){ApiClient.getSystemInfo().then(function(a){"External"==a.EncoderLocationType?e.querySelector(".fldSelectEncoderPathType").classList.add("hide"):e.querySelector(".fldSelectEncoderPathType").classList.remove("hide"),t(e,n,a)})})})});