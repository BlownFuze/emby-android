define(["libraryBrowser","components/categorysyncbuttons","cardBuilder","dom","scrollStyles","emby-itemscontainer","emby-tabs","emby-button"],function(e,t,a,n){function r(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function i(){return r()?"overflowPortrait":"portrait"}function o(){return r()?"overflowBackdrop":"backdrop"}function s(e,t,n){var o={IncludeItemTypes:"Movie",Limit:18,Fields:"PrimaryImageAspectRatio,MediaSourceCount,BasicSyncInfo",ParentId:n,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getJSON(ApiClient.getUrl("Users/"+t+"/Items/Latest",o)).then(function(t){var n=!r(),o=e.querySelector("#recentlyAddedItems");a.buildCards(t,{itemsContainer:o,shape:i(),scalable:!0,overlayPlayButton:!0,allowBottomPadding:n})})}function l(e,t,i){var s=n.getWindowSize().innerWidth,l={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Movie",Filters:"IsResumable",Limit:s>=1920?5:s>=1600?4:3,Recursive:!0,Fields:"PrimaryImageAspectRatio,MediaSourceCount,BasicSyncInfo",CollapseBoxSetItems:!1,ParentId:i,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(t,l).then(function(t){t.Items.length?e.querySelector("#resumableSection").classList.remove("hide"):e.querySelector("#resumableSection").classList.add("hide");var n=!r(),i=e.querySelector("#resumableItems");a.buildCards(t.Items,{itemsContainer:i,preferThumb:!0,shape:o(),scalable:!0,overlayPlayButton:!0,allowBottomPadding:n})})}function c(e){var t="",n="";switch(e.RecommendationType){case"SimilarToRecentlyPlayed":n=Globalize.translate("RecommendationBecauseYouWatched").replace("{0}",e.BaselineItemName);break;case"SimilarToLikedItem":n=Globalize.translate("RecommendationBecauseYouLike").replace("{0}",e.BaselineItemName);break;case"HasDirectorFromRecentlyPlayed":case"HasLikedDirector":n=Globalize.translate("RecommendationDirectedBy").replace("{0}",e.BaselineItemName);break;case"HasActorFromRecentlyPlayed":case"HasLikedActor":n=Globalize.translate("RecommendationStarring").replace("{0}",e.BaselineItemName)}t+='<div class="homePageSection">',t+='<h1 class="listHeader">'+n+"</h1>";var o=!0;return r()?(o=!1,t+='<div is="emby-itemscontainer" class="itemsContainer hiddenScrollX">'):t+='<div is="emby-itemscontainer" class="itemsContainer vertical-wrap">',t+=a.getCardsHtml(e.Items,{shape:i(),scalable:!0,overlayPlayButton:!0,allowBottomPadding:o}),t+="</div>",t+="</div>"}function d(e,t){var a=n.getWindowSize().innerWidth,r=ApiClient.getUrl("Movies/Recommendations",{userId:t,categoryLimit:6,ItemLimit:a>=1920?8:a>=1600?8:a>=1200?6:5,Fields:"PrimaryImageAspectRatio,MediaSourceCount,BasicSyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb"});ApiClient.getJSON(r).then(function(t){if(!t.length)return e.querySelector(".noItemsMessage").classList.remove("hide"),void(e.querySelector(".recommendations").innerHTML="");var a=t.map(c).join("");e.querySelector(".noItemsMessage").classList.add("hide");var n=e.querySelector(".recommendations");n.innerHTML=a,ImageLoader.lazyChildren(n)})}function m(e,t){for(var a=t.querySelectorAll(".itemsContainer"),n=0,i=a.length;i>n;n++)r()?(a[n].classList.add("hiddenScrollX"),a[n].classList.remove("vertical-wrap")):(a[n].classList.remove("hiddenScrollX"),a[n].classList.add("vertical-wrap"))}function u(e,t,a){var n=t.topParentId,r=Dashboard.getCurrentUserId();l(a,r,n),s(a,r,n),d(a,r,n)}return function(a,n){function r(e,t,r){var i=[];switch(t){case 0:break;case 1:i.push("scripts/movies");break;case 2:i.push("scripts/movietrailers");break;case 3:i.push("scripts/moviecollections");break;case 4:i.push("scripts/moviegenres");break;case 5:i.push("scripts/moviestudios")}require(i,function(e){var i;0==t&&(i=a.querySelector(".pageTabContent[data-index='"+t+"']"),l.tabContent=i);var o=d[t];o||(i=a.querySelector(".pageTabContent[data-index='"+t+"']"),o=t?new e(a,n,i):l,d[t]=o,o.initTab&&o.initTab()),r(o)})}function i(e,t){r(e,t,function(e){-1==b.indexOf(t)&&e.preRender&&e.preRender()})}function o(e,t){r(e,t,function(e){-1==b.indexOf(t)&&(b.push(t),e.renderTab())})}function s(e,t){t.NowPlayingItem&&"Video"==t.NowPlayingItem.MediaType&&(b=[],c.triggerTabChange())}var l=this;l.initTab=function(){var e=a.querySelector(".pageTabContent[data-index='0']");t.init(e),m(a,e)},l.renderTab=function(){var e=a.querySelector(".pageTabContent[data-index='0']");u(a,n,e)};var c=a.querySelector(".libraryViewNav");e.configurePaperLibraryTabs(a,c,a.querySelectorAll(".pageTabContent"),[0,3,4,5]);var d=[],b=[];c.addEventListener("beforetabchange",function(e){i(a,parseInt(e.detail.selectedTabIndex))}),c.addEventListener("tabchange",function(e){o(a,parseInt(e.detail.selectedTabIndex))}),a.addEventListener("viewbeforeshow",function(){if(!a.getAttribute("data-title")){var e=n.topParentId;e?ApiClient.getItem(Dashboard.getCurrentUserId(),e).then(function(e){a.setAttribute("data-title",e.Name),LibraryMenu.setTitle(e.Name)}):(a.setAttribute("data-title",Globalize.translate("TabMovies")),LibraryMenu.setTitle(Globalize.translate("TabMovies")))}}),a.addEventListener("viewshow",function(){Events.on(MediaController,"playbackstop",s)}),a.addEventListener("viewbeforehide",function(){Events.off(MediaController,"playbackstop",s)}),AppInfo.enableHeadRoom&&require(["headroom-window"],function(e){e.add(c),l.headroom=e}),a.addEventListener("viewdestroy",function(){l.headroom&&l.headroom.remove(c)})}});