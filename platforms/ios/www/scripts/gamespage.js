define(["jQuery"],function(e){function r(e){var r=a(e),t=o[r];return t||(t=o[r]={query:{SortBy:"SortName",SortOrder:"Ascending",MediaTypes:"Game",Recursive:!0,Fields:"Genres,Studios,PrimaryImageAspectRatio,SortName",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()},view:LibraryBrowser.getSavedView(r)||LibraryBrowser.getDefaultItemsView("Poster","List")},t.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(r,t.query)),t}function t(e){return r(e).query}function a(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("games")),e.savedQueryKey}function i(o){Dashboard.showLoadingMsg();var s=t(o);ApiClient.getItems(Dashboard.getCurrentUserId(),s).then(function(t){window.scrollTo(0,0);var u="";e(".listTopPaging",o).html(LibraryBrowser.getQueryPagingHtml({startIndex:s.StartIndex,limit:s.Limit,totalRecordCount:t.TotalRecordCount,showLimit:!1,filterButton:!0}));var g=r(o).view;"List"==g?u=LibraryBrowser.getListViewHtml({items:t.Items,context:"games",sortBy:s.SortBy}):"Poster"==g?u=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"auto",context:"games",showTitle:!0,showParentTitle:!0,centerText:!0}):"PosterCard"==g&&(u=LibraryBrowser.getPosterViewHtml({items:t.Items,shape:"auto",context:"games",showTitle:!0,showParentTitle:!0,cardLayout:!0}));var d=o.querySelector("#items");d.innerHTML=u,ImageLoader.lazyChildren(d),e(".btnNextPage",o).on("click",function(){s.StartIndex+=s.Limit,i(o)}),e(".btnPreviousPage",o).on("click",function(){s.StartIndex-=s.Limit,i(o)}),e(".btnFilter",o).on("click",function(){n(o)}),LibraryBrowser.saveQueryValues(a(o),s),Dashboard.hideLoadingMsg()})}function n(e){require(["components/filterdialog/filterdialog"],function(r){var a=new r({query:t(e),mode:"games"});Events.on(a,"filterchange",function(){i(e)}),a.show()})}var o={};e(document).on("pageinit","#gamesPage",function(){var r=this;e(".alphabetPicker",this).on("alphaselect",function(e,a){var n=t(r);n.NameStartsWithOrGreater=a,n.StartIndex=0,i(r)}).on("alphaclear",function(){var e=t(r);e.NameStartsWithOrGreater="",i(r)})}).on("pagebeforeshow","#gamesPage",function(){var r=this,n=t(r);n.ParentId=LibraryMenu.getTopParentId();var o=LibraryBrowser.getDefaultPageSize();o!=n.Limit&&(n.Limit=o,n.StartIndex=0);var s=a(r);LibraryBrowser.loadSavedQueryValues(s,n),LibraryBrowser.getSavedViewSetting(s).then(function(t){t?e("#selectView",r).val(t).trigger("change"):i(r)})})});