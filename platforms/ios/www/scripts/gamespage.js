define(["jQuery","listView"],function(e,r){function t(e){var r=i(e),t=s[r];return t||(t=s[r]={query:{SortBy:"SortName",SortOrder:"Ascending",MediaTypes:"Game",Recursive:!0,Fields:"Genres,Studios,PrimaryImageAspectRatio,SortName",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()},view:LibraryBrowser.getSavedView(r)||"Poster"},t.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(r,t.query)),t}function a(e){return t(e).query}function i(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("games")),e.savedQueryKey}function n(s){Dashboard.showLoadingMsg();var u=a(s);ApiClient.getItems(Dashboard.getCurrentUserId(),u).then(function(a){window.scrollTo(0,0);var g="";e(".listTopPaging",s).html(LibraryBrowser.getQueryPagingHtml({startIndex:u.StartIndex,limit:u.Limit,totalRecordCount:a.TotalRecordCount,showLimit:!1,filterButton:!0}));var d=t(s).view;"List"==d?g=r.getListViewHtml({items:a.Items,context:"games",sortBy:u.SortBy}):"Poster"==d?g=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"auto",context:"games",showTitle:!0,showParentTitle:!0,centerText:!0}):"PosterCard"==d&&(g=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"auto",context:"games",showTitle:!0,showParentTitle:!0,cardLayout:!0}));var l=s.querySelector("#items");l.innerHTML=g,ImageLoader.lazyChildren(l),e(".btnNextPage",s).on("click",function(){u.StartIndex+=u.Limit,n(s)}),e(".btnPreviousPage",s).on("click",function(){u.StartIndex-=u.Limit,n(s)}),e(".btnFilter",s).on("click",function(){o(s)}),LibraryBrowser.saveQueryValues(i(s),u),Dashboard.hideLoadingMsg()})}function o(e){require(["components/filterdialog/filterdialog"],function(r){var t=new r({query:a(e),mode:"games"});Events.on(t,"filterchange",function(){n(e)}),t.show()})}var s={};e(document).on("pageinit","#gamesPage",function(){var r=this;e(".alphabetPicker",this).on("alphaselect",function(e,t){var i=a(r);i.NameStartsWithOrGreater=t,i.StartIndex=0,n(r)}).on("alphaclear",function(){var e=a(r);e.NameStartsWithOrGreater="",n(r)})}).on("pagebeforeshow","#gamesPage",function(){var r=this,t=a(r);t.ParentId=LibraryMenu.getTopParentId();var o=LibraryBrowser.getDefaultPageSize();o!=t.Limit&&(t.Limit=o,t.StartIndex=0);var s=i(r);LibraryBrowser.loadSavedQueryValues(s,t),LibraryBrowser.getSavedViewSetting(s).then(function(t){t?e("#selectView",r).val(t).trigger("change"):n(r)})})});