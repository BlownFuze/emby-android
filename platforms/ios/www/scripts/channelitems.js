define(["jQuery","emby-itemscontainer"],function(e){function t(e){var t=r(e),n=d[t];return n||(n=d[t]={query:{SortBy:"",SortOrder:"Ascending",Fields:"PrimaryImageAspectRatio,SyncInfo",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()}},LibraryBrowser.loadSavedQueryValues(t,n.query)),n}function n(e){return t(e).query}function r(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("channelitems")),e.savedQueryKey}function i(e,t){return e.pageParams||(e.pageParams={}),e.pageParams[t]||(e.pageParams[t]=getParameterByName(t)),e.pageParams[t]}function a(r){var a=i(r,"id");ApiClient.getJSON(ApiClient.getUrl("Channels/"+a+"/Features")).then(function(i){i.CanFilter?e(".filterControls",r).show():e(".filterControls",r).hide(),i.SupportsSortOrderToggle?e(".sortOrderToggle",r).show():e(".sortOrderToggle",r).hide();var a=i.MaxPageSize,s=n(r);a&&(s.Limit=Math.min(a,s.Limit||a)),t(r).sortFields=i.DefaultSortFields,o(r)})}function o(t){Dashboard.showLoadingMsg();var r=i(t,"id"),a=i(t,"folderId"),d=n(t);d.UserId=Dashboard.getCurrentUserId(),a?ApiClient.getItem(d.UserId,a).then(function(e){LibraryMenu.setTitle(e.Name)}):ApiClient.getItem(d.UserId,r).then(function(e){LibraryMenu.setTitle(e.Name)}),d.folderId=a,ApiClient.getJSON(ApiClient.getUrl("Channels/"+r+"/Items",d)).then(function(n){window.scrollTo(0,0);var r="",i=LibraryBrowser.getQueryPagingHtml({startIndex:d.StartIndex,limit:d.Limit,totalRecordCount:n.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,sortButton:!0,filterButton:!0});t.querySelector(".listTopPaging").innerHTML=i,u(t),r=LibraryBrowser.getPosterViewHtml({items:n.Items,shape:"auto",defaultShape:"square",context:"channels",showTitle:!0,coverImage:!0,showYear:!0,lazy:!0,centerText:!0});var a=t.querySelector("#items");a.innerHTML=r+i,ImageLoader.lazyChildren(a),e(".btnNextPage",t).on("click",function(){d.StartIndex+=d.Limit,o(t)}),e(".btnPreviousPage",t).on("click",function(){d.StartIndex-=d.Limit,o(t)}),e(".btnFilter",t).on("click",function(){s(t)}),e(".btnSort",t).on("click",function(){l(t)}),Dashboard.hideLoadingMsg()},function(){Dashboard.hideLoadingMsg()})}function s(e){require(["components/filterdialog/filterdialog"],function(t){var r=new t({query:n(e)});Events.on(r,"filterchange",function(){o(e)}),r.show()})}function l(e){var r=t(e).sortFields,i=[];i.push({name:Globalize.translate("OptionDefaultSort"),id:""}),-1!=r.indexOf("Name")&&i.push({name:Globalize.translate("OptionNameSort"),id:"SortName"}),-1!=r.indexOf("CommunityRating")&&i.push({name:Globalize.translate("OptionCommunityRating"),id:"CommunityRating"}),-1!=r.indexOf("DateCreated")&&i.push({name:Globalize.translate("OptionDateAdded"),id:"DateCreated"}),-1!=r.indexOf("PlayCount")&&i.push({name:Globalize.translate("OptionPlayCount"),id:"PlayCount"}),-1!=r.indexOf("PremiereDate")&&i.push({name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate"}),-1!=r.indexOf("Runtime")&&i.push({name:Globalize.translate("OptionRuntime"),id:"Runtime"}),LibraryBrowser.showSortMenu({items:i,callback:function(){o(e)},query:n(e)})}function u(){}var d={};pageIdOn("pagebeforeshow","channelItemsPage",function(){var e=this;a(e),u(e)})});