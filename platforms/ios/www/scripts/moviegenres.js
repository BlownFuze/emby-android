define(["libraryBrowser"],function(e){return function(t,r,n){function o(){var t=a(),n=c[t];return n||(n=c[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Movie",Recursive:!0,Fields:"DateCreated,SyncInfo,ItemCounts",StartIndex:0},view:e.getSavedView(t)||e.getDefaultItemsView("Thumb","Thumb")},n.query.ParentId=r.topParentId,e.loadSavedQueryValues(t,n.query)),n}function i(){return o().query}function a(){return e.getSavedQueryKey("genres")}function s(){Dashboard.showLoadingMsg();var e=i();return ApiClient.getGenres(Dashboard.getCurrentUserId(),e)}function u(t,r){var n=i();r.then(function(r){var o="",i=l.getCurrentViewStyle();"Thumb"==i?o=e.getPosterViewHtml({items:r.Items,shape:"backdrop",preferThumb:!0,context:"movies",showItemCounts:!0,centerText:!0,lazy:!0,overlayMoreButton:!0}):"ThumbCard"==i?o=e.getPosterViewHtml({items:r.Items,shape:"backdrop",preferThumb:!0,context:"movies",showItemCounts:!0,cardLayout:!0,showTitle:!0,lazy:!0}):"PosterCard"==i?o=e.getPosterViewHtml({items:r.Items,shape:"portrait",context:"movies",showItemCounts:!0,lazy:!0,cardLayout:!0,showTitle:!0}):"Poster"==i&&(o=e.getPosterViewHtml({items:r.Items,shape:"portrait",context:"movies",centerText:!0,showItemCounts:!0,lazy:!0,overlayMoreButton:!0}));var s=t.querySelector("#items");s.innerHTML=o,ImageLoader.lazyChildren(s),e.saveQueryValues(a(),n),Dashboard.hideLoadingMsg()})}function d(){l.preRender(),l.renderTab()}var l=this,c={};l.getViewStyles=function(){return"Poster,PosterCard,Thumb,ThumbCard".split(",")},l.getCurrentViewStyle=function(){return o(n).view},l.setCurrentViewStyle=function(t){o(n).view=t,e.saveViewSetting(a(n),t),d()},l.enableViewSelection=!0;var m;l.preRender=function(){m=s()},l.renderTab=function(){u(n,m)};var y=n.querySelector(".btnSelectView");y.addEventListener("click",function(t){e.showLayoutMenu(t.target,l.getCurrentViewStyle(),l.getViewStyles())}),y.addEventListener("layoutchange",function(e){l.setCurrentViewStyle(e.detail.viewStyle)})}});