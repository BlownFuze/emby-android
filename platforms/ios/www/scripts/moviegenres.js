define(["libraryBrowser","cardBuilder"],function(e,t){return function(r,n,a){function i(){var t=u(),r=h[t];return r||(r=h[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Movie",Recursive:!0,Fields:"DateCreated,ItemCounts,PrimaryImageAspectRatio",StartIndex:0},view:e.getSavedView(t)||"Thumb"},r.query.ParentId=n.topParentId,e.loadSavedQueryValues(t,r.query)),r}function o(){return i().query}function u(){return e.getSavedQueryKey("genres")}function s(){Dashboard.showLoadingMsg();var e=o();return ApiClient.getGenres(Dashboard.getCurrentUserId(),e)}function d(r,n){var a=o();n.then(function(n){var i=c.getCurrentViewStyle(),o=r.querySelector("#items");"Thumb"==i?t.buildCards(n.Items,{itemsContainer:o,shape:"backdrop",preferThumb:!0,showTitle:!0,scalable:!0,showItemCounts:!0,centerText:!0,overlayMoreButton:!0}):"ThumbCard"==i?t.buildCards(n.Items,{itemsContainer:o,shape:"backdrop",preferThumb:!0,showTitle:!0,scalable:!0,showItemCounts:!0,centerText:!0,cardLayout:!0}):"PosterCard"==i?t.buildCards(n.Items,{itemsContainer:o,shape:"auto",showTitle:!0,scalable:!0,showItemCounts:!0,centerText:!0,cardLayout:!0}):"Poster"==i&&t.buildCards(n.Items,{itemsContainer:o,shape:"auto",showTitle:!0,scalable:!0,showItemCounts:!0,centerText:!0,overlayMoreButton:!0}),e.saveQueryValues(u(),a),Dashboard.hideLoadingMsg()})}function l(){c.preRender(),c.renderTab()}var c=this,h={};c.getViewStyles=function(){return"Poster,PosterCard,Thumb,ThumbCard".split(",")},c.getCurrentViewStyle=function(){return i(a).view},c.setCurrentViewStyle=function(t){i(a).view=t,e.saveViewSetting(u(a),t),l()},c.enableViewSelection=!0;var y;c.preRender=function(){y=s()},c.renderTab=function(){d(a,y)};var w=a.querySelector(".btnSelectView");w.addEventListener("click",function(t){e.showLayoutMenu(t.target,c.getCurrentViewStyle(),c.getViewStyles())}),w.addEventListener("layoutchange",function(e){c.setCurrentViewStyle(e.detail.viewStyle)})}});