!function(){function e(e,t,o){t.length?($(".noDevices",e).hide(),$(".devicesUploadForm",e).show()):($(".noDevices",e).show(),$(".devicesUploadForm",e).hide()),$("#txtUploadPath",e).val(o.CameraUploadPath||""),$("#chkSubfolder",e).checked(o.EnableCameraUploadSubfolders).checkboxradio("refresh"),a(e,t,o)}function a(e,a,t){var o="";o+='<fieldset data-role="controlgroup">',o+="<legend>",o+=Globalize.translate("LabelEnableCameraUploadFor"),o+="</legend>";var i=0;o+=a.map(function(e){var a="",o="chk"+i;a+='<label for="'+o+'">',a+=e.Name,e.AppName&&(a+="<br/><span>"+e.AppName+"</span>"),a+="</label>";var n=-1!=t.EnabledCameraUploadDevices.indexOf(e.Id),l=n?' checked="checked"':"";return a+='<input type="checkbox" id="'+o+'" class="chkDevice" data-id="'+e.Id+'"'+l+" />",i++,a}).join(""),o+="</fieldset>",o+='<div class="fieldDescription">',o+=Globalize.translate("LabelEnableCameraUploadForHelp"),o+="</div>",$(".devicesList",e).html(o).trigger("create")}function t(a){Dashboard.showLoadingMsg();var t=ApiClient.getNamedConfiguration("devices"),o=ApiClient.getJSON(ApiClient.getUrl("Devices",{SupportsContentUploading:!0}));Promise.all([t,o]).then(function(t){e(a,t[1].Items,t[0]),Dashboard.hideLoadingMsg()})}function o(e){ApiClient.getNamedConfiguration("devices").then(function(a){a.CameraUploadPath=$("#txtUploadPath",e).val(),a.EnabledCameraUploadDevices=$(".chkDevice:checked",e).get().map(function(e){return e.getAttribute("data-id")}),a.EnableCameraUploadSubfolders=$("#chkSubfolder",e).checked(),ApiClient.updateNamedConfiguration("devices",a).then(Dashboard.processServerConfigurationUpdateResult)})}function i(){var e=this,a=$(e).parents(".page");return o(a),!1}$(document).on("pageinit","#devicesUploadPage",function(){var e=this;$("#btnSelectUploadPath",e).on("click.selectDirectory",function(){require(["directorybrowser"],function(a){var t=new a;t.show({callback:function(a){a&&$("#txtUploadPath",e).val(a),t.close()},header:Globalize.translate("HeaderSelectUploadPath")})})}),$(".devicesUploadForm").off("submit",i).on("submit",i)}).on("pageshow","#devicesUploadPage",function(){var e=this;t(e)})}();