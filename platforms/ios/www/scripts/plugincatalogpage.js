define(["jQuery"],function(e){function a(a){Dashboard.showLoadingMsg(),AppInfo.enableAppStorePolicy?e(".optionAdultContainer",a).hide():e(".optionAdultContainer",a).show(),r.IsAppStoreSafe=!0;var n=ApiClient.getAvailablePlugins(r),i=ApiClient.getInstalledPlugins();Promise.all([n,i]).then(function(n){t({catalogElement:e("#pluginTiles",a),noItemsElement:e("#noPlugins",a),availablePlugins:n[0],installedPlugins:n[1]})})}function t(e){requirejs(["scripts/ratingdialog"],function(){n(e)})}function n(a){var t=a.availablePlugins,n=a.installedPlugins,l=t.filter(function(e){return e.category=e.category||"General",e.categoryDisplayName=Globalize.translate("PluginCategory"+e.category.replace(" ","")),a.categories&&-1==a.categories.indexOf(e.category)?!1:a.targetSystem&&e.targetSystem!=a.targetSystem?!1:"UserInstalled"==e.type});t=l.sort(function(e,a){var t=e.category,n=a.category;return t>n?1:n>t?-1:(t=e.name,n=a.name,t>n?1:n>t?-1:0)});var r,s,o,c,g="";if(!a.categories){c=Globalize.translate("HeaderTopPlugins"),g+='<div class="detailSectionHeader">'+c+"</div>";var d=l.slice(0).sort(function(e,a){if(e.installs>a.installs)return-1;if(a.installs>e.installs)return 1;var t=e.name,n=a.name;return t>n?1:n>t?-1:0}),u=screen.availWidth>=1920?15:12;for(r=0,s=Math.min(d.length,u);s>r;r++)g+=i(d[r],a,n)}for(r=0,s=t.length;s>r;r++){o=t[r];var m=o.categoryDisplayName;m!=c&&(a.showCategory!==!1&&(c&&(g+="<br/>",g+="<br/>",g+="<br/>"),g+='<div class="detailSectionHeader">'+m+"</div>"),c=m),g+=i(o,a,n)}!t.length&&a.noItemsElement&&e(a.noItemsElement).hide(),e(a.catalogElement).html(g),Dashboard.hideLoadingMsg()}function i(e,a,t){var n="",i=e.externalUrl?e.externalUrl:"addplugin.html?name="+encodeURIComponent(e.name)+"&guid="+e.guid;a.context&&(i+="&context="+a.context);var l=e.externalUrl?' target="_blank"':"";n+="<div class='card backdropCard bottomPaddedCard'>",n+='<div class="cardBox visualCardBox">',n+='<div class="cardScalable">',n+='<div class="cardPadder"></div>',n+='<a class="cardContent" href="'+i+'"'+l+">",n+=e.thumbImage?'<div class="cardImage" style="background-image:url(\''+e.thumbImage+"');\">":'<div class="cardImage" style="background-image:url(\'css/images/items/list/collection.png\');">',e.isPremium&&(n+=e.price>0?"<div class='premiumBanner'><img src='css/images/supporter/premiumflag.png' /></div>":"<div class='premiumBanner'><img src='css/images/supporter/supporterflag.png' /></div>"),n+="</div>",n+="</a>",n+="</div>",n+='<div class="cardFooter">',n+="<div class='cardText'>",n+=e.name,n+="</div>",e.isExternal||(n+="<div class='cardText packageReviewText'>",n+=e.price>0?"$"+e.price.toFixed(2):Globalize.translate("LabelFree"),n+=RatingHelpers.getStoreRatingHtml(e.avgRating,e.id,e.name,!0),n+="<span class='storeReviewCount'>",n+=" "+Globalize.translate("LabelNumberReviews").replace("{0}",e.totalRatings),n+="</span>",n+="</div>");var r=e.isApp?null:t.filter(function(a){return a.Id==e.guid})[0];return n+="<div class='cardText'>",n+=r?Globalize.translate("LabelVersionInstalled").replace("{0}",r.Version):"&nbsp;",n+="</div>",n+="</div>",n+="</div>",n+="</div>"}function l(){return[{href:"plugins.html",name:Globalize.translate("TabMyPlugins")},{href:"plugincatalog.html",name:Globalize.translate("TabCatalog")}]}var r={TargetSystems:"Server",IsAdult:!1};e(document).on("pageinit","#pluginCatalogPage",function(){var t=this;e("#selectSystem",t).on("change",function(){r.TargetSystems=this.value,a(t)}),e("#chkAdult",t).on("change",function(){r.IsAdult=this.checked?null:!1,a(t)})}).on("pageshow","#pluginCatalogPage",function(){LibraryMenu.setTabs("plugins",1,l);var e=this;a(e)}),window.PluginCatalog={renderCatalog:t}});