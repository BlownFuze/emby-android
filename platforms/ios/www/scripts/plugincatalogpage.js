!function(e,a){function t(a){Dashboard.showLoadingMsg(),AppInfo.enableAppStorePolicy?e(".optionAdultContainer",a).hide():e(".optionAdultContainer",a).show(),l.IsAppStoreSafe=!0;var t=ApiClient.getAvailablePlugins(l),n=ApiClient.getInstalledPlugins();Promise.all([t,n]).then(function(t){i({catalogElement:e("#pluginTiles",a),noItemsElement:e("#noPlugins",a),availablePlugins:t[0],installedPlugins:t[1]})})}function i(e){requirejs(["scripts/ratingdialog"],function(){n(e)})}function n(a){var t=a.availablePlugins,i=a.installedPlugins,n=t.filter(function(e){return e.category=e.category||"General",e.categoryDisplayName=Globalize.translate("PluginCategory"+e.category.replace(" ","")),a.categories&&-1==a.categories.indexOf(e.category)?!1:a.targetSystem&&e.targetSystem!=a.targetSystem?!1:"UserInstalled"==e.type});t=n.sort(function(e,a){var t=e.category,i=a.category;return t>i?1:i>t?-1:(t=e.name,i=a.name,t>i?1:i>t?-1:0)});var l,s,o,c,d="";if(!a.categories){c=Globalize.translate("HeaderTopPlugins"),d+='<div class="detailSectionHeader">'+c+"</div>";var g=n.slice(0).sort(function(e,a){if(e.installs>a.installs)return-1;if(a.installs>e.installs)return 1;var t=e.name,i=a.name;return t>i?1:i>t?-1:0}),u=screen.availWidth>=1920?15:12;for(l=0,s=Math.min(g.length,u);s>l;l++)d+=r(g[l],a,i)}for(l=0,s=t.length;s>l;l++){o=t[l];var m=o.categoryDisplayName;m!=c&&(a.showCategory!==!1&&(c&&(d+="<br/>",d+="<br/>",d+="<br/>"),d+='<div class="detailSectionHeader">'+m+"</div>"),c=m),d+=r(o,a,i)}!t.length&&a.noItemsElement&&e(a.noItemsElement).hide(),e(a.catalogElement).html(d),Dashboard.hideLoadingMsg()}function r(e,a,t){var i="",n=e.externalUrl?e.externalUrl:"addplugin.html?name="+encodeURIComponent(e.name)+"&guid="+e.guid;a.context&&(n+="&context="+a.context);var r=e.externalUrl?' target="_blank"':"";i+="<div class='card backdropCard bottomPaddedCard'>",i+='<div class="cardBox visualCardBox">',i+='<div class="cardScalable">',i+='<div class="cardPadder"></div>',i+='<a class="cardContent" href="'+n+'"'+r+">",i+=e.thumbImage?'<div class="cardImage" style="background-image:url(\''+e.thumbImage+"');\">":'<div class="cardImage" style="background-image:url(\'css/images/items/list/collection.png\');">',e.isPremium&&(i+=e.price>0?"<div class='premiumBanner'><img src='css/images/supporter/premiumflag.png' /></div>":"<div class='premiumBanner'><img src='css/images/supporter/supporterflag.png' /></div>"),i+="</div>",i+="</a>",i+="</div>",i+='<div class="cardFooter">',i+="<div class='cardText'>",i+=e.name,i+="</div>",e.isExternal||(i+="<div class='cardText packageReviewText'>",i+=e.price>0?"$"+e.price.toFixed(2):Globalize.translate("LabelFree"),i+=RatingHelpers.getStoreRatingHtml(e.avgRating,e.id,e.name,!0),i+="<span class='storeReviewCount'>",i+=" "+Globalize.translate("LabelNumberReviews").replace("{0}",e.totalRatings),i+="</span>",i+="</div>");var l=e.isApp?null:t.filter(function(a){return a.Id==e.guid})[0];return i+="<div class='cardText'>",i+=l?Globalize.translate("LabelVersionInstalled").replace("{0}",l.Version):"&nbsp;",i+="</div>",i+="</div>",i+="</div>",i+="</div>"}var l={TargetSystems:"Server",IsAdult:!1};e(a).on("pageinit","#pluginCatalogPage",function(){var a=this;e(".chkPremiumFilter",a).on("change",function(){l.IsPremium=this.checked?!1:null,t(a)}),e(".radioPackageTypes",a).on("change",function(){var i=e(".radioPackageTypes:checked",a).val();l.TargetSystems=i,t(a)}),e("#chkAdult",a).on("change",function(){l.IsAdult=this.checked?null:!1,t(a)})}).on("pageshow","#pluginCatalogPage",function(){var a=this;e(".radioPackageTypes",a).each(function(){this.checked=this.value==l.TargetSystems}).checkboxradio("refresh"),e(".chkPremiumFilter",a).each(function(){var e=l.IsPremium||!1;this.checked=e}).checkboxradio("refresh"),t(a)}),window.PluginCatalog={renderCatalog:i}}(jQuery,document);