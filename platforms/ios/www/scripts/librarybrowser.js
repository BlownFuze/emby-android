define(["viewManager","appSettings","appStorage","apphost","datetime","itemHelper","mediaInfo","scroller","indicators","dom","browser","imageLoader","scrollStyles"],function(e,t,a,i,r,n,s,l,o,d,m){function u(e){var t=m.mobile?"4%":"0.5%",a=[{opacity:"0",transform:"translate3d("+t+", 0, 0)",offset:0},{opacity:"1",transform:"none",offset:1}];e.animate(a,{duration:160,iterations:1,easing:"ease-out"})}var c=function(t,i,r){var s="pagesize_v4",l={getDefaultPageSize:function(){return 100},getSavedQueryKey:function(e){return t.location.href.split("#")[0]+(e||"")},loadSavedQueryValues:function(e,t){var i=a.getItem(e+"_"+Dashboard.getCurrentUserId());return i?(i=JSON.parse(i),Object.assign(t,i)):t},saveQueryValues:function(e,t){var i={};t.SortBy&&(i.SortBy=t.SortBy),t.SortOrder&&(i.SortOrder=t.SortOrder);try{a.setItem(e+"_"+Dashboard.getCurrentUserId(),JSON.stringify(i))}catch(r){}},saveViewSetting:function(e,t){try{a.setItem(e+"_"+Dashboard.getCurrentUserId()+"_view",t)}catch(i){}},getSavedView:function(e){var t=a.getItem(e+"_"+Dashboard.getCurrentUserId()+"_view");return t},getSavedViewSetting:function(e){return new Promise(function(t){var a=LibraryBrowser.getSavedView(e);t(a)})},allowSwipe:function(e){function t(e){return d.parentWithTag(e,"input")?!1:e.classList?!e.classList.contains("hiddenScrollX")&&!e.classList.contains("smoothScrollX")&&!e.classList.contains("libraryViewNav"):!0}for(var a=e;null!=a;){if(!t(a))return!1;a=a.parentNode}return!0},configureSwipeTabs:function(e,t){if(m.touch){var a=e.querySelectorAll(".pageTabContent").length,i=function(i){if(LibraryBrowser.allowSwipe(i.target)&&e.contains(i.target)){var r=parseInt(t.selectedIndex()||"0");a-1>r&&t.selectedIndex(r+1)}},r=function(a){if(LibraryBrowser.allowSwipe(a.target)&&e.contains(a.target)){var i=parseInt(t.selectedIndex()||"0");i>0&&t.selectedIndex(i-1)}};require(["hammer-main"],function(t){t.on("swipeleft",i),t.on("swiperight",r),e.addEventListener("viewdestroy",function(){t.off("swipeleft",i),t.off("swiperight",r)})})}},configurePaperLibraryTabs:function(e,t,a,i){m.safari||LibraryBrowser.configureSwipeTabs(e,t),e.addEventListener("viewbeforeshow",function(){t.triggerBeforeTabChange&&null==this.firstTabIndex&&t.triggerBeforeTabChange()}),e.addEventListener("viewshow",function(){this.firstTabIndex?(t.selectedIndex(this.firstTabIndex),this.firstTabIndex=null):t.triggerTabChange()}),t.addEventListener("beforetabchange",function(e){null!=e.detail.previousIndex&&a[e.detail.previousIndex].classList.remove("is-active");var t=a[e.detail.selectedTabIndex];null!=e.detail.previousIndex&&e.detail.previousIndex!=e.detail.selectedTabIndex&&t.animate&&-1!=(i||[]).indexOf(e.detail.selectedTabIndex)&&u(t),t.classList.add("is-active")})},showTab:function(a,r){var n=function(){i.removeEventListener("pageinit",n),-1!=t.location.href.toLowerCase().indexOf(a.toLowerCase())&&(this.firstTabIndex=r)};-1!=t.location.href.toLowerCase().indexOf(a.toLowerCase())?n.call(e.currentView()):(pageClassOn("pageinit","page",n),Dashboard.navigate(a))},getArtistLinksHtml:function(e,t){for(var a=[],i=0,r=e.length;r>i;i++){var n=e[i],s=t?' class="'+t+'"':"";a.push("<a"+s+' href="itemdetails.html?id='+n.Id+'">'+n.Name+"</a>")}return a=a.join(" / ")},playInExternalPlayer:function(e){Dashboard.loadExternalPlayer().then(function(){ExternalPlayer.showMenu(e)})},getHref:function(e,t,a){var i=LibraryBrowser.getHrefInternal(e,t);return"tv"==t&&(a||(a=LibraryMenu.getTopParentId()),a&&(i+=-1==i.indexOf("?")?"?topParentId=":"&topParentId=",i+=a)),i},getHrefInternal:function(e,t){if(!e)throw new Error("item cannot be null");if(e.url)return e.url;var a=e.Id||e.ItemId;if("livetv"==e.CollectionType)return"livetv.html";if("channels"==e.CollectionType)return"channels.html";if("folders"!=t){if("movies"==e.CollectionType)return"movies.html?topParentId="+e.Id;if("boxsets"==e.CollectionType)return"itemlist.html?topParentId="+e.Id+"&parentId="+e.Id;if("tvshows"==e.CollectionType)return"tv.html?topParentId="+e.Id;if("music"==e.CollectionType)return"music.html?topParentId="+e.Id;if("games"==e.CollectionType)return a?"itemlist.html?parentId="+a:"#";if("playlists"==e.CollectionType)return"playlists.html?topParentId="+e.Id;if("photos"==e.CollectionType)return"photos.html?topParentId="+e.Id}else if(e.IsFolder)return a?"itemlist.html?parentId="+a:"#";if("CollectionFolder"==e.Type)return"itemlist.html?topParentId="+e.Id+"&parentId="+e.Id;if("PhotoAlbum"==e.Type)return"itemlist.html?context=photos&parentId="+a;if("Playlist"==e.Type)return"itemdetails.html?id="+a;if("TvChannel"==e.Type)return"itemdetails.html?id="+a;if("Channel"==e.Type)return"channelitems.html?id="+a;if(e.IsFolder&&"Channel"==e.SourceType||"ChannelFolderItem"==e.Type)return"channelitems.html?id="+e.ChannelId+"&folderId="+e.Id;if("Program"==e.Type)return"itemdetails.html?id="+a;if("BoxSet"==e.Type)return"itemdetails.html?id="+a;if("MusicAlbum"==e.Type)return"itemdetails.html?id="+a;if("GameSystem"==e.Type)return"itemdetails.html?id="+a;if("Genre"==e.Type)return"itemdetails.html?id="+a;if("MusicGenre"==e.Type)return"itemdetails.html?id="+a;if("GameGenre"==e.Type)return"itemdetails.html?id="+a;if("Studio"==e.Type)return"itemdetails.html?id="+a;if("Person"==e.Type)return"itemdetails.html?id="+a;if("Recording"==e.Type)return"itemdetails.html?id="+a;if("MusicArtist"==e.Type)return"itemdetails.html?id="+a;var i=t?"&context="+t:"";return"Series"==e.Type||"Season"==e.Type||"Episode"==e.Type?"itemdetails.html?id="+a+i:e.IsFolder?a?"itemlist.html?parentId="+a:"#":"itemdetails.html?id="+a},getListItemInfo:function(e){for(var t=e;!t.getAttribute("data-id");)t=t.parentNode;var a=t.getAttribute("data-id"),i=t.getAttribute("data-index"),r=t.getAttribute("data-mediatype");return{id:a,index:i,mediaType:r,context:t.getAttribute("data-context")}},getFutureDateText:function(e){var t=[];t[0]=Globalize.translate("OptionSunday"),t[1]=Globalize.translate("OptionMonday"),t[2]=Globalize.translate("OptionTuesday"),t[3]=Globalize.translate("OptionWednesday"),t[4]=Globalize.translate("OptionThursday"),t[5]=Globalize.translate("OptionFriday"),t[6]=Globalize.translate("OptionSaturday");var a=t[e.getDay()];return e=e.toLocaleDateString(),-1==e.toLowerCase().indexOf(a.toLowerCase())?a+" "+e:e},renderName:function(e,t,a,i){var r=n.getDisplayName(e,{includeParentInfo:!1});Dashboard.setPageTitle(r),t.innerHTML=a?'<a class="detailPageParentLink" href="'+LibraryBrowser.getHref(e,i)+'">'+r+"</a>":r},renderParentName:function(e,t,a){var i=[],r=a?"&context="+a:"";e.AlbumArtists?i.push(LibraryBrowser.getArtistLinksHtml(e.AlbumArtists,"detailPageParentLink")):e.ArtistItems&&e.ArtistItems.length&&"MusicVideo"==e.Type?i.push(LibraryBrowser.getArtistLinksHtml(e.ArtistItems,"detailPageParentLink")):e.SeriesName&&"Episode"==e.Type&&i.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.SeriesId+r+'">'+e.SeriesName+"</a>"),e.SeriesName&&"Season"==e.Type?i.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.SeriesId+r+'">'+e.SeriesName+"</a>"):null!=e.ParentIndexNumber&&"Episode"==e.Type?i.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.SeasonId+r+'">'+e.SeasonName+"</a>"):e.Album&&"Audio"==e.Type&&(e.AlbumId||e.ParentId)?i.push('<a class="detailPageParentLink" href="itemdetails.html?id='+(e.AlbumId||e.ParentId)+r+'">'+e.Album+"</a>"):e.Album&&"MusicVideo"==e.Type&&e.AlbumId?i.push('<a class="detailPageParentLink" href="itemdetails.html?id='+e.AlbumId+r+'">'+e.Album+"</a>"):e.Album?i.push(e.Album):"Program"==e.Type&&e.EpisodeTitle&&i.push(e.Name),i.length?(t.classList.remove("hide"),t.innerHTML=i.join(" - ")):t.classList.add("hide")},showLayoutMenu:function(e,a,i){var r=!0;i||(r=!1,i=e.getAttribute("data-layouts"),i=i?i.split(","):["List","Poster","PosterCard","Thumb","ThumbCard"]);var n=i.map(function(e){return{name:Globalize.translate("Option"+e),id:e,selected:a==e}});require(["actionsheet"],function(a){a.show({items:n,positionTo:e,callback:function(a){e.dispatchEvent(new CustomEvent("layoutchange",{detail:{viewStyle:a},bubbles:!0,cancelable:!1})),r||t.$&&$(e).trigger("layoutchange",[a])}})})},getQueryPagingHtml:function(e){var t=e.startIndex,i=e.limit,r=e.totalRecordCount;if(i&&e.updatePageSizeSetting!==!1)try{a.setItem(e.pageSizeKey||s,i)}catch(n){}var l="",o=Math.min(t+i,r),d=r>20||r>i;if(l+='<div class="listPaging">',d){l+='<span style="vertical-align:middle;">';var m=r?t+1:0;l+=m+"-"+o+" of "+r,l+="</span>"}if((d||e.viewButton||e.filterButton||e.sortButton||e.addLayoutButton)&&(l+='<div style="display:inline-block;">',d&&(l+='<button is="paper-icon-button-light" class="btnPreviousPage autoSize" '+(t?"":"disabled")+'><i class="md-icon">&#xE5C4;</i></button>',l+='<button is="paper-icon-button-light" class="btnNextPage autoSize" '+(t+i>=r?"disabled":"")+'><i class="md-icon">arrow_forward</i></button>'),e.addLayoutButton&&(l+='<button is="paper-icon-button-light" title="'+Globalize.translate("ButtonSelectView")+'" class="btnChangeLayout autoSize" data-layouts="'+(e.layouts||"")+'" onclick="LibraryBrowser.showLayoutMenu(this, \''+(e.currentLayout||"")+'\');"><i class="md-icon">view_comfy</i></button>'),e.sortButton&&(l+='<button is="paper-icon-button-light" class="btnSort autoSize" title="'+Globalize.translate("ButtonSort")+'"><i class="md-icon">sort_by_alpha</i></button>'),e.filterButton&&(l+='<button is="paper-icon-button-light" class="btnFilter autoSize" title="'+Globalize.translate("ButtonFilter")+'"><i class="md-icon">filter_list</i></button>'),l+="</div>",d&&e.showLimit)){var u="selectPageSize",c=e.pageSizes||[20,50,100,200,300,400,500],g=c.map(function(e){return i==e?'<option value="'+e+'" selected="selected">'+e+"</option>":'<option value="'+e+'">'+e+"</option>"}).join("");l+='<div class="pageSizeContainer"><label class="labelPageSize" for="'+u+'">'+Globalize.translate("LabelLimit")+'</label><select style="width:auto;" class="selectPageSize" id="'+u+'" data-inline="true" data-mini="true">'+g+"</select></div>"}return l+="</div>"},showSortMenu:function(e){require(["dialogHelper","emby-radio"],function(t){function a(){var t=this.value;if(this.checked){var a=e.query.SortBy!=t;e.query.SortBy=t.replace("_",","),e.query.StartIndex=0,e.callback&&a&&e.callback()}}function r(){var t=this.value;if(this.checked){var a=e.query.SortOrder!=t;e.query.SortOrder=t,e.query.StartIndex=0,e.callback&&a&&e.callback()}}var n=t.createDialog({removeOnClose:!0,modal:!1,entryAnimationDuration:160,exitAnimationDuration:200});n.classList.add("ui-body-a"),n.classList.add("background-theme-a"),n.classList.add("formDialog");var s="";s+='<div style="margin:0;padding:1.25em 1.5em 1.5em;">',s+='<h2 style="margin:0 0 .5em;">',s+=Globalize.translate("HeaderSortBy"),s+="</h2>";var l,o,d;for(s+="<div>",l=0,o=e.items.length;o>l;l++){var u=e.items[l],c=u.id.replace(",","_");d=(e.query.SortBy||"").replace(",","_")==c?" checked":"",s+='<label class="radio-label-block"><input type="radio" is="emby-radio" name="SortBy" data-id="'+u.id+'" value="'+c+'" class="menuSortBy" '+d+" /><span>"+u.name+"</span></label>"}s+="</div>",s+='<h2 style="margin: 1em 0 .5em;">',s+=Globalize.translate("HeaderSortOrder"),s+="</h2>",s+="<div>",d="Ascending"==e.query.SortOrder?" checked":"",s+='<label class="radio-label-block"><input type="radio" is="emby-radio" name="SortOrder" value="Ascending" class="menuSortOrder" '+d+" /><span>"+Globalize.translate("OptionAscending")+"</span></label>",d="Descending"==e.query.SortOrder?" checked":"",s+='<label class="radio-label-block"><input type="radio" is="emby-radio" name="SortOrder" value="Descending" class="menuSortOrder" '+d+" /><span>"+Globalize.translate("OptionDescending")+"</span></label>",s+="</div>",s+="</div>",n.innerHTML=s,i.body.appendChild(n);var g=m.animate?0:100;setTimeout(function(){t.open(n)},g);var p=n.querySelectorAll(".menuSortBy");for(l=0,o=p.length;o>l;l++)p[l].addEventListener("change",a);var h=n.querySelectorAll(".menuSortOrder");for(l=0,o=h.length;o>l;l++)h[l].addEventListener("change",r)})},renderDetailImage:function(e,t,a,i){var r=t.ImageTags||{};t.PrimaryImageTag&&(r.Primary=t.PrimaryImageTag);var n,s="",l="portrait",d=360,m=!1;i&&r.Thumb?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Thumb",maxHeight:d,tag:t.ImageTags.Thumb}),l="thumb"):r.Primary?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Primary",maxHeight:d,tag:t.ImageTags.Primary}),m=!0):t.BackdropImageTags&&t.BackdropImageTags.length?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Backdrop",maxHeight:d,tag:t.BackdropImageTags[0]}),l="thumb"):r.Thumb?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Thumb",maxHeight:d,tag:t.ImageTags.Thumb}),l="thumb"):r.Disc?(n=ApiClient.getScaledImageUrl(t.Id,{type:"Disc",maxHeight:d,tag:t.ImageTags.Disc}),l="square"):t.AlbumId&&t.AlbumPrimaryImageTag?(n=ApiClient.getScaledImageUrl(t.AlbumId,{type:"Primary",maxHeight:d,tag:t.AlbumPrimaryImageTag}),l="square"):"Audio"==t.MediaType||"MusicAlbum"==t.Type||"MusicGenre"==t.Type?(n="css/images/items/detail/audio.png",l="square"):"Game"==t.MediaType||"GameGenre"==t.Type?(n="css/images/items/detail/game.png",l="square"):"Person"==t.Type?(n="css/images/items/detail/person.png",l="square"):"Genre"==t.Type||"Studio"==t.Type?(n="css/images/items/detail/video.png",l="square"):"TvChannel"==t.Type?(n="css/images/items/detail/tv.png",l="square"):(n="css/images/items/detail/video.png",l="square"),s+='<div style="position:relative;">',a&&(s+="<a class='itemDetailGalleryLink' href='#'>"),m&&t.PrimaryImageAspectRatio&&(t.PrimaryImageAspectRatio>=1.48?l="thumb":t.PrimaryImageAspectRatio>=.85&&t.PrimaryImageAspectRatio<=1.34&&(l="square")),s+="<img class='itemDetailImage lazy' src='css/images/empty.png' />",a&&(s+="</a>");var u=t.IsFolder||!t.UserData?"":o.getProgressBarHtml(t);s+='<div class="detailImageProgressContainer">',u&&(s+=u),s+="</div>",s+="</div>",e.innerHTML=s,"thumb"==l?(e.classList.add("thumbDetailImageContainer"),e.classList.remove("portraitDetailImageContainer"),e.classList.remove("squareDetailImageContainer")):"square"==l?(e.classList.remove("thumbDetailImageContainer"),e.classList.remove("portraitDetailImageContainer"),e.classList.add("squareDetailImageContainer")):(e.classList.remove("thumbDetailImageContainer"),e.classList.add("portraitDetailImageContainer"),e.classList.remove("squareDetailImageContainer"));var c=e.querySelector("img");c.onload=function(){-1==c.src.indexOf("empty.png")&&c.classList.add("loaded")},ImageLoader.lazyImage(c,n)},renderDetailPageBackdrop:function(e,t){var a,i=r.availWidth,n=!1,s=e.querySelector("#itemBackdrop");return t.BackdropImageTags&&t.BackdropImageTags.length?(a=ApiClient.getScaledImageUrl(t.Id,{type:"Backdrop",index:0,maxWidth:i,tag:t.BackdropImageTags[0]}),s.classList.remove("noBackdrop"),ImageLoader.lazyImage(s,a,!1),n=!0):t.ParentBackdropItemId&&t.ParentBackdropImageTags&&t.ParentBackdropImageTags.length?(a=ApiClient.getScaledImageUrl(t.ParentBackdropItemId,{type:"Backdrop",index:0,tag:t.ParentBackdropImageTags[0],maxWidth:i}),s.classList.remove("noBackdrop"),ImageLoader.lazyImage(s,a,!1),n=!0):(s.classList.add("noBackdrop"),s.style.backgroundImage=""),n}};return l}(window,document,screen);return window.LibraryBrowser=c,c});