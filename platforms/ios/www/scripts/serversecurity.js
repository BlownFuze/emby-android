define(["jQuery"],function(e){function t(e,t){require(["confirm"],function(a){a(Globalize.translate("MessageConfirmRevokeApiKey"),Globalize.translate("HeaderConfirmRevokeApiKey")).then(function(){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Auth/Keys/"+t)}).then(function(){n(e)})})})}function a(a,n,i){var r=n.map(function(e){var t="";t+="<tr>",t+="<td>",t+='<button data-token="'+e.AccessToken+'" class="btnRevoke" data-mini="true" title="'+Globalize.translate("ButtonRevoke")+'" style="margin:0;">'+Globalize.translate("ButtonRevoke")+"</button>",t+="</td>",t+='<td style="vertical-align:middle;">',t+=e.AccessToken,t+="</td>",t+='<td style="vertical-align:middle;">',t+=e.AppName||"",t+="</td>",t+='<td style="vertical-align:middle;">',t+=e.DeviceName||"",t+="</td>",t+='<td style="vertical-align:middle;">';var a=i.filter(function(t){return t.Id==e.UserId})[0];a&&(t+=a.Name),t+="</td>",t+='<td style="vertical-align:middle;">';var n=parseISO8601Date(e.DateCreated,{toLocal:!0});return t+=n.toLocaleDateString()+" "+LibraryBrowser.getDisplayTime(n),t+="</td>",t+="</tr>"}).join(""),l=e(".resultBody",a).html(r).parents(".tblApiKeys").table("refresh").trigger("create");e(".btnRevoke",l).on("click",function(){t(a,this.getAttribute("data-token"))}),Dashboard.hideLoadingMsg()}function n(e){Dashboard.showLoadingMsg(),ApiClient.getUsers().then(function(t){ApiClient.getJSON(ApiClient.getUrl("Auth/Keys")).then(function(n){a(e,n.Items,t)})})}function i(e){require(["prompt"],function(t){t({title:Globalize.translate("HeaderNewApiKey"),label:Globalize.translate("LabelAppName"),description:Globalize.translate("LabelAppNameExample")}).then(function(t){ApiClient.ajax({type:"POST",url:ApiClient.getUrl("Auth/Keys",{App:t})}).then(function(){n(e)})})})}function r(){return[{href:"dashboardhosting.html",name:Globalize.translate("TabHosting")},{href:"serversecurity.html",name:Globalize.translate("TabSecurity")}]}pageIdOn("pageinit","serverSecurityPage",function(){var t=this;e(".btnNewKey",t).on("click",function(){i(t)})}),pageIdOn("pagebeforeshow","serverSecurityPage",function(){LibraryMenu.setTabs("adminadvanced",1,r);var e=this;n(e)})});