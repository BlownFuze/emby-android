define([],function(){function i(){var i=this;i.getNotificationsSummaryPromise=null,i.total=0,i.getNotificationsSummary=function(){var t=window.ApiClient;if(t)return i.getNotificationsSummaryPromise=i.getNotificationsSummaryPromise||t.getNotificationSummary(Dashboard.getCurrentUserId()),i.getNotificationsSummaryPromise},i.updateNotificationCount=function(){if(Dashboard.getCurrentUserId()&&window.ApiClient){var t=i.getNotificationsSummary();t&&t.then(function(i){var t=document.querySelector(".btnNotificationsInner");t&&(t.classList.remove("levelNormal"),t.classList.remove("levelWarning"),t.classList.remove("levelError"),t.innerHTML=i.UnreadCount,i.UnreadCount&&t.classList.add("level"+i.MaxUnreadNotificationLevel))})}},i.markNotificationsRead=function(t,e){ApiClient.markNotificationsRead(Dashboard.getCurrentUserId(),t,!0).then(function(){i.getNotificationsSummaryPromise=null,i.updateNotificationCount(),e&&e()})},i.showNotificationsList=function(i,e,n){t(i,e,n,!0)}}function t(i,t,n,o){var a=window.ApiClient;return a?a.getNotifications(Dashboard.getCurrentUserId(),{StartIndex:i,Limit:t}).then(function(a){e(a.Notifications,a.TotalRecordCount,i,t,n,o)}):void 0}function e(i,t,e,o,a,r){if(!t)return void a.html('<p style="padding:.5em 1em;">'+Globalize.translate("LabelNoUnreadNotifications")+"</p>");Notifications.total=t;var s="";if(t>o&&r===!0){var c={StartIndex:e,Limit:o};s+=LibraryBrowser.getQueryPagingHtml({startIndex:c.StartIndex,limit:c.Limit,totalRecordCount:t,showLimit:!1,updatePageSizeSetting:!1})}require(["humanedate","paper-fab","paper-item-body","paper-icon-item"],function(){for(var t=0,e=i.length;e>t;t++){var o=i[t];s+=n(o)}a.html(s).trigger("create")})}function n(i){var t="";return i.Url&&(t+='<a class="clearLink" href="'+i.Url+'" target="_blank">'),t+="<paper-icon-item>",t+="Error"==i.Level?'<paper-fab mini class="" style="background:#cc3333;" icon="error" item-icon></paper-fab>':'<paper-fab mini  class="blue" icon="dvr" item-icon></paper-fab>',t+="<paper-item-body three-line>",t+="<div>",t+=i.Name,t+="</div>",t+="<div secondary>",t+=humane_date(i.Date),t+="</div>",i.Description&&(t+="<div secondary>",t+=i.Description,t+="</div>"),t+="</paper-item-body>",t+="</paper-icon-item>",i.Url&&(t+="</a>"),t}function o(i,t){("NotificationUpdated"===t.MessageType||"NotificationAdded"===t.MessageType||"NotificationsMarkedRead"===t.MessageType)&&(Notifications.getNotificationsSummaryPromise=null,Notifications.updateNotificationCount())}function a(i){Events.off(i,"websocketmessage",o),Events.on(i,"websocketmessage",o)}window.Notifications=new i;var r=!0;window.ApiClient&&a(window.ApiClient),Events.on(ConnectionManager,"apiclientcreated",function(i,t){a(t)}),Events.on(ConnectionManager,"localusersignedin",function(){r=!0}),Events.on(ConnectionManager,"localusersignedout",function(){r=!0}),pageClassOn("pageshow","type-interior",function(){r&&Notifications.updateNotificationCount()})});