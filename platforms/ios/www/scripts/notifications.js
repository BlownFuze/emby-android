!function(i,t,e,n){function o(){var t=this;t.getNotificationsSummaryPromise=null,t.total=0,t.getNotificationsSummary=function(){var i=window.ApiClient;if(i)return t.getNotificationsSummaryPromise=t.getNotificationsSummaryPromise||i.getNotificationSummary(e.getCurrentUserId()),t.getNotificationsSummaryPromise},t.updateNotificationCount=function(){if(e.getCurrentUserId()&&window.ApiClient){var n=t.getNotificationsSummary();n&&n.then(function(t){var e=i(".btnNotificationsInner").removeClass("levelNormal").removeClass("levelWarning").removeClass("levelError").html(t.UnreadCount);t.UnreadCount&&e.addClass("level"+t.MaxUnreadNotificationLevel)})}},t.markNotificationsRead=function(i,n){ApiClient.markNotificationsRead(e.getCurrentUserId(),i,!0).then(function(){t.getNotificationsSummaryPromise=null,t.updateNotificationCount(),n&&n()})},t.showNotificationsList=function(i,t,e){a(i,t,e,!0)}}function a(i,t,n,o){var a=window.ApiClient;return a?a.getNotifications(e.getCurrentUserId(),{StartIndex:i,Limit:t}).then(function(e){r(e.Notifications,e.TotalRecordCount,i,t,n,o)}):void 0}function r(i,t,e,o,a,r){if(!t)return void a.html('<p style="padding:.5em 1em;">'+Globalize.translate("LabelNoUnreadNotifications")+"</p>");Notifications.total=t;var c="";if(t>o&&r===!0){var u={StartIndex:e,Limit:o};c+=n.getQueryPagingHtml({startIndex:u.StartIndex,limit:u.Limit,totalRecordCount:t,showLimit:!1,updatePageSizeSetting:!1})}require(["humanedate","paper-fab","paper-item-body","paper-icon-item"],function(){for(var t=0,e=i.length;e>t;t++){var n=i[t];c+=s(n)}a.html(c).trigger("create")})}function s(i){var t="";return i.Url&&(t+='<a class="clearLink" href="'+i.Url+'" target="_blank">'),t+="<paper-icon-item>",t+="Error"==i.Level?'<paper-fab mini class="" style="background:#cc3333;" icon="error" item-icon></paper-fab>':'<paper-fab mini  class="blue" icon="dvr" item-icon></paper-fab>',t+="<paper-item-body three-line>",t+="<div>",t+=i.Name,t+="</div>",t+="<div secondary>",t+=humane_date(i.Date),t+="</div>",i.Description&&(t+="<div secondary>",t+=i.Description,t+="</div>"),t+="</paper-item-body>",t+="</paper-icon-item>",i.Url&&(t+="</a>"),t}function c(i,t){("NotificationUpdated"===t.MessageType||"NotificationAdded"===t.MessageType||"NotificationsMarkedRead"===t.MessageType)&&(Notifications.getNotificationsSummaryPromise=null,Notifications.updateNotificationCount())}function u(t){i(t).off("websocketmessage",c).on("websocketmessage",c)}window.Notifications=new o;var f=!0;window.ApiClient&&u(window.ApiClient),i(ConnectionManager).on("apiclientcreated",function(i,t){u(t)}),Events.on(ConnectionManager,"localusersignedin",function(){f=!0}),Events.on(ConnectionManager,"localusersignedout",function(){f=!0}),pageClassOn("pageshow","type-interior",function(){f&&Notifications.updateNotificationCount()})}(jQuery,document,Dashboard,LibraryBrowser);