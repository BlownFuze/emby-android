!function(i,t,e){function n(){var t=this;t.getNotificationsSummaryPromise=null,t.total=0,t.getNotificationsSummary=function(){var i=window.ApiClient;if(i)return t.getNotificationsSummaryPromise=t.getNotificationsSummaryPromise||i.getNotificationSummary(e.getCurrentUserId()),t.getNotificationsSummaryPromise},t.updateNotificationCount=function(){if(e.getCurrentUserId()&&window.ApiClient){var n=t.getNotificationsSummary();n&&n.then(function(t){var e=i(".btnNotificationsInner").removeClass("levelNormal").removeClass("levelWarning").removeClass("levelError").html(t.UnreadCount);t.UnreadCount&&e.addClass("level"+t.MaxUnreadNotificationLevel)})}},t.markNotificationsRead=function(i,n){ApiClient.markNotificationsRead(e.getCurrentUserId(),i,!0).then(function(){t.getNotificationsSummaryPromise=null,t.updateNotificationCount(),n&&n()})},t.showNotificationsList=function(i,t,e){o(i,t,e,!0)}}function o(i,t,n,o){var r=window.ApiClient;return r?r.getNotifications(e.getCurrentUserId(),{StartIndex:i,Limit:t}).then(function(e){a(e.Notifications,e.TotalRecordCount,i,t,n,o)}):void 0}function a(i,t,e,n,o,a){if(!t)return void o.html('<p style="padding:.5em 1em;">'+Globalize.translate("LabelNoUnreadNotifications")+"</p>");Notifications.total=t;var s="";if(t>n&&a===!0){var c={StartIndex:e,Limit:n};s+=LibraryBrowser.getQueryPagingHtml({startIndex:c.StartIndex,limit:c.Limit,totalRecordCount:t,showLimit:!1,updatePageSizeSetting:!1})}require(["humanedate","paper-fab","paper-item-body","paper-icon-item"],function(){for(var t=0,e=i.length;e>t;t++){var n=i[t];s+=r(n)}o.html(s).trigger("create")})}function r(i){var t="";return i.Url&&(t+='<a class="clearLink" href="'+i.Url+'" target="_blank">'),t+="<paper-icon-item>",t+="Error"==i.Level?'<paper-fab mini class="" style="background:#cc3333;" icon="error" item-icon></paper-fab>':'<paper-fab mini  class="blue" icon="dvr" item-icon></paper-fab>',t+="<paper-item-body three-line>",t+="<div>",t+=i.Name,t+="</div>",t+="<div secondary>",t+=humane_date(i.Date),t+="</div>",i.Description&&(t+="<div secondary>",t+=i.Description,t+="</div>"),t+="</paper-item-body>",t+="</paper-icon-item>",i.Url&&(t+="</a>"),t}function s(i,t){("NotificationUpdated"===t.MessageType||"NotificationAdded"===t.MessageType||"NotificationsMarkedRead"===t.MessageType)&&(Notifications.getNotificationsSummaryPromise=null,Notifications.updateNotificationCount())}function c(i){Events.off(i,"websocketmessage",s),Events.on(i,"websocketmessage",s)}window.Notifications=new n;var u=!0;window.ApiClient&&c(window.ApiClient),Events.on(ConnectionManager,"apiclientcreated",function(i,t){c(t)}),Events.on(ConnectionManager,"localusersignedin",function(){u=!0}),Events.on(ConnectionManager,"localusersignedout",function(){u=!0}),pageClassOn("pageshow","type-interior",function(){u&&Notifications.updateNotificationCount()})}(jQuery,document,Dashboard);