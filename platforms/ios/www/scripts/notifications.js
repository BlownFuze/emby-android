define(["libraryBrowser","listViewStyle"],function(t){function i(){var t=this;t.getNotificationsSummaryPromise=null,t.total=0,t.getNotificationsSummary=function(){var i=window.ApiClient;if(i)return t.getNotificationsSummaryPromise=t.getNotificationsSummaryPromise||i.getNotificationSummary(Dashboard.getCurrentUserId()),t.getNotificationsSummaryPromise},t.updateNotificationCount=function(){if(Dashboard.getCurrentUserId()&&window.ApiClient){var i=t.getNotificationsSummary();i&&i.then(function(t){var i=document.querySelector(".btnNotificationsInner");i&&(i.classList.remove("levelNormal"),i.classList.remove("levelWarning"),i.classList.remove("levelError"),i.innerHTML=t.UnreadCount,t.UnreadCount&&i.classList.add("level"+t.MaxUnreadNotificationLevel))})}},t.markNotificationsRead=function(i,e){ApiClient.markNotificationsRead(Dashboard.getCurrentUserId(),i,!0).then(function(){t.getNotificationsSummaryPromise=null,t.updateNotificationCount(),e&&e()})},t.showNotificationsList=function(t,i,n){e(t,i,n,!0)}}function e(t,i,e,o){var a=window.ApiClient;return a?a.getNotifications(Dashboard.getCurrentUserId(),{StartIndex:t,Limit:i}).then(function(a){n(a.Notifications,a.TotalRecordCount,t,i,e,o)}):void 0}function n(i,e,n,a,r,s){if(!e)return void r.html('<p style="padding:.5em 1em;">'+Globalize.translate("LabelNoUnreadNotifications")+"</p>");Notifications.total=e;var c="";if(e>a&&s===!0){var l={StartIndex:n,Limit:a};c+=t.getQueryPagingHtml({startIndex:l.StartIndex,limit:l.Limit,totalRecordCount:e,showLimit:!1,updatePageSizeSetting:!1})}require(["humanedate"],function(){for(var t=0,e=i.length;e>t;t++){var n=i[t];c+=o(n)}r.html(c).trigger("create")})}function o(t){var i="";return t.Url&&(i+='<a class="clearLink" href="'+t.Url+'" target="_blank">'),i+='<div class="listItem">',i+="Error"==t.Level?'<i class="listItemIcon md-icon" style="background:#cc3333;">error</i>':'<i class="listItemIcon md-icon">dvr</i>',i+='<div class="listItemBody three-line">',i+='<h3 class="listItemBodyText">',i+=t.Name,i+="</h3>",i+='<div class="listItemBodyText secondary">',i+=humane_date(t.Date),i+="</div>",t.Description&&(i+='<div class="listItemBodyText secondary listItemBodyText-nowrap">',i+=t.Description,i+="</div>"),i+="</div>",i+="</div>",t.Url&&(i+="</a>"),i}function a(t,i){("NotificationUpdated"===i.MessageType||"NotificationAdded"===i.MessageType||"NotificationsMarkedRead"===i.MessageType)&&(Notifications.getNotificationsSummaryPromise=null,Notifications.updateNotificationCount())}function r(t){Events.off(t,"websocketmessage",a),Events.on(t,"websocketmessage",a)}window.Notifications=new i;var s=!0;window.ApiClient&&r(window.ApiClient),Events.on(ConnectionManager,"apiclientcreated",function(t,i){r(i)}),Events.on(ConnectionManager,"localusersignedin",function(){s=!0}),Events.on(ConnectionManager,"localusersignedout",function(){s=!0}),pageClassOn("pageshow","type-interior",function(){s&&Notifications.updateNotificationCount()})});