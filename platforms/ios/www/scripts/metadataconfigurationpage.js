define(["jQuery","fnchecked"],function(e){function a(a,n,t,o){n&&t&&o&&(a.querySelector("#chkEnableInternetProviders").checked=n.EnableInternetProviders,a.querySelector("#chkSaveLocal").checked=n.SaveLocalMeta,e("#selectLanguage",a).val(n.PreferredMetadataLanguage),e("#selectCountry",a).val(n.MetadataCountryCode),e("#chkDownloadImagesInAdvance",a).checked(n.DownloadImagesInAdvance),Dashboard.hideLoadingMsg())}function n(){var a=this;return Dashboard.showLoadingMsg(),ApiClient.getServerConfiguration().then(function(n){n.EnableInternetProviders=a.querySelector("#chkEnableInternetProviders").checked,n.SaveLocalMeta=a.querySelector("#chkSaveLocal").checked,n.PreferredMetadataLanguage=e("#selectLanguage",a).val(),n.MetadataCountryCode=e("#selectCountry",a).val(),n.DownloadImagesInAdvance=e("#chkDownloadImagesInAdvance",a).checked(),ApiClient.updateServerConfiguration(n).then(function(){Dashboard.processServerConfigurationUpdateResult(),t(n)})}),!1}function t(e){var a=[];a.push(Globalize.translate("MetadataSettingChangeHelp")),e.DownloadImagesInAdvance&&a.push(Globalize.translate("DownloadImagesInAdvanceWarning")),a.length&&require(["alert"],function(e){e({text:a.join("<br/><br/>")})})}function o(){return[{href:"metadata.html",name:Globalize.translate("TabSettings")},{href:"metadataimages.html",name:Globalize.translate("TabServices")},{href:"metadatanfo.html",name:Globalize.translate("TabNfoSettings")}]}e(document).on("pageinit","#metadataConfigurationPage",function(){Dashboard.showLoadingMsg(),e(".metadataConfigurationForm").off("submit",n).on("submit",n)}).on("pageshow","#metadataConfigurationPage",function(){function e(e,a){var n="";n+="<option value=''></option>";for(var t=0,o=a.length;o>t;t++){var r=a[t];n+="<option value='"+r.TwoLetterISOLanguageName+"'>"+r.DisplayName+"</option>"}e.innerHTML=n}function n(e,a){var n="";n+="<option value=''></option>";for(var t=0,o=a.length;o>t;t++){var r=a[t];n+="<option value='"+r.TwoLetterISORegionName+"'>"+r.DisplayName+"</option>"}e.innerHTML=n}LibraryMenu.setTabs("metadata",0,o),Dashboard.showLoadingMsg();var t,r,i,l=this;ApiClient.getServerConfiguration().then(function(e){t=e,a(l,t,r,i)}),ApiClient.getCultures().then(function(n){e(l.querySelector("#selectLanguage"),n),r=n,a(l,t,r,i)}),ApiClient.getCountries().then(function(e){n(l.querySelector("#selectCountry"),e),i=e,a(l,t,r,i)})})});