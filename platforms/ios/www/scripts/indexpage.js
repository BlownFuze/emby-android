define(["libraryBrowser","jQuery"],function(e,t){function r(e){if(AppInfo.isNativeApp&&browserInfo.safari)switch(e){case 0:return d;case 1:return"resume";case 2:return"nextup";case 3:return"latestmovies";case 4:return"latestepisodes";case 5:return"latesttvrecordings";default:return""}switch(e){case 0:return d;case 1:return"resume";case 2:return"latestmedia";case 3:return"latesttvrecordings";default:return""}}function a(e,t,a,s){var i=t.Id,o=a.CustomPrefs["home"+s]||r(s);"folders"==o&&(o=d);var n="0"!=a.CustomPrefs.enableLibraryTileNames,l=e.querySelector(".section"+s);return"latestmedia"==o?Sections.loadRecentlyAdded(l,t):"latestmovies"==o?Sections.loadLatestMovies(l,t):"latestepisodes"==o?Sections.loadLatestEpisodes(l,t):"librarytiles"==o?Sections.loadLibraryTiles(l,t,"backdrop",s,!1,n):"smalllibrarytiles"==o?Sections.loadLibraryTiles(l,t,"homePageSmallBackdrop",s,!1,n):"smalllibrarytiles-automobile"==o?Sections.loadLibraryTiles(l,t,"homePageSmallBackdrop",s,!0,n):"librarytiles-automobile"==o?Sections.loadLibraryTiles(l,t,"backdrop",s,!0,n):"librarybuttons"==o?Sections.loadlibraryButtons(l,i,s):"resume"==o?Sections.loadResume(l,i):"nextup"==o?Sections.loadNextUp(l,i):"latesttvrecordings"==o?Sections.loadLatestLiveTvRecordings(l,i):"latestchannelmedia"==o?Sections.loadLatestChannelMedia(l,i):(l.innerHTML="",new Promise(function(e){e()}))}function s(e,t,r){var s,i,o=6,n=e.querySelector(".sections");if(!n.innerHTML.length){var l="";for(s=0,i=o;i>s;s++)l+='<div class="homePageSection section'+s+'"></div>';n.innerHTML=l}var u=[];for(s=0,i=o;i>s;s++)u.push(a(e,t,r,s));return Promise.all(u)}function i(){return AppInfo.isNativeApp?"Emby Mobile":"webclient"}function o(e,t){b("home",t).then(function(e){e.CustomPrefs[g]=m,ApiClient.updateDisplayPreferences("home",e,t,i())})}function n(e,r){if(r.CustomPrefs[g]==m)t(".welcomeMessage",e).hide();else{Dashboard.hideLoadingMsg();var a=t(".welcomeMessage",e).show();r.CustomPrefs[g]?(t(".tourHeader",a).html(Globalize.translate("HeaderWelcomeBack")),t(".tourButtonText",a).html(Globalize.translate("ButtonTakeTheTourToSeeWhatsNew"))):(t(".tourHeader",a).html(Globalize.translate("HeaderWelcomeToProjectWebClient")),t(".tourButtonText",a).html(Globalize.translate("ButtonTakeTheTour")))}}function l(e,r){require(["slideshow"],function(){var a=[{imageUrl:"css/images/tour/web/tourcontent.jpg",title:Globalize.translate("WebClientTourContent")},{imageUrl:"css/images/tour/web/tourmovies.jpg",title:Globalize.translate("WebClientTourMovies")},{imageUrl:"css/images/tour/web/tourmouseover.jpg",title:Globalize.translate("WebClientTourMouseOver")},{imageUrl:"css/images/tour/web/tourtaphold.jpg",title:Globalize.translate("WebClientTourTapHold")},{imageUrl:"css/images/tour/web/tourmysync.png",title:Globalize.translate("WebClientTourMySync")},{imageUrl:"css/images/tour/web/toureditor.png",title:Globalize.translate("WebClientTourMetadataManager")},{imageUrl:"css/images/tour/web/tourplaylist.png",title:Globalize.translate("WebClientTourPlaylists")},{imageUrl:"css/images/tour/web/tourcollections.jpg",title:Globalize.translate("WebClientTourCollections")},{imageUrl:"css/images/tour/web/tourusersettings1.png",title:Globalize.translate("WebClientTourUserPreferences1")},{imageUrl:"css/images/tour/web/tourusersettings2.png",title:Globalize.translate("WebClientTourUserPreferences2")},{imageUrl:"css/images/tour/web/tourusersettings3.png",title:Globalize.translate("WebClientTourUserPreferences3")},{imageUrl:"css/images/tour/web/tourusersettings4.png",title:Globalize.translate("WebClientTourUserPreferences4")},{imageUrl:"css/images/tour/web/tourmobile1.jpg",title:Globalize.translate("WebClientTourMobile1")},{imageUrl:"css/images/tour/web/tourmobile2.png",title:Globalize.translate("WebClientTourMobile2")},{imageUrl:"css/images/tour/enjoy.jpg",title:Globalize.translate("MessageEnjoyYourStay")}];require(["slideshow"],function(s){var i=new s({slides:a,interactive:!0,loop:!1});i.show(),o(e,r),t(".welcomeMessage",e).hide()})})}function u(t,r){if(e.needsRefresh(r)&&window.ApiClient){var a=Dashboard.getCurrentUserId();Dashboard.showLoadingMsg(),b("home",a).then(function(a){Dashboard.getCurrentUser().then(function(i){s(r,i,a).then(function(){AppInfo.isNativeApp||n(t,a),Dashboard.hideLoadingMsg(),e.setLastRefreshed(r)})})})}}function c(r,a){if(a.NowPlayingItem&&"Video"==a.NowPlayingItem.MediaType){var s=t.mobile.activePage,i=s.querySelector(".pageTabsContainer");i.dispatchEvent(new CustomEvent("tabchange",{detail:{selectedTabIndex:e.selectedTab(i)}}))}}function b(e,t){return ApiClient.getDisplayPreferences(e,t,i())}var d="smalllibrarytiles",m="14",g="homePageTour";return function(t,r){function a(e,a){var i=e.querySelector(".pageTabContent[data-index='"+a+"']"),l=[];switch(a){case 0:l.push("scripts/sections");break;case 1:l.push("scripts/homenextup");break;case 2:l.push("scripts/homefavorites");break;case 3:l.push("scripts/homeupcoming");break;default:return}require(l,function(e){0==a&&(s.tabContent=i);var l=o[a];l||(l=a?new e(t,r,i):s,o[a]=l,l.initTab&&l.initTab()),-1==n.indexOf(a)&&(n.push(a),l.renderTab())})}var s=this;s.renderTab=function(){var e=t.querySelector(".pageTabContent[data-index='0']");u(t,e)};var i=t.querySelector(".pageTabsContainer");e.configurePaperLibraryTabs(t,t.querySelector("paper-tabs"),i,"home.html");var o=[],n=[];i.addEventListener("tabchange",function(e){a(t,parseInt(e.detail.selectedTabIndex))}),t.querySelector(".btnTakeTour").addEventListener("click",function(){l(t,Dashboard.getCurrentUserId())}),AppInfo.enableHomeTabs?(t.classList.remove("noSecondaryNavPage"),t.querySelector(".libraryViewNav").classList.remove("hide")):(t.classList.add("noSecondaryNavPage"),t.querySelector(".libraryViewNav").classList.add("hide")),t.addEventListener("viewshow",function(){Events.on(MediaController,"playbackstop",c)}),t.addEventListener("viewbeforehide",function(){Events.off(MediaController,"playbackstop",c)})}});