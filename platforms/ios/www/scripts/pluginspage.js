define(["jQuery"],function(a){function n(a,n,e){var i=Globalize.translate("UninstallPluginConfirmation").replace("{0}",e);require(["confirm"],function(e){e(i,Globalize.translate("UninstallPluginHeader")).then(function(){Dashboard.showLoadingMsg(),ApiClient.uninstallPlugin(n).then(function(){r(a)})})})}function e(){Dashboard.alert({message:Globalize.translate("NoPluginConfigurationMessage")})}function i(){Dashboard.alert({message:Globalize.translate("MessagePluginConfigurationRequiresLocalAccess")})}function t(n,e){var i=a.grep(e,function(a){return a.PluginId==n.Id})[0],t="",l=Dashboard.isConnectMode(),o=i?Dashboard.getConfigurationPageUrl(i.Name):null,s=i&&!l?o:null;return t+="<div data-id='"+n.Id+"' data-name='"+n.Name+"' class='card backdropCard bottomPaddedCard'>",t+='<div class="cardBox visualCardBox">',t+='<div class="cardScalable">',t+='<div class="cardPadder"></div>',t+=s?'<a class="cardContent" href="'+s+'">':o?l?'<div class="cardContent connectModePluginCard">':'<div class="cardContent">':'<div class="cardContent noConfigPluginCard noHoverEffect">',t+=n.ImageUrl?'<div class="cardImage" style="background-image:url(\''+n.ImageUrl+"');\">":'<div class="cardImage" style="background-image:url(\'css/images/items/list/collection.png\');">',t+="</div>",t+=s?"</a>":"</div>",t+="</div>",t+='<div class="cardFooter">',t+='<div class="cardText" style="text-align:right; float:right;padding-top:5px;">',t+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="btnCardMenu"></paper-icon-button>',t+="</div>",t+="<div class='cardText'>",t+=n.Name,t+="</div>",t+="<div class='cardText'>",t+=n.Version,t+="</div>",t+="</div>",t+="</div>",t+="</div>"}function l(a,n,e){ApiClient.getJSON(ApiClient.getUrl("web/configurationpages")+"?pageType=PluginConfiguration").then(function(i){o(a,n,i,e)})}function o(n,l,o,r){l=l.sort(function(a,n){return a.Name>n.Name?1:-1});var d=l.map(function(a){return t(a,o)}).join("");if(l.length){var c=a(".installedPlugins",n).html(d);a(".noConfigPluginCard",c).on("click",function(){e()}),a(".connectModePluginCard",c).on("click",function(){i()}),a(".btnCardMenu",c).on("click",function(){s(n,this)})}else r&&(d+='<div style="padding:5px;">',AppInfo.enableAppStorePolicy?d+="<p>"+Globalize.translate("MessageNoPluginsDueToAppStore")+"</p>":(d+="<p>"+Globalize.translate("MessageNoPluginsInstalled")+"</p>",d+='<p><a href="plugincatalog.html">',d+=Globalize.translate("BrowsePluginCatalogMessage"),d+="</a></p>"),d+="</div>"),a(".installedPlugins",n).html(d);Dashboard.hideLoadingMsg()}function s(e,i){var t=a(i).parents(".card"),l=t.attr("data-id"),o=t.attr("data-name"),s=a(".cardContent",t).attr("href"),r=[];s&&r.push({name:Globalize.translate("ButtonSettings"),id:"open",ironIcon:"mode-edit"}),r.push({name:Globalize.translate("ButtonUninstall"),id:"delete",ironIcon:"delete"}),require(["actionsheet"],function(a){a.show({items:r,positionTo:i,callback:function(a){switch(a){case"open":Dashboard.navigate(s);break;case"delete":n(e,l,o)}}})})}function r(a){Dashboard.showLoadingMsg(),ApiClient.getInstalledPlugins().then(function(n){l(a,n,!0)})}function d(){return[{href:"plugins.html",name:Globalize.translate("TabMyPlugins")},{href:"plugincatalog.html",name:Globalize.translate("TabCatalog")}]}a(document).on("pageshow","#pluginsPage",function(){LibraryMenu.setTabs("plugins",0,d),r(this)}),window.PluginsPage={renderPlugins:l}});