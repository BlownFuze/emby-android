define(["jQuery"],function(n){function a(n,a,e){var i=Globalize.translate("UninstallPluginConfirmation").replace("{0}",e);require(["confirm"],function(e){e(i,Globalize.translate("UninstallPluginHeader")).then(function(){Dashboard.showLoadingMsg(),ApiClient.uninstallPlugin(a).then(function(){r(n)})})})}function e(){Dashboard.alert({message:Globalize.translate("NoPluginConfigurationMessage")})}function i(){Dashboard.alert({message:Globalize.translate("MessagePluginConfigurationRequiresLocalAccess")})}function t(a,e){var i=n.grep(e,function(n){return n.PluginId==a.Id})[0],t="",o=Dashboard.isConnectMode(),l=i?Dashboard.getConfigurationPageUrl(i.Name):null,s=i&&!o?l:null;return t+="<div data-id='"+a.Id+"' data-name='"+a.Name+"' class='card backdropCard bottomPaddedCard'>",t+='<div class="cardBox visualCardBox">',t+='<div class="cardScalable">',t+='<div class="cardPadder"></div>',t+=s?'<a class="cardContent" href="'+s+'">':l?o?'<div class="cardContent connectModePluginCard">':'<div class="cardContent">':'<div class="cardContent noConfigPluginCard noHoverEffect">',t+=a.ImageUrl?'<div class="cardImage" style="background-image:url(\''+a.ImageUrl+"');\">":'<div class="cardImage" style="background-image:url(\'css/images/items/list/collection.png\');">',t+="</div>",t+=s?"</a>":"</div>",t+="</div>",t+='<div class="cardFooter">',t+='<div class="cardText" style="text-align:right; float:right;padding-top:5px;">',t+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="btnCardMenu"></paper-icon-button>',t+="</div>",t+="<div class='cardText'>",t+=a.Name,t+="</div>",t+="<div class='cardText'>",t+=a.Version,t+="</div>",t+="</div>",t+="</div>",t+="</div>"}function o(n,a,e){ApiClient.getJSON(ApiClient.getUrl("web/configurationpages")+"?pageType=PluginConfiguration").then(function(i){l(n,a,i,e)})}function l(a,o,l,r){o=o.sort(function(n,a){return n.Name>a.Name?1:-1});var d=o.map(function(n){return t(n,l)}).join("");if(o.length){var c=n(".installedPlugins",a).html(d);n(".noConfigPluginCard",c).on("click",function(){e()}),n(".connectModePluginCard",c).on("click",function(){i()}),n(".btnCardMenu",c).on("click",function(){s(a,this)})}else r&&(d+='<div style="padding:5px;">',AppInfo.enableAppStorePolicy?d+="<p>"+Globalize.translate("MessageNoPluginsDueToAppStore")+"</p>":(d+="<p>"+Globalize.translate("MessageNoPluginsInstalled")+"</p>",d+='<p><a href="plugincatalog.html">',d+=Globalize.translate("BrowsePluginCatalogMessage"),d+="</a></p>"),d+="</div>"),n(".installedPlugins",a).html(d);Dashboard.hideLoadingMsg()}function s(e,i){var t=n(i).parents(".card"),o=t.attr("data-id"),l=t.attr("data-name"),s=n(".cardContent",t).attr("href"),r=[];s&&r.push({name:Globalize.translate("ButtonSettings"),id:"open",ironIcon:"mode-edit"}),r.push({name:Globalize.translate("ButtonUninstall"),id:"delete",ironIcon:"delete"}),require(["actionsheet"],function(n){n.show({items:r,positionTo:i,callback:function(n){switch(n){case"open":Dashboard.navigate(s);break;case"delete":a(e,o,l)}}})})}function r(n){Dashboard.showLoadingMsg(),ApiClient.getInstalledPlugins().then(function(a){o(n,a,!0)})}n(document).on("pageshow","#pluginsPage",function(){r(this)}),window.PluginsPage={renderPlugins:o}});