define(["paper-icon-button-light"],function(){function e(e){"1"==getParameterByName("showuser")?(e.classList.add("libraryPage"),e.classList.add("noSecondaryNavPage"),e.classList.remove("standalonePage")):(e.classList.add("standalonePage"),e.classList.remove("noSecondaryNavPage"),e.classList.remove("libraryPage"))}function t(){Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")})}function n(e){var t="";return t+='<div class="listItem serverItem" data-id="'+e.Id+'">',t+='<button type="button" is="emby-button" class="fab mini autoSize blue lnkServer" item-icon><i class="md-icon">wifi</i></button>',t+='<div class="listItemBody lnkServer">',t+='<a class="clearLink" href="#">',t+="<div>",t+=e.Name,t+="</div>",t+="</a>",t+="</div>",e.Id&&(t+='<button is="paper-icon-button-light" class="btnServerMenu autoSize"><i class="md-icon">'+AppInfo.moreIcon.replace("-","_")+"</i></button>"),t+="</div>"}function a(e,t){t.length?(e.querySelector(".noServersMessage").classList.add("hide"),e.querySelector(".serverList").classList.remove("hide")):(e.querySelector(".serverList").classList.add("hide"),e.querySelector(".noServersMessage").classList.remove("hide"));var a="";a+=t.map(n).join(""),e.querySelector(".serverList").innerHTML=a}function i(){Dashboard.hideModalLoadingMsg(),Dashboard.alert({message:Globalize.translate("DefaultErrorMessage")})}function o(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}return function(n){function r(e,n){Dashboard.showLoadingMsg(),ConnectionManager.connectToServer(n).then(function(e){Dashboard.hideLoadingMsg();var n=e.ApiClient;switch(e.State){case MediaBrowser.ConnectionState.SignedIn:Dashboard.onServerChanged(n.getCurrentUserId(),n.accessToken(),n),Dashboard.navigate("home.html");break;case MediaBrowser.ConnectionState.ServerSignIn:Dashboard.onServerChanged(null,null,n),Dashboard.navigate("login.html?serverid="+e.Servers[0].Id);break;case MediaBrowser.ConnectionState.ServerUpdateNeeded:Dashboard.alert(alert({text:Globalize.translate("core#ServerUpdateNeeded","https://emby.media"),html:Globalize.translate("core#ServerUpdateNeeded",'<a href="https://emby.media">https://emby.media</a>')}));break;default:t()}})}function s(e,t){Dashboard.showModalLoadingMsg(),ConnectionManager.acceptServer(t).then(function(){Dashboard.hideModalLoadingMsg(),b(e)},function(){i()})}function c(e,t){Dashboard.showModalLoadingMsg(),ConnectionManager.deleteServer(t).then(function(){Dashboard.hideModalLoadingMsg(),b(e)},function(){i()})}function d(e,t){Dashboard.showModalLoadingMsg(),ConnectionManager.rejectServer(t).then(function(){Dashboard.hideModalLoadingMsg(),b(e)},function(){i()})}function l(e){var t=o(e,"serverItem"),n=o(e,"page"),a=t.getAttribute("data-id"),i=[];i.push({name:Globalize.translate("ButtonDelete"),id:"delete"}),require(["actionsheet"],function(t){t.show({items:i,positionTo:e,callback:function(e){switch(e){case"delete":c(n,a)}}})})}function u(e){var t=o(e,"inviteItem"),n=o(e,"page"),a=t.getAttribute("data-id"),i=[];i.push({name:Globalize.translate("ButtonAccept"),id:"accept"}),i.push({name:Globalize.translate("ButtonReject"),id:"reject"}),require(["actionsheet"],function(t){t.show({items:i,positionTo:e,callback:function(e){switch(e){case"accept":s(n,a);break;case"reject":d(n,a)}}})})}function v(e){var t="";return t+='<div class="listItem inviteItem" data-id="'+e.Id+'">',t+='<button type="button" is="emby-button" class="fab mini autoSize blue lnkServer" item-icon><i class="md-icon">wifi</i></button>',t+='<div class="listItemBody">',t+="<div>",t+=e.Name,t+="</div>",t+="</div>",t+='<button is="paper-icon-button-light" class="btnInviteMenu autoSize"><i class="md-icon">'+AppInfo.moreIcon.replace("-","_")+"</i></button>",t+="</div>"}function h(e,t){t.length?e.querySelector(".invitationSection").classList.remove("hide"):e.querySelector(".invitationSection").classList.add("hide");var n=t.map(v).join("");e.querySelector(".invitationList").innerHTML=n}function g(e){ConnectionManager.isLoggedIntoConnect()?ConnectionManager.getUserInvitations().then(function(t){h(e,t)}):h(e,[])}function b(e){Dashboard.showLoadingMsg(),ConnectionManager.getAvailableServers().then(function(t){t=t.slice(0),f=t,a(e,t),Dashboard.hideLoadingMsg()}),g(e),ConnectionManager.isLoggedIntoConnect()?e.querySelector(".connectLogin").classList.add("hide"):e.querySelector(".connectLogin").classList.remove("hide")}var f;n.querySelector(".invitationList").addEventListener("click",function(e){var t=o(e.target,"btnInviteMenu");t&&u(t)}),n.querySelector(".serverList").addEventListener("click",function(e){var t=o(e.target,"lnkServer");if(t){var a=o(t,"serverItem"),i=a.getAttribute("data-id"),s=f.filter(function(e){return e.Id==i})[0];r(n,s)}var c=o(e.target,"btnServerMenu");c&&l(c)}),n.addEventListener("viewbeforeshow",function(){e(this)}),n.addEventListener("viewshow",function(){b(this)})}});