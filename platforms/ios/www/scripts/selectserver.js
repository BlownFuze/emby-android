define(["appSettings","paper-icon-button-light"],function(e){function t(e){"1"==getParameterByName("showuser")?(e.classList.add("libraryPage"),e.classList.add("noSecondaryNavPage"),e.classList.remove("standalonePage")):(e.classList.add("standalonePage"),e.classList.remove("noSecondaryNavPage"),e.classList.remove("libraryPage"))}function n(){Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")})}function a(e){var t="";return t+='<div class="listItem serverItem" data-id="'+e.Id+'">',t+='<button type="button" is="emby-button" class="fab mini autoSize blue lnkServer" item-icon><i class="md-icon">wifi</i></button>',t+='<div class="listItemBody lnkServer">',t+='<a class="clearLink" href="#">',t+="<div>",t+=e.Name,t+="</div>",t+="</a>",t+="</div>",e.Id&&(t+='<button is="paper-icon-button-light" class="btnServerMenu autoSize"><i class="md-icon">'+AppInfo.moreIcon.replace("-","_")+"</i></button>"),t+="</div>"}function i(e,t){t.length?(e.querySelector(".noServersMessage").classList.add("hide"),e.querySelector(".serverList").classList.remove("hide")):(e.querySelector(".serverList").classList.add("hide"),e.querySelector(".noServersMessage").classList.remove("hide"));var n="";n+=t.map(a).join(""),e.querySelector(".serverList").innerHTML=n}function o(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("DefaultErrorMessage")})}function r(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}return function(a){function s(t,a){Dashboard.showLoadingMsg(),ConnectionManager.connectToServer(a,{enableAutoLogin:e.enableAutoLogin()}).then(function(e){Dashboard.hideLoadingMsg();var t=e.ApiClient;switch(e.State){case MediaBrowser.ConnectionState.SignedIn:Dashboard.onServerChanged(t.getCurrentUserId(),t.accessToken(),t),Dashboard.navigate("home.html");break;case MediaBrowser.ConnectionState.ServerSignIn:Dashboard.onServerChanged(null,null,t),Dashboard.navigate("login.html?serverid="+e.Servers[0].Id);break;case MediaBrowser.ConnectionState.ServerUpdateNeeded:Dashboard.alert(alert({text:Globalize.translate("core#ServerUpdateNeeded","https://emby.media"),html:Globalize.translate("core#ServerUpdateNeeded",'<a href="https://emby.media">https://emby.media</a>')}));break;default:n()}})}function c(e,t){Dashboard.showLoadingMsg(),ConnectionManager.acceptServer(t).then(function(){Dashboard.hideLoadingMsg(),f(e)},function(){o()})}function d(e,t){Dashboard.showLoadingMsg(),ConnectionManager.deleteServer(t).then(function(){Dashboard.hideLoadingMsg(),f(e)},function(){o()})}function l(e,t){Dashboard.showLoadingMsg(),ConnectionManager.rejectServer(t).then(function(){Dashboard.hideLoadingMsg(),f(e)},function(){o()})}function u(e){var t=r(e,"serverItem"),n=r(e,"page"),a=t.getAttribute("data-id"),i=[];i.push({name:Globalize.translate("ButtonDelete"),id:"delete"}),require(["actionsheet"],function(t){t.show({items:i,positionTo:e,callback:function(e){switch(e){case"delete":d(n,a)}}})})}function v(e){var t=r(e,"inviteItem"),n=r(e,"page"),a=t.getAttribute("data-id"),i=[];i.push({name:Globalize.translate("ButtonAccept"),id:"accept"}),i.push({name:Globalize.translate("ButtonReject"),id:"reject"}),require(["actionsheet"],function(t){t.show({items:i,positionTo:e,callback:function(e){switch(e){case"accept":c(n,a);break;case"reject":l(n,a)}}})})}function g(e){var t="";return t+='<div class="listItem inviteItem" data-id="'+e.Id+'">',t+='<button type="button" is="emby-button" class="fab mini autoSize blue lnkServer" item-icon><i class="md-icon">wifi</i></button>',t+='<div class="listItemBody">',t+="<div>",t+=e.Name,t+="</div>",t+="</div>",t+='<button is="paper-icon-button-light" class="btnInviteMenu autoSize"><i class="md-icon">'+AppInfo.moreIcon.replace("-","_")+"</i></button>",t+="</div>"}function h(e,t){t.length?e.querySelector(".invitationSection").classList.remove("hide"):e.querySelector(".invitationSection").classList.add("hide");var n=t.map(g).join("");e.querySelector(".invitationList").innerHTML=n}function b(e){ConnectionManager.isLoggedIntoConnect()?ConnectionManager.getUserInvitations().then(function(t){h(e,t)}):h(e,[])}function f(e){Dashboard.showLoadingMsg(),ConnectionManager.getAvailableServers().then(function(t){t=t.slice(0),m=t,i(e,t),Dashboard.hideLoadingMsg()}),b(e),ConnectionManager.isLoggedIntoConnect()?e.querySelector(".connectLogin").classList.add("hide"):e.querySelector(".connectLogin").classList.remove("hide")}var m;a.querySelector(".invitationList").addEventListener("click",function(e){var t=r(e.target,"btnInviteMenu");t&&v(t)}),a.querySelector(".serverList").addEventListener("click",function(e){var t=r(e.target,"lnkServer");if(t){var n=r(t,"serverItem"),i=n.getAttribute("data-id"),o=m.filter(function(e){return e.Id==i})[0];s(a,o)}var c=r(e.target,"btnServerMenu");c&&u(c)}),a.addEventListener("viewbeforeshow",function(){t(this)}),a.addEventListener("viewshow",function(){f(this)})}});