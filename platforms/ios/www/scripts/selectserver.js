define(["jQuery"],function(e){function n(e,n){Dashboard.showLoadingMsg(),ConnectionManager.connectToServer(n).then(function(e){Dashboard.hideLoadingMsg();var n=e.ApiClient;switch(e.State){case MediaBrowser.ConnectionState.SignedIn:Dashboard.onServerChanged(n.getCurrentUserId(),n.accessToken(),n),Dashboard.navigate("home.html");break;case MediaBrowser.ConnectionState.ServerSignIn:Dashboard.onServerChanged(null,null,n),Dashboard.navigate("login.html?serverid="+e.Servers[0].Id);break;case MediaBrowser.ConnectionState.ServerUpdateNeeded:Dashboard.alert({message:Globalize.translate("ServerUpdateNeeded",'<a href="https://emby.media">https://emby.media</a>')});break;default:a()}})}function a(){Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")})}function t(e){var n="";return n+='<paper-icon-item class="serverItem" data-id="'+e.Id+'">',n+='<paper-fab mini class="blue lnkServer" icon="wifi" item-icon></paper-fab>',n+='<paper-item-body class="lnkServer" two-line>',n+='<a class="clearLink" href="#">',n+="<div>",n+=e.Name,n+="</div>",n+="</a>",n+="</paper-item-body>",e.Id&&(n+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="btnServerMenu"></paper-icon-button>'),n+="</paper-icon-item>"}function o(a,o){o.length?(e(".noServersMessage",a).hide(),e(".serverList",a).show()):(e(".noServersMessage",a).show(),e(".serverList",a).hide());var i="";i+=o.map(t).join("");var r=e(".serverList",a).html(i);e(".lnkServer",r).on("click",function(){var t=e(this).parents(".serverItem")[0],i=t.getAttribute("data-id"),r=o.filter(function(e){return e.Id==i})[0];n(a,r)}),e(".btnServerMenu",r).on("click",function(){d(this)})}function i(){setTimeout(function(){Dashboard.hideModalLoadingMsg(),Dashboard.alert({message:Globalize.translate("DefaultErrorMessage")})},300)}function r(e,n){Dashboard.showModalLoadingMsg(),ConnectionManager.acceptServer(n).then(function(){Dashboard.hideModalLoadingMsg(),p(e)},function(){i()})}function s(e,n){Dashboard.showModalLoadingMsg(),ConnectionManager.deleteServer(n).then(function(){Dashboard.hideModalLoadingMsg(),p(e)},function(){i()})}function c(e,n){Dashboard.showModalLoadingMsg(),ConnectionManager.rejectServer(n).then(function(){Dashboard.hideModalLoadingMsg(),p(e)},function(){i()})}function d(n){var a=e(n).parents(".serverItem"),t=e(n).parents(".page"),o=a.attr("data-id"),i=[];i.push({name:Globalize.translate("ButtonDelete"),id:"delete",ironIcon:"delete"}),require(["actionsheet"],function(e){e.show({items:i,positionTo:n,callback:function(e){switch(e){case"delete":s(t,o)}}})})}function l(n){var a=e(n).parents(".inviteItem"),t=e(n).parents(".page"),o=a.attr("data-id"),i=[];i.push({name:Globalize.translate("ButtonAccept"),id:"accept",ironIcon:"add"}),i.push({name:Globalize.translate("ButtonReject"),id:"reject",ironIcon:"cancel"}),require(["actionsheet"],function(e){e.show({items:i,positionTo:n,callback:function(e){switch(e){case"accept":r(t,o);break;case"reject":c(t,o)}}})})}function h(e){var n="";return n+='<paper-icon-item class="inviteItem" data-id="'+e.Id+'">',n+='<paper-fab mini class="blue lnkServer" icon="wifi" item-icon></paper-fab>',n+="<paper-item-body two-line>",n+="<div>",n+=e.Name,n+="</div>",n+="</paper-item-body>",n+='<paper-icon-button icon="'+AppInfo.moreIcon+'" class="btnInviteMenu"></paper-icon-button>',n+="</paper-icon-item>"}function g(n,a){a.length?e(".invitationSection",n).show():e(".invitationSection",n).hide();var t=a.map(h).join(""),o=e(".invitationList",n).html(t);e(".btnInviteMenu",o).on("click",function(){l(this)})}function u(e){ConnectionManager.isLoggedIntoConnect()?ConnectionManager.getUserInvitations().then(function(n){g(e,n)}):g(e,[])}function p(n){Dashboard.showLoadingMsg(),ConnectionManager.getAvailableServers().then(function(e){e=e.slice(0),o(n,e),Dashboard.hideLoadingMsg()}),u(n),ConnectionManager.isLoggedIntoConnect()?e(".connectLogin",n).hide():e(".connectLogin",n).show()}function v(n){"1"==getParameterByName("showuser")?e(n).addClass("libraryPage").addClass("noSecondaryNavPage").removeClass("standalonePage"):e(n).removeClass("libraryPage").removeClass("noSecondaryNavPage").addClass("standalonePage")}pageIdOn("pagebeforeshow","selectServerPage",function(){var e=this;v(e)}),pageIdOn("pageshow","selectServerPage",function(){var e=this;p(e)})});