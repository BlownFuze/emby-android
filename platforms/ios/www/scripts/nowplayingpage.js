!function(e,t,a,n){function i(e,t,a,n){for(var i="",o=0,r=t.length;r>o;o++){var l=t[o];i+='<div data-positionticks="'+l.StartPositionTicks+'" class="posterItem backdropPosterItem chapterPosterItem">';var s;s=l.ImageTag?ApiClient.getScaledImageUrl(a,{width:240,tag:l.ImageTag,type:"Chapter",index:o}):"css/images/items/list/chapter.png";var c=' data-src="'+s+'"';i+='<div class="posterItemImage lazy"'+c+">",i+='<div class="posterItemTextOverlay" style="position:absolute;bottom:0;left:0;right:0;">',l.Name&&(i+="<div class='posterItemText'>",i+=l.Name,i+="</div>"),i+="<div class='posterItemProgress posterItemText'>";var d=100*(l.StartPositionTicks/n);i+='<progress class="itemProgressBar" min="0" max="100" value="'+d+'" style="opacity:.8;width:100%;"></progress>',i+="</div>",i+="</div>",i+="</div>",i+="</div>"}e.innerHTML=i,ImageLoader.lazyChildren(e)}function o(e,t){var n=a(".chapterPosterItem",e).removeClass("currentChapter"),i=n.get().filter(function(e){var a=e.getAttribute("data-positionticks");return t>=a}),o=i[i.length-1];o.classList.add("currentChapter"),o.scrollIntoView(),e.scrollLeft+=50}function r(e,t,n){a(".chapterMenuOverlay",e).show();var r=e.querySelector(".chapterMenu");if(a(r).show(),t.Id==r.getAttribute("data-itemid"))return void o(r,n);var l=r.querySelector(".chapterMenuInner");i(l,t.Chapters,t.Id,t.RunTimeTicks),r.setAttribute("data-itemid",t.Id),o(r,n)}function l(e){a(".chapterMenuOverlay",e).hide(),a(".chapterMenu",e).hide()}function s(e,t,a,n){var i=(a.MediaStreams||[]).filter(function(e){return"Audio"==e.Type}),o=i.map(function(e){var t=(e.Codec||"").toUpperCase();e.Profile&&(t+=" "+e.Profile),e.Language&&(t+=" · "+e.Language),e.Layout?t+=" · "+e.Layout:e.Channels&&(t+=" · "+e.Channels+" ch");var a={name:t,id:e.Index};return e.Index==n&&(a.ironIcon="check"),a});require(["actionsheet"],function(){ActionSheetElement.show({items:o,positionTo:t,callback:function(e){A.setAudioStreamIndex(parseInt(e))}})})}function c(e,t,a,n){var i=(a.MediaStreams||[]).filter(function(e){return"Subtitle"==e.Type}),o=i.map(function(e){var t=e.Language||Globalize.translate("LabelUnknownLanguage");e.IsDefault&&e.IsForced?t+=" · "+Globalize.translate("LabelDefaultForcedStream"):e.IsDefault?t+=" · "+Globalize.translate("LabelDefaultStream"):e.IsForced&&(t+=" · "+Globalize.translate("LabelForcedStream")),e.Codec&&(t+=" · "+e.Codec.toUpperCase());var a={name:t,id:e.Index};return e.Index==n&&(a.ironIcon="check"),a});alert(n),o.unshift({id:-1,name:Globalize.translate("ButtonOff"),ironIcon:null==n?"check":null}),require(["actionsheet"],function(){ActionSheetElement.show({items:o,positionTo:t,callback:function(e){A.setSubtitleStreamIndex(parseInt(e))}})})}function d(e){if(e&&L){var t=L;switch((t.PlayState||{}).RepeatMode){case"RepeatNone":e.setRepeatMode("RepeatAll");break;case"RepeatAll":e.setRepeatMode("RepeatOne");break;case"RepeatOne":e.setRepeatMode("RepeatNone")}}}function u(e){a(".tabButton",e).on("click",function(){var t=a("."+this.getAttribute("data-tab"),e);t.siblings(".tabContent").hide(),t.show(),a(".tabButton",e).removeClass("ui-btn-active"),a(this).addClass("ui-btn-active")}),a(".chapterMenuOverlay",e).on("click",function(){l(e)}),a(".chapterMenu",e).on("click",".chapterPosterItem",function(){if(A){var t=this.getAttribute("data-positionticks")||"0";A.seek(parseInt(t))}l(e)}),a(".btnCommand,.btnToggleFullscreen",e).on("click",function(){A&&(this.classList.contains("repeatToggleButton")?d(A):MediaController.sendCommand({Name:this.getAttribute("data-command")},A))}),a(".btnAudioTracks",e).on("click",function(){if(A&&L&&L.PlayState){var t=L.PlayState.AudioStreamIndex;s(e,this,L.NowPlayingItem,t)}}),a(".btnSubtitles",e).on("click",function(){if(A&&L&&L.PlayState){var t=L.PlayState.SubtitleStreamIndex;c(e,this,L.NowPlayingItem,t)}}),a(".btnChapters",e).on("click",function(){if(A&&L){var t=L.PlayState.PositionTicks;r(e,L.NowPlayingItem,t)}}),a(".btnStop",e).on("click",function(){A&&A.stop()}),a(".btnPlay",e).on("click",function(){A&&A.unpause()}),a(".btnPause",e).on("click",function(){A&&A.pause()}),a(".btnNextTrack",e).on("click",function(){A&&A.nextTrack()}),a(".btnPreviousTrack",e).on("click",function(){A&&A.previousTrack()}),a(".nowPlayingPositionSlider",e).on("change",function(){var e=this.value;if(A&&L){var t=parseFloat(e),a=t/100*L.NowPlayingItem.RunTimeTicks;A.seek(Math.floor(a))}}),a(".nowPlayingPositionSlider",e)[0]._setPinValue=function(e){var t=L;if(!t||!t.NowPlayingItem||!t.NowPlayingItem.RunTimeTicks)return void(this.pinValue="--:--");var a=t.NowPlayingItem.RunTimeTicks;a/=100,a*=e,this.pinValue=Dashboard.getDisplayTime(a)},a(e).on("click",".lnkPlayFromIndex",function(){var t=parseInt(this.getAttribute("data-index"));MediaController.currentPlaylistIndex(t),w(e)}).on("click",".lnkRemoveFromPlaylist",function(){var t=parseInt(this.getAttribute("data-index"));MediaController.removeFromPlaylist(t),w(e)}),Events.on(e,"click",".mediaItem",k)}function g(e,t){var n=this;n.beginPlayerUpdates(),p.call(n,e,t),w(a(a.mobile.activePage)[0])}function m(e){var t=this;t.endPlayerUpdates(),p.call(t,e,{}),w(a(a.mobile.activePage)[0])}function p(e,t){if("positionchange"==e.type){var n=(new Date).getTime();if(700>n-B)return;B=n}v(a(a.mobile.activePage)[0],t)}function y(e){e.removeClass("hide")}function b(e){e.addClass("hide")}function h(e,t){return e&&e.MediaStreams&&e.MediaStreams.filter(function(e){return e.Type==t}).length>0}function v(e,t){L=t;var n=t.NowPlayingItem,i=MediaController.getPlayerInfo(),o=i.supportedCommands,r=t.PlayState||{};a(".btnToggleFullscreen",e).buttonEnabled(n&&"Video"==n.MediaType&&-1!=o.indexOf("ToggleFullscreen")),a(".btnAudioTracks",e).buttonEnabled(h(n,"Audio")&&-1!=o.indexOf("SetAudioStreamIndex")),a(".btnSubtitles",e).buttonEnabled(h(n,"Subtitle")&&-1!=o.indexOf("SetSubtitleStreamIndex")),n&&n.Chapters&&n.Chapters.length&&r.CanSeek?a(".btnChapters",e).buttonEnabled(!0):(a(".btnChapters",e).buttonEnabled(!1),l(e)),a(".sendMessageElement",e).buttonEnabled(-1!=o.indexOf("DisplayMessage")),a(".typeTextElement",e).buttonEnabled(-1!=o.indexOf("SendString")),a(".btnStop",e).buttonEnabled(null!=n),a(".btnNextTrack",e).buttonEnabled(null!=n),a(".btnPreviousTrack",e).buttonEnabled(null!=n);var s=a(".btnPause",e).buttonEnabled(null!=n),c=a(".btnPlay",e).buttonEnabled(null!=n);r.IsPaused?(b(s),y(c)):(y(s),b(c));var d=a(".nowPlayingPositionSlider",e)[0];if(!d.dragging){if(n&&n.RunTimeTicks){var u=r.PositionTicks/n.RunTimeTicks;u*=100,d.value=u}else d.value=0;d.disabled=!r.CanSeek}a(".positionTime",e).html(null==r.PositionTicks?"--:--":Dashboard.getDisplayTime(r.PositionTicks)),a(".runtime",e).html(n&&null!=n.RunTimeTicks?Dashboard.getDisplayTime(n.RunTimeTicks):"--:--"),n&&"Video"==n.MediaType?a(".videoButton",e).css("visibility","visible"):a(".videoButton",e).css("visibility","hidden"),i.isLocalPlayer&&AppInfo.hasPhysicalVolumeButtons?a(".volumeButton",e).css("visibility","hidden"):a(".volumeButton",e).css("visibility","visible"),n&&"Audio"==n.MediaType?a(".buttonsRow2",e).hide():a(".buttonsRow2",e).show();var g=e.querySelector(".repeatToggleButton");"RepeatAll"==r.RepeatMode?(g.icon="repeat",g.classList.add("nowPlayingPageRepeatActive")):"RepeatOne"==r.RepeatMode?(g.icon="repeat-one",g.classList.add("nowPlayingPageRepeatActive")):(g.icon="repeat",g.classList.remove("nowPlayingPageRepeatActive")),f(e,t)}function f(t,n){var i=n.NowPlayingItem,o=i?MediaController.getNowPlayingNameHtml(i).replace("<br/>"," - "):"";a(".nowPlayingPageTitle",t).html(o),o.length>0?a(".nowPlayingPageTitle",t).removeClass("hide"):a(".nowPlayingPageTitle",t).addClass("hide");var r,l=null;i&&(i.PrimaryImageTag?r=ApiClient.getScaledImageUrl(i.PrimaryImageItemId,{type:"Primary",height:300,tag:i.PrimaryImageTag}):i.BackdropImageTag?r=ApiClient.getScaledImageUrl(i.BackdropItemId,{type:"Backdrop",height:300,tag:i.BackdropImageTag,index:0}):i.ThumbImageTag&&(r=ApiClient.getScaledImageUrl(i.ThumbImageItemId,{type:"Thumb",height:300,tag:i.ThumbImageTag}))),r!=N&&(i&&i.BackdropImageTag&&(l=ApiClient.getScaledImageUrl(i.BackdropItemId,{type:"Backdrop",maxWidth:a(e).width(),tag:i.BackdropImageTag,index:0})),P(t,r),i?(browserInfo.mobile||Backdrops.setBackdropUrl(t,l),ApiClient.getItem(Dashboard.getCurrentUserId(),i.Id).then(function(e){t.querySelector(".nowPlayingPageUserDataButtons").innerHTML=LibraryBrowser.getUserDataIconsHtml(e,!1)})):t.querySelector(".nowPlayingPageUserDataButtons").innerHTML="")}function P(e,t){N=t,a(".nowPlayingPageImage",e).html(t?'<img src="'+t+'" />':"")}function I(e,t){a(".btnCommand",e).each(function(){a(this).buttonEnabled(-1!=t.indexOf(this.getAttribute("data-command")))})}function S(){A&&(Events.off(A,"playbackstart",g),Events.off(A,"playbackstop",m),Events.off(A,"volumechange",p),Events.off(A,"playstatechange",p),Events.off(A,"positionchange",p),A.endPlayerUpdates(),A=null)}function T(e,t){S(),A=t,t.getPlayerState().then(function(e){e.NowPlayingItem&&t.beginPlayerUpdates(),p.call(t,{type:"init"},e)}),Events.on(t,"playbackstart",g),Events.on(t,"playbackstop",m),Events.on(t,"volumechange",p),Events.on(t,"playstatechange",p),Events.on(t,"positionchange",p);var a=MediaController.getPlayerInfo(),n=a.supportedCommands;I(e,n)}function w(e){var t="";t+=LibraryBrowser.getListViewHtml({items:MediaController.playlist(),smallIcon:!0});var a=e.querySelector(".playlist");a.innerHTML=t;var n=MediaController.currentPlaylistIndex();if(-1!=n){var i=a.querySelectorAll(".listItem")[n];if(i){var o=i.querySelector(".listviewImage");o.classList.remove("lazy"),o.classList.add("playlistIndexIndicatorImage")}}ImageLoader.lazyChildren(a)}function k(){var e=LibraryBrowser.getListItemInfo(this);return MediaController.currentPlaylistIndex(e.index),!1}function C(){var e=MediaController.getPlayerInfo();e.isLocalPlayer?(a(".nowPlayingCastIcon").each(function(){this.icon="cast"}),a(".nowPlayingSelectedPlayer").html("")):(a(".nowPlayingCastIcon").each(function(){this.icon="cast-connected"}),a(".nowPlayingSelectedPlayer").html(e.deviceName||e.name))}function M(){T(a(a.mobile.activePage)[0],MediaController.getCurrentPlayer())}function x(){require(["scripts/slideshow"],function(){SlideShow.showMenu()})}var A,L,N,B=0;pageIdOn("pageinit","nowPlayingPage",function(){var e=this;Dashboard.importCss("css/nowplaying.css"),u(e),a(".sendMessageForm").off("submit",NowPlayingPage.onMessageSubmit).on("submit",NowPlayingPage.onMessageSubmit),a(".typeTextForm").off("submit",NowPlayingPage.onSendStringSubmit).on("submit",NowPlayingPage.onSendStringSubmit),a(".requiresJqmCreate",this).trigger("create"),a(".btnSlideshow").on("click",function(){x(e)});var t=e.querySelector("paper-tabs");AppInfo.enableNowPlayingPageBottomTabs?(t.classList.remove("hide"),e.querySelector(".libraryViewNav").classList.add("hide")):(t.classList.add("hide"),e.querySelector(".libraryViewNav").classList.remove("hide")),t.classList.add("bottom"),t.alignBottom=!0,LibraryBrowser.configureSwipeTabs(e,t,e.querySelector("neon-animated-pages")),a(t).on("iron-select",function(){e.querySelector("neon-animated-pages").selected=this.selected}),a(e.querySelector("neon-animated-pages")).on("iron-select",function(){var t=e.querySelector(".libraryViewNav a.ui-btn-active");t&&t.classList.remove("ui-btn-active"),e.querySelector(".libraryViewNav a[data-index='"+this.selected+"']").classList.add("ui-btn-active")}),a(e.querySelectorAll(".libraryViewNav a")).on("click",function(){var a=this.getAttribute("data-index");AppInfo.enableNowPlayingPageBottomTabs?t.selected=a:e.querySelector("neon-animated-pages").selected=a}),Events.on(MediaController,"playerchange",function(){C(e)})}),pageIdOn("pagebeforeshow","nowPlayingPage",function(){a(t.body).addClass("hiddenViewMenuBar").addClass("hiddenNowPlayingBar");var i=this;N=null,Events.on(MediaController,"playerchange",M),T(i,MediaController.getCurrentPlayer()),w(i);var o=e.location.hash,r="#playlist"==o?2:0;this.querySelector("paper-tabs").selected=r,AppInfo.enableNowPlayingPageBottomTabs?this.querySelector("paper-tabs").selected=r:n(function(){i.querySelector("neon-animated-pages").selected=r},1e3),C(i)}),pageIdOn("pagebeforehide","nowPlayingPage",function(){S(),Events.off(MediaController,"playerchange",M),L=null,a(t.body).removeClass("hiddenViewMenuBar").removeClass("hiddenNowPlayingBar")}),e.NowPlayingPage={onMessageSubmit:function(){var e=this;return MediaController.sendCommand({Name:"DisplayMessage",Arguments:{Header:a("#txtMessageTitle",e).val(),Text:a("#txtMessageText",e).val()}},A),a("input",e).val(""),Dashboard.alert("Message sent."),!1},onSendStringSubmit:function(){var e=this;return MediaController.sendCommand({Name:"SendString",Arguments:{String:a("#txtTypeText",e).val()}},A),a("input",e).val(""),Dashboard.alert("Text sent."),!1}}}(window,document,jQuery,setTimeout,clearTimeout);