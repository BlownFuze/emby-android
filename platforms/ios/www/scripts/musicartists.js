define(["events","libraryBrowser","imageLoader","alphaPicker","listView","cardBuilder","emby-itemscontainer"],function(e,t,r,a,i,n){return function(e,o,s){function l(e){var r=c(e),a=S[r];return a||(a=S[r]={query:{SortBy:"SortName",SortOrder:"Ascending",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,ItemCounts,BasicSyncInfo",StartIndex:0,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",Limit:LibraryBrowser.getDefaultPageSize()},view:t.getSavedView(r)||"PosterCard"},a.query.ParentId=o.topParentId,t.loadSavedQueryValues(r,a.query)),a}function u(e){return l(e).query}function c(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey(m.mode)),e.savedQueryKey}function d(){var e=m.getCurrentViewStyle(),t=s.querySelector(".itemsContainer");"List"==e?(t.classList.add("vertical-list"),t.classList.remove("vertical-wrap")):(t.classList.remove("vertical-list"),t.classList.add("vertical-wrap")),t.innerHTML=""}function y(e){Dashboard.showLoadingMsg();var a=u(e),o="albumartists"==m.mode?ApiClient.getAlbumArtists(Dashboard.getCurrentUserId(),a):ApiClient.getArtists(Dashboard.getCurrentUserId(),a);o.then(function(o){function l(){a.StartIndex+=a.Limit,y(s)}function u(){a.StartIndex-=a.Limit,y(s)}window.scrollTo(0,0),v(e);var d,g=LibraryBrowser.getQueryPagingHtml({startIndex:a.StartIndex,limit:a.Limit,totalRecordCount:o.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),S=m.getCurrentViewStyle();d="List"==S?i.getListViewHtml({items:o.Items,sortBy:a.SortBy}):n.getCardsHtml("PosterCard"==S?{items:o.Items,shape:"square",context:"music",showTitle:!0,coverImage:!0,lazy:!0,cardLayout:!0,showSongCount:!0}:{items:o.Items,shape:"square",context:"music",showTitle:!0,coverImage:!0,lazy:!0,centerText:!0,overlayPlayButton:!0});var h,f,w=s.querySelectorAll(".paging");for(h=0,f=w.length;f>h;h++)w[h].innerHTML=g;for(w=s.querySelectorAll(".btnNextPage"),h=0,f=w.length;f>h;h++)w[h].addEventListener("click",l);for(w=s.querySelectorAll(".btnPreviousPage"),h=0,f=w.length;f>h;h++)w[h].addEventListener("click",u);var L=s.querySelector(".itemsContainer");L.innerHTML=d,r.lazyChildren(L),t.saveQueryValues(c(e),a),Dashboard.hideLoadingMsg()})}function v(e){var t=u(e);m.alphaPicker.value(t.NameStartsWithOrGreater)}function g(e){var r=e.querySelector(".alphaPicker");r.addEventListener("alphavaluechanged",function(t){var r=t.detail.value,a=u(e);a.NameStartsWithOrGreater=r,a.StartIndex=0,y(e)}),m.alphaPicker=new a({element:r,valueChangeEvent:"click"}),e.querySelector(".btnFilter").addEventListener("click",function(){m.showFilterMenu()});var i=e.querySelector(".btnSelectView");i.addEventListener("click",function(e){t.showLayoutMenu(e.target,m.getCurrentViewStyle(),"List,Poster,PosterCard".split(","))}),i.addEventListener("layoutchange",function(r){var a=r.detail.viewStyle;l(e).view=a,t.saveViewSetting(c(e),a),u(e).StartIndex=0,d(),y(e)})}var m=this,S={};m.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],function(e){var t=new e({query:u(s),mode:m.mode});Events.on(t,"filterchange",function(){u(s).StartIndex=0,y(s)}),t.show()})},m.getCurrentViewStyle=function(){return l(s).view},g(s),d(),m.renderTab=function(){y(s),v(s)},m.destroy=function(){}}});