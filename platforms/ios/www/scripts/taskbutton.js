define(["appStorage","emby-button"],function(e){return function(t){function n(){ApiClient.getScheduledTasks({IsEnabled:!0}).then(s)}function s(e){var n=e.filter(function(e){return e.Key==t.taskKey})[0];if(t.panel&&(n?t.panel.classList.remove("hide"):t.panel.classList.add("hide")),n){"Idle"==n.State?b.removeAttribute("disabled"):b.setAttribute("disabled","disabled"),b.setAttribute("data-taskid",n.Id);var s=(n.CurrentProgressPercentage||0).toFixed(1);if(t.progressElem&&(t.progressElem.value=s,"Running"==n.State?t.progressElem.classList.remove("hide"):t.progressElem.classList.add("hide")),t.lastResultElem){var a=n.LastExecutionResult?n.LastExecutionResult.Status:"";t.lastResultElem.html("Failed"==a?'<span style="color:#FF0000;">('+Globalize.translate("LabelFailed")+")</span>":"Cancelled"==a?'<span style="color:#0026FF;">('+Globalize.translate("LabelCancelled")+")</span>":"Aborted"==a?'<span style="color:#FF0000;">'+Globalize.translate("LabelAbortedByServerShutdown")+"</span>":a)}}}function a(e){ApiClient.startScheduledTask(e).then(n)}function l(){var n=this,s=n.getAttribute("data-taskid"),l="scheduledTaskButton"+t.taskKey,i=(new Date).getMonth()+"6";if(e.getItem(l)==i)a(s);else{var o=Globalize.translate("ConfirmMessageScheduledTaskButton");o+="<br/>",o+='<div style="margin-top:1em;">',o+='<a class="clearLink" href="scheduledtasks.html"><button is="emby-button" type="button" style="color:#3f51b5!important;margin:0;">'+Globalize.translate("ButtonScheduledTasks")+"</button></a>",o+="</div>",require(["confirm"],function(t){t({title:Globalize.translate("HeaderConfirmation"),html:o,text:Globalize.translate("ConfirmMessageScheduledTaskButton")+"\n\n"+Globalize.translate("ButtonScheduledTasks")}).then(function(){e.setItem(l,i),a(s)})})}}function i(){d()}function o(e,t){if("ScheduledTasksInfo"==t.MessageType){var n=t.Data;s(n)}}function r(){ApiClient.isWebSocketOpen()||n()}function d(){ApiClient.isWebSocketOpen()&&ApiClient.sendWebSocketMessage("ScheduledTasksInfoStart","1000,1000"),u&&clearInterval(u),u=setInterval(r,5e3)}function c(){ApiClient.isWebSocketOpen()&&ApiClient.sendWebSocketMessage("ScheduledTasksInfoStop"),u&&clearInterval(u)}var u,b=t.button;t.panel&&t.panel.classList.add("hide"),"off"==t.mode?(b.removeEventListener("click",l),Events.off(ApiClient,"websocketmessage",o),Events.off(ApiClient,"websocketopen",i),c()):(b.addEventListener("click",l),n(),d(),Events.on(ApiClient,"websocketmessage",o),Events.on(ApiClient,"websocketopen",i))}});