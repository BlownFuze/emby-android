$.fn.taskButton=function(e){function t(e){ApiClient.getScheduledTasks({IsEnabled:!0}).then(function(t){n(e,t)})}function n(t,n){var a=n.filter(function(t){return t.Key==e.taskKey})[0];if(e.panel&&(a?$(e.panel).show():$(e.panel).hide()),a){"Idle"==a.State?$(t).removeAttr("disabled"):$(t).attr("disabled","disabled"),$(t).attr("data-taskid",a.Id);var s=(a.CurrentProgressPercentage||0).toFixed(1);if(e.progressElem&&(e.progressElem.value=s,"Running"==a.State?e.progressElem.classList.remove("hide"):e.progressElem.classList.add("hide")),e.lastResultElem){var l=a.LastExecutionResult?a.LastExecutionResult.Status:"";e.lastResultElem.html("Failed"==l?'<span style="color:#FF0000;">'+Globalize.translate("LabelFailed")+"</span>":"Cancelled"==l?'<span style="color:#0026FF;">'+Globalize.translate("LabelCancelled")+"</span>":"Aborted"==l?'<span style="color:#FF0000;">'+Globalize.translate("LabelAbortedByServerShutdown")+"</span>":l)}}}function a(e,n){ApiClient.startScheduledTask(n).then(function(){t(e)})}function s(){var t=this,n=t.getAttribute("data-taskid"),s="scheduledTaskButton"+e.taskKey,l=(new Date).getMonth()+"5";if(appStorage.getItem(s)==l)a(t,n);else{var i=Globalize.translate("ConfirmMessageScheduledTaskButton");i+="<br/>",i+='<div style="margin-top:1em;">',i+='<a class="clearLink" href="scheduledtasks.html"><paper-button style="color:#3f51b5!important;margin:0;">'+Globalize.translate("ButtonScheduledTasks")+"</paper-button></a>",i+="</div>",require(["confirm"],function(e){e(i,Globalize.translate("HeaderConfirmation")).then(function(){appStorage.setItem(s,l),a(t,n)})})}}function l(){r()}function i(e,t){if("ScheduledTasksInfo"==t.MessageType){var a=t.Data;n(u,a)}}function o(){ApiClient.isWebSocketOpen()||t(u)}function r(){ApiClient.isWebSocketOpen()&&ApiClient.sendWebSocketMessage("ScheduledTasksInfoStart","1000,1000"),d&&clearInterval(d),d=setInterval(o,5e3)}function c(){ApiClient.isWebSocketOpen()&&ApiClient.sendWebSocketMessage("ScheduledTasksInfoStop"),d&&clearInterval(d)}var d,u=this;return e.panel&&$(e.panel).hide(),"off"==e.mode?(this.off("click",s),Events.off(ApiClient,"websocketmessage",i),Events.off(ApiClient,"websocketopen",l),c()):this.length&&(this.on("click",s),t(u),r(),Events.on(ApiClient,"websocketmessage",i),Events.on(ApiClient,"websocketopen",l)),this};