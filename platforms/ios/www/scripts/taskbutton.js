$.fn.taskButton=function(e){function t(e){ApiClient.getScheduledTasks({IsEnabled:!0}).then(function(t){a(e,t)})}function a(t,a){var n=a.filter(function(t){return t.Key==e.taskKey})[0];if(e.panel&&(n?$(e.panel).show():$(e.panel).hide()),n){"Idle"==n.State?$(t).removeAttr("disabled"):$(t).attr("disabled","disabled"),$(t).attr("data-taskid",n.Id);var s=(n.CurrentProgressPercentage||0).toFixed(1);if(e.progressElem&&(e.progressElem.value=s,"Running"==n.State?e.progressElem.classList.remove("hide"):e.progressElem.classList.add("hide")),e.lastResultElem){var l=n.LastExecutionResult?n.LastExecutionResult.Status:"";e.lastResultElem.html("Failed"==l?'<span style="color:#FF0000;">'+Globalize.translate("LabelFailed")+"</span>":"Cancelled"==l?'<span style="color:#0026FF;">'+Globalize.translate("LabelCancelled")+"</span>":"Aborted"==l?'<span style="color:#FF0000;">'+Globalize.translate("LabelAbortedByServerShutdown")+"</span>":l)}}}function n(e,a){ApiClient.startScheduledTask(a).then(function(){t(e)})}function s(){var t=this,a=t.getAttribute("data-taskid"),s="scheduledTaskButton"+e.taskKey,l=(new Date).getMonth()+"5";if(appStorage.getItem(s)==l)n(t,a);else{var i=Globalize.translate("ConfirmMessageScheduledTaskButton");i+="<br/>",i+='<div style="margin-top:1em;">',i+='<a class="clearLink" href="scheduledtasks.html"><paper-button style="color:#3f51b5!important;margin:0;">'+Globalize.translate("ButtonScheduledTasks")+"</paper-button></a>",i+="</div>",Dashboard.confirm(i,Globalize.translate("HeaderConfirmation"),function(e){e&&(appStorage.setItem(s,l),n(t,a))})}}function l(){r()}function i(e,t){if("ScheduledTasksInfo"==t.MessageType){var n=t.Data;a(u,n)}}function o(){ApiClient.isWebSocketOpen()||t(u)}function r(){ApiClient.isWebSocketOpen()&&ApiClient.sendWebSocketMessage("ScheduledTasksInfoStart","1000,1000"),d&&clearInterval(d),d=setInterval(o,5e3)}function c(){ApiClient.isWebSocketOpen()&&ApiClient.sendWebSocketMessage("ScheduledTasksInfoStop"),d&&clearInterval(d)}var d,u=this;return e.panel&&$(e.panel).hide(),"off"==e.mode?(this.off("click",s),$(ApiClient).off("websocketmessage",i).off("websocketopen",l),c()):this.length&&(this.on("click",s),t(u),r(),$(ApiClient).on("websocketmessage",i).on("websocketopen",l)),this};