define([],function(){function e(e,n){var t=MediaController.getPlayerInfo().id,i=e.ids||e.items.map(function(e){return e.Id}),o={ItemIds:i.join(","),PlayCommand:n};e.startPositionTicks&&(o.startPositionTicks=e.startPositionTicks),ApiClient.sendPlayCommand(t,o)}function n(e,n){var t=MediaController.getPlayerInfo().id;ApiClient.sendPlayStateCommand(t,e,n)}function t(){function t(e,n){var t={Name:e};n&&(t.Arguments=n),s.sendCommand(t)}function o(){if(!ApiClient.isWebSocketOpen()){var e=window.ApiClient;e&&e.getSessions().then(r)}}function a(){s.isUpdating=!0,ApiClient.isWebSocketOpen()&&ApiClient.sendWebSocketMessage("SessionsStop"),u&&(clearInterval(u),u=null)}var s=this;s.name="Remote Control",s.sendCommand=function(e){var n=MediaController.getPlayerInfo().id;ApiClient.sendCommand(n,e)},s.play=function(n){e(n,"PlayNow")},s.shuffle=function(n){e({ids:[n]},"PlayShuffle")},s.instantMix=function(n){e({ids:[n]},"PlayInstantMix")},s.queue=function(n){e(n,"PlayNext")},s.queueNext=function(n){e(n,"PlayLast")},s.canQueueMediaType=function(e){return"Audio"==e||"Video"==e},s.stop=function(){n("stop")},s.nextTrack=function(){n("nextTrack")},s.previousTrack=function(){n("previousTrack")},s.seek=function(e){n("seek",{SeekPositionTicks:e})},s.pause=function(){n("Pause")},s.unpause=function(){n("Unpause")},s.mute=function(){t("Mute")},s.unMute=function(){t("Unmute")},s.toggleMute=function(){t("ToggleMute")},s.setVolume=function(e){t("SetVolume",{Volume:e})},s.volumeUp=function(){t("VolumeUp")},s.volumeDown=function(){t("VolumeDown")},s.toggleFullscreen=function(){t("ToggleFullscreen")},s.setAudioStreamIndex=function(e){t("SetAudioStreamIndex",{Index:e})},s.setSubtitleStreamIndex=function(e){t("SetSubtitleStreamIndex",{Index:e})},s.setRepeatMode=function(e){t("SetRepeatMode",{RepeatMode:e})},s.displayContent=function(e){t("DisplayContent",e)},s.getPlayerState=function(){return new Promise(function(e){var n=window.ApiClient;n?n.getSessions().then(function(n){var t=MediaController.getPlayerInfo().id,o=n.filter(function(e){return e.Id==t})[0];o&&(o=i(o)),e(o)}):e({})})};var u;s.subscribeToPlayerUpdates=function(){s.isUpdating=!0,ApiClient.isWebSocketOpen()&&ApiClient.sendWebSocketMessage("SessionsStart","100,800"),u&&(clearInterval(u),u=null),u=setInterval(o,5e3)};var l=0;s.beginPlayerUpdates=function(){0>=l&&(l=0,s.subscribeToPlayerUpdates()),l++},s.endPlayerUpdates=function(){l--,0>=l&&(a(),l=0)},s.getTargets=function(){return new Promise(function(e,n){var t={ControllableByUserId:Dashboard.getCurrentUserId()},i=window.ApiClient;i?i.getSessions(t).then(function(n){var t=n.filter(function(e){return e.DeviceId!=i.deviceId()}).map(function(e){return{name:e.DeviceName,deviceName:e.DeviceName,id:e.Id,playerName:s.name,appName:e.Client,playableMediaTypes:e.PlayableMediaTypes,isLocalPlayer:!1,supportedCommands:e.SupportedCommands}});e(t)},function(){n()}):e([])})},s.tryPair=function(){return new Promise(function(e){e()})}}function i(e){return e}function o(e,n){Events.trigger(l,e,[i(n)])}function a(){l.isUpdating&&l.subscribeToPlayerUpdates()}function r(e){var n=MediaController.getPlayerInfo().id,t=e.filter(function(e){return e.Id==n})[0];t&&o("playstatechange",t)}function s(e,n){var t=this;"Sessions"===n.MessageType?r(n.Data):"SessionEnded"===n.MessageType?MediaController.getPlayerInfo().id==n.Data.Id&&MediaController.setDefaultPlayerActive():"PlaybackStart"===n.MessageType?n.Data.DeviceId!=t.deviceId()&&MediaController.getPlayerInfo().id==n.Data.Id&&o("playbackstart",n.Data):"PlaybackStopped"===n.MessageType&&n.Data.DeviceId!=t.deviceId()&&MediaController.getPlayerInfo().id==n.Data.Id&&o("playbackstop",n.Data)}function u(e){Events.on(e,"websocketmessage",s),Events.on(e,"websocketopen",a)}var l=new t;MediaController.registerPlayer(l),window.ApiClient&&u(window.ApiClient),Events.on(ConnectionManager,"apiclientcreated",function(e,n){u(n)})});