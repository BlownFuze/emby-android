!function(e,t,a){function i(t){t=e(t)[0],N(t),Dashboard.showLoadingMsg();var a=MetadataEditor.getItemPromise(),i=MetadataEditor.getCurrentItemId()?ApiClient.getJSON(ApiClient.getUrl("Items/"+MetadataEditor.getCurrentItemId()+"/MetadataEditor")):{};Promise.all([a,i]).then(function(a){var i=a[0];if(O=a[1],M=i,!LibraryBrowser.supportsEditing(i.Type))return e(".editPageInnerContent",t)[0].style.visibility="hidden",void Dashboard.hideLoadingMsg();e(".editPageInnerContent",t)[0].style.visibility="visible";var l=O.Cultures,p=O.Countries;o(t,O),s(t,i,O.ExternalIdInfos),n(t.querySelector("#selectLanguage"),l),r(t.querySelector("#selectCountry"),p),LibraryBrowser.renderName(i,e(".itemName",t),!0),d(t,i),u(t,i,O.ParentalRatingOptions),"Photo"==i.MediaType?e("#btnEditImages",t).hide():e("#btnEditImages",t).show(),"Video"==i.MediaType&&"Episode"!=i.Type?e("#fldShortOverview",t).show():e("#fldShortOverview",t).hide(),"Video"==i.MediaType&&"Episode"!=i.Type?e("#fldTagline",t).show():e("#fldTagline",t).hide(),Dashboard.hideLoadingMsg(),C(t)})}function r(e,t){var a="";a+="<option value=''></option>";for(var i=0,r=t.length;r>i;i++){var n=t[i];a+="<option value='"+n.TwoLetterISORegionName+"'>"+n.DisplayName+"</option>"}e.innerHTML=a}function n(e,t){var a="";a+="<option value=''></option>";for(var i=0,r=t.length;r>i;i++){var n=t[i];a+="<option value='"+n.TwoLetterISOLanguageName+"'>"+n.DisplayName+"</option>"}e.innerHTML=a}function o(t,a){a.ContentTypeOptions.length?e("#fldContentType",t).show():e("#fldContentType",t).hide();var i=a.ContentTypeOptions.map(function(e){return'<option value="'+e.Value+'">'+e.Name+"</option>"}).join("");e("#selectContentType",t).html(i).val(a.ContentType||"")}function l(){var t=this.getAttribute("data-formatstring"),a=this.getAttribute("data-buttonclass");this.value?e("."+a).attr("href",t.replace("{0}",this.value)):e("."+a).attr("href","#")}function s(t,a,i){for(var r="",n=a.ProviderIds||{},o=0,s=i.length;s>o;o++){var d=i[o],u="txt1"+d.Key,p="btnOpen1"+d.Key,m=d.UrlFormatString||"",c=Globalize.translate("LabelDynamicExternalId").replace("{0}",d.Name);r+="<div>";var v=n[d.Key]||"";r+='<paper-input style="display:inline-block;width:80%;" class="txtExternalId" value="'+v+'" data-providerkey="'+d.Key+'" data-formatstring="'+m+'" data-buttonclass="'+p+'" id="'+u+'" label="'+c+'"></paper-input>',m&&(r+='<a class="clearLink '+p+'" href="#" target="_blank" data-role="none" style="float: none; width: 1.75em"><paper-icon-button icon="open-in-browser"></paper-icon-button></a>'),r+="</div>"}var f=e(".externalIds",t).html(r).trigger("create");e(".txtExternalId",f).on("change",l).trigger("change")}function d(t,a){a.Path&&"Remote"!=a.LocationType?e("#fldPath",t).show():e("#fldPath",t).hide(),"Series"==a.Type?e("#fldSeriesRuntime",t).show():e("#fldSeriesRuntime",t).hide(),"Series"==a.Type||"Person"==a.Type?e("#fldEndDate",t).show():e("#fldEndDate",t).hide(),"Movie"==a.Type||"Game"==a.MediaType||"Trailer"==a.MediaType||"MusicVideo"==a.Type?(e("#fldBudget",t).show(),e("#fldRevenue",t).show()):(e("#fldBudget",t).hide(),e("#fldRevenue",t).hide()),"MusicAlbum"==a.Type?e("#albumAssociationMessage",t).show():e("#albumAssociationMessage",t).hide(),"Game"==a.MediaType?e("#fldPlayers",t).show():e("#fldPlayers",t).hide(),"Movie"==a.Type||"Trailer"==a.Type?(e("#fldCriticRating",t).show(),e("#fldCriticRatingSummary",t).show()):(e("#fldCriticRating",t).hide(),e("#fldCriticRatingSummary",t).hide()),"Movie"==a.Type?e("#fldAwardSummary",t).show():e("#fldAwardSummary",t).hide(),"Movie"==a.Type||"Trailer"==a.Type?e("#fldMetascore",t).show():e("#fldMetascore",t).hide(),"Series"==a.Type?(e("#fldStatus",t).show(),e("#fldAirDays",t).show(),e("#fldAirTime",t).show()):(e("#fldStatus",t).hide(),e("#fldAirDays",t).hide(),e("#fldAirTime",t).hide()),"Video"==a.MediaType&&"TvChannel"!=a.Type?e("#fld3dFormat",t).show():e("#fld3dFormat",t).hide(),"Audio"==a.Type?e("#fldAlbumArtist",t).show():e("#fldAlbumArtist",t).hide(),"Audio"==a.Type||"MusicVideo"==a.Type?(e("#fldArtist",t).show(),e("#fldAlbum",t).show()):(e("#fldArtist",t).hide(),e("#fldAlbum",t).hide()),"Episode"==a.Type?e("#collapsibleDvdEpisodeInfo",t).show():e("#collapsibleDvdEpisodeInfo",t).hide(),"Episode"==a.Type&&0==a.ParentIndexNumber?e("#collapsibleSpecialEpisodeInfo",t).show():e("#collapsibleSpecialEpisodeInfo",t).hide(),"Person"==a.Type||"Genre"==a.Type||"Studio"==a.Type||"GameGenre"==a.Type||"MusicGenre"==a.Type||"TvChannel"==a.Type?(e("#fldCommunityRating",t).hide(),e("#fldCommunityVoteCount",t).hide(),e("#genresCollapsible",t).hide(),e("#peopleCollapsible",t).hide(),e("#studiosCollapsible",t).hide(),"TvChannel"==a.Type?e("#fldOfficialRating",t).show():e("#fldOfficialRating",t).hide(),e("#fldCustomRating",t).hide()):(e("#fldCommunityRating",t).show(),e("#fldCommunityVoteCount",t).show(),e("#genresCollapsible",t).show(),e("#peopleCollapsible",t).show(),e("#studiosCollapsible",t).show(),e("#fldOfficialRating",t).show(),e("#fldCustomRating",t).show()),"Movie"==a.Type||"Trailer"==a.Type||"MusicArtist"==a.Type?e("#countriesCollapsible",t).show():e("#countriesCollapsible",t).hide(),"TvChannel"==a.Type?(e("#tagsCollapsible",t).hide(),e("#metadataSettingsCollapsible",t).hide(),e("#fldPremiereDate",t).hide(),e("#fldSortName",t).hide(),e("#fldDateAdded",t).hide(),e("#fldYear",t).hide()):(e("#tagsCollapsible",t).show(),e("#metadataSettingsCollapsible",t).show(),e("#fldPremiereDate",t).show(),e("#fldSortName",t).show(),e("#fldDateAdded",t).show(),e("#fldYear",t).show()),Dashboard.getCurrentUser().then(function(i){-1!=LibraryBrowser.getMoreCommands(a,i).indexOf("identify")?e("#btnIdentify",t).show():e("#btnIdentify",t).hide()}),"Movie"==a.Type||"Trailer"==a.Type||"BoxSet"==a.Type?e("#keywordsCollapsible",t).show():e("#keywordsCollapsible",t).hide(),"Video"==a.MediaType&&"TvChannel"!=a.Type?e("#fldSourceType",t).show():e("#fldSourceType",t).hide(),"Person"==a.Type?(t.querySelector("#txtProductionYear").label=Globalize.translate("LabelBirthYear"),t.querySelector("label[for='txtPremiereDate']").innerHTML=Globalize.translate("LabelBirthDate"),t.querySelector("label[for='txtEndDate']").innerHTML=Globalize.translate("LabelDeathDate"),e("#fldPlaceOfBirth",t).show()):(t.querySelector("#txtProductionYear").label=Globalize.translate("LabelYear"),t.querySelector("label[for='txtPremiereDate']").innerHTML=Globalize.translate("LabelReleaseDate"),t.querySelector("label[for='txtEndDate']").innerHTML=Globalize.translate("LabelEndDate"),e("#fldPlaceOfBirth",t).hide()),"Video"==a.MediaType&&"TvChannel"!=a.Type?e("#fldOriginalAspectRatio",t).show():e("#fldOriginalAspectRatio",t).hide(),"Audio"==a.Type||"Episode"==a.Type||"Season"==a.Type?(e("#fldIndexNumber",t).show(),t.querySelector("#txtIndexNumber").label=Globalize.translate("Episode"==a.Type?"LabelEpisodeNumber":"Season"==a.Type?"LabelSeasonNumber":"Audio"==a.Type?"LabelTrackNumber":"LabelNumber")):e("#fldIndexNumber",t).hide(),"Audio"==a.Type||"Episode"==a.Type?(e("#fldParentIndexNumber",t).show(),t.querySelector("#txtParentIndexNumber").label=Globalize.translate("Episode"==a.Type?"LabelSeasonNumber":"Audio"==a.Type?"LabelDiscNumber":"LabelParentNumber")):e("#fldParentIndexNumber",t).hide(),"Series"==a.Type?e("#fldDisplaySpecialsInline",t).show():e("#fldDisplaySpecialsInline",t).hide(),"BoxSet"==a.Type?(e("#fldDisplayOrder",t).show(),e("#labelDisplayOrder",t).html(Globalize.translate("LabelTitleDisplayOrder")),e("#selectDisplayOrder",t).html('<option value="SortName">'+Globalize.translate("OptionSortName")+'</option><option value="PremiereDate">'+Globalize.translate("OptionReleaseDate")+"</option>")):(e("#selectDisplayOrder",t).html(""),e("#fldDisplayOrder",t).hide());var i=e(".fldDisplaySetting",t);i.filter(function(e){return"none"!=i[e].style.display}).length?e("#collapsibleDisplaySettings",t).show():e("#collapsibleDisplaySettings",t).hide()}function u(t,a,i){var r=e("#selectOfficialRating",t);v(i,r,a.OfficialRating),r.val(a.OfficialRating||""),r=e("#selectCustomRating",t),v(i,r,a.CustomRating),r.val(a.CustomRating||"");var n=e("#selectStatus",t);f(n),n.val(a.Status||""),e("#select3dFormat",t).val(a.Video3DFormat||""),e(".chkAirDay",t).each(function(){this.checked=-1!=(a.AirDays||[]).indexOf(this.getAttribute("data-day"))}),h(e("#listCountries",t),a.ProductionLocations||[]),h(e("#listGenres",t),a.Genres),p(t,a.People||[]),h(e("#listStudios",t),(a.Studios||[]).map(function(e){return e.Name||""})),h(e("#listTags",t),a.Tags),h(e("#listKeywords",t),a.Keywords);var o=a.LockData||!1,l=t.querySelector("#chkLockData");l.checked=o,l.checked?e("#providerSettingsContainer",t).hide():e("#providerSettingsContainer",t).show(),g(t,a,a.LockedFields),t.querySelector("#chkDisplaySpecialsInline").checked=a.DisplaySpecialsWithSeasons||!1,e("#txtPath",t).val(a.Path||""),e("#txtName",t).val(a.Name||""),t.querySelector("#txtOverview").value=a.Overview||"",e("#txtShortOverview",t).val(a.ShortOverview||""),e("#txtTagline",t).val(a.Taglines&&a.Taglines.length?a.Taglines[0]:""),e("#txtSortName",t).val(a.ForcedSortName||""),e("#txtDisplayMediaType",t).val(a.DisplayMediaType||""),e("#txtCommunityRating",t).val(a.CommunityRating||""),e("#txtCommunityVoteCount",t).val(a.VoteCount||""),e("#txtHomePageUrl",t).val(a.HomePageUrl||""),e("#txtAwardSummary",t).val(a.AwardSummary||""),e("#txtMetascore",t).val(a.Metascore||""),e("#txtBudget",t).val(a.Budget||""),e("#txtRevenue",t).val(a.Revenue||""),e("#txtCriticRating",t).val(a.CriticRating||""),e("#txtCriticRatingSummary",t).val(a.CriticRatingSummary||""),e("#txtIndexNumber",t).val("IndexNumber"in a?a.IndexNumber:""),e("#txtParentIndexNumber",t).val("ParentIndexNumber"in a?a.ParentIndexNumber:""),e("#txtPlayers",t).val(a.Players||""),e("#txtAbsoluteEpisodeNumber",t).val("AbsoluteEpisodeNumber"in a?a.AbsoluteEpisodeNumber:""),e("#txtDvdEpisodeNumber",t).val("DvdEpisodeNumber"in a?a.DvdEpisodeNumber:""),e("#txtDvdSeasonNumber",t).val("DvdSeasonNumber"in a?a.DvdSeasonNumber:""),e("#txtAirsBeforeSeason",t).val("AirsBeforeSeasonNumber"in a?a.AirsBeforeSeasonNumber:""),e("#txtAirsAfterSeason",t).val("AirsAfterSeasonNumber"in a?a.AirsAfterSeasonNumber:""),e("#txtAirsBeforeEpisode",t).val("AirsBeforeEpisodeNumber"in a?a.AirsBeforeEpisodeNumber:""),e("#txtAlbum",t).val(a.Album||""),e("#txtAlbumArtist",t).val((a.AlbumArtists||[]).map(function(e){return e.Name}).join(";")),e("#selectDisplayOrder",t).val(a.DisplayOrder),e("#txtArtist",t).val((a.ArtistItems||[]).map(function(e){return e.Name}).join(";"));var s;if(a.DateCreated)try{s=parseISO8601Date(a.DateCreated,{toLocal:!0}),e("#txtDateAdded",t).val(s.toISOString().slice(0,10))}catch(d){e("#txtDateAdded",t).val("")}else e("#txtDateAdded",t).val("");if(a.PremiereDate)try{s=parseISO8601Date(a.PremiereDate,{toLocal:!0}),e("#txtPremiereDate",t).val(s.toISOString().slice(0,10))}catch(d){e("#txtPremiereDate",t).val("")}else e("#txtPremiereDate",t).val("");if(a.EndDate)try{s=parseISO8601Date(a.EndDate,{toLocal:!0}),e("#txtEndDate",t).val(s.toISOString().slice(0,10))}catch(d){e("#txtEndDate",t).val("")}else e("#txtEndDate",t).val("");e("#txtProductionYear",t).val(a.ProductionYear||""),e("#txtAirTime",t).val(a.AirTime||"");var u=a.ProductionLocations&&a.ProductionLocations.length?a.ProductionLocations[0]:"";if(e("#txtPlaceOfBirth",t).val(u),e("#txtOriginalAspectRatio",t).val(a.AspectRatio||""),e("#selectLanguage",t).val(a.PreferredMetadataLanguage||""),e("#selectCountry",t).val(a.PreferredMetadataCountryCode||""),a.RunTimeTicks){var m=a.RunTimeTicks/6e8;e("#txtSeriesRuntime",t).val(Math.round(m))}else e("#txtSeriesRuntime",t).val("")}function p(t,a){for(var i="",r="",n=e("#peopleList",t),o=0,l=a.length;l>o;o++){var s=a[o],d=s.Type||Globalize.translate("PersonTypePerson");d!=i&&(r+='<li data-role="list-divider">'+d+"</li>",i=d),r+='<li><a class="btnEditPerson" href="#" data-index="'+o+'">',r+="<h3>"+(s.Name||"")+"</h3>",s.Role&&s.Role!=i&&(r+="<p>"+s.Role+"</p>"),r+="</a>",r+='<a class="btnDeletePerson" href="#" data-icon="delete" data-index="'+o+'">'+Globalize.translate("Delete")+"</a>",r+="</li>"}n.html(r).listview("refresh"),e(".btnDeletePerson",n).on("click",function(){var e=parseInt(this.getAttribute("data-index"));M.People.splice(e,1),p(t,M.People)}),e(".btnEditPerson",n).on("click",function(){var e=parseInt(this.getAttribute("data-index"));m(t,M.People[e],e)})}function m(t,a,i){e("#popupEditPerson",t).popup("open"),e("#txtPersonName",t).val(a.Name||""),e("#selectPersonType",t).val(a.Type||""),e("#txtPersonRole",t).val(a.Role||""),null==i&&(i=""),e("#fldPersonIndex",t).val(i)}function c(t){e("#popupEditPerson",t).popup("close");var a,i=e("#fldPersonIndex",t).val(),r=!0;i?(r=!1,i=parseInt(i),a=M.People[i]):a={},a.Name=e("#txtPersonName",t).val(),a.Type=e("#selectPersonType",t).val(),a.Role=e("#txtPersonRole",t).val(),r&&M.People.push(a),p(t,M.People)}function v(e,t,a){var i="";i+="<option value=''></option>";var r,n,o,l=[],s=!1;for(r=0,n=e.length;n>r;r++)o=e[r],l.push({Name:o.Name,Value:o.Name}),o.Name==a&&(s=!0);for(a&&!s&&l.push({Name:a,Value:a}),r=0,n=l.length;n>r;r++)o=l[r],i+="<option value='"+o.Value+"'>"+o.Name+"</option>";t.html(i)}function f(e){var t="";t+="<option value=''></option>",t+="<option value='Continuing'>"+Globalize.translate("OptionContinuing")+"</option>",t+="<option value='Ended'>"+Globalize.translate("OptionEnded")+"</option>",e.html(t)}function h(e,t,a){t=t||[],"undefined"==typeof a?t.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}):t=a(t);for(var i="",r=0;r<t.length;r++)i+='<li data-mini="true"><a class="data">'+t[r]+'</a><a href="#" onclick="EditItemMetadataPage.removeElementFromListview(this)" class="btnRemoveFromEditorList"></a></li>';e.html(i).listview("refresh")}function b(t){return t.find("a.data").map(function(){return e(this).text()}).get()}function y(e,t){for(var a="",i=0;i<e.length;i++){var r=e[i],n=r.name,o=r.value||r.name,l=-1==t.indexOf(o)?" checked":"";a+='<paper-checkbox class="selectLockedField" data-value="'+o+'" style="display:block;margin:1em 0;"'+l+">"+n+"</paper-checkbox>"}return a}function g(t,a,i){var r=e("#providerSettingsContainer",t);i=i||new Array;var n=[{name:Globalize.translate("OptionName"),value:"Name"},{name:Globalize.translate("OptionOverview"),value:"Overview"},{name:Globalize.translate("OptionGenres"),value:"Genres"},{name:Globalize.translate("OptionParentalRating"),value:"OfficialRating"},{name:Globalize.translate("OptionPeople"),value:"Cast"}];n.push("Person"==a.Type?{name:Globalize.translate("OptionBirthLocation"),value:"ProductionLocations"}:{name:Globalize.translate("OptionProductionLocations"),value:"ProductionLocations"}),"Series"==a.Type&&n.push({name:Globalize.translate("OptionRuntime"),value:"Runtime"}),n.push({name:Globalize.translate("OptionStudios"),value:"Studios"}),n.push({name:Globalize.translate("OptionTags"),value:"Tags"}),n.push({name:Globalize.translate("OptionKeywords"),value:"Keywords"}),n.push({name:Globalize.translate("OptionImages"),value:"Images"}),n.push({name:Globalize.translate("OptionBackdrops"),value:"Backdrops"}),"Game"==a.Type&&n.push({name:Globalize.translate("OptionScreenshots"),value:"Screenshots"});var o="";o+="<h1>"+Globalize.translate("HeaderEnabledFields")+"</h1>",o+="<p>"+Globalize.translate("HeaderEnabledFieldsHelp")+"</p>",o+=y(n,i),r.html(o)}function T(t){return e(".chkAirDay:checked",t).map(function(){return this.getAttribute("data-day")}).get()}function S(t){return e("#txtAlbumArtist",t).val().trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function x(t){return e("#txtArtist",t).val().trim().split(";").filter(function(e){return e.length>0}).map(function(e){return{Name:e}})}function P(){var t=this;t.onSubmit=function(){var a=this,i={Id:M.Id,Name:e("#txtName",a).val(),ForcedSortName:e("#txtSortName",a).val(),DisplayMediaType:e("#txtDisplayMediaType",a).val(),CommunityRating:e("#txtCommunityRating",a).val(),VoteCount:e("#txtCommunityVoteCount",a).val(),HomePageUrl:e("#txtHomePageUrl",a).val(),Budget:e("#txtBudget",a).val(),Revenue:e("#txtRevenue",a).val(),CriticRating:e("#txtCriticRating",a).val(),CriticRatingSummary:e("#txtCriticRatingSummary",a).val(),IndexNumber:e("#txtIndexNumber",a).val()||null,DisplaySpecialsWithSeasons:a.querySelector("#chkDisplaySpecialsInline").checked,AbsoluteEpisodeNumber:e("#txtAbsoluteEpisodeNumber",a).val(),DvdEpisodeNumber:e("#txtDvdEpisodeNumber",a).val(),DvdSeasonNumber:e("#txtDvdSeasonNumber",a).val(),AirsBeforeSeasonNumber:e("#txtAirsBeforeSeason",a).val(),AirsAfterSeasonNumber:e("#txtAirsAfterSeason",a).val(),AirsBeforeEpisodeNumber:e("#txtAirsBeforeEpisode",a).val(),ParentIndexNumber:e("#txtParentIndexNumber",a).val()||null,DisplayOrder:e("#selectDisplayOrder",a).val(),Players:e("#txtPlayers",a).val(),Album:e("#txtAlbum",a).val(),AlbumArtist:S(a),ArtistItems:x(a),Metascore:e("#txtMetascore",a).val(),AwardSummary:e("#txtAwardSummary",a).val(),Overview:e("#txtOverview",a).val(),ShortOverview:e("#txtShortOverview",a).val(),Status:e("#selectStatus",a).val(),AirDays:T(a),AirTime:e("#txtAirTime",a).val(),Genres:b(e("#listGenres",a)),ProductionLocations:b(e("#listCountries",a)),Tags:b(e("#listTags",a)),Keywords:b(e("#listKeywords",a)),Studios:b(e("#listStudios",a)).map(function(e){return{Name:e}}),PremiereDate:EditItemMetadataPage.getDateFromForm(a,"#txtPremiereDate","PremiereDate"),DateCreated:EditItemMetadataPage.getDateFromForm(a,"#txtDateAdded","DateCreated"),EndDate:EditItemMetadataPage.getDateFromForm(a,"#txtEndDate","EndDate"),ProductionYear:e("#txtProductionYear",a).val(),AspectRatio:e("#txtOriginalAspectRatio",a).val(),Video3DFormat:e("#select3dFormat",a).val(),OfficialRating:e("#selectOfficialRating",a).val(),CustomRating:e("#selectCustomRating",a).val(),People:M.People,LockData:a.querySelector("#chkLockData").checked,LockedFields:e(".selectLockedField",a).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-value")})};if(i.ProviderIds=e.extend({},M.ProviderIds||{}),e(".txtExternalId",a).each(function(){var e=this.getAttribute("data-providerkey");i.ProviderIds[e]=this.value}),i.PreferredMetadataLanguage=e("#selectLanguage",a).val(),i.PreferredMetadataCountryCode=e("#selectCountry",a).val(),"Person"==M.Type){var r=e("#txtPlaceOfBirth",a).val();i.ProductionLocations=r?[r]:[]}if("Series"==M.Type){var n=e("#txtSeriesRuntime",a).val();i.RunTimeTicks=n?6e8*n:null}var o=e("#txtTagline",a).val();return i.Taglines=o?[o]:[],t.submitUpdatedItem(a,i),!1},t.submitUpdatedItem=function(t,a){function i(){Dashboard.alert(Globalize.translate("MessageItemSaved")),MetadataEditor.getItemPromise().then(function(e){r.trigger("itemsaved",[e]),C(r)})}var r=e(t).parents(".page");N(r),ApiClient.updateItem(a).then(function(){var r=e("#selectContentType",t).val()||"";(O.ContentType||"")!=r?ApiClient.ajax({url:ApiClient.getUrl("Items/"+a.Id+"/ContentType",{ContentType:r}),type:"POST"}).then(function(){i()}):i()})},t.getDateFromForm=function(t,a,i){var r=e(a,t).val();if(!r)return null;if(M[i]){var n=parseISO8601Date(M[i],{toLocal:!0}),o=n.toISOString().split("T");if(0==o[0].indexOf(r)){var l=o[1];r+="T"+l}}return r},t.addElementToEditableListview=function(t,a){var i=e(t).parents('*[data-role="editableListviewContainer"]'),r=i.find(".txtEditableListview, select"),n=r.val();if(""!=n){var o=i.find('ul[data-role="listview"]'),l=b(o);l.push(n),h(o,l,a)}},t.setProviderSettingsContainerVisibility=function(t){e(t).prop("checked")?e("#providerSettingsContainer").hide():e("#providerSettingsContainer").show()},t.removeElementFromListview=function(t){var a=e(t).parents('ul[data-role="listview"]');e(t).parent().remove(),a.listview("refresh")},t.onRefreshFormSubmit=function(){var t=e(this).parents(".page");return w(t),!1},t.onPersonInfoFormSubmit=function(){var t=e(this).parents(".page");return c(t),!1}}function I(t){e(".popupAdvancedRefresh",t).popup("open"),e("#selectMetadataRefreshMode",t).val("all"),e("#selectImageRefreshMode",t).val("missing")}function w(t){var a=e("#selectMetadataRefreshMode",t).val(),i=e("#selectImageRefreshMode",t).val();A(t,{Recursive:!0,ImageRefreshMode:"none"==i?"None":"FullRefresh",MetadataRefreshMode:"none"==a?"None":"local"==a?"ValidationOnly":"FullRefresh",ReplaceAllImages:"all"==i,ReplaceAllMetadata:"all"==a}),e(".popupAdvancedRefresh",t).popup("close")}function A(e,t){Dashboard.showLoadingMsg(),ApiClient.refreshItem(M.Id,t),ApiClient.isWebSocketOpen()||setTimeout(function(){Dashboard.hideLoadingMsg()},5e3)}function D(t,a){var r=a;if("LibraryChanged"===r.MessageType&&-1!=r.Data.ItemsUpdated.indexOf(M.Id)){var n=e.mobile.activePage;i(n)}}function C(){Events.on(ApiClient,"websocketmessage",D)}function N(){Events.off(ApiClient,"websocketmessage",D)}function R(e,t){M&&M.Id==t&&Dashboard.navigate(M.ParentId?"edititemmetadata.html?id="+M.ParentId:"edititemmetadata.html")}function E(e,t){Dashboard.getCurrentUser().then(function(a){var i=LibraryBrowser.getMoreCommands(M,a),r=[];r.push({name:Globalize.translate("ButtonAdvancedRefresh"),id:"refresh",ironIcon:"refresh"}),-1!=i.indexOf("delete")&&r.push({name:Globalize.translate("ButtonDelete"),id:"delete",ironIcon:"delete"}),r.push({name:Globalize.translate("ButtonEditImages"),id:"editimages",ironIcon:"photo"}),require(["actionsheet"],function(a){a.show({items:r,positionTo:t,callback:function(t){switch(t){case"refresh":I(e);break;case"delete":LibraryBrowser.deleteItems([M.Id]);break;case"editimages":LibraryBrowser.editImages(M.Id)}}})})})}var M,O;a.EditItemMetadataPage=new P,e(t).on("pageinit","#editItemMetadataPage",function(){var t=this;e(".btnSimpleRefresh",this).on("click",function(){I(t)}),e(".btnEditImages",t).on("click",function(){LibraryBrowser.editImages(M.Id)}),e("#btnIdentify",t).on("click",function(){LibraryBrowser.identifyItem(M.Id)}),e(".libraryTree",t).on("itemclicked",function(e,r){r.id!=M.Id&&(a.location.hash="editItemMetadataPage?id="+r.id,i(t))}),e("#btnAddPerson",t).on("click",function(){m(t,{})}),e(".editItemMetadataForm").off("submit",EditItemMetadataPage.onSubmit).on("submit",EditItemMetadataPage.onSubmit),e(".popupEditPersonForm").off("submit",EditItemMetadataPage.onPersonInfoFormSubmit).on("submit",EditItemMetadataPage.onPersonInfoFormSubmit),e(".popupAdvancedRefreshForm").off("submit",EditItemMetadataPage.onRefreshFormSubmit).on("submit",EditItemMetadataPage.onRefreshFormSubmit),e(".btnMore",t).on("click",function(){E(t,this)})}).on("pageshow","#editItemMetadataPage",function(){var e=this;Events.on(LibraryBrowser,"itemdeleting",R),i(e)}).on("pagebeforehide","#editItemMetadataPage",function(){var e=this;Events.off(LibraryBrowser,"itemdeleting",R),N(e)})}(jQuery,document,window);