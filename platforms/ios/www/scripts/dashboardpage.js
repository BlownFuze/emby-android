var DashboardPage={newsStartIndex:0,onPageShow:function(){var e=this,a=ApiClient;a&&(Dashboard.lastSystemInfo&&Dashboard.setPageTitle(Dashboard.lastSystemInfo.ServerName),DashboardPage.newsStartIndex=0,Dashboard.showLoadingMsg(),DashboardPage.pollForInfo(e),DashboardPage.startInterval(a),Events.on(a,"websocketmessage",DashboardPage.onWebSocketMessage),Events.on(a,"websocketopen",DashboardPage.onWebSocketOpen),DashboardPage.lastAppUpdateCheck=null,DashboardPage.lastPluginUpdateCheck=null,Dashboard.getPluginSecurityInfo().then(function(a){DashboardPage.renderSupporterIcon(e,a)}),DashboardPage.reloadSystemInfo(e),DashboardPage.reloadNews(e),DashboardPage.sessionUpdateTimer=setInterval(DashboardPage.refreshSessionsLocally,6e4),$(".activityItems",e).activityLogList(),$(".swaggerLink",e).attr("href",a.getUrl("swagger-ui/index.html",{api_key:ApiClient.accessToken()})))},onPageHide:function(){var e=this;$(".activityItems",e).activityLogList("destroy");var a=ApiClient;a&&(Events.off(a,"websocketmessage",DashboardPage.onWebSocketMessage),Events.off(a,"websocketopen",DashboardPage.onWebSocketOpen),DashboardPage.stopInterval(a)),DashboardPage.sessionUpdateTimer&&clearInterval(DashboardPage.sessionUpdateTimer)},renderPaths:function(e,a){$("#cachePath",e).html(a.CachePath),$("#logPath",e).html(a.LogPath),$("#transcodingTemporaryPath",e).html(a.TranscodingTempPath),$("#metadataPath",e).html(a.InternalMetadataPath)},refreshSessionsLocally:function(){var e=DashboardPage.sessionsList;e&&DashboardPage.renderActiveConnections($.mobile.activePage,e)},reloadSystemInfo:function(e){ApiClient.getSystemInfo().then(function(a){Dashboard.setPageTitle(a.ServerName),Dashboard.updateSystemInfo(a),$("#appVersionNumber",e).html(Globalize.translate("LabelVersionNumber").replace("{0}",a.Version)),$("#ports",e).html(a.SupportsHttps?Globalize.translate("LabelRunningOnPorts","<b>"+a.HttpServerPortNumber+"</b>","<b>"+a.HttpsPortNumber+"</b>"):Globalize.translate("LabelRunningOnPort","<b>"+a.HttpServerPortNumber+"</b>")),a.CanSelfRestart?$(".btnRestartContainer",e).removeClass("hide"):$(".btnRestartContainer",e).addClass("hide"),DashboardPage.renderUrls(e,a),DashboardPage.renderPendingInstallations(e,a),a.CanSelfUpdate?($("#btnUpdateApplicationContainer",e).show(),$("#btnManualUpdateContainer",e).hide()):($("#btnUpdateApplicationContainer",e).hide(),$("#btnManualUpdateContainer",e).show()),DashboardPage.renderPaths(e,a),DashboardPage.renderHasPendingRestart(e,a.HasPendingRestart)})},reloadNews:function(e){var a={StartIndex:DashboardPage.newsStartIndex,Limit:7};ApiClient.getProductNews(a).then(function(t){var n=t.Items.map(function(e){var a="";a+='<a class="clearLink" href="'+e.Link+'" target="_blank">',a+="<paper-icon-item>",a+='<paper-fab mini class="blue" icon="dvr" item-icon></paper-fab>',a+="<paper-item-body three-line>",a+="<div>",a+=e.Title,a+="</div>",a+="<div secondary>";var t=parseISO8601Date(e.Date,{toLocal:!0});return a+=t.toLocaleDateString(),a+="</div>",a+="<div secondary>",a+=e.Description,a+="</div>",a+="</paper-item-body>",a+="</paper-icon-item>",a+="</a>"}),s="";s+="<div>",s+=LibraryBrowser.getQueryPagingHtml({startIndex:a.StartIndex,limit:a.Limit,totalRecordCount:t.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1}),s+="</div>",n=n.join("")+s;var i=$(".latestNewsItems",e).html(n).trigger("create");$(".btnNextPage",i).on("click",function(){DashboardPage.newsStartIndex+=a.Limit,DashboardPage.reloadNews(e)}),$(".btnPreviousPage",i).on("click",function(){DashboardPage.newsStartIndex-=a.Limit,DashboardPage.reloadNews(e)})})},startInterval:function(e){e.isWebSocketOpen()&&(e.sendWebSocketMessage("SessionsStart","0,1500"),e.sendWebSocketMessage("ScheduledTasksInfoStart","0,1000"))},stopInterval:function(e){e.isWebSocketOpen()&&(e.sendWebSocketMessage("SessionsStop"),e.sendWebSocketMessage("ScheduledTasksInfoStop"))},onWebSocketMessage:function(e,a){var t=$.mobile.activePage;if("Sessions"==a.MessageType)DashboardPage.renderInfo(t,a.Data);else if("RestartRequired"==a.MessageType)DashboardPage.renderHasPendingRestart(t,!0);else if("ServerShuttingDown"==a.MessageType)DashboardPage.renderHasPendingRestart(t,!0);else if("ServerRestarting"==a.MessageType)DashboardPage.renderHasPendingRestart(t,!0);else if("ScheduledTasksInfo"==a.MessageType){var n=a.Data;DashboardPage.renderRunningTasks(t,n)}else("PackageInstalling"==a.MessageType||"PackageInstallationCompleted"==a.MessageType)&&(DashboardPage.pollForInfo(t,!0),DashboardPage.reloadSystemInfo(t))},onWebSocketOpen:function(){var e=this;DashboardPage.startInterval(e)},pollForInfo:function(e,a){var t=window.ApiClient;t&&(t.getSessions().then(function(t){DashboardPage.renderInfo(e,t,a)}),t.getScheduledTasks().then(function(a){DashboardPage.renderRunningTasks(e,a)}))},renderInfo:function(e,a,t){DashboardPage.renderActiveConnections(e,a),DashboardPage.renderPluginUpdateInfo(e,t),Dashboard.hideLoadingMsg()},renderActiveConnections:function(e,a){var t="";DashboardPage.sessionsList=a;var n=$(".activeDevices",e);$(".card",n).addClass("deadSession");for(var s=0,i=a.length;i>s;s++){var r=a[s],o="session"+r.Id,l=$("#"+o,e);if(l.length)DashboardPage.updateSession(l,r);else{var d=r.NowPlayingItem,g=d?"card activeSession":"card activeSession";r.TranscodingInfo&&r.TranscodingInfo.CompletionPercentage&&(g+=" transcodingSession"),t+='<div class="'+g+'" id="'+o+'">',t+='<div class="cardBox" style="box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);margin:4px;">',t+='<div class="cardScalable">',t+='<div class="cardPadder"></div>',t+='<div class="cardContent">',t+='<div class="sessionNowPlayingContent"';var c=DashboardPage.getNowPlayingImageUrl(d);c&&(t+=' data-src="'+c+'" style="display:inline-block;background-image:url(\''+c+"');\""),t+="></div>",t+='<div class="sessionNowPlayingInnerContent">',t+='<div class="sessionAppInfo">';var p=DashboardPage.getClientImage(r);p&&(t+=p),t+='<div class="sessionAppName" style="display:inline-block;">',t+='<div class="sessionDeviceName">'+r.DeviceName+"</div>",t+='<div class="sessionAppSecondaryText">'+DashboardPage.getAppSecondaryText(r)+"</div>",t+="</div>",t+="</div>",t+='<div class="sessionUserInfo">';var m=DashboardPage.getUserImage(r);m?(t+='<div class="sessionUserImage" data-src="'+m+'">',t+='<img src="'+m+'" />'):t+='<div class="sessionUserImage">',t+="</div>",t+='<div class="sessionUserName">',t+=DashboardPage.getUsersHtml(r),t+="</div>",t+="</div>";var h=DashboardPage.getNowPlayingName(r);if(t+='<div class="sessionNowPlayingInfo" data-imgsrc="'+h.image+'">',t+=h.html,t+="</div>",d&&d.RunTimeTicks){var u=r.PlayState.PositionTicks||0,b=100*u/d.RunTimeTicks;t+='<progress class="itemProgressBar playbackProgress" min="0" max="100" value="'+b+'"></progress>'}else t+='<progress class="itemProgressBar playbackProgress" min="0" max="100" style="display:none;"></progress>';t+=r.TranscodingInfo&&r.TranscodingInfo.CompletionPercentage?'<progress class="itemProgressBar transcodingProgress" min="0" max="100" value="'+r.TranscodingInfo.CompletionPercentage.toFixed(1)+'"></progress>':'<progress class="itemProgressBar transcodingProgress" min="0" max="100" style="display:none;"></progress>',t+="</div>",t+='<div class="cardOverlayTarget">',t+='<div class="sessionNowPlayingStreamInfo">'+DashboardPage.getSessionNowPlayingStreamInfo(r)+"</div>",t+='<div class="sessionNowPlayingTime">'+DashboardPage.getSessionNowPlayingTime(r)+"</div>",t+=r.TranscodingInfo&&r.TranscodingInfo.Framerate?'<div class="sessionTranscodingFramerate">'+r.TranscodingInfo.Framerate+" fps</div>":'<div class="sessionTranscodingFramerate"></div>',t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>"}}n.append(t).createSessionItemMenus().trigger("create"),$(".deadSession",n).remove()},getSessionNowPlayingStreamInfo:function(e){var a="";if(a+="<div>",e.TranscodingInfo&&e.TranscodingInfo.IsAudioDirect&&e.TranscodingInfo.IsVideoDirect?a+=Globalize.translate("LabelPlayMethodDirectStream"):"Transcode"==e.PlayState.PlayMethod?a+=Globalize.translate("LabelPlayMethodTranscoding"):"DirectStream"==e.PlayState.PlayMethod?a+=Globalize.translate("LabelPlayMethodDirectStream"):"DirectPlay"==e.PlayState.PlayMethod&&(a+=Globalize.translate("LabelPlayMethodDirectPlay")),a+="</div>",e.TranscodingInfo){a+="<br/>";var t=[];e.TranscodingInfo.Container&&t.push(e.TranscodingInfo.Container),e.TranscodingInfo.Bitrate&&t.push(e.TranscodingInfo.Bitrate>1e6?(e.TranscodingInfo.Bitrate/1e6).toFixed(1)+" Mbps":Math.floor(e.TranscodingInfo.Bitrate/1e3)+" kbps"),t.length&&(a+="<div>"+t.join(" ")+"</div>"),e.TranscodingInfo.VideoCodec&&(a+="<div>"+Globalize.translate("LabelVideoCodec").replace("{0}",e.TranscodingInfo.VideoCodec)+"</div>"),e.TranscodingInfo.AudioCodec&&e.TranscodingInfo.AudioCodec!=e.TranscodingInfo.Container&&(a+="<div>"+Globalize.translate("LabelAudioCodec").replace("{0}",e.TranscodingInfo.AudioCodec)+"</div>")}return a},getSessionNowPlayingTime:function(e){var a="";a+=e.PlayState.PositionTicks?Dashboard.getDisplayTime(e.PlayState.PositionTicks):"--:--:--",a+=" / ";var t=e.NowPlayingItem;return a+=t&&t.RunTimeTicks?Dashboard.getDisplayTime(t.RunTimeTicks):"--:--:--"},getAppSecondaryText:function(e){return e.ApplicationVersion},getNowPlayingName:function(e){var a="",t=e.NowPlayingItem;if(!t)return{html:"Last seen "+humane_date(e.LastActivityDate),image:a};var n=t.Name,s="";t.Artists&&t.Artists.length?(s=n,n=t.Artists[0]):t.SeriesName||t.Album?(s=n,n=t.SeriesName||t.Album):t.ProductionYear&&(s=t.ProductionYear),t.LogoItemId&&(a=ApiClient.getScaledImageUrl(t.LogoItemId,{tag:e.LogoImageTag,maxHeight:24,maxWidth:130,type:"Logo"}),n='<img src="'+a+'" style="max-height:24px;max-width:130px;" />');var i=s?n+"<br/>"+s:n;return{html:i,image:a}},getUsersHtml:function(e){var a=[];e.UserId&&a.push(e.UserName);for(var t=0,n=e.AdditionalUsers.length;n>t;t++)a.push(e.AdditionalUsers[t].UserName);return a.join(", ")},getUserImage:function(e){return e.UserId&&e.UserPrimaryImageTag?ApiClient.getUserImageUrl(e.UserId,{tag:e.UserPrimaryImageTag,height:24,type:"Primary"}):null},updateSession:function(e,a){e.removeClass("deadSession");var t=a.NowPlayingItem;t?e.addClass("playingSession"):e.removeClass("playingSession"),$(".sessionNowPlayingStreamInfo",e).html(DashboardPage.getSessionNowPlayingStreamInfo(a)),$(".sessionNowPlayingTime",e).html(DashboardPage.getSessionNowPlayingTime(a)),$(".sessionUserName",e).html(DashboardPage.getUsersHtml(a)),$(".sessionAppSecondaryText",e).html(DashboardPage.getAppSecondaryText(a)),$(".sessionTranscodingFramerate",e).html(a.TranscodingInfo&&a.TranscodingInfo.Framerate?a.TranscodingInfo.Framerate+" fps":"");var n=DashboardPage.getNowPlayingName(a),s=$(".sessionNowPlayingInfo",e);if(n.image&&n.image==s.attr("data-imgsrc")||(s.html(n.html),s.attr("data-imgsrc",n.image||"")),t&&t.RunTimeTicks){var i=a.PlayState.PositionTicks||0,r=100*i/t.RunTimeTicks;$(".playbackProgress",e).show().val(r)}else $(".playbackProgress",e).hide();a.TranscodingInfo&&a.TranscodingInfo.CompletionPercentage?(e.addClass("transcodingSession"),$(".transcodingProgress",e).show().val(a.TranscodingInfo.CompletionPercentage)):($(".transcodingProgress",e).hide(),e.removeClass("transcodingSession"));var o=DashboardPage.getNowPlayingImageUrl(t)||"",l=$(".sessionNowPlayingContent",e)[0];o!=l.getAttribute("data-src")&&(l.style.backgroundImage=o?"url('"+o+"')":"",l.setAttribute("data-src",o))},getClientImage:function(e){var a=e.Client.toLowerCase(),t=e.DeviceName.toLowerCase();if(e.AppIconUrl)return"<img src='"+e.AppIconUrl+"' />";if("dashboard"==a||"emby web client"==a){var n;return n=-1!=t.indexOf("chrome")?"css/images/clients/chrome.png":"css/images/clients/html5.png","<img src='"+n+"' alt='Emby Web Client' />"}return-1!=a.indexOf("android")?"<img src='css/images/clients/android.png' />":-1!=a.indexOf("ios")?"<img src='css/images/clients/ios.png' />":"mb-classic"==a?"<img src='css/images/clients/mbc.png' />":"roku"==a?"<img src='css/images/clients/roku.jpg' />":"windows phone"==a?"<img src='css/images/clients/windowsphone.png' />":"dlna"==a?"<img src='css/images/clients/dlna.png' />":"kodi"==a||"xbmc"==a?"<img src='css/images/clients/kodi.png' />":"chromecast"==a?"<img src='css/images/clients/chromecast.png' />":null},getNowPlayingImageUrl:function(e){return e&&e.BackdropImageTag?ApiClient.getScaledImageUrl(e.BackdropItemId,{type:"Backdrop",width:275,tag:e.BackdropImageTag}):e&&e.ThumbImageTag?ApiClient.getScaledImageUrl(e.ThumbItemId,{type:"Thumb",width:275,tag:e.ThumbImageTag}):e&&e.PrimaryImageTag?ApiClient.getScaledImageUrl(e.PrimaryImageItemId,{type:"Primary",width:275,tag:e.PrimaryImageTag}):null},systemUpdateTaskKey:"SystemUpdateTask",renderRunningTasks:function(e,a){var t="";a=a.filter(function(e){return"Idle"!=e.State&&!e.IsHidden}),$("#btnUpdateApplication",e).buttonEnabled(a.filter(function(e){return e.Key==DashboardPage.systemUpdateTaskKey}).length?!1:!0),a.length?$("#runningTasksCollapsible",e).show():$("#runningTasksCollapsible",e).hide();for(var n=0,s=a.length;s>n;n++){var i=a[n];if(t+="<p>",t+=i.Name+"<br/>","Running"==i.State){var r=(i.CurrentProgressPercentage||0).toFixed(1);t+='<progress max="100" value="'+r+'" title="'+r+'%">',t+=""+r+"%",t+="</progress>",t+="<span style='color:#009F00;margin-left:5px;margin-right:5px;'>"+r+"%</span>",t+='<paper-icon-button title="'+Globalize.translate("ButtonStop")+'" icon="cancel" onclick="DashboardPage.stopTask(\''+i.Id+"');\"></paper-icon-button>"}else"Cancelling"==i.State&&(t+='<span style="color:#cc0000;">'+Globalize.translate("LabelStopping")+"</span>");t+="</p>"}$("#divRunningTasks",e).html(t).trigger("create")},renderUrls:function(e,a){if(a.LocalAddress){var t=Globalize.translate("LabelLocalAccessUrl",'<a href="'+a.LocalAddress+'" target="_blank">'+a.LocalAddress+"</a>");$(".localUrl",e).html(t).show().trigger("create")}else $(".externalUrl",e).hide();if(a.WanAddress){var n=a.WanAddress,s=Globalize.translate("LabelRemoteAccessUrl",'<a href="'+n+'" target="_blank">'+n+"</a>");$(".externalUrl",e).html(s).show().trigger("create")}else $(".externalUrl",e).hide()},renderSupporterIcon:function(e,a){var t,n;AppInfo.enableSupporterMembership?a.IsMBSupporter?(t="css/images/supporter/supporterbadge.png",n=Globalize.translate("MessageThankYouForSupporting"),$(".supporterIconContainer",e).html('<a class="imageLink supporterIcon" href="http://emby.media/premiere" target="_blank" title="'+n+'"><img src="'+t+'" style="height:32px;vertical-align: middle; margin-right: .5em;" /></a><span style="position:relative;top:2px;text-decoration:none;">'+n+"</span>")):(t="css/images/supporter/nonsupporterbadge.png",n=Globalize.translate("MessagePleaseSupportProject"),$(".supporterIconContainer",e).html('<a class="imageLink supporterIcon" href="http://emby.media/premiere" target="_blank" title="'+n+'"><img src="'+t+'" style="height:32px;vertical-align: middle; margin-right: .5em;" /><span style="position:relative;top:2px;text-decoration:none;">'+n+"</span></a>")):$(".supporterIconContainer",e).remove()},renderHasPendingRestart:function(e,a){if(a)$("#pUpToDate",e).hide(),$("#pUpdateNow",e).hide();else{if(DashboardPage.lastAppUpdateCheck&&(new Date).getTime()-DashboardPage.lastAppUpdateCheck<18e5)return;DashboardPage.lastAppUpdateCheck=(new Date).getTime(),ApiClient.getAvailableApplicationUpdate().then(function(a){var t=a[0];t?($("#pUpToDate",e).hide(),$("#pUpdateNow",e).show(),$("#newVersionNumber",e).html(Globalize.translate("VersionXIsAvailableForDownload").replace("{0}",t.versionStr))):($("#pUpToDate",e).show(),$("#pUpdateNow",e).hide())})}},renderPendingInstallations:function(e,a){if(!a.CompletedInstallations.length)return void $("#collapsiblePendingInstallations",e).hide();$("#collapsiblePendingInstallations",e).show();for(var t="",n=0,s=a.CompletedInstallations.length;s>n;n++){var i=a.CompletedInstallations[n];t+="<div><strong>"+i.Name+"</strong> ("+i.Version+")</div>"}$("#pendingInstallations",e).html(t)},renderPluginUpdateInfo:function(e,a){!a&&DashboardPage.lastPluginUpdateCheck&&(new Date).getTime()-DashboardPage.lastPluginUpdateCheck<18e5||(DashboardPage.lastPluginUpdateCheck=(new Date).getTime(),ApiClient.getAvailablePluginUpdates().then(function(a){var t=$("#pPluginUpdates",e);if(!a.length)return void t.hide();t.show();for(var n="",s=0,i=a.length;i>s;s++){var r=a[s];n+="<p><strong>"+Globalize.translate("NewVersionOfSomethingAvailable").replace("{0}",r.name)+"</strong></p>",n+='<button type="button" data-icon="arrow-d" data-theme="b" onclick="DashboardPage.installPluginUpdate(this);" data-name="'+r.name+'" data-guid="'+r.guid+'" data-version="'+r.versionStr+'" data-classification="'+r.classification+'">'+Globalize.translate("ButtonUpdateNow")+"</button>"}t.html(n).trigger("create")}))},installPluginUpdate:function(e){$(e).buttonEnabled(!1);var a=e.getAttribute("data-name"),t=e.getAttribute("data-guid"),n=e.getAttribute("data-version"),s=e.getAttribute("data-classification");Dashboard.showLoadingMsg(),ApiClient.installPlugin(a,t,s,n).then(function(){Dashboard.hideLoadingMsg()})},updateApplication:function(){var e=$.mobile.activePage;$("#btnUpdateApplication",e).buttonEnabled(!1),Dashboard.showLoadingMsg(),ApiClient.getScheduledTasks().then(function(a){var t=a.filter(function(e){return e.Key==DashboardPage.systemUpdateTaskKey})[0];ApiClient.startScheduledTask(t.Id).then(function(){DashboardPage.pollForInfo(e),Dashboard.hideLoadingMsg()})})},stopTask:function(e){var a=$.mobile.activePage;ApiClient.stopScheduledTask(e).then(function(){DashboardPage.pollForInfo(a)})},restart:function(){require(["confirm"],function(e){e(Globalize.translate("MessageConfirmRestart"),Globalize.translate("HeaderRestart")).then(function(){$("#btnRestartServer").buttonEnabled(!1),$("#btnShutdown").buttonEnabled(!1),Dashboard.restartServer()})})},shutdown:function(){require(["confirm"],function(e){e(Globalize.translate("MessageConfirmShutdown"),Globalize.translate("HeaderShutdown")).then(function(){$("#btnRestartServer").buttonEnabled(!1),$("#btnShutdown").buttonEnabled(!1),ApiClient.shutdownServer()})})}};$(document).on("pageshow","#dashboardPage",DashboardPage.onPageShow).on("pagebeforehide","#dashboardPage",DashboardPage.onPageHide),function(e){function a(){t&&(clearTimeout(t),t=null);var a=this.querySelector(".cardOverlayTarget");e(a).is(":visible")&&require(["jquery","velocity"],function(e,t){t.animate(a,{height:"0"},{complete:function(){e(a).hide()}})})}var t;e.fn.createSessionItemMenus=function(){function n(a){if(!e(".itemSelectionPanel:visible",a).length){var t=e(".cardOverlayTarget",a);t.show().each(function(){this.style.height=0}).animate({height:"100%"},"fast")}}function s(){t&&(clearTimeout(t),t=null);var e=this;t=setTimeout(function(){n(e)},1e3)}return AppInfo.isTouchPreferred?this:this.off("mouseenter",".playingSession",s).off("mouseleave",".playingSession",a).on("mouseenter",".playingSession",s).on("mouseleave",".playingSession",a)}}(jQuery,document,window),function(e){function a(e){var a="";a+="<paper-icon-item>";var t="Error"==e.Severity||"Fatal"==e.Severity||"Warn"==e.Severity?"#cc0000":"#52B54B";if(e.UserId&&e.UserPrimaryImageTag){var n=ApiClient.getUserImageUrl(e.UserId,{type:"Primary",tag:e.UserPrimaryImageTag,height:40});a+='<paper-fab mini style="background-color:'+t+";background-image:url('"+n+"');background-repeat:no-repeat;background-position:center center;background-size: cover;\" item-icon></paper-fab>"}else a+='<paper-fab mini icon="dvr" style="background-color:'+t+'" item-icon></paper-fab>';a+="<paper-item-body three-line>",a+="<div>",a+=e.Name,a+="</div>",a+="<div secondary>";var s=parseISO8601Date(e.Date,{toLocal:!0});return a+=s.toLocaleDateString()+" "+s.toLocaleTimeString().toLowerCase(),a+="</div>",a+="<div secondary>",a+=e.ShortOverview||"",a+="</div>",a+="</paper-item-body>",a+="</paper-icon-item>"}function t(t,s,i,r){var o=s.Items.map(a).join("");if(s.TotalRecordCount>r){var l={StartIndex:i,Limit:r};o+=LibraryBrowser.getQueryPagingHtml({startIndex:l.StartIndex,limit:l.Limit,totalRecordCount:s.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1})}e(t).html(o).trigger("create"),e(".btnNextPage",t).on("click",function(){n(t,i+r,r)}),e(".btnPreviousPage",t).on("click",function(){n(t,i-r,r)}),e(".btnShowOverview",t).on("click",function(){var a=e(this).parents(".newsItem"),t=e(".newsItemLongDescription",a).html(),n=e(".notificationName",a).html();Dashboard.alert({message:'<div style="max-height:300px; overflow: auto;">'+t+"</div>",title:n})})}function n(e,a,n){null==a&&(a=parseInt(e.getAttribute("data-activitystartindex")||"0")),n=n||parseInt(e.getAttribute("data-activitylimit")||"7");var s=new Date;s.setTime(s.getTime()-864e5),ApiClient.getJSON(ApiClient.getUrl("System/ActivityLog/Entries",{startIndex:a,limit:n,minDate:s.toISOString()})).then(function(s){e.setAttribute("data-activitystartindex",a),e.setAttribute("data-activitylimit",n),t(e,s,a,n)})}function s(e){e.each(function(){n(this)}).addClass("activityLogListWidget");var a=ApiClient;a&&(Events.on(a,"websocketopen",o),Events.on(a,"websocketmessage",l))}function i(e){e.isWebSocketOpen()&&e.sendWebSocketMessage("ActivityLogEntryStart","0,1500")}function r(e){e.isWebSocketOpen()&&e.sendWebSocketMessage("ActivityLogEntryStop","0,1500")}function o(){var e=ApiClient;e&&i(e)}function l(a,t){var s=t;"ActivityLogEntry"===s.MessageType&&e(".activityLogListWidget").each(function(){n(this)})}function d(){var e=ApiClient;e&&(Events.off(e,"websocketopen",o),Events.off(e,"websocketmessage",l),r(e))}e.fn.activityLogList=function(e){"destroy"==e?(this.removeClass("activityLogListWidget"),d(this)):s(this);var a=ApiClient;return a&&i(a),this}}(jQuery,document,window),function(e,a){function t(a,t){ApiClient.getDisplayPreferences("dashboard",t,"dashboard").then(function(n){n.CustomPrefs[o]=r,ApiClient.updateDisplayPreferences("dashboard",n,t,"dashboard"),e(a).off("pageshow",i)})}function n(a,t){var n=Dashboard.getCurrentUserId();t.getDisplayPreferences("dashboard",n,"dashboard").then(function(t){if(t.CustomPrefs[o]==r)e(".welcomeMessage",a).hide();else{var n=e(".welcomeMessage",a).show();t.CustomPrefs[o]?(e(".tourHeader",n).html(Globalize.translate("HeaderWelcomeBack")),e(".tourButtonText",n).html(Globalize.translate("ButtonTakeTheTourToSeeWhatsNew"))):(e(".tourHeader",n).html(Globalize.translate("HeaderWelcomeToProjectServerDashboard")),e(".tourButtonText",n).html(Globalize.translate("ButtonTakeTheTour")))}})}function s(a,n){require(["slideshow"],function(){var s=[{imageUrl:"css/images/tour/dashboard/dashboard.png",title:Globalize.translate("DashboardTourDashboard")},{imageUrl:"css/images/tour/dashboard/help.png",title:Globalize.translate("DashboardTourHelp")},{imageUrl:"css/images/tour/dashboard/users.png",title:Globalize.translate("DashboardTourUsers")},{imageUrl:"css/images/tour/dashboard/sync.png",title:Globalize.translate("DashboardTourSync")},{imageUrl:"css/images/tour/dashboard/cinemamode.png",title:Globalize.translate("DashboardTourCinemaMode")},{imageUrl:"css/images/tour/dashboard/chapters.png",title:Globalize.translate("DashboardTourChapters")},{imageUrl:"css/images/tour/dashboard/subtitles.png",title:Globalize.translate("DashboardTourSubtitles")},{imageUrl:"css/images/tour/dashboard/plugins.png",title:Globalize.translate("DashboardTourPlugins")},{imageUrl:"css/images/tour/dashboard/notifications.png",title:Globalize.translate("DashboardTourNotifications")},{imageUrl:"css/images/tour/dashboard/scheduledtasks.png",title:Globalize.translate("DashboardTourScheduledTasks")},{imageUrl:"css/images/tour/dashboard/mobile.png",title:Globalize.translate("DashboardTourMobile")},{imageUrl:"css/images/tour/enjoy.jpg",title:Globalize.translate("MessageEnjoyYourStay")}];require(["slideshow"],function(i){var r=new i({slides:s,interactive:!0,loop:!1});r.show(),t(a,n),e(".welcomeMessage",a).hide()})})}function i(){var e=this,a=ApiClient;a&&!AppInfo.isNativeApp&&n(e,a)}var r="12",o="welcomeTour";e(a).on("pageinit","#dashboardPage",function(){var a=this;e(".btnTakeTour",a).on("click",function(){s(a,Dashboard.getCurrentUserId())})}).on("pageshow","#dashboardPage",i)}(jQuery,document,window),function(){$(document).on("pageshow",".type-interior",function(){var e=this;Dashboard.getPluginSecurityInfo().then(function(a){if(!$(".customSupporterPromotion",e).length&&($(".supporterPromotion",e).remove(),!a.IsMBSupporter&&AppInfo.enableSupporterMembership)){var t='<div class="supporterPromotion"><a class="clearLink" href="http://emby.media/premiere" target="_blank"><paper-button raised class="block" style="text-transform:none;background-color:#52B54B;color:#fff;"><div>'+Globalize.translate("HeaderSupportTheTeam")+'</div><div style="font-weight:normal;margin-top:5px;">'+Globalize.translate("TextEnjoyBonusFeatures")+"</div></paper-button></a></div>";$(".content-primary",e).append(t)}})})}();