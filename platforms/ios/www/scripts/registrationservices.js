define(["appStorage","shell"],function(e,t){function a(t,a){Dashboard.getPluginSecurityInfo().then(function(n){if(n.IsMBSupporter)t();else{var i=parseInt(e.getItem(s)||"0");i?(new Date).getTime()-i>2592e5?o(t,a):t():(e.setItem(s,(new Date).getTime()),t())}})}function n(){var e=[];return e.push({name:Globalize.translate("CoverArt"),icon:"photo",text:Globalize.translate("CoverArtFeatureDescription")}),e.push({name:Globalize.translate("HeaderFreeApps"),icon:"check",text:Globalize.translate("FreeAppsFeatureDescription")}),e.push(Dashboard.capabilities().SupportsSync?{name:Globalize.translate("HeaderMobileSync"),icon:"sync",text:Globalize.translate("MobileSyncFeatureDescription")}:{name:Globalize.translate("HeaderCinemaMode"),icon:"movie",text:Globalize.translate("CinemaModeFeatureDescription")}),e}function i(e){var t="";return t+='<div class="listItem">',t+='<i class="listItemIcon md-icon">'+e.icon+"</i>",t+='<div class="listItemBody two-line">',t+='<a class="clearLink" href="https://emby.media/premiere" target="_blank">',t+='<h3 class="listItemBodyText">',t+=e.name,t+="</h3>",t+='<div class="listItemBodyText secondary" style="white-space:normal;">',t+=e.text,t+="</div>",t+="</a>",t+="</div>",t+="</div>"}function o(t){require(["dialogHelper","listViewStyle","emby-button"],function(a){var o=a.createDialog({size:"fullscreen-border",removeOnClose:!0});o.classList.add("ui-body-b"),o.classList.add("background-theme-b");var r="";r+='<h2 class="dialogHeader">',r+='<button is="emby-button" type="button" class="fab mini btnCancelSupporterInfo" tabindex="-1"><i class="md-icon">arrow_back</i></button>',r+="</h2>",r+='<div class="readOnlyContent" style="margin:0 auto 0;color:#fff;padding:0 1em 1em;">',r+="<h1>"+Globalize.translate("HeaderTryEmbyPremiere")+"</h1>",r+="<p>"+Globalize.translate("MessageDidYouKnowCinemaMode")+"</p>",r+="<p>"+Globalize.translate("MessageDidYouKnowCinemaMode2")+"</p>",r+="<br/>",r+="<h1>"+Globalize.translate("HeaderBenefitsEmbyPremiere")+"</h1>",r+='<div class="paperList">',r+=n().map(i).join(""),r+="</div>",r+="<br/>",r+='<a class="clearLink" href="http://emby.media/premiere" target="_blank"><button is="emby-button" type="button" class="raised submit block" autoFocus><i class="md-icon">check</i><span>'+Globalize.translate("ButtonBecomeSupporter")+"</span></button></a>",r+='<button is="emby-button" type="button" class="raised subdued block btnCancelSupporterInfo" style="background:#444;"><i class="md-icon">close</i><span>'+Globalize.translate("ButtonClosePlayVideo")+"</span></button>",r+="</div>",o.innerHTML=r,document.body.appendChild(o),o.addEventListener("close",function(){e.setItem(s,(new Date).getTime()),t()}),a.open(o);var l,c,d=function(){a.close(o)},b=o.querySelectorAll(".btnCancelSupporterInfo");for(l=0,c=b.length;c>l;l++)b[l].addEventListener("click",d)})}function r(e,t){Dashboard.getPluginSecurityInfo().then(function(a){return a.IsMBSupporter?void e():(Dashboard.showLoadingMsg(),void ApiClient.getRegistrationInfo("Sync").then(function(a){return Dashboard.hideLoadingMsg(),a.IsRegistered?void e():void Dashboard.alert({message:Globalize.translate("HeaderSyncRequiresSupporterMembership")+'<br/><p><a href="http://emby.media/premiere" target="_blank">'+Globalize.translate("ButtonLearnMore")+"</a></p>",title:Globalize.translate("HeaderSync"),callback:t})},function(){t(),Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("ErrorValidatingSupporterInfo")})}))})}var s="lastSupporterPlaybackMessage4";return{validateFeature:function(e){return new Promise(function(t,n){"playback"==e?a(t,n):"livetv"==e?t():"sync"==e?r(t,n):t()})},showPremiereInfo:function(){t.openUrl("https://emby.media/premiere")}}});