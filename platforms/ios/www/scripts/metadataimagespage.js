!function(e,t){function a(t,a){for(var i="",n=0,o=a.length;o>n;n++){var r=a[n],l=0==n?' selected="selected"':"";i+='<option value="'+r.type+'"'+l+">"+Globalize.translate(r.name)+"</option>"}e("#selectItemType",t).html(i).trigger("change"),Dashboard.hideLoadingMsg()}function i(e,t){Dashboard.showLoadingMsg(),h=t;var a=ApiClient.getServerConfiguration(),i=ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataPlugins"));Promise.all([a,i]).then(function(a){var i=a[0],n=a[1];i=i.MetadataOptions.filter(function(e){return e.ItemType==t})[0],i?(o(e,t,i,n),Dashboard.hideLoadingMsg()):ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).then(function(a){i=a,o(e,t,i,n),Dashboard.hideLoadingMsg()})})}function n(t,a){a?(t.show(),e("input",t).attr("required","required")):(t.hide(),e("input",t).attr("required","").removeAttr("required"))}function o(t,a,i,o){var c=o.filter(function(e){return a==e.ItemType})[0];n(e(".backdropFields",t),-1!=c.SupportedImageTypes.indexOf("Backdrop")),n(e(".screenshotFields",t),-1!=c.SupportedImageTypes.indexOf("Screenshot")),e(".imageType",t).each(function(){var e=this.getAttribute("data-imagetype");-1==c.SupportedImageTypes.indexOf(e)?this.classList.add("hide"):this.classList.remove("hide"),this.checked=r(i,e).Limit?!0:!1});var u=r(i,"Backdrop");e("#txtMaxBackdrops",t).val(u.Limit),e("#txtMinBackdropDownloadWidth",t).val(u.MinWidth);var g=r(i,"Screenshot");e("#txtMaxScreenshots",t).val(g.Limit),e("#txtMinScreenshotDownloadWidth",t).val(g.MinWidth),p(t,a,i,c),s(t,a,i,c),d(t,a,i,c),l(t,a,i,c)}function r(e,t){return e.ImageOptions.filter(function(e){return e.Type==t})[0]||{Type:t,MinWidth:"Backdrop"==t?1280:0,Limit:"Backdrop"==t?3:1}}function l(t,a,i,n){var o=n.Plugins.filter(function(e){return"ImageFetcher"==e.Type}),r="";if(!o.length)return void e(".imageFetchers",t).html(r).hide().trigger("create");var l,d,s,p;for(r+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">'+Globalize.translate("LabelImageFetchers")+"</div>",r+='<div style="display:inline-block;width: 75%;vertical-align:top;">',r+='<div data-role="controlgroup" class="imageFetcherGroup">',l=0,d=o.length;d>l;l++){s=o[l],p="chkImageFetcher"+l;var c=-1==i.DisabledImageFetchers.indexOf(s.Name)?' checked="checked"':"";r+='<input class="chkImageFetcher" type="checkbox" name="'+p+'" id="'+p+'" data-pluginname="'+s.Name+'" data-mini="true"'+c+">",r+='<label for="'+p+'">'+s.Name+"</label>"}if(r+="</div>",r+="</div>",o.length>1)for(r+='<div style="display:inline-block;vertical-align:top;margin-left:5px;">',l=0,d=o.length;d>l;l++)r+="<div>",r+=l>0?'<paper-icon-button class="btnUp" data-pluginindex="'+l+'" icon="keyboard-arrow-up" title="'+Globalize.translate("ButtonUp")+'" style="padding:3px 8px;"></paper-icon-button>':'<paper-icon-button disabled class="btnUp" data-pluginindex="'+l+'" icon="keyboard-arrow-up" title="'+Globalize.translate("ButtonUp")+'" style="padding:3px 8px;"></paper-icon-button>',r+=l<o.length-1?'<paper-icon-button class="btnDown" data-pluginindex="'+l+'" icon="keyboard-arrow-down" title="'+Globalize.translate("ButtonDown")+'" style="padding:3px 8px;"></paper-icon-button>':'<paper-icon-button disabled class="btnDown" data-pluginindex="'+l+'" icon="keyboard-arrow-down" title="'+Globalize.translate("ButtonDown")+'" style="padding:3px 8px;"></paper-icon-button>',r+="</div>";r+="</div>",r+='<div class="fieldDescription" style="width:75%;">'+Globalize.translate("LabelImageFetchersHelp")+"</div>";var u=e(".imageFetchers",t).html(r).show().trigger("create");e(".btnDown",u).on("click",function(){var a=parseInt(this.getAttribute("data-pluginindex")),i=e(".imageFetcherGroup .ui-checkbox",t)[a],n=e(i).next(".ui-checkbox")[0];i.parentNode.removeChild(i),e(i).insertAfter(n)}),e(".btnUp",u).on("click",function(){var a=parseInt(this.getAttribute("data-pluginindex")),i=e(".imageFetcherGroup .ui-checkbox",t)[a],n=e(i).prev(".ui-checkbox")[0];i.parentNode.removeChild(i),e(i).insertBefore(n)})}function d(t,a,i,n){var o=n.Plugins.filter(function(e){return"MetadataSaver"==e.Type}),r="";if(!o.length)return void e(".metadataSavers",t).html(r).hide().trigger("create");r+='<fieldset data-role="controlgroup">',r+="<legend>"+Globalize.translate("LabelMetadataSavers")+"</legend>";for(var l=0,d=o.length;d>l;l++){var s=o[l],p="chkMetadataSaver"+l,c=-1==i.DisabledMetadataSavers.indexOf(s.Name)?' checked="checked"':"";r+='<input class="chkMetadataSaver" type="checkbox" name="'+p+'" id="'+p+'" data-mini="true"'+c+' data-pluginname="'+s.Name+'">',r+='<label for="'+p+'">'+s.Name+"</label>"}r+="</fieldset>",r+='<div class="fieldDescription">'+Globalize.translate("LabelMetadataSaversHelp")+"</div>",e(".metadataSavers",t).html(r).show().trigger("create")}function s(t,a,i,n){var o=n.Plugins.filter(function(e){return"MetadataFetcher"==e.Type}),r="";if(!o.length)return void e(".metadataFetchers",t).html(r).hide().trigger("create");var l,d,s,p;for(r+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">'+Globalize.translate("LabelMetadataDownloaders")+"</div>",r+='<div style="display:inline-block;width: 75%;vertical-align:top;">',r+='<div data-role="controlgroup" class="metadataFetcherGroup">',l=0,d=o.length;d>l;l++){s=o[l],p="chkMetadataFetcher"+l;var c=-1==i.DisabledMetadataFetchers.indexOf(s.Name)?' checked="checked"':"";r+='<input class="chkMetadataFetcher" type="checkbox" name="'+p+'" id="'+p+'" data-pluginname="'+s.Name+'" data-mini="true"'+c+">",r+='<label for="'+p+'">'+s.Name+"</label>"}if(r+="</div>",r+="</div>",o.length>1)for(r+='<div style="display:inline-block;vertical-align:top;margin-left:5px;">',l=0,d=o.length;d>l;l++)r+="<div>",r+=l>0?'<paper-icon-button class="btnUp" data-pluginindex="'+l+'" icon="keyboard-arrow-up" title="'+Globalize.translate("ButtonUp")+'" style="padding:3px 8px;"></paper-icon-button>':'<paper-icon-button disabled class="btnUp" data-pluginindex="'+l+'" icon="keyboard-arrow-up" title="'+Globalize.translate("ButtonUp")+'" style="padding:3px 8px;"></paper-icon-button>',r+=l<o.length-1?'<paper-icon-button class="btnDown" data-pluginindex="'+l+'" icon="keyboard-arrow-down" title="'+Globalize.translate("ButtonDown")+'" style="padding:3px 8px;"></paper-icon-button>':'<paper-icon-button disabled class="btnDown" data-pluginindex="'+l+'" icon="keyboard-arrow-down" title="'+Globalize.translate("ButtonDown")+'" style="padding:3px 8px;"></paper-icon-button>',r+="</div>";r+="</div>",r+='<div class="fieldDescription" style="width:75%;">'+Globalize.translate("LabelMetadataDownloadersHelp")+"</div>";var u=e(".metadataFetchers",t).html(r).show().trigger("create");e(".btnDown",u).on("click",function(){var a=parseInt(this.getAttribute("data-pluginindex")),i=e(".metadataFetcherGroup .ui-checkbox",t)[a],n=e(i).next(".ui-checkbox")[0];i.parentNode.removeChild(i),e(i).insertAfter(n)}),e(".btnUp",u).on("click",function(){var a=parseInt(this.getAttribute("data-pluginindex")),i=e(".metadataFetcherGroup .ui-checkbox",t)[a],n=e(i).prev(".ui-checkbox")[0];i.parentNode.removeChild(i),e(i).insertBefore(n)})}function p(t,a,i,n){var o=n.Plugins.filter(function(e){return"LocalMetadataProvider"==e.Type}),r="";if(o.length<2)return void e(".metadataReaders",t).html(r).hide().trigger("create");r+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">'+Globalize.translate("LabelMetadataReaders")+"</div>",r+='<ul data-role="listview" data-inset="true" data-mini="true" style="margin-top:.5em;margin-bottom:.5em;">';for(var l=0,d=o.length;d>l;l++){var s=o[l];r+='<li data-mini="true" class="localReaderOption" data-pluginname="'+s.Name+'">',l>0?(r+='<a href="#" style="font-size:13px;font-weight:normal;">'+s.Name+"</a>",r+='<a class="btnLocalReaderUp btnLocalReaderMove" data-pluginindex="'+l+'" href="#" style="font-size:13px;font-weight:normal;" data-icon="arrow-u">'+Globalize.translate("ButtonUp")+"</a>"):o.length>1?(r+='<a href="#" style="font-size:13px;font-weight:normal;">'+s.Name+"</a>",r+='<a class="btnLocalReaderDown btnLocalReaderMove" data-pluginindex="'+l+'" href="#" style="font-size:13px;font-weight:normal;" data-icon="arrow-d">'+Globalize.translate("ButtonDown")+"</a>"):r+=s.Name,r+="</li>"}r+="</ul>",r+='<div class="fieldDescription">'+Globalize.translate("LabelMetadataReadersHelp")+"</div>",e(".metadataReaders",t).html(r).show().trigger("create")}function c(e){a(e,[{name:"OptionMovies",type:"Movie"},{name:"OptionCollections",type:"BoxSet"},{name:"OptionSeries",type:"Series"},{name:"OptionSeasons",type:"Season"},{name:"OptionEpisodes",type:"Episode"},{name:"OptionGames",type:"Game"},{name:"OptionGameSystems",type:"GameSystem"},{name:"OptionMusicArtists",type:"MusicArtist"},{name:"OptionMusicAlbums",type:"MusicAlbum"},{name:"OptionMusicVideos",type:"MusicVideo"},{name:"OptionSongs",type:"Audio"},{name:"OptionHomeVideos",type:"Video"},{name:"OptionBooks",type:"Book"},{name:"OptionPeople",type:"Person"}])}function u(t,a){a.DisabledMetadataSavers=e(".chkMetadataSaver:not(:checked)",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.LocalMetadataReaderOrder=e(".localReaderOption",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.DisabledMetadataFetchers=e(".chkMetadataFetcher:not(:checked)",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.MetadataFetcherOrder=e(".chkMetadataFetcher",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.DisabledImageFetchers=e(".chkImageFetcher:not(:checked)",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.ImageFetcherOrder=e(".chkImageFetcher",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.ImageOptions=e(".imageType:not(.hide)",t).get().map(function(e){return{Type:e.getAttribute("data-imagetype"),Limit:e.checked?1:0,MinWidth:0}}),a.ImageOptions.push({Type:"Backdrop",Limit:e("#txtMaxBackdrops",t).val(),MinWidth:e("#txtMinBackdropDownloadWidth",t).val()}),a.ImageOptions.push({Type:"Screenshot",Limit:e("#txtMaxScreenshots",t).val(),MinWidth:e("#txtMinScreenshotDownloadWidth",t).val()})}function g(){var e=this;return Dashboard.showLoadingMsg(),ApiClient.getServerConfiguration().then(function(t){var a=h,i=t.MetadataOptions.filter(function(e){return e.ItemType==a})[0];i?(u(e,i),ApiClient.updateServerConfiguration(t).then(Dashboard.processServerConfigurationUpdateResult)):ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).then(function(i){i.ItemType=a,t.MetadataOptions.push(i),u(e,i),ApiClient.updateServerConfiguration(t).then(Dashboard.processServerConfigurationUpdateResult)})}),!1}var h;e(t).on("pageinit","#metadataImagesConfigurationPage",function(){var t=this;e(".metadataReaders",t).on("click",".btnLocalReaderMove",function(){var t=e(this).parents(".localReaderOption"),a=t.parents("ul");if(e(this).hasClass("btnLocalReaderDown")){var i=t.next();t.remove().insertAfter(i)}else{var n=t.prev();t.remove().insertBefore(n)}e(".localReaderOption",a).each(function(){e(this).prev(".localReaderOption").length?e(".btnLocalReaderMove",this).addClass("btnLocalReaderUp").removeClass("btnLocalReaderDown").attr("data-icon","arrow-u").removeClass("ui-icon-arrow-d").addClass("ui-icon-arrow-u"):e(".btnLocalReaderMove",this).addClass("btnLocalReaderDown").removeClass("btnLocalReaderUp").attr("data-icon","arrow-d").removeClass("ui-icon-arrow-u").addClass("ui-icon-arrow-d")})}),e("#selectItemType",t).on("change",function(){i(t,this.value)}),e(".metadataImagesConfigurationForm").off("submit",g).on("submit",g)}).on("pageshow","#metadataImagesConfigurationPage",function(){Dashboard.showLoadingMsg();var e=this;c(e)})}(jQuery,document,window);