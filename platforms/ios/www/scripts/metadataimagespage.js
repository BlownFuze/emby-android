!function(e,t){function a(t,a){for(var i="",n=0,r=a.length;r>n;n++){var o=a[n],l=0==n?' selected="selected"':"";i+='<option value="'+o.type+'"'+l+">"+Globalize.translate(o.name)+"</option>"}e("#selectItemType",t).html(i).trigger("change"),Dashboard.hideLoadingMsg()}function i(e,t){Dashboard.showLoadingMsg(),h=t;var a=ApiClient.getServerConfiguration(),i=ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataPlugins"));Promise.all([a,i]).then(function(a){var i=a[0],n=a[1];i=i.MetadataOptions.filter(function(e){return e.ItemType==t})[0],i?(r(e,t,i,n),Dashboard.hideLoadingMsg()):ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).then(function(a){i=a,r(e,t,i,n),Dashboard.hideLoadingMsg()})})}function n(t,a){a?(t.show(),e("input",t).attr("required","required")):(t.hide(),e("input",t).attr("required","").removeAttr("required"))}function r(t,a,i,r){var p=r.filter(function(e){return a==e.ItemType})[0];n(e(".backdropFields",t),-1!=p.SupportedImageTypes.indexOf("Backdrop")),n(e(".screenshotFields",t),-1!=p.SupportedImageTypes.indexOf("Screenshot")),e(".imageType",t).each(function(){var e=this.getAttribute("data-imagetype");-1==p.SupportedImageTypes.indexOf(e)?this.classList.add("hide"):this.classList.remove("hide"),this.checked=o(i,e).Limit?!0:!1});var u=o(i,"Backdrop");e("#txtMaxBackdrops",t).val(u.Limit),e("#txtMinBackdropDownloadWidth",t).val(u.MinWidth);var g=o(i,"Screenshot");e("#txtMaxScreenshots",t).val(g.Limit),e("#txtMinScreenshotDownloadWidth",t).val(g.MinWidth),c(t,a,i,p),s(t,a,i,p),d(t,a,i,p),l(t,a,i,p)}function o(e,t){return e.ImageOptions.filter(function(e){return e.Type==t})[0]||{Type:t,MinWidth:"Backdrop"==t?1280:0,Limit:"Backdrop"==t?3:1}}function l(t,a,i,n){var r=n.Plugins.filter(function(e){return"ImageFetcher"==e.Type}),o="";if(!r.length)return void e(".imageFetchers",t).html(o).hide().trigger("create");var l,d,s,c;for(o+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">'+Globalize.translate("LabelImageFetchers")+"</div>",o+='<div style="display:inline-block;width: 75%;vertical-align:top;">',o+='<div data-role="controlgroup" class="imageFetcherGroup">',l=0,d=r.length;d>l;l++){s=r[l],c="chkImageFetcher"+l;var p=-1==i.DisabledImageFetchers.indexOf(s.Name)?' checked="checked"':"";o+='<input class="chkImageFetcher" type="checkbox" name="'+c+'" id="'+c+'" data-pluginname="'+s.Name+'" data-mini="true"'+p+">",o+='<label for="'+c+'">'+s.Name+"</label>"}if(o+="</div>",o+="</div>",r.length>1)for(o+='<div style="display:inline-block;vertical-align:top;margin-left:5px;">',l=0,d=r.length;d>l;l++)o+="<div>",o+=l>0?'<paper-icon-button class="btnUp" data-pluginindex="'+l+'" icon="keyboard-arrow-up" title="'+Globalize.translate("ButtonUp")+'" style="padding:3px 8px;"></paper-icon-button>':'<paper-icon-button disabled class="btnUp" data-pluginindex="'+l+'" icon="keyboard-arrow-up" title="'+Globalize.translate("ButtonUp")+'" style="padding:3px 8px;"></paper-icon-button>',o+=l<r.length-1?'<paper-icon-button class="btnDown" data-pluginindex="'+l+'" icon="keyboard-arrow-down" title="'+Globalize.translate("ButtonDown")+'" style="padding:3px 8px;"></paper-icon-button>':'<paper-icon-button disabled class="btnDown" data-pluginindex="'+l+'" icon="keyboard-arrow-down" title="'+Globalize.translate("ButtonDown")+'" style="padding:3px 8px;"></paper-icon-button>',o+="</div>";o+="</div>",o+='<div class="fieldDescription" style="width:75%;">'+Globalize.translate("LabelImageFetchersHelp")+"</div>";var u=e(".imageFetchers",t).html(o).show().trigger("create");e(".btnDown",u).on("click",function(){var a=parseInt(this.getAttribute("data-pluginindex")),i=e(".imageFetcherGroup .ui-checkbox",t)[a],n=e(i).next(".ui-checkbox")[0];i.parentNode.removeChild(i),e(i).insertAfter(n)}),e(".btnUp",u).on("click",function(){var a=parseInt(this.getAttribute("data-pluginindex")),i=e(".imageFetcherGroup .ui-checkbox",t)[a],n=e(i).prev(".ui-checkbox")[0];i.parentNode.removeChild(i),e(i).insertBefore(n)})}function d(t,a,i,n){var r=n.Plugins.filter(function(e){return"MetadataSaver"==e.Type}),o="";if(!r.length)return void e(".metadataSavers",t).html(o).hide().trigger("create");o+='<div class="paperCheckboxListLabel">'+Globalize.translate("LabelMetadataSavers")+"</div>",o+='<div class="paperCheckboxList">';for(var l=0,d=r.length;d>l;l++){var s=r[l],c=-1==i.DisabledMetadataSavers.indexOf(s.Name)?' checked="checked"':"";o+='<paper-checkbox class="chkMetadataSaver"'+c+' data-pluginname="'+s.Name+'">'+s.Name+"</paper-checkbox>"}o+="</div>",o+='<div class="fieldDescription" style="margin-top:.25em;">'+Globalize.translate("LabelMetadataSaversHelp")+"</div>",t.querySelector(".metadataSavers").innerHTML=o}function s(t,a,i,n){var r=n.Plugins.filter(function(e){return"MetadataFetcher"==e.Type}),o="";if(!r.length)return void e(".metadataFetchers",t).html(o).hide().trigger("create");var l,d,s,c;for(o+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">'+Globalize.translate("LabelMetadataDownloaders")+"</div>",o+='<div style="display:inline-block;width: 75%;vertical-align:top;">',o+='<div data-role="controlgroup" class="metadataFetcherGroup">',l=0,d=r.length;d>l;l++){s=r[l],c="chkMetadataFetcher"+l;var p=-1==i.DisabledMetadataFetchers.indexOf(s.Name)?' checked="checked"':"";o+='<input class="chkMetadataFetcher" type="checkbox" name="'+c+'" id="'+c+'" data-pluginname="'+s.Name+'" data-mini="true"'+p+">",o+='<label for="'+c+'">'+s.Name+"</label>"}if(o+="</div>",o+="</div>",r.length>1)for(o+='<div style="display:inline-block;vertical-align:top;margin-left:5px;">',l=0,d=r.length;d>l;l++)o+="<div>",o+=l>0?'<paper-icon-button class="btnUp" data-pluginindex="'+l+'" icon="keyboard-arrow-up" title="'+Globalize.translate("ButtonUp")+'" style="padding:3px 8px;"></paper-icon-button>':'<paper-icon-button disabled class="btnUp" data-pluginindex="'+l+'" icon="keyboard-arrow-up" title="'+Globalize.translate("ButtonUp")+'" style="padding:3px 8px;"></paper-icon-button>',o+=l<r.length-1?'<paper-icon-button class="btnDown" data-pluginindex="'+l+'" icon="keyboard-arrow-down" title="'+Globalize.translate("ButtonDown")+'" style="padding:3px 8px;"></paper-icon-button>':'<paper-icon-button disabled class="btnDown" data-pluginindex="'+l+'" icon="keyboard-arrow-down" title="'+Globalize.translate("ButtonDown")+'" style="padding:3px 8px;"></paper-icon-button>',o+="</div>";o+="</div>",o+='<div class="fieldDescription" style="width:75%;">'+Globalize.translate("LabelMetadataDownloadersHelp")+"</div>";var u=e(".metadataFetchers",t).html(o).show().trigger("create");e(".btnDown",u).on("click",function(){var a=parseInt(this.getAttribute("data-pluginindex")),i=e(".metadataFetcherGroup .ui-checkbox",t)[a],n=e(i).next(".ui-checkbox")[0];i.parentNode.removeChild(i),e(i).insertAfter(n)}),e(".btnUp",u).on("click",function(){var a=parseInt(this.getAttribute("data-pluginindex")),i=e(".metadataFetcherGroup .ui-checkbox",t)[a],n=e(i).prev(".ui-checkbox")[0];i.parentNode.removeChild(i),e(i).insertBefore(n)})}function c(t,a,i,n){var r=n.Plugins.filter(function(e){return"LocalMetadataProvider"==e.Type}),o="";if(r.length<2)return void e(".metadataReaders",t).html(o).hide().trigger("create");o+='<div class="ui-controlgroup-label" style="margin-bottom:0;padding-left:2px;">'+Globalize.translate("LabelMetadataReaders")+"</div>",o+='<ul data-role="listview" data-inset="true" data-mini="true" style="margin-top:.5em;margin-bottom:.5em;">';for(var l=0,d=r.length;d>l;l++){var s=r[l];o+='<li data-mini="true" class="localReaderOption" data-pluginname="'+s.Name+'">',l>0?(o+='<a href="#" style="font-weight:normal;">'+s.Name+"</a>",o+='<a class="btnLocalReaderUp btnLocalReaderMove" data-pluginindex="'+l+'" href="#" style="font-weight:normal;" data-icon="arrow-u">'+Globalize.translate("ButtonUp")+"</a>"):r.length>1?(o+='<a href="#" style="font-weight:normal;">'+s.Name+"</a>",o+='<a class="btnLocalReaderDown btnLocalReaderMove" data-pluginindex="'+l+'" href="#" style="font-weight:normal;" data-icon="arrow-d">'+Globalize.translate("ButtonDown")+"</a>"):o+=s.Name,o+="</li>"}o+="</ul>",o+='<div class="fieldDescription">'+Globalize.translate("LabelMetadataReadersHelp")+"</div>",e(".metadataReaders",t).html(o).show().trigger("create")}function p(e){a(e,[{name:"OptionMovies",type:"Movie"},{name:"OptionCollections",type:"BoxSet"},{name:"OptionSeries",type:"Series"},{name:"OptionSeasons",type:"Season"},{name:"OptionEpisodes",type:"Episode"},{name:"OptionGames",type:"Game"},{name:"OptionGameSystems",type:"GameSystem"},{name:"OptionMusicArtists",type:"MusicArtist"},{name:"OptionMusicAlbums",type:"MusicAlbum"},{name:"OptionMusicVideos",type:"MusicVideo"},{name:"OptionSongs",type:"Audio"},{name:"OptionHomeVideos",type:"Video"},{name:"OptionBooks",type:"Book"},{name:"OptionPeople",type:"Person"}])}function u(t,a){a.DisabledMetadataSavers=e(".chkMetadataSaver",t).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-pluginname")}),a.LocalMetadataReaderOrder=e(".localReaderOption",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.DisabledMetadataFetchers=e(".chkMetadataFetcher:not(:checked)",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.MetadataFetcherOrder=e(".chkMetadataFetcher",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.DisabledImageFetchers=e(".chkImageFetcher:not(:checked)",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.ImageFetcherOrder=e(".chkImageFetcher",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.ImageOptions=e(".imageType:not(.hide)",t).get().map(function(e){return{Type:e.getAttribute("data-imagetype"),Limit:e.checked?1:0,MinWidth:0}}),a.ImageOptions.push({Type:"Backdrop",Limit:e("#txtMaxBackdrops",t).val(),MinWidth:e("#txtMinBackdropDownloadWidth",t).val()}),a.ImageOptions.push({Type:"Screenshot",Limit:e("#txtMaxScreenshots",t).val(),MinWidth:e("#txtMinScreenshotDownloadWidth",t).val()})}function g(){var e=this;return Dashboard.showLoadingMsg(),ApiClient.getServerConfiguration().then(function(t){var a=h,i=t.MetadataOptions.filter(function(e){return e.ItemType==a})[0];i?(u(e,i),ApiClient.updateServerConfiguration(t).then(Dashboard.processServerConfigurationUpdateResult)):ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).then(function(i){i.ItemType=a,t.MetadataOptions.push(i),u(e,i),ApiClient.updateServerConfiguration(t).then(Dashboard.processServerConfigurationUpdateResult)})}),!1}var h;e(t).on("pageinit","#metadataImagesConfigurationPage",function(){var t=this;e(".metadataReaders",t).on("click",".btnLocalReaderMove",function(){var t=e(this).parents(".localReaderOption"),a=t.parents("ul");if(e(this).hasClass("btnLocalReaderDown")){var i=t.next();t.remove().insertAfter(i)}else{var n=t.prev();t.remove().insertBefore(n)}e(".localReaderOption",a).each(function(){e(this).prev(".localReaderOption").length?e(".btnLocalReaderMove",this).addClass("btnLocalReaderUp").removeClass("btnLocalReaderDown").attr("data-icon","arrow-u").removeClass("ui-icon-arrow-d").addClass("ui-icon-arrow-u"):e(".btnLocalReaderMove",this).addClass("btnLocalReaderDown").removeClass("btnLocalReaderUp").attr("data-icon","arrow-d").removeClass("ui-icon-arrow-u").addClass("ui-icon-arrow-d")})}),e("#selectItemType",t).on("change",function(){i(t,this.value)}),e(".metadataImagesConfigurationForm").off("submit",g).on("submit",g)}).on("pageshow","#metadataImagesConfigurationPage",function(){Dashboard.showLoadingMsg();var e=this;p(e)})}(jQuery,document,window);