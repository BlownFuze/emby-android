define(["jQuery"],function(e){function t(t,a){for(var i="",n=0,r=a.length;r>n;n++){var o=a[n],s=0==n?' selected="selected"':"";i+='<option value="'+o.type+'"'+s+">"+Globalize.translate(o.name)+"</option>"}e("#selectItemType",t).html(i).trigger("change"),Dashboard.hideLoadingMsg()}function a(e,t){Dashboard.showLoadingMsg(),h=t;var a=ApiClient.getServerConfiguration(),i=ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataPlugins"));Promise.all([a,i]).then(function(a){var i=a[0],r=a[1];i=i.MetadataOptions.filter(function(e){return e.ItemType==t})[0],i?(n(e,t,i,r),Dashboard.hideLoadingMsg()):ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).then(function(a){i=a,n(e,t,i,r),Dashboard.hideLoadingMsg()})})}function i(t,a){a?(t.show(),e("input",t).attr("required","required")):(t.hide(),e("input",t).attr("required","").removeAttr("required"))}function n(t,a,n,p){var c=p.filter(function(e){return a==e.ItemType})[0];i(e(".backdropFields",t),-1!=c.SupportedImageTypes.indexOf("Backdrop")),i(e(".screenshotFields",t),-1!=c.SupportedImageTypes.indexOf("Screenshot")),e(".imageType",t).each(function(){var e=this.getAttribute("data-imagetype");-1==c.SupportedImageTypes.indexOf(e)?this.classList.add("hide"):this.classList.remove("hide"),this.checked=r(n,e).Limit?!0:!1});var u=r(n,"Backdrop");e("#txtMaxBackdrops",t).val(u.Limit),e("#txtMinBackdropDownloadWidth",t).val(u.MinWidth);var m=r(n,"Screenshot");e("#txtMaxScreenshots",t).val(m.Limit),e("#txtMinScreenshotDownloadWidth",t).val(m.MinWidth),l(t,a,n,c),d(t,a,n,c),s(t,a,n,c),o(t,a,n,c)}function r(e,t){return e.ImageOptions.filter(function(e){return e.Type==t})[0]||{Type:t,MinWidth:"Backdrop"==t?1280:0,Limit:"Backdrop"==t?3:1}}function o(t,a,i,n){var r=n.Plugins.filter(function(e){return"ImageFetcher"==e.Type}),o="";if(!r.length)return void e(".imageFetchers",t).html(o).hide();var s,d,l;for(o+='<div class="paperListLabel">'+Globalize.translate("LabelImageFetchers")+"</div>",o+='<div class="paperList">',s=0,d=r.length;d>s;s++){l=r[s];var p=-1==i.DisabledImageFetchers.indexOf(l.Name)?' checked="checked"':"";o+='<paper-icon-item class="imageFetcherItem" data-pluginname="'+l.Name+'">',o+='<paper-checkbox class="chkImageFetcher" data-pluginname="'+l.Name+'" item-icon'+p+"></paper-checkbox>",o+="<paper-item-body>",o+="<div>",o+=l.Name,o+="</div>",o+="</paper-item-body>",o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonUp")+'" class="btnUp" style="padding:3px 8px;"><iron-icon icon="keyboard-arrow-up"></iron-icon></button>',o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonDown")+'" class="btnDown" style="padding:3px 8px;"><iron-icon icon="keyboard-arrow-down"></iron-icon></button>',o+="</paper-icon-item>"}o+="</div>",o+='<div class="fieldDescription">'+Globalize.translate("LabelImageFetchersHelp")+"</div>";var c=e(".imageFetchers",t).html(o).show();e(".btnDown",c).on("click",function(){var t=e(this).parents(".imageFetcherItem")[0],a=e(t).next(".imageFetcherItem")[0];a&&(t.parentNode.removeChild(t),e(t).insertAfter(a))}),e(".btnUp",c).on("click",function(){var t=e(this).parents(".imageFetcherItem")[0],a=e(t).prev(".imageFetcherItem")[0];a&&(t.parentNode.removeChild(t),e(t).insertBefore(a))})}function s(t,a,i,n){var r=n.Plugins.filter(function(e){return"MetadataSaver"==e.Type}),o="";if(!r.length)return void e(".metadataSavers",t).html(o).hide();o+='<div class="paperListLabel">'+Globalize.translate("LabelMetadataSavers")+"</div>",o+='<div class="paperCheckboxList paperList">';for(var s=0,d=r.length;d>s;s++){var l=r[s],p=-1==i.DisabledMetadataSavers.indexOf(l.Name)?' checked="checked"':"";o+='<paper-checkbox class="chkMetadataSaver"'+p+' data-pluginname="'+l.Name+'">'+l.Name+"</paper-checkbox>"}o+="</div>",o+='<div class="fieldDescription" style="margin-top:.25em;">'+Globalize.translate("LabelMetadataSaversHelp")+"</div>",t.querySelector(".metadataSavers").innerHTML=o}function d(t,a,i,n){var r=n.Plugins.filter(function(e){return"MetadataFetcher"==e.Type}),o="";if(!r.length)return void e(".metadataFetchers",t).html(o).hide();var s,d,l;for(o+='<div class="paperListLabel">'+Globalize.translate("LabelMetadataDownloaders")+"</div>",o+='<div class="paperList">',s=0,d=r.length;d>s;s++){l=r[s];var p=-1==i.DisabledMetadataFetchers.indexOf(l.Name)?' checked="checked"':"";o+='<paper-icon-item class="metadataFetcherItem" data-pluginname="'+l.Name+'">',o+='<paper-checkbox class="chkMetadataFetcher" data-pluginname="'+l.Name+'" item-icon'+p+"></paper-checkbox>",o+="<paper-item-body>",o+="<div>",o+=l.Name,o+="</div>",o+="</paper-item-body>",o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonUp")+'" class="btnUp" style="padding:3px 8px;"><iron-icon icon="keyboard-arrow-up"></iron-icon></button>',o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonDown")+'" class="btnDown" style="padding:3px 8px;"><iron-icon icon="keyboard-arrow-down"></iron-icon></button>',o+="</paper-icon-item>"}o+="</div>",o+='<div class="fieldDescription">'+Globalize.translate("LabelMetadataDownloadersHelp")+"</div>";var c=e(".metadataFetchers",t).html(o).show();e(".btnDown",c).on("click",function(){var t=e(this).parents(".metadataFetcherItem")[0],a=e(t).next(".metadataFetcherItem")[0];a&&(t.parentNode.removeChild(t),e(t).insertAfter(a))}),e(".btnUp",c).on("click",function(){var t=e(this).parents(".metadataFetcherItem")[0],a=e(t).prev(".metadataFetcherItem")[0];a&&(t.parentNode.removeChild(t),e(t).insertBefore(a))})}function l(t,a,i,n){var r=n.Plugins.filter(function(e){return"LocalMetadataProvider"==e.Type}),o="";if(r.length<2)return void e(".metadataReaders",t).html(o).hide();o+='<div class="paperListLabel">'+Globalize.translate("LabelMetadataReaders")+"</div>",o+='<div class="paperList">';for(var s=0,d=r.length;d>s;s++){var l=r[s];o+='<paper-icon-item class="localReaderOption" data-pluginname="'+l.Name+'">',o+='<paper-fab mini style="background:#52B54B;" icon="live-tv" item-icon></paper-fab>',o+="<paper-item-body>",o+="<div>",o+=l.Name,o+="</div>",o+="</paper-item-body>",s>0?o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonUp")+'" class="btnLocalReaderUp btnLocalReaderMove" data-pluginindex="'+s+'"><iron-icon icon="keyboard-arrow-up"></iron-icon></button>':r.length>1&&(o+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonDown")+'" class="btnLocalReaderDown btnLocalReaderMove" data-pluginindex="'+s+'"><iron-icon icon="keyboard-arrow-down"></iron-icon></button>'),o+="</paper-icon-item>"}o+="</div>",o+='<div class="fieldDescription">'+Globalize.translate("LabelMetadataReadersHelp")+"</div>",e(".metadataReaders",t).html(o).show()}function p(e){t(e,[{name:"OptionMovies",type:"Movie"},{name:"OptionCollections",type:"BoxSet"},{name:"OptionSeries",type:"Series"},{name:"OptionSeasons",type:"Season"},{name:"OptionEpisodes",type:"Episode"},{name:"OptionGames",type:"Game"},{name:"OptionGameSystems",type:"GameSystem"},{name:"OptionMusicArtists",type:"MusicArtist"},{name:"OptionMusicAlbums",type:"MusicAlbum"},{name:"OptionMusicVideos",type:"MusicVideo"},{name:"OptionSongs",type:"Audio"},{name:"OptionHomeVideos",type:"Video"},{name:"OptionBooks",type:"Book"},{name:"OptionPeople",type:"Person"}])}function c(t,a){a.DisabledMetadataSavers=e(".chkMetadataSaver",t).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-pluginname")}),a.LocalMetadataReaderOrder=e(".localReaderOption",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.DisabledMetadataFetchers=e(".chkMetadataFetcher",t).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-pluginname")}),a.MetadataFetcherOrder=e(".chkMetadataFetcher",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.DisabledImageFetchers=e(".chkImageFetcher",t).get().filter(function(e){return!e.checked}).map(function(e){return e.getAttribute("data-pluginname")}),a.ImageFetcherOrder=e(".chkImageFetcher",t).get().map(function(e){return e.getAttribute("data-pluginname")}),a.ImageOptions=e(".imageType:not(.hide)",t).get().map(function(e){return{Type:e.getAttribute("data-imagetype"),Limit:e.checked?1:0,MinWidth:0}}),a.ImageOptions.push({Type:"Backdrop",Limit:e("#txtMaxBackdrops",t).val(),MinWidth:e("#txtMinBackdropDownloadWidth",t).val()}),a.ImageOptions.push({Type:"Screenshot",Limit:e("#txtMaxScreenshots",t).val(),MinWidth:e("#txtMinScreenshotDownloadWidth",t).val()})}function u(){var e=this;return Dashboard.showLoadingMsg(),ApiClient.getServerConfiguration().then(function(t){var a=h,i=t.MetadataOptions.filter(function(e){return e.ItemType==a})[0];i?(c(e,i),ApiClient.updateServerConfiguration(t).then(Dashboard.processServerConfigurationUpdateResult)):ApiClient.getJSON(ApiClient.getUrl("System/Configuration/MetadataOptions/Default")).then(function(i){i.ItemType=a,t.MetadataOptions.push(i),c(e,i),ApiClient.updateServerConfiguration(t).then(Dashboard.processServerConfigurationUpdateResult)})}),!1}function m(){return[{href:"metadata.html",name:Globalize.translate("TabSettings")},{href:"metadataimages.html",name:Globalize.translate("TabServices")},{href:"metadatanfo.html",name:Globalize.translate("TabNfoSettings")}]}var h;e(document).on("pageinit","#metadataImagesConfigurationPage",function(){var t=this;e(".metadataReaders",t).on("click",".btnLocalReaderMove",function(){var t=e(this).parents(".localReaderOption"),a=t.parents(".paperList");if(e(this).hasClass("btnLocalReaderDown")){var i=t.next();t.remove().insertAfter(i)}else{var n=t.prev();t.remove().insertBefore(n)}e(".localReaderOption",a).each(function(){e(this).prev(".localReaderOption").length?e(".btnLocalReaderMove",this).addClass("btnLocalReaderUp").removeClass("btnLocalReaderDown").attr("icon","keyboard-arrow-up"):e(".btnLocalReaderMove",this).addClass("btnLocalReaderDown").removeClass("btnLocalReaderUp").attr("icon","keyboard-arrow-down")})}),e("#selectItemType",t).on("change",function(){a(t,this.value)}),e(".metadataImagesConfigurationForm").off("submit",u).on("submit",u)}).on("pageshow","#metadataImagesConfigurationPage",function(){LibraryMenu.setTabs("metadata",1,m),Dashboard.showLoadingMsg();var e=this;p(e)})});