define(["jQuery"],function(e){function t(t,a,o,r){var i=r.OperatingSystem.toLowerCase();-1!=i.indexOf("windows")?e("#windowsStartupDescription",t).show():e("#windowsStartupDescription",t).hide(),r.SupportsAutoRunAtStartup?e("#fldRunAtStartup",t).show():e("#fldRunAtStartup",t).hide(),t.querySelector("#txtServerName").value=a.ServerName||"",t.querySelector("#txtCachePath").value=a.CachePath||"",e("#selectLocalizationLanguage",t).html(o.map(function(e){return'<option value="'+e.Value+'">'+e.Name+"</option>"})).val(a.UICulture),n=a.UICulture,e("#chkUsageData",t).checked(a.EnableAnonymousUsageReporting),e("#chkRunAtStartup",t).checked(a.RunAtStartup),r.CanSelfUpdate?(e(".fldAutomaticUpdates",t).show(),e(".lnlAutomaticUpdateLevel",t).html(Globalize.translate("LabelAutomaticUpdateLevel"))):(e(".fldAutomaticUpdates",t).hide(),e(".lnlAutomaticUpdateLevel",t).html(Globalize.translate("LabelAutomaticUpdateLevelForPlugins"))),e("#chkEnableAutomaticServerUpdates",t).checked(a.EnableAutoUpdate),e("#chkEnableAutomaticRestart",t).checked(a.EnableAutomaticRestart),r.CanSelfRestart?e("#fldEnableAutomaticRestart",t).show():e("#fldEnableAutomaticRestart",t).hide(),e("#selectAutomaticUpdateLevel",t).val(a.SystemUpdateLevel).trigger("change"),e("#chkEnableDashboardResponseCache",t).checked(a.EnableDashboardResponseCaching),e("#chkEnableMinification",t).checked(a.EnableDashboardResourceMinification),e("#txtDashboardSourcePath",t).val(a.DashboardSourcePath).trigger("change"),Dashboard.hideLoadingMsg()}function a(){Dashboard.showLoadingMsg();{var t=this;e(t).parents(".page")}return ApiClient.getServerConfiguration().then(function(a){a.ServerName=t.querySelector("#txtServerName").value,a.UICulture=e("#selectLocalizationLanguage",t).val(),a.CachePath=t.querySelector("#txtCachePath").value,a.UICulture!=n&&Dashboard.showDashboardRefreshNotification(),a.EnableAnonymousUsageReporting=e("#chkUsageData",t).checked(),a.RunAtStartup=e("#chkRunAtStartup",t).checked(),a.SystemUpdateLevel=e("#selectAutomaticUpdateLevel",t).val(),a.EnableAutomaticRestart=e("#chkEnableAutomaticRestart",t).checked(),a.EnableAutoUpdate=e("#chkEnableAutomaticServerUpdates",t).checked(),a.EnableDashboardResourceMinification=e("#chkEnableMinification",t).checked(),a.EnableDashboardResponseCaching=e("#chkEnableDashboardResponseCache",t).checked(),a.DashboardSourcePath=e("#txtDashboardSourcePath",t).val(),ApiClient.updateServerConfiguration(a).then(function(){ApiClient.getNamedConfiguration(r).then(function(e){e.LoginDisclaimer=t.querySelector("#txtLoginDisclaimer").value,e.CustomCss=t.querySelector("#txtCustomCss").value;var a=o&&e.CustomCss!=o.CustomCss;ApiClient.updateNamedConfiguration(r,e).then(Dashboard.processServerConfigurationUpdateResult),a&&Dashboard.showDashboardRefreshNotification()})})}),!1}var o,n,r="branding";return function(n){e("#selectAutomaticUpdateLevel",n).on("change",function(){"Dev"==this.value?e("#devBuildWarning",n).show():e("#devBuildWarning",n).hide()}),e("#btnSelectCachePath",n).on("click.selectDirectory",function(){require(["directorybrowser"],function(e){var t=new e;t.show({callback:function(e){e&&(n.querySelector("#txtCachePath").value=e),t.close()},header:Globalize.translate("HeaderSelectServerCachePath"),instruction:Globalize.translate("HeaderSelectServerCachePathHelp")})})}),e("#btnSelectDashboardSourcePath",n).on("click.selectDirectory",function(){require(["directorybrowser"],function(e){var t=new e;t.show({callback:function(e){e&&(n.querySelector("#txtDashboardSourcePath").value=e),t.close()}})})}),e(".dashboardGeneralForm",n).off("submit",a).on("submit",a),n.addEventListener("viewshow",function(){var e=ApiClient.getServerConfiguration(),a=ApiClient.getJSON(ApiClient.getUrl("Localization/Options")),i=ApiClient.getSystemInfo();Promise.all([e,a,i]).then(function(e){t(n,e[0],e[1],e[2])}),ApiClient.getNamedConfiguration(r).then(function(e){o=e,n.querySelector("#txtLoginDisclaimer").value=e.LoginDisclaimer||"",n.querySelector("#txtCustomCss").value=e.CustomCss||""})})}});