define(["jQuery"],function(e){function t(t,a){var r=a.replace("%s","1").replace("%0s","01").replace("%00s","001"),i=Globalize.translate("OrganizePatternResult").replace("{0}",r);e(".seasonFolderFieldDescription",t).html(i)}function a(e,t){var a="Series Name",r="Episode Four",i=e.replace("%sn",a).replace("%s.n",a.replace(" ",".")).replace("%s_n",a.replace(" ","_")).replace("%s","1").replace("%0s","01").replace("%00s","001").replace("%ext","mkv").replace("%en",r).replace("%e.n",r.replace(" ",".")).replace("%e_n",r.replace(" ","_"));return t&&(i=i.replace("%ed","5").replace("%0ed","05").replace("%00ed","005")),i.replace("%e","4").replace("%0e","04").replace("%00e","004")}function r(t,r){r=a(r,!1);var i=Globalize.translate("OrganizePatternResult").replace("{0}",r);e(".episodePatternDescription",t).html(i)}function i(t,r){r=a(r,!0);var i=Globalize.translate("OrganizePatternResult").replace("{0}",r);e(".multiEpisodePatternDescription",t).html(i)}function n(t,a){var r=a.TvOptions;e("#chkEnableTvSorting",t).checked(r.IsEnabled),e("#chkOverwriteExistingEpisodes",t).checked(r.OverwriteExistingEpisodes),e("#chkDeleteEmptyFolders",t).checked(r.DeleteEmptyFolders),e("#txtMinFileSize",t).val(r.MinFileSizeMb),e("#txtSeasonFolderPattern",t).val(r.SeasonFolderPattern).trigger("change"),e("#txtSeasonZeroName",t).val(r.SeasonZeroFolderName),e("#txtWatchFolder",t).val(r.WatchLocations[0]||""),e("#txtEpisodePattern",t).val(r.EpisodeNamePattern).trigger("change"),e("#txtMultiEpisodePattern",t).val(r.MultiEpisodeNamePattern).trigger("change"),e("#txtDeleteLeftOverFiles",t).val(r.LeftOverFileExtensionsToDelete.join(";")),e("#copyOrMoveFile",t).val(r.CopyOriginalFile.toString())}function l(){var t=this;return ApiClient.getNamedConfiguration("autoorganize").then(function(a){var r=a.TvOptions;r.IsEnabled=e("#chkEnableTvSorting",t).checked(),r.OverwriteExistingEpisodes=e("#chkOverwriteExistingEpisodes",t).checked(),r.DeleteEmptyFolders=e("#chkDeleteEmptyFolders",t).checked(),r.MinFileSizeMb=e("#txtMinFileSize",t).val(),r.SeasonFolderPattern=e("#txtSeasonFolderPattern",t).val(),r.SeasonZeroFolderName=e("#txtSeasonZeroName",t).val(),r.EpisodeNamePattern=e("#txtEpisodePattern",t).val(),r.MultiEpisodeNamePattern=e("#txtMultiEpisodePattern",t).val(),r.LeftOverFileExtensionsToDelete=e("#txtDeleteLeftOverFiles",t).val().split(";");var i=e("#txtWatchFolder",t).val();r.WatchLocations=i?[i]:[],r.CopyOriginalFile=e("#copyOrMoveFile",t).val(),ApiClient.updateNamedConfiguration("autoorganize",a).then(Dashboard.processServerConfigurationUpdateResult)}),!1}e(document).on("pageinit","#libraryFileOrganizerPage",function(){var a=this;e("#txtSeasonFolderPattern",a).on("change keyup",function(){t(a,this.value)}),e("#txtEpisodePattern",a).on("change keyup",function(){r(a,this.value)}),e("#txtMultiEpisodePattern",a).on("change keyup",function(){i(a,this.value)}),e("#btnSelectWatchFolder",a).on("click.selectDirectory",function(){require(["directorybrowser"],function(t){var r=new t;r.show({callback:function(t){t&&e("#txtWatchFolder",a).val(t),r.close()},header:Globalize.translate("HeaderSelectWatchFolder"),instruction:Globalize.translate("HeaderSelectWatchFolderHelp")})})}),e(".libraryFileOrganizerForm").off("submit",l).on("submit",l)}).on("pageshow","#libraryFileOrganizerPage",function(){var e=this;ApiClient.getNamedConfiguration("autoorganize").then(function(t){n(e,t)})})});