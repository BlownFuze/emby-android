define(["jQuery"],function(e){function r(e){var r=t(e),a=c[r];return a||(a=c[r]={query:{SortBy:"SortName",SortOrder:"Ascending",Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()}},n(e,a.query),a.query.ParentId=LibraryMenu.getTopParentId(),LibraryBrowser.loadSavedQueryValues(r,a.query)),a.query}function t(e){return LibraryBrowser.getSavedQueryKey("tab="+e)}function a(n,i){Dashboard.showLoadingMsg();var o=r(i);ApiClient.getItems(Dashboard.getCurrentUserId(),o).then(function(r){window.scrollTo(0,0);var s="",u=LibraryBrowser.getQueryPagingHtml({startIndex:o.StartIndex,limit:o.Limit,totalRecordCount:r.TotalRecordCount,viewButton:!1,showLimit:!1});n.querySelector(".listTopPaging").innerHTML=u,"Poster"==d&&(s=LibraryBrowser.getPosterViewHtml({items:r.Items,shape:"square",context:getParameterByName("context")||"photos",overlayText:!0,lazy:!0,coverImage:!0,showTitle:0==i,centerText:!0}));var c=n.querySelector(".itemsContainer");c.innerHTML=s+u,ImageLoader.lazyChildren(c),e(".btnNextPage",n).on("click",function(){o.StartIndex+=o.Limit,a(n,i)}),e(".btnPreviousPage",n).on("click",function(){o.StartIndex-=o.Limit,a(n,i)}),LibraryBrowser.saveQueryValues(t(i),o),Dashboard.hideLoadingMsg()})}function n(e,r){1==e?(r.Recursive=!0,r.MediaTypes="Photo"):2==e?(r.Recursive=!0,r.MediaTypes="Video"):0==e&&(r.Recursive=!1,r.MediaTypes=null),r.ParentId=getParameterByName("parentId")||LibraryMenu.getTopParentId()}function i(r,t,a){var n=Dashboard.getCurrentUserId(),i=e.extend({},t);i.StartIndex=0,i.Limit=null,i.MediaTypes="Photo",i.Recursive=!0,i.Filters="IsNotFolder",ApiClient.getItems(n,i).then(function(e){o(r,e.Items,a)})}function o(e,r,t){var a=r.map(function(e){return e.Id}).indexOf(t);-1==a&&(a=0),require(["slideshow"],function(e){var t=new e({showTitle:!1,cover:!1,items:r,startIndex:a,interval:7e3,interactive:!0});t.show()})}function s(){var t=e(this).parents(".page")[0],a=LibraryBrowser.getListItemInfo(this);if("Photo"==a.mediaType){var n=r(LibraryBrowser.selectedTab(t.querySelector(".pageTabsContainer")));return Photos.startSlideshow(t,n,a.id),!1}}function u(e,r){switch(r){case 0:a(e.querySelector(".albumTabContent"),0);break;case 1:a(e.querySelector(".photoTabContent"),1);break;case 2:a(e.querySelector(".videoTabContent"),2)}}var d="Poster",c={};pageIdOn("pageinit","photosPage",function(){var r=this,t=r.querySelector("paper-tabs"),a="photos.html",n=LibraryMenu.getTopParentId();n&&(a+="?topParentId="+n),LibraryBrowser.configurePaperLibraryTabs(r,t,r.querySelector(".pageTabsContainer"),a),r.querySelector(".pageTabsContainer").addEventListener("tabchange",function(e){u(r,parseInt(e.detail.selectedTabIndex))}),e(r).on("click",".mediaItem",s)}),window.Photos={startSlideshow:i}});