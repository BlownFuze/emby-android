define(["jQuery"],function(e){function c(c,n){d=n,n.Policy.IsDisabled?e(".disabledUserBanner",c).show():e(".disabledUserBanner",c).hide(),"Guest"==n.ConnectLinkType?(e("#fldConnectInfo",c).hide(),e("#txtUserName",c).prop("disabled","disabled")):(e("#txtUserName",c).prop("disabled","").removeAttr("disabled"),e("#fldConnectInfo",c).show()),e(".lnkEditUserPreferences",c).attr("href","mypreferencesmenu.html?userId="+n.Id),Dashboard.setPageTitle(n.Name),e("#txtUserName",c).val(n.Name),e("#txtConnectUserName",c).val(d.ConnectUserName),e("#chkIsAdmin",c).checked(n.Policy.IsAdministrator),e("#chkDisabled",c).checked(n.Policy.IsDisabled).checkboxradio("refresh"),e("#chkIsHidden",c).checked(n.Policy.IsHidden).checkboxradio("refresh"),e("#chkRemoteControlSharedDevices",c).checked(n.Policy.EnableSharedDeviceControl).checkboxradio("refresh"),e("#chkEnableRemoteControlOtherUsers",c).checked(n.Policy.EnableRemoteControlOfOtherUsers).checkboxradio("refresh"),e("#chkEnableDownloading",c).checked(n.Policy.EnableContentDownloading).checkboxradio("refresh"),e("#chkManageLiveTv",c).checked(n.Policy.EnableLiveTvManagement).checkboxradio("refresh"),e("#chkEnableLiveTvAccess",c).checked(n.Policy.EnableLiveTvAccess).checkboxradio("refresh"),e("#chkEnableContentDeletion",c).checked(n.Policy.EnableContentDeletion).checkboxradio("refresh"),e("#chkDisableUserPreferences",c).checked(!n.Policy.EnableUserPreferenceAccess).checkboxradio("refresh"),e("#chkEnableMediaPlayback",c).checked(n.Policy.EnableMediaPlayback).checkboxradio("refresh"),e("#chkEnableAudioPlaybackTranscoding",c).checked(n.Policy.EnableAudioPlaybackTranscoding).checkboxradio("refresh"),e("#chkEnableVideoPlaybackTranscoding",c).checked(n.Policy.EnableVideoPlaybackTranscoding).checkboxradio("refresh"),e("#chkEnableSync",c).checked(n.Policy.EnableSync).checkboxradio("refresh"),e("#chkEnableSyncTranscoding",c).checked(n.Policy.EnableSyncTranscoding).checkboxradio("refresh"),e("#chkEnableSharing",c).checked(n.Policy.EnablePublicSharing).checkboxradio("refresh"),Dashboard.hideLoadingMsg()}function n(e,c,n,o){var i=e.ConnectUserName||"",r=c,l=ApiClient.getUrl("Users/"+e.Id+"/Connect/Link");i&&!r?ApiClient.ajax({type:"DELETE",url:l}).then(function(){Dashboard.alert({message:Globalize.translate("MessageEmbyAccontRemoved"),title:Globalize.translate("HeaderEmbyAccountRemoved"),callback:n})},function(){Dashboard.alert({message:Globalize.translate("ErrorRemovingEmbyConnectAccount")})}):i!=r?ApiClient.ajax({type:"POST",url:l,data:{ConnectUsername:r},dataType:"json"}).then(function(e){var c=e.IsPending?"MessagePendingEmbyAccountAdded":"MessageEmbyAccountAdded";Dashboard.alert({message:Globalize.translate(c),title:Globalize.translate("HeaderEmbyAccountAdded"),callback:n})},function(){a(".")}):o&&o()}function a(e){var c;e?(c=Globalize.translate("ErrorAddingEmbyConnectAccount1",'<a href="https://emby.media/connect" target="_blank">https://emby.media/connect</a>'),c+="<br/><br/>"+Globalize.translate("ErrorAddingEmbyConnectAccount2","apps@emby.media")):c=Globalize.translate("DefaultErrorMessage"),Dashboard.alert({message:c})}function o(c,a){Dashboard.hideLoadingMsg();var o=d.ConnectUserName||"",i=e("#txtConnectUserName",c).val();o==i?require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))}):n(a,e("#txtConnectUserName",c).val(),function(){t(c)})}function i(c,n){c.Name=e("#txtUserName",n).val(),c.Policy.IsAdministrator=e("#chkIsAdmin",n).checked(),c.Policy.IsHidden=e("#chkIsHidden",n).checked(),c.Policy.IsDisabled=e("#chkDisabled",n).checked(),c.Policy.EnableRemoteControlOfOtherUsers=e("#chkEnableRemoteControlOtherUsers",n).checked(),c.Policy.EnableLiveTvManagement=e("#chkManageLiveTv",n).checked(),c.Policy.EnableLiveTvAccess=e("#chkEnableLiveTvAccess",n).checked(),c.Policy.EnableContentDeletion=e("#chkEnableContentDeletion",n).checked(),c.Policy.EnableUserPreferenceAccess=!e("#chkDisableUserPreferences",n).checked(),c.Policy.EnableSharedDeviceControl=e("#chkRemoteControlSharedDevices",n).checked(),c.Policy.EnableMediaPlayback=e("#chkEnableMediaPlayback",n).checked(),c.Policy.EnableAudioPlaybackTranscoding=e("#chkEnableAudioPlaybackTranscoding",n).checked(),c.Policy.EnableVideoPlaybackTranscoding=e("#chkEnableVideoPlaybackTranscoding",n).checked(),c.Policy.EnableContentDownloading=e("#chkEnableDownloading",n).checked(),c.Policy.EnableSync=e("#chkEnableSync",n).checked(),c.Policy.EnableSyncTranscoding=e("#chkEnableSyncTranscoding",n).checked(),c.Policy.EnablePublicSharing=e("#chkEnableSharing",n).checked(),ApiClient.updateUser(c).then(function(){ApiClient.updateUserPolicy(c.Id,c.Policy).then(function(){o(n,c)})})}function r(){var c=e(this).parents(".page");return Dashboard.showLoadingMsg(),l().then(function(e){i(e,c)}),!1}function l(){var e=getParameterByName("userId");return ApiClient.getUser(e)}function t(e){Dashboard.showLoadingMsg(),l().then(function(n){c(e,n)})}var d;e(document).on("pageinit","#editUserPage",function(){e(".editUserProfileForm").off("submit",r).on("submit",r)}).on("pagebeforeshow","#editUserPage",function(){var e=this;t(e)})});