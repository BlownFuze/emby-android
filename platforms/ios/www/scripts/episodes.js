define(["jQuery"],function(e){return function(t,r,a){function i(e){var t=n(e),a=y[t];return a||(a=y[t]={query:{SortBy:"SeriesSortName,SortName",SortOrder:"Ascending",IncludeItemTypes:"Episode",Recursive:!0,Fields:"PrimaryImageAspectRatio,MediaSourceCount,UserData,SyncInfo",IsMissing:!1,IsVirtualUnaired:!1,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()},view:LibraryBrowser.getSavedView(t)||LibraryBrowser.getDefaultItemsView("Poster","Poster")},a.query.ParentId=r.topParentId,LibraryBrowser.loadSavedQueryValues(t,a.query)),a}function o(e){return i(e).query}function n(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("episodes")),e.savedQueryKey}function s(t){Dashboard.showLoadingMsg();var r=o(t);ApiClient.getItems(Dashboard.getCurrentUserId(),r).then(function(a){window.scrollTo(0,0);var o=i(t).view,m="",d=LibraryBrowser.getQueryPagingHtml({startIndex:r.StartIndex,limit:r.Limit,totalRecordCount:a.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!0,sortButton:!0,currentLayout:o,layouts:"Poster,PosterCard",filterButton:!0});t.querySelector(".listTopPaging").innerHTML=d,u(t),"List"==o?m=LibraryBrowser.getListViewHtml({items:a.Items,sortBy:r.SortBy}):"Poster"==o?m+=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"backdrop",showTitle:!0,showParentTitle:!0,overlayText:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0}):"PosterCard"==o&&(m+=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"backdrop",showTitle:!0,showParentTitle:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0}));var y=t.querySelector(".itemsContainer");y.innerHTML=m+d,ImageLoader.lazyChildren(y),e(".btnNextPage",t).on("click",function(){r.StartIndex+=r.Limit,s(t)}),e(".btnPreviousPage",t).on("click",function(){r.StartIndex-=r.Limit,s(t)}),e(".btnChangeLayout",t).on("layoutchange",function(e,r){i(t).view=r,LibraryBrowser.saveViewSetting(n(t),r),s(t)}),e(".btnFilter",t).on("click",function(){l(t)}),e(".btnSort",t).on("click",function(){LibraryBrowser.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SeriesSortName,SortName"},{name:Globalize.translate("OptionTvdbRating"),id:"CommunityRating,SeriesSortName,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SeriesSortName,SortName"},{name:Globalize.translate("OptionPremiereDate"),id:"PremiereDate,SeriesSortName,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SeriesSortName,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SeriesSortName,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SeriesSortName,SortName"},{name:Globalize.translate("OptionRuntime"),id:"Runtime,SeriesSortName,SortName"},{name:Globalize.translate("OptionVideoBitrate"),id:"VideoBitRate,SeriesSortName,SortName"}],callback:function(){s(t)},query:r})}),LibraryBrowser.saveQueryValues(n(t),r),Dashboard.hideLoadingMsg()})}function l(e){require(["components/filterdialog/filterdialog"],function(t){var r=new t({query:o(e),mode:"episodes"});Events.on(r,"filterchange",function(){s(e)}),r.show()})}function u(t){var r=o(t);e(".alphabetPicker",t).alphaValue(r.NameStartsWithOrGreater)}function m(t){e(".alphabetPicker",t).on("alphaselect",function(e,r){var a=o(t);a.NameStartsWithOrGreater=r,a.StartIndex=0,s(t)}).on("alphaclear",function(){var e=o(t);e.NameStartsWithOrGreater="",s(t)}),e(".itemsContainer",t).on("needsrefresh",function(){s(t)})}var d=this,y={};m(a),d.renderTab=function(){s(a),u(a)}}});