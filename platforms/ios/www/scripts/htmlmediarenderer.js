define([],function(){function e(e){function d(){A(this),Events.trigger(O,"ended")}function s(){if("video"==e.type){var n=1e3*this.currentTime;n+=(o.startTimeTicksOffset||0)/1e4,V(n)}Events.trigger(O,"timeupdate")}function u(){Events.trigger(O,"volumechange")}function l(e){var n=e.target;n.removeEventListener("playing",l),document.querySelector(".mediaPlayerAudioContainer").classList.add("hide")}function c(){Events.trigger(O,"playing")}function v(){Events.trigger(O,"play")}function f(){Events.trigger(O,"pause")}function m(){Events.trigger(O,"click")}function p(){Events.trigger(O,"dblclick")}function g(e){A(this);{var n=e.target;n.error?n.error.code:""}Events.trigger(O,"error")}function y(e){var n=e.target;n.removeEventListener("loadedmetadata",y),t||n.play()}function E(e){require(["hlsjs"],function(n){window.Hls=n,e()})}function L(e){var n=e.target;n.removeEventListener("playing",L),O.setCurrentTrackElement(i);var t=!O.enableCustomVideoControls();if(t&&n.setAttribute("controls","controls"),r){var a=o.startPositionInSeekParam;if(a&&-1!=j.indexOf(".m3u8")){var d=browserInfo.safari?2500:0;d?setTimeout(function(){n.currentTime=a},d):n.currentTime=a}}}function w(){var e=document.querySelector(".mediaPlayerAudio");if(!e){var n="",t=!MediaPlayer.canAutoPlayAudio();n+=t?'<div class="mediaPlayerAudioContainer" style="position: fixed;top: 40%;text-align: center;left: 0;right: 0;z-index:999999;"><div class="mediaPlayerAudioContainerInner">':'<div class="mediaPlayerAudioContainer hide" style="padding: 1em;background: #222;"><div class="mediaPlayerAudioContainerInner">',n+='<audio class="mediaPlayerAudio" controls>',n+="</audio></div></div>",document.body.insertAdjacentHTML("beforeend",n),e=document.querySelector(".mediaPlayerAudio")}return e.addEventListener("playing",l),e.addEventListener("timeupdate",s),e.addEventListener("ended",d),e.addEventListener("volumechange",u),e.addEventListener("error",g),e.addEventListener("pause",f),e.addEventListener("play",v),e.addEventListener("playing",c),e}function T(e){return e&&-1==e.indexOf(".m3u8")?!1:MediaPlayer.canPlayHls()&&!MediaPlayer.canPlayNativeHls()}function b(){return"anonymous"}function h(){var n="",t=!O.enableCustomVideoControls(),r=!browserInfo.safari&&e.poster?' poster="'+e.poster+'"':"";n+=t&&AppInfo.isNativeApp&&browserInfo.android?'<video class="itemVideo" id="itemVideo" preload="metadata" autoplay="autoplay"'+r+" webkit-playsinline>":t?'<video class="itemVideo" id="itemVideo" preload="metadata" autoplay="autoplay"'+r+' controls="controls" webkit-playsinline>':'<video class="itemVideo" id="itemVideo" preload="metadata" autoplay="autoplay"'+r+" webkit-playsinline>",n+="</video>";var i=document.querySelector("#videoPlayer #videoElement");i.insertAdjacentHTML("afterbegin",n);var a=i.querySelector(".itemVideo");return a.addEventListener("loadedmetadata",y),a.addEventListener("timeupdate",s),a.addEventListener("ended",d),a.addEventListener("volumechange",u),a.addEventListener("play",v),a.addEventListener("pause",f),a.addEventListener("playing",c),a.addEventListener("click",m),a.addEventListener("dblclick",p),a.addEventListener("error",g),a}function k(e,n){var t=n.map(function(e){var n=e.isDefault?" default":"",t=e.language||"und";return'<track id="textTrack'+e.index+'" label="'+t+'" kind="subtitles" src="'+e.url+'" srclang="'+e.language+'"'+n+"></track>"}).join("");e.innerHTML=t}function x(e){if(browserInfo.safari&&browserInfo.mobile)return!1;if(browserInfo.edge||browserInfo.msie)return!1;if(browserInfo.firefox&&-1!=(j||"").toLowerCase().indexOf(".m3u8"))return!1;if(e){var n=(e.format||"").toLowerCase();if("ssa"==n||"ass"==n)return!1}return!0}function A(e,n){window.removeEventListener("resize",S),window.removeEventListener("orientationchange",S);var t=document.querySelector(".videoSubtitles");if(t&&t.parentNode.removeChild(t),n)for(var r=e.textTracks,i=0;i<r.length;i++){var a=r[i];-1!=a.label.indexOf("manualTrack")&&(a.mode="disabled")}W=-1,R=null,z=null,D=null;var o=U;o&&o.setEnabled(!1),U=null}function C(e){return ApiClient.ajax({url:e.url.replace(".vtt",".js"),type:"GET",dataType:"json"})}function I(e,n){return n?void(W!=n.index&&(A(e,!0),W=n.index,N(e,n),$=0)):void A(e,!0)}function P(e,n){var t={};require(["libjass"],function(r){r.ASS.fromUrl(n.url).then(function(n){var i=D=new r.renderers.ManualClock,a=new r.renderers.WebRenderer(n,i,e.parentNode.parentNode,t);U=a,a.addEventListener("ready",function(){try{a.resize(e.offsetWidth,e.offsetHeight,0,0),window.removeEventListener("resize",S),window.addEventListener("resize",S),window.removeEventListener("orientationchange",S),window.addEventListener("orientationchange",S)}catch(n){}})})})}function S(){var e=U;if(e){var n=M,t=n.offsetWidth,r=n.offsetHeight;e.resize(t,r,0,0)}}function N(e,n){var t=(n.format||"").toLowerCase();if("ssa"==t||"ass"==t)return void P(e,n);if(browserInfo.edge||browserInfo.msie)return void C(n).then(function(e){z=e.TrackEvents});for(var r=null,i="manualTrack"+n.index,a=e.textTracks,o=0;o<a.length;o++){var d=a[o];if(d.label==i){r=d;break}d.mode="disabled"}r?r.mode="showing":(r=e.addTextTrack("subtitles","manualTrack"+n.index,n.language||"und"),r.label="manualTrack"+n.index,C(n).then(function(e){e.TrackEvents.forEach(function(e){r.addCue(new(window.VTTCue||window.TextTrackCue)(e.StartPositionTicks/1e7,e.EndPositionTicks/1e7,e.Text.replace(/\\N/gi,"\n")))}),r.mode="showing"}))}function V(e){var n=D;n&&n.seek(e/1e3);var t=z;if(t){if(!R){var r=document.querySelector(".videoSubtitles");r||(r=document.createElement("div"),r.classList.add("videoSubtitles"),r.innerHTML='<div class="videoSubtitlesInner"></div>',document.body.appendChild(r)),R=r.querySelector(".videoSubtitlesInner")}if(!($>0&&Math.abs($-e)<500)){$=(new Date).getTime();for(var i=1e4*e,a=0,o=t.length;o>a;a++){var d=t[a];if(i>=d.StartPositionTicks&&i<=d.EndPositionTicks)return R.innerHTML=d.Text,void R.classList.remove("hide")}R.innerHTML="",R.classList.add("hide")}}}function H(e,n,t){var r=new RegExp("([?|&])"+n+"=.*?(&|$)","i");return e.match(r)?e.replace(r,"$1"+n+"="+t+"$2"):t?-1==e.indexOf("?")?e+"?"+n+"="+t:e+"&"+n+"="+t:e}var M,q,O=this;O.currentTime=function(e){return M?null!=e?void(M.currentTime=e/1e3):q?1e3*q:1e3*(M.currentTime||0):void 0},O.duration=function(){return M?M.duration:null},O.stop=function(){if(A(M),M&&(M.pause(),t)){q=M.currentTime;try{t.destroy()}catch(e){}t=null}},O.pause=function(){M&&M.pause()},O.unpause=function(){M&&M.play()},O.volume=function(e){return M?null!=e?void(M.volume=e):M.volume:void 0};var j;O.setCurrentSrc=function(e,n,d,s){var u=M;if(!u)return j=null,void(o=null);if(o=e,!e)return j=null,u.src=null,u.src="",void(browserInfo.safari&&(u.src="files/dummy.mp4",u.play()));u.crossOrigin=b(d);var l=e.url;AppInfo.isNativeApp&&browserInfo.safari&&(l=l.replace("file://","")),r=!1;var c=e.startPositionInSeekParam,v=!1;if("audio"==u.tagName.toLowerCase())u.src=l,v=!0;else{u.removeEventListener("playing",L),u.addEventListener("playing",L),t&&(t.destroy(),t=null),c&&(r=!0),s=s||[],a=s;for(var f=-1,m=0,p=s.length;p>m;m++)if(s[m].isDefault){f=s[m].index;break}if(i=f,T(l)){k(u,s);var g=new Hls;g.loadSource(l),g.attachMedia(u),g.on(Hls.Events.MANIFEST_PARSED,function(){u.play()}),t=g}else u.src=l,u.autoplay=!0,k(u,s),u.addEventListener("loadedmetadata",y),v=!0;j=l,O.setCurrentTrackElement(f)}j=l,v&&u.play()},O.currentSrc=function(){return M?j:void 0},O.paused=function(){return M?M.paused:!1},O.cleanup=function(){O.setCurrentSrc(null),q=null;var e=M;e&&("AUDIO"==e.tagName?(e.removeEventListener("timeupdate",s),e.removeEventListener("ended",d),e.removeEventListener("volumechange",u),e.removeEventListener("playing",l),e.removeEventListener("play",v),e.removeEventListener("pause",f),e.removeEventListener("playing",c),e.removeEventListener("error",g)):(e.removeEventListener("loadedmetadata",y),e.removeEventListener("playing",L),e.removeEventListener("timeupdate",s),e.removeEventListener("ended",d),e.removeEventListener("volumechange",u),e.removeEventListener("play",v),e.removeEventListener("pause",f),e.removeEventListener("playing",c),e.removeEventListener("click",m),e.removeEventListener("dblclick",p),e.removeEventListener("error",g)),"audio"!=e.tagName.toLowerCase()&&e.parentNode&&e.parentNode.removeChild(e))},O.supportsTextTracks=function(){return null==n&&(n=null!=document.createElement("video").textTracks),n};var R,z,D,U,W=-1,$=0;O.setCurrentTrackElement=function(e){var n=-1==e?null:a.filter(function(n){return n.index==e})[0];x(n)?I(M,null):(I(M,n),e=-1,n=null);for(var t="textTrack"+e,r=-1!=e&&n?a.indexOf(n):-1,i=["disabled","showing","hidden"],o=M.textTracks,d=0;d<o.length;d++){var s,u=o[d];if(browserInfo.msie||browserInfo.edge)s=r==d?1:0;else{if(-1!=u.label.indexOf("manualTrack"))continue;s=u.id==t?1:0}var l=!1;!isNaN(u.mode),u.mode=l?s:i[s]}},O.updateTextStreamUrls=function(e){if(O.supportsTextTracks()){var n,t=M.textTracks;for(n=0;n<t.length;n++){var r=t[n];try{for(;r.cues.length;)r.removeCue(r.cues[0])}catch(i){}}var a=M.querySelectorAll("track");for(n=0;n<a.length;n++){var o=a[n];o.src=H(o.src,"startPositionTicks",e)}}},O.enableCustomVideoControls=function(){return AppInfo.isNativeApp&&browserInfo.safari?-1!=navigator.userAgent.toLowerCase().indexOf("ipad")?!1:!0:O.canAutoPlayVideo()},O.canAutoPlayVideo=function(){return AppInfo.isNativeApp?!0:browserInfo.mobile?!1:!0},O.init=function(){return new Promise(function(n){"video"==e.type&&T()?E(n):n()})},M="audio"==e.type?w():h()}var n,t,r,i,a,o;window.AudioRenderer||(window.AudioRenderer=function(n){return n=n||{},n.type="audio",new e(n)}),window.VideoRenderer||(window.VideoRenderer=function(n){return n=n||{},n.type="video",new e(n)})});