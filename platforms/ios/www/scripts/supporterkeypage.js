var SupporterKeyPage={onPageShow:function(){SupporterKeyPage.load(this)},load:function(e){Dashboard.showLoadingMsg(),ApiClient.getPluginSecurityInfo().then(function(t){$("#txtSupporterKey",e).val(t.SupporterKey),t.SupporterKey&&!t.IsMBSupporter?(e.querySelector("#txtSupporterKey").classList.add("invalidEntry"),$(".notSupporter",e).show()):(e.querySelector("#txtSupporterKey").classList.remove("invalidEntry"),$(".notSupporter",e).hide()),Dashboard.hideLoadingMsg()})},updateSupporterKey:function(){Dashboard.showLoadingMsg();var e=this,t=$("#txtSupporterKey",e).val(),r={SupporterKey:t};return ApiClient.updatePluginSecurityInfo(r).then(function(){Dashboard.resetPluginSecurityInfo(),Dashboard.hideLoadingMsg(),Dashboard.alert(t?{message:Globalize.translate("MessageKeyUpdated"),title:Globalize.translate("HeaderConfirmation")}:{message:Globalize.translate("MessageKeyRemoved"),title:Globalize.translate("HeaderConfirmation")});var r=$(e).parents(".page")[0];SupporterKeyPage.load(r)}),!1},linkSupporterKeys:function(){Dashboard.showLoadingMsg();var e=this,t=$("#txtNewEmail",e).val(),r=$("#txtNewKey",e).val(),a=$("#txtOldKey",e).val(),o={email:t,newkey:r,oldkey:a},n="https://mb3admin.com/admin/service/supporter/linkKeys";return $.post(n,o).then(function(e){var t=JSON.parse(e);Dashboard.hideLoadingMsg(),t.Success?require(["toast"],function(e){e(Globalize.translate("MessageKeysLinked"))}):require(["toast"],function(e){e(t.ErrorMessage)})}),!1},retrieveSupporterKey:function(){Dashboard.showLoadingMsg();var e=this,t=$("#txtEmail",e).val(),r="https://mb3admin.com/admin/service/supporter/retrievekey?email="+t;return $.post(r).then(function(e){var r=JSON.parse(e);Dashboard.hideLoadingMsg(),r.Success?require(["toast"],function(e){e(Globalize.translate("MessageKeyEmailedTo").replace("{0}",t))}):require(["toast"],function(e){e(r.ErrorMessage)})}),!1}};$(document).on("pageshow","#supporterKeyPage",SupporterKeyPage.onPageShow),function(){function e(e){Dashboard.getPluginSecurityInfo().then(function(t){t.IsMBSupporter?$(".supporterContainer",e).addClass("hide"):$(".supporterContainer",e).removeClass("hide")})}$(document).on("pageinit","#supporterKeyPage",function(){var e=this;$("#supporterKeyForm").on("submit",SupporterKeyPage.updateSupporterKey),$("#lostKeyForm").on("submit",SupporterKeyPage.retrieveSupporterKey),$("#linkKeysForm").on("submit",SupporterKeyPage.linkSupporterKeys),$(".benefits",e).html(Globalize.translate("HeaderSupporterBenefit",'<a href="http://emby.media/premiere" target="_blank">',"</a>"))}).on("pageshow","#supporterKeyPage",function(){var t=this;e(t)})}();