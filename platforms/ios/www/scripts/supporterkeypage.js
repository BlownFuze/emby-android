define(["fetchHelper"],function(e){function t(e){Dashboard.showLoadingMsg(),ApiClient.getPluginSecurityInfo().then(function(t){$("#txtSupporterKey",e).val(t.SupporterKey),t.SupporterKey&&!t.IsMBSupporter?(e.querySelector("#txtSupporterKey").classList.add("invalidEntry"),$(".notSupporter",e).show()):(e.querySelector("#txtSupporterKey").classList.remove("invalidEntry"),$(".notSupporter",e).hide()),Dashboard.hideLoadingMsg()})}function r(e){Dashboard.getPluginSecurityInfo().then(function(t){t.IsMBSupporter?$(".supporterContainer",e).addClass("hide"):$(".supporterContainer",e).removeClass("hide")})}function a(){Dashboard.showLoadingMsg();var t=this,r=$("#txtEmail",t).val(),a="https://mb3admin.com/admin/service/supporter/retrievekey?email="+r;return e.ajax({url:a,type:"POST",dataType:"json"}).then(function(e){Dashboard.hideLoadingMsg(),e.Success?require(["toast"],function(e){e(Globalize.translate("MessageKeyEmailedTo").replace("{0}",r))}):require(["toast"],function(t){t(e.ErrorMessage)})}),!1}var o={updateSupporterKey:function(){Dashboard.showLoadingMsg();var e=this,r=$("#txtSupporterKey",e).val(),a={SupporterKey:r};return ApiClient.updatePluginSecurityInfo(a).then(function(){Dashboard.resetPluginSecurityInfo(),Dashboard.hideLoadingMsg(),Dashboard.alert(r?{message:Globalize.translate("MessageKeyUpdated"),title:Globalize.translate("HeaderConfirmation")}:{message:Globalize.translate("MessageKeyRemoved"),title:Globalize.translate("HeaderConfirmation")});var a=$(e).parents(".page")[0];t(a)}),!1},linkSupporterKeys:function(){Dashboard.showLoadingMsg();var t=this,r=$("#txtNewEmail",t).val(),a=$("#txtNewKey",t).val(),o=$("#txtOldKey",t).val(),n="https://mb3admin.com/admin/service/supporter/linkKeys";return e.ajax({url:n,type:"POST",dataType:"json",query:{email:r,newkey:a,oldkey:o}}).then(function(e){Dashboard.hideLoadingMsg(),e.Success?require(["toast"],function(e){e(Globalize.translate("MessageKeysLinked"))}):require(["toast"],function(t){t(e.ErrorMessage)})}),!1}};$(document).on("pageinit","#supporterKeyPage",function(){var e=this;$("#supporterKeyForm",this).on("submit",o.updateSupporterKey),$("#lostKeyForm",this).on("submit",a),$("#linkKeysForm",this).on("submit",o.linkSupporterKeys),$(".benefits",e).html(Globalize.translate("HeaderSupporterBenefit",'<a href="http://emby.media/premiere" target="_blank">',"</a>"))}).on("pageshow","#supporterKeyPage",function(){var e=this;r(e),t(e)})});