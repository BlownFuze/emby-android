define(["fetchHelper","jQuery","registrationservices"],function(e,t,r){function a(e){Dashboard.showLoadingMsg(),ApiClient.getPluginSecurityInfo().then(function(r){t("#txtSupporterKey",e).val(r.SupporterKey),r.SupporterKey&&!r.IsMBSupporter?(e.querySelector("#txtSupporterKey").classList.add("invalidEntry"),t(".notSupporter",e).show()):(e.querySelector("#txtSupporterKey").classList.remove("invalidEntry"),t(".notSupporter",e).hide()),Dashboard.hideLoadingMsg()})}function o(e){Dashboard.getPluginSecurityInfo().then(function(r){r.IsMBSupporter?t(".supporterContainer",e).addClass("hide"):t(".supporterContainer",e).removeClass("hide")})}function n(){Dashboard.showLoadingMsg();var r=this,a=t("#txtEmail",r).val(),o="https://mb3admin.com/admin/service/supporter/retrievekey?email="+a;return e.ajax({url:o,type:"POST",dataType:"json"}).then(function(e){Dashboard.hideLoadingMsg(),e.Success?require(["toast"],function(e){e(Globalize.translate("MessageKeyEmailedTo").replace("{0}",a))}):require(["toast"],function(t){t(e.ErrorMessage)})}),!1}function i(e){r.showPremiereInfo(),e.preventDefault(),e.stopPropagation()}var s={updateSupporterKey:function(){Dashboard.showLoadingMsg();var e=this,r=t("#txtSupporterKey",e).val(),o={SupporterKey:r};return ApiClient.updatePluginSecurityInfo(o).then(function(){Dashboard.resetPluginSecurityInfo(),Dashboard.hideLoadingMsg(),Dashboard.alert(r?{message:Globalize.translate("MessageKeyUpdated"),title:Globalize.translate("HeaderConfirmation")}:{message:Globalize.translate("MessageKeyRemoved"),title:Globalize.translate("HeaderConfirmation")});var o=t(e).parents(".page")[0];a(o)}),!1},linkSupporterKeys:function(){Dashboard.showLoadingMsg();var r=this,a=t("#txtNewEmail",r).val(),o=t("#txtNewKey",r).val(),n=t("#txtOldKey",r).val(),i="https://mb3admin.com/admin/service/supporter/linkKeys";return e.ajax({url:i,type:"POST",dataType:"json",query:{email:a,newkey:o,oldkey:n}}).then(function(e){Dashboard.hideLoadingMsg(),e.Success?require(["toast"],function(e){e(Globalize.translate("MessageKeysLinked"))}):require(["toast"],function(t){t(e.ErrorMessage)})}),!1}};t(document).on("pageinit","#supporterKeyPage",function(){var e=this;t("#supporterKeyForm",this).on("submit",s.updateSupporterKey),t("#lostKeyForm",this).on("submit",n),t("#linkKeysForm",this).on("submit",s.linkSupporterKeys),e.querySelector(".benefits").innerHTML=Globalize.translate("HeaderSupporterBenefit",'<a class="lnkPremiere" href="http://emby.media/premiere" target="_blank">',"</a>"),e.querySelector(".lnkPremiere").addEventListener("click",i)}).on("pageshow","#supporterKeyPage",function(){var e=this;o(e),a(e)})});