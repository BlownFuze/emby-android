define(["appSettings","userSettings"],function(e,a){function t(e,a){var t="";t+="<option value=''></option>";for(var n=0,i=a.length;i>n;n++){var o=a[n];t+="<option value='"+o.ThreeLetterISOLanguageName+"'>"+o.DisplayName+"</option>"}$(e).html(t)}function n(n,i,o,r){r.then(function(e){t($("#selectAudioLanguage",n),e),t($("#selectSubtitleLanguage",n),e),$("#selectAudioLanguage",n).val(i.Configuration.AudioLanguagePreference||""),$("#selectSubtitleLanguage",n).val(i.Configuration.SubtitleLanguagePreference||""),n.querySelector(".chkEpisodeAutoPlay").checked=i.Configuration.EnableNextEpisodeAutoPlay||!1}),$("#selectSubtitlePlaybackMode",n).val(i.Configuration.SubtitleMode||"").trigger("change"),n.querySelector(".chkPlayDefaultAudioTrack").checked=i.Configuration.PlayDefaultAudioTrack||!1,n.querySelector(".chkEnableCinemaMode").checked=a.enableCinemaMode(),n.querySelector(".chkExternalVideoPlayer").checked=e.enableExternalPlayers(),require(["qualityoptions"],function(a){var t=a.getVideoQualityOptions(e.maxStreamingBitrate()).map(function(e){return'<option value="'+e.bitrate+'">'+e.name+"</option>"}).join("");t='<option value="">'+Globalize.translate("OptionAutomatic")+"</option>"+t,$("#selectMaxBitrate",n).html(t),$("#selectMaxChromecastBitrate",n).html(t),$("#selectMaxBitrate",n).val(e.enableAutomaticBitrateDetection()?"":e.maxStreamingBitrate()),$("#selectMaxChromecastBitrate",n).val(e.maxChromecastBitrate()),Dashboard.hideLoadingMsg()})}function i(e){Dashboard.showLoadingMsg();var a=getParameterByName("userId")||Dashboard.getCurrentUserId(),t=ApiClient.getUser(a),i=Dashboard.getCurrentUser(),o=ApiClient.getCultures();Promise.all([t,i]).then(function(a){n(e,a[1],a[0],o)}),ApiClient.getNamedConfiguration("cinemamode").then(function(a){a.EnableIntrosForMovies||a.EnableIntrosForEpisodes?$(".cinemaModeOptions",e).show():$(".cinemaModeOptions",e).hide()})}function o(e,t){return t.Configuration.AudioLanguagePreference=$("#selectAudioLanguage",e).val(),t.Configuration.SubtitleLanguagePreference=$("#selectSubtitleLanguage",e).val(),t.Configuration.SubtitleMode=$("#selectSubtitlePlaybackMode",e).val(),t.Configuration.PlayDefaultAudioTrack=e.querySelector(".chkPlayDefaultAudioTrack").checked,t.Configuration.EnableNextEpisodeAutoPlay=e.querySelector(".chkEpisodeAutoPlay").checked,a.enableCinemaMode(e.querySelector(".chkEnableCinemaMode").checked),ApiClient.updateUserConfiguration(t.Id,t.Configuration)}function r(a){e.enableExternalPlayers(a.querySelector(".chkExternalVideoPlayer").checked),$("#selectMaxBitrate",a).val()?(e.maxStreamingBitrate($("#selectMaxBitrate",a).val()),e.enableAutomaticBitrateDetection(!1)):e.enableAutomaticBitrateDetection(!0),e.maxChromecastBitrate($("#selectMaxChromecastBitrate",a).val());var t=getParameterByName("userId")||Dashboard.getCurrentUserId();AppInfo.enableAutoSave||Dashboard.showLoadingMsg(),ApiClient.getUser(t).then(function(e){o(a,e).then(function(){Dashboard.hideLoadingMsg(),AppInfo.enableAutoSave||require(["toast"],function(e){e(Globalize.translate("SettingsSaved"))})},function(){Dashboard.hideLoadingMsg()})})}function l(){var e=$(this).parents(".page")[0];return r(e),!1}pageIdOn("pageinit","languagePreferencesPage",function(){var e=this;$("#selectSubtitlePlaybackMode",e).on("change",function(){$(".subtitlesHelp",e).hide(),$(".subtitles"+this.value+"Help",e).show()}),$(".languagePreferencesForm").off("submit",l).on("submit",l),AppInfo.enableAutoSave?e.querySelector(".btnSave").classList.add("hide"):e.querySelector(".btnSave").classList.remove("hide")}),pageIdOn("pageshow","languagePreferencesPage",function(){var e=this;AppInfo.supportsExternalPlayers?$(".fldExternalPlayer",e).show():$(".fldExternalPlayer",e).hide(),AppInfo.supportsExternalPlayerMenu?($(".labelNativeExternalPlayers",e).show(),$(".labelGenericExternalPlayers",e).hide()):($(".labelGenericExternalPlayers",e).show(),$(".labelNativeExternalPlayers",e).hide()),i(e)}),pageIdOn("pagebeforehide","languagePreferencesPage",function(){var e=this;AppInfo.enableAutoSave&&r(e)})});