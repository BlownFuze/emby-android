define(["jQuery","apphost","scripts/taskbutton","cardStyle"],function(e,a,t){function i(){require(["alert"],function(e){e({title:Globalize.translate("HeaderChangeFolderType"),text:Globalize.translate("HeaderChangeFolderTypeHelp")})})}function r(e){require(["medialibrarycreator"],function(a){(new a).show({collectionTypeOptions:h().filter(function(e){return!e.hidden}),refresh:c(e)}).then(function(a){a&&d(e)})})}function o(e,a){require(["medialibraryeditor"],function(t){(new t).show({refresh:c(e),library:a}).then(function(a){a&&d(e)})})}function n(e,a){var t=Globalize.translate("MessageAreYouSureYouWishToRemoveMediaFolder");a.Locations.length&&(t+="<br/><br/>"+Globalize.translate("MessageTheFollowingLocationWillBeRemovedFromLibrary")+"<br/><br/>",t+=a.Locations.join("<br/>")),require(["confirm"],function(i){i(t,Globalize.translate("HeaderRemoveMediaFolder")).then(function(){var t=c(e);ApiClient.removeVirtualFolder(a.Name,t).then(function(){d(e)})})})}function s(e,a){require(["prompt"],function(t){t({label:Globalize.translate("LabelNewName")}).then(function(t){if(t&&t!=a.Name){var i=c(e);ApiClient.renameVirtualFolder(a.Name,t,i).then(function(){d(e)})}})})}function l(a,t,r){var l=e(t).parents(".card")[0],d=parseInt(l.getAttribute("data-index")),c=r[d],u=[];u.push({name:Globalize.translate("ButtonChangeContentType"),id:"changetype",ironIcon:"videocam"}),u.push({name:Globalize.translate("ButtonEditImages"),id:"editimages",ironIcon:"photo"}),u.push({name:Globalize.translate("ButtonManageFolders"),id:"edit",ironIcon:"folder_open"}),u.push({name:Globalize.translate("ButtonRemove"),id:"delete",ironIcon:"remove"}),u.push({name:Globalize.translate("ButtonRename"),id:"rename",ironIcon:"mode_edit"}),require(["actionsheet"],function(e){e.show({items:u,positionTo:t,callback:function(e){switch(e){case"changetype":i(a,c);break;case"edit":o(a,c);break;case"editimages":m(a,c);break;case"rename":s(a,c);break;case"delete":n(a,c)}}})})}function d(e){Dashboard.showLoadingMsg(),ApiClient.getVirtualFolders().then(function(a){u(e,a)})}function c(a){return e(a).is("#mediaLibraryPage")}function u(a,t){var i="";t.push({Name:Globalize.translate("ButtonAddMediaLibrary"),icon:"add_circle",Locations:[],showType:!1,showLocations:!1,showMenu:!1,showNameWithIcon:!0});for(var n=0,s=t.length;s>n;n++){var d=t[n];i+=v(a,d,n)}var c=a.querySelector("#divVirtualFolders");c.innerHTML=i,c.classList.add("itemsContainer"),c.classList.add("vertical-wrap"),e(".btnCardMenu",c).on("click",function(){l(a,this,t)}),e(".addLibrary",c).on("click",function(){r(a)}),e(".editLibrary",c).on("click",function(){var i=e(this).parents(".card")[0],r=parseInt(i.getAttribute("data-index")),n=t[r];n.ItemId&&o(a,n)}),Dashboard.hideLoadingMsg()}function m(e,a){require(["imageEditor"],function(t){t.show({itemId:a.ItemId,serverId:ApiClient.serverId()}).then(function(){d(e)})})}function h(){return[{name:"",value:""},{name:Globalize.translate("FolderTypeMovies"),value:"movies"},{name:Globalize.translate("FolderTypeMusic"),value:"music"},{name:Globalize.translate("FolderTypeTvShows"),value:"tvshows"},{name:Globalize.translate("FolderTypeBooks"),value:"books",message:Globalize.translate("MessageBookPluginRequired")},{name:Globalize.translate("FolderTypeGames"),value:"games",message:Globalize.translate("MessageGamePluginRequired")},{name:Globalize.translate("OptionHomeVideos"),value:"homevideos"},{name:Globalize.translate("FolderTypeMusicVideos"),value:"musicvideos"},{name:Globalize.translate("FolderTypePhotos"),value:"photos"},{name:Globalize.translate("FolderTypeUnset"),value:"mixed",message:Globalize.translate("MessageUnsetContentHelp")}]}function b(e){switch(e){case"movies":return"local_movies";case"music":return"library_music";case"photos":return"photo";case"livetv":return"live_tv";case"tvshows":return"live_tv";case"games":return"folder";case"trailers":return"local_movies";case"homevideos":return"video_library";case"musicvideos":return"video_library";case"books":return"folder";case"channels":return"folder";case"playlists":return"folder";default:return"folder"}}function v(e,t,i){var r="",o="";e.classList.contains("wizardPage")&&(o+="min-width:33.3%;"),r+='<div class="card backdropCard scalableCard backdropCard-scalable" style="'+o+'" data-index="'+i+'">',r+='<div class="cardBox visualCardBox">',r+='<div class="cardScalable visualCardBox-cardScalable">',r+='<div class="cardPadder cardPadder-backdrop"></div>',r+='<div class="cardContent">';var n="";if(t.PrimaryImageItemId&&(n=ApiClient.getScaledImageUrl(t.PrimaryImageItemId,{type:"Primary"})),n?r+='<div class="cardImageContainer editLibrary" style="cursor:pointer;background-image:url(\''+n+"');\"></div>":t.showNameWithIcon||(r+='<div class="cardImageContainer editLibrary" style="cursor:pointer;">',r+='<i class="cardImageIcon md-icon" style="color:#444;">'+(t.icon||b(t.CollectionType))+"</i>",r+="</div>"),!n&&t.showNameWithIcon&&(r+='<h1 class="cardImageContainer addLibrary" style="position:absolute;top:0;left:0;right:0;bottom:0;cursor:pointer;flex-direction:column;">',r+='<i class="cardImageIcon md-icon" style="font-size:300%;color:#888;height:auto;width:auto;">'+(t.icon||b(t.CollectionType))+"</i>",t.showNameWithIcon&&(r+='<div style="margin:1em 0;position:width:100%;font-weight:500;color:#444;">',r+=t.Name,r+="</div>"),r+="</h1>"),r+="</div>",r+="</div>",r+='<div class="cardFooter visualCardBox-cardFooter">',t.showMenu!==!1){var s="dots-horiz"==a.moreIcon?"&#xE5D3;":"&#xE5D4;";r+='<div style="text-align:right; float:right;padding-top:5px;">',r+='<button type="button" is="paper-icon-button-light" class="btnCardMenu autoSize"><i class="md-icon">'+s+"</i></button>",r+="</div>"}r+="<div class='cardText'>",r+=t.showNameWithIcon?"&nbsp;":t.Name,r+="</div>";var l=h().filter(function(e){return e.value==t.CollectionType})[0];return l=l?l.name:Globalize.translate("FolderTypeUnset"),r+="<div class='cardText'>",r+=t.showType===!1?"&nbsp;":l,r+="</div>",t.showLocations===!1?(r+="<div class='cardText'>",r+="&nbsp;",r+="</div>"):t.Locations.length?1==t.Locations.length?(r+="<div class='cardText'>",r+=t.Locations[0],r+="</div>"):(r+="<div class='cardText'>",r+=Globalize.translate("NumLocationsValue",t.Locations.length),r+="</div>"):(r+="<div class='cardText' style='color:#cc3333;'>",r+=Globalize.translate("NumLocationsValue",t.Locations.length),r+="</div>"),r+="</div>",r+="</div>",r+="</div>"}function p(){return[{href:"library.html",name:Globalize.translate("TabFolders")},{href:"librarydisplay.html",name:Globalize.translate("TabDisplay")},{href:"librarypathmapping.html",name:Globalize.translate("TabPathSubstitution")},{href:"librarysettings.html",name:Globalize.translate("TabAdvanced")}]}window.WizardLibraryPage={next:function(){Dashboard.showLoadingMsg();var e=ApiClient;e.ajax({type:"POST",url:e.getUrl("System/Configuration/MetadataPlugins/Autoset")}).then(function(){Dashboard.hideLoadingMsg(),Dashboard.navigate("wizardsettings.html")})}},pageClassOn("pageshow","mediaLibraryPage",function(){var e=this;d(e)}),pageIdOn("pageshow","mediaLibraryPage",function(){LibraryMenu.setTabs("librarysetup",0,p);var e=this;t({mode:"on",progressElem:e.querySelector(".refreshProgress"),taskKey:"RefreshLibrary",button:e.querySelector(".btnRefresh")})}),pageIdOn("pagebeforehide","mediaLibraryPage",function(){var e=this;t({mode:"off",progressElem:e.querySelector(".refreshProgress"),taskKey:"RefreshLibrary",button:e.querySelector(".btnRefresh")})})});