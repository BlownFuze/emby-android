define(["libraryBrowser","jQuery"],function(e,t){return function(r,i){function n(e,t){"Person"==t.Type?e.PersonIds=t.Id:"Genre"==t.Type?e.Genres=t.Name:"MusicGenre"==t.Type?e.Genres=t.Name:"GameGenre"==t.Type?e.Genres=t.Name:"Studio"==t.Type?e.StudioIds=t.Id:"MusicArtist"==t.Type?e.ArtistIds=t.Id:e.ParentId=t.Id}function a(t){var r=o(),a=l[r];if(!a){a=l[r]={query:{SortBy:"SortName",SortOrder:"Ascending",Recursive:"false"!==i.recursive,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:e.getDefaultPageSize()}};var s=i.type;s&&(a.query.IncludeItemTypes=s,"Audio"==s&&(a.query.SortBy="Album,SortName"));var u=i.filters;s&&(a.query.Filters=u),t&&n(a.query,t),e.loadSavedQueryValues(r,a.query)}return a.query}function o(){return e.getSavedQueryKey()}function s(){var t=e.getListItemInfo(this);if("Photo"==t.mediaType){var i=a();return require(["scripts/photos"],function(){Photos.startSlideshow(r,i,t.id)}),!1}}function u(i){Dashboard.showLoadingMsg();var n=a(i);ApiClient.getItems(Dashboard.getCurrentUserId(),n).then(function(a){window.scrollTo(0,0);var o="",s=e.getQueryPagingHtml({startIndex:n.StartIndex,limit:n.Limit,totalRecordCount:a.TotalRecordCount,showLimit:!1});if(r.querySelector(".listTopPaging").innerHTML=s,"Audio"==n.IncludeItemTypes)o='<div style="max-width:1000px;margin:auto;">'+e.getListViewHtml({items:a.Items,playFromHere:!0,defaultAction:"playallfromhere",smallIcon:!0})+"</div>";else{var l={items:a.Items,shape:"auto",centerText:!0,lazy:!0};"MusicAlbum"==n.IncludeItemTypes?(l.overlayText=!1,l.showParentTitle=!0,l.showTitle=!0,l.overlayPlayButton=!0):"MusicArtist"==n.IncludeItemTypes?(l.overlayText=!1,l.overlayPlayButton=!0):"Episode"==n.IncludeItemTypes&&(l.overlayText=!1,l.showParentTitle=!0,l.showTitle=!0,l.overlayPlayButton=!0),o=e.getPosterViewHtml(l)}var d=r.querySelector("#items");d.innerHTML=o+s,ImageLoader.lazyChildren(d),t(".btnNextPage",r).on("click",function(){n.StartIndex+=n.Limit,u(i)}),t(".btnPreviousPage",r).on("click",function(){n.StartIndex-=n.Limit,u(i)}),Dashboard.hideLoadingMsg()})}var l={};t(r).on("click",".mediaItem",s),r.addEventListener("viewbeforeshow",function(){i.parentId?ApiClient.getItem(Dashboard.getCurrentUserId(),i.parentId).then(function(e){LibraryMenu.setTitle(e.Name),u(e)}):u()})}});