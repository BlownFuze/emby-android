define(["libraryBrowser"],function(e){return function(t,r){function n(e,t){"Person"==t.Type?e.PersonIds=t.Id:"Genre"==t.Type?e.Genres=t.Name:"MusicGenre"==t.Type?e.Genres=t.Name:"GameGenre"==t.Type?e.Genres=t.Name:"Studio"==t.Type?e.StudioIds=t.Id:"MusicArtist"==t.Type?e.ArtistIds=t.Id:e.ParentId=t.Id}function i(t){var i=a(),o=u[i];if(!o){o=u[i]={query:{SortBy:"SortName",SortOrder:"Ascending",Recursive:"false"!==r.recursive,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:e.getDefaultPageSize()}};var s=r.type;s&&(o.query.IncludeItemTypes=s,"Audio"==s&&(o.query.SortBy="Album,SortName"));var l=r.filters;s&&(o.query.Filters=l),t&&n(o.query,t),e.loadSavedQueryValues(i,o.query)}return o.query}function a(){return e.getSavedQueryKey()}function o(e,t){for(;!e.classList||!e.classList.contains(t);)if(e=e.parentNode,!e)return null;return e}function s(r){var n=o(r.target,"mediaItem");if(n){var a=e.getListItemInfo(n);if("Photo"==a.mediaType){var s=i();return require(["scripts/photos"],function(){Photos.startSlideshow(t,s,a.id)}),!1}}}function l(r){Dashboard.showLoadingMsg();var n=i(r);ApiClient.getItems(Dashboard.getCurrentUserId(),n).then(function(r){function i(){n.StartIndex+=n.Limit,l(t)}function a(){n.StartIndex-=n.Limit,l(t)}window.scrollTo(0,0);var o="",s=e.getQueryPagingHtml({startIndex:n.StartIndex,limit:n.Limit,totalRecordCount:r.TotalRecordCount,showLimit:!1});if(t.querySelector(".listTopPaging").innerHTML=s,"Audio"==n.IncludeItemTypes)o='<div style="max-width:1000px;margin:auto;">'+e.getListViewHtml({items:r.Items,playFromHere:!0,defaultAction:"playallfromhere",smallIcon:!0})+"</div>";else{var u={items:r.Items,shape:"auto",centerText:!0,lazy:!0};"MusicAlbum"==n.IncludeItemTypes?(u.overlayText=!1,u.showParentTitle=!0,u.showTitle=!0,u.overlayPlayButton=!0):"MusicArtist"==n.IncludeItemTypes?(u.overlayText=!1,u.overlayPlayButton=!0):"Episode"==n.IncludeItemTypes&&(u.overlayText=!1,u.showParentTitle=!0,u.showTitle=!0,u.overlayPlayButton=!0),o=e.getPosterViewHtml(u)}var d=t.querySelector("#items");d.innerHTML=o+s,ImageLoader.lazyChildren(d);var y,c,m;for(m=t.querySelectorAll(".btnNextPage"),y=0,c=m.length;c>y;y++)m[y].addEventListener("click",i);for(m=t.querySelectorAll(".btnPreviousPage"),y=0,c=m.length;c>y;y++)m[y].addEventListener("click",a);Dashboard.hideLoadingMsg()})}var u={};t.addEventListener("click",s),t.addEventListener("viewbeforeshow",function(){r.parentId?ApiClient.getItem(Dashboard.getCurrentUserId(),r.parentId).then(function(e){LibraryMenu.setTitle(e.Name),l(e)}):l()})}});