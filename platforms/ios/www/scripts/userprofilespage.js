define(["jQuery","paper-icon-button-light","cardStyle"],function(e){function a(e,a){var t=Globalize.translate("DeleteUserConfirmation");require(["confirm"],function(n){n(t,Globalize.translate("DeleteUser")).then(function(){Dashboard.showLoadingMsg(),ApiClient.deleteUser(a).then(function(){u(e)})})})}function t(t){var n=e(t).parents(".card")[0],i=e(n).parents(".page")[0],r=n.getAttribute("data-userid"),o=[];o.push({name:Globalize.translate("ButtonOpen"),id:"open",ironIcon:"mode-edit"}),o.push({name:Globalize.translate("ButtonLibraryAccess"),id:"access",ironIcon:"lock"}),o.push({name:Globalize.translate("ButtonParentalControl"),id:"parentalcontrol",ironIcon:"person"}),o.push({name:Globalize.translate("ButtonDelete"),id:"delete",ironIcon:"delete"}),require(["actionsheet"],function(e){e.show({items:o,positionTo:n,callback:function(e){switch(e){case"open":Dashboard.navigate("useredit.html?userid="+r);break;case"access":Dashboard.navigate("userlibraryaccess.html?userid="+r);break;case"parentalcontrol":Dashboard.navigate("userparentalcontrol.html?userid="+r);break;case"delete":a(i,r)}}})})}function n(e,a){var t="",n="card squareCard scalableCard squareCard-scalable";e.Policy.IsDisabled&&(n+=" grayscale"),t+="<div data-userid='"+e.Id+"' class='"+n+"'>",t+='<div class="cardBox visualCardBox">',t+='<div class="cardScalable visualCardBox-cardScalable">',t+='<div class="cardPadder cardPadder-square"></div>';var i="useredit.html?userId="+e.Id;t+='<a class="cardContent" href="'+i+'">';var r;r=e.PrimaryImageTag?ApiClient.getUserImageUrl(e.Id,{width:300,tag:e.PrimaryImageTag,type:"Primary"}):"css/images/userflyoutdefault.png";var o="cardImage";return e.Policy.IsDisabled&&(o+=" disabledUser"),t+='<div class="'+o+'" style="background-image:url(\''+r+"');\">",e.ConnectUserId&&a&&(t+='<div class="cardIndicators">',t+='<div class="playedIndicator" title="'+Globalize.translate("TooltipLinkedToEmbyConnect")+'"><i class="md-icon playedIndicatorIcon indicatorIcon">cloud</i></div>',t+="</div>"),t+="</div>",t+="</a>",t+="</div>",t+='<div class="cardFooter visualCardBox-cardFooter">',t+='<div style="text-align:right; float:right;padding:0;">',t+='<button type="button" is="paper-icon-button-light" class="btnUserMenu autoSize"><i class="md-icon">more_vert</i></button>',t+="</div>",t+='<div class="cardText" style="padding-top:10px;padding-bottom:10px;">',t+=e.Name,t+="</div>",t+="</div>",t+="</div>",t+="</div>"}function i(e,a){var t="";return t+=e.map(function(e){return n(e,a)}).join("")}function r(a,n,r){var o=i(n,r);a.html(o),e(".btnUserMenu",a).on("click",function(){t(this)})}function o(a,t){r(e(".localUsers",a),t.filter(function(e){return"Guest"!=e.ConnectLinkType}),!0),r(e(".connectUsers",a),t.filter(function(e){return"Guest"==e.ConnectLinkType}))}function s(a){var t=[];t.push({name:Globalize.translate("ButtonCancel"),id:"delete",ironIcon:"delete"}),require(["actionsheet"],function(n){var i=e(a).parents(".card"),r=e(a).parents(".page"),o=i.attr("data-id");n.show({items:t,positionTo:i,callback:function(e){switch(e){case"delete":l(r,o)}}})})}function d(e){var a="",t="card squareCard";a+="<div data-id='"+e.Id+"' class='"+t+"'>",a+='<div class="cardBox cardBox-bottompadded visualCardBox">',a+='<div class="cardScalable visualCardBox-cardScalable">',a+='<div class="cardPadder cardPadder-square"></div>';var n="#";a+='<a class="cardContent" href="'+n+'">';var i=e.ImageUrl||"css/images/userflyoutdefault.png";return a+='<div class="cardImage" style="background-image:url(\''+i+"');\">",a+="</div>",a+="</a>",a+="</div>",a+='<div class="cardFooter visualCardBox-cardFooter">',a+='<div class="cardText" style="text-align:right; float:right;padding:0;">',a+='<button type="button" is="paper-icon-button-light" class="btnUserMenu"><i class="md-icon">more_vert</i></button>',a+="</div>",a+='<div class="cardText" style="padding-top:10px;padding-bottom:10px;">',a+=e.UserName,a+="</div>",a+="</div>",a+="</div>",a+="</div>"}function c(a,t){t.length?e(".sectionPendingGuests",a).show():e(".sectionPendingGuests",a).hide();var n=t.map(d).join(""),i=e(".pending",a).html(n);e(".btnUserMenu",i).on("click",function(){s(this)})}function l(e,a){Dashboard.showLoadingMsg(),ApiClient.ajax({type:"DELETE",url:ApiClient.getUrl("Connect/Pending",{Id:a})}).then(function(){u(e)})}function u(e){Dashboard.showLoadingMsg(),ApiClient.getUsers().then(function(a){o(e,a),Dashboard.hideLoadingMsg()}),ApiClient.getJSON(ApiClient.getUrl("Connect/Pending")).then(function(a){c(e,a)})}function v(e){require(["components/guestinviter/connectlink"],function(a){a.show().then(function(){u(e)})})}function g(e){Dashboard.getCurrentUser().then(function(a){return a.ConnectUserId?void require(["components/guestinviter/guestinviter"],function(a){a.show().then(function(){u(e)})}):void v(e,a.Id)})}e(document).on("pageinit","#userProfilesPage",function(){var a=this;e(".btnInvite",a).on("click",function(){g(a)}),e(".btnAddUser",a).on("click",function(){Dashboard.navigate("usernew.html")})}).on("pagebeforeshow","#userProfilesPage",function(){var e=this;u(e)})});