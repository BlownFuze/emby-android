!function(e,t){function a(e){var t=b.Items.filter(function(t){return t.Id==e})[0];Dashboard.alert({title:d(t,!1),message:t.StatusMessage})}function i(e,t){var a=b.Items.filter(function(e){return e.Id==t})[0],i=Globalize.translate("MessageFileWillBeDeleted")+'<p style="word-wrap:break-word;">'+a.OriginalPath+"</p><p>"+Globalize.translate("MessageSureYouWishToProceed")+"</p>";Dashboard.confirm(i,Globalize.translate("HeaderDeleteFile"),function(a){a&&(Dashboard.showLoadingMsg(),ApiClient.deleteOriginalFileFromOrganizationResult(t).then(function(){Dashboard.hideLoadingMsg(),l(e)},c))})}function o(e,t){Dashboard.showLoadingMsg(),ApiClient.getItems(null,{recursive:!0,includeItemTypes:"Series",sortBy:"SortName"}).then(function(a){Dashboard.hideLoadingMsg(),r(e,t,a.Items)},c)}function r(t,a,i){var o=e(".episodeCorrectionPopup",t).popup("open");e(".inputFile",o).html(a.OriginalFileName),e("#txtSeason",o).val(a.ExtractedSeasonNumber),e("#txtEpisode",o).val(a.ExtractedEpisodeNumber),e("#txtEndingEpisode",o).val(a.ExtractedEndingEpisodeNumber),e("#chkRememberCorrection",o).val(!1),e("#hfResultId",o).val(a.Id);var r=i.map(function(e){return'<option value="'+e.Id+'">'+e.Name+"</option>"}).join("");r='<option value=""></option>'+r,e("#selectSeries",o).html(r)}function n(e,t){var a=b.Items.filter(function(e){return e.Id==t})[0];if(!a.TargetPath)return void("Episode"==a.Type&&o(e,a));var i=Globalize.translate("MessageFollowingFileWillBeMovedFrom")+'<p style="word-wrap:break-word;">'+a.OriginalPath+"</p><p>"+Globalize.translate("MessageDestinationTo")+'</p><p style="word-wrap:break-word;">'+a.TargetPath+"</p>";a.DuplicatePaths.length&&(i+="<p><b>"+Globalize.translate("MessageDuplicatesWillBeDeleted")+"</b></p>",i+='<p style="word-wrap:break-word;">'+a.DuplicatePaths.join("<br/>")+"</p>"),i+="<p>"+Globalize.translate("MessageSureYouWishToProceed")+"</p>",Dashboard.confirm(i,Globalize.translate("HeaderOrganizeFile"),function(a){a&&(Dashboard.showLoadingMsg(),ApiClient.performOrganization(t).then(function(){Dashboard.hideLoadingMsg(),l(e)},c))})}function s(t){Dashboard.showLoadingMsg();var a=e(t).parents(".page"),i=e("#hfResultId",t).val(),o={SeriesId:e("#selectSeries",t).val(),SeasonNumber:e("#txtSeason",t).val(),EpisodeNumber:e("#txtEpisode",t).val(),EndingEpisodeNumber:e("#txtEndingEpisode",t).val(),RememberCorrection:e("#chkRememberCorrection",t).checked()};ApiClient.performEpisodeOrganization(i,o).then(function(){Dashboard.hideLoadingMsg(),e(".episodeCorrectionPopup",a).popup("close"),l(a)},c)}function l(e){Dashboard.showLoadingMsg(),ApiClient.getFileOrganizationResults(h).then(function(t){b=t,u(e,t),Dashboard.hideLoadingMsg()},c)}function d(e,t){var a=e.Status,i=null;return"SkippedExisting"==a?a=Globalize.translate("StatusSkipped"):"Failure"==a&&(i="#cc0000",a=Globalize.translate("StatusFailed")),"Success"==a&&(i="green",a=Globalize.translate("StatusSuccess")),t?e.StatusMessage?'<a style="color:'+i+';" data-resultid="'+e.Id+'" href="#" class="btnShowStatusMessage">'+a+"</a>":'<span data-resultid="'+e.Id+'" style="color:'+i+';">'+a+"</span>":a}function u(t,o){var r=o.Items.map(function(e){var t="";t+="<tr>",t+="<td>";var a=parseISO8601Date(e.Date,{toLocal:!0});t+=a.toLocaleDateString(),t+="</td>",t+="<td>";var i=e.Status;return"SkippedExisting"==i?(t+='<div style="color:blue;">',t+=e.OriginalFileName,t+="</div>"):"Failure"==i?(t+='<a data-resultid="'+e.Id+'" style="color:red;" href="#" class="btnShowStatusMessage">',t+=e.OriginalFileName,t+="</a>"):(t+='<div style="color:green;">',t+=e.OriginalFileName,t+="</div>"),t+="</td>",t+="<td>",t+=e.TargetPath||"",t+="</td>",t+='<td class="organizerButtonCell">',"Success"!=e.Status&&(t+='<paper-icon-button data-resultid="'+e.Id+'" icon="folder" class="btnProcessResult organizerButton" title="'+Globalize.translate("ButtonOrganizeFile")+'"></paper-icon-button>',t+='<paper-icon-button data-resultid="'+e.Id+'" icon="delete" class="btnDeleteResult organizerButton" title="'+Globalize.translate("ButtonDeleteFile")+'"></paper-icon-button>'),t+="</td>",t+="</tr>"}).join(""),s=e(".resultBody",t).html(r).parents(".tblOrganizationResults").table("refresh").trigger("create");e(".btnShowStatusMessage",s).on("click",function(){var e=this.getAttribute("data-resultid");a(e)}),e(".btnProcessResult",s).on("click",function(){var e=this.getAttribute("data-resultid");n(t,e)}),e(".btnDeleteResult",s).on("click",function(){var e=this.getAttribute("data-resultid");i(t,e)});var d=LibraryBrowser.getQueryPagingHtml({startIndex:h.StartIndex,limit:h.Limit,totalRecordCount:o.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1});e(t)[0].querySelector(".listTopPaging").innerHTML=d,o.TotalRecordCount>h.Limit&&o.TotalRecordCount>50?e(".listBottomPaging",t).html(d).trigger("create"):e(".listBottomPaging",t).empty(),e(".btnNextPage",t).on("click",function(){h.StartIndex+=h.Limit,l(t)}),e(".btnPreviousPage",t).on("click",function(){h.StartIndex-=h.Limit,l(t)}),o.TotalRecordCount?e(".btnClearLog",t).show():e(".btnClearLog",t).hide()}function g(t,a){var i=e.mobile.activePage;if("ScheduledTaskEnded"==a.MessageType){var o=a.Data;"AutoOrganize"==o.Key&&l(i)}}function c(e){Dashboard.hideLoadingMsg(),Dashboard.alert({title:Globalize.translate("AutoOrganizeError"),message:Globalize.translate("ErrorOrganizingFileWithErrorCode",e.getResponseHeader("X-Application-Error-Code"))})}function p(){return s(this),!1}var b,h={StartIndex:0,Limit:50};e(t).on("pageinit","#libraryFileOrganizerLogPage",function(){var t=this;e(".btnClearLog",t).on("click",function(){ApiClient.clearOrganizationLog().then(function(){l(t)},c)}),e(".episodeCorrectionForm").off("submit",p).on("submit",p)}).on("pageshow","#libraryFileOrganizerLogPage",function(){var t=this;l(t),e(".btnOrganize",t).taskButton({mode:"on",progressElem:t.querySelector(".organizeProgress"),panel:e(".organizeTaskPanel",t),taskKey:"AutoOrganize"}),e(ApiClient).on("websocketmessage.autoorganizelog",g)}).on("pagebeforehide","#libraryFileOrganizerLogPage",function(){var t=this;b=null,e(".btnOrganize",t).taskButton({mode:"off"}),e(ApiClient).off("websocketmessage.autoorganizelog",g)})}(jQuery,document,window);