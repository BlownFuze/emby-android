define(["jQuery","alphaPicker"],function(e,t){function a(e){var t=r(e),a=s[t];return a||(a=s[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Trailer",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,MediaSourceCount,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:LibraryBrowser.getDefaultPageSize()}},LibraryBrowser.loadSavedQueryValues(t,a.query)),a.query}function r(e){return e.savedQueryKey||(e.savedQueryKey=LibraryBrowser.getSavedQueryKey("trailers")),e.savedQueryKey}function n(t){Dashboard.showLoadingMsg();var l=a(t),s=Dashboard.getCurrentUserId();ApiClient.getItems(s,l).then(function(a){window.scrollTo(0,0),a.Items.length?e(".noItemsMessage",t).hide():e(".noItemsMessage",t).show();var s="",u=LibraryBrowser.getQueryPagingHtml({startIndex:l.StartIndex,limit:l.Limit,totalRecordCount:a.TotalRecordCount,sortButton:!0,showLimit:!1,updatePageSizeSetting:!1,filterButton:!0});t.querySelector(".listTopPaging").innerHTML=u,o(t),s=LibraryBrowser.getPosterViewHtml({items:a.Items,shape:"portrait",lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0});var d=t.querySelector(".itemsContainer");d.innerHTML=s+u,ImageLoader.lazyChildren(d),e(".btnNextPage",t).on("click",function(){l.StartIndex+=l.Limit,n(t)}),e(".btnPreviousPage",t).on("click",function(){l.StartIndex-=l.Limit,n(t)}),e(".btnFilter",t).on("click",function(){i(t)}),e(".btnSort",t).on("click",function(){LibraryBrowser.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionImdbRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionDatePlayed"),id:"DatePlayed,SortName"},{name:Globalize.translate("OptionParentalRating"),id:"OfficialRating,SortName"},{name:Globalize.translate("OptionPlayCount"),id:"PlayCount,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"PremiereDate,SortName"}],callback:function(){n(t)},query:l})}),LibraryBrowser.saveQueryValues(r(t),l),Dashboard.hideLoadingMsg()})}function i(e){require(["components/filterdialog/filterdialog"],function(t){var r=new t({query:a(e)});Events.on(r,"filterchange",function(){n(e)}),r.show()})}function o(e){var t=a(e);self.alphaPicker.value(t.NameStartsWithOrGreater)}function l(e,r){var i=r.querySelector(".alphaPicker");i.addEventListener("alphavaluechanged",function(e){var t=e.detail.value,i=a(r);i.NameStartsWithOrGreater=t,i.StartIndex=0,n(r)}),self.alphaPicker=new t({element:i,valueChangeEvent:"click"}),r.querySelector(".itemsContainer").addEventListener("needsrefresh",function(){n(r)})}var s={};return function(e,t,a){var r=this;r.initTab=function(){l(e,a)},r.renderTab=function(){n(a),o(a)}}});