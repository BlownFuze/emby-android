!function(a,e){function t(){var a=e.documentElement;if(a.classList.add("backdropContainer"),a.classList.add("noFade"),!p){p=!0;var t=e.createElement("div");t.classList.add("pageBackground"),e.body.insertBefore(t,e.body.firstChild)}return a}function r(){var a=e.documentElement;a.classList.remove("backdropContainer"),a.removeAttribute("data-url"),a.style.backgroundImage=""}function s(a,e){return Math.floor(Math.random()*(e-a)+a)}function n(e,t,r,s){var n="backdrops2_"+t+(r||"")+(s||""),d=a.Deferred(),o=sessionStore.getItem(n);if(o)o=JSON.parse(o),d.resolveWith(null,[o]);else{var i={SortBy:"IsFavoriteOrLiked,Random",Limit:20,Recursive:!0,IncludeItemTypes:r,ImageTypes:"Backdrop",ParentId:s};e.getItems(Dashboard.getCurrentUserId(),i).then(function(a){var e=a.Items.map(function(a){return{id:a.Id,tag:a.BackdropImageTags[0]}});sessionStore.setItem(n,JSON.stringify(e)),d.resolveWith(null,[e])})}return d.promise()}function d(a,e){e!=a.getAttribute("data-url")&&(a.setAttribute("data-url",e),ImageLoader.lazyImage(a,e))}function o(e,o){var i=window.ApiClient;i&&n(i,Dashboard.getCurrentUserId(),e,o).then(function(e){if(e.length){var n=s(0,e.length-1),o=e[n],c=a(window).width(),g=i.getScaledImageUrl(o.id,{type:"Backdrop",tag:o.tag,maxWidth:c,quality:50});d(t(),g)}else r()})}function i(e){var r=t();r.style.backgroundImage="url(css/images/splash.jpg)",r.setAttribute("data-url","css/images/splash.jpg"),e=a(e)[0],e.classList.add("backdropPage"),e.classList.add("staticBackdropPage")}function c(){return AppInfo.hasLowImageBandwidth?!1:!1}function g(){var a=Dashboard.getCurrentUserId(),e=appStorage.getItem("enableBackdrops-"+a);return"1"==e||"0"!=e&&c()}function l(e,r){var n=r.map(function(a){return a.BackdropImageTags.length>0?{id:a.Id,tag:a.BackdropImageTags[0]}:a.ParentBackdropItemId&&a.ParentBackdropImageTags&&a.ParentBackdropImageTags.length?{id:a.ParentBackdropItemId,tag:a.ParentBackdropImageTags[0]}:null}).filter(function(a){return null!=a});if(n.length){e.classList.add("backdropPage");var o=s(0,n.length-1),i=n[o],c=a(window).width(),g=ApiClient.getScaledImageUrl(i.id,{type:"Backdrop",tag:i.tag,maxWidth:c,quality:50});d(t(),g)}else e.classList.remove("backdropPage")}function u(a,e){e?(a.classList.add("backdropPage"),d(t(),e)):(a.classList.remove("backdropPage"),r())}var p;pageClassOn("pagebeforeshow","page",function(){var a=this;if(a.classList.contains("backdropPage"))if(g()){var e=a.getAttribute("data-backdroptype"),t=a.classList.contains("globalBackdropPage")?"":LibraryMenu.getTopParentId();o(e,t)}else a.classList.remove("backdropPage"),r();else r()}),window.Backdrops={setBackdrops:l,setBackdropUrl:u,setDefault:i,clear:r}}(jQuery,document);