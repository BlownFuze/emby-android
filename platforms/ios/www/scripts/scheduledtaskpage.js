define(["jQuery"],function(e){Array.prototype.remove=function(e,i){var t=this.slice((i||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,t)},window.ScheduledTaskPage={refreshScheduledTask:function(){Dashboard.showLoadingMsg();var e=getParameterByName("id");ApiClient.getScheduledTask(e).then(ScheduledTaskPage.loadScheduledTask)},loadScheduledTask:function(i){var t=e(e.mobile.activePage)[0];e(".taskName",t).html(i.Name),e("#pTaskDescription",t).html(i.Description),require(["listViewStyle"],function(){ScheduledTaskPage.loadTaskTriggers(t,i)}),Dashboard.hideLoadingMsg()},loadTaskTriggers:function(e,i){var t="";t+='<div class="paperList">';for(var r=0,a=i.Triggers.length;a>r;r++){var l=i.Triggers[r];if(t+='<div class="listItem">',t+='<i class="md-icon listItemIcon">schedule</i>',t+=l.MaxRuntimeMs?'<div class="listItemBody two-line">':'<div class="listItemBody">',t+="<div class='listItemBodyText'>"+ScheduledTaskPage.getTriggerFriendlyName(l)+"</div>",l.MaxRuntimeMs){t+='<div class="listItemBodyText secondary">';var s=l.MaxRuntimeMs/36e5;t+=1==s?Globalize.translate("ValueTimeLimitSingleHour"):Globalize.translate("ValueTimeLimitMultiHour",s),t+="</div>"}t+="</div>",t+='<button type="button" is="paper-icon-button-light" title="'+Globalize.translate("ButtonDelete")+'" onclick="ScheduledTaskPage.confirmDeleteTrigger('+r+');"><i class="md-icon">delete</i></button>',t+="</div>"}t+="</div>",e.querySelector(".taskTriggers").innerHTML=t},getTriggerFriendlyName:function(e){if("DailyTrigger"==e.Type)return"Daily at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("WeeklyTrigger"==e.Type)return e.DayOfWeek+"s at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("SystemEventTrigger"==e.Type&&"WakeFromSleep"==e.SystemEvent)return"On wake from sleep";if("IntervalTrigger"==e.Type){var i=e.IntervalTicks/36e9;return.25==i?"Every 15 minutes":.5==i?"Every 30 minutes":.75==i?"Every 45 minutes":1==i?"Every hour":"Every "+i+" hours"}return"StartupTrigger"==e.Type?"On application startup":e.Type},getDisplayTime:function(e){var i=e/36e9;1>i&&(i=0),i=Math.floor(i),e-=36e9*i;var t=Math.floor(e/6e8),r="am";return i>11&&(r="pm"),i%=12,0==i&&(i=12),10>t&&(t="0"+t),i+":"+t+" "+r},showAddTriggerPopup:function(){var i=e.mobile.activePage;e("#selectTriggerType",i).val("DailyTrigger").trigger("change"),e("#popupAddTrigger",i).on("popupafteropen",function(){e("#addTriggerForm input:first",this).focus()}).popup("open").on("popupafterclose",function(){e("#addTriggerForm",i).off("submit"),e(this).off("popupafterclose")})},confirmDeleteTrigger:function(e){require(["confirm"],function(i){i(Globalize.translate("MessageDeleteTaskTrigger"),Globalize.translate("HeaderDeleteTaskTrigger")).then(function(){ScheduledTaskPage.deleteTrigger(e)})})},deleteTrigger:function(e){Dashboard.showLoadingMsg();var i=getParameterByName("id");ApiClient.getScheduledTask(i).then(function(i){i.Triggers.remove(e),ApiClient.updateScheduledTaskTriggers(i.Id,i.Triggers).then(function(){ScheduledTaskPage.refreshScheduledTask()})})},refreshTriggerFields:function(i){var t=e.mobile.activePage;"DailyTrigger"==i?(e("#fldTimeOfDay",t).show(),e("#fldDayOfWeek",t).hide(),e("#fldSelectSystemEvent",t).hide(),e("#fldSelectInterval",t).hide(),e("#txtTimeOfDay",t).attr("required","required")):"WeeklyTrigger"==i?(e("#fldTimeOfDay",t).show(),e("#fldDayOfWeek",t).show(),e("#fldSelectSystemEvent",t).hide(),e("#fldSelectInterval",t).hide(),e("#txtTimeOfDay",t).attr("required","required")):"SystemEventTrigger"==i?(e("#fldTimeOfDay",t).hide(),e("#fldDayOfWeek",t).hide(),e("#fldSelectSystemEvent",t).show(),e("#fldSelectInterval",t).hide(),e("#txtTimeOfDay",t).removeAttr("required")):"IntervalTrigger"==i?(e("#fldTimeOfDay",t).hide(),e("#fldDayOfWeek",t).hide(),e("#fldSelectSystemEvent",t).hide(),e("#fldSelectInterval",t).show(),e("#txtTimeOfDay",t).removeAttr("required")):"StartupTrigger"==i&&(e("#fldTimeOfDay",t).hide(),e("#fldDayOfWeek",t).hide(),e("#fldSelectSystemEvent",t).hide(),e("#fldSelectInterval",t).hide(),e("#txtTimeOfDay",t).removeAttr("required"))},getTriggerToAdd:function(){var i=e.mobile.activePage,t={Type:e("#selectTriggerType",i).val()};"DailyTrigger"==t.Type?t.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks(e("#txtTimeOfDay",i).val()):"WeeklyTrigger"==t.Type?(t.DayOfWeek=e("#selectDayOfWeek",i).val(),t.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks(e("#txtTimeOfDay",i).val())):"SystemEventTrigger"==t.Type?t.SystemEvent=e("#selectSystemEvent",i).val():"IntervalTrigger"==t.Type&&(t.IntervalTicks=e("#selectInterval",i).val());var r=e("#txtTimeLimit",i).val()||"0";return r=36e5*parseFloat(r),t.MaxRuntimeMs=r||null,t},getTimeOfDayTicks:function(e){var i=e.split(":"),t=i[0],r=i[1].split(" ")[0],a=60*t*60*1e3*1e4;return a+=60*r*1e3*1e4}},function(){function i(){Dashboard.showLoadingMsg();var i=getParameterByName("id");return ApiClient.getScheduledTask(i).then(function(i){i.Triggers.push(ScheduledTaskPage.getTriggerToAdd()),ApiClient.updateScheduledTaskTriggers(i.Id,i.Triggers).then(function(){e("#popupAddTrigger").popup("close"),ScheduledTaskPage.refreshScheduledTask()})}),!1}e(document).on("pageinit","#scheduledTaskPage",function(){var t=this;e(".addTriggerForm").off("submit",i).on("submit",i),t.querySelector(".timeFieldExample").innerHTML=Globalize.translate("ValueExample","1:00 PM")}).on("pageshow","#scheduledTaskPage",function(){ScheduledTaskPage.refreshScheduledTask()})}()});