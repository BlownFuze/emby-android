var ScheduledTaskPage={refreshScheduledTask:function(){Dashboard.showLoadingMsg();var e=getParameterByName("id");ApiClient.getScheduledTask(e).then(ScheduledTaskPage.loadScheduledTask)},loadScheduledTask:function(e){var r=$.mobile.activePage;$(".taskName",r).html(e.Name),$("#pTaskDescription",r).html(e.Description),ScheduledTaskPage.loadTaskTriggers(e),Dashboard.hideLoadingMsg()},loadTaskTriggers:function(e){var r="";r+='<li data-role="list-divider"><h3>'+Globalize.translate("HeaderTaskTriggers")+"</h3></li>";for(var a=0,i=e.Triggers.length;i>a;a++){var t=e.Triggers[a];if(r+="<li>",r+='<a href="#">',r+="<h3>",r+=ScheduledTaskPage.getTriggerFriendlyName(t),r+="</h3>",t.MaxRuntimeMs){r+="<p>";var l=t.MaxRuntimeMs/36e5;r+=1==l?Globalize.translate("ValueTimeLimitSingleHour"):Globalize.translate("ValueTimeLimitMultiHour",l),r+="</p>"}r+="</a>",r+='<a href="#" onclick="ScheduledTaskPage.confirmDeleteTrigger('+a+');">',r+=Globalize.translate("Delete"),r+="</a>",r+="</li>"}$("#ulTaskTriggers",$.mobile.activePage).html(r).listview("refresh")},getTriggerFriendlyName:function(e){if("DailyTrigger"==e.Type)return"Daily at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("WeeklyTrigger"==e.Type)return e.DayOfWeek+"s at "+ScheduledTaskPage.getDisplayTime(e.TimeOfDayTicks);if("SystemEventTrigger"==e.Type&&"WakeFromSleep"==e.SystemEvent)return"On wake from sleep";if("IntervalTrigger"==e.Type){var r=e.IntervalTicks/36e9;return.25==r?"Every 15 minutes":.5==r?"Every 30 minutes":.75==r?"Every 45 minutes":1==r?"Every hour":"Every "+r+" hours"}return"StartupTrigger"==e.Type?"On application startup":e.Type},getDisplayTime:function(e){var r=e/36e9;1>r&&(r=0),r=Math.floor(r),e-=36e9*r;var a=Math.floor(e/6e8),i="am";return r>11&&(i="pm"),r%=12,0==r&&(r=12),10>a&&(a="0"+a),r+":"+a+" "+i},showAddTriggerPopup:function(){var e=$.mobile.activePage;Events.trigger($("#selectTriggerType",e).val("DailyTrigger")[0],"change"),$("#popupAddTrigger",e).on("popupafteropen",function(){$("#addTriggerForm input:first",this).focus()}).popup("open").on("popupafterclose",function(){$("#addTriggerForm",e).off("submit"),$(this).off("popupafterclose")})},confirmDeleteTrigger:function(e){Dashboard.confirm(Globalize.translate("MessageDeleteTaskTrigger"),Globalize.translate("HeaderDeleteTaskTrigger"),function(r){r&&ScheduledTaskPage.deleteTrigger(e)})},deleteTrigger:function(e){Dashboard.showLoadingMsg();var r=getParameterByName("id");ApiClient.getScheduledTask(r).then(function(r){r.Triggers.remove(e),ApiClient.updateScheduledTaskTriggers(r.Id,r.Triggers).then(function(){ScheduledTaskPage.refreshScheduledTask()})})},refreshTriggerFields:function(e){var r=$.mobile.activePage;"DailyTrigger"==e?($("#fldTimeOfDay",r).show(),$("#fldDayOfWeek",r).hide(),$("#fldSelectSystemEvent",r).hide(),$("#fldSelectInterval",r).hide(),$("#txtTimeOfDay",r).attr("required","required")):"WeeklyTrigger"==e?($("#fldTimeOfDay",r).show(),$("#fldDayOfWeek",r).show(),$("#fldSelectSystemEvent",r).hide(),$("#fldSelectInterval",r).hide(),$("#txtTimeOfDay",r).attr("required","required")):"SystemEventTrigger"==e?($("#fldTimeOfDay",r).hide(),$("#fldDayOfWeek",r).hide(),$("#fldSelectSystemEvent",r).show(),$("#fldSelectInterval",r).hide(),$("#txtTimeOfDay",r).removeAttr("required")):"IntervalTrigger"==e?($("#fldTimeOfDay",r).hide(),$("#fldDayOfWeek",r).hide(),$("#fldSelectSystemEvent",r).hide(),$("#fldSelectInterval",r).show(),$("#txtTimeOfDay",r).removeAttr("required")):"StartupTrigger"==e&&($("#fldTimeOfDay",r).hide(),$("#fldDayOfWeek",r).hide(),$("#fldSelectSystemEvent",r).hide(),$("#fldSelectInterval",r).hide(),$("#txtTimeOfDay",r).removeAttr("required"))},getTriggerToAdd:function(){var e=$.mobile.activePage,r={Type:$("#selectTriggerType",e).val()};"DailyTrigger"==r.Type?r.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($("#txtTimeOfDay",e).val()):"WeeklyTrigger"==r.Type?(r.DayOfWeek=$("#selectDayOfWeek",e).val(),r.TimeOfDayTicks=ScheduledTaskPage.getTimeOfDayTicks($("#txtTimeOfDay",e).val())):"SystemEventTrigger"==r.Type?r.SystemEvent=$("#selectSystemEvent",e).val():"IntervalTrigger"==r.Type&&(r.IntervalTicks=$("#selectInterval",e).val());var a=$("#txtTimeLimit",e).val()||"0";return a=36e5*parseFloat(a),r.MaxRuntimeMs=a||null,r},getTimeOfDayTicks:function(e){var r=e.split(":"),a=r[0],i=r[1].split(" ")[0],t=60*a*60*1e3*1e4;return t+=60*i*1e3*1e4}};!function(){function e(){Dashboard.showLoadingMsg();var e=getParameterByName("id");return ApiClient.getScheduledTask(e).then(function(e){e.Triggers.push(ScheduledTaskPage.getTriggerToAdd()),ApiClient.updateScheduledTaskTriggers(e.Id,e.Triggers).then(function(){$("#popupAddTrigger").popup("close"),ScheduledTaskPage.refreshScheduledTask()})}),!1}$(document).on("pageinit","#scheduledTaskPage",function(){$(".addTriggerForm").off("submit",e).on("submit",e)}).on("pageshow","#scheduledTaskPage",function(){ScheduledTaskPage.refreshScheduledTask()})}();