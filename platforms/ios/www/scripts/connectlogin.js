define(["jQuery"],function(e){function n(n,a,o){Dashboard.showModalLoadingMsg(),ConnectionManager.loginToConnect(a,o).then(function(){Dashboard.hideModalLoadingMsg(),Dashboard.navigate("selectserver.html")},function(){Dashboard.hideModalLoadingMsg(),Dashboard.alert({message:Globalize.translate("MessageInvalidUser"),title:Globalize.translate("HeaderLoginFailure")}),e("#txtManualPassword",n).val("")})}function a(e,n){switch(Dashboard.hideModalLoadingMsg(),n.State){case MediaBrowser.ConnectionState.SignedIn:var a=n.ApiClient;Dashboard.onServerChanged(a.getCurrentUserId(),a.accessToken(),a),Dashboard.navigate("home.html");break;case MediaBrowser.ConnectionState.ServerSignIn:Dashboard.navigate("login.html?serverid="+n.Servers[0].Id,!1,"none");break;case MediaBrowser.ConnectionState.ServerSelection:Dashboard.navigate("selectserver.html",!1,"none");break;case MediaBrowser.ConnectionState.ConnectSignIn:r(e,"welcome");break;case MediaBrowser.ConnectionState.ServerUpdateNeeded:Dashboard.alert({message:Globalize.translate("ServerUpdateNeeded",'<a href="https://emby.media">https://emby.media</a>')});break;case MediaBrowser.ConnectionState.Unavailable:Dashboard.alert({message:Globalize.translate("MessageUnableToConnectToServer"),title:Globalize.translate("HeaderConnectionFailure")})}}function o(e){Dashboard.showModalLoadingMsg(),ConnectionManager.connect().then(function(n){a(e,n)})}function t(e){var n=getParameterByName("mode")||"auto";if("auto"==n){if(AppInfo.isNativeApp)return void o(e);n="connect"}r(e,n)}function r(n,a){"welcome"==a?(e(".connectLoginForm",n).hide(),e(".welcomeContainer",n).show(),e(".manualServerForm",n).hide(),e(".signupForm",n).hide()):"connect"==a?(e(".connectLoginForm",n).show(),e(".welcomeContainer",n).hide(),e(".manualServerForm",n).hide(),e(".signupForm",n).hide()):"manualserver"==a?(e(".manualServerForm",n).show(),e(".connectLoginForm",n).hide(),e(".welcomeContainer",n).hide(),e(".signupForm",n).hide()):"signup"==a&&(e(".manualServerForm",n).hide(),e(".connectLoginForm",n).hide(),e(".welcomeContainer",n).hide(),e(".signupForm",n).show(),m(n))}function i(){Dashboard.navigate("selectserver.html")}function s(){var n=e(this).parents(".page");return u(n),!1}function l(){var n=e(this).parents(".page");return h(n),!1}function c(){if(!g())return!1;var n=e(this).parents(".page");return ConnectionManager.signupForConnect(e("#txtSignupEmail",n).val(),e("#txtSignupUsername",n).val(),e("#txtSignupPassword",n).val(),e("#txtSignupPasswordConfirm",n).val()).then(function(){Dashboard.alert({message:Globalize.translate("MessageThankYouForConnectSignUp"),callback:function(){Dashboard.navigate("connectlogin.html?mode=welcome")}})},function(e){Dashboard.alert("passwordmatch"==e.errorCode?{message:Globalize.translate("ErrorMessagePasswordNotMatchConfirm")}:"USERNAME_IN_USE"==e.errorCode?{message:Globalize.translate("ErrorMessageUsernameInUse")}:"EMAIL_IN_USE"==e.errorCode?{message:Globalize.translate("ErrorMessageEmailInUse")}:{message:Globalize.translate("DefaultErrorMessage")})}),!1}function d(){return!AppInfo.isNativeApp&&0==window.location.href.toLowerCase().indexOf("https")}function g(){return AppInfo.isNativeApp}function m(){g()&&d()&&require(["https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit"],function(){})}function h(n){var o=e("#txtServerHost",n).val(),t=e("#txtServerPort",n).val();t&&(o+=":"+t),Dashboard.showModalLoadingMsg(),ConnectionManager.connectToAddress(o).then(function(e){a(n,e)},function(){a(n,{State:MediaBrowser.ConnectionState.Unavailable})})}function u(a){var o=e("#txtManualName",a).val(),t=e("#txtManualPassword",a).val();n(a,o,t)}e(document).on("pageinit","#connectLoginPage",function(){var n=this;e(".btnSkipConnect",n).on("click",function(){i()}),e(".connectLoginForm").off("submit",s).on("submit",s),e(".manualServerForm").off("submit",l).on("submit",l),e(".signupForm").off("submit",c).on("submit",c),e(".btnSignupForConnect",n).on("click",function(){return g()?(Dashboard.navigate("connectlogin.html?mode=signup"),!1):void 0}),e(".btnCancelSignup",n).on("click",function(){history.back()}),e(".btnCancelManualServer",n).on("click",function(){history.back()}),e(".btnWelcomeNext",n).on("click",function(){Dashboard.navigate("connectlogin.html?mode=connect")});var a=n.querySelector(".terms");a.innerHTML=Globalize.translate("LoginDisclaimer")+"<div style='margin-top:5px;'><a href='http://emby.media/terms' target='_blank'>"+Globalize.translate("TermsOfUse")+"</a></div>",AppInfo.isNativeApp?(a.classList.add("hide"),n.querySelector(".tvAppInfo").classList.add("hide")):(a.classList.remove("hide"),n.querySelector(".tvAppInfo").classList.remove("hide"))}).on("pagebeforeshow","#connectLoginPage",function(){var n=this;if(e("#txtSignupEmail",n).val(""),e("#txtSignupUsername",n).val(""),e("#txtSignupPassword",n).val(""),e("#txtSignupPasswordConfirm",n).val(""),browserInfo.safari&&AppInfo.isNativeApp)e(".embyIntroDownloadMessage",n).html(Globalize.translate("EmbyIntroDownloadMessageWithoutLink"));else{var a='<a href="http://emby.media" target="_blank">http://emby.media</a>';e(".embyIntroDownloadMessage",n).html(Globalize.translate("EmbyIntroDownloadMessage",a))}}).on("pageshow","#connectLoginPage",function(){var e=this;t(e)})});