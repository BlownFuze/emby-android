define(["jQuery","fnchecked","emby-checkbox"],function(e){function n(n,a){var l="";l+='<h3 class="checkboxListLabel">'+Globalize.translate("HeaderLibraries")+"</h3>",l+='<div class="checkboxList paperList" style="padding:.5em 1em;">';for(var t=0,c=a.length;c>t;t++){var i=a[t],s=' checked="checked"';l+='<label><input type="checkbox" is="emby-checkbox" class="chkFolder" data-id="'+i.Id+'"'+s+"/><span>"+i.Name+"</span></label>"}l+="</div>",e(".folderAccess",n).html(l).trigger("create"),e("#chkEnableAllFolders",n).checked(!0).trigger("change")}function a(n,a){var l="";l+='<h3 class="checkboxListLabel">'+Globalize.translate("HeaderChannels")+"</h3>",l+='<div class="checkboxList paperList" style="padding:.5em 1em;">';for(var t=0,c=a.length;c>t;t++){var i=a[t],s=' checked="checked"';l+='<label><input type="checkbox" is="emby-checkbox" class="chkChannel" data-id="'+i.Id+'"'+s+"/><span>"+i.Name+"</span></label>"}l+="</div>",e(".channelAccess",n).show().html(l).trigger("create"),a.length?e(".channelAccessContainer",n).show():e(".channelAccessContainer",n).hide(),e("#chkEnableAllChannels",n).checked(!0).trigger("change")}function l(l){e("#txtUserName",l).val(""),Dashboard.showLoadingMsg();var t=ApiClient.getJSON(ApiClient.getUrl("Library/MediaFolders",{IsHidden:!1})),c=ApiClient.getJSON(ApiClient.getUrl("Channels"));Promise.all([t,c]).then(function(e){n(l,e[0].Items),a(l,e[1].Items),Dashboard.hideLoadingMsg()})}function t(n){var a=e("#txtUserName",n).val();ApiClient.createUser(a).then(function(a){a.Policy.EnableAllFolders=e("#chkEnableAllFolders",n).checked(),a.Policy.EnabledFolders=a.Policy.EnableAllFolders?[]:e(".chkFolder",n).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-id")}),a.Policy.EnableAllChannels=e("#chkEnableAllChannels",n).checked(),a.Policy.EnabledChannels=a.Policy.EnableAllChannels?[]:e(".chkChannel",n).get().filter(function(e){return e.checked}).map(function(e){return e.getAttribute("data-id")}),ApiClient.updateUserPolicy(a.Id,a.Policy).then(function(){Dashboard.navigate("useredit.html?userId="+a.Id)})},function(e){400==e.status?Dashboard.alert({message:n.querySelector(".labelNewUserNameHelp").innerHTML}):require(["toast"],function(e){e(Globalize.translate("DefaultErrorMessage"))}),Dashboard.hideLoadingMsg()})}function c(){var n=e(this).parents(".page")[0];return Dashboard.showLoadingMsg(),t(n),!1}function i(e){l(e)}e(document).on("pageinit","#newUserPage",function(){var n=this;e("#chkEnableAllChannels",n).on("change",function(){this.checked?e(".channelAccessListContainer",n).hide():e(".channelAccessListContainer",n).show()}),e("#chkEnableAllFolders",n).on("change",function(){this.checked?e(".folderAccessListContainer",n).hide():e(".folderAccessListContainer",n).show()}),e(".newUserProfileForm").off("submit",c).on("submit",c)}).on("pageshow","#newUserPage",function(){var e=this;i(e)})});