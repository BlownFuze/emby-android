define(["events","libraryBrowser","imageLoader","alphaPicker","listView","emby-itemscontainer"],function(e,t,r,a,n){return function(e,i,o){function l(e){var r=s(e),a=S[r];return a||(a=S[r]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicAlbum",Recursive:!0,Fields:"PrimaryImageAspectRatio,SortName,SyncInfo",ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Banner,Thumb",StartIndex:0,Limit:g},view:t.getSavedView(r)||t.getDefaultItemsView("PosterCard","PosterCard")},a.query.ParentId=i.topParentId,t.loadSavedQueryValues(r,a.query)),a}function u(e){return l(e).query}function s(e){return e.savedQueryKey||(e.savedQueryKey=t.getSavedQueryKey("musicalbums")),e.savedQueryKey}function c(e){Dashboard.showLoadingMsg();var a=u(e);ApiClient.getItems(Dashboard.getCurrentUserId(),a).then(function(i){function l(){a.StartIndex+=a.Limit,c(o)}function u(){a.StartIndex-=a.Limit,c(o)}window.scrollTo(0,0),d(e);var m,g=LibraryBrowser.getQueryPagingHtml({startIndex:a.StartIndex,limit:a.Limit,totalRecordCount:i.TotalRecordCount,showLimit:!1,updatePageSizeSetting:!1,addLayoutButton:!1,sortButton:!1,filterButton:!1}),S=y.getCurrentViewStyle();m="List"==S?n.getListViewHtml({items:i.Items,context:"music",sortBy:a.SortBy}):t.getPosterViewHtml("PosterCard"==S?{items:i.Items,shape:"square",context:"music",showTitle:!0,coverImage:!0,showParentTitle:!0,lazy:!0,cardLayout:!0}:{items:i.Items,shape:"square",context:"music",showTitle:!0,showParentTitle:!0,lazy:!0,centerText:!0,overlayPlayButton:!0});var v,h,f=o.querySelectorAll(".paging");for(v=0,h=f.length;h>v;v++)f[v].innerHTML=g;for(f=o.querySelectorAll(".btnNextPage"),v=0,h=f.length;h>v;v++)f[v].addEventListener("click",l);for(f=o.querySelectorAll(".btnPreviousPage"),v=0,h=f.length;h>v;v++)f[v].addEventListener("click",u);var w=o.querySelector(".itemsContainer");w.innerHTML=m,r.lazyChildren(w),t.saveQueryValues(s(e),a),Dashboard.hideLoadingMsg()})}function d(e){var t=u(e);y.alphaPicker.value(t.NameStartsWithOrGreater)}function m(e){var r=e.querySelector(".alphaPicker");r.addEventListener("alphavaluechanged",function(t){var r=t.detail.value,a=u(e);a.NameStartsWithOrGreater=r,a.StartIndex=0,c(e)}),y.alphaPicker=new a({element:r,valueChangeEvent:"click"}),e.querySelector(".btnFilter").addEventListener("click",function(){y.showFilterMenu()}),e.querySelector(".btnSort").addEventListener("click",function(r){t.showSortMenu({items:[{name:Globalize.translate("OptionNameSort"),id:"SortName"},{name:Globalize.translate("OptionAlbumArtist"),id:"AlbumArtist,SortName"},{name:Globalize.translate("OptionCommunityRating"),id:"CommunityRating,SortName"},{name:Globalize.translate("OptionCriticRating"),id:"CriticRating,SortName"},{name:Globalize.translate("OptionDateAdded"),id:"DateCreated,SortName"},{name:Globalize.translate("OptionReleaseDate"),id:"ProductionYear,PremiereDate,SortName"}],callback:function(){u(e).StartIndex=0,c(e)},query:u(e),button:r.target})});var n=e.querySelector(".btnSelectView");n.addEventListener("click",function(e){t.showLayoutMenu(e.target,y.getCurrentViewStyle(),"List,Poster,PosterCard".split(","))}),n.addEventListener("layoutchange",function(r){var a=r.detail.viewStyle;l(e).view=a,t.saveViewSetting(s(e),a),u(e).StartIndex=0,c(e)})}var y=this,g=t.getDefaultPageSize(),S={};y.showFilterMenu=function(){require(["components/filterdialog/filterdialog"],function(e){var t=new e({query:u(o),mode:"albums"});Events.on(t,"filterchange",function(){u(o).StartIndex=0,c(o)}),t.show()})},y.getCurrentViewStyle=function(){return l(o).view},m(o),y.renderTab=function(){c(o),d(o)},y.destroy=function(){}}});