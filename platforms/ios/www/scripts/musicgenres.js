define(["libraryBrowser","cardBuilder"],function(e,t){return function(r,n,a){function o(){var t=i(),r=m[t];return r||(r=m[t]={query:{SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Audio,MusicAlbum",Recursive:!0,Fields:"DateCreated,ItemCounts",StartIndex:0},view:e.getSavedView(t)||"PosterCard"},r.query.ParentId=n.topParentId,e.loadSavedQueryValues(t,r.query)),r}function u(){return o().query}function i(){return e.getSavedQueryKey("genres")}function s(){Dashboard.showLoadingMsg();var e=u();return ApiClient.getGenres(Dashboard.getCurrentUserId(),e)}function d(r,n){var a=u();n.then(function(n){var o="",u=l.getCurrentViewStyle();"Thumb"==u?o=t.getCardsHtml({items:n.Items,shape:"backdrop",preferThumb:!0,context:"music",showItemCounts:!0,centerText:!0,lazy:!0,overlayMoreButton:!0,showTitle:!0}):"ThumbCard"==u?o=t.getCardsHtml({items:n.Items,shape:"backdrop",preferThumb:!0,context:"music",showItemCounts:!0,cardLayout:!0,showTitle:!0,lazy:!0}):"PosterCard"==u?o=t.getCardsHtml({items:n.Items,shape:"auto",context:"music",showItemCounts:!0,lazy:!0,cardLayout:!0,showTitle:!0}):"Poster"==u&&(o=t.getCardsHtml({items:n.Items,shape:"auto",context:"music",centerText:!0,showItemCounts:!0,lazy:!0,overlayMoreButton:!0,showTitle:!0}));var s=r.querySelector("#items");s.innerHTML=o,ImageLoader.lazyChildren(s),e.saveQueryValues(i(),a),Dashboard.hideLoadingMsg()})}function c(){l.preRender(),l.renderTab()}var l=this,m={};l.getViewStyles=function(){return"Poster,PosterCard,Thumb,ThumbCard".split(",")},l.getCurrentViewStyle=function(){return o(a).view},l.setCurrentViewStyle=function(t){o(a).view=t,e.saveViewSetting(i(a),t),c()},l.enableViewSelection=!0;var y;l.preRender=function(){y=s()},l.renderTab=function(){d(a,y)};var h=a.querySelector(".btnSelectView");h.addEventListener("click",function(t){e.showLayoutMenu(t.target,l.getCurrentViewStyle(),l.getViewStyles())}),h.addEventListener("layoutchange",function(e){l.setCurrentViewStyle(e.detail.viewStyle)})}});