!function(){function e(e,t,i,n,o,r){var s='<div data-role="controlgroup">';s+=t.map(function(e){var t=n+e.Id,s=r?-1!=o.indexOf(e.Id):-1==o.indexOf(e.Id),a=s?' checked="checked"':"";return'<label for="'+t+'">'+e.Name+'</label><input class="'+i+'" type="checkbox" data-itemid="'+e.Id+'" id="'+t+'"'+a+" />"}).join(""),s+="</div>",e.html(s).trigger("create")}function t(t){var i=getParameterByName("type"),n=ApiClient.getUsers(),r=ApiClient.getNamedConfiguration(o),s=ApiClient.getJSON(ApiClient.getUrl("Notifications/Types")),a=ApiClient.getJSON(ApiClient.getUrl("Notifications/Services"));Promise.all([n,r,s,a]).then(function(n){var o=n[0],r=n[1],s=n[2],a=n[3],c=r.Options.filter(function(e){return e.Type==i})[0],l=s.filter(function(e){return e.Type==i})[0]||{};l.IsBasedOnUserEvent?$(".monitorUsers",t).show():$(".monitorUsers",t).hide(),l.Variables.length?($(".tokenHelp",t).show(),$(".tokenList",t).html(l.Variables.map(function(e){return"{"+e+"}"}).join(", "))):$(".tokenHelp",t).hide(),$(".notificationType",t).html(l.Name||"Unknown Notification"),c||(c={DisabledMonitorUsers:[],SendToUsers:[],DisabledServices:[],SendToUserMode:"Admins"}),e($(".monitorUsersList",t),o,"chkMonitor","chkMonitor",c.DisabledMonitorUsers),e($(".sendToUsersList",t),o,"chkSendTo","chkSendTo",c.SendToUsers,!0),e($(".servicesList",t),a,"chkService","chkService",c.DisabledServices),$("#chkEnabled",t).checked(c.Enabled||!1).checkboxradio("refresh"),$("#txtTitle",t).val(c.Title||l.DefaultTitle),$("#selectUsers",t).val(c.SendToUserMode).trigger("change")})}function i(e){var t=getParameterByName("type"),i=ApiClient.getNamedConfiguration(o),n=ApiClient.getJSON(ApiClient.getUrl("Notifications/Types"));Promise.all([i,n]).then(function(i){var n=i[0],r=i[1],s=n.Options.filter(function(e){return e.Type==t})[0];s||(s={Type:t},n.Options.push(s));var a=r.filter(function(e){return e.Type==t})[0]||{};s.Enabled=$("#chkEnabled",e).checked(),s.Title=$("#txtTitle",e).val(),s.SendToUserMode=$("#selectUsers",e).val(),s.Title==a.DefaultTitle&&(s.Title=null),s.DisabledMonitorUsers=$(".chkMonitor:not(:checked)",e).get().map(function(e){return e.getAttribute("data-itemid")}),s.SendToUsers=$(".chkSendTo:checked",e).get().map(function(e){return e.getAttribute("data-itemid")}),s.DisabledServices=$(".chkService:not(:checked)",e).get().map(function(e){return e.getAttribute("data-itemid")}),ApiClient.updateNamedConfiguration(o,n).then(function(){Dashboard.navigate("notificationsettings.html")})})}function n(){var e=$(this).parents(".page");return i(e),!1}var o="notifications";$(document).on("pageinit","#notificationSettingPage",function(){var e=this;$("#selectUsers",e).on("change",function(){"Custom"==this.value?$(".selectCustomUsers",e).show():$(".selectCustomUsers",e).hide()}),$(".notificationSettingForm").off("submit",n).on("submit",n)}).on("pageshow","#notificationSettingPage",function(){var e=this;t(e)})}(jQuery,window);