define([],function(){function e(e,s){var t=s.userId;ApiClient.getUser(t).then(function(s){Dashboard.getCurrentUser().then(function(t){LibraryMenu.setTitle(s.Name);var a=!0,r=!1;"Guest"==s.ConnectLinkType?(e.querySelector(".localAccessSection").classList.add("hide"),a=!1):s.HasConfiguredPassword?(e.querySelector("#btnResetPassword").classList.remove("hide"),e.querySelector("#fldCurrentPassword").classList.remove("hide"),r=!0):(e.querySelector("#btnResetPassword").classList.add("hide"),e.querySelector("#fldCurrentPassword").classList.add("hide")),a&&(t.Policy.IsAdministrator||s.Policy.EnableUserPreferenceAccess)?e.querySelector(".passwordSection").classList.remove("hide"):e.querySelector(".passwordSection").classList.add("hide"),r&&(t.Policy.IsAdministrator||s.Policy.EnableUserPreferenceAccess)?e.querySelector(".localAccessSection").classList.remove("hide"):e.querySelector(".localAccessSection").classList.add("hide");var o=e.querySelector("#txtEasyPassword");o.value="",s.HasConfiguredEasyPassword?(o.placeholder="******",e.querySelector("#btnResetEasyPassword").classList.remove("hide")):(o.removeAttribute("placeholder"),o.placeholder="",e.querySelector("#btnResetEasyPassword").classList.add("hide")),e.querySelector(".chkEnableLocalEasyPassword").checked=s.Configuration.EnableLocalPassword})}),e.querySelector("#txtCurrentPassword").value="",e.querySelector("#txtNewPassword").value="",e.querySelector("#txtNewPasswordConfirm").value=""}return function(s,t){function a(){var e=t.userId,a=s.querySelector("#txtEasyPassword").value;a?ApiClient.updateEasyPassword(e,a).then(function(){r(e)}):r(e)}function r(a){ApiClient.getUser(a).then(function(a){a.Configuration.EnableLocalPassword=s.querySelector(".chkEnableLocalEasyPassword").checked,ApiClient.updateUserConfiguration(a.Id,a.Configuration).then(function(){Dashboard.hideLoadingMsg(),require(["toast"],function(e){e(Globalize.translate("MessageSettingsSaved"))}),e(s,t)})})}function o(){var a=getParameterByName("userId"),r=s.querySelector("#txtCurrentPassword").value,o=s.querySelector("#txtNewPassword").value;ApiClient.updateUserPassword(a,r,o).then(function(){Dashboard.hideLoadingMsg(),require(["toast"],function(e){e(Globalize.translate("PasswordSaved"))}),e(s,t)},function(){Dashboard.hideLoadingMsg(),Dashboard.alert({title:Globalize.translate("HeaderLoginFailure"),message:Globalize.translate("MessageInvalidUser")})})}function n(e){var s=this;return s.querySelector("#txtNewPassword").value!=s.querySelector("#txtNewPasswordConfirm").value?require(["toast"],function(e){e(Globalize.translate("PasswordMatchError"))}):(Dashboard.showLoadingMsg(),o()),e.preventDefault(),!1}function i(e){return Dashboard.showLoadingMsg(),a(),e.preventDefault(),!1}function l(){var a=Globalize.translate("PasswordResetConfirmation");require(["confirm"],function(r){r(a,Globalize.translate("PasswordResetHeader")).then(function(){var a=getParameterByName("userId");Dashboard.showLoadingMsg(),ApiClient.resetUserPassword(a).then(function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("PasswordResetComplete"),title:Globalize.translate("PasswordResetHeader")}),e(s,t)})})})}function d(){var a=Globalize.translate("PinCodeResetConfirmation");require(["confirm"],function(r){r(a,Globalize.translate("HeaderPinCodeReset")).then(function(){var a=getParameterByName("userId");Dashboard.showLoadingMsg(),ApiClient.resetEasyPassword(a).then(function(){Dashboard.hideLoadingMsg(),Dashboard.alert({message:Globalize.translate("PinCodeResetComplete"),title:Globalize.translate("HeaderPinCodeReset")}),e(s,t)})})})}s.querySelector(".updatePasswordForm").addEventListener("submit",n),s.querySelector(".localAccessForm").addEventListener("submit",i),s.querySelector("#btnResetEasyPassword").addEventListener("click",d),s.querySelector("#btnResetPassword").addEventListener("click",l),s.addEventListener("viewshow",function(){e(s,t)})}});