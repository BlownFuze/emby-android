define(["libraryBrowser","components/categorysyncbuttons","scrollStyles","emby-itemscontainer"],function(e,t){return function(r,a){function n(){return"Thumb"}function s(){return"Poster"}function i(){Dashboard.showLoadingMsg(),c(),o()}function o(){var t={Limit:24,Fields:"PrimaryImageAspectRatio,SeriesInfo,DateCreated,SyncInfo",UserId:Dashboard.getCurrentUserId(),ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb"};t.ParentId=LibraryMenu.getTopParentId(),ApiClient.getNextUpEpisodes(t).then(function(t){t.Items.length?r.querySelector(".noNextUpItems").classList.add("hide"):r.querySelector(".noNextUpItems").classList.remove("hide");var a=n(),s="";"ThumbCard"==a?s+=e.getPosterViewHtml({items:t.Items,shape:"backdrop",showTitle:!0,preferThumb:!0,showParentTitle:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0}):"Thumb"==a&&(s+=e.getPosterViewHtml({items:t.Items,shape:"backdrop",showTitle:!0,showParentTitle:!0,overlayText:!1,lazy:!0,preferThumb:!0,showDetailsMenu:!0,centerText:!0,overlayPlayButton:AppInfo.enableAppLayouts}));var i=r.querySelector("#nextUpItems");i.innerHTML=s,ImageLoader.lazyChildren(i),Dashboard.hideLoadingMsg()})}function l(){return browserInfo.mobile&&AppInfo.enableAppLayouts}function d(){return l()?"overflowBackdrop":"backdrop"}function c(){var t=LibraryMenu.getTopParentId(),a=6,n={SortBy:"DatePlayed",SortOrder:"Descending",IncludeItemTypes:"Episode",Filters:"IsResumable",Limit:a,Recursive:!0,Fields:"PrimaryImageAspectRatio,SeriesInfo,UserData,SyncInfo",ExcludeLocationTypes:"Virtual",ParentId:t,ImageTypeLimit:1,EnableImageTypes:"Primary,Backdrop,Thumb",EnableTotalRecordCount:!1};ApiClient.getItems(Dashboard.getCurrentUserId(),n).then(function(t){t.Items.length?r.querySelector("#resumableSection").classList.remove("hide"):r.querySelector("#resumableSection").classList.add("hide");var a=s(),n="";"PosterCard"==a?n+=e.getPosterViewHtml({items:t.Items,shape:d(),showTitle:!0,showParentTitle:!0,lazy:!0,cardLayout:!0,showDetailsMenu:!0,preferThumb:!0}):"Poster"==a&&(n+=e.getPosterViewHtml({items:t.Items,shape:d(),showTitle:!0,showParentTitle:!0,lazy:!0,showDetailsMenu:!0,overlayPlayButton:!0,preferThumb:!0,centerText:!0}));var i=r.querySelector("#resumableItems");i.innerHTML=n,ImageLoader.lazyChildren(i)})}function u(e,t,n){var s=[];switch(t){case 0:break;case 1:s.push("scripts/tvlatest");break;case 2:s.push("scripts/tvupcoming");break;case 3:s.push("scripts/tvshows");break;case 4:s.push("scripts/episodes");break;case 5:s.push("scripts/tvgenres");break;case 6:s.push("scripts/tvstudios")}require(s,function(e){var s;0==t&&(s=r.querySelector(".pageTabContent[data-index='"+t+"']"),y.tabContent=s);var i=I[t];i||(s=r.querySelector(".pageTabContent[data-index='"+t+"']"),i=t?new e(r,a,s):y,I[t]=i,i.initTab&&i.initTab()),n(i)})}function b(e,t){u(e,t,function(e){-1==f.indexOf(t)&&e.preRender&&e.preRender()})}function p(e,t){u(e,t,function(e){-1==f.indexOf(t)&&(f.push(t),e.renderTab())})}function m(t,r){r.NowPlayingItem&&"Video"==r.NowPlayingItem.MediaType&&(f=[],T.dispatchEvent(new CustomEvent("tabchange",{detail:{selectedTabIndex:e.selectedTab(T)}})))}function h(e,t){var r=t;"UserDataChanged"===r.MessageType&&r.Data.UserId==Dashboard.getCurrentUserId()&&(f=[])}var y=this;y.initTab=function(){var e=y.tabContent;l()?e.querySelector("#resumableItems").classList.add("hiddenScrollX"):e.querySelector("#resumableItems").classList.remove("hiddenScrollX"),t.init(e)},y.renderTab=function(){i()};var I=[],f=[],T=r.querySelector(".libraryViewNav"),g="tv.html",v=a.topParentId;v&&(g+="?topParentId="+v),l()?r.querySelector("#resumableItems").classList.add("hiddenScrollX"):r.querySelector("#resumableItems").classList.remove("hiddenScrollX"),e.configurePaperLibraryTabs(r,T,r.querySelectorAll(".pageTabContent"),[0,1,2,4,5,6]),T.addEventListener("beforetabchange",function(e){b(r,parseInt(e.detail.selectedTabIndex))}),T.addEventListener("tabchange",function(e){p(r,parseInt(e.detail.selectedTabIndex))}),r.addEventListener("viewbeforeshow",function(){if(!r.getAttribute("data-title")){var e=a.topParentId;e?ApiClient.getItem(Dashboard.getCurrentUserId(),e).then(function(e){r.setAttribute("data-title",e.Name),LibraryMenu.setTitle(e.Name)}):(r.setAttribute("data-title",Globalize.translate("TabShows")),LibraryMenu.setTitle(Globalize.translate("TabShows")))}Events.on(MediaController,"playbackstop",m),Events.on(ApiClient,"websocketmessage",h)}),r.addEventListener("viewbeforehide",function(){Events.off(MediaController,"playbackstop",m),Events.off(ApiClient,"websocketmessage",h)}),r.addEventListener("viewdestroy",function(){I.forEach(function(e){e.destroy&&e.destroy()})})}});